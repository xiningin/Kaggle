{"cell_type":{"107fc7a8":"code","6800b4f8":"code","f18b2a6b":"code","7e34dffb":"code","06febfdb":"code","c978b559":"code","349c3110":"code","a0524c36":"code","23634d90":"code","422ebeb5":"code","f7af1a32":"code","9e122582":"code","74cb0114":"code","29175657":"code","5812666f":"code","467f3a4c":"code","cdf962fa":"code","c007263f":"code","fff4de0e":"code","7027603b":"code","aa86d360":"code","e3f0aa2e":"code","d36bcee4":"code","8d5286dc":"code","c125d1c8":"code","24db6db5":"code","352b1d43":"code","ba4b1c97":"code","3bf5899a":"code","dffc8a99":"code","51285421":"code","e109436d":"code","7adfae72":"code","ed8ee15b":"code","22ebda5c":"code","f512b5f5":"code","5f7f6d7f":"code","ab6cec69":"code","c17a7525":"code","62547a62":"code","d0d89ab9":"code","a2a19245":"code","9ad237c6":"code","750a5d5e":"code","f298257b":"code","c38712e9":"code","16686a31":"code","7a91fd00":"code","0b3eccdf":"code","7d9af96a":"code","75ba2260":"code","d647e571":"code","33d38dad":"code","1a926347":"code","1bec705c":"code","c49078e0":"markdown","5a5a14a9":"markdown","13ad7079":"markdown","e01d8a01":"markdown"},"source":{"107fc7a8":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","6800b4f8":"import matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nimport plotly\nimport plotly.express as px\nimport plotly.graph_objects as go\nimport plotly.figure_factory as ff\nfrom plotly.colors import n_colors\nfrom plotly.subplots import make_subplots","f18b2a6b":"!pip install creme","7e34dffb":"from creme import *","06febfdb":"df = pd.read_csv(\"\/kaggle\/input\/insurance\/insurance.csv\")\ndf.head()","c978b559":"sns.heatmap(df.isnull())","349c3110":"sns.pairplot(df)","a0524c36":"df.describe()","23634d90":"df.info()","422ebeb5":"sns.heatmap(df.corr(),annot=True)","f7af1a32":"df.head(2)","9e122582":"fig = px.scatter(df, x='age', y='bmi',color='sex')\nfig.update_layout(title=\"Age v\/s BMI\",xaxis_title=\"Age\",yaxis_title=\"BMI\",title_x=0.5)\nfig.show()","74cb0114":"children=df['children'].value_counts().to_frame().reset_index().rename(columns={'index':'children','children':'Count'})\nchildren","29175657":"fig = go.Figure(data=[go.Scatter(\n    x=children['children'], y=children['Count'],\n    mode='markers',\n    marker=dict(\n        color=children['Count'],\n        size = 20,\n        showscale=True\n    ))])\n\nfig.update_layout(title='Number of children is each category',xaxis_title=\"children\",yaxis_title=\"Number of Children\",title_x=0.5)\nfig.show()","5812666f":"fig = go.Figure(go.Bar(\n    x=children['children'],y=children['Count'],marker={'color': children['Count'], \n    'colorscale': 'Viridis'},  \n    text=children['Count'],\n    textposition = \"outside\",\n))\nfig.update_layout(title_text='Count of Children',xaxis_title=\"Children\",yaxis_title=\"Number of Children\",title_x=0.5)\nfig.show()","467f3a4c":"df.head(2)","cdf962fa":"region=df['region'].value_counts().to_frame().reset_index().rename(columns={'index':'region','region':'count'})\nregion","c007263f":"colors=['orange','pink','yellow','lightblue']\nfig = go.Figure([go.Pie(labels=region['region'],values=region['count'])])\nfig.update_traces(hoverinfo='label+percent',textinfo='percent+label', textfont_size=15,marker=dict(colors=colors,line=dict(color=\"black\",width=2)))\nfig.update_layout(title=\"Region Types\",title_x=0.5)\nfig.show()","fff4de0e":"df.head(1)","7027603b":"fig = px.sunburst(df, path=['sex','smoker','region'], values='charges', color='charges',color_continuous_scale='viridis')\nfig.update_layout(title=\"Sunburst Distribution by Sex, smoker and region\",title_x=0.5)\nfig.show()","aa86d360":"male=df[df['sex']==\"male\"]['charges']\nfemale=df[df['sex']==\"female\"]['charges']\n\nfig = go.Figure()\nfig.add_trace(go.Box(y=male,\n                     marker_color=\"blue\",\n                     name=\"Male charges\",\n                    boxpoints='suspectedoutliers', # Display suspected outliers\n                     boxmean = 'sd',\n                     marker=dict(\n                     color='black',\n                     outliercolor='red')))\nfig.add_trace(go.Box(y=female,\n                     marker_color=\"magenta\",\n                     name=\"Female charges\",\n                    boxpoints='suspectedoutliers', # Display suspected outliers\n                     boxmean = 'sd',\n                     marker=dict(\n                     color='black',\n                     outliercolor='black')))\nfig.update_layout(title=\"Distribution of Charges by Sex with their outliers\",title_x=0.5)\nfig.show()","e3f0aa2e":"fig = go.Figure(data=[go.Histogram(x=male,  \n                                  marker_color=\"royalblue\")])\nfig.update_layout(title=\"Distribution of Charges for Male\",xaxis_title=\"Charges\",yaxis_title=\"Counts\")\nfig.show()","d36bcee4":"min(male)","8d5286dc":"histdata = [male,female]\ngrouplabels = ['Charge distribution for Male',\"Charge distribution for Female\"]\ncolors = ['red','royalblue','orange']\nfig = ff.create_distplot(histdata,grouplabels,colors = colors,show_hist=False)\nfig.show()","c125d1c8":"df.head()","24db6db5":"fig = go.Figure(go.Histogram2dContour(x=df['age'],\n        y=df['bmi']))\nfig.update_layout(title='Density of Age v\/s BMI',xaxis_title=\"AGE\",yaxis_title=\"BMI\",title_x=0.5)\nfig.show()","352b1d43":"fig = go.Figure(go.Histogram2d(x=df['age'],\n        y=df['bmi']))\nfig.update_layout(title='Density of Age v\/s BMI',xaxis_title=\"AGE\",yaxis_title=\"BMI\",title_x=0.5)\nfig.show()","ba4b1c97":"fig = px.density_heatmap(df, x=\"sex\", y=\"charges\", facet_row=\"smoker\", facet_col=\"region\")\nfig.update_layout(title='Density heatmap of Sex vs charges with smoker and region')\nfig.show()","3bf5899a":"male=df[df['sex']==\"male\"]\n\nx = df['age']\ny = df['charges']\n\nfig = go.Figure()\nfig.add_trace(go.Histogram2dContour(\n        x = x,\n        y = y,\n        colorscale = 'gray',\n        reversescale = True,\n        xaxis = 'x',\n        yaxis = 'y'\n    ))\nfig.add_trace(go.Scatter(\n        x = x,\n        y = y,\n        xaxis = 'x',\n        yaxis = 'y',\n        mode = 'markers',\n        marker = dict(\n            color = \"red\", #'rgba(0,0,0,0.3)',\n            size = 3\n        )\n    ))\nfig.add_trace(go.Histogram(\n        y = y,\n        xaxis = 'x2',\n        marker = dict(\n            color = \"blue\", #'rgba(0,0,0,1)'\n        )\n    ))\nfig.add_trace(go.Histogram(\n        x = x,\n        yaxis = 'y2',\n        marker = dict(\n            color = \"blue\",# 'rgba(0,0,0,1)'\n        )\n    ))\n\nfig.update_layout(\n    autosize = False,\n    xaxis = dict(\n        zeroline = False,\n       domain = [0,0.85],\n        showgrid = False\n    ),\n    yaxis = dict(\n        zeroline = False,\n       domain = [0,0.85],\n        showgrid = False\n    ),\n    xaxis2 = dict(\n        zeroline = False,\n       domain = [0.85,1],\n        showgrid = False\n    ),\n    yaxis2 = dict(\n        zeroline = False,\n        domain = [0.85,1],\n        showgrid = False\n    ),\n    height = 600,\n    width = 600,\n    bargap = 0,\n    hovermode = 'closest',\n    showlegend = False,\n    title_text=\"Density Contour of charges and age for Males\",title_x=0.5\n)\n\nfig.show()","dffc8a99":"temp_list=[]\nchildren=list(df['children'].value_counts()[:10].to_frame().reset_index()['index'])\nchildren","51285421":"for i in children:\n    temp_df=df[df['children']==i]['charges']\n    temp_list.append(temp_df)\nfinal_arr=np.array(temp_list)\n","e109436d":"colors = n_colors('rgb(5, 200, 200)', 'rgb(200, 10, 10)', 10, colortype='rgb')\n\nfig = go.Figure()\nfor dataline,color,n in zip(final_arr,colors,children):\n    fig.add_trace(go.Violin(x=dataline,line_color=color,name=n))\nfig.update_traces(orientation='h',side='positive',width=2,points=False)\nfig.update_layout(title=\"Distribution of Children with charges\",xaxis_showgrid=False, xaxis_zeroline=True,height=800)\nfig.show()","7adfae72":"fig = px.parallel_categories(df, dimensions=['sex','children','smoker'],\n                color=\"age\", color_continuous_scale=px.colors.sequential.Inferno)\nfig.update_layout(title=\"Parallel Categories Diagram \")\nfig.show()","ed8ee15b":"fig = px.parallel_categories(df, dimensions=['sex','region','smoker'],\n                color=\"age\", color_continuous_scale=px.colors.sequential.Inferno)\nfig.update_layout(title=\"Parallel Categories Diagram \")\nfig.show()","22ebda5c":"fig = go.Figure(go.Heatmap(z=df['charges'],x=df['sex'],\n                   y=df['children'],hoverongaps = False))\nfig.update_layout(title='Heatmap of Charges Vs Sex & Children',xaxis_title=\"Gender\",yaxis_title=\"Children\")\nfig.show()","f512b5f5":"df['children'].unique()","5f7f6d7f":"df['region'].unique()","ab6cec69":"def required(region):\n    data=df[(df['region']==region)&((df['children']==0)|(df['children']==1)|(df['children']==2)|(df['children']==3))][['children','charges']].groupby('children').sum().reset_index()\n#     df[\"month\"] = pd.to_datetime(df.month, format='%B').dt.month \n    data = data.sort_values(by=\"children\",ascending=False)\n    children = ['0','1','2','3']\n    data['children'] = children\n    return data","c17a7525":"southwest = required(\"southwest\")\nsoutheast = required(\"southeast\")\nnorthwest = required(\"northwest\")\nnortheast = required(\"northeast\")\n\nnortheast","62547a62":"fig = go.Figure()\n\nfig.add_trace(go.Funnel(\n    name = 'southwest',\n    y = southwest['children'].tolist(),\n    x = southwest['charges'].tolist(),\n    textinfo = \"value\"))\n\nfig.add_trace(go.Funnel(\n    name = 'southeast',\n    orientation = \"h\",\n    y = southeast['children'].tolist(),\n    x = southeast['charges'].tolist(),\n    textposition = \"inside\",\n    textinfo = \"value\"))\n\nfig.add_trace(go.Funnel(\n    name = 'northwest',\n    orientation = \"h\",\n    y = northwest['children'].tolist(),\n    x = northwest['charges'].tolist(),\n    textinfo = \"value\"))\n\nfig.add_trace(go.Funnel(\n    name = 'northeast',\n    orientation = \"h\",\n    y = northeast['children'].tolist(),\n    x = northeast['charges'].tolist(),\n    textinfo = \"value\"))\n\nfig.update_layout(title = \"Funnel chart for children and charges based on region\",title_x=0.5)\n\nfig.show()","d0d89ab9":"df.head()","a2a19245":"fig = px.scatter_3d(data_frame=df,x='age',y='bmi',z='charges',color='sex')\nfig.update_layout(title = \"3D scatter plot for age, bmi and charges based on sex\",title_x=0.5)\nfig.show()","9ad237c6":"fig = go.Figure(data=[go.Histogram(x=df['charges'],  \n                                  marker_color=\"royalblue\")])\nfig.update_layout(title=\"Distribution of Charges\",xaxis_title=\"Charges\",yaxis_title=\"Counts\")\nfig.show()","750a5d5e":"IQR=df['charges'].quantile(0.75)-df['charges'].quantile(0.25)\nlower_bridge=df['charges'].quantile(0.25)-(IQR*1.5)\nupper_bridge=df['charges'].quantile(0.75)+(IQR*1.5)\nprint(lower_bridge), print(upper_bridge)","f298257b":"#### Extreme outliers\nlower_bridge=df['charges'].quantile(0.25)-(IQR*3)\nupper_bridge=df['charges'].quantile(0.75)+(IQR*3)\nprint(lower_bridge), print(upper_bridge)","c38712e9":"data = df.copy()\ndata.loc[data['charges']>=52338.78861,'charges']=52338.78861\n","16686a31":"fig = go.Figure(data=[go.Histogram(x=data['charges'],  \n                                  marker_color=\"royalblue\")])\nfig.update_layout(title=\"Distribution of Charges after fixing outliers\",xaxis_title=\"Charges\",yaxis_title=\"Counts\")\nfig.show()","7a91fd00":"data.head(3)","0b3eccdf":"categorical = data.columns[data.dtypes==object]\n","7d9af96a":"from sklearn.preprocessing import LabelEncoder\nenc = LabelEncoder()\nfor i in categorical:\n    data[i] = enc.fit_transform(data[i])","75ba2260":"data.head()","d647e571":"X = data.drop('charges',axis=1)\ny = data['charges']","33d38dad":"from creme import compose\nfrom creme import linear_model\nfrom creme import preprocessing\nfrom creme import stream\nfrom creme import metrics\n\nscaler = preprocessing.StandardScaler()\nlinreg= linear_model.LinearRegression()\ny_true = []\ny_pred = []\n\nfor xi, yi in stream.iter_pandas(X,y, shuffle=True, seed=42):\n    xi_scaled = scaler.fit_one(xi).transform_one(xi)\n    yi_pred = linreg.predict_one(xi_scaled)\n    linreg.fit_one(xi_scaled, yi)\n    y_true.append(yi)\n    y_pred.append(yi_pred)","1a926347":"from sklearn import metrics","1bec705c":"metrics.r2_score(y_true,y_pred)","c49078e0":"# as data is left skewed we need to fix it","5a5a14a9":"# MODEL TRAINING USING CREME LIBRARY","13ad7079":"# Lets handle outliers","e01d8a01":"# EDA"}}