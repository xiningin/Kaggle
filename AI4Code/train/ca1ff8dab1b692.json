{"cell_type":{"0d613b9b":"code","cfc32cac":"code","d4607746":"code","b36cd170":"code","2b4bd389":"code","11526357":"code","9531ba53":"code","5c00408c":"code","f0611d78":"code","5630f19e":"code","63cf3fde":"code","78cb3773":"code","ae4b9e09":"code","a6f02854":"code","b51762c2":"code","682b61da":"markdown"},"source":{"0d613b9b":"import os\nimport cv2\nimport skimage.io\nfrom tqdm.notebook import tqdm\nimport zipfile\nimport pandas as pd\nimport numpy as np\nimport shutil\n\nfrom pydub import AudioSegment\nfrom joblib import Parallel, delayed","cfc32cac":"!mkdir -p \/root\/.kaggle\/\n!cp ..\/input\/mykaggleapi\/kaggle.json \/root\/.kaggle\/\n!chmod 600 \/root\/.kaggle\/kaggle.json","d4607746":"!mkdir -p \/tmp\/birdcall_dataset","b36cd170":"!ls \/tmp","2b4bd389":"data = '''{\n  \"title\": \"birdsong_recognition_wav_16000\",\n  \"id\": \"gopidurgaprasad\/birdsong-recognition-wav-16000\",\n  \"licenses\": [\n    {\n      \"name\": \"CC0-1.0\"\n    }\n  ]\n}\n'''\ntext_file = open(\"\/tmp\/birdcall_dataset\/dataset-metadata.json\", 'w+')\nn = text_file.write(data)\ntext_file.close()","11526357":"TRAIN_CSV = \"..\/input\/birdsong-recognition\/train.csv\"\nROOT_PATH = \"..\/input\/birdsong-recognition\/train_audio\"\nOUTPUT_DIR = \"\/tmp\/birdcall_dataset\/train_audio_wav_16000\"","9531ba53":"os.mkdir(OUTPUT_DIR)","5c00408c":"def save_fn(bird_code, filename):\n    \n    path = f\"{ROOT_PATH}\/{bird_code}\/{filename}\"\n    save_path = f\"{OUTPUT_DIR}\/{bird_code}\"\n    if not os.path.exists(save_path):\n        os.makedirs(save_path, exist_ok=True)\n    \n    if os.path.exists(path):\n        try:\n            sound = AudioSegment.from_mp3(path)\n            sound = sound.set_frame_rate(16000)\n            sound.export(f\"{save_path}\/{filename[:-4]}.wav\", format=\"wav\")\n        except:\n            print(path)","f0611d78":"train = pd.read_csv(TRAIN_CSV)\nbird_code_list = list(train.ebird_code.values)\nfilename_list = list(train.filename.values)","5630f19e":"Parallel(n_jobs=8, backend=\"multiprocessing\")(\n    delayed(save_fn)(bird_code, filename) for bird_code, filename in tqdm(zip(bird_code_list, filename_list), total=len(bird_code_list))\n)","63cf3fde":"!sleep 10","78cb3773":"!zip -r \"\/tmp\/birdcall_dataset\/train_audio_wav_16000.zip\" \"\/tmp\/birdcall_dataset\/train_audio_wav_16000\/\"","ae4b9e09":"!ls -l \/tmp\/birdcall_dataset\/","a6f02854":"!kaggle datasets create -p \/tmp\/birdcall_dataset","b51762c2":"!rm -rf \/tmp\/birdcall_dataset","682b61da":"### Reference\n\nIdea is from this notebook : https:\/\/www.kaggle.com\/raghaw\/panda-medium-resolution-dataset-25x256x256\n\nJoblib Parallel form : https:\/\/www.youtube.com\/watch?v=Ny3O4VpACkc&list=PL98nY_tJQXZnoCDfHLo58tRHUyNvrRVzn&index=4"}}