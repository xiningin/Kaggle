{"cell_type":{"1a0384b6":"code","c5511a4f":"code","78d59c0f":"code","74911593":"code","87b223c7":"code","65bf8ec7":"code","ea835ec8":"code","bb63a5fa":"code","2f2c03fa":"code","6e3a7ed9":"code","ea6bce40":"code","de7437bf":"code","005589a1":"code","89a9ae26":"code","8f4bb1e6":"code","46cb2cfa":"code","99c80a3d":"code","82a36be2":"code","246e64c4":"code","b65303af":"code","1d5754fc":"code","6346f13d":"code","aa12ca9f":"code","070f1b24":"code","def0c4dd":"code","ec90e4c8":"code","09766542":"code","15d42e27":"code","5e2a104a":"code","b786f5e4":"code","5855e9aa":"code","8513356c":"markdown","7cbbe649":"markdown","865c7242":"markdown","efdd467e":"markdown","a75ff145":"markdown","da132ead":"markdown","4a12f763":"markdown","6bbda291":"markdown","adc1d4e0":"markdown","3d1ff34c":"markdown","4fe734b1":"markdown","e93b527e":"markdown","167547a0":"markdown","ada69c13":"markdown","8477dde8":"markdown","b471b657":"markdown","91f8616d":"markdown"},"source":{"1a0384b6":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\n\n#for dirname, _, filenames in os.walk('\/kaggle\/input'):\n    #for filename in filenames:\n       # print(os.path.join(dirname, filename))\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","c5511a4f":"import cv2\nimport json\nimport seaborn as sns\nimport albumentations as A\nimport matplotlib.pyplot as plt\n\nimport tensorflow as tf\n\nBASE_DIR = \"..\/input\/cassava-leaf-disease-classification\/\"","78d59c0f":"label_mapping = pd.read_json(os.path.join(BASE_DIR, 'label_num_to_disease_map.json'), typ = 'series')\nprint(label_mapping)","74911593":"df = pd.read_csv(os.path.join(BASE_DIR, \"train.csv\"))","87b223c7":"# Create a new column that holds the path of each image\ndf['path'] = df['image_id'].map(lambda x: os.path.join(BASE_DIR, 'train_imgs', x))\n\n# Shuffle the Dataframe\ndf = df.sample(frac=1).reset_index(drop=True) ","65bf8ec7":"df[\"class_name\"] = df[\"label\"].map(label_mapping)","ea835ec8":"print('Total number of images in the dataset - {}'.format(len(df)))\ndf","bb63a5fa":"plt.figure(figsize=(8, 4))\nsns.countplot(y = \"class_name\", data = df)","2f2c03fa":"img = cv2.imread(os.path.join(BASE_DIR, 'train_images', '3613193696.jpg'))\nplt.imshow(img)\nprint('Shape of the Image - {}'.format(img.shape))","6e3a7ed9":"def visualize_batch(image_ids, labels):\n    plt.figure(figsize=(16, 12))\n    \n    for ind, (image_id, label) in enumerate(zip(image_ids, labels)):\n        plt.subplot(3, 3, ind + 1)\n        image = cv2.imread(os.path.join(BASE_DIR, \"train_images\", image_id))\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n\n        plt.imshow(image)\n        plt.title(f'Class: {label}', fontsize = 12)\n        plt.axis(\"off\")\n    \n    plt.show()","ea6bce40":"random_df = df.sample(9)\nimage_ids = random_df[\"image_id\"].values\nlabels = random_df[\"class_name\"].values\n\nvisualize_batch(image_ids, labels)","de7437bf":"cbb_df = df[df[\"label\"] == 0]\nprint('Total train images for Class {} - {}'.format(label_mapping[0], cbb_df.shape[0]))\n\ncbb_df = cbb_df.sample(9)\nimage_ids = cbb_df[\"image_id\"].values\nlabels = cbb_df[\"class_name\"].values\n\nvisualize_batch(image_ids, labels)","005589a1":"cbsd_df = df[df[\"label\"] == 1]\nprint('Total train images for Class {} - {}'.format(label_mapping[1], cbsd_df.shape[0]))\n\ncbsd_df = cbsd_df.sample(9)\nimage_ids = cbsd_df[\"image_id\"].values\nlabels = cbsd_df[\"class_name\"].values\n\nvisualize_batch(image_ids, labels)","89a9ae26":"cgm_df = df[df[\"label\"] == 2]\nprint('Total train images for Class {} - {}'.format(label_mapping[2], cgm_df.shape[0]))\n\ncgm_df = cgm_df.sample(9)\nimage_ids = cgm_df[\"image_id\"].values\nlabels = cgm_df[\"class_name\"].values\n\nvisualize_batch(image_ids, labels)","8f4bb1e6":"cmd_df = df[df[\"label\"] == 3]\nprint('Total train images for Class {} - {}'.format(label_mapping[3], cmd_df.shape[0]))\n\ncmd_df = cmd_df.sample(9)\nimage_ids = cmd_df[\"image_id\"].values\nlabels = cmd_df[\"class_name\"].values\n\nvisualize_batch(image_ids, labels)","46cb2cfa":"h_df = df[df[\"label\"] == 4]\nprint('Total train images for Class {} - {}'.format(label_mapping[4], h_df.shape[0]))\n\nh_df = h_df.sample(9)\nimage_ids = h_df[\"image_id\"].values\nlabels = h_df[\"class_name\"].values\n\nvisualize_batch(image_ids, labels)","99c80a3d":"def augmentImage(image_id, seed = 0):\n    \n    # Reading image given the path\n    image = tf.io.read_file(os.path.join(BASE_DIR, \"train_images\", image_id))\n    image = tf.image.decode_jpeg(image, channels = 3)\n    \n    original_image = image\n    \n    # Brightness, Contrast\n    brightness = tf.image.random_brightness(image, 0.4, seed = seed)\n    contrast = tf.image.random_contrast(image, 0.2, 0.6, seed = seed)\n    \n    # Cropping\n    crop = tf.image.random_crop(image, size = [500, 600, 3], seed = seed)\n    central_crop = tf.image.central_crop(image, central_fraction = 0.3)\n    \n    \n    # Flippings\n    # replace with random_flip_left_right when using as part of a augmentation pipeline\n    left_right = tf.image.flip_left_right(image)    \n    #replace with random_flip_up_down when using as part of a augmentation pipeline\n    up_down = tf.image.flip_up_down(image)\n    transpose = tf.image.transpose(image)\n    \n    # Color-based\n    hue = tf.image.random_hue(image, 0.2, seed = seed)\n    saturation = tf.image.random_saturation(image, 5, 10, seed = seed)\n    jpeg_quality = tf.image.random_jpeg_quality(image, 75, 85)\n        \n    # Rotations\n    #rotated = tf.image.rot90(image)    \n    \n    # Grayscale\n    grayscaled = tf.image.rgb_to_grayscale(image)\n    \n    \n    return (original_image, brightness, contrast, crop, central_crop, left_right, up_down, transpose, hue, saturation, jpeg_quality)","82a36be2":"def displayAugmentations(l, index):\n    \n    augmentedImages = augmentImage(l[index])\n    plt.figure(figsize=(16, 12))\n    for i, imageName in zip(range(11), ['Input Image', 'Augmented - Brightness', 'Augmented - Contrast', 'Augmented - Crop', 'Augmented - Center Cropped', 'Augmented - Horizontal Flip',\n                                      'Augmented - Vertical Flip', 'Augmented - Transpose' , 'Augmented - Hue', 'Augmented - Saturation','Augmented - Jpeg Quality']):\n        ax = plt.subplot(3, 4, i + 1)\n        plt.imshow(augmentedImages[i].numpy().astype(\"uint8\"))\n        plt.title(imageName)\n        plt.axis(\"off\")","246e64c4":"cbb_list = cbb_df['image_id'].tolist()\ncbsd_list = cbsd_df['image_id'].tolist()\ncgm_list = cgm_df['image_id'].tolist()\ncmd_list = cmd_df['image_id'].tolist()\nh_list = h_df['image_id'].tolist()","b65303af":"print('Cassava Bacterial Blight Images')\ndisplayAugmentations(cbb_list, 0)","1d5754fc":"print('Cassava Brown Steak Disease Images')\ndisplayAugmentations(cbsd_list, 0)","6346f13d":"print('Cassava Green Mottle Images')\ndisplayAugmentations(cgm_list, 0)","aa12ca9f":"print('Cassava Mosaic Disease Images')\ndisplayAugmentations(cmd_list, 0)","070f1b24":"print('Healthy Leaf Images')\ndisplayAugmentations(h_list, 0)","def0c4dd":"def apply_augmentation(image_id):\n    \n    img = cv2.imread(os.path.join(BASE_DIR, \"train_images\", image_id))\n    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)\n    \n    coarse_dropout = A.CoarseDropout(p = 1.0, max_holes = 100, max_height = 50, max_width = 50, min_holes = 35, min_height = 10, min_width = 10)\n    clahe = A.CLAHE (clip_limit = 4.0, tile_grid_size=(8, 8), always_apply = False, p = 0.7)\n    c_crop = A.CenterCrop(600, 375, always_apply = False, p = 1.0)\n    gauss_noise = A.GaussNoise(var_limit=(10.0, 160.0), mean = 25, always_apply = False, p = 0.7)\n    distort = A.GridDistortion(always_apply = False, p = 1.0, num_steps = 6, distort_limit=(-0.40, 0.59), interpolation = 1, border_mode = 0, value = (0, 0, 0), mask_value = None)\n    h_flip = A.HorizontalFlip(always_apply = False, p = 1.0)\n    bright = A.RandomBrightness(always_apply = False, p = 1.0, limit=(-0.30, 0.43))\n    contrast = A.RandomContrast(always_apply = False, p = 1.0, limit=(-0.38, 0.30))\n    fog = A.RandomFog(always_apply = False, p = 1.0, fog_coef_lower=0.07, fog_coef_upper=0.26, alpha_coef = 1.0)\n    rain = A.RandomRain(always_apply = False, p = 1.0, slant_lower = 2, slant_upper = 4, drop_length = 7, drop_width = 1, drop_color = (0, 0, 0), blur_value = 1, brightness_coefficient = 0.97, rain_type = 'drizzle')\n    r_crop = A.RandomResizedCrop(always_apply = False, p = 1.0, height = 130, width = 229, scale = (0.08, 1.0), ratio = (0.75, 1.4), interpolation = 0)\n    rotate = A.RandomRotate90(always_apply = False, p = 1.0)\n    # To be tried - Cutout, Elastic Trnasform, ISONoise, HSV, MotionBlur , RandomSizedCrop, ShiftScaleRotate\n    \n    t_1 = coarse_dropout(image = img)[\"image\"]\n    t_2 = clahe(image = img)[\"image\"]\n    t_3 = c_crop(image = img)[\"image\"]\n    t_4 = gauss_noise(image = img)[\"image\"]\n    t_5 = distort(image = img)[\"image\"]\n    t_6 = h_flip(image = img)[\"image\"]\n    t_7 = bright(image = img)[\"image\"]\n    t_8 = contrast(image = img)[\"image\"]\n    t_9 = fog(image = img)[\"image\"]\n    t_10 = rain(image = img)[\"image\"]\n    t_11 = r_crop(image = img)[\"image\"]\n    t_12 = rotate(image = img)[\"image\"]\n        \n    return (img, t_1, t_2, t_3, t_4, t_5, t_6, t_7, t_8, t_9, t_10, t_11, t_12)","ec90e4c8":"def displayAAugmentations(l, index):\n    \n    augmentedImages = apply_augmentation(l[index])\n    plt.figure(figsize=(16, 12))\n    for i, imageName in zip(range(13), ['Input Image', 'Augmented - Coarse Dropout', 'Augmented - CLAHE', 'Augmented - Center Crop', 'Augmented - Gaussian Noise', 'Augmented - Distortion',\n                                      'Augmented - Horizontal Flip', 'Augmented - Brightness' , 'Augmented - Contrast', 'Augmented - Fog', 'Augmented - Rain', 'Augmented - ResizedCrop', 'Augmented - Rotation']):\n        ax = plt.subplot(4, 4, i + 1)\n        plt.imshow(augmentedImages[i].astype(\"uint8\"))\n        plt.title(imageName)\n        plt.axis(\"off\")","09766542":"print('Cassava Bacterial Blight Images')\ndisplayAAugmentations(cbb_list, 0)","15d42e27":"print('Cassava Brown Steak Disease Images')\ndisplayAAugmentations(cbsd_list, 0)","5e2a104a":"print('Cassava Green Mottle Images')\ndisplayAAugmentations(cgm_list, 0)","b786f5e4":"print('Cassava Mosaic Disease Images')\ndisplayAAugmentations(cmd_list, 0)","5855e9aa":"print('Healthy Leaf Images')\ndisplayAAugmentations(h_list, 0)","8513356c":"## Augmentations in Albumentations","7cbbe649":"## Reading the CSV file which has details on the images and lables","865c7242":"## Function for easy class-wise visualization","efdd467e":"## Random sampling","a75ff145":"## Visualization of Images - Class : Cassava Bacterial Blight (CBB)","da132ead":"## Mapping the label -> Class name","4a12f763":"# Exploring Data Augmentations\n\n## Augmentations in TensorFlow","6bbda291":"## Visualizing the distribution of data","adc1d4e0":"## This notebook is a culmination of various techniques explored by Kagglers - [ilovescience](https:\/\/www.kaggle.com\/tanlikesmath\/cassava-classification-eda-fastai-starter), [Kevin Joseph Scaria](https:\/\/www.kaggle.com\/kevinscaria\/cassava-leaf-disease-eda-modelling), [Yaroslav Isaienkov](https:\/\/www.kaggle.com\/ihelon\/cassava-leaf-disease-exploratory-data-analysis), [Aayush Jain](https:\/\/www.kaggle.com\/foolofatook\/starter-eda-cassava-leaf-disease)","3d1ff34c":"## Visualization of Images - Class : Cassava Green Mottle (CGM)","4fe734b1":"## Creating a mapping from image_id and label -> Path of the image (Usefull for segregating the images label wise in different folders)","e93b527e":"# Image Visualizations\n\n## Reading a single image and it's shape","167547a0":"## Visualization of Images - Class : Cassava Mosaic Disease (CMD)","ada69c13":"## Let's have a look at the class labels in the dataset i.e Disease Names","8477dde8":"## Visualization of Images - Class : Healthy (H)","b471b657":"## Visualization of Images - Class : Cassava Brown Steak Disease (CBSD)","91f8616d":"# Loading Data & Basic Visualization\n\n## Importing Libraries"}}