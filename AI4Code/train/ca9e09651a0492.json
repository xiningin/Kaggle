{"cell_type":{"dd62c3a7":"code","c9cc9c86":"code","080757d5":"code","592c1c9e":"code","360803e1":"code","3804ae2c":"code","95c97e75":"code","a61c2f12":"code","0b3dc411":"code","e39279a6":"code","05fdc173":"code","1bf1f3b2":"code","7a63326b":"code","4fa4b45f":"code","2eb8891f":"code","9a697d4d":"code","bbd3a45c":"code","4a27ca06":"code","4f597068":"code","762badb3":"code","23b2d84c":"code","c30758fc":"code","268cd753":"code","70a6396d":"code","80873a37":"code","02adc829":"code","bd0d6133":"code","4a33f936":"code","77e5af00":"code","731ad51c":"code","28447279":"code","036aa32e":"code","fb594c97":"code","5257d983":"code","af4801c3":"code","99d1922b":"code","64cfb3ee":"code","2b10d6ac":"code","39cc0fc0":"code","5118e512":"code","0e66eaa5":"code","b4608de2":"code","5910171a":"code","32670ef2":"code","e43cbf33":"code","d7f165f1":"code","dabf81c9":"markdown","d7df6390":"markdown","0c6e76c5":"markdown","77a90d50":"markdown","01923427":"markdown","b26404f2":"markdown","42b46bb2":"markdown","461d0c14":"markdown","1150c46f":"markdown","8a4ced48":"markdown","37c55173":"markdown","ffc2b58c":"markdown","98e789ae":"markdown","7e9fee87":"markdown","7f5630d1":"markdown","b94beddd":"markdown","aca04608":"markdown","4b82edea":"markdown"},"source":{"dd62c3a7":"# import packages\nimport datetime\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n#from mpl_toolkits.basemap import Basemap\n\n%matplotlib inline","c9cc9c86":"# import data\nbs_reviews = pd.read_csv(\"..\/input\/reviews.csv\")\nbs_reviews.head()","080757d5":"bs_listing = pd.read_csv(\"..\/input\/listings.csv\")\nbs_listing.head(2)","592c1c9e":"# have a closer look at listing data\nbs_listing.info()","360803e1":"bs_calendar = pd.read_csv(\"..\/input\/calendar.csv\")\nbs_calendar.head()\nbs_calendar.info()\n","3804ae2c":"# str to datetime\nto_datetime = lambda x: datetime.datetime.strptime(str(x),'%Y-%m-%d')\n# remove sign\ndef remove_sign(x,sign):\n    if type(x) is str:\n        x = float(x.replace(sign,'').replace(',',''))\n    return x","95c97e75":"# clean calendar data\n## change column 'date' data type from 'object' to 'datetime'\nbs_calendar.date = bs_calendar.date.apply(to_datetime)\n## remove '$' sign from price\nbs_calendar.price = bs_calendar.price.apply(remove_sign,sign='$')\nbs_calendar.info()","a61c2f12":"# clean listing data\nbs_listing.host_since = bs_listing.host_since.apply(to_datetime)\nbs_listing.price = bs_listing.price.apply(remove_sign,sign='$')\nbs_listing.host_response_rate = bs_listing.host_response_rate.apply(remove_sign,sign='%')\nbs_listing.host_acceptance_rate = bs_listing.host_acceptance_rate.apply(remove_sign,sign='%')","0b3dc411":"bs_listing.info()","e39279a6":"# total number of available home each day\navaliable_count_bs = bs_calendar.groupby('date').apply(lambda x: x.notnull().sum())[['price']]\n# change column name\navaliable_count_bs = avaliable_count_bs.rename({\"price\":\"total_available_houses\"},axis='columns')","05fdc173":"# everyday average prices\nbs_calendar_open = bs_calendar[bs_calendar.price.notnull()]\n# average house price for boston everyday\naverage_price_bs = bs_calendar_open.groupby('date').mean()[['price']]\n# change column name\naverage_price_bs = average_price_bs.rename({\"price\":\"average_prices\"},axis='columns')","1bf1f3b2":"# plot total available houses and average prices in one figure\nf, ax = plt.subplots(figsize=(15, 6))\nplt1 = sns.lineplot(x = avaliable_count_bs.index,y = 'total_available_houses', \n                  data = avaliable_count_bs,color=\"r\",legend=False)\nfor tl in ax.get_yticklabels():\n    tl.set_color('r')\n\nax2 = ax.twinx()\nplt2 = sns.lineplot(x = average_price_bs.index,y = 'average_prices',\n             data=average_price_bs,ax=ax2,linestyle=':', legend=False)","7a63326b":"# take a closer look at the price spike before 05\/2017\naverage_price_bs_sub = average_price_bs[average_price_bs.index > '2017-03-1']\naverage_price_bs_sub[average_price_bs_sub.average_prices == max(average_price_bs_sub.average_prices)]","4fa4b45f":"# average avaliablity for each house\navaliable_days_bs = bs_calendar.groupby('listing_id').apply(lambda x: x.notnull().mean())[['price']]\n# change column name\navaliable_days_bs = avaliable_days_bs.rename({\"price\":\"avaliable_ratio\"},axis='columns')","2eb8891f":"#avaliable_days_bs.head()\nf, ax = plt.subplots(figsize=(15, 6))\nax = sns.distplot(avaliable_days_bs, kde=False)\nax.set_xlabel('avaliable ratio', fontsize=10)\nax.set_ylabel('count', fontsize=10)\n# a large portion of houses are available for a small portion of days","9a697d4d":"# check general price distribution\nbs_calendar_open.describe()","bbd3a45c":"sns.distplot(bs_calendar_open.price, kde=False)\n# price large than 1000 is pretty rare","4a27ca06":"# visualize price change pattern for a particular listing \nlist_price_eg = bs_calendar_open[bs_calendar_open.listing_id == 14421304]\nsns.lineplot(x=\"date\",y=\"price\", data=list_price_eg)","4f597068":"# host since house count\nbs_cumhost = bs_listing.groupby('host_since').count()[['id']]\n# change column name\nbs_cumhost = bs_cumhost.rename({\"id\":\"house_num\"},axis='columns')","762badb3":"# get cumulative house numbers\nbs_cumhost['cum_house_num'] = bs_cumhost.house_num.cumsum()\nbs_cumhost.head()","23b2d84c":"f, ax = plt.subplots(figsize=(12, 9))\nsns.lineplot(data=bs_cumhost)","c30758fc":"# creat year_month column to group district growth into year_month period\nbs_listing['year_month'] = bs_listing.host_since.dt.to_period('M')","268cd753":"def cum_listing_for_cat(colname,bs_listing=bs_listing):\n    '''\n    This function is used to get the cummulative listing on different categorys over year_month\n    \n    INPUT:\n    colname - str, the categorical column you want to cummulate\n    bs_listing - data.frame,bs listing data\n    \n    OUTPUT:\n    df - a new dataframe that has the following columns:\n            1. year_month\n            2. colname,indicate category\n            3. cum_listings\n    '''\n    col_listnum = bs_listing.groupby(['year_month',colname]).count()[['id']]\n    col_listnum.reset_index(inplace=True)\n    # calculate cumulative listing for each category\n    col_listnum = col_listnum.sort_values(by=[colname,'year_month'])\n    col_listnum['cumnum'] = col_listnum.groupby(by=[colname])['id'].apply(lambda x: x.cumsum())\n    # drop unneeded column\n    col_listnum.drop(['id'],inplace=True,axis=1)\n    # long to wide\n    # notice that for each category there are some year_month without any record\n    # need to flattern the data make sure every neighborhood has all the year_month record.\n    # fill na with the last non na value\n    col_listnum_wide = col_listnum.pivot('year_month', colname)\n    col_listnum_wide = col_listnum_wide.fillna(method='ffill')\n    col_listnum_wide = col_listnum_wide.fillna(0)\n    # rename columns prepare for wide to long\n    col_listnum_wide.rename(columns=lambda x: 'col_'+x, inplace=True)\n    # reset index\n    col_listnum_wide.reset_index(inplace=True)\n    # remove first row\n    col_listnum_wide_clean = col_listnum_wide['col_cumnum']\n    col_listnum_wide_clean['year_month'] = col_listnum_wide['year_month']\n    # change this wide data to long again for drawing figures\n    col_listnum_wide_long = col_listnum_wide_clean.melt('year_month', var_name='cols',  value_name='vals')\n    col_listnum_wide_long = col_listnum_wide_long.rename(columns={\"cols\": colname, \"vals\": \"cum_listings\"})\n    return col_listnum_wide_long","70a6396d":"neighbor_cum_listing = cum_listing_for_cat('neighbourhood_cleansed',bs_listing=bs_listing)\nneighbor_cum_listing.head()","80873a37":"f, ax = plt.subplots(figsize=(20, 9))\n# change year_month column from type datetime to str to draw figure\nneighbor_cum_listing.year_month = neighbor_cum_listing.year_month.apply(lambda x:str(x))\n# make sure legend order is ordered by cum listing values\nlast_date = neighbor_cum_listing[neighbor_cum_listing.year_month==max(neighbor_cum_listing.year_month)]\nhue_order = last_date.sort_values(by=['cum_listings'],ascending=False)['neighbourhood_cleansed']\ng=sns.lineplot(x='year_month',y='cum_listings',hue='neighbourhood_cleansed', hue_order =hue_order ,\n               data=neighbor_cum_listing)\ng=g.set_xticklabels(neighbor_cum_listing.year_month.unique(),rotation=90)","02adc829":"# how different price level homes increase in numbers over the years?\n# first see price distribution\nbs_listing.price.describe()","bd0d6133":"# use 25% price value as low price bar; 75% price value as high price bar\ndef price_level(x,low_bar=85,high_bar=220):\n    if x<=low_bar:\n        x='Low_Price'\n    elif x>=high_bar:\n        x='High_Price'\n    else:\n        x='Medium_Price'\n    return x\nbs_listing['price_level'] = bs_listing.price.apply(price_level)","4a33f936":"price_level_listnum_wide_long = cum_listing_for_cat('price_level',bs_listing=bs_listing)","77e5af00":"f, ax = plt.subplots(figsize=(20, 9))\n# change year_month column from type datetime to str to draw figure\nprice_level_listnum_wide_long.year_month = price_level_listnum_wide_long.year_month.apply(lambda x:str(x))\ng=sns.lineplot(x='year_month',y='cum_listings',hue='price_level',style='price_level',\n               data=price_level_listnum_wide_long)\ng=g.set_xticklabels(price_level_listnum_wide_long.year_month.unique(),rotation=90)","731ad51c":"# select price and ratings and dropna\nbs_price_rate = bs_listing[[\"id\",\"price\",\"review_scores_rating\",\"number_of_reviews\",\"price_level\"]].dropna()\nbs_price_rate.head()","28447279":"f, ax = plt.subplots(figsize=(15, 6))\nsns.scatterplot(x='price',y='review_scores_rating',hue='number_of_reviews',alpha=0.5,data=bs_price_rate)","036aa32e":"price_level_review_num = bs_price_rate.groupby('price_level').mean()\nprice_level_review_num","fb594c97":"bs_price_rate.describe()","5257d983":"# find the listing with the highest number of reviews\nmax_id = bs_price_rate[bs_price_rate.number_of_reviews == max(bs_price_rate.number_of_reviews)]\nmax_id","af4801c3":"# info of this listing\nbs_listing[bs_listing.id== 66288].T","99d1922b":"bs_calendar[bs_calendar.listing_id==66288 ].count()","64cfb3ee":"# keep listings with not null prices\nbs_listing_price = bs_listing[bs_listing.price.notnull()]","2b10d6ac":"def plot_price_by_cat(colname,bs_listing=bs_listing,fig_row_size=11,fig_col_size=9):\n    price_col = bs_listing_price.groupby(colname).mean()[['price']]\n    price_col.reset_index(inplace=True)\n    f, ax = plt.subplots(figsize=(fig_row_size, fig_col_size))\n    sns.barplot(y=colname,x='price',data=price_col.sort_values(by='price', ascending=False))","39cc0fc0":"# price and neighborhood\nplot_price_by_cat('neighbourhood_cleansed',bs_listing=bs_listing_price)","5118e512":"plot_price_by_cat('property_type',bs_listing=bs_listing_price)","0e66eaa5":"plot_price_by_cat('host_response_time',bs_listing=bs_listing_price,fig_row_size=10,fig_col_size=8)","b4608de2":"# price and bed_type\nfig = plt.figure(figsize=(12, 8))\nax1 = fig.add_subplot(121)\nax2 = fig.add_subplot(122)\nprice_bed_type = bs_listing_price.groupby('bed_type').mean()[['price']]\nprice_bed_type.reset_index(inplace=True)\nsns.barplot(x='bed_type',y='price',data=price_bed_type.sort_values(by='price', ascending=False),ax=ax1)\n# price and bed_type\nprice_room_type = bs_listing_price.groupby('room_type').mean()[['price']]\nprice_room_type.reset_index(inplace=True)\nsns.barplot(x='room_type',y='price',data=price_room_type.sort_values(by='price', ascending=False),ax=ax2)","5910171a":"# see how numerical values correlate with price\nbs_listing_price_num = bs_listing_price.select_dtypes(include=['float64','int'])","32670ef2":"bs_listing_price_num.info()","e43cbf33":"# drop irrelevent colunms\nbs_listing_price_num = bs_listing_price_num.drop(['id','scrape_id','host_id','latitude','longitude',\n                                                  'jurisdiction_names','neighbourhood_group_cleansed',\n                                                  'license','has_availability','neighbourhood_group_cleansed'], axis=1)","d7f165f1":"corr = bs_listing_price_num.corr()\nmask = np.zeros_like(corr, dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\ncmap = sns.diverging_palette(220, 10, as_cmap=True)\nf, ax = plt.subplots(figsize=(11, 9))\nsns.heatmap(corr,mask=mask, cmap=cmap, vmax=.3, center=0,\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5})","dabf81c9":"**Figure Findings**\n1. low ratings are associate with lower prices.\n2. however high rating dose not mean high price","d7df6390":"**Figure Findings**\n1. Cummulativ house numbers grows exponentially","0c6e76c5":"**Figure Findings**\n1. Most Boston host just list their homes for a small portion of year.","77a90d50":"**Table Findings**\n1. Aha, this timing is interesting becasue boston marathon of 2017 was held on 04-17,so there is strong evidence this sudden spike of price is due to the marathon event.","01923427":"## General trend","b26404f2":"**Figure Findings**\n1. District with the most listings is Jamaica Plain\n2. And Jamaica Plain wasn't the district with most listings in early years.\n3. Some district remain low listings over the years.","42b46bb2":"#### Airbnb Boston Data Anaylysis\n\nIn this notebook I look into Airbnb Boston Data to explore its business growth, prices, availability and ratings.\n\nThe data is obtained from Kaggle(https:\/\/www.kaggle.com\/airbnb\/boston) and it contain three data files:\n1. calendar data: home availability data from September 2016 to September 2017.\n2. listing data: home information data from January 2016 to January 2017 on 3,818 homes.\n3. reviews data: house reviews between June 2009 and January 2016.\n\nThe question I try to answer in this notebook include:\n\n1. What\u2019s the home availability pattern?\n2. What\u2019s the business growth trend ?\n3. How price and rating relate with each other?\n4. What\u2019s the major factor that influence price and ratings?\n\nAnd the findings are presented also in this blog: https:\/\/medium.com\/@haataa\/interesting-facts-you-want-to-know-about-airbnb-boston-insight-behind-data-4c4bd4a40b74","461d0c14":"# Q1: What\u2019s the home availability pattern?","1150c46f":"**Figure Findings**\n\nTotal available houses:\n1. Availability is not stable all year round.\n2. Increase from Sep to Nov.\n3. Remain relatively stable from 01\/2017-09\/2017, although the reason why there are two sudden drop of home supply is unclear.\n\nAverage prices:\n1. Price drop as home supply increase from 09\/2016 to 12\/2016.\n2. The sudden drop of supply in 03\/2017 dose not drive price up;However the sudden drop of supply before 05\/2017 just rocket price up. So I guess it has something to do with demand change.\n3. There seems to have a small periodical price moving circle and this maybe correspond to weekends.","8a4ced48":"## Price Level Trend","37c55173":"**Figure Findings**\n1. Medium price homes grew faster than the other groups in terms of total listing numbers.\n2. At early years it was high price listings that had the most listings.","ffc2b58c":"# Q3: How price and rating relate with each other?","98e789ae":"# Clean Data","7e9fee87":"# Introduction","7f5630d1":"## District Trend","b94beddd":"# Q2: What\u2019s the business growth trend?","aca04608":"# Gather And Assess Data","4b82edea":"# Q4: What\u2019s the major factor that influence price and ratings?"}}