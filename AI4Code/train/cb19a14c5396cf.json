{"cell_type":{"52c6a762":"code","dea2b810":"code","ba87a28f":"code","a7c694b7":"code","4b22fdee":"code","f6647698":"code","e5b0260c":"code","2a733c0c":"code","4f01faac":"code","f1f82ab7":"code","10563bad":"code","e34b58ab":"code","e39f1b8b":"code","3fa29121":"code","98ea4339":"code","0e4128f0":"code","3d15731d":"code","35b626da":"code","5350d4ba":"code","c592acf6":"code","2df0a6dd":"code","3e741731":"code","3fb8adc7":"code","2245cee9":"code","a1665387":"code","4e7210e5":"code","1ce89578":"code","04474eb6":"code","66139ee3":"code","2bf105c1":"code","d01c2e66":"code","56e21ced":"code","a047d806":"code","43195e9d":"markdown","c3045bcf":"markdown","d0c2e1fc":"markdown","b39cc83f":"markdown","937ae53d":"markdown","e44a7447":"markdown","3f43b52d":"markdown","c7d64e95":"markdown","d34815af":"markdown","4759c665":"markdown","95214875":"markdown","e7a55038":"markdown","678c3642":"markdown","8b760556":"markdown","19e15101":"markdown","1780cf95":"markdown","21db1d2f":"markdown","a07a2a5f":"markdown","ea08a5dc":"markdown","b45d0469":"markdown","d0b95f89":"markdown","61e66d0e":"markdown","bc1859cc":"markdown","d6531605":"markdown","fa5b2176":"markdown","3fc6b505":"markdown","6351de57":"markdown","ede5492d":"markdown","6bf36203":"markdown","444998e1":"markdown","fb9f1d89":"markdown","696e613e":"markdown","fb6900c9":"markdown","06a398e1":"markdown","9524cba9":"markdown","3b782e22":"markdown"},"source":{"52c6a762":"import numpy as np # Linear Algebra\nimport pandas as pd # Data Processing\nimport sqlite3 # Sqlite\nimport plotly.express as ex\nimport matplotlib.pyplot as plt \nimport seaborn as sns # Data Visualization\nimport os\n\nprint(\"Import complete\")\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(\"Current Directory: {}\".format(os.path.join(dirname, filename)))","dea2b810":"con=sqlite3.connect('..\/input\/california-traffic-collision-data-from-switrs\/switrs.sqlite')","ba87a28f":"drivers = []\nfor chunked_drivers in pd.read_sql_query(\"SELECT * FROM parties WHERE party_type='driver'\", \n                                               con, \n                                               chunksize=100000):\n    drivers.append(chunked_drivers.copy())\ncon.close()","a7c694b7":"print(\"Number of chunks: {}\".format(len(drivers)))\nfor chunk in drivers:\n      print(chunk.shape)","4b22fdee":"drivers[0].sample(10)","f6647698":"missing_val_count_by_column = []\nfor i in range(len(drivers)):\n    missing_val_count_by_column.append((drivers[i].isnull().sum()))","e5b0260c":"for i in range(len(missing_val_count_by_column)):\n    print(\"Chunk number {} Missing values:{} \\n\".format(i+1,missing_val_count_by_column[i]>70000))","2a733c0c":"Drivers = []\nfor i in range(len(drivers)):\n    Drivers.append(drivers[i].drop([\"hazardous_materials\", \"school_bus_related\", \"oaf_violation_code\", \"oaf_violation_category\", \"oaf_violation_section\", \"oaf_violation_suffix\", \"other_associate_factor_2\", \"party_drug_physical\"], axis=1))","4f01faac":"for chunk in Drivers:\n    print(chunk.shape)","f1f82ab7":"Drivers[0].sample(10)","10563bad":"Drivers[0].describe()","e34b58ab":"probablyMissing = []\nfor i in range(len(Drivers)):\n    probablyMissing.append((Drivers[i].loc[Drivers[i]['party_age'] == 0]))","e39f1b8b":"probablyMissing = pd.concat(probablyMissing)","3fa29121":"print(probablyMissing.shape)","98ea4339":"under_age = []\nfor i in range(len(Drivers)):\n    under_age.append((Drivers[i].loc[Drivers[i]['party_age'].between(10, 16)]))","0e4128f0":"under_age = pd.concat(under_age)","3d15731d":"print(under_age.shape)","35b626da":"age1 = pd.DataFrame(Drivers[0].party_age, dtype='float32')","5350d4ba":"age2 = pd.DataFrame(Drivers[4].party_age, dtype='float32')","c592acf6":"ages1 = pd.DataFrame(age1, columns=['party_age'])\nbins = [16, 24, 30, 40, 50, 60, 70, 120]\nlabels = ['16-24', '25-29','30-39', '40-49', '50-59', '60-69', '70+']\nages1['range'] = pd.cut(ages1.party_age, bins, labels = labels,include_lowest = True)\n","2df0a6dd":"ages2 = pd.DataFrame(age2, columns=['party_age'])\nages2['range'] = pd.cut(ages2.party_age, bins, labels = labels,include_lowest = True)","3e741731":"sns.countplot(x='range',data=ages1, palette=\"vlag\")","3fb8adc7":"sns.countplot(x='range',data=ages2, palette=\"rocket\")","2245cee9":"print(missing_val_count_by_column)","a1665387":"sns.countplot(x=Drivers[0].party_sobriety, palette=\"rocket\")","4e7210e5":"sns.countplot(x=Drivers[5].party_sobriety, palette=\"rocket\")","1ce89578":"notSober = Drivers[0].loc[Drivers[0]['party_sobriety'] == \"B\"]","04474eb6":"plt.figure(figsize=[28,16])\nsns.distplot(notSober.party_age, kde=False)\nplt.title(\"Not sober drivers\")\nplt.show()","66139ee3":"ex.pie(notSober, names=\"party_age\")","2bf105c1":"Race = pd.DataFrame(Drivers[0].party_race, columns=['party_race'])","d01c2e66":"sns.countplot(x='party_race',data=Race)","56e21ced":"gender = pd.DataFrame(Drivers[0].party_sex, columns=['party_sex'])","a047d806":"sns.countplot(x='party_sex',data=gender)","43195e9d":"From this data we can see that 163337 accidents included **children as drivers**! This is a serious issue.\n(Driving legal age in california is 16 years old). Source: https:\/\/www.dmv.ca.gov\/portal\/handbook\/california-driver-handbook\/special-section-minors\/)","c3045bcf":"Does race have anything to do with accidents?","d0c2e1fc":"### Next, we will treat sobriety.","b39cc83f":"We can see that the same features with missing values repeat in each chunk, anyways we won't be studying these features so dropping them won't hurt our data.","937ae53d":"We have **1392384+1316** missing values, before deciding on what method we should use to treat these missing values, let's visualize what are the age groups that are the most frequent.","e44a7447":"We can see that drivers that are aged between 19-26 are the most frequent.","3f43b52d":"From these count plots, it can be seen that the drivers that are in the age range (16-24) are the most frequent drivers in accidents, eventhough this group age doesn't have the highest number of licensed drivers(2018 data). \nSource : https:\/\/www.fhwa.dot.gov\/ohim\/onh00\/bar7.htm. \nAge range groups between 30-49 comes in the second place as the most frequent group age in accidents.","c7d64e95":"# **Drivers Analysis**","d34815af":"White and hispanic people cause more accidents, but according to 2019 U.S. Census Bureau Estimates of USA.\n#### population race:\n\nNon-Hispanic white \t60.1%\nHispanic and Latino 18.5%\nBlack or African American 13.4%\nAsian 5.9%\nTwo or more races 2.8%\nNative Americans and Alaska Natives 1.3%\nNative Hawaiians and Other Pacific Islanders 0.2%\n    \n39% of state residents are Latino, 37% are white, 15% are Asian American, 6% are African American, 3% are multiracial, and fewer than 1% are American Indian or Pacific Islander, according to the 2018 American Community Survey. so this variabe is irrelevant and can't add information to the data.","4759c665":"We will concatenace the chunks to one dataframe:","95214875":"I tried to concatenate these chunks into one dataframe but I kept running out of RAM again so I will work with it like that. (I would love a better solution)","e7a55038":"## Gender","678c3642":"We can see that we have 1316 rows(drivers) that have age as 0, the only assumption I can come up with is that these values are missing.","8b760556":"Now we will be treating 23 columns, let's take a look at a sample.","19e15101":"If we fill the missing values with the mean age (37), it will affect the results of most frequent drivers in accidents, it may lead to some bias in the model, so dropping these rows with age missing values is the best option if we want to create a model.","1780cf95":"What about gender? according to www.fhwa.dot.gov, the number of licensed male drivers in 2017 is 13,624,228, and licensed female drivers is 13,152,904, it is nearly the same number of drivers among both genders, so this feature will be critical to understand what gender causes more accidents.","21db1d2f":"![car%20accidents.jpg](attachment:car%20accidents.jpg)","a07a2a5f":"First, let's connect to the database.","ea08a5dc":"## Race","b45d0469":"We have nearly 16 million drivers in our dataset, 100,000 in each chunk, we will drop the features that have more than 70% missing values: 70,000 missing values in each chunk.\nSo let's count the missing values in each column.","d0b95f89":"## Conclusions:\n\n* Men are parties of more accidents than females.\n* 163337 accidents included **children as drivers** in california.\n* Most drivers weren't drunk.\n* 16-24 group age is the most frequent party in accidents.","61e66d0e":"* Can we know what type of drivers cause more accidents? Based on gender, age, and sobriety?\n* Is alcohol the main reason drivers crash?\n* What are the factors that increase the chance that a driver would cause an accident?\n\nWe will try to answer these questions in this notebook.","bc1859cc":"We can clearly see that most of missing values in party_age column varies between 9000 and 10000 (less than 10%), I can think of three approaches:\n1. Drop rows that have age missing values.\n2. Fill the missing values with the mean or median age.\n3. Create a regression model to predict the age based on other features.","d6531605":"We will select only the drivers rows from \"parties\" table. \nSince I kept running out of memory when I try to load the drivers rows from parties table, I will load the data into chunks.","fa5b2176":"The missing values of this feature probably won't make any difference since the number of male drivers in accidents is nearly the double of female drivers. So we can conclude that men cause more accidents (or are parties of accidents more than females).\nThis can be because most of public transportation drivers are men, but we can never assume, so the only conculsion we can have for now is that men are parties of more accidents than females.","3fc6b505":"We can see that most of accidents, the drivers weren't drunk or under influence.","6351de57":"From this result, we should drop these columns: *\"hazardous_materials\", \"school_bus_related\", \"oaf_violation_code\", \"oaf_violation_category\", \"oaf_violation_section\", \"oaf_violation_suffix\", \"other_associate_factor_2\", \"party_drug_physical\"*","ede5492d":"From the first glance at a random sample, we can see that we have a lot of missing values, in order to understand the data better, we have to treat these missing values.","6bf36203":"The minimum age is 0, which is impossible since we are only treating drivers. before making a decision about these rows, let's see how many 0-16 years old we have.","444998e1":"We can see that we have 164 chunks in our drivers list, each chunk contains 100000 rows except the last chunk that contains 60526 rows.","fb9f1d89":"Each letter has a meaning, here is the dictionary:\n\n    A - Had Not Been Drinking\n    B - Had Been Drinking, Under Influence\n    C - Had Been Drinking, Not Under Influence\n    D - Had Been Drinking, Impairment Unknown\n    G - Impairment Unknown\n    H - Not Applicable\n    - - Not Stated\n","696e613e":"In this notebook, we will load the parties table where party_type = \"drivers\", ","fb6900c9":"Now le'ts visualize how old are people that are accident parties while not sober","06a398e1":"The third solution is not guaranteed since we don't have features that can help predict the age of a person. before filling the missing values with the mean age, let's visualize the age groups most frequent.","9524cba9":"Now we have to take care of other missing values, we will start by the age variable.","3b782e22":"Welcome to this notebook! We will analyze the drivers in accidents to understand more what are the common factors that cause accidents."}}