{"cell_type":{"80da71c8":"code","a1d6934b":"code","3f6a054c":"code","7aca790f":"code","a05f5b12":"code","885a1d62":"code","d97d9933":"code","6f9161d4":"code","275eb51b":"code","bbe294eb":"code","3f53c1ef":"code","dcc64596":"code","50b72236":"code","7c2b8ced":"code","414502d1":"code","a76251fb":"code","637eaae4":"code","1d442186":"code","aab9d388":"code","b621a3bf":"code","b8cc709b":"code","915791bb":"code","9f5edd17":"code","37cb3ae2":"code","de6a0b2e":"code","2bc7cf3f":"code","7b2c94b8":"code","04b2f2d8":"code","8f2d5032":"code","3f19383b":"code","0012ce0f":"code","4baec264":"code","ee5c725c":"code","c8de0840":"code","12092c1a":"code","a493ff64":"code","fd2cc0d6":"code","30a2bf1e":"code","6cc1b576":"code","865f1b4f":"code","5f8b0e64":"code","b8bb658c":"code","da8dfd20":"code","691b5360":"code","b3fc670b":"code","c9555fc6":"code","c8a4049d":"code","eb2d48de":"code","0dba4212":"code","0d279213":"code","ddc2dd8a":"code","3a6badd1":"code","b69cd04b":"code","8aff5c9d":"code","53149938":"code","7dfce2fe":"code","26aaa568":"code","533f0c44":"code","f5531e80":"code","45509cbf":"code","6cad15db":"markdown","0bc8a712":"markdown","8eb57e92":"markdown","3c00e47f":"markdown","3f13c677":"markdown","1d72891e":"markdown","ed582bdd":"markdown","853c8fe2":"markdown","e46af464":"markdown","43a8546b":"markdown","1d5520e8":"markdown","9666f004":"markdown","ab6f6de7":"markdown","101cad73":"markdown","d478b673":"markdown","f9411b8f":"markdown","ab41daca":"markdown","380cb2b0":"markdown","eccecdf0":"markdown","98016d91":"markdown","e1565c46":"markdown","cc62a52b":"markdown","04fcaeef":"markdown","49c89136":"markdown","3f5f81a3":"markdown","2ccb7ad6":"markdown","8f1ee0ea":"markdown","35272fbd":"markdown","d7d92fe5":"markdown","2882b672":"markdown","fa53421a":"markdown","65b82aa2":"markdown","de49cc0d":"markdown","8b9b92d9":"markdown","81ec65f1":"markdown","5f8e01bd":"markdown","2eada0a4":"markdown","dbc5bf17":"markdown","6eff428b":"markdown","7013e020":"markdown","282f938b":"markdown","e50fc013":"markdown","f9e58ab9":"markdown","4dcba9b9":"markdown","b37d3666":"markdown","af18e23c":"markdown","02221660":"markdown","2762b9b8":"markdown","028098b3":"markdown","4e00b87a":"markdown","32fcb3aa":"markdown","2b92f3dd":"markdown"},"source":{"80da71c8":"# Library for DataFrame and Data manipulation\nimport pandas as pd\n# Matrix operations and statistical functions\nimport numpy as np\n# Plotting and dependency for seaborn\nimport matplotlib.pyplot as plt\n# Graphs and chart used in this notebook\nimport seaborn as sns\n# to convert categorical values into numerical value\nfrom sklearn.preprocessing import LabelEncoder\n# these imports are self explanatory\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.discriminant_analysis import LinearDiscriminantAnalysis\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.svm import SVC","a1d6934b":"# Reading Data from csv file\ndata = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\n","3f6a054c":"data.head()","7aca790f":"# Describe some stats of numerical features apperantly there should be  numerical features\ndata.describe()","a05f5b12":"# Describe data type of the features , or the type of value they contain\ndata.info()","885a1d62":"# There are some missing values in 'TotalCharges' but insted of representing it by 'NAN' it represents it by blank space\ndata[data['TotalCharges']==' ']","d97d9933":"# extracting index of rows where TotalCharges has a white space \nws = data[data['TotalCharges']==' '].index\n# removing all those rows whose index have been extracted just now\ndata.drop(ws,axis=0,inplace=True)\n# converting 'TotalCharges' data type from object to float, because it contains real values\ndata['TotalCharges'] = data.TotalCharges.astype('float')","6f9161d4":"# standardization , all values will me subtracted by column's mean and divided by cloumn's standard deviation\ndef standardized(data,col):\n    mean = data[col].mean()\n    std = data[col].std()\n    data[col] = (data[col]-mean)\/std\n    \n","275eb51b":"# this function is to plot countplot, since majority of features are categorical, i would stick to countplot most of the time\ndef plot_comparison(col,val,some=None):\n    sub_data = data[data[col]==val]\n    value = sub_data[sub_data['Churn']=='Yes']\n    print('In '+str(col)+' = '+str(val)+' , it is {:.2f} % likely that customer will leave'.format((len(value)\/len(sub_data)*100)))\n    sns.countplot(sub_data['Churn'],palette=\"bright\",ax=some)","bbe294eb":"data","3f53c1ef":"sns.countplot(data['Churn'])\nprint(len(data[data['Churn']=='Yes'])\/len(data)*100)","dcc64596":"data = data.drop('customerID',axis=1)","50b72236":"\nfig,ax1 = plt.subplots(figsize=(12,6))\nsns.countplot(x='gender',data=data,hue='Churn')\n","7c2b8ced":"sns.countplot(data['SeniorCitizen'])","414502d1":"plot_comparison('SeniorCitizen',1)","a76251fb":"plot_comparison('SeniorCitizen',0)","637eaae4":"# no. of non-senior citizen churning\ndata['SeniorCitizen'].value_counts()[0]*23\/100","1d442186":"# no. of senior citizen churning\ndata['SeniorCitizen'].value_counts()[1]*45\/100","aab9d388":"fig,ax1 = plt.subplots(1,3,figsize=(12,4))\n# A pie plot to show the share of Yes and No \ndata['Partner'].value_counts().plot(kind='pie')\n# first plot from right shows no. of Potential Churners among Partner = 'Yes' category \nplot_comparison('Partner','Yes',ax1[0])\n# plot in middle shows no. of Potential Churners among Partner = 'No' category \nplot_comparison('Partner','No',ax1[1])","b621a3bf":"fig,ax1 = plt.subplots(1,3,figsize=(12,4))\ndata['Dependents'].value_counts().plot(kind='pie')\nplot_comparison('Dependents','Yes',ax1[0])\nplot_comparison('Dependents','No',ax1[1])","b8cc709b":"# No. of Non-dependent churning\ndata['Dependents'].value_counts()[0]*31.28\/100","915791bb":"sns.catplot(hue='Partner',x='Dependents',col='Churn',kind=\"count\",data=data)","9f5edd17":"#distribution plot\nsns.distplot(data['tenure'],rug=False,hist=False)","37cb3ae2":"# to check mean,standard deviation,Qurtile and minimum maximum value in this feature \ndata['tenure'].describe()","de6a0b2e":"sns.boxplot(y=data['tenure'],x=data['Churn'])","2bc7cf3f":"# all rows where Churn=='Yes'\nchurn = data[data['Churn']=='Yes'] \n# Finding first and third quartile\nQ1,Q3 = churn['tenure'].quantile([.25,.75])\n# Inter Quartile range\nIQR = Q3-Q1\n# all the values greater than Q3+1.5*IQR and less than Q1-1.5*IQR are considered outliers \noutliers = Q3+1.5*IQR\noutliers","7b2c94b8":"data['tenure'].max()","04b2f2d8":"# A scatter plot between every Numerical variable in the dataset\nsns.pairplot(data)","8f2d5032":"data","3f19383b":"fig,ax1 = plt.subplots(1,3,figsize=(12,4))\nplot_comparison('PhoneService','Yes',ax1[1])\nplot_comparison('PhoneService','No',ax1[2])\nsns.countplot(data['PhoneService'],ax=ax1[0])","0012ce0f":"data['MultipleLines'] = data['MultipleLines'].map(lambda x: 'Yes' if x=='Yes' else 'No')\n\nfig,ax1 = plt.subplots(1,3,figsize=(12,4))\nplot_comparison('MultipleLines','Yes',ax1[1])\nplot_comparison('MultipleLines','No',ax1[2])\n\nsns.countplot(data['MultipleLines'],ax=ax1[0])","4baec264":"# Preparing Contingency table for Chi_square test \nyes = data[data['MultipleLines']=='Yes']\nno = data[data['MultipleLines']=='No']\nyyes = len(yes[yes['PhoneService']=='Yes'])\nyno = len(yes[yes['PhoneService']=='No'])\nnyes = len(no[no['PhoneService']=='Yes'])\nnno = len(no[no['PhoneService']=='No'])\ntable = [[yyes,yno],[nyes,nno]]","ee5c725c":"# H0 : two features are dependent\n# H1 : two features are Independent\nfrom scipy.stats import chi2_contingency\nfrom scipy.stats import chi2\n# Observed Frequency table\nprint('Table :',table)\n\nstat, p, dof, expected = chi2_contingency(table)\n# (nrows-1)*(ncols-1) in our case (2-1)*(2-1) = 1\nprint('degree of Freedom=%d' % dof)\n# Expeceted Frequency table\nprint(\"Expected :\",expected)\n\nprob = 0.95\n# tabulated value of chi-square at 5% of significance \ncritical = chi2.ppf(prob, dof)\nprint('probability=%.3f, critical=%.3f, stat=%.3f' % (prob, critical, stat))\nif abs(stat) >= critical:\n    print('Dependent (reject H0)')\nelse:\n    print('Independent (fail to reject H0)')\n# interpret p-value\nalpha = 1.0 - prob\nprint('significance=%.3f, p=%.3f' % (alpha, p))\nif p <= alpha:\n    print('Dependent (reject H0)')\nelse:\n    print('Independent (fail to reject H0)')","c8de0840":"data['InternetService'].value_counts()","12092c1a":"fig,ax1 = plt.subplots(2,2,figsize=(12,10))\nsns.countplot(data['InternetService'],ax=ax1[0,0])\nplot_comparison('InternetService','DSL',ax1[0,1])\nplot_comparison('InternetService','Fiber optic',ax1[1,0])\nplot_comparison('InternetService','No',ax1[1,1])","a493ff64":"sns.catplot(hue='InternetService',x='PhoneService',col='Churn',kind=\"count\",data=data)","fd2cc0d6":"fig,ax1 = plt.subplots(2,2,figsize=(12,10))\nsns.countplot(data['OnlineSecurity'],ax=ax1[0,0])\nplot_comparison('OnlineSecurity','Yes',ax1[0,1])\nplot_comparison('OnlineSecurity','No',ax1[1,0])\nplot_comparison('OnlineSecurity','No internet service',ax1[1,1])","30a2bf1e":"fig,ax1 = plt.subplots(2,2,figsize=(12,10))\nsns.countplot(data['OnlineBackup'],ax=ax1[0,0])\nplot_comparison('OnlineBackup','Yes',ax1[0,1])\nplot_comparison('OnlineBackup','No',ax1[1,0])\nplot_comparison('OnlineBackup','No internet service',ax1[1,1])\n","6cc1b576":"fig,ax1 = plt.subplots(2,2,figsize=(12,10))\nsns.countplot(data['DeviceProtection'],ax=ax1[0,0])\nplot_comparison('DeviceProtection','Yes',ax1[0,1])\nplot_comparison('DeviceProtection','No',ax1[1,0])\nplot_comparison('DeviceProtection','No internet service',ax1[1,1])","865f1b4f":"\nfig,ax1 = plt.subplots(2,2,figsize=(12,10))\nsns.countplot(data['Contract'],ax=ax1[0,0])\nplot_comparison('Contract','Month-to-month',ax1[0,1])\nplot_comparison('Contract','Two year',ax1[1,0])\nplot_comparison('Contract','One year',ax1[1,1])","5f8b0e64":"\nfig,ax1 = plt.subplots(1,3,figsize=(12,4))\nplot_comparison('PaperlessBilling','Yes',ax1[1])\nplot_comparison('PaperlessBilling','No',ax1[2])\n\nsns.countplot(data['PaperlessBilling'],ax=ax1[0])","b8bb658c":"fig,ax1 = plt.subplots(1,2,figsize=(12,5))\nsns.boxplot(x='PaperlessBilling',y='MonthlyCharges',data=data,ax=ax1[0])\nsns.boxplot(x='PaperlessBilling',y='TotalCharges',data=data,ax=ax1[1])","da8dfd20":"f,ax = plt.subplots(figsize=(12,6))\nsns.countplot(data['PaymentMethod'])","691b5360":"\nfig,ax1 = plt.subplots(2,2,figsize=(12,10))\nplot_comparison('PaymentMethod','Electronic check',ax1[0,0])\nplot_comparison('PaymentMethod','Mailed check',ax1[0,1])\nplot_comparison('PaymentMethod','Bank transfer (automatic)',ax1[1,0])\nplot_comparison('PaymentMethod','Credit card (automatic)',ax1[1,1])","b3fc670b":"sns.distplot(data['MonthlyCharges'])","c9555fc6":"sns.boxplot(data['MonthlyCharges'],data['Churn'])","c8a4049d":"sns.distplot(data['TotalCharges'])","eb2d48de":"sns.boxplot(y=data['TotalCharges'],x=data['Churn'])","0dba4212":"# don't want to alter original dataset\ncopy = data.copy(deep=True)","0d279213":"# label encoder to change categorical values into Numerical values\nle = LabelEncoder()\nfor col in copy.columns:\n    #if data type of column is object then and only apply label encoder\n    if copy[col].dtypes =='object':\n        copy[col] = le.fit_transform(copy[col])\n        \n# seperating Independent and dependent features\nX = copy.drop('Churn',axis=1)\ny = copy['Churn']","ddc2dd8a":"# to select k no. of best features from the available list of features \nfrom sklearn.feature_selection import SelectKBest\n#using chi-square test\nfrom sklearn.feature_selection import chi2\n\nbestfeatures = SelectKBest(score_func=chi2, k=12)\nfit = bestfeatures.fit(X,y)\ndfscores = pd.DataFrame(fit.scores_)\ndfcolumns = pd.DataFrame(X.columns)","3a6badd1":"#concat two dataframes for better visualization \nfeatureScores = pd.concat([dfcolumns,dfscores],axis=1)\nfeatureScores.columns = ['Specs','Score']  #naming the dataframe columns","b69cd04b":"print(featureScores.nlargest(15,'Score'))  #print 10 best features","8aff5c9d":"# will build model based on these 12 features becuase there chi-square is very high\nfeatures = ['TotalCharges','tenure','MonthlyCharges','Contract','OnlineSecurity','TechSupport','OnlineBackup','DeviceProtection',\n           'SeniorCitizen','Dependents','PaperlessBilling','Partner']","53149938":"# Standardization \nX = copy[features]\ny = copy['Churn']\nstandardized(X,'tenure')\nstandardized(X,'TotalCharges')\nstandardized(X,'MonthlyCharges')\n","7dfce2fe":"X_train, X_test, Y_train, Y_test= train_test_split(X, y, test_size=0.30, random_state=1, shuffle=True)","26aaa568":"\n# Spot Check Algorithms\nmodels = []\nmodels.append(('LR', LogisticRegression(solver='liblinear')))\nmodels.append(('LDA', LinearDiscriminantAnalysis()))\nmodels.append(('KNN', KNeighborsClassifier()))\nmodels.append(('CART', DecisionTreeClassifier()))\nmodels.append(('NB', GaussianNB()))\nmodels.append(('SVM', SVC(gamma='auto')))\n#models.append(())\nresults = []\nnames = []\nfor name, model in models:\n    kfold = StratifiedKFold(n_splits=10, random_state=1)\n    cv_results = cross_val_score(model, X_train, Y_train, cv=kfold, scoring='accuracy')\n    results.append(cv_results)\n    names.append(name)\n    print('%s: %f (%f)' % (name, cv_results.mean(), cv_results.std()))\n\n","533f0c44":"#Logistic Regression on test data\nlr = LogisticRegression()\nlr.fit(X_train,Y_train)\npred = lr.predict(X_test)\nacc = accuracy_score(Y_test,pred)\nacc","f5531e80":"# LinearDiscriminantAnalysis on test data\nlda = LinearDiscriminantAnalysis()\nlda.fit(X_train,Y_train)\npred = lda.predict(X_test)\nacc = accuracy_score(Y_test,pred)\nacc","45509cbf":"# Support Vector machine on test data\nsvc = SVC(gamma='auto')\nsvc.fit(X_train,Y_train)\npred = svc.predict(X_test)\nacc = accuracy_score(Y_test,pred)\nacc","6cad15db":"## 4. Partner\n**Pie plot is to describe overall count**","0bc8a712":"**Outlier is turned out to be greater than 69.5 but tenure has maximum value as 72. I guess, we can afford to have this value so we'll  not remove them.**","8eb57e92":"**we can see the similar trend in all internet related services**","3c00e47f":"**This gives us some info about how data is spreaded**","3f13c677":"## 6. tenure\n**a. it is numerical variable and if i am not wrong it represents, no. of years an individual using company's service**","1d72891e":"**Almost 26% of customers churn or leave the telecome company as a result of cut-throat competition**","ed582bdd":"## 2. Gender\n**we can check whether males are more potential churner than females**","853c8fe2":"# Let's discuss the effect of some of the variables, that may help in churn prediction ","e46af464":"## 10. OnlineSecurity","43a8546b":"## 15. PaymentMethod","1d5520e8":"## 5. Dependent","9666f004":"## 16. MonthlyCharges","ab6f6de7":"## 8. MultipleLines","101cad73":"## 13. Contract","d478b673":"## 9. InternetService","f9411b8f":"**It may be just a coincidence but those who are opting PaperlessBilling their MonthlyCharges and TotalCharges are high**","ab41daca":"### Data Visualization","380cb2b0":"**We know Chi-Square is not valid becuase every entery into contingency table must be greater than 5 but we also know that MultipleLines are highly dependent on PhoneService.**","eccecdf0":"## 11. OnlineBackup","98016d91":"**There are 4 numerical features, where SeniorCitizen will be considered as Categorical feature becuase it consists of 0 and 1 only which represents 'No' and 'Yes' respectively.There is not quite visible relation but there is some correlation between TotalCharges and tenure and between MonthlyCharges and TotalCharges.** ","e1565c46":"### Data Manipulation","cc62a52b":"**b. Among Senior and non-senior citezen who is churning more frequently**","04fcaeef":"### Implement Machine Learning Models","49c89136":"**Even after having multiple Lines of phones, people quiting more. since difference between two classes is less we won't consider this feature for model building**","3f5f81a3":"**However, No. of customers who have phone service are more, this fact doesn't seems to help either**","2ccb7ad6":"## 12. DeviceProtection","8f1ee0ea":"**'No internet service' can also be viewed as a 'No' which adds upto 49% in other words customers are using Phone services only**","35272fbd":"## 3. SeniorCitizen\n**a. How many senior citizen dataset have**","d7d92fe5":"**So, far Non-dependent non-partners are dangerous category**","2882b672":"**Surprisingly, Total charges shows a very different behaviour than monthly charges probably because it is right skewed**","fa53421a":"**If tenure is less or extremely high the chances of churning is more and also\nAs you can see in the above boxplot, there are few outliers in Churn = yes category.they can be considered Potential Outliers** ","65b82aa2":"\n# Customer Attrition\n\nCustomer attrition, also known as customer churn, customer turnover, or customer defection, is the loss of clients or customers.\n\nTelephone service companies, Internet service providers, pay TV companies, insurance firms, and alarm monitoring services, often use customer attrition analysis and customer attrition rates as one of their key business metrics because the cost of retaining an existing customer is far less than acquiring a new one. Companies from these sectors often have customer service branches which attempt to win back defecting clients, because recovered long-term customers can be worth much more to a company than newly recruited clients.\n\nCompanies usually make a distinction between voluntary churn and involuntary churn. Voluntary churn occurs due to a decision by the customer to switch to another company or service provider, involuntary churn occurs due to circumstances such as a customer's relocation to a long-term care facility, death, or the relocation to a distant location. In most applications, involuntary reasons for churn are excluded from the analytical models. Analysts tend to concentrate on voluntary churn, because it typically occurs due to factors of the company-customer relationship which companies control, such as how billing interactions are handled or how after-sales help is provided.\n\npredictive analytics use churn prediction models that predict customer churn by assessing their propensity of risk to churn. Since these models generate a small prioritized list of potential defectors, they are effective at focusing customer retention marketing programs on the subset of the customer base who are most vulnerable to churn.\n","de49cc0d":"### Understanding the data","8b9b92d9":"## 1. CustomerID\n**This variable doesn't give any extra information about the customer or about churning, so the best option is to get rid off this variable**","81ec65f1":"**Chi square test between MultipleLines and PhoneService**","5f8e01bd":"### Importing the data","2eada0a4":"## 0. Churn \n**Target variable or something we have to predict about unkown customers**","dbc5bf17":"**DSL is an outdated technology, customer of this category might consider switching company but fibre optic is latest technology and if customer of this category churning more than anyone else this could be an alarming situation for telocome company.**","6eff428b":"**Since, no. of Partners and non- partners are almost equal, We can conclude that Non-partners are more frequent churners**","7013e020":"**Online Backup service is worse than security service**","282f938b":"**As we can observe that the rate of churn is almost equal in Male and Female so gender doesn't seems to give any singnificant information about target variable**","e50fc013":"**Needless to say MonthlyCharges are high for churners**","f9e58ab9":"## 14. PaperlessBilling","4dcba9b9":"**Need less to say Non-dependent is a huge no. of churners**","b37d3666":"**Company's DSL service is fine It's Phone Service and Fibre optic service that company needs to work on**\n","af18e23c":"## 7. PhoneService","02221660":"**It is quite clear from above 2 countplots that Senior citzen are more likely to leave company,but a non senior citizen's 23% is higher in no.s.**","2762b9b8":"**No need to worry about 2 years contractors, they are going to stay, which is pretty obvious**  ","028098b3":"### Model Evaluation","4e00b87a":"# If you enjoy this notebook, then upvote and feel free to provide me with your feedback !!!","32fcb3aa":"**Linear regression, Linear Discriminant Analysis and Support Vector Machine all three are giving almost same accuracy for test data**","2b92f3dd":"### Conclusion: \n\n1. Customers are not gender bias\n2. Senior Citizens, non-partner, Non-dependent are more frequent Churners\n3. If tenure of customer is less or extremely high, chances of their opting out are higer\n4. Phone Service and having Multiple lines has nothing to do with Churn prediction(acording to data)\n5. Online Backup service is worse than Online security\n6. Long term contract can help retaining customers\n7. those who are opting paperless Billing they might have having some problem\n8. payment method == Electronic check has high rate of churners "}}