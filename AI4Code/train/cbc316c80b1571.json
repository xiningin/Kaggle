{"cell_type":{"56a8c1b8":"code","4f4bc824":"code","17f98a64":"code","8b4c4efc":"code","37898b91":"code","544b8599":"code","5c4c3076":"code","03306441":"code","0cdb0c6d":"code","074d90ed":"code","ac4d4a42":"code","ff33a6c9":"code","8e9587fc":"code","deeea340":"code","5ae96e5b":"code","a1bcfeff":"code","5ee3a815":"code","c7984596":"code","c0319746":"code","66e1875b":"code","df6aad2f":"code","37cd79ef":"code","635bcac2":"code","c2628077":"markdown"},"source":{"56a8c1b8":"# IMPORTS\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport math\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport warnings\nwarnings.filterwarnings('ignore', 'statsmodels.tsa.ar_model.AR', FutureWarning)","4f4bc824":"%%time\n# LOAD TRAIN DATA\ntrain = pd.read_csv('..\/input\/covid19-global-forecasting-week-3\/train.csv')","17f98a64":"df = train[train['Country_Region']=='Pakistan']\nPakistan_data = df.copy()\nPakistan_data= Pakistan_data[Pakistan_data.ConfirmedCases > 0.0]\nPakistan_data.reset_index(inplace=True)\nPakistan_data.drop(columns= ['index','Id','Province_State'],inplace=True)\nPakistan_data['ConfirmedCases'] = Pakistan_data['ConfirmedCases'].astype(int) \nPakistan_data['Fatalities'] = Pakistan_data['Fatalities'].astype(int) \nPakistan_data.head()","8b4c4efc":"month_day_list = []\nfor date in Pakistan_data['Date']:\n    month_day_list.append(date.split('2020-0')[1])\n\nPakistan_data['Month_Day'] = month_day_list\nPakistan_data.head()","37898b91":"def Calculate_Table ( X_train ):\n    # CALCULATE EXPANSION TABLE\n    diff_conf, conf_old = [], 0 \n    diff_fat, fat_old = [], 0\n    dd_conf, dc_old = [], 0\n    dd_fat, df_old = [], 0\n    ratios = []\n    for row in X_train.values:\n        diff_conf.append(row[2]-conf_old)\n        conf_old = row[2]\n        diff_fat.append(row[3]-fat_old)\n        fat_old = row[3]\n        dd_conf.append(diff_conf[-1]-dc_old)\n        dc_old = diff_conf[-1]\n        dd_fat.append(diff_fat[-1]-df_old)\n        df_old = diff_fat[-1]\n        ratios.append(fat_old \/ conf_old)\n        ratio = fat_old \/ conf_old\n        \n\n    return diff_conf, conf_old, diff_fat, fat_old, dd_conf, dc_old, dd_fat, df_old, ratios, ratio","544b8599":"def populate_df_features(X_train,diff_conf, diff_fat, dd_conf, dd_fat, ratios):    \n    # POPULATE DATAFRAME FEATURES\n    pd.options.mode.chained_assignment = None  # default='warn'\n    X_train['diff_confirmed'] = diff_conf\n    X_train['diff_fatalities'] = diff_fat\n    X_train['dd_confirmed'] = dd_conf\n    X_train['dd_fatalities'] = dd_fat\n    X_train['ratios'] = ratios\n    return X_train","5c4c3076":"def fill_nan ( variable):\n    if math.isnan(variable):\n        return 0\n    else:\n        return variable","03306441":"def Cal_Series_Avg(X_train,ratio):\n    # CALCULATE SERIES AVERAGES\n    d_c = fill_nan( X_train.diff_confirmed[X_train.diff_confirmed != 0].mean() )\n    dd_c = fill_nan( X_train.dd_confirmed[X_train.dd_confirmed != 0].mean() )\n    d_f = fill_nan( X_train.diff_fatalities[X_train.diff_fatalities != 0].mean() )\n    dd_f = fill_nan( X_train.dd_fatalities[X_train.dd_fatalities != 0].mean() )\n    rate = fill_nan( X_train.ratios[X_train.ratios != 0].mean() )\n    print(\"rate: %.2f ratio: %.2f\" %(rate,ratio))\n    print(\"d_c: %.2f, dd_c: %.2f, d_f: %.2f, dd_f: %.2f \"%(d_c, dd_c, d_f, dd_f))\n    rate = max(rate,ratio)\n    return d_c, dd_c, d_f, dd_f, rate","0cdb0c6d":"def apply_taylor(train, d_c, dd_c, d_f, dd_f, rate):\n    # ITERATE TAYLOR SERIES\n    \n    pred_c, pred_f = [],[]\n    for i in range(1, 34):\n        pred_c.append(int( ( train.ConfirmedCases[len(train)-1] + d_c*i + 0.5*dd_c*(i**2)) ) )\n        pred_f.append(pred_c[-1]*rate )\n    return pred_c, pred_f","074d90ed":"\ndiff_conf, conf_old, diff_fat, fat_old, dd_conf, dc_old, dd_fat, df_old, ratios, ratio = Calculate_Table(Pakistan_data)\n\nPakistan_data = populate_df_features(Pakistan_data,diff_conf, diff_fat, dd_conf, dd_fat, ratios)\n\nd_c, dd_c, d_f, dd_f, rate = Cal_Series_Avg(Pakistan_data, ratio)\n\npc, pf = apply_taylor(Pakistan_data, d_c, dd_c, d_f, dd_f, rate)","ac4d4a42":"len(pc), len(pf)","ff33a6c9":"Pakistan_data.iloc[:,:]","8e9587fc":"Pakistan_data.shape","deeea340":"dates = pd.read_csv('..\/input\/covid19-global-forecasting-week-3\/test.csv')\ndates.drop(columns= ['ForecastId','Province_State','Country_Region'],inplace=True)\ndates = dates.iloc[10:43,:]\n\npd_list = []\nfor date in dates.Date:\n    pd_list.append(date.split('2020-0')[1])\n\nDate_list = list(Pakistan_data.Month_Day.copy())\nDate_list.extend(pd_list)\n#Date_list","5ae96e5b":"plt.figure(figsize=(25,6))\n\ntpc = list(Pakistan_data.ConfirmedCases.copy())\ntpc.extend(pc)\nplt.plot(Date_list,tpc,'r',linestyle='dashed',label='Prediction')\nplt.plot(Pakistan_data.ConfirmedCases,label='Confirmed')\nplt.xlabel(\"Days passed since first Confirmed\",fontdict={'fontsize': 18})\nplt.ylabel(\"Total Confirmed Cases\",fontdict={'fontsize': 18})\nplt.legend(fontsize= 18)\nplt.title('Pakistan COVID19 Confirmed Cases',fontdict={'fontsize': 28})\nplt.xticks(rotation = 45)\n#plt.yscale('log')\n#plt.xscale('log')\nplt.show()\n","a1bcfeff":"# AR example\nfrom statsmodels.tsa.ar_model import AR\nfrom statsmodels.tsa.statespace.sarimax import SARIMAX\nfrom random import random","5ee3a815":"data = Pakistan_data.ConfirmedCases\n\n# fit model\nmodel = AR(Pakistan_data.ConfirmedCases)\nmodel_fit = model.fit()\n\n# make prediction\nstart = len(Pakistan_data.ConfirmedCases)\nyhat = model_fit.predict(start,71)\npcc= list(data[0:start])\n\npcc.extend(list(yhat))\nprint(len(pcc))","c7984596":"pcc2 = pcc[30:]\ndl = Date_list[30:]\nfor i,d in enumerate(dl):\n    dl[i] = d.replace(\"3-\",\"Mar-\")\n    dl[i] = dl[i].replace(\"4-\",\"Apr-\")\n    dl[i] = dl[i].replace(\"5-\",\"May-\")\ncc = Pakistan_data.ConfirmedCases[30:]\nplt.figure(figsize=(20,7))\nplt.plot(dl,pcc2,'r',linestyle='dashed',label='Prediction')\nplt.plot(dl[:9],cc,label='Confirmed')\nplt.xlabel(\"Date\",fontdict={'fontsize': 18})\nplt.ylabel(\"Total Confirmed Cases\",fontdict={'fontsize': 18})\nplt.legend(fontsize= 18)\nplt.title('Pakistan COVID19 Confirmed Cases (Autoregression) ',fontdict={'fontsize': 28})\nplt.xticks(rotation=45)\nplt.show()","c0319746":"models = SARIMAX(Pakistan_data.ConfirmedCases, order=(1, 0, 0), trend='t')\nmodels_fit = models.fit()\n# make prediction\nstart = len(Pakistan_data.ConfirmedCases)\nyhats = models_fit.predict(start,71)\npccs= list(data[0:start])\npccs.extend(list(yhats))\n","66e1875b":"pccs2 = pccs[30:]\ndls = Date_list[30:]\nfor i,d in enumerate(dls):\n    dls[i] = d.replace(\"3-\",\"Mar-\")\n    dls[i] = dls[i].replace(\"4-\",\"Apr-\")\n    dls[i] = dls[i].replace(\"5-\",\"May-\")\nccs = Pakistan_data.ConfirmedCases[30:]\nplt.figure(figsize=(20,7))\nplt.plot(dls,pccs2,'r',linestyle='dashed',label='Prediction')\nplt.plot(dls[:9],ccs,label='Confirmed')\nplt.xlabel(\"Date\",fontdict={'fontsize': 18})\nplt.ylabel(\"Total Confirmed Cases\",fontdict={'fontsize': 18})\nplt.legend(fontsize= 18)\nplt.title('Pakistan COVID19 Confirmed Cases (SARIMAX) ',fontdict={'fontsize': 28})\nplt.xticks(rotation=45)\nplt.show()","df6aad2f":"plt.figure(figsize=(12,6))\n\ntpf = list(Pakistan_data.Fatalities.copy())\ntpf.extend(pf)\nplt.plot(tpf,'r',linestyle='dashed',label='Prediction')\nplt.plot(Pakistan_data.Fatalities,label='Fatalities')\nplt.xlabel(\"Days passed since first Confirmed\",fontdict={'fontsize': 18})\nplt.ylabel(\"Total Fatalities\",fontdict={'fontsize': 18})\nplt.legend(fontsize= 18)\nplt.title('Pakistan COVID19 Fatalities',fontdict={'fontsize': 28})\nplt.xticks(rotation=45)\nplt.show()\n","37cd79ef":"data = Pakistan_data.Fatalities\ndata_len = len(data)\nto_predict = range(data_len+1, data_len+30)\n# fit model\nmodel = AR(Pakistan_data.Fatalities)\nmodel_fit = model.fit()\n# make prediction\nyhat = model_fit.predict(start,71)\npfc= list(data[0:start])\npfc.extend(list(yhat))\n#print(pfc)","635bcac2":"plt.figure(figsize=(12,6))\n\nplt.plot(pfc,'r',linestyle='dashed',label='Prediction')\nplt.plot(Pakistan_data.Fatalities,label='Fatalities')\nplt.xlabel(\"Days passed since first Confirmed\",fontdict={'fontsize': 18})\nplt.ylabel(\"Total Fatalities\",fontdict={'fontsize': 18})\nplt.legend(fontsize= 18)\nplt.title('Pakistan COVID19 Fatalities  (Autoregression) ',fontdict={'fontsize': 28})\n#plt.yscale('log')\n#plt.xscale('log')\nplt.show()","c2628077":"# Pakistan COVID19 Prediction\n## Data From [Kaggle covid19 global forcasting week3](https:\/\/www.kaggle.com\/c\/covid19-global-forecasting-week-3)"}}