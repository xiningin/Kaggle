{"cell_type":{"5fe22669":"code","679d2bb5":"code","1fddede7":"code","b8878ed0":"code","69da5912":"code","961b39c3":"code","ab16985e":"code","89235e74":"code","c3161597":"code","7e7eca40":"code","bd4f5282":"markdown","7f029464":"markdown","a3eaa6e8":"markdown","19d29bf0":"markdown","f4c80999":"markdown","3f7236bd":"markdown","65adca34":"markdown","af22b340":"markdown","7d83dacd":"markdown"},"source":{"5fe22669":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nsns.set_style('darkgrid')\nsns.set(rc={'figure.figsize':(15, 10)})\n\nfrom tqdm import tqdm\nimport warnings\nwarnings.filterwarnings('ignore')\n\nfrom catboost import CatBoostClassifier\nfrom lightgbm import LGBMClassifier\nfrom xgboost import XGBClassifier\n\nfrom sklearn.ensemble import VotingClassifier\nfrom sklearn.metrics import accuracy_score, precision_score\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import LabelEncoder, RobustScaler\n\nRS = 69420\nDATA_PATH = \"..\/input\/tabular-playground-series-mar-2021\/train.csv\"","679d2bb5":"train = pd.read_csv(DATA_PATH, index_col=0)\n\ncat_features = [c for c in train.columns if 'cat' in c]\nle = LabelEncoder()\nfor col in cat_features:\n    train[col] = le.fit_transform(train[col])\n\nX = train.iloc[:, :-1].values\ny = train.iloc[:, -1].values","1fddede7":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=RS, shuffle=True, stratify=y)","b8878ed0":"sc = RobustScaler(with_centering=False)\n\nX_train = sc.fit_transform(X_train)\nX_test = sc.transform(X_test)","69da5912":"estimators = []\nfor i in range(1500):\n    model1 = LGBMClassifier(device='gpu',\n                            verbose=0,\n                            random_seed=np.random.randint(0, 100000))\n\n    model2 = XGBClassifier(objective='binary:logistic',\n                           predictor = 'gpu_predictor',\n                           tree_method = 'gpu_hist',\n                           verbose=None,\n                           random_state=np.random.randint(0, 100000))\n    \n    model3 = CatBoostClassifier(task_type=\"GPU\",\n                                devices='0:1',\n                                verbose=None,\n                                random_seed=np.random.randint(0, 100000))\n    \n    estimators.append((f\"lgbm_model{i}\", model1))\n    estimators.append((f\"xgb_model{i}\", model2))\n    estimators.append((f\"cat_model{i}\", model3))","961b39c3":"clf = VotingClassifier(estimators=estimators,\n                       verbose=1,\n                       voting='soft')","ab16985e":"%%time\nclf.fit(X_train, y_train)","89235e74":"# # Predict\n# y_pred = clf.predict(X_test)\n\n# # Compute Metrics\n# print(f\"Testing Precision: {precision_score(y_test, y_pred, 'weighted')}\")","c3161597":"test = pd.read_csv(\"..\/input\/tabular-playground-series-mar-2021\/test.csv\", index_col=0)\n\nfor col in cat_features:\n    test[col] = le.fit_transform(test[col])\n\nsubmission = pd.DataFrame(index=test.index)\n\ntest = sc.transform(test.values)\n\nsubmission['target'] = clf.predict_proba(test)[:, 1]\n\nsubmission.to_csv(\"submission.csv\")","7e7eca40":"print(\"Ensemble is served!\")","bd4f5282":"**With the range set to only 3 we can get an unseen score of 0.88557 putting you in the top 50% - with a default model! Imagine after tuning :) (Hint thats what I did)**","7f029464":"# **Predict Unseen Data**","a3eaa6e8":"# **Robust Scaling Because why tf not**","19d29bf0":"# ***Extreme Ensemble***","f4c80999":"**The rationale of this notebook is very simple - to demonstrate the power of ensembles. Through this notebook you will see how just blending thousands of *default* ensembles you can still get excellent results. Is this practical? Depends, how many cores do you have? This is more of an interesting phenomenon if anything. If you have any academic research supporting why 'Extreme Ensembling' works so well, please link below.**","3f7236bd":"# **Load the data**","65adca34":"****","af22b340":"# **The good stuff is always imported :)**","7d83dacd":"# **Build, Train, Test Voting Classifier**"}}