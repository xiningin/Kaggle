{"cell_type":{"7d3043b6":"code","f8b0390c":"code","2346c818":"code","0ba05700":"code","b0c26650":"code","0a163e8c":"code","02459471":"code","ae76d997":"code","a62ee618":"code","0be98fb3":"code","b0accfb2":"code","60d81163":"code","b5889f07":"code","9e49e61c":"code","98c9b8b8":"code","0078fec8":"code","3a235509":"markdown","867562b6":"markdown","08494cb7":"markdown","ae258c33":"markdown"},"source":{"7d3043b6":"import pandas as pd\nimport lightgbm as lgb\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nplt.style.use('ggplot')\nfrom matplotlib_venn import venn2\n%matplotlib inline\nimport numpy as np","f8b0390c":"df_train = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/train.csv\")\ndf_test = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/test.csv\")\ndf_user = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/user_x_anime.csv\")\ndf_user.head()","2346c818":"y_train = df_train.Score\nX_train = df_train.drop(['Score'], axis=1)\nX_test = df_test.copy()","0ba05700":"train_len = len(df_train)\ntest_len = len(df_test)\nX_all = pd.concat([df_train,df_test])\nX_all.head(2)","b0c26650":"df_user = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/user_x_anime.csv\")\ndf_user_not_zero = df_user[df_user.rating != 0]\n# df_user_not_zero = df_user_not_zero.dropna()","0a163e8c":"X_all = pd.concat([X_train,X_test])\nX_all.loc[X_all.Episodes == \"Unknown\",\"Episodes\"] = np.nan\nX_all[\"Episodes\"] = X_all.Episodes.astype(float)\nX_all_temp = X_all[[\"MAL_ID\",\"Episodes\"]]\ndf_user_not_zero = pd.merge(df_user_not_zero, X_all_temp, left_on='anime_id', right_on='MAL_ID',how='left')\ndf_user_not_zero[\"watching_rate\"] = df_user_not_zero[\"watched_episodes\"]\/df_user_not_zero[\"Episodes\"]\ndf_user_not_zero.loc[df_user_not_zero[\"watching_rate\"] < 1\/5,\"rating\"] = np.nan\ndf_user_not_zero\ndel X_all_temp\ndel X_all","02459471":"temp = df_user_not_zero.groupby('user_id')[\"rating\"].mean().reset_index()\ntemp1 = df_user_not_zero.groupby('user_id')[\"rating\"].std().reset_index()\ntemp2 = df_user_not_zero.groupby('user_id')[\"rating\"].median().reset_index()\ntemp3 = df_user_not_zero.groupby('user_id')[\"rating\"].min().reset_index()\ntemp4 = df_user_not_zero.groupby('user_id')[\"rating\"].max().reset_index()\ntemp5 = df_user_not_zero.groupby('user_id')[\"rating\"].count().reset_index()\n\ntemp.columns = [\"user_id\",\"rating_mean\"]\ntemp1.columns = [\"user_id\",\"rating_std\"]\ntemp2.columns = [\"user_id\",\"rating_median\"]\ntemp3.columns = [\"user_id\",\"rating_min\"]\ntemp4.columns = [\"user_id\",\"rating_max\"]\ntemp5.columns = [\"user_id\",\"rating_count\"]\n\ndf_user_ = pd.merge(df_user_not_zero.groupby('user_id').mean().drop(columns = [\"rating\"]), temp, left_on='user_id', right_on='user_id',how='left')\ndf_user_ = pd.merge(df_user_, temp1, left_on='user_id', right_on='user_id',how='left')\ndf_user_ = pd.merge(df_user_, temp2, left_on='user_id', right_on='user_id',how='left')\ndf_user_ = pd.merge(df_user_, temp3, left_on='user_id', right_on='user_id',how='left')\ndf_user_ = pd.merge(df_user_, temp4, left_on='user_id', right_on='user_id',how='left')\ndf_user_ = pd.merge(df_user_, temp5, left_on='user_id', right_on='user_id',how='left')\ndf_user_.head()","ae76d997":"df_user__ = pd.merge(df_user, df_user_.drop(columns = [\"anime_id\",\"Episodes\"]), left_on='user_id', right_on='user_id',how='left')","a62ee618":"df_user_mean = df_user__.groupby('anime_id').describe()\ndf_user_mean.drop(['rating','user_id'], axis=1, inplace=True)","0be98fb3":"col = [ i[0]+\"_\"+i[1]  for i in (df_user_mean.columns)]\ndf_user_mean.columns = col\ndf_user_mean = df_user_mean.reset_index()","b0accfb2":"df_user_mean.to_csv(\"df_user_describe.csv\",index = False)","60d81163":"# X_train = pd.merge(df_train, df_user_mean, left_on='MAL_ID', right_on='anime_id',how='left').drop(columns='anime_id')\n# X_test = pd.merge(df_test, df_user_mean, left_on='MAL_ID', right_on='anime_id',how='left').drop(columns='anime_id')","b5889f07":"# np.corrcoef(X_train.rating_mean, X_train.Score)","9e49e61c":"#\u3053\u306eX_train\uff0cX_test\u3092\u5b66\u7fd2\u30c7\u30fc\u30bf\u3068\u3057\u3066\u304a\u308a\u307e\u3059\uff0e","98c9b8b8":"X_train","0078fec8":"X_test","3a235509":"\u4e0a\u8a18\u3092\u5b9f\u88c5\u3059\u308c\u3070\u5b8c\u5168\u4e00\u81f4\u3057\u3066\u307b\u3057\u3044","867562b6":"## \u30ea\u30f3\u30af\u3092\u5b8c\u5168\u306b\u5fd8\u308c\u3066\u307e\u3057\u305f\uff0e\nAll scores given in the database are calculated as a weighted score.\n\nWeighted Score = (v \/ (v + m)) * S + (m \/ (v + m)) * C  \nS = Average score for the anime\/manga  \nv = Number users giving a score for the anime\/manga \u2020  \nm = Minimum number of scored users required to get a calculated score  \nC = The mean score across the entire Anime\/Manga database  \n\n\u2020 Note that v does not correspond to the \"number of scored users\" as seen on the database page. Scores from users who have not viewed 1\/5 of the series upon its completion are not included. Scores given from illegitimate accounts created to sway votes are also not included in the scoring algorithm.\n\nNot Yet Aired entries have no score and will display N\/A. Entries that do not meet the minimum number of scored users will also not display a calculated score.\n\nTop Anime\/Manga Rankings\nThe \"Top Upcoming\" and \"Most Popular\" rankings are ordered by the number of users who have added the entry to their list. All other Top Anime and Top Manga rankings are ordered by weighted score, as calculated above. Please note that while R18+ entries calculate a weighted score, they are excluded from the rankings.","08494cb7":"# \u3053\u3053\u4ee5\u964d\u5b66\u7fd2\u3059\u308b\u969b\u306e\u53c2\u8003\u306b\u306a\u308b\u304b\u3068\u601d\u3044\u307e\u3059\uff0e\nuser_id\u3054\u3068\u306b\u5e73\u5747\u3092\u3068\u3063\u3066user_id\u306e\u5e73\u5747\u306e\u8a55\u4fa1\u3092\u5217\u306b\u8ffd\u52a0\u3059\u308b\uff0e","ae258c33":"# EDA\u3053\u3053\u307e\u3067"}}