{"cell_type":{"41bde546":"code","bedd8cd1":"code","cc6c8f52":"code","48658bc4":"code","c0d2141a":"code","2910b1c3":"code","698ae9bc":"code","763b467d":"code","e764344c":"code","3a1950c2":"code","fecb9fa7":"code","6ddc2ffc":"code","5940c98e":"code","e11ef257":"code","79b232d5":"code","cf82c037":"code","6dc3fde0":"code","19b8d885":"code","dc14edbb":"code","3cc9755c":"code","1d1b3cbf":"code","d3330f2f":"code","c4767891":"code","a55fd152":"code","88a1667f":"code","472c4058":"code","e15c4f59":"code","9ec07601":"code","7780f0ec":"code","c904c0a6":"code","6b26a956":"code","4fda8b14":"code","bbca1e32":"code","91a00c06":"code","54d4f38e":"code","88acd5c8":"code","befb90d3":"code","56805567":"code","438db168":"code","144071f6":"code","191e2db0":"code","1161b5ea":"code","b0aab3fe":"code","8f960c43":"code","556930ee":"code","9b23a000":"code","f6ba6398":"code","40625ba6":"code","56f185c7":"code","bee42982":"code","164845ed":"code","2a7b055f":"code","849d9351":"code","6cbd41c8":"code","5e20ad01":"code","d8db70e2":"code","6d800b20":"code","bab35d67":"code","2d7a5eb8":"code","1524264b":"markdown","6fa17a5d":"markdown","0045ff93":"markdown","992afdcc":"markdown","77eac2b4":"markdown","9d408f8f":"markdown","fbb0ba16":"markdown","4c7d030e":"markdown","0b74bf24":"markdown","b165b1fc":"markdown","d24afecf":"markdown","8a478b41":"markdown"},"source":{"41bde546":"import matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns","bedd8cd1":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","cc6c8f52":"import os\nos.chdir('\/kaggle\/input\/bike-sharing-dataset')","48658bc4":"df_original = pd.read_csv('day.csv')","c0d2141a":"df = df_original.copy()\ndf.head(2)","2910b1c3":"print('Number of Variables: '+str(len(df.columns)))\nprint('Variables:'+str(list(df.columns)))\nprint('Shape of dataframe '+ str(df.shape))","698ae9bc":"#Hypothesis, sum of casual and registered should be equal to cnt\n#Verify our hypothesis\nj=0;\nfor i in range(len(df)):\n    if df['cnt'].loc[i] == df['casual'].loc[i] + df['registered'].loc[i]:\n        pass;\n    else:\n        print('not equal')\n\n#Since it did not print \"not equal\", our hypothesis is correct","763b467d":"df.info()","e764344c":"# Missing Value Analysis\ndf.isna().sum()","3a1950c2":"\n#Categorical Variable\nprint(df['season'].value_counts())\nprint(df['yr'].value_counts())\nprint(df['mnth'].value_counts())\nprint(df['holiday'].value_counts())\nprint(df['weekday'].value_counts())\nprint(df['workingday'].value_counts())\nprint(df['weathersit'].value_counts())\n\n#Continuous numberical variable\n#print(df['temp'].value_counts())\n#print(df['atemp'].value_counts())\n#print(df['hum'].value_counts())\n#print(df['windspeed'].value_counts())","fecb9fa7":"#Convert Columns into their respective types\ndf['dteday'] = pd.to_datetime(df['dteday'])\n\ndf['season'] = df['season'].astype('category')\ndf['yr'] = df['yr'].astype('category')\ndf['mnth'] = df['mnth'].astype('category')\ndf['holiday'] =df['holiday'].astype('category')\ndf['weekday'] = df['weekday'].astype('category')\ndf['workingday'] = df['workingday'].astype('category')\ndf['weathersit'] = df['weathersit'].astype('category')","6ddc2ffc":"df.describe() ","5940c98e":"df = df.rename(columns={'instant':'record_index','hum':'humidity','cnt':'total_count','weathersit':'weather_category','mnth':'month','dteday':'date'})","e11ef257":"fig, axs  = plt.subplots(2, 5, figsize=(20, 10))\n\naxs[0,0].boxplot(df['yr'])\naxs[0,0].set_title('Year', size=20)\naxs[0,1].boxplot(df['month'])\naxs[0,1].set_title('Month', size=20)\naxs[0,2].boxplot(df['weekday'])\naxs[0,2].set_title('Weekday', size=20)\naxs[0,3].boxplot(df['workingday'])\naxs[0,3].set_title('Working Day', size=20)\naxs[0,4].boxplot(df['weather_category'])\naxs[0,4].set_title('Weather Category', size=20)\naxs[1,0].boxplot(df['temp'])\naxs[1,0].set_title('Temp', size=20)\naxs[1,1].boxplot(df['atemp'])\naxs[1,1].set_title('atemp', size=20)\naxs[1,2].boxplot(df['humidity'])\naxs[1,2].set_title('Humidity', size=20)\naxs[1,3].boxplot(df['windspeed'])\naxs[1,3].set_title('Wind Speed', size=20)\naxs[1,4].boxplot(df['season'])\naxs[1,4].set_title('Season', size=20)\nplt.show()","79b232d5":"c_category = ['season','yr','month','holiday','weekday','workingday','weather_category']","cf82c037":"c_continuous = ['temp','atemp','hum','windspeed']","6dc3fde0":"cname = [x for x in df.columns if x not in ['date','registered','casual','cnt','instant','season','yr','month','holiday','weekday','workingday','weather_category']]\ncname","19b8d885":"#Outlier Analysis, box plot ----------> Remove outlier\nfor col in cname:\n    q75,q25 = np.percentile(df.loc[:,col],[75,25]);\n    iqr = q75-q25;\n    lower_fence = q25 - (1.5*iqr)\n    upper_fence = q75 + (1.5*iqr)\n\n    df_outlier_del = df.drop(df[df.loc[:,col] < lower_fence].index)\n    df_outlier_del = df.drop(df[df.loc[:,col] > upper_fence].index)","dc14edbb":"#Outlier Analysis by considering outliers as NA and imputing values\ndf_outlier_impute = df.copy()\nfor col in cname:\n    q75,q25 = np.percentile(df.loc[:,col],[75,25]);\n    iqr = q75-q25;\n    lower_fence = q25 - (1.5*iqr)\n    upper_fence = q75 + (1.5*iqr)\n\n    row = df_outlier_impute[df.loc[:,col] < lower_fence].index\n    df_outlier_impute.loc[row,col] = np.nan\n\n    row = df_outlier_impute[df.loc[:,col] > upper_fence].index\n    df_outlier_impute.loc[row,col] = np.nan","3cc9755c":"df_outlier_impute.isna().sum()","1d1b3cbf":"print('Percentage of Missing value:',(15\/731)*100)","d3330f2f":"#To check the similarities, lets replace df['weekday][0] = 6\ndf_outlier_impute.loc[0,'temp'] = np.nan\ndf_outlier_impute.loc[0,'temp']","c4767891":"#Original = 0.344\n#Mean = 0.49\n#Median = 0.49\n#KNN = 0.37\n\n#df_outlier_impute['temp'] = df_outlier_impute['temp'].fillna(df_outlier_impute['temp'].mean())\n#print('Mean: ',df_outlier_impute.loc[0,'temp'])\n\n\n#df_outlier_impute['temp'] = df_outlier_impute['temp'].fillna(df_outlier_impute['temp'].median())\n#print('Median: ',df_outlier_impute.loc[0,'temp'])\n\nfrom sklearn.impute import KNNImputer\nimputer = KNNImputer(n_neighbors=5)\ndf_fit = imputer.fit_transform(df_outlier_impute[['temp', 'atemp', 'humidity', 'windspeed']])\ndf_fit = pd.DataFrame(df_fit, columns = ['temp', 'atemp', 'humidity', 'windspeed'])\nprint('KNN: ',df_fit.loc[0,'temp'])\n\ndf_outlier_impute[['temp', 'atemp', 'humidity', 'windspeed']]=df_fit[['temp', 'atemp', 'humidity', 'windspeed']]","a55fd152":"#Correlation plot(only between continuous numerical variable)\nfx, ax = plt.subplots(figsize = (10,7))\nnum_var = df_outlier_impute[['temp','atemp','humidity','windspeed','casual','registered','total_count']]\nnum_var.corr()\nsns.heatmap(num_var.corr(),annot=True,cmap='Blues', linewidth=2)","88a1667f":"from scipy.stats import chi2_contingency\n#Catigorical variable\nc_category = ['season','yr','month','holiday','weekday','workingday','weather_category']\n\nprint('------------FOR CASUAL----------------------')\nfor col_name in c_category:\n    print(col_name)\n    chi2, p, dof, ex = chi2_contingency(pd.crosstab(df_outlier_impute['casual'],df_outlier_impute[col_name])) \n    print('p :',p)\nprint('-------------------FOR REGISTERED----------------------')\nfor col_name in c_category:\n    print(col_name)\n    chi2, p, dof, ex = chi2_contingency(pd.crosstab(df_outlier_impute['registered'],df_outlier_impute[col_name]))\n    print('p :',p)\n\nprint('------------------FOR Total Count----------------------')\nfor col_name in c_category:\n    print(col_name)\n    chi2, p, dof, ex = chi2_contingency(pd.crosstab(df_outlier_impute['total_count'],df_outlier_impute[col_name]))\n    print('p :',p)\n","472c4058":"fx, ax = plt.subplots(figsize = (10,7))\nnum_var = df_outlier_del[['temp','atemp','humidity','windspeed','casual','registered','total_count']]\nnum_var.corr()\nsns.heatmap(num_var.corr(),annot=True,cmap='Blues', linewidth=2)","e15c4f59":"#Catigorical variable\nc_category = ['season','yr','month','holiday','weekday','workingday','weather_category']\n\nprint('------------FOR CASUAL----------------------')\nfor col_name in c_category:\n    print(col_name)\n    chi2, p, dof, ex = chi2_contingency(pd.crosstab(df_outlier_del['casual'],df_outlier_del[col_name])) \n    print('p :',p)\nprint('-------------------FOR REGISTERED----------------------')\nfor col_name in c_category:\n    print(col_name)\n    chi2, p, dof, ex = chi2_contingency(pd.crosstab(df_outlier_del['registered'],df_outlier_del[col_name]))\n    print('p :',p)\n\nprint('------------------FOR Total Count----------------------')\nfor col_name in c_category:\n    print(col_name)\n    chi2, p, dof, ex = chi2_contingency(pd.crosstab(df_outlier_del['total_count'],df_outlier_del[col_name]))\n    print('p :',p)\n","9ec07601":"# Season\n\nfig, axs = plt.subplots(ncols=2,nrows=2, figsize=(10,5))\nsns.barplot(x=\"season\", y=\"casual\", data=df_outlier_impute, ci=None, ax=axs[0,0])\naxs[0,0].set_title('Casual')\nsns.barplot(x=\"season\", y=\"registered\", data=df_outlier_impute, ci=None,ax=axs[0,1])\naxs[0,1].set_title('Registered')\nsns.scatterplot(x = \"season\", y = \"casual\",data=df_outlier_impute, ax=axs[1,0])\nsns.scatterplot(x = \"season\", y = \"registered\",data=df_outlier_impute, ax=axs[1,1])\n#1: Spring, 2: Summer, 3: fall, 4:winter","7780f0ec":"#Year\n\nfig, axs = plt.subplots(ncols=2,nrows=2, figsize=(10,5))\nsns.barplot(x=\"yr\", y=\"casual\", data=df_outlier_impute, ci=None,ax=axs[0,0])\naxs[0,0].set_title('Casual')\nsns.barplot(x=\"yr\", y=\"registered\", data=df_outlier_impute, ci=None,ax=axs[0,1])\naxs[0,1].set_title('Registered')\nsns.scatterplot(x = \"yr\", y = \"casual\",data=df_outlier_impute, ax=axs[1,0])\nsns.scatterplot(x = \"yr\", y = \"registered\",data=df_outlier_impute, ax=axs[1,1])\n# 1: 2012, 0: 2011","c904c0a6":"#Month\n\nfig, axs = plt.subplots(ncols=2,nrows=2, figsize=(10,5))\nsns.barplot(x=\"month\", y=\"casual\", data=df_outlier_impute, ci=None, hue='yr',ax=axs[0,0])\naxs[0,0].set_title('Casual')\nsns.barplot(x=\"month\", y=\"registered\", data=df_outlier_impute, ci=None,hue='yr',ax=axs[0,1])\naxs[0,1].set_title('Registered')\nsns.scatterplot(x = \"month\", y = \"casual\",data=df_outlier_impute, ax=axs[1,0])\nsns.scatterplot(x = \"month\", y = \"registered\",data=df_outlier_impute, ax=axs[1,1])","6b26a956":"#Weekday\n\nfig, axs = plt.subplots(ncols=2,nrows=2, figsize=(10,5))\nsns.barplot(x=\"weekday\", y=\"casual\", data=df_outlier_impute, ci=None,ax=axs[0,0])\naxs[0,0].set_title('Casual')\nsns.barplot(x=\"weekday\", y=\"registered\", data=df_outlier_impute, ci=None,ax=axs[0,1])\naxs[0,1].set_title('Registered')\nsns.scatterplot(x = \"weekday\", y = \"casual\",data=df_outlier_impute, ax=axs[1,0])\nsns.scatterplot(x = \"weekday\", y = \"registered\",data=df_outlier_impute, ax=axs[1,1])","4fda8b14":"#Holiday\n\nfig, axs = plt.subplots(ncols=2,nrows=2, figsize=(10,5))\nsns.barplot(x=\"holiday\", y=\"casual\", data=df_outlier_impute, ci=None,ax=axs[0,0])\naxs[0,0].set_title('Casual')\nsns.barplot(x=\"holiday\", y=\"registered\", data=df_outlier_impute, ci=None,ax=axs[0,1])\naxs[0,1].set_title('Registered')\nsns.scatterplot(x = \"holiday\", y = \"casual\",data=df_outlier_impute, ax=axs[1,0])\nsns.scatterplot(x = \"holiday\", y = \"registered\",data=df_outlier_impute, ax=axs[1,1])\n#1: Holiday\n#0: No holiday","bbca1e32":"#Working Day\n\nfig, axs = plt.subplots(ncols=2,nrows=2, figsize=(10,5))\nsns.barplot(x=\"workingday\", y=\"casual\", data=df_outlier_impute, ci=None,ax=axs[0,0])\naxs[0,0].set_title('Casual')\nsns.barplot(x=\"workingday\", y=\"registered\", data=df_outlier_impute, ci=None,ax=axs[0,1])\naxs[0,1].set_title('Registered')\nsns.scatterplot(x = \"workingday\", y = \"casual\",data=df_outlier_impute, ax=axs[1,0])\nsns.scatterplot(x = \"workingday\", y = \"registered\",data=df_outlier_impute, ax=axs[1,1])\n#0: weekend or holiday\n#1: Working day or weekdays","91a00c06":"#Weather Category\n\nfig, axs = plt.subplots(ncols=2,nrows=2, figsize=(10,5))\nsns.barplot(x=\"weather_category\", y=\"casual\", data=df_outlier_impute, ci=None,ax=axs[0,0])\naxs[0,0].set_title('Casual')\nsns.barplot(x=\"weather_category\", y=\"registered\", data=df_outlier_impute, ci=None,ax=axs[0,1])\naxs[0,1].set_title('Registered')\nsns.scatterplot(x = \"weather_category\", y = \"casual\",data=df_outlier_impute, ax=axs[1,0])\nsns.scatterplot(x = \"weather_category\", y = \"registered\",data=df_outlier_impute, ax=axs[1,1])\n\n#1:Clear, Few clouds, Partly cloudy, Partly cloudy\n#2:Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist \n#3:Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds \n#4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog  ","54d4f38e":"fig, axs = plt.subplots(ncols=2, figsize=(10,5))\nsns.scatterplot(x = \"temp\", y = \"casual\",data=df_outlier_impute, ax=axs[0])\nsns.scatterplot(x = \"temp\", y = \"registered\",data=df_outlier_impute, ax=axs[1])","88acd5c8":"fig, axs = plt.subplots(ncols=2, figsize=(10,5))\nsns.scatterplot(x = \"atemp\", y = \"casual\",data=df_outlier_impute, ax=axs[0])\nsns.scatterplot(x = \"atemp\", y = \"registered\",data=df_outlier_impute, ax=axs[1])","befb90d3":"fig, axs = plt.subplots(ncols=2, figsize=(10,5))\nsns.scatterplot(x = \"humidity\", y = \"casual\",data=df_outlier_impute, ax=axs[0])\nsns.scatterplot(x = \"humidity\", y = \"registered\",data=df_outlier_impute, ax=axs[1])","56805567":"fig, axs = plt.subplots(ncols=2, figsize=(10,5))\nsns.scatterplot(x = \"windspeed\", y = \"casual\",data=df_outlier_impute, ax=axs[0])\nsns.scatterplot(x = \"windspeed\", y = \"registered\",data=df_outlier_impute, ax=axs[1])","438db168":"sns.scatterplot(x = \"casual\", y = \"registered\",data=df_outlier_impute)","144071f6":"x_casual = df_outlier_impute[['season', 'atemp', 'humidity', 'windspeed']]\nx_registered = df_outlier_impute[['atemp', 'humidity', 'windspeed']]\ny_casual = df_outlier_impute['casual']\ny_registered = df_outlier_impute['registered']","191e2db0":"from sklearn.model_selection import train_test_split\nfrom sklearn.tree import DecisionTreeRegressor  \nfrom sklearn.tree import export_graphviz","1161b5ea":"def MAPE(y_true,y_pred):\n    mape = np.mean(np.abs((y_true - y_pred)\/ y_true))\n    return mape\n\ndef MAE(y_true,y_pred):\n    mae = np.mean(np.abs(y_true - y_pred))\n    return mae","b0aab3fe":"x_train_casual, x_test_casual, y_train_casual, y_test_casual = train_test_split(x_casual, y_casual, test_size = 0.4, random_state = 0)","8f960c43":"regressor = DecisionTreeRegressor(random_state = 0)\nregressor.fit(x_train_casual, y_train_casual)","556930ee":"regressor.score(x_train_casual,y_train_casual)","9b23a000":"y_predicted_d_casual = regressor.predict(x_test_casual)","f6ba6398":"regressor.feature_importances_","40625ba6":"mse = MAE(y_test_casual,y_predicted_d_casual)\nmape = MAPE(y_test_casual,y_predicted_d_casual)\nprint(\"Mean Squared Error:\",mse)\nprint(\"Mean Absolute Percentage Error:\",mape)\nprint(\"Accuracy : \",100-mape)","56f185c7":"x_train_registered, x_test_registered, y_train_registered, y_test_registered = train_test_split(x_registered, y_registered, test_size = 0.4, random_state = 0)","bee42982":"regressor = DecisionTreeRegressor(random_state = 0)\nregressor.fit(x_train_registered, y_train_registered)","164845ed":"y_predicted_d_registered = regressor.predict(x_test_registered)","2a7b055f":"mse = MAE(y_test_registered,y_predicted_d_casual)\nmape = MAPE(y_test_registered,y_predicted_d_casual)\nprint(\"Mean Squared Error:\",mse)\nprint(\"Mean Absolute Percentage Error:\",mape)","849d9351":"x = df_outlier_impute.drop(columns=['total_count'], axis=1)\ny = df_outlier_impute['total_count']","6cbd41c8":"x_train, x_test, y_train, y_test_count = train_test_split(x, y, test_size = 0.4, random_state = 0)","5e20ad01":"y_pred_count =y_predicted_d_registered + y_predicted_d_casual","d8db70e2":"mse = MAE(y_test_count,y_pred_count)\nmape = MAPE(y_test_count,y_pred_count)\nprint(\"Mean Squared Error:\",mse)\nprint(\"Mean Absolute Percentage Error:\",mape)","6d800b20":"from scipy.stats import pearsonr\ncorr, _ = pearsonr(y_pred_count,y_test_count)\nprint(corr)\nprint(corr**2)","bab35d67":"from sklearn.metrics import r2_score\n\nr2_score(y_pred_count,y_test_count)","2d7a5eb8":"Result by directly using Decision Tree( It automatically selects important features)","1524264b":"For Casual","6fa17a5d":"For Registered","0045ff93":"b) Drop Value DataFrame","992afdcc":"Model for registered","77eac2b4":"Scatter plot between numerical continuous variable and target variable","9d408f8f":"if p < 0.05 then there is high correlation else it's independent\n\n1. Holiday got no affect on both casual or registered\n2. Other than 'season' and 'month' for predicting 'casual', every variable got p value greater than 0.05 i.e they are independent of the target variable\n\n\n**Observation:**\n1. Users which are registred are not affected by any weather, month, year, weekday, working\/weekday.\n2. Casual users count are affected by Season and month the most.\n","fbb0ba16":"To know more about the analysis, check out \"Bike Rental Service.docx\" under folder daybikerentalcount","4c7d030e":"------------------------------------------------DATA VISUALIZATION---------------------------------","0b74bf24":"Observation:\nThere is not much change in correlation value between dependent and independent values.\n\nSince I want to preserve data, I will go with imputation of data on outliers","b165b1fc":"Model Type : Regression\nObjective:\n\nPredict 'casual' and 'registered'\nAdd both the predicted value to get 'cnt'\nDisplay value of 'cnt' to user","d24afecf":"Observation:\n\nall variable except \"humidity\" got correlation more than 0.1 0\ntemp and atemp got high correlation of 0.99 i.e. we can discard one of the variable\nregistereed and cnt got high correlation","8a478b41":"a) Imputed Values"}}