{"cell_type":{"b0fd1ac2":"code","49263ad5":"code","a23f2de7":"code","fcd64681":"code","6b3fcefb":"code","cc239765":"code","45dab39a":"code","2e21dde4":"code","8a931a23":"code","b371f32c":"code","8395715b":"code","66058b50":"code","9249ec1b":"code","7a1d0b50":"code","402cd4ff":"code","7bd7fe53":"code","1fd3de8c":"code","23cadadb":"code","8ac3673b":"code","d359bf9b":"code","9e8846e7":"code","4a28443f":"code","73a36918":"code","12b3ac5c":"code","5ba28d69":"code","98c07f0e":"code","e90bdf5a":"code","3e9f0f19":"code","512b26c1":"code","ed899120":"code","41bb1db8":"code","026cc145":"code","416683b2":"code","0a4ccde4":"code","62a75607":"code","0d1ec90a":"code","ba8c9153":"code","6449b1e4":"code","51a31b51":"code","29aa8030":"code","b415d7f6":"markdown","dadcf41c":"markdown","91ff2e67":"markdown","29dd9a56":"markdown","6807e987":"markdown","b1460345":"markdown","76b475e7":"markdown","55fe6be9":"markdown","b86de098":"markdown","35e98143":"markdown","911b2db4":"markdown","0e5bfb07":"markdown","fee83d99":"markdown","8ae04c74":"markdown","43a03623":"markdown","735ed8e5":"markdown"},"source":{"b0fd1ac2":"import pandas as pd\ndata = pd.read_csv('..\/input\/predicting-employee-attrition\/train_data.csv')\ndata.head()","49263ad5":"m1 = ~data.duplicated(['Emp_ID'], keep='last')","a23f2de7":"final_d=data.loc[m1]","fcd64681":"final_d[final_d['Emp_ID']==2]","6b3fcefb":"import numpy as np\nfinal_d.loc[:,'working'] = np.where(pd.isnull(final_d['LastWorkingDate']), 1, 0)","cc239765":"final_d.head()","45dab39a":"final_d.loc[2,'Dateofjoining']","2e21dde4":"if pd.isna(final_d.loc[4,'LastWorkingDate']):\n    print('Yes')","8a931a23":"from dateutil.relativedelta import relativedelta\nfrom datetime import datetime\ndef timesub(x,y):\n    if pd.isnull(y):\n        y = datetime.today().strftime('%Y-%m-%d')\n    x_time = datetime.strptime(x, '%Y-%m-%d')\n    y_time = datetime.strptime(y, '%Y-%m-%d')\n    td=relativedelta(y_time,x_time)\n    return td.years\n","b371f32c":"final_d['TotalWorkingYears']=final_d.apply(lambda x: timesub(x.Dateofjoining, x.LastWorkingDate), axis=1)","8395715b":"final_d['TotalWorkingYears'].head()","66058b50":"final_d[['Total Business Value','Salary']].describe()","9249ec1b":"def sal(x):\n    if x < 40000:\n        return 'Low'\n    elif x >= 40000 and x < 65000:\n        return 'Medium'\n    else:\n        return 'High'\n    \ndef busvalue(x):\n    if x<=0:\n        return 'Loss'\n    else:\n        return 'Profit'\nfinal_d['SalaryCat']=final_d['Salary'].apply(sal)\nfinal_d['Total Business Value']=final_d['Total Business Value'].apply(busvalue)\nfinal_d.head()","7a1d0b50":"import matplotlib.pyplot as plt\nimport seaborn as sns\n\nplt.figure(figsize=(10, 8), dpi=80)\ncorr=final_d.corr()\nsns.heatmap(corr, annot=True,cmap=\"crest\")\nplt.show()","402cd4ff":"print(final_d['Designation'].dtypes,final_d['Joining Designation'].dtypes)","7bd7fe53":"final_d['Designation']=final_d['Designation'].apply(str)\nfinal_d['Joining Designation']=final_d['Joining Designation'].apply(str)","1fd3de8c":"plt.figure(figsize=(10,8))\nax=sns.countplot(x=\"Gender\", hue=\"working\", data=final_d,palette='crest')\nbars = ax.patches\nhalf = int(len(bars)\/2)\nleft_bars = bars[:half]\nright_bars = bars[half:]\n\nfor left, right in zip(left_bars, right_bars):\n        height_l = left.get_height()\n        height_r = right.get_height()\n        total = height_l + height_r\n        ax.text(left.get_x() + left.get_width()\/2., height_l + 10, '{0:.0%}'.format(height_l\/total), ha=\"center\")\n        ax.text(right.get_x() + right.get_width()\/2., height_r + 10, '{0:.0%}'.format(height_r\/total), ha=\"center\")\nplt.show()","23cadadb":"plt.figure(figsize=(10,8))\nax=sns.countplot(x=\"Education_Level\", hue=\"working\", data=final_d,palette='crest')\nbars = ax.patches\nhalf = int(len(bars)\/2)\nleft_bars = bars[:half]\nright_bars = bars[half:]\n\nfor left, right in zip(left_bars, right_bars):\n        height_l = left.get_height()\n        height_r = right.get_height()\n        total = height_l + height_r\n        ax.text(left.get_x() + left.get_width()\/2., height_l + 10, '{0:.0%}'.format(height_l\/total), ha=\"center\")\n        ax.text(right.get_x() + right.get_width()\/2., height_r + 10, '{0:.0%}'.format(height_r\/total), ha=\"center\")\nplt.show()","8ac3673b":"plt.figure(figsize=(10,8))\nax=sns.countplot(x=\"Total Business Value\", hue=\"working\", data=final_d,palette='crest')\nbars = ax.patches\nhalf = int(len(bars)\/2)\nleft_bars = bars[:half]\nright_bars = bars[half:]\n\nfor left, right in zip(left_bars, right_bars):\n        height_l = left.get_height()\n        height_r = right.get_height()\n        total = height_l + height_r\n        ax.text(left.get_x() + left.get_width()\/2., height_l + 10, '{0:.0%}'.format(height_l\/total), ha=\"center\")\n        ax.text(right.get_x() + right.get_width()\/2., height_r + 10, '{0:.0%}'.format(height_r\/total), ha=\"center\")\nplt.show()","d359bf9b":"plt.figure(figsize=(10,8))\nax=sns.countplot(x=\"Designation\", hue=\"working\", data=final_d,palette='crest')\nbars = ax.patches\nhalf = int(len(bars)\/2)\nleft_bars = bars[:half]\nright_bars = bars[half:]\n\nfor left, right in zip(left_bars, right_bars):\n        height_l = left.get_height()\n        height_r = right.get_height()\n        total = height_l + height_r\n        ax.text(left.get_x() + left.get_width()\/2., height_l + 10, '{0:.0%}'.format(height_l\/total), ha=\"center\")\n        ax.text(right.get_x() + right.get_width()\/2., height_r + 10, '{0:.0%}'.format(height_r\/total), ha=\"center\")\nplt.show()","9e8846e7":"sns.catplot(x=\"Designation\", y=\"Salary\",  data=final_d)","4a28443f":"plt.figure(figsize=(6,6))\ny=final_d['TotalWorkingYears']\nsns.boxplot(y=y,x=final_d['working'],palette='crest')","73a36918":"y=final_d['Quarterly Rating']\nx=final_d['working']\nsns.countplot(hue=y,x=final_d['working'],palette='crest')","12b3ac5c":"wor=final_d[final_d['working']==1]\nnowor=final_d[final_d['working']==0]\nsns.kdeplot(wor.Salary)\nsns.kdeplot(nowor.Salary)\nplt.legend(('Yes', 'No'))","5ba28d69":"#a=final_d[final_d['working']==1]['City']\n#b=final_d[final_d['working']==0]['City']\na=dict(final_d.groupby(['City', 'working']).agg({'working':['count']}).apply(list))","98c07f0e":"#working\/total = working\/working+notworking for each city\nlistwork=[]\nlistnotwork=[]\nfor i in range(len(a[('working', 'count')])):\n    if i%2==0:\n        listnotwork.append(a[('working', 'count')][i])\n    else:\n        listwork.append(a[('working', 'count')][i])\n    \n#working+total\nlistratio=[a\/(a+b) for a,b in zip(listwork,listnotwork)]","e90bdf5a":"print(listwork)\nprint(listnotwork)","3e9f0f19":"plt.plot(listratio,linestyle='--')\nplt.ylim(0,1)","512b26c1":"del listwork\ndel listnotwork\nstddev= np.std(np.array(listratio))\nmean=np.mean(np.array(listratio))\nprint(mean,stddev)","ed899120":"final_d.head()","41bb1db8":"import fastai\nfrom fastai.basics import *\nfrom fastai.tabular.all import *\ndls = TabularDataLoaders.from_df(final_d,path='.', y_names=\"working\",\n    cat_names = ['Gender', 'Education_Level', 'Designation'],\n    cont_names = ['Age', 'TotalWorkingYears', 'Salary','Quarterly Rating'],\n    procs = [Categorify, FillMissing, Normalize])","026cc145":"dls.show_batch()","416683b2":"\n\n\n\nlearn = tabular_learner(dls, layers=[128, 64, 16], metrics=accuracy)\nlearn.lr_find()\n\n# we typically find the point where the slope is steepest\n#learn.recorder.plot()\n\n# Fit the model based on selected learning rate\nlearn.fit_one_cycle(15, slice(1e-03))\n","0a4ccde4":"test = pd.read_csv('\/kaggle\/input\/predicting-employee-attrition\/test_data.csv')\ntestset = final_d[final_d['Emp_ID'].isin(test['Emp_ID'])]\ntestset= testset.drop_duplicates()\ntrue_labels=testset['working']\ntestset=testset[['Gender', 'Education_Level', 'Designation','Age', 'TotalWorkingYears', 'Salary','Quarterly Rating']]\n\ntestset.head()","62a75607":"predictions=[]\nfor i in range(0,len(testset)):\n    predictions.append(learn.predict(testset.iloc[i]))\n","0d1ec90a":"labels=[]\nfor i in predictions:\n    if i[-1]>0.5:\n        labels.append(1)\n    else:\n        labels.append(0)","ba8c9153":"from sklearn.metrics import accuracy_score\naccuracy_score(true_labels, labels)*100","6449b1e4":"!pip install fastinference","51a31b51":"from fastinference.tabular import *\nexp = ShapInterpretation(learn, final_d.iloc[:100])\n","29aa8030":"exp.summary_plot()","b415d7f6":"## Problem Statement:\nIn recent years, attention has increasingly been paid to human resources (HR), since worker quality and skills represent a growth factor and a real competitive advantage for companies. After proving its mettle in sales and marketing, analytics and artificial intelligence is also becoming central to employee-related decisions within HR management. Organizational growth largely depends on staff retention. Losing employees frequently impacts the morale of the organization and hiring new employees is more expensive than retaining existing ones.","dadcf41c":"There isn't a lot of difference in the values for attrited and non attrited employees.   \nInsight: Education isn't a big factor contributing to higher attrition","91ff2e67":"* Employees who help grow the business\/company are more likely to stay. Seeing positive changes because of oneself keeps one motivated to keep doing it\n* Employees who've caused the company a loss, are largely likely to leave.","29dd9a56":"The ratios in our data are the same. Gender isn't a strong determinant of an employee beeing attrited or not.","6807e987":"* Employees in their early years of career tend to resign a lot more than employees who've worked in the company for >4 years","b1460345":"## Applying a fastai model for tabular data","76b475e7":"Get a high level overview of all numerical variables' correlation with each other","55fe6be9":"Salary annd designation don't seem strongly correlated with attrition. Let's plot them against each other ","b86de098":"The standard deviation isn't very large, meaning an employee's being attrited doesn't depend on where they're from","35e98143":"Most employees with low quarterly rating have a higher chance of leaving the company","911b2db4":"It makes sense that '1' and '2' have lower salaries compararively. Higher salary is a usualy motivation to keep working in the same company   \nThe currency of this dataset hasn't been specified. But if it was, we could dig in a little more to compare these salaries to living cost of a single person and a family.","0e5bfb07":"Let's plot it against categorical variables too","fee83d99":"Designation should be categorical but the datatype is integer that's why has been plotted in the heatmap","8ae04c74":"The attrited employees are significatnly higher for job designations 1 and 2 than others.","43a03623":"Working seems to be highly correlated to total working year","735ed8e5":"### Data Cleaning:\n* Remove all duplicate instances of one id\n* Create label class\n* Create 'TotalWorkingYears' column\n* Convert salary to 'High','Low','Moderate' \n"}}