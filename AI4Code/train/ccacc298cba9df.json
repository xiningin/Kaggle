{"cell_type":{"deff9192":"code","dee49f86":"code","b5159ccb":"code","859a9b1c":"code","bda8f772":"code","a7fd601d":"code","1e8931ac":"markdown","d58c660d":"markdown","32ca6506":"markdown","8e2aca26":"markdown"},"source":{"deff9192":"# Set up feedback system\nfrom learntools.core import binder\nbinder.bind(globals())\nfrom learntools.sql_advanced.ex1 import *\nprint(\"Setup Complete\")","dee49f86":"from google.cloud import bigquery\n\n# Create a \"Client\" object\nclient = bigquery.Client()\n\n# Construct a reference to the \"hacker-news\" dataset\ndataset_ref = client.dataset(\"hacker_news\", project=\"bigquery-public-data\")\n\n# API request - fetch the dataset\ndataset = client.get_dataset(dataset_ref)\n\n# Construct a reference to the \"posts_questions\" table\ntable_ref = dataset_ref.table(\"comments\")\n\n# API request - fetch the table\ntable = client.get_table(table_ref)\n\n# Preview the first five lines of the table\nclient.list_rows(table, max_results=5).to_dataframe()","b5159ccb":"# Construct a reference to the \"stories\" table\ntable_ref1 = dataset_ref.table(\"stories\")\n\n# API request - fetch the table\ntable1 = client.get_table(table_ref1)\n\n# Preview the first five lines of the table\nclient.list_rows(table1, max_results=5).to_dataframe()","859a9b1c":"join_query = \"\"\"\n             WITH com AS\n             (\n             SELECT parent, \n                 COUNT(*) as num_com\n             FROM `bigquery-public-data.hacker_news.comments` \n             GROUP BY parent\n             )\n             SELECT h.id as historia_id, h.by, h.title, com.num_com\n             FROM `bigquery-public-data.hacker_news.stories` AS h\n             LEFT JOIN com\n             ON h.id = com.parent\n             WHERE EXTRACT(DATE FROM h.time_ts) = '2012-12-18'\n             ORDER BY com.num_com DESC\n             \"\"\"\n\n# Resultado en DataFrame\njoin_result = client.query(join_query).result().to_dataframe()\njoin_result.head()\n","bda8f772":"\njoin_result.tail()\n","a7fd601d":"# Que usuarios publicaron algo el uno de enero.\n\nunion_query = \"\"\"\n              SELECT com.by\n              FROM `bigquery-public-data.hacker_news.comments` AS com\n              WHERE EXTRACT(DATE FROM com.time_ts) = '2012-01-01'\n              UNION DISTINCT\n              SELECT h.by\n              FROM `bigquery-public-data.hacker_news.stories` AS h\n              WHERE EXTRACT(DATE FROM h.time_ts) = '2012-01-01'\n              \"\"\"\n\n# DataFrame\nunion_result = client.query(union_query).result().to_dataframe()\nunion_result.head()","1e8931ac":"# A\u00f1adimos una segunda tabla.","d58c660d":"# UNION DISTINCT: cuantos publicaron algo el 1 de Enero.","32ca6506":"# CONECTANDO CON LA BASE DE DATOS\nConectamos con el Hacker News y seleccionamos la tabla de Comentarios (visualizamos las cinco primeras filas).\n","8e2aca26":" # Ejemplo de LEFT JOIN: stories publicadas el 18 de Diciembre 2012 junto con el n\u00famero de cometarios que ha recibido cada una.\n \n \n"}}