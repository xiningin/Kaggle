{"cell_type":{"846b876e":"code","95c03185":"code","289c000c":"code","fcc6153f":"code","996ff660":"code","e91ae10b":"code","779d0e2d":"code","c8968738":"code","ae028212":"code","196461ee":"code","7d9d9bdd":"code","dac21177":"code","15da8089":"code","ffa19766":"code","186372ca":"code","b6520ac3":"code","80ccf292":"code","cde6bb52":"markdown","46483863":"markdown","60fadf59":"markdown","47b6eb01":"markdown","d3fe0c6f":"markdown","1cc9ea01":"markdown","bdd326fc":"markdown","3413abc3":"markdown","bfb687ea":"markdown","e7991dc8":"markdown","9cfd716a":"markdown","ee8edef8":"markdown","3f5febc7":"markdown","7053f960":"markdown","e2242e24":"markdown","f49d073c":"markdown","183a4c74":"markdown","2f74d4ea":"markdown"},"source":{"846b876e":"# Import all required libraries\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport datetime as dt\nfrom plotly import __version__\nimport plotly.graph_objs as go \nimport plotly.plotly as py\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\ninit_notebook_mode(connected=True) \n%matplotlib inline\nimport re","95c03185":"# Read in the data\ndata = pd.read_csv('..\/input\/gun-violence-data_01-2013_03-2018.csv')\n\n# Basic outlook of the data\ndata.head()","289c000c":"# Information about the dataset and datatypes\ndata.info()","fcc6153f":"plt.figure(figsize=(16,5))\nsns.heatmap(data.isnull(),cbar=False,yticklabels=False)\nplt.show()","996ff660":"from urllib.parse import urlparse\n\n# Even though we have only a few null values, we still remove them\ndata_source = data.dropna(subset=['sources'],axis=0)\n\n# We rebuild the index as it was broken by removing null values\ndata_source.reset_index(drop=True,inplace=True)\n\ndata_source['clean_source']= [urlparse(data_source.sources[i]).netloc for i in range(len(data_source.sources))]\ndata_source['clean_source'] = [data_source.clean_source[i].replace('www.','').replace('.com','') for i in range(len(data_source.sources))]","e91ae10b":"data_short = data_source['clean_source'].value_counts().head(15).to_dict()\nx_list = list(data_short.keys())\ny_list = list(data_short.values())\ndata1 = [go.Bar(x=x_list,y=y_list,marker=dict(color=['grey','grey','grey','grey','grey','grey','red','grey','grey','grey','grey','grey','grey','grey','grey']))]\niplot(data1)\n#list(data_short.keys())","779d0e2d":"data_geo = data['state'].value_counts()\nx_geo = list(data_geo.keys())\ny_geo = list(data_geo.values)\nmean_count = data['state'].value_counts().mean()\ngeo_graph = [go.Bar(x=x_geo,y=y_geo)]\ngeo_layout = {'shapes':[{'type':'line','x0':0,'y0':mean_count,'x1':50,'y1':mean_count}]}\niplot({'data':geo_graph,'layout':geo_layout})","c8968738":"## Here we change the date column in the date to individually work with years, months and days.\ndata['date']=pd.to_datetime(data['date'])\ndata['year'] = data['date'].dt.year\ndata['month']=data['date'].dt.month\ndata['day_of_week'] = data['date'].dt.dayofweek\ndata.head()","ae028212":"year_data = data.groupby('year')['n_killed','n_injured'].sum()\n\nnk_x = list(year_data['n_killed'].keys())\nnk_y = list(year_data['n_killed'].values)\nnk_graph = [go.Bar(x=nk_x,y=nk_y,marker=dict(color='crimson'))]\nnk_layout = go.Layout(title='Year wise Deaths in Shootings')\niplot({'data':nk_graph,'layout':nk_layout})","196461ee":"ni_x = list(year_data['n_injured'].keys())\nni_y = list(year_data['n_injured'].values)\nni_graph = [go.Bar(x=ni_x,y=ni_y,marker=dict(color='lightcoral'))]\nni_layout = go.Layout(title='Year wise Injuries in Shootings')\niplot({'data':ni_graph,'layout':ni_layout})","7d9d9bdd":"data['gun_type_parsed'] = data['gun_type'].fillna('0:Unknown')\ngt = data.groupby(by=['gun_type_parsed']).agg({'n_killed': 'sum', 'n_injured' : 'sum', 'state' : 'count'}).reset_index().rename(columns={'state':'count'})\n\nresults = {}\nfor i, each in gt.iterrows():\n    wrds = each['gun_type_parsed'].split(\"||\")\n    for wrd in wrds:\n        if \"Unknown\" in wrd:\n            continue\n        wrd = wrd.replace(\"::\",\":\").replace(\"|1\",\"\")\n        gtype = wrd.split(\":\")[1]\n        if gtype not in results: \n            results[gtype] = {'killed' : 0, 'injured' : 0, 'used' : 0}\n        results[gtype]['killed'] += each['n_killed']\n        results[gtype]['injured'] +=  each['n_injured']\n        results[gtype]['used'] +=  each['count']\n        \nresultFrame = pd.DataFrame(results)\n\nresultFrame.transpose().plot.bar(figsize=(12,3),title=\"Handgun Type Used\")","dac21177":"n_guns = data[data[\"n_guns_involved\"].notnull()]\nn_guns[\"n_guns_involved\"] = n_guns[\"n_guns_involved\"].astype(int)\nn_guns = n_guns[[\"n_guns_involved\"]]\n\ndef label(n_guns):\n    if n_guns[\"n_guns_involved\"] == 1 :\n        return \"ONE-GUN\"\n    elif n_guns[\"n_guns_involved\"] > 1 :\n        return \"GREATER THAN ONE GUN\"\n\nn_guns[\"x\"] = n_guns.apply(lambda n_guns:label(n_guns),axis=1)\nn_guns[\"x\"].value_counts().plot.pie(figsize=(7,7),autopct =\"%1.0f%%\",explode = [0,.2],shadow = True,colors=[\"indianred\",\"grey\"],startangle =25)\nplt.title(\"NO OF GUNS INVOLVED\")\nplt.ylabel(\"\")","15da8089":"age = data[data[\"participant_age\"].notnull()][[\"participant_age\"]]\nage[\"participant_age\"] = age[\"participant_age\"].str.replace(\"::\",\"-\")\nage[\"participant_age\"] = age[\"participant_age\"].str.replace(\":\",\"-\")\nage[\"participant_age\"] = age[\"participant_age\"].str.replace(\"[||]\",\",\")\nage = pd.DataFrame(age[\"participant_age\"])\nx1 = pd.DataFrame(age[\"participant_age\"].str.split(\",\").str[0])\nx2 = pd.DataFrame(age[\"participant_age\"].str.split(\",\").str[1])\nx3 = pd.DataFrame(age[\"participant_age\"].str.split(\",\").str[2])\nx4 = pd.DataFrame(age[\"participant_age\"].str.split(\",\").str[3])\nx5 = pd.DataFrame(age[\"participant_age\"].str.split(\",\").str[4])\nx6 = pd.DataFrame(age[\"participant_age\"].str.split(\",\").str[5])\nx7 = pd.DataFrame(age[\"participant_age\"].str.split(\",\").str[6])\nx1 = x1[x1[\"participant_age\"].notnull()]\nx2 = x2[x2[\"participant_age\"].notnull()]\nx3 = x3[x3[\"participant_age\"].notnull()]\nx4 = x4[x4[\"participant_age\"].notnull()]\nx5 = x5[x5[\"participant_age\"].notnull()]\nx6 = x6[x6[\"participant_age\"].notnull()]\nx7 = x7[x7[\"participant_age\"].notnull()]\n\nage_dec  = pd.concat([x1,x2,x3,x4,x5,x6,x7],axis = 0)\nage_dec[\"lwr_lmt\"] = age_dec[\"participant_age\"].str.split(\"-\").str[0]\nage_dec[\"upr_lmt\"] = age_dec[\"participant_age\"].str.split(\"-\").str[1]\nage_dec.head()\n\nage_dec= age_dec[age_dec[\"lwr_lmt\"]!='']\nage_dec[\"lwr_lmt\"] = age_dec[\"lwr_lmt\"].astype(int)\nage_dec[\"upr_lmt\"] = age_dec[\"upr_lmt\"].astype(int)\n\nage_dec[\"age_bins\"] = pd.cut(age_dec[\"upr_lmt\"],bins=[0,20,35,55,130],labels=[\"TEEN[0-20]\",\"YOUNG[20-35]\",\"MIDDLE-AGED[35-55]\",\"OLD[>55]\"])\nplt.figure(figsize=(8,8))\nage_dec[\"age_bins\"].value_counts().plot.pie(autopct = \"%1.0f%%\",shadow =True,startangle = 0,colors = sns.color_palette(\"prism\",5),\n                                            wedgeprops = {\"linewidth\" :3,\"edgecolor\":\"k\"})\nmy_circ = plt.Circle((0,0),.7,color = \"white\")\nplt.gca().add_artist(my_circ)\nplt.ylabel(\"\")\nplt.title(\"Distribution of age groups of participants\",fontsize=20)","ffa19766":"from collections import Counter\n\ntotal_incidents = []\nfor i, each_inc in enumerate(data['incident_characteristics'].fillna('Not Available')):\n    split_vals = [x for x in re.split('\\|', each_inc) if len(x)>0]\n    total_incidents.append(split_vals)\n    if i == 0:\n        unique_incidents = Counter(split_vals)\n    else:\n        for x in split_vals:\n            unique_incidents[x] +=1\n\nunique_incidents = pd.DataFrame.from_dict(unique_incidents, orient='index')\ncolvals = unique_incidents[0].sort_values(ascending=False).index.values\nfind_val = lambda searchList, elem: [[i for i, x in enumerate(searchList) if (x == e)][0] for e in elem]\n\na = np.zeros((data.shape[0], len(colvals)))\nfor i, incident in enumerate(total_incidents):\n    aval = find_val(colvals, incident)\n    a[i, np.array(aval)] = 1\nincident = pd.DataFrame(a, index=data.index, columns=colvals)\n\nprominent_incidents = incident.sum()[[4, 5, 6, 9, 10, 11, 13, 14, 15, 16, 17, 18, 19, 20,\n                                      21, 23,22,24,45,51]]\nfig = {\n    'data': [\n        {\n            'labels': prominent_incidents.index,\n            'values': prominent_incidents,\n            'type': 'pie',\n            'hoverinfo':'label+percent+name',\n            \"domain\": {\"x\": [0, .45]},\n        }\n    ],\n    'layout': {'title': 'Prominent Incidents of Gun Violence',\n               'showlegend': False}\n}\niplot(fig)","186372ca":"relation = data['participant_relationship']\nrelation = relation[relation.notnull()]\nrelation = relation.str.replace(\"[:|0-9]\",\" \").str.upper()\nrelation1 = pd.DataFrame({\"count\":[len(relation[relation.str.contains(\"FAMILY\")]),\n               len(relation[relation.str.contains(\"ROBBERY\")]),\n               len(relation[relation.str.contains(\"FRIENDS\")]),\n               len(relation[relation.str.contains(\"AQUAINTANCE\")]),\n               len(relation[relation.str.contains(\"NEIGHBOR\")]),\n               len(relation[relation.str.contains(\"INVASION\")]),\n               len(relation[relation.str.contains(\"CO-WORKER\")]),\n               len(relation[relation.str.contains(\"GANG\")]),\n               len(relation[relation.str.contains(\"RANDOM\")]),\n               len(relation[relation.str.contains(\"MASS SHOOTING\")])],\n              \"category\":[\"FAMILY\",\"ROBBERY\",\"FRIENDS\",\"AQUAINTANCE\",\"NEIGHBOR\",\"INVASION\",\"CO-WORKER\",\"GANG\",\"RANDOM\",\"MASS SHOOTING\"]})\nrelation1\nplt.figure(figsize=(14,5))\nsns.barplot(\"category\",\"count\",data=relation1,palette=\"prism\")\nplt.title(\"COUNT PLOT FOR PARTICPANT RELATION TYPE IN VIOLENT EVENTS\")","b6520ac3":"data['gun_stolen'] = data['gun_stolen'].fillna('Null')\n\ndata['gun_stolen'] = data['gun_stolen'].str.replace('::',',')\ndata['gun_stolen'] = data['gun_stolen'].str.replace('|',' ')\ndata['gun_stolen'] = data['gun_stolen'].str.replace(',',' ')\ndata['gun_stolen']= data['gun_stolen'].str.replace('\\d+', '')\n\n\ndata['Stolenguns']=data['gun_stolen'].apply(lambda x: x.count('Stolen'))\ndata['stolenguns']=data['gun_stolen'].apply(lambda x: x.count('stolen'))\ndata['Stolengunstotal'] = data['Stolenguns'] + data['stolenguns']\n\ndf_year_stolenguns = data[['year','Stolengunstotal']].groupby(['year'], as_index = False).sum()\n\n\ndf_year_stolenguns[['year','Stolengunstotal']].set_index('year').plot(kind='bar')","80ccf292":"from collections import Counter\nbig_text = \"||\".join(data['incident_characteristics'].dropna()).split(\"||\")\nincidents = Counter(big_text).most_common(30)\nxx = [x[0] for x in incidents]\nyy = [x[1] for x in incidents]\n\ntrace1 = go.Bar(\n    x=yy[::-1],\n    y=xx[::-1],\n    name='Incident Characterisitcs',\n    marker=dict(color='purple'),\n    opacity=0.3,\n    orientation=\"h\"\n)\ndata1 = [trace1]\nlayout = go.Layout(\n    barmode='group',\n    margin=dict(l=350),\n    width=800,\n    height=600,\n    legend=dict(dict(x=-.1, y=1.2)),\n    title = 'Key Incident Characteristics',\n)\n\nfig = go.Figure(data=data1, layout=layout)\niplot(fig, filename='grouped-bar')","cde6bb52":"### Moving focus\n\nThis graph clears the air a bit more. We can now safely and confidently say that most of the gun violence caused in the country is caused by handguns.\n\nThis difference now means we will have to look at our data in different ways. We are better off trying to analyze and work with the 91% of situations than working with the other 9%.\n\nBefore we move on to deeper analysis, we will try work with age groups of the participants.","46483863":"### A troubling majority\n\nNow before we take away ideas from this graph, we should remind ourselves that a lot of the data about participant relationships is not available to us. So, whatever we do infer from this graph, will need to be checked further from different sources and different datasets.\n\nHowever, against common intuition, we see that family, friends, aquaintance and neighbors contribute the most to the whole issue while mass shootings have the smallest count.\n\nA different problem, indeed. As I said before, we are better off dealing with majority contributor of the problem rather than the other ones in the minority. This means that we actually need to shift our focus somewhere, because from where we started looking, mass shootings were the biggest problem but the data reveals that a lot more people are being hurt by things that we wouldn't even imagine by ourselves.","60fadf59":"## Checking the news sources\n\nBecause all of this data was picked up from public data, we have ample data to analyze the data sources. We will be able to get an idea of the credibility of the sources.","47b6eb01":"# Gun Violence Data Analysis\n\nWe will deal with data describing 260k gun incidents in the US. The data runs between January 2013 and March 2018.\n\nThe data was obtained from [gunviolencearchive.org](http:\/\/www.gunviolencearchive.org\/). This database has been obtained from public records and news sources. While this has allowed to cover a large number of incidents, we have to understand that a considerable amount of data in the set will be missing. It will be a good exercise to work with other gun violence datasets and try to compare results. However, for this kernel we will stick to this data set.","d3fe0c6f":"### Multiple missing\/useless values\n\nWith the above graph, we get a clear idea of all the data that is missing. This gives us a good direction in regards to which columns we will use to analyze the dataset. It should be intuitive to see that we should be careful while using data from fields like,  _participantRelationship_ or _gunType_ ","1cc9ea01":"## Year wise deaths and injuries\n\nWe know that the problem has been troubling the republic for some time now. The question then stands that are we getting better or worse? Looking at the yearly death and injury rates can be a good overview ","bdd326fc":"### Understanding the data sources\n\nWe see that most of the data has been picked up from respectable news sources but among those also lie sources such as **twitter** and **facebook**. In light of recent events, it is important to keep note of where all our data has been taken from. The source of the data holds credibility, so for now we can safely assume all data to be valid.","3413abc3":"# Where to now?\n\nIncreasing death rate, handguns, family, posession by felons and increasing number of stolen guns. If I want anyone to take away anything from this data, then it would be the few words and phrases I have just mentioned.\n\nWhen I started working on the data, I was only focussing on the events of mass shootings. Unfortunately, the description for mass shootings is different for the different data sets that are out there. In our case, any event involving 4+ people would be considered a mass shooting.\n\nMoving away then, from the mass shootings a completely new image revealed itself. While people are debating wether or not to change gun laws in the country, the majority of the problem is being eluded by all discussions.\n\n\n## Next steps\n\nAll these ideas and their in-depth analysis is not under the premise of this paper. We realized something new about the problem we are all facing - I urge you to go out and do your own research to come at your conclusion.\n\nWhile, for this dataset - this is the most I was able to take from it. There are many more research papers available on the topic which have used more comprehensive data, these are generally one google search away and can be a good starting point for the curious ones.","bfb687ea":"### Changing Directions\n\nThis graph is probably the most visually intriguing in the whole lot. The difference between the elements is so stark that it's really hard to forget what this graph tells us.\n\nHandguns, clearly have been used far more than any other gun. Not only that, bigger guns like AR-15s which were recently in the news actually are virtually non-existant on the graph when comparing to handguns.\n\nThis leads us into a new direction. We can't simply assume ideas, we need to check and verify everything. As a next step, we will try to see how many guns have been used in each incident. This is to check if the counts of handgun uses are higher because they are used both as an independent weapon and as a secondary one.","e7991dc8":"## Final Graphs\n\nWe are limited by our data because of missing values, but we can still juice out some more information from our dataset. The following graphs are the final ones for this document.","9cfd716a":"### Movement around the average\n\nThe horizontal line marks the overall national average of the number of events. We can clearly see that while some states lie markedly below the average, some are way past it. We need to keep in mind two things here. Firstly, not every state has equal population density. While this data does not allow us to do so, building a population densite graph against the number of violence events would have been another option. Secondly, this graph subtly complements the graph we built above with the news sources. Chicago newspapers were the biggest sources of information which falls in line with Illinois being the state with the most events. This can be taken as a minor indication that we might be heading in the right way with our analysis.","ee8edef8":"### An increasing trend\n\nIn both the graphs, we can see a clear increasing trend of gun violence in the country. Later on in our analysis we will try to figure out what allowed this increasing trend. Were mass shootings a big effect in this growing trend or were there other events involved as well?\n\nThe outlier data of 2013 and 2018 should make intuitive sense. The dataset just didn't have enough data from these years to be able to represent them properly.\n\nHowever, these graphs clearly show us that the problem is getting more serious and needs to be tackled on higher priority.","3f5febc7":"### Comprehending the characteristics\n\nThere are a total of around 50 characteristics used in the data in different permutations and combinations to desrcibe each event. The pie chart above displays the most interesting of those characteristics and how many times did they show up in the data.\n\nThere are a couple of interesting ideas that come from this graph. If we look at the blue segment ( Posession of gun(s) during other crimes ) we realize how big of a problem can that be. Generally it would be hard to assume that this would contribute so much to gun violence. Not only that, if we look at the red segment ( posession of gun by felon or prohibited person ) we see a probelm that everyone will accept to fight against, regardless of political affilication but it still eludes our discussions in the mainstream.\n\nFollowing these, we have drug involvement and drive-bys as the biggest contributors but right after that we see that \"Domestic Violence\" turns out as a considerable contributor to the whole issue. We can work more with that because we also have data describing relationships between the participants.","7053f960":"## Visualizing missing values\n\nWhile we have a wide range of data attributes to analyze, we need to understand how many of those attributes hold null values. Other than null, there are some columns with values such as, \"Unknown\". We will deal with such values later on.","e2242e24":"## Gun Trends\n\nWhile we do see an increasing trend in the total number of deaths and injuries, we need to figure out what are the main sources of those injuries and fatalities. We can start by looking at the guns which were used. If we find that assault weapons contributed most to the damage, we know where to direct our efforts in order to solve the problem. Let's see what the graph tells us.","f49d073c":"## Going Deeper\n\nThis dataset has it's own flaws. We have a lot of data missing, which doesn't really allow us to completely rely on our analysis from those parameters.\n\nOne parameter though, that not only gives a lot of information about each incident but also has next to none null values is the \"incident_characteristics\" column. This is mostly text data but it is structured in a way that makes it easier to take data out and analyze it.","183a4c74":"## Initial Analysis\n\nWe will load required libraries and our data and get the basic outlook of our dataset.","2f74d4ea":"## Geographic distribution of shooting events\n\nWhile the problem at hand is one that troubles the whole nation, it is not distributed equally across the country. Some places require extra care and attention to iron out their problems. The following graph should create an intuitive overview of the geographical distribution of the events."}}