{"cell_type":{"55b72a5b":"code","4ac4a29f":"code","ff7c8314":"code","812821c5":"code","0df52a1d":"code","f70d29d2":"code","ab957e65":"code","e2d34775":"code","7f9e1ffe":"code","15a2c45c":"code","e9513c1c":"code","30ba874f":"code","4acd2020":"code","5c84f1a6":"code","f3ccd440":"code","8b4127ce":"code","815341db":"code","69731ee2":"code","45e855c8":"code","594b34de":"code","1e33ba00":"code","bc7c50a4":"code","fd46ea73":"code","f7bc0f22":"code","a582dba6":"code","8bbc07a3":"code","3972759f":"code","eb126f3c":"code","6631b530":"code","d1703206":"code","5767b456":"markdown","0d21d2fa":"markdown","5040d298":"markdown","483e2a58":"markdown","4284eeb2":"markdown","5ff50f6f":"markdown","93abe63e":"markdown","59b22f59":"markdown","c7cd951e":"markdown","5d9bf473":"markdown","95e27517":"markdown","a9651260":"markdown","4106a66a":"markdown","eb7f1aa0":"markdown","8f4438e0":"markdown","aef7fec6":"markdown","cfc6b899":"markdown","a022af57":"markdown","4d74ba9c":"markdown","922c30c4":"markdown","4a5650de":"markdown","598b67ac":"markdown","8cf8180f":"markdown","ca893625":"markdown","b4c0573b":"markdown","4e6af39d":"markdown","515061ae":"markdown","d0100a78":"markdown","7aaf58ad":"markdown","45fb7f00":"markdown","5c4f9de7":"markdown","89741a2f":"markdown","8ff1f74b":"markdown"},"source":{"55b72a5b":"# Import all required modules\nimport pandas as pd\nimport numpy as np\n\n# Disable warnings\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# Import plotting modules\nimport seaborn as sns\nsns.set()\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker\n%matplotlib inline","4ac4a29f":"# Tune the visual settings for figures in `seaborn`\nsns.set_context(\n    \"notebook\", \n    font_scale=1.5,       \n    rc={ \n        \"figure.figsize\": (11, 8), \n        \"axes.titlesize\": 18 \n    }\n)\n\nfrom matplotlib import rcParams\nrcParams['figure.figsize'] = 11, 8","ff7c8314":"df = pd.read_csv('..\/input\/mlbootcamp5_train.csv')\nprint('Dataset size: ', df.shape)\ndf.head()","812821c5":"df_uniques = pd.melt(frame=df, value_vars=['gender','cholesterol', \n                                           'gluc', 'smoke', 'alco', \n                                           'active', 'cardio'])\ndf_uniques = pd.DataFrame(df_uniques.groupby(['variable', \n                                              'value'])['value'].count()) \\\n    .sort_index(level=[0, 1]) \\\n    .rename(columns={'value': 'count'}) \\\n    .reset_index()\nsns.factorplot(x='variable', y='count', hue='value', \n               data=df_uniques, kind='bar', size=12);","0df52a1d":"df_uniques = pd.melt(frame=df, value_vars=['gender','cholesterol', \n                                           'gluc', 'smoke', 'alco', \n                                           'active'], \n                     id_vars=['cardio'])\ndf_uniques = pd.DataFrame(df_uniques.groupby(['variable', 'value', \n                                              'cardio'])['value'].count()) \\\n    .sort_index(level=[0, 1]) \\\n    .rename(columns={'value': 'count'}) \\\n    .reset_index()\ndf_uniques\n\nsns.factorplot(x='variable', y='count', hue='value', \n               col='cardio', data=df_uniques, kind='bar', size=9);","f70d29d2":"for c in df.columns:\n    n = df[c].nunique()\n    print(c)\n    if n <= 3:\n        print(n, sorted(df[c].value_counts().to_dict().items()))\n    else:\n        print(n)\n    print(10 * '-')","ab957e65":"df.head()","e2d34775":"gender1 = df[df['gender'] == 1]['height'].mean()\ngender2 = df[df['gender'] == 2]['height'].mean()\nprint('The 1st gender height is {:.2f} sm \\nThe 2nd gender height is {:.2f} sm.'.format(gender1, gender2))\n\n# So, probably, gender 2 is a male gender","7f9e1ffe":"# Let's count gender values and get the answer.\ndf['gender'].value_counts()\n\n# Answer: 1","15a2c45c":"sns.countplot(x='gender', hue='alco', data=df);\ndf.groupby(['gender'])['alco'].value_counts(normalize=True)\n\n# As we can see from the table and the plot, men (gender 2) reports consuming alcohol more often.\n# Answer: 2","e9513c1c":"sns.countplot(x='gender', hue='smoke', data=df);\n\nsmoking_women = ( (df['gender'] == 1) & (df['smoke'] == 1) ).sum() \/ (df['gender'] == 1).sum()\nsmoking_men = ( (df['gender'] == 2) & (df['smoke'] == 1) ).sum() \/ (df['gender'] == 2).sum()\nshare_diff = smoking_men - smoking_women\n\nprint('Difference between the percentages of smokers among men and women equals: {:.0%}'.format(share_diff))\n# Answer: 3","30ba874f":"nonsmokers_age = df[df['smoke'] == 0]['age'].median() \/ 30\nsmokers_age = df[df['smoke'] == 1]['age'].median() \/ 30\nage_diff = round(nonsmokers_age - smokers_age)\nprint('The difference between median values of age for smokers and non-smokers is {} months'.format(age_diff))\n\n# Answer: 4","4acd2020":"new_data = df.copy()\nage_in_years = round(df['age'] \/ 365.25).astype(int)\nnew_data.insert(2, 'age_years', age_in_years)\n\n\nap_hi_cat = pd.cut(new_data['ap_hi'], \n                   bins=[0, 120, 160, 180], \n                   labels=[1, 2, 3],\n                  include_lowest=True,\n                  right=False)\n\nnew_data.insert(7, 'ap_hi_cat', ap_hi_cat)\n\n# Let's create a temporary subset to answer the following questions\ntemp_df = new_data[(new_data['age_years'] >= 60) & \n                   (new_data['age_years'] <= 64) &\n                   (new_data['gender'] == 2) &\n                   (new_data['smoke'] == 1)]\n\ntemp_df.head()\n\n# Or we can use less elegant solution:\n# def ap_hi_to_categorical(ap_hi):\n#     if ap_hi < 120:\n#         return 'low'\n#     elif 160 <= ap_hi < 180:\n#         return 'high'\n#     return 'normal'\n# age_years['ap_hi_cat'] = age_years['ap_hi'].apply(ap_hi_to_categorical)","5c84f1a6":"# We can see the fractions using groupby()\ntemp_df.groupby(['cholesterol', 'ap_hi_cat'])['cardio'].value_counts(normalize=True).to_frame()\n\n# Or count them directly:\nlow_ap_and_cholesterol_with_cardio_share = temp_df[(temp_df['cholesterol'] == 1) & \n          (temp_df['ap_hi_cat'] == 1)]['cardio'].value_counts(normalize=True)[1]\nhigh_ap_and_cholesterol_with_cardio_share = temp_df[(temp_df['cholesterol'] == 3) & \n          (temp_df['ap_hi_cat'] == 3)]['cardio'].value_counts(normalize=True)[1]\n\nfractions_ratio = high_ap_and_cholesterol_with_cardio_share \/ low_ap_and_cholesterol_with_cardio_share\nprint('Fraction ratio is {:.0f}'.format(fractions_ratio))\n\n# Answer: 3","f3ccd440":"bmi = new_data['weight'] \/ (new_data['height'] \/ 100)**2\nnew_data.insert(5, 'BMI', bmi)\nnew_data.head()","8b4127ce":"# Statement 1:\nmedian_bmi = new_data['BMI'].median() \n18.5 <= median_bmi <= 25 # False","815341db":"# Statement 2:\nnew_data[new_data['gender'] == 1]['BMI'].mean() > new_data[new_data['gender'] == 2]['BMI'].mean() # True ","69731ee2":"# Statement 3:\nnew_data[new_data['cardio'] == 0]['BMI'].mean() > new_data[new_data['cardio'] == 1]['BMI'].mean() # False\n\n# Also, we can use a plot:\nplt.ylim(10, 60) # We limit Y-axis values so outliers do not distort our graph too much\nsns.boxplot(x='cardio', y='BMI', data=new_data);\n\n# We can see that people with the higher BMI tend to have little more CVD. Again, the statement is False.","45e855c8":"# Statement 4\n\nnew_data.groupby(['gender', 'alco', 'cardio'])['BMI'].mean().to_frame()\n\nnondrinking_men = new_data[(new_data['gender'] == 2) & \n                           (new_data['alco'] == 0) &\n                           (new_data['cardio'] == 0)]['BMI'].mean()\nnondrinking_women = new_data[(new_data['gender'] == 1) & \n                             (new_data['alco'] == 0) &\n                             (new_data['cardio'] == 0)]['BMI'].mean()\nprint('Mean BMI for non-drinking men:', round(nondrinking_men, 1))\nprint('Mean BMI for non-drinking women:', round(nondrinking_women, 1))\n\n# Thus, the mean BMI value for healthy men is closer to normal BMI compared to healthy women.\n# Thus, the 4th statement is True\n\n# Answers: 2, 4","594b34de":"# # Just for practice, there're 2 ways:\n# # 1) We're dropping rows where diastolic pressure is higher than systolic:\n# filt_df = new_data[new_data['ap_hi'] > new_data['ap_lo']]\n\n# # 2) We can do the same through drop() as well:\n# dirt_data = new_data[new_data['ap_hi'] <= new_data['ap_lo']]\n# clean_data = new_data.drop(dirt_data.index)\n\n# filt_df.equals(clean_data) # Check if subsets are equal. Returns True.","1e33ba00":"# We've already dropped rows with ap_hi > ap_lo. Next step:\nfilt_df = new_data[(new_data['ap_hi'] > new_data['ap_lo']) & \n                  (new_data['height'] >= new_data['height'].quantile(0.025)) &\n                  (new_data['height'] <= new_data['height'].quantile(0.975)) & \n                  (new_data['weight'] >= new_data['weight'].quantile(0.025)) & \n                  (new_data['weight'] <= new_data['weight'].quantile(0.975))]","bc7c50a4":"filt_df.shape[0] \/ df.shape[0]\n\n# Answer: 3","fd46ea73":"corr = filt_df.corr()\nsns.heatmap(corr, annot=True, fmt='.1f', linewidths=.5, center=0);","f7bc0f22":"# From the correlation matrix we can see that 'Height' and 'Smoke' features \n# has the strongest correlation with gender feature\n# Answer: 2","a582dba6":"df_melt = pd.melt(frame=filt_df, value_vars=['height'], id_vars=['gender'])\ndf_melt\nsns.violinplot(x='variable',y='value', hue='gender', data=df_melt, split=True, scale='count', scale_hue=False);","8bbc07a3":"# let's select required features for a better view:\nfeatures = ['height', 'weight','age', 'cholesterol', 'gluc', 'cardio', 'ap_hi', 'ap_lo', 'smoke', 'alco']\ncorr = filt_df[features].corr(method='spearman')\nsns.heatmap(corr, annot=True, fmt='.1f', linewidths=.5, center=0);\n\n# We can see that among given pairs, Ap_hi - Ap_lo pair has the strongest Spearman correlation\n# Answer: 5","3972759f":"rank_corr = filt_df.corr(method='spearman') \nsns.heatmap(rank_corr, annot=True, fmt='.1f', linewidths=0.5, center=0);","eb126f3c":"plt.xlim(0, 200)\nplt.ylim(0, 300)\nplt.scatter(x=filt_df['ap_lo'], \n            y=filt_df['ap_hi']);","6631b530":"plt.xticks(rotation=90)\nsns.countplot(x=\"age_years\", hue='cardio', data=filt_df);","d1703206":"# Answer: 2","5767b456":"**Question 2.4. (1 point).** What is the smallest age at which the number of people with CVD outnumber the number of people without CVD?\n\n1. 44\n2. 55\n3. 64\n4. 70","0d21d2fa":"** Question 2.1. (1 point).** Which pair of features has the strongest Pearson's correlation with the *gender* feature?\n\n1. Cardio, Cholesterol\n2. Height, Smoke\n3. Smoke, Alco\n4. Height, Weight","5040d298":"Let's get to know our data by performing a preliminary data analysis.\n\n#  Part 1. Preliminary data analysis\n\nFirst, we will initialize the environment:","483e2a58":"# Part 2. Visual data analysis\n\n## 2.1. Correlation matrix visualization\n\nTo understand the features better, you can create a matrix of the correlation coefficients between the features. Use the initial dataset (non-filtered).\n\n### Task:\n\nPlot a correlation matrix using [`heatmap()`](http:\/\/seaborn.pydata.org\/generated\/seaborn.heatmap.html). You can create the matrix using the standard `pandas` tools with the default parameters.","4284eeb2":"**Question 1.6. (2 points). Choose the correct statements:**\n\n1. Median BMI in the sample is within the range of normal BMI values.\n2. The BMI for women is on average higher than for men.\n3. Healthy people have, on average, a higher BMI than the people with CVD.\n4. For healthy, non-drinking men, BMI is closer to the norm than for healthy, non-drinking women","5ff50f6f":"We can see that the target classes are balanced. That's great!\n\nLet's split the dataset by target values. Can you already spot the most significant feature by just looking at the plot?","93abe63e":"## 1.4. Cleaning data","59b22f59":"To make it simple, we will work only with the training part of the dataset:","c7cd951e":"It would be instructive to peek into the values of our variables.\n \nLet's convert the data into *long* format and depict the value counts of the categorical features using [`factorplot()`](https:\/\/seaborn.pydata.org\/generated\/seaborn.factorplot.html).","5d9bf473":"### Task:\n\nCreate a *count plot* using [`countplot()`](http:\/\/seaborn.pydata.org\/generated\/seaborn.countplot.html) with the age on the *X* axis and the number of people on the *Y* axis. Your resulting plot should have two columns for each age, corresponding to the number of people for each *cardio* class of that age.","95e27517":"## 1.3. Analyzing BMI\n### Task:","a9651260":"<center>\n<img src=\"https:\/\/habrastorage.org\/files\/fd4\/502\/43d\/fd450243dd604b81b9713213a247aa20.jpg\">\n\n## [mlcourse.ai](https:\/\/mlcourse.ai) - Open Machine Learning Course\n    \nAuthors: [Ilya Baryshnikov](https:\/\/www.linkedin.com\/in\/baryshnikov-ilya\/), [Maxim Uvarov](https:\/\/www.linkedin.com\/in\/maxis42\/), and [Yury Kashnitsky](https:\/\/www.linkedin.com\/in\/festline\/). Translated and edited by [Inga Kaydanova](https:\/\/www.linkedin.com\/in\/inga-kaidanova-a92398b1\/), [Egor Polusmak](https:\/\/www.linkedin.com\/in\/egor-polusmak\/), [Anastasia Manokhina](https:\/\/www.linkedin.com\/in\/anastasiamanokhina\/), and [Yuanyuan Pao](https:\/\/www.linkedin.com\/in\/yuanyuanpao\/). All content is distributed under the [Creative Commons CC BY-NC-SA 4.0](https:\/\/creativecommons.org\/licenses\/by-nc-sa\/4.0\/) license.","4106a66a":"You will use the `seaborn` library for visual analysis, so let's set that up too:","eb7f1aa0":"## 1.2. Risk maps\n### Task:","8f4438e0":"**Question 1.5. (2 points). Calculate the fraction of the people with CVD for the two segments described above. What is the ratio of these two fractions?**\n\n1. 1\n2. 2\n3. 3\n4. 4","aef7fec6":"**Question 1.7. (2 points). What percent of the original data (rounded) did we throw away?**\n\n1. 8\n2. 9\n3. 10\n4. 11","cfc6b899":"**Question 2.2. (1 point).** Which pair of features has the strongest Spearman correlation?\n\n1. Height, Weight\n2. Age, Weight\n3. Cholesterol, Gluc\n4. Cardio, Cholesterol\n5. Ap_hi, Ap_lo\n6. Smoke, Alco","a022af57":"### Task:\nWe can see that the data is not perfect. It contains \"dirt\" and inaccuracies. We'll see this better as we visualize the data.\n\nFilter out the following patient segments (we consider these as erroneous data)\n\n- diastolic pressure is higher than systolic \n- height is strictly less than 2.5 percentile (Use `pd.Series.quantile` to compute this value. If you are not familiar with the function, please read the docs.)\n- height is strictly more than 97.5 percentile\n- weight is strictly less than 2.5 percentile\n- weight is strictly more than 97.5 percentile\n\nThis is not everything that we can do to clean this data, but this is sufficient for now.","4d74ba9c":"**Question 1.1. (1 point). How many men and women are present in this dataset? Values of the `gender` feature were not given (whether \"1\" stands for women or for men) \u2013 figure this out by looking analyzing height, making the assumption that men are taller on average. **\n1. 45530 women and 24470 men\n2. 45530 men and 24470 women\n3. 45470 women and 24530 men\n4. 45470 men and 24530 women","922c30c4":"## 2.2. Height distribution of men and women\n\nFrom our exploration of the unique values earlier, we know that the gender is encoded by the values *1* and *2*. Although you do not know the mapping of these values to gender, you can figure that out graphically by looking at the mean values of height and weight for each value of the *gender* feature.\n\n### Task:\n\nCreate a violin plot for the height and gender using [`violinplot()`](https:\/\/seaborn.pydata.org\/generated\/seaborn.violinplot.html). Use the parameters:\n- `hue` to split by gender;\n- `scale` to evaluate the number of records for each gender.\n\nIn order for the plot to render correctly, you need to convert your `DataFrame` to *long* format using the `melt()` function from `pandas`. Here is [an example](https:\/\/stackoverflow.com\/a\/41575149\/3338479) of this for your reference.","4a5650de":"Create a new feature \u2013 BMI ([Body Mass Index](https:\/\/en.wikipedia.org\/wiki\/Body_mass_index)). To do this, divide weight in kilogramms by the square of the height in meters. Normal BMI values are said to be from 18.5 to 25. ","598b67ac":"**Question 2.3. (1 point).** Why do these features have strong rank correlation?\n\n1. Inaccuracies in the data (data acquisition errors).\n2. Relation is wrong, these features should not be related.\n3. Nature of the data.","8cf8180f":"## 2.3. Rank correlation\n\nIn most cases, *the Pearson coefficient of linear correlation* is more than enough to discover patterns in data. \nBut let's go a little further and calculate a [rank correlation](https:\/\/en.wikipedia.org\/wiki\/Rank_correlation). It will help us to identify such feature pairs in which the lower rank in the variational series of one feature always precedes the higher rank in the another one (and we have the opposite in the case of negative correlation).\n\n### Task:\n\nCalculate and plot a correlation matrix using the [Spearman's rank correlation coefficient](https:\/\/en.wikipedia.org\/wiki\/Spearman%27s_rank_correlation_coefficient).\n","ca893625":"**Question 1.2. (1 point). Which gender more often reports consuming alcohol - men or women?**\n1. women\n2. men","b4c0573b":"**Question 1.3. (1 point). What is the difference between the percentages of smokers among men and women (rounded)?**\n1. 4\n2. 16\n3. 20\n4. 24","4e6af39d":"On the website for the European Society of Cardiology, a [SCORE scale](https:\/\/www.escardio.org\/Education\/Practice-Tools\/CVD-prevention-toolbox\/SCORE-Risk-Charts) is provided. It is used for calculating the risk of death from a cardiovascular decease in the next 10 years. Here it is:\n<img src=https:\/\/habrastorage.org\/webt\/ik\/gx\/hr\/ikgxhr3w1vzqihgitgrbdorfb14.png width=30%>\n\nLet's take a look at the upper-right rectangle, which shows a subset of smoking men aged from 60 to 65. (It's not obvious, but the values in the figure represent the upper bound).\n\nWe see the value 9 in the lower-left corner of the rectangle and 47 in the upper-right. This means that, for people in this gender-age group whose systolic pressure is less than 120, the risk of a CVD is estimated to be 5 times lower than for those with the pressure in the interval [160,180).\n\nLet's calculate that same ratio using our data.\n\nClarifications:\n- Calculate ``age_years`` feature \u2013 round age to the nearest number of years. For this task, select only the people of age 60 to 64, inclusive.\n- Cholesterol level categories differ between the figure and our dataset. The conversion for the ``cholesterol`` feature is as follows: 4 mmol\/l $\\rightarrow$ 1, 5-7 mmol\/l $\\rightarrow$ 2, 8 mmol\/l $\\rightarrow$ 3.","515061ae":"# <center>Assignment #2 (demo)\n## <center>Analyzing cardiovascular disease data ","d0100a78":"**Question 1.4. (1 point). What is the difference between median values of age for smokers and non-smokers (in months, rounded)? You'll need to figure out the units of feature `age` in this dataset.**\n\n1. 5\n2. 10\n3. 15\n4. 20","7aaf58ad":"You can see that the distribution of cholesterol and glucose levels great differs by the value of the target variable. Is this a coincidence?\n\nNow, let's calculate some statistics for the feature unique values:","45fb7f00":"## 1.1. Basic observations","5c4f9de7":"In this assignment, you will answer questions about a dataset on cardiovascular disease. You do not need to download the data: it is already in the repository. There are some Tasks that will require you to write code. Complete them and then answer the questions in the [form](https:\/\/docs.google.com\/forms\/d\/13cE_tSIb6hsScQvvWUJeu1MEHE5L6vnxQUbDYpXsf24). \n\n#### Problem\n\nPredict the presence or absence of cardiovascular disease (CVD) using the patient examination results.\n\n#### Data description\n\nThere are 3 types of input features:\n\n- *Objective*: factual information;\n- *Examination*: results of medical examination;\n- *Subjective*: information given by the patient.\n\n| Feature | Variable Type | Variable      | Value Type |\n|---------|--------------|---------------|------------|\n| Age | Objective Feature | age | int (days) |\n| Height | Objective Feature | height | int (cm) |\n| Weight | Objective Feature | weight | float (kg) |\n| Gender | Objective Feature | gender | categorical code |\n| Systolic blood pressure | Examination Feature | ap_hi | int |\n| Diastolic blood pressure | Examination Feature | ap_lo | int |\n| Cholesterol | Examination Feature | cholesterol | 1: normal, 2: above normal, 3: well above normal |\n| Glucose | Examination Feature | gluc | 1: normal, 2: above normal, 3: well above normal |\n| Smoking | Subjective Feature | smoke | binary |\n| Alcohol intake | Subjective Feature | alco | binary |\n| Physical activity | Subjective Feature | active | binary |\n| Presence or absence of cardiovascular disease | Target Variable | cardio | binary |\n\nAll of the dataset values were collected at the moment of medical examination.","89741a2f":"## 2.4. Age\n\nPreviously, we calculated the age of the respondents in years at the moment of examination.","8ff1f74b":"In the end, we have:\n- 5 numerical features (excluding *id*);\n- 7 categorical features;\n- 70000 records in total."}}