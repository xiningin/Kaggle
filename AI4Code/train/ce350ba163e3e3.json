{"cell_type":{"6be0ff18":"code","5a026a5d":"code","56178ce7":"code","ca82c261":"code","3cc1b6d8":"code","f9949649":"code","155b61c1":"code","348926ca":"code","d6ebe62c":"code","b22ab847":"code","f16a2939":"code","51435b9f":"markdown","0be24b89":"markdown","20983a9a":"markdown","79dbb289":"markdown","7df25575":"markdown","47130b61":"markdown"},"source":{"6be0ff18":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport glob\nimport xarray\nimport re\nfrom datetime import datetime\n\nimport holoviews as hv\nhv.extension('matplotlib')\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\n#import os\n#for dirname, _, filenames in os.walk('\/kaggle\/input'):\n#    for filename in filenames:\n#        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","5a026a5d":"files = sorted(glob.glob(\"\/kaggle\/input\/ds4g-environmental-insights-explorer\/eie_data\/s5p_no2\/s5p_no2_201807*.tif\"))","56178ce7":"ds = xarray.concat([xarray.open_rasterio(f) for f in files], dim=\"time\")\n\nds","ca82c261":"ds.name = \"no2\"\ntimes = []\nfor f in sorted(glob.glob(\"\/kaggle\/input\/ds4g-environmental-insights-explorer\/eie_data\/s5p_no2\/s5p_no2_201807*.tif\")):\n    t = re.search(\"([0-9]{8}T[0-9]{6})\", f)[0]\n    times.append(datetime.strptime(t, \"%Y%m%dT%H%M%S\"))\n\nds.coords[\"time\"]= times","3cc1b6d8":"ds","f9949649":"ds.isel(time=0, band=0).plot(size=6);","155b61c1":"hds = hv.Dataset(ds.isel(band=0), name='testdata').to(hv.Image, kdims=['x', 'y']).options(fig_inches=(10, 3), colorbar=True, cmap='viridis')\n\nhds","348926ca":"print(ds.isel(band=0).mean().values) # This selects by index\nprint(ds.sel(band=1).mean().values) # This selects by value","d6ebe62c":"single_loc = ds.sel(band=1, y=18.2, x=-66.25, method='nearest')\n\nsingle_loc","b22ab847":"single_loc.plot(size=6);","f16a2939":"single_loc.mean().values","51435b9f":"Next, let's make some plots of our dataset, first with the built-in Xarray `plot` method, and then with the [holoviews package](http:\/\/holoviews.org\/index.html), which is more powerful but also has a steeper learning curve:","0be24b89":"What's the mean NO2 concentration over the whole period?","20983a9a":"Next, let's try getting the mean NO2 concentration at powerplant locations. First, let's figure out how to extract the values at the single location (`y=18.2, x=-66.25`):","79dbb289":"What is the mean NO2 concentration for July 2018 at this location? (Note: At this point we would usually want to stop and think about what to do about all the missing values, which we're not going to worry about here.)","7df25575":"First, let's open our images. The machine we are using doesn't have enough memory to open them all at the same time, so we'll just open the ones for July of 2018.","47130b61":"Next, let's add some metadata to our array that is necessary for plotting. We need to set the timestamp of each \"time\" in our array, which is the found in the filename of the tiff file, so we can google `python extract date from filename` which returns this result: https:\/\/stackoverflow.com\/questions\/7728694\/python-regex-how-to-extract-date-from-filename-using-regular-expression."}}