{"cell_type":{"7647796c":"code","2218b636":"code","d4019d87":"code","28b1ebf6":"code","c58dadc7":"code","4d4141f7":"code","d9590c55":"code","0bb0f9d4":"code","5294c028":"code","8713a51d":"code","0e50ce69":"code","6b12b1eb":"code","10811c4c":"code","1a44e8d8":"code","7fe12404":"code","ea4aed28":"code","728f0aed":"code","dd970780":"code","c960f219":"code","cf7060dd":"code","460ae192":"code","1bf296be":"markdown","173e14fa":"markdown"},"source":{"7647796c":"import pandas as pd\nimport statsmodels.api as sm\nimport statsmodels.formula.api as smf\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.cluster import KMeans\ncolor = sns.color_palette()\nfrom IPython.core.display import display, HTML\ndisplay(HTML(\"<style>.container { width:100% !important; }<\/style>\"))\n%matplotlib inline","2218b636":"attendance_valuation_elo_df = pd.read_csv(\"..\/input\/nba_2017_att_val_elo.csv\")\nsalary_df = pd.read_csv(\"..\/input\/nba_2017_salary.csv\")\npie_df = pd.read_csv(\"..\/input\/nba_2017_pie.csv\")\nplus_minus_df = pd.read_csv(\"..\/input\/nba_2017_real_plus_minus.csv\")\nbr_stats_df = pd.read_csv(\"..\/input\/nba_2017_br.csv\")","d4019d87":"plus_minus_df.rename(columns={\"NAME\":\"PLAYER\", \"WINS\": \"WINS_RPM\"}, inplace=True)\nplayers = []\nfor player in plus_minus_df[\"PLAYER\"]:\n    plyr, _ = player.split(\",\")\n    players.append(plyr)\nplus_minus_df.drop([\"PLAYER\"], inplace=True, axis=1)\nplus_minus_df[\"PLAYER\"] = players","28b1ebf6":"nba_players_df = br_stats_df.copy()\nnba_players_df.rename(columns={'Player': 'PLAYER','Pos':'POSITION', 'Tm': \"TEAM\", 'Age': 'AGE', \"PS\/G\": \"POINTS\"}, inplace=True)\nnba_players_df.drop([\"G\", \"GS\", \"TEAM\"], inplace=True, axis=1)\nnba_players_df = nba_players_df.merge(plus_minus_df, how=\"inner\", on=\"PLAYER\")","c58dadc7":"print(pd.isnull(nba_players_df).sum())\nnba_players_detailed = nba_players_df.drop(['3P%', '2P%','FT%','POINTS','TEAM'], axis=1)","4d4141f7":"numerical_df = nba_players_detailed.ix[:,4:27]\nnumerical_df = numerical_df.apply(pd.to_numeric, errors='coerce')\nnumerical_df.head()","d9590c55":"from sklearn.preprocessing import MinMaxScaler\nscaler = MinMaxScaler()\nprint(scaler.fit(numerical_df))\nprint(scaler.transform(numerical_df))","0bb0f9d4":"distortions = []\nfor i in range(1, 11):\n    km = KMeans(n_clusters=i,\n            init='k-means++',\n            n_init=10,\n            max_iter=300,\n            random_state=0)\n    km.fit(scaler.transform(numerical_df))\n    distortions.append(km.inertia_)\n    \nplt.plot(range(1,11), distortions, marker='o')\nplt.xlabel('Number of clusters')\nplt.ylabel('Distortion')\nplt.title(\"Detailed Indicators Elbow Method Cluster Analysis\")\nplt.show()","5294c028":"from sklearn.cluster import KMeans\nk_means = KMeans(n_clusters=3)\nkmeans = k_means.fit(scaler.transform(numerical_df))","8713a51d":"nba_players_km = nba_players_df[[\"Rk\",\"PLAYER\",\"POSITION\",\"AGE\",\"POINTS\",\"TEAM\",\"RPM\",\"WINS_RPM\"]].copy()\nnba_players_km['cluster'] = kmeans.labels_\nnba_players_km.head()","0e50ce69":"pie_df_subset = pie_df[[\"PLAYER\", \"PIE\", \"PACE\", \"W\"]].copy()\nnba_players_km = nba_players_km.merge(pie_df_subset, how=\"inner\", on=\"PLAYER\")\nnba_players_km.head()","6b12b1eb":"salary_df.rename(columns={'NAME': 'PLAYER'}, inplace=True)\nsalary_df[\"SALARY_MILLIONS\"] = round(salary_df[\"SALARY\"]\/1000000, 2)\nsalary_df.drop([\"POSITION\",\"TEAM\", \"SALARY\"], inplace=True, axis=1)\nsalary_df.head()\nnba_players_km_salary = nba_players_km.merge(salary_df,how=\"inner\", on=\"PLAYER\")\nnba_players_km_salary.head()","10811c4c":"plt.subplots(figsize=(10,8))\nax = plt.axes()\nax.set_title(\"NBA Player Correlation Heatmap:  2016-2017 Season (STATS & SALARY)\")\ncorr = nba_players_km_salary.corr()\nsns.heatmap(corr, \n            xticklabels=corr.columns.values,\n            yticklabels=corr.columns.values, cmap=\"Blues\")","1a44e8d8":"#EDA for relationship between Wins_RPM and other variables\nsns.lmplot(x=\"POINTS\", y=\"WINS_RPM\", data=nba_players_km_salary); \nsns.lmplot(x=\"RPM\", y=\"WINS_RPM\", data=nba_players_km_salary);\nsns.lmplot(x=\"cluster\", y=\"WINS_RPM\", data=nba_players_km_salary);\nsns.lmplot(x=\"SALARY_MILLIONS\", y=\"WINS_RPM\", data=nba_players_km_salary);","7fe12404":"import numpy as np\nfrom matplotlib import cm\nfrom sklearn.metrics import silhouette_samples\nkm = KMeans(n_clusters=3,\n            init='k-means++',\n            n_init=10,\n            max_iter=300,\n            random_state=0)\ny_km = km.fit_predict(scaler.transform(numerical_df))\ncluster_labels = np.unique(y_km)\nn_clusters = cluster_labels.shape[0]\nsilhouette_vals = silhouette_samples(scaler.transform(numerical_df),\n                                     y_km,\n                                     metric='euclidean')\ny_ax_lower, y_ax_upper = 0, 0\nyticks = []\nfor i, c in enumerate(cluster_labels):\n    c_silhouette_vals = silhouette_vals[y_km == c]\n    c_silhouette_vals.sort()\n    y_ax_upper += len(c_silhouette_vals)\n    color = cm.jet(float(i)\/n_clusters)\n    plt.barh(range(y_ax_lower, y_ax_upper), c_silhouette_vals, height=1.0, edgecolor='none',color=color)\n    yticks.append((y_ax_lower + y_ax_upper)\/2)\n    y_ax_lower += len(c_silhouette_vals)\nsilhouette_avg = np.mean(silhouette_vals)\nplt.axvline(silhouette_avg,\n            color=\"red\",\n            linestyle=\"--\")\nplt.yticks(yticks, cluster_labels + 1)\nplt.ylabel('Cluster')\nplt.xlabel('Silhouette coefficient')\nplt.title('Silhouette Plot Team Valuation')\nplt.figure(figsize=(20,10))\nplt.show()","ea4aed28":"results = smf.ols(' WINS_RPM~cluster', data=nba_players_km_salary).fit()","728f0aed":"print(results.summary())","dd970780":"results = smf.ols('WINS_RPM ~RPM', data=nba_players_km_salary).fit()","c960f219":"print(results.summary())","cf7060dd":"results = smf.ols(formula='WINS_RPM ~ POINTS+RPM+cluster+SALARY_MILLIONS', data=nba_players_km_salary).fit()","460ae192":"print(results.summary())","1bf296be":"**##Elbow method shows that 3 clusters is decent choice**","173e14fa":"> ![](http:\/\/)Exploration of the features that can impact player's Wins RPM "}}