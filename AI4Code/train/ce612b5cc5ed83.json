{"cell_type":{"cc75f971":"code","9eb932a9":"code","71a32abd":"code","ddff2380":"code","84f0cdfa":"code","d33dab37":"markdown","3b587638":"markdown","54f6e21f":"markdown","8c61bfa0":"markdown","ff0de65d":"markdown","2e989e10":"markdown","9c08d083":"markdown","ab5f05d3":"markdown","d2b2cda8":"markdown"},"source":{"cc75f971":"import os\nimport numpy as np\nimport pandas as pd\nimport pydicom\n\nfrom skimage.measure import label,regionprops\nfrom skimage.segmentation import clear_border\nimport matplotlib.pyplot as plt","9eb932a9":"! pip install git+https:\/\/github.com\/JoHof\/lungmask","71a32abd":"import SimpleITK as sitk\nfrom lungmask import mask as lungmask_mask\n\n# credit to: https:\/\/www.kaggle.com\/c\/rsna-str-pulmonary-embolism-detection\/discussion\/183161#1012049\ndef get_lung_mask(f):\n    series_IDs = sitk.ImageSeriesReader.GetGDCMSeriesIDs(f)\n    sorted_file_names = sitk.ImageSeriesReader.GetGDCMSeriesFileNames(f, series_IDs[0])\n    series_reader = sitk.ImageSeriesReader()\n    series_reader.SetFileNames(sorted_file_names)\n    series_reader.MetaDataDictionaryArrayUpdateOn()\n    series_reader.LoadPrivateTagsOn()\n    image = series_reader.Execute()\n    segmentation = (lungmask_mask.apply(image) > 0).astype('uint8')\n    return segmentation, image, sorted_file_names\n\n\nexample = '\/kaggle\/input\/rsna-str-pulmonary-embolism-detection\/train\/b4548bee81e8\/ac1aea5d7662\/'\nout_put = get_lung_mask(example)","ddff2380":"out_put[0].shape","84f0cdfa":"\nimport matplotlib.pyplot as plt\nplt.imshow(out_put[0][120])\nplt.show()","d33dab37":"# Intro & Package Install","3b587638":"Let's see the shape of the segmentation array: ","54f6e21f":"I wrote a function to apply lung mask on `dicom` images. It worked for `OSIC Competition` on [this kernel](https:\/\/www.kaggle.com\/smerllo\/lung-mask-using-u-net-r231) but it returned an error for me. [i-pan](https:\/\/www.kaggle.com\/vaillant) helped me with a more suitable function as below to apply the mask on each patient","8c61bfa0":"Some of the masks are empty ","ff0de65d":"Following a quick implementation of a Deep learning approach for lung segmentation based on U-net pre-trained Models : \n* **U-net(R231)**\n* **U-net(LTRCLobes)**\n* **U-net(LTRCLobes_R231)**","2e989e10":"# **Lung Mask with U-Net**","9c08d083":"# Mask using U-net(R231) Lung CT-Scan","ab5f05d3":"![lung-mask](https:\/\/raw.githubusercontent.com\/JoHof\/lungmask\/master\/figures\/figure.png)","d2b2cda8":"I hope this helps."}}