{"cell_type":{"52764b1f":"code","646f95a5":"code","27fbf137":"code","24dc8164":"code","30ecf34b":"code","cc3e6601":"code","7dce2f19":"code","7018d44d":"code","bdadcc96":"code","a9e36731":"code","4a95d11e":"code","b52dec7f":"code","b6692b99":"code","11bfdf26":"code","8a4219f9":"code","1746b783":"code","d643d147":"code","b195f567":"code","69774d71":"code","11971d88":"code","9a4610a4":"code","12b62a79":"code","f60a7b10":"code","6d674039":"code","5fd4ca90":"code","4dfff207":"code","efbffabf":"code","a85388cb":"code","24b224e6":"code","cb214e3b":"code","e22d3fd3":"code","077f5aef":"code","191ec14d":"markdown","77a0f8a4":"markdown","5b43ace2":"markdown","910ed071":"markdown","fc1ec566":"markdown","851eb227":"markdown","c845a966":"markdown","aafedec1":"markdown","2d665359":"markdown","e00adfb0":"markdown","1d097239":"markdown","c68d10a1":"markdown","ce9156f9":"markdown","f8c8d309":"markdown","5b5dffc8":"markdown","8d009d3f":"markdown","a19cf431":"markdown","437b675e":"markdown","b36a0500":"markdown","38227d92":"markdown","0dc94b0f":"markdown","90cd1e0a":"markdown","a9eac59b":"markdown","36f92f52":"markdown","23789229":"markdown","d52f2e4c":"markdown","3e5e5cdd":"markdown"},"source":{"52764b1f":"import numpy as np\nimport pandas as pd\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\nimport plotly.express as px\nimport plotly.graph_objs as go\n\nfrom plotly.offline import iplot, init_notebook_mode\nimport cufflinks\ncufflinks.go_offline(connected=True)\ninit_notebook_mode(connected=True)\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","646f95a5":"manu = pd.read_csv(\"\/kaggle\/input\/covid-world-vaccination-progress\/country_vaccinations_by_manufacturer.csv\")\nmanu['date'] = pd.to_datetime(manu.date)\n\ncountry = pd.read_csv(\"\/kaggle\/input\/covid-world-vaccination-progress\/country_vaccinations.csv\")\ncountry['date'] = pd.to_datetime(country.date)","27fbf137":"manu.head()","24dc8164":"manu.location.unique()","30ecf34b":"#temporarily set max max_colwidth to None\npd.set_option('display.max_colwidth', None)\ncountry[['country', 'date', 'vaccines']].head()","cc3e6601":"#strip text\ncountry['vaccines'] = country['vaccines'].str.replace(\"\/Beijing|\/Wuhan|\/HayatVax|\/BioNTech|Oxford\/\", \"\", regex=True)\n\n#replace with Chinese vaccins\ncountry['vaccines'] = country['vaccines'].str.replace(\"Sinopharm|BBIBP-CorV|Sinovac|CanSino|RBD-Dimer|Medigen|ZF2001\", \"Chinese\", regex=True)\n\n#replace with Russian vaccins\ncountry['vaccines'] = country['vaccines'].str.replace(\"EpiVacCorona|Sputnik V|Sputnik Light\", \"Russian\", regex=True)\n\n#replace with Cuban vaccins\ncountry['vaccines'] = country['vaccines'].str.replace(\"Soberana02|Abdala\", \"Cuban\", regex=True)\n\n#replace some others\nto_replace = {'Covaxin': 'Indian',\n              'QazVac': 'Kazachstan',\n              'COVIran Barekat': 'Iran'}\ncountry['vaccines'] = country['vaccines'].replace(to_replace, regex=True)","7dce2f19":"#making a list of all vaccins\nvac_list = [x.split(\", \") for x in country.vaccines.values]\nvaccins = [item for elem in vac_list for item in elem]\nvaccins = set(vaccins)\nvaccins = list(vaccins)\n\n#adding a column with True\/False for each vaccin\nfor vaccin in vaccins:\n    country[vaccin] = np.where(country['vaccines'].str.contains(vaccin), True, False)\n\ncountry = country.sort_values(by = ['country', 'date'], ascending = [True, False])\ncountry_latest = country.drop_duplicates(subset = \"country\", keep = \"first\")\n\n#head of selected columns only\ncountry_latest.iloc[:, np.r_[0,12, 15:len(country_latest.columns)]].head()","7018d44d":"def plot_vaccin(color, vaccin):\n    fig = px.choropleth(country_latest, locations=\"iso_code\",\n                        color=vaccin,\n                        hover_name=\"country\",\n                        color_discrete_map={True: color, False: 'lightgrey'})\n\n    layout = go.Layout(\n        title=go.layout.Title(\n            text= f\"<b>Countries using {vaccin} vaccin<\/b>\",\n            x=0.5\n        ),\n        showlegend=False,\n        font=dict(size=14),\n        width = 750,\n        height = 350,\n        margin=dict(l=0,r=0,b=0,t=30)\n    )\n\n    fig.update_layout(layout)\n\n    fig.show()","bdadcc96":"plot_vaccin('red', 'Pfizer')","a9e36731":"plot_vaccin('green', \"Moderna\")","4a95d11e":"plot_vaccin('brown', \"AstraZeneca\")","b52dec7f":"plot_vaccin('orange', \"Johnson&Johnson\")","b6692b99":"plot_vaccin('blue', \"Chinese\")","11bfdf26":"plot_vaccin('yellow', \"Russian\")","8a4219f9":"plot_vaccin('magenta', \"Indian\")","1746b783":"plot_vaccin('goldenrod', \"Cuban\")","d643d147":"plot_vaccin('darkblue', \"Kazachstan\")","b195f567":"plot_vaccin('lightblue', \"Iran\")","69774d71":"country_latest['Vaccins_used']= country_latest.iloc[:, -9:].sum(axis=1)\ncountry_latest.Vaccins_used.value_counts()","11971d88":"#function as I will make a similar map later\ndef plot_ww_numbers(data, color, hover_data, title):\n    fig = px.choropleth(data, locations=\"iso_code\",\n                        color= color,\n                        hover_data= hover_data)\n\n    layout = go.Layout(title=go.layout.Title(\n        text= f\"<b>{title}<\/b>\",\n        x=0.5\n        ),\n        font=dict(size=14),\n        width = 750,\n        height = 350,\n        margin=dict(l=0,r=0,b=0,t=30)\n                      )\n\n    fig.update_layout(layout)\n\n    fig.show()\n","9a4610a4":"plot_ww_numbers(data = country_latest,\n                color = 'Vaccins_used',\n                hover_data= [\"country\", \"vaccines\"],\n                title = 'Number of different vaccines used by country')","12b62a79":"non_european = ['Chile', 'United States', 'Uruguay', 'Ecuador', 'European Union', 'Hong Kong', 'Japan', 'South Korea']\nmanu = manu.query('location not in @non_european')\nmanu.location.nunique()","f60a7b10":"manu[manu.location == \"Netherlands\"].tail(8)","6d674039":"manu_totals = manu.copy()\n\n#keeping only the latest info\nmanu_totals = manu_totals.sort_values(by = ['location', 'date', 'vaccine'], ascending = [True, False, True])\nmanu_totals = manu_totals.drop(columns = \"date\")\nmanu_totals = manu_totals.drop_duplicates(subset = ['location', 'vaccine'], keep = \"first\")\n\nmanu_totals = manu_totals.pivot(index = ['location'], columns = 'vaccine', values = 'total_vaccinations')\nmanu_totals = manu_totals.fillna(0)\nmanu_totals.iloc[:, -6:] = manu_totals.iloc[:, -6:].astype(int)\n\n#convert to percent\ncols = list(manu_totals.columns)\nmanu_totals[cols] = manu_totals[cols].div(manu_totals[cols].sum(axis=1), axis=0).multiply(100)\nmanu_totals = manu_totals.round(1)\n                                \n#adding ISO codes from my own dataset https:\/\/www.kaggle.com\/erikbruin\/countries-of-the-world-iso-codes-and-population\ncountries_iso = pd.read_csv(\"..\/input\/countries-of-the-world-iso-codes-and-population\/country_codes_2020.csv\")\ncountries_iso = countries_iso.rename(columns = {'name': 'location', 'cca3': 'iso_code'})\n\nmanu_totals = manu_totals.reset_index()\nmanu_totals = manu_totals.merge(countries_iso[['location', 'iso_code']], on = 'location', how = \"left\")\n\nmanu_totals['mRNA'] = manu_totals['Moderna'] + manu_totals['Pfizer\/BioNTech']\nmanu_totals.head()","5fd4ca90":"fig = px.choropleth(manu_totals, locations=\"iso_code\",\n                    color='mRNA',\n                    hover_data= [\"location\"])\n\nlayout = go.Layout(\n    title=go.layout.Title(\n        text= f\"<b>Percent mRNA vaccines used by country<\/b>\",\n        x=0.5\n    ),\n    font=dict(size=14),\n    autosize=False,\n    width = 800,\n    height = 600,\n    margin=dict(l=0,r=0,b=0,t=30)\n)\nfig.update_geos(scope=\"europe\")\nfig.update_layout(layout)\n\nfig.show()\n","4dfff207":"manu_totals[manu_totals.location == \"Hungary\"]","efbffabf":"manu = manu.sort_values(by=['location', 'vaccine', 'date'], ascending = [True, True, False])\nmanu = manu.reset_index(drop=True)\n\nmanu['new'] = 0\nfor i in range(len(manu)-1):\n    if ((manu.loc[i+1, 'vaccine'] == manu.loc[i, 'vaccine']) & (manu.loc[i+1, 'location'] == manu.loc[i, 'location'])):\n        manu.loc[i, 'new'] = (manu.loc[i, 'total_vaccinations'] - manu.loc[i+1, 'total_vaccinations'])\n    else:\n        manu.loc[i, 'new'] = manu.loc[i, 'total_vaccinations']\n        \nnew_vaccines = manu[['date', 'vaccine', 'new']]\n\ndf = new_vaccines[['date', 'vaccine']]\ndf.drop_duplicates(inplace = True)\ndf = df.sort_values(by = ['vaccine', 'date'], ascending = [True, False]).reset_index(drop=True)\ndf['before'] = 0\n\nfor i,row in df.iterrows():\n    total_before = new_vaccines[((new_vaccines.vaccine == row.vaccine) & (new_vaccines.date <= row.date))]['new'].sum()\n    df.loc[i, 'before'] = total_before\n    \ndf = df.pivot(index= 'date', columns = 'vaccine', values = 'before')\ndf = df[['Johnson&Johnson', 'Moderna', 'Oxford\/AstraZeneca', 'Pfizer\/BioNTech']] #getting rid of Sputnik and Sinopharm","a85388cb":"df.iplot(mode = 'lines', xTitle = 'Date', yTitle = 'Total vaccinations', title = 'Cumulative vaccinations in Europe by vaccine')","24b224e6":"#calculating population\ncountry_latest['population'] = round((country['total_vaccinations']\/country['total_vaccinations_per_hundred']*100), 0)\n\ncols_to_keep = ['country', 'iso_code', 'total_vaccinations', 'total_vaccinations_per_hundred', 'population']\ncountry_latest[cols_to_keep].sort_values(by = \"total_vaccinations_per_hundred\", ascending = [False]).head(10)","cb214e3b":"#rename to make name short for legend\ncountry_latest = country_latest.rename(columns = {'total_vaccinations_per_hundred': 'per 100'})\n\n#taking out very small countries at least gets rid of outlier Gibraltar (want to keep Emirates with nearly 10 million population)\nplot_ww_numbers(data = country_latest[country_latest.population > 50000],\n                color = 'per 100',\n                hover_data= [\"country\"],\n                title = 'Total vaccines given per country per 100 inhabitants')","e22d3fd3":"#adding continent codes from my own dataset https:\/\/www.kaggle.com\/erikbruin\/countries-of-the-world-iso-codes-and-population\ncols_to_load = ['Three_Letter_Country_Code', 'Continent_Name']\ncontinents = pd.read_csv(\"..\/input\/countries-of-the-world-iso-codes-and-population\/country-and-continent-codes-list-csv.csv\")[cols_to_load]\ncontinents = continents.rename(columns = {'Three_Letter_Country_Code': 'iso_code'})\n\ncountry_latest = country_latest.merge(continents, on = \"iso_code\", how = \"inner\")\ncontinent_latest = country_latest.copy()\ncontinent_latest = continent_latest[['Continent_Name', 'country', 'iso_code', 'population', 'total_vaccinations']]\n\n#assign Russia, Turkey to Asia\ncontinent_latest = continent_latest.sort_values(by = ['iso_code', 'Continent_Name'], ascending = [True, True])\ncontinent_latest = continent_latest.drop_duplicates(subset = \"iso_code\", keep = \"first\")\n\n#info from 3 countries is missing. Remove them to keep it simple\ncontinent_latest = continent_latest[continent_latest.total_vaccinations.notna()]\n\ncontinent_latest[['population', 'total_vaccinations']] = continent_latest[['population', 'total_vaccinations']].astype(int)\n\ncontinent_latest['continent_population'] = continent_latest.groupby('Continent_Name')['population'].transform('sum')\ncontinent_latest['continent_vaccinations'] = continent_latest.groupby('Continent_Name')['total_vaccinations'].transform('sum')\ncontinent_latest['per 100'] = round(((continent_latest['continent_vaccinations']\/continent_latest['continent_population'])*100), 1)","077f5aef":"plot_ww_numbers(data = continent_latest,\n                color = 'per 100',\n                hover_data= [\"country\", \"Continent_Name\"],\n                title = 'Total vaccines given per continent per 100 inhabitants')","191ec14d":"Besides Russia itself, there is a significant number of countries also using Russian vaccins (I suppose mostly Sputnik as I had not heard about the other Russian vaccin yet).","77a0f8a4":"## 2.4 Usage of vaccines in Europe over time\n","5b43ace2":"Now, I want to keep the best-known vaccins (Pfizer, Moderna, AstraZeneca and Johnson&Johnson) as they are and group lesser-known brands into the countries where they are made.","910ed071":"In the code below, I am converting the numbers to cumulative percentages to-date for each country. In addition, I am making another column with the cumulative percentage of mRNA vaccines (Pfizer and Moderna) used as this is what I am interested in this time.","fc1ec566":"# 1. Loading and preparing data","851eb227":"Chinese brands are used in a lot of Asian countries and also almost all South American countries use at least some Chinese vaccins. Compared to the previous version, I am now also seeing a lot of African countries using Chinese vaccines.","c845a966":"The file with country vaccinations by manufacturer seems most promising as it holds detailed information the vaccinations given per vaccine per date per country.","aafedec1":"By just checking some info of my own country, I see that the numbers are clearly cumulatief.","2d665359":"In the previous version, the Cuban vaccines were only used in Cuba itself. Now, Nicaragua, Venezuela and Iran are also using these vaccines.","e00adfb0":"# Covid vaccines used by country worldwide\n\nAs I was curious about the usage of the different vaccins worldwide, I decided to make a Notebook about it. As Gabriel Preda already made a dataset with the required data downloaded from Our World in Data, I am using his dataset. The intial notebook was made a while ago, but updated with the latest available data on December 4th, 2021.\n\n## Table of contents\n[**1. Loading and preparing data**](#1.-Loading-and-preparing-data)\n\n[**2. Which vaccines are used where?**](#2.-Which-vaccines-are-used-where?)\n\n[2.1 Worldwide usage maps by vaccin](#2.1-Worldwide-usage-maps-by-vaccin)\n\n[2.2 Worldwide map plotting the number of vaccines used by country](#2.2-Worldwide-map-plotting-the-number-of-vaccines-used-by-country)\n\n[2.3 Usage of vaccines in Europe by country](#2.3-Usage-of-vaccines-in-Europe-by-country)\n\n[2.4 Usage of vaccines in Europe over time](#2.4-Usage-of-vaccines-in-Europe-over-time)\n\n[**3. Overall vaccination rates**](#3.-Overall-vaccination-rates)\n\n[3.1 Vaccination rates by country](#3.1-Vaccination-rates-by-country)\n\n[3.2 Vaccination rates by continent](#3.2-Vaccination-rates-by-continent)\n","1d097239":"# 3. Overall vaccination rates\n\n## 3.1 Vaccination rates by country","c68d10a1":"## 3.2 Vaccination rates by continent\n\nAdding the continents leads to some duplicates as for instance parts of Russia and Turkey are European and other parts Asia. To keep it simple, I am assigning those countries to Asia.\n\nWe see that vaccination rates in Europe and South America are highest, and African overall vaccination rate is low. Although difference are small, I think that the high vaccination rate in South America may come as a surprise to some people.","ce9156f9":"## 2.2 Worldwide map plotting the number of vaccines used by country\n\nAs you can see, many countries use up to three different vaccines.","f8c8d309":"Now, I want to add a column with True\/False for each vaccin, and only keep the row with the most recent information for each country.","5b5dffc8":"We see that especially Hungary uses a lot less mRNA. This is because Hungary is the only European country that also uses Sputnik and Sinopharm.","8d009d3f":"The vaccine developed in Kazachstan remains only used in the country itself.","a19cf431":"## 2.3 Usage of vaccines in Europe by country\n\nAs mentioned before, the file by manufacturer does not hold all countries. However, it does contain detailed info on most European countries. I decided to get rid of the 3 countries outside Europe and to dig deeper anyway.","437b675e":"As you can see below, Europe is increasingly relying on Pfizer. While Pfizer was used the most since the start of the vaccinations, the trend is also upward. The amounts used of Moderna and AstraZeneca are also significant. Johnson& Johnson is not used a lot yet.","b36a0500":"Although less ideal, it turns out that the country file holds a column that specifies all vaccins used in a country","38227d92":"The same thing applies to the vaccine developed in Iran; it is only used in the country itself.","0dc94b0f":"As we can see, Pfizer is used in lots of countries.","90cd1e0a":"AstraZeneca is used in a lot of countries including most African and South American countries. Some noticable countries missing here are the US, South Africa and some European countries such as Norway and Denmark. The reason why South Africa is not using AstraZeneca is known to me, as it was in the news that the effectiveness of AstraZeneca against the South African variant is just too low to use it.","a9eac59b":"Moderna's footprint of countries is smaller.","36f92f52":"Johnson & Johnson's footprint is smaller. Noticable is that South Africa uses Johnson & Johnson while not using AstraZenca (the opposite of most African countries). This makes a lot of sense as Johnson & Johnson was proven to be effective against the South African variant in the trials.","23789229":"The Indian vaccin (Covaxin) is used in India and a few other countries.","d52f2e4c":"However, it turns out that this information is only available for a limited number of countries.","3e5e5cdd":"# 2. Which vaccines are used where?\n\n## 2.1 Worldwide usage maps by vaccin\n\nBelow, I am making a function that allows me to specify which vaccin I want to display on a worldwide map and the color that I want to give to the countries using the vaccin."}}