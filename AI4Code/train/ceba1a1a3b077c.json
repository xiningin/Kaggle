{"cell_type":{"c792849c":"code","fb15765d":"code","3bfdcfcf":"code","121bee3f":"code","33502009":"markdown","a092d07d":"markdown","72c1060d":"markdown"},"source":{"c792849c":"# Install zarr and load packages\n!pip install -qq zarr\nimport cv2, zarr, tifffile\nimport matplotlib.pyplot as plt, numpy as np, pandas as pd\nfrom pathlib import Path","fb15765d":"def read_image(image_id, path, scale=None, verbose=1):\n    \"Load images with ID from path\"\n    \n    try: \n        image = tifffile.imread(path\/f\"train\/{image_id}.tiff\")\n    except:\n        image = tifffile.imread(path\/f\"test\/{image_id}.tiff\")\n    \n    if len(image.shape) == 5:\n        image = image.squeeze().transpose(1, 2, 0)\n    elif image.shape[0] == 3:\n        image = image.transpose(1, 2, 0)\n    \n    if verbose:\n        print(f\"[{image_id}] Image shape: {image.shape}\")\n    \n    if scale:\n        new_size = (image.shape[1] \/\/ scale, image.shape[0] \/\/ scale)\n        image = cv2.resize(image, new_size)\n        \n        if verbose:\n            print(f\"[{image_id}] Resized Image shape: {image.shape}\")\n        \n    return image","3bfdcfcf":"scale = 2\n\npath = Path('\/kaggle\/input\/hubmap-kidney-segmentation')\ndf_train = pd.read_csv(path\/\"train.csv\")\ndf_sample = pd.read_csv(path\/\"sample_submission.csv\")\ng_out = zarr.group(f'\/kaggle\/working\/images_scale{scale}')","121bee3f":"for idx in df_sample['id'].tolist()+df_train['id'].tolist():\n    img = read_image(idx, path, scale=scale)\n    g_out[idx] = img\n    print(g_out[idx].info)\n    shape = g_out[idx].shape\n    \n    plt.imshow(cv2.resize(img, dsize=(512, 512*shape[0]\/\/shape[1])))\n    plt.show()","33502009":"## Loop over images","a092d07d":"# Settings","72c1060d":"# Hubmap image conversion\n\n> Convert tiff files to zarr files with scale factor\n\n***\n\n- V10: Adding test set"}}