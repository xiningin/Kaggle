{"cell_type":{"00bd362c":"code","5ea4f7a3":"code","6b2e68b2":"code","0e60ca61":"code","159e0e1a":"code","8712baa7":"code","91c2a82f":"code","ba5c8e24":"code","cf8e8b39":"code","ce6d59c3":"code","f93d297d":"code","f44b05b5":"code","e93843c3":"code","4b68551c":"code","b3a5c56b":"code","f219ffc3":"code","c067c36d":"code","e5fe29f7":"code","550a9b1a":"code","5382cbe6":"code","39c1fedb":"code","18e206dd":"code","36a67969":"code","54d21483":"code","34ea85f4":"code","5232a906":"code","33b9a59e":"code","e5ab9789":"code","c1abaf27":"code","87f26139":"code","54dece45":"code","13ff8e25":"code","6756e959":"code","e02ece94":"code","ec6f4e15":"code","b599ee0d":"code","102bd4c5":"code","fa0e941c":"code","8a74cadd":"code","950a65ac":"code","849367fe":"markdown","a3d2ad86":"markdown","31a6a086":"markdown","1fa73423":"markdown","6d1603d7":"markdown","f5bf1f49":"markdown","859f6341":"markdown","c72972f3":"markdown","29f843f8":"markdown","d531806d":"markdown","130779fd":"markdown","b6aa106a":"markdown","118d66c8":"markdown","7afda28c":"markdown","e2bf962a":"markdown","cf2ab7ba":"markdown"},"source":{"00bd362c":"import numpy as np \nimport pandas as pd \nimport eli5\nimport plotly\nimport plotly.graph_objs as go\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nsns.set()\nimport warnings\nwarnings.filterwarnings('ignore')\nfrom sklearn.preprocessing import LabelEncoder\nfrom scipy.stats import chisquare\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestClassifier\nfrom eli5.sklearn import PermutationImportance\n\n# command for work offline\nplotly.offline.init_notebook_mode(connected=True)","5ea4f7a3":"# read the dataset\ndataset = pd.read_csv(\"..\/input\/WA_Fn-UseC_-Telco-Customer-Churn.csv\")","6b2e68b2":"# an overview of the dataset\ndataset.head()","0e60ca61":"dataset.shape","159e0e1a":"# list of columns in the dataset\ndataset.columns","8712baa7":"# only 3 feature contain numerical values, rest are categorical feature\ndataset.describe()","91c2a82f":"# customer id is unnecessary\ndel dataset[\"customerID\"]","ba5c8e24":"gender_map = {\"Female\" : 0, \"Male\": 1}\nyes_no_map = {\"Yes\" : 1, \"No\" : 0}\n\ndataset[\"gender\"] = dataset[\"gender\"].map(gender_map)\n\ndef binary_encode(features):\n    for feature in features:\n        dataset[feature] = dataset[feature].map(yes_no_map)","cf8e8b39":"binary_encode_candidate = [\"Partner\", \"Dependents\", \"PhoneService\", \"PaperlessBilling\", \"Churn\"]\nbinary_encode(binary_encode_candidate)","ce6d59c3":"# converting series object dataset into numeric\n# errors = 'coerce\u2019 means, if invalid parsing occur then set NaN\ndataset[\"TotalCharges\"] = pd.to_numeric(dataset[\"TotalCharges\"], errors = 'coerce')","f93d297d":"# missing values check\nprint(dataset.isnull().any())\nprint(\"\\n# of Null values in 'TotalCharges`: \",dataset[\"TotalCharges\"].isnull().sum())","f44b05b5":"# fill null values with the mean values of that feature\ndataset[\"TotalCharges\"].fillna(dataset[\"TotalCharges\"].mean(), inplace=True)","e93843c3":"dataset = pd.get_dummies(dataset)","4b68551c":"# now take a look at our final dataset\ndataset.head()","b3a5c56b":"dataset.describe().T","f219ffc3":"result = pd.DataFrame(columns=[\"Features\", \"Chi2Weights\"])\n\nfor i in range(len(dataset.columns)):\n    chi2, p = chisquare(dataset[dataset.columns[i]])\n    result = result.append([pd.Series([dataset.columns[i], chi2], index = result.columns)], ignore_index=True)","c067c36d":"result = result.sort_values(by=\"Chi2Weights\", ascending=False)","e5fe29f7":"result.head(20)","550a9b1a":"new_df = dataset[result[\"Features\"].head(20)]","5382cbe6":"new_df.head()","39c1fedb":"plt.figure(figsize = (15, 12))\nsns.heatmap(new_df.corr(), cmap=\"RdYlBu\", annot=True, fmt=\".1f\")\nplt.show()","18e206dd":"hightly_corr_feature = [\"OnlineBackup_No internet service\", \"StreamingMovies_No internet service\", \"StreamingTV_No internet service\", \n\"TechSupport_No internet service\", \"DeviceProtection_No internet service\", \"OnlineSecurity_No internet service\"]\n\ndef remove_corr_features(features):\n    for feature in features:\n        del new_df[feature]","36a67969":"remove_corr_features(hightly_corr_feature)","54d21483":"plt.figure(figsize = (12, 8))\nsns.heatmap(new_df.corr(), cmap=\"RdYlBu\", annot=True, fmt=\".1f\")\nplt.show()","34ea85f4":"trace = []\n\ndef gen_boxplot(df):\n    for feature in df:\n        trace.append(\n            go.Box(\n                name = feature,\n                y = df[feature]\n            )\n        )\n        \ngen_boxplot(new_df)","5232a906":"data = trace\nplotly.offline.iplot(data)","33b9a59e":"ax = new_df[\"Churn\"].value_counts().plot(kind='bar', figsize=(6, 8), fontsize=13)\nax.set_ylabel(\"Number of Customer\", fontsize=14);\n\ntotals = []\nfor i in ax.patches:\n    totals.append(i.get_height())\n\ntotal = sum(totals)\n\nfor i in ax.patches:\n    ax.text(i.get_x() - .01, i.get_height() + .5, \\\n            str(round((i.get_height()\/total)*100, 2))+'%', fontsize=15,\n                color='#444444')\nplt.show()","e5ab9789":"new_df.columns","c1abaf27":"new_df[\"tenure\"].unique()","87f26139":"_, ax = plt.subplots(1, 2, figsize= (16, 6))\nsns.scatterplot(x=\"TotalCharges\", y = \"tenure\" , hue=\"Churn\", data=new_df, ax=ax[0])\nsns.scatterplot(x=\"MonthlyCharges\", y = \"tenure\" , hue=\"Churn\", data=new_df, ax=ax[1])","54dece45":"facet = sns.FacetGrid(new_df, hue = \"Churn\", aspect = 3)\nfacet.map(sns.kdeplot,\"TotalCharges\",shade= True)\nfacet.set(xlim=(0, new_df[\"TotalCharges\"].max()))\nfacet.add_legend()\n\nfacet = sns.FacetGrid(new_df, hue = \"Churn\", aspect = 3)\nfacet.map(sns.kdeplot,\"MonthlyCharges\",shade= True)\nfacet.set(xlim=(0, new_df[\"MonthlyCharges\"].max()))\nfacet.add_legend()","13ff8e25":"_, ax = plt.subplots(1, 2, figsize= (8, 6))\nplt.subplots_adjust(wspace = 0.5)\nsns.boxplot(x = 'Churn',  y = 'TotalCharges', data = new_df, ax=ax[0])\nsns.boxplot(x = 'Churn',  y = 'MonthlyCharges', data = new_df, ax=ax[1])","6756e959":"_, axs = plt.subplots(1, 2, figsize=(9, 6))\nplt.subplots_adjust(wspace = 0.3)\nax = sns.countplot(data = new_df, x = \"SeniorCitizen\", hue = \"Churn\", ax = axs[0])\nax1 = sns.countplot(data = new_df, x = \"MultipleLines_No phone service\", hue = \"Churn\", ax = axs[1])\n\nfor p in ax.patches:\n        height = p.get_height() \n        ax.text(\n                p.get_x()+p.get_width()\/2,\n                height + 3.4,\n                \"{:1.2f}%\".format(height\/len(new_df),0),\n                ha = \"center\", rotation = 0\n               ) \n        \nfor p in ax1.patches:\n        height = p.get_height() \n        ax1.text(\n                p.get_x()+p.get_width()\/2,\n                height + 3.4,\n                \"{:1.2f}%\".format(height\/len(new_df),0),\n                ha = \"center\", rotation = 0\n               ) ","e02ece94":"plt.figure(figsize=(8, 6))\nsns.swarmplot(x = 'SeniorCitizen', y = 'MonthlyCharges', hue=\"Churn\", data = new_df)\nplt.legend(loc='upper-right')","ec6f4e15":"fig, ax = plt.subplots(1,3, figsize=(14, 4))\nplt.subplots_adjust(wspace=0.4)\nsns.countplot(x = \"Contract_One year\", hue=\"Churn\" , ax=ax[0], data=new_df)\nsns.countplot(data = new_df, x = \"PaymentMethod_Credit card (automatic)\", ax=ax[1], hue=\"Churn\")\nsns.countplot(data = new_df, x =\"InternetService_No\", ax=ax[2], hue=\"Churn\")\nfig.show()","b599ee0d":"fig, ax = plt.subplots(1,2, figsize=(10, 4))\nplt.subplots_adjust(wspace=0.4)\nsns.swarmplot(x = 'PaymentMethod_Bank transfer (automatic)', y = 'TotalCharges', hue=\"Churn\", data = new_df, ax=ax[0])\nsns.swarmplot(x = 'Contract_Two year', y = 'TotalCharges', hue=\"Churn\", data = new_df, ax=ax[1])","102bd4c5":"fig, ax = plt.subplots(1,2, figsize=(8, 4))\nplt.subplots_adjust(wspace=0.3)\nsns.swarmplot(x = 'PaymentMethod_Mailed check', y = 'TotalCharges', hue=\"Churn\", data = new_df, ax=ax[0])\nsns.swarmplot(x = 'Contract_Two year', y = 'TotalCharges', hue=\"Churn\", data = new_df, ax=ax[1])\nfig.show()","fa0e941c":"cols = [\"TotalCharges\", \"MonthlyCharges\", \"tenure\", \"Churn\"] \npairplot_feature = new_df[cols]\nsns.pairplot(pairplot_feature, hue = \"Churn\")","8a74cadd":"X = new_df.drop(\"Churn\", axis=1)\ny = new_df[\"Churn\"]\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, random_state=1)\nclf = RandomForestClassifier(random_state=0).fit(X_train, y_train)","950a65ac":"perm = PermutationImportance(clf, random_state = 1).fit(X_test, y_test)\neli5.show_weights(perm, feature_names = X_test.columns.tolist())","849367fe":"> **Senior Citizens customer are trends to Churn more than other**","a3d2ad86":"### Apply One Hot Encoding on categorical features that containg more than two categories","31a6a086":"### Finding Correlation","1fa73423":"> Customer with **less than 2 years** contract are more often churn","6d1603d7":"## Dataset Description\nThis dataset contains `7043` observations and `21` features and 1 label (`Churn`)\n\n| __Feature Name__ | __Description__ | __Data Type__ |\n| - | - | - |\n| customerID | Contains customer ID | categorical | \n| gender | whether the customer female or male | categorical |\n| SeniorCitizen | Whether the customer is a senior citizen or not (1, 0) | numeric, int |\n| Partner | Whether the customer has a partner or not (Yes, No) | categorical |\n| Dependents | Whether the customer has dependents or not (Yes, No) | categorical | \n| tenure | Number of months the customer has stayed with the company | numeric, int |\n| PhoneService | Whether the customer has a phone service or not (Yes, No) | categorical |\n| MultipleLines | Whether the customer has multiple lines r not (Yes, No, No phone service) | categorical |\n| InternetService | Customer\u2019s internet service provider (DSL, Fiber optic, No) | categorical |\n| OnlineSecurity | Whether the customer has online security or not (Yes, No, No internet service) | categorical | \n| OnlineBackup |  Whether the customer has online backup or not (Yes, No, No internet service) | categorical | \n| DeviceProtection | Whether the customer has device protection or not (Yes, No, No internet service) | categorical |\n| TechSupport | Whether the customer has tech support or not (Yes, No, No internet service) | categorical | \n| streamingTV | Whether the customer has streaming TV or not (Yes, No, No internet service) | categorical |\n| streamingMovies | Whether the customer has streaming movies or not (Yes, No, No internet service) | categorical |\n| Contract | The contract term of the customer (Month-to-month, One year, Two year) | categorical |\n| PaperlessBilling | Whether the customer has paperless billing or not (Yes, No) | categorical |\n| PaymentMethod | The customer\u2019s payment method (Electronic check, Mailed check, Bank transfer, Credit card) | categorical |\n| MonthlyCharges | The amount charged to the customer monthly\u200a | \u200anumeric , int |\n| TotalCharges | The total amount charged to the customer\u200a | object |\n| Churn | Whether the customer churned or not (Yes or No) | categorical |","f5bf1f49":"## Data Preprocessing","859f6341":"### Boxplot For Outlier Detection","c72972f3":"### Encoding\n* Binary Encoding\n* One Hot Encoding","29f843f8":"> __Note: you can interect with the boxplot. So play around with it. Double click to back on initial state. __\n\n\n__This plot is generated by using `plotly`. I have one interactive tutorial on `plotly`, you may visit those kernel:__\n\n* [Gettring started with Plotly (Part 1)](https:\/\/www.kaggle.com\/nasirislamsujan\/getting-started-with-plotly-part-1)","d531806d":"## Statistical Summary of the Dataset\n[DataFrame.describe()](https:\/\/pandas.pydata.org\/pandas-docs\/stable\/generated\/pandas.DataFrame.describe.html) method generates descriptive statistics that summarize the central tendency, dispersion and shape of a dataset\u2019s distribution, excluding `NaN` values. This method tells us a lot of things about a dataset. One important thing is that the `describe()` method deals only with `numeric` values. It doesn't work with or show any statistics on `categorical` values.","130779fd":"# Introduction\nCustomer churn occurs when __customers__ or __subscribers__ stop doing business with a company or service, also known as __customer attrition__. It is also referred as loss of clients or customers. One industry in which churn rates are particularly useful is the telecommunications industry, because most customers have multiple options from which to choose within a geographic location.","b6aa106a":"## Data Visualization","118d66c8":"## Feature Selection\n__Applying $chi^2$ test and select only top 20 highest $chi^2$ weighted feature__","7afda28c":"### That's it for this Kernel. ","e2bf962a":"> ** Darker green represent the `highest impact` and lesser green represent the `less impact` feature **","cf2ab7ba":"### Apply binary encoding on categorical features that contains only two categories"}}