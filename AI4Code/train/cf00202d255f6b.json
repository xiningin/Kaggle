{"cell_type":{"6cf7e860":"code","86aacded":"code","e88d73c0":"code","387fef5c":"code","b73958e3":"code","a92453c3":"code","09f2bb6b":"code","6feba091":"code","cf116e03":"code","527b8646":"code","03258db8":"code","79d1d392":"code","a62f3ddb":"code","9b742e41":"code","d4b6aee2":"code","1459715c":"code","60d18ac2":"code","ec91413c":"code","b40bc28c":"code","801b982e":"code","c5be601f":"code","2f05ab52":"code","c6c387a2":"code","25888aec":"code","7944957d":"code","74cb2c3c":"code","d712cbef":"code","7927a004":"code","811403ad":"code","89b06738":"code","a5ecfdfe":"code","9e65cfde":"code","d5b77ebc":"code","512c5561":"code","3fc3ac9b":"code","4bbf4db4":"code","053757f7":"code","49374ca0":"markdown","d3366e98":"markdown","3ce6c6f1":"markdown","39c92699":"markdown","50cdfb46":"markdown","911a127b":"markdown","bb2da93e":"markdown","63e56910":"markdown","b2d789d6":"markdown","a66c27b8":"markdown","c4107ca9":"markdown","22f7bd6f":"markdown","0bdf19c4":"markdown","bfde09f9":"markdown","eb3c1d75":"markdown","c161cfe9":"markdown","989f9d68":"markdown","10e0877c":"markdown"},"source":{"6cf7e860":"# Visualization\nimport pandas as pd\nimport plotly.graph_objects as go\nimport plotly.figure_factory as ff\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom plotly.subplots import make_subplots\n\n# Model selection\nfrom sklearn.model_selection import train_test_split, cross_val_score, GridSearchCV\nfrom sklearn.metrics import confusion_matrix, f1_score\nfrom sklearn.preprocessing import MinMaxScaler\n\n# Machine learning models\nimport xgboost as xgb\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom lightgbm import LGBMClassifier\n\nimport warnings\nwarnings.filterwarnings('ignore')","86aacded":"data = pd.read_csv('..\/input\/heart-attack-analysis-prediction-dataset\/heart.csv')","e88d73c0":"data","387fef5c":"data.columns","b73958e3":"# Check for missing values\ndata.isnull().sum()","a92453c3":"def box_plot(column, plot_name):\n    fig = go.Figure()\n\n    fig.add_trace(go.Box(\n        y = column,\n        name = ''\n    ))\n\n    fig.update_layout(\n        template = 'plotly_dark',\n        title_text = plot_name\n    )\n\n    fig.show()","09f2bb6b":"box_plot(data['age'], 'Age box plot')","6feba091":"box_plot(data['trtbps'], 'Resting blood pressure box plot')","cf116e03":"box_plot(data['chol'], 'Cholesterol box plot')","527b8646":"data[data['chol'] > 500]","03258db8":"data_del = data[data['chol'] < 500]","79d1d392":"box_plot(data_del['chol'], 'Cholesterol box plot')","a62f3ddb":"box_plot(data_del['thalachh'], 'Maximum heart rate achieved box plot')","9b742e41":"box_plot(data_del['oldpeak'], 'Previous peak box plot')","d4b6aee2":"fig = go.Figure()\n\nto_plot = data_del['output'].replace({0: 'Less chance of heart attack', 1: 'More chance of heart attack'}).value_counts()\nlabels = to_plot.index\nvalues = to_plot.values\n\nfig.add_trace(go.Pie(\n    labels = labels,\n    values = values,\n    textinfo='percent'\n))\n\nfig.update_layout(\n    title_text='Survival',\n    template='plotly_dark'\n)","1459715c":"# Age\nfig = go.Figure()\n\nfig.add_trace(go.Histogram(\n    x = data_del[data_del['output'] == 0]['age'],\n    name = 'Less chance of heart attack'\n))\n\nfig.add_trace(go.Histogram(\n    x = data_del[data_del['output'] == 1]['age'],\n    name = 'More chance of heart attack'\n))\n\nfig.update_layout(\n    width = 1000,\n    template = 'plotly_dark',\n    title_text = 'Age by chance of heart stroke'\n)","60d18ac2":"# Male vs female chance of stroke\nfig = make_subplots(rows=1, cols=2, specs=[[{\"type\": \"pie\"}, {\"type\": \"pie\"}]], subplot_titles=['Female', 'Male'])\n\nto_plot_female = data_del[data_del['sex'] == 0]['output'].replace({0: 'Less chance of heart attack', 1: 'More chance of heart attack'}).value_counts()\nlabels_female = to_plot_female.index\nvalues_female = to_plot_female.values\n\nto_plot_male = data_del[data_del['sex'] == 1]['output'].replace({0: 'Less chance of heart attack', 1: 'More chance of heart attack'}).value_counts()\nlabels_male = to_plot_male.index\nvalues_male = to_plot_male.values\n\nfig.add_trace(\n    go.Pie(\n    labels = labels_female,\n    values = values_female,\n    textinfo='percent',\n    name='Female'),\n    row=1,\n    col=1\n)\n\nfig.add_trace(\n    go.Pie(\n    labels = labels_male,\n    values = values_male,\n    textinfo='percent',\n    name='Man'),\n    row=1,\n    col=2\n)\n\nfig.update_layout(\n    title_text='Male vs Female chance of stroke',\n    template='plotly_dark'\n)","ec91413c":"# Balance of sex feature\nto_plot_balance = data_del['sex'].replace({0: 'Female', 1: 'Male'}).value_counts()\nlabels_balance = to_plot_balance.index\nvalues_balance = to_plot_balance.values\n\nfig = go.Figure()\n\nfig.add_trace(go.Pie(\n    labels = labels_balance,\n    values = values_balance\n))\n\nfig.update_layout(\n    title_text='Population by gender',\n    template='plotly_dark'\n)","b40bc28c":"# Resting blood pressure \ntrtbps_1 = data_del[data_del['output'] == 1]['trtbps']\ntrtbps_0 = data_del[data_del['output'] == 0]['trtbps']\n\n# Group data together\nhist_data = [trtbps_1, trtbps_0]\ngroup_labels = ['More chance of heart attack', 'Less chance of heart attack']\n\n# Create distplot with custom bin_size\nfig = ff.create_distplot(hist_data, group_labels)\n\nfig.update_layout(\n    title_text = 'Resting blood pressure by stroke chance'\n)\n\nfig.show()","801b982e":"# Cholesterol\nchol_1 = data_del[data_del['output'] == 1]['chol']\nchol_0 = data_del[data_del['output'] == 0]['chol']\n\n# Group data together\nhist_data = [chol_1, chol_0]\ngroup_labels = ['More chance of heart attack', 'Less chance of heart attack']\n\n# Create distplot with custom bin_size\nfig = ff.create_distplot(hist_data, group_labels)\n\nfig.update_layout(\n    title_text = 'Cholesterol by stroke chance'\n)\n\nfig.show()","c5be601f":"# Maximum heart rate achieved\nthalachh_1 = data_del[data_del['output'] == 1]['thalachh']\nthalachh_0 = data_del[data_del['output'] == 0]['thalachh']\n\n# Group data together\nhist_data = [thalachh_1, thalachh_0]\ngroup_labels = ['More chance of heart attack', 'Less chance of heart attack']\n\n# Create distplot with custom bin_size\nfig = ff.create_distplot(hist_data, group_labels)\n\nfig.update_layout(\n    title_text = 'Maximum heart rate achieved by stroke chance'\n)\n\nfig.show()","2f05ab52":"plt.figure(figsize=(8, 12))\n\nheatmap = sns.heatmap(data.corr()[['output']].sort_values(by='output', ascending=False),\n                     vmin=-1, vmax=1, annot=True, cmap='BrBG')\n\nheatmap.set_title('Features correlated with chance of stroke', fontdict={'fontsize': 18}, pad=16);","c6c387a2":"data_del","25888aec":"# Split data\nX = data_del.drop(['output'], axis=1)\ny = data_del['output']","7944957d":"# Scale values\nscaler = MinMaxScaler()\nX = scaler.fit_transform(X)","74cb2c3c":"# Split data into train and test sets\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.10, random_state=42)","d712cbef":"def model_evaluation(model):\n    # Train our model and predict\n    model.fit(X_train, y_train)\n    y_pred = model.predict(X_test)\n\n    # Cross validation\n    scores = cross_val_score(model, X, y, cv=3, scoring='f1')\n    f1_scores_mean = scores.mean()\n    print('F1 scores: {}'.format(scores))\n    print('F1 mean score: {}'.format(f1_scores_mean))\n    \n    # Confusion matrix\n    print('Confusion Matrix: ')\n    matrix = confusion_matrix(y_test, y_pred)\n    group_names = ['True Negative','False Positive','False Negative','True Positive']\n    group_counts =['{0:0.0f}'.format(value) for value in matrix.flatten()]\n    group_percentages = ['{0:.2%}'.format(value) for value in matrix.flatten()\/np.sum(matrix)]\n    \n    labels = [f\"{v1}\\n{v2}\\n{v3}\" for v1, v2, v3 in zip(group_names,group_counts,group_percentages)]\n    labels = np.asarray(labels).reshape(2, 2)\n\n    sns.heatmap(matrix, annot=labels, fmt='', cmap='rocket_r')\n    \n    return f1_scores_mean","7927a004":"# K-nearest neighbors \nKNN_model = KNeighborsClassifier()\n\n# SVC\nSVC_model = SVC()\n\n# Logistic regression\nLR_model = LogisticRegression()\n\n# Decision tree\nDT_model = DecisionTreeClassifier()\n\n# Random Forest\nRF_model = RandomForestClassifier()\n\n# XGBoost\nXGB_model = xgb.XGBClassifier()\n\n# LightGBM\nLGBM_model = LGBMClassifier()","811403ad":"f1_KNN = model_evaluation(KNN_model)","89b06738":"f1_SVC = model_evaluation(SVC_model)","a5ecfdfe":"f1_LR = model_evaluation(LR_model)","9e65cfde":"f1_DT = model_evaluation(DT_model)","d5b77ebc":"f1_RF = model_evaluation(RF_model)","512c5561":"f1_XGB = model_evaluation(XGB_model)","3fc3ac9b":"f1_LGBM = model_evaluation(LGBM_model)","4bbf4db4":"LR_new = LogisticRegression(\n    solver = 'liblinear',\n    penalty = 'l1',\n    # C = 1\n)","053757f7":"model_evaluation(LR_new)","49374ca0":"We can be happy that our dataset is balanced. It will be easier to perform prediction. ","d3366e98":"Conclusion: Women are more prone to heart attacks <br>\nFrom plots above we can tell that females have more chance of stroke but at the same time data are fairly unbalanced. This makes this conclusion irrelevant in my opinion.","3ce6c6f1":"<h1>Prediction<\/h1>","39c92699":"<div style=\"text-align:center\"><img src=\"https:\/\/www.eehealth.org\/-\/media\/images\/modules\/blog\/posts\/heartline.jpg?h=500&w=750&hash=8147AFA9A68A838E7227B6524E566A99\" \/><\/div>","50cdfb46":"<center><h1>Hello everyone!<\/h1><\/center>\nI created a notebook where I made a little of analysis and prediction. I hope you will like it.","911a127b":"<h1>Exploratory data analysis<\/h1>\nFirst we have to answer a very important question. How does each feature affect our goal?","bb2da93e":"<h1>Data Preparation<\/h1>\nFirst we need to check if there is any missing values or outliers","63e56910":"In this situation we should think about this high cholesterol measurement. After a couple of minutes of research I can tell that measurement of over 500 is possible if we measure triglycerides but still, it would be a problem for our prediction in the future. We will delete this row from our dataset.","b2d789d6":"Conclusion: Resting blood pressure isn't correlated with chance of heart stroke","a66c27b8":"Conclusion: This chart shows that only two features (fbs and cho) aren't correlated with stroke chance at all. Rest of them are fairly correlated which can be helpful in prediction.","c4107ca9":"From the above results we see that models are unstable and accuracy jumps uncontrollably. I'm pretty sure that is a result of the small size of the dataset. We will try to tune the logistic regression model to make him more stable. I chose this algorithm because he is simple and that kind of models works best for small datasets.","22f7bd6f":"It's looks like our data is fully filled with values. We don't need to worry.","0bdf19c4":"Conclusion: People who achieved maximum heart rate larger than 150 have very big chance to experience a heart attack","bfde09f9":"Conclusion: People with cholesterol level (mg\/dl) between 170 and 250 have more chance of stroke","eb3c1d75":"Conclusion: People between 40 and 55 years of age have more chance to have a stroke. Which is a little weird in my opinion. I always thought that stroke chance increase with age. Unfortunately with this dataset we don't have enough data to verify it. Therefore, this thought will remain only a guess.  ","c161cfe9":"Nice! After we added a regularization parameter our model become more stable. We achieved our goal, the model doesn't look overfitted and accuracy is fair enough for such small dataset. I think we can leave it like this. ","989f9d68":"Here we can see couple of outliers but they are not that significante and probably they are not outliers at all. Someone probably had such a high score.","10e0877c":"To check correlation of other features with heart stroke chance we'll go the easy way and simply display pearson correlation values."}}