{"cell_type":{"c7840cd9":"code","8f3918de":"code","e71dcd9b":"code","f5d61a77":"code","3bf50059":"code","4852513c":"code","52ebefe1":"code","6a97b43a":"code","10943686":"code","dcb0db20":"code","e08eaec9":"code","d7fd4277":"code","cf1925fb":"code","b1a279ee":"code","ef8561e1":"code","3db0ee79":"code","ec3deb8f":"code","814963e8":"code","5f7b139b":"code","5c694210":"code","699f50df":"code","123d681b":"code","4e6f409c":"code","ae05926b":"code","c5ce233f":"code","17acff47":"markdown","6bbf64b1":"markdown","f59ab6cf":"markdown","4c5a08a6":"markdown","4a119358":"markdown","1377795d":"markdown","7a91fe40":"markdown","04dc4e03":"markdown","98dab916":"markdown","8c512a0d":"markdown","8ab3db88":"markdown","d0837763":"markdown","c4675095":"markdown","c72b396a":"markdown","f12373a9":"markdown","5febff1e":"markdown","52e046bb":"markdown","bad20ec1":"markdown","dae5e858":"markdown","788328a9":"markdown","27956bb0":"markdown","44d215b6":"markdown","cb386c01":"markdown","8d1d2f5c":"markdown","5c5f6d99":"markdown","e7b7a908":"markdown","1de413eb":"markdown","45d7998c":"markdown","f32b0255":"markdown","a64dff7a":"markdown"},"source":{"c7840cd9":"import numpy as np\nimport pandas as pd\nimport geopandas as gpd\n\nfrom bokeh.plotting import output_notebook, figure, show\nfrom bokeh.models import ColumnDataSource, Div, Select, Button, ColorBar, CustomJS\nfrom bokeh.layouts import row, column, layout\nfrom bokeh.transform import cumsum, linear_cmap\nfrom bokeh.palettes import Blues8\n\noutput_notebook()","8f3918de":"full = pd.read_csv('..\/input\/full.csv')\nfull.head()","e71dcd9b":"df1 = full[['Lifeboat', 'Sex']].copy()\ndf1.head()","f5d61a77":"df1 = df1[(df1.Lifeboat.notna()) & (df1.Lifeboat != '?')]\n\ndf1.loc[df1.Lifeboat == '14?', 'Lifeboat'] = '14'\ndf1.loc[df1.Lifeboat == '15?', 'Lifeboat'] = '15'\ndf1.loc[df1.Lifeboat == 'A[64]', 'Lifeboat'] = 'A'\n\ndf1 = pd.get_dummies(df1, columns=['Sex'], prefix='', prefix_sep='')\n\ndf1.head()","3bf50059":"df1 = df1.groupby('Lifeboat', as_index=False).sum()\n\ndf1.head()","4852513c":"order = ['7', '5', '3', '8', '1', '6', '16', '14', '12', '9',\n         '11', '13', '15', '2', '10', '4', 'C', 'D', 'B', 'A']\ndf1 = df1.set_index('Lifeboat').reindex(order).reset_index()\n\ndf1.head()","52ebefe1":"df1['female_per'] = df1['female'] \/ (df1['female'] + df1['male']) * 100\ndf1['male_per'] = df1['male'] \/ (df1['female'] + df1['male']) * 100\ndf1[['female_per', 'male_per']] = df1[['female_per', 'male_per']].round(1)\n\nlifeboat_odd = ['1', '3', '5', '7', '9', '11', '13', '15', 'A', 'C']\ndf1.loc[df1.Lifeboat.isin(lifeboat_odd), 'Side'] = 'starboard'\ndf1.loc[~df1.Lifeboat.isin(lifeboat_odd), 'Side'] = 'port'\n\ndf1.head()","6a97b43a":"# Create the ColumnDataSource object \"s1\"\ns1 = ColumnDataSource(df1)\n\n# Create the figure object \"p1\"\np1 = figure(title='Click on a column to display more information',\n            plot_width=500, plot_height=325, x_range = s1.data['Lifeboat'],\n            toolbar_location=None, tools=['hover', 'tap'], tooltips='@$name')\n\n# Add stacked vertical bars to \"p1\"\np1.vbar_stack(['female', 'male'], x='Lifeboat', width=0.8, source=s1,\n              fill_color=['#66c2a5', '#fc8d62'], line_color=None, legend=['Female', 'Male'])\n\n# Change parameters of \"p1\"\np1.title.align = 'center'\np1.xaxis.axis_label = 'Lifeboat (in launch order)'\np1.yaxis.axis_label = 'Count'\np1.y_range.start = 0\np1.x_range.range_padding = 0.05\np1.xgrid.grid_line_color = None\np1.legend.orientation = 'horizontal'\np1.legend.location = 'top_left'\n\n# Create the Div object \"div1\"\ndiv1 = Div()\n\n# Create the custom JavaScript callback\ncallback1 = CustomJS(args=dict(s1=s1, div1=div1), code='''\n    var ind = s1.selected.indices;\n    if (String(ind) != '') {\n        lifeboat = s1.data['Lifeboat'][ind];\n        female = s1.data['female'][ind];\n        male = s1.data['male'][ind];\n        female_per = s1.data['female_per'][ind];\n        male_per = s1.data['male_per'][ind];\n        side = s1.data['Side'][ind];\n        message = '<b>Lifeboat: ' + String(lifeboat) + ' (' + String(side) + ' side)' + '<\/b><br>Females: ' + String(female) + ' (' + String(female_per) +  '%)' + '<br>Males: ' + String(male) + ' (' + String(male_per) +  '%)' + '<br>Total: ' + String(female+male);\n        div1.text = message;\n    }\n    else {\n        div1.text = '';\n    }\n''')        \n\n# When tapping the plot \"p1\" execute the \"callback1\"\np1.js_on_event('tap', callback1)\n\n# Display \"p1\" and \"div1\" as a row\nshow(row(p1, div1))","10943686":"df2 = full[['Lifeboat', 'Pclass']].copy()\n\ndf2 = df2[(df2.Lifeboat.notna()) & (df2.Lifeboat != '?')]\n\ndf2.loc[df2.Lifeboat == '14?', 'Lifeboat'] = '14'\ndf2.loc[df2.Lifeboat == '15?', 'Lifeboat'] = '15'\ndf2.loc[df2.Lifeboat == 'A[64]', 'Lifeboat'] = 'A'\n\ndf2 = pd.get_dummies(df2, columns=['Pclass'], prefix='', prefix_sep='')\n\ndf2 = df2.groupby('Lifeboat', as_index=False).sum()\n\norder = ['7', '5', '3', '8', '1', '6', '16', '14', '12', '9',\n         '11', '13', '15', '2', '10', '4', 'C', 'D', 'B', 'A']\ndf2 = df2.set_index('Lifeboat').reindex(order).reset_index()\n\ndf2.head()","dcb0db20":"df2['1_per'] = df2['1'] \/ (df2['1'] + df2['2'] + df2['3']) * 100\ndf2['2_per'] = df2['2'] \/ (df2['1'] + df2['2'] + df2['3']) * 100\ndf2['3_per'] = df2['3'] \/ (df2['1'] + df2['2'] + df2['3']) * 100\n\n\ndf2['1_ang'] = df2['1_per'] \/ 100 * 2 * np.pi\ndf2['2_ang'] = df2['2_per'] \/ 100 * 2 * np.pi\ndf2['3_ang'] = df2['3_per'] \/ 100 * 2 * np.pi\n\ndf2.head()","e08eaec9":"df2_plot=pd.DataFrame({'class': ['Class 1', 'Class 2', 'Class 3'],\n                       'percent': [float('nan'), float('nan'), float('nan')],\n                       'angle': [float('nan'), float('nan'), float('nan')],\n                       'color': ['#c9d9d3', '#718dbf', '#e84d60']})\ndf2_plot","d7fd4277":"# Create the ColumnDataSource objects \"s2\" and \"s2_plot\"\ns2 = ColumnDataSource(df2)\ns2_plot = ColumnDataSource(df2_plot)\n\n# Create the Figure object \"p2\"\np2 = figure(plot_width=275, plot_height=350, y_range=(-0.5, 0.7),\n            toolbar_location=None, tools=['hover'], tooltips='@percent{0.0}%')\n\n# Add circular sectors to \"p2\"\np2.wedge(x=0, y=0, radius=0.8, source=s2_plot,\n         start_angle=cumsum('angle', include_zero=True), end_angle=cumsum('angle'),\n         fill_color='color', line_color=None, legend='class')\n\n# Change parameters of \"p2\"\np2.axis.visible = False\np2.grid.grid_line_color = None\np2.legend.orientation = 'horizontal'\np2.legend.location = 'top_center'\n\n# Create the custom JavaScript callback\ncallback2 = CustomJS(args=dict(s2=s2, s2_plot=s2_plot), code='''\n    var ang = ['1_ang', '2_ang', '3_ang'];\n    var per = ['1_per', '2_per', '3_per'];\n    if (cb_obj.value != 'Please choose...') {\n        var boat = s2.data['Lifeboat'];\n        var ind = boat.indexOf(cb_obj.value);\n        for (var i = 0; i < ang.length; i++) {\n            s2_plot.data['angle'][i] = s2.data[ang[i]][ind];\n            s2_plot.data['percent'][i] = s2.data[per[i]][ind];\n        }\n    }\n    else {\n        for (var i = 0; i < ang.length; i++) {\n            s2_plot.data['angle'][i] = undefined;\n            s2_plot.data['percent'][i] = undefined;\n        }\n\n    }\n    s2_plot.change.emit();\n''')\n\n# When changing the value of the dropdown menu execute \"callback2\"\noptions = ['Please choose...'] + list(s2.data['Lifeboat'])\nselect = Select(title='Lifeboat (in launch order)', value=options[0], options=options)\nselect.js_on_change('value', callback2)\n\n# Display \"select\" and \"p2\" as a column\nshow(column(select, p2))","cf1925fb":"gdf = gpd.read_file('https:\/\/raw.githubusercontent.com\/nvkelso\/natural-earth-vector\/master\/geojson\/ne_110m_admin_0_countries.geojson')\ngdf.head()","b1a279ee":"gdf = gdf[gdf.NAME != 'Antarctica']\ngdf.plot(figsize=(10, 5));","ef8561e1":"xs = []\nys = []\nfor obj in gdf.geometry.boundary:\n    if obj.type == 'LineString':\n        obj_x, obj_y = obj.xy\n        xs.append([[list(obj_x)]])\n        ys.append([[list(obj_y)]])\n    elif obj.type == 'MultiLineString':\n        obj_x = []\n        obj_y = []\n        for line in obj:\n            line_x, line_y = line.xy\n            obj_x.append([list(line_x)])\n            obj_y.append([list(line_y)])\n        xs.append(obj_x)\n        ys.append(obj_y)\n\ncountry = gdf['NAME'].values        \n\ndf3_plot = pd.DataFrame({'country': country, 'xs': xs, 'ys': ys, 'count': float('nan')})\n\ndf3_plot.head()","3db0ee79":"# Create the ColumnDataSource object \"s3_plot\"\ns3_plot = ColumnDataSource(df3_plot)\n\n# Create the Figure object \"p3_test\"\np3_test = figure(plot_width=775, plot_height=350,\n                 toolbar_location=None, tools=['hover', 'pan', 'wheel_zoom'],\n                 active_scroll='wheel_zoom', tooltips='@country')\n\n# Add multipolygons to \"p3_test\"\np3_test.multi_polygons(xs='xs', ys='ys', fill_color='count', source=s3_plot)\n\n# Change parameters of \"p3_test\"\np3_test.axis.visible = False\np3_test.grid.grid_line_color = None\n\n# Create the custom JavaScript callback\ncallback3_test = CustomJS(args=dict(p3_test=p3_test), code='''\n    p3_test.reset.emit();\n''')    \n\n# When clicking on the button execute \"callback3_test\"\nbutton = Button(label='Reset view')\nbutton.js_on_click(callback3_test)\n\n# Display \"p3_test\" and \"button\" as a column\nshow(column(p3_test, button))","ec3deb8f":"df3 = full[['Lifeboat', 'Hometown']].copy()\ndf3.head()","814963e8":"temp = df3.Hometown.str.extract(r'(?P<Town>.*)\\, (?P<Country>.*$)')\ndf3['Home_country'] = temp['Country']\ndf3 = df3.drop('Hometown', axis=1, errors='ignore')\n\ndf3.head()","5f7b139b":"df3 = df3[(df3.Lifeboat.notna()) & (df3.Lifeboat != '?')]\n\ndf3.loc[df3.Lifeboat == '14?', 'Lifeboat'] = '14'\ndf3.loc[df3.Lifeboat == '15?', 'Lifeboat'] = '15'\ndf3.loc[df3.Lifeboat == 'A[64]', 'Lifeboat'] = 'A'\n\ndf3.head()","5c694210":"df3.Home_country.unique()","699f50df":"to_replace = [('US', 'United States of America'), ('UK[note 3]', 'India'),\n              ('England', 'United Kingdom'), ('UK', 'United Kingdom'),\n              ('Channel Islands', 'United Kingdom'), ('Siam', 'Thailand'),\n              ('Syria[81]', 'Syria'), ('Scotland', 'United Kingdom'),\n              ('British India', 'India'), ('Ireland[note 1]', 'Ireland'),\n              ('Russian Empire', 'Russia'), ('Russian Empire[note 6]', 'Finland'),\n              ('Siam[note 5]', 'Thailand'), ('German Empire[note 2]', 'Germany'),\n              ('British India[note 3]', 'India')]\n\nfor old, new in to_replace:\n    df3.loc[df3.Home_country == old, 'Home_country'] = new\n    \ndf3.Home_country.unique()","123d681b":"df3 = pd.get_dummies(df3, columns=['Home_country'], prefix='', prefix_sep='')\n\ndf3 = df3.groupby('Lifeboat', as_index=False).sum()\n\norder = ['7', '5', '3', '8', '1', '6', '16', '14', '12', '9',\n         '11', '13', '15', '2', '10', '4', 'C', 'D', 'B', 'A']\ndf3 = df3.set_index('Lifeboat').reindex(order).reset_index()\n\ndf3.head()","4e6f409c":"country = df3_plot['country']\ndiff = country[~country.isin(df3.columns)].values\ndf3 = pd.concat([df3, pd.DataFrame(columns=diff)], axis=1).fillna(0)\ndf3 = df3.loc[:, np.append(['Lifeboat'], country.values)]\n\ndf3.head()","ae05926b":"# Create the ColumnDataSource objects \"s3_plot\" and \"s3\"\ns3_plot = ColumnDataSource(df3_plot)\ns3 = ColumnDataSource(df3)\n\n# Reverse the palette and create a linear color map\nBlues8.reverse()\ncmap = linear_cmap('count', palette=Blues8, low=0, high=1)\n\n# Create the Figure object \"p3\"\np3 = figure(plot_width=775, plot_height=350,\n            toolbar_location=None, tools=['hover', 'pan', 'wheel_zoom'],\n            active_scroll='wheel_zoom', tooltips='@country: @count')\n\n# Add multipolygons to \"p3\"\np3.multi_polygons(xs='xs', ys='ys', fill_color=cmap, source=s3_plot)\n\n# Change parameters of \"p3\"\np3.axis.visible = False\np3.grid.grid_line_color = None\n\n# Create the custom JavaScript callbacks\ncallback3_select = CustomJS(args=dict(s3=s3, s3_plot=s3_plot), code='''\n    var country = s3_plot.data['country'];\n    if (cb_obj.value != 'Please choose...') {\n        var boat = s3.data['Lifeboat'];\n        var ind = boat.indexOf(cb_obj.value);\n        for (i = 0; i < country.length; i++) {\n            s3_plot.data['count'][i] = s3.data[country[i]][ind];\n        }\n    }\n    else {\n        for (i = 0; i < country.length; i++) {\n            s3_plot.data['count'][i] = undefined;\n        }\n    }\n    s3_plot.change.emit();\n''')\n\ncallback3_button = CustomJS(args=dict(p3=p3), code='''\n    p3.reset.emit();\n''')\n    \n# When changing the value of the dropdown menu execute \"callback3_select\"\noptions = ['Please choose...'] + list(s3.data['Lifeboat'])\nselect = Select(title='Lifeboat (in launch order)', value=options[0], options=options)\nselect.js_on_change('value', callback3_select)\n\n# When clicking on the reset button execute \"callback3_button\"\nbutton = Button(label='Reset view')\nbutton.js_on_click(callback3_button)\n\n# Display \"select\", \"p3\", and \"button\" as a column\nshow(column(select, p3, button))","c5ce233f":"# Create the custom JavaScript callback\ncallback4 = CustomJS(args=dict(s1=s1, s2=s2, s3=s3, s2_plot=s2_plot, s3_plot=s3_plot), code='''\n    var ind = s1.selected.indices;\n    var ang = ['1_ang', '2_ang', '3_ang'];\n    var per = ['1_per', '2_per', '3_per'];\n    var country = s3_plot.data['country'];\n    if (String(ind) != '') {\n        for (i = 0; i < ang.length; i++) {\n            s2_plot.data['angle'][i] = s2.data[ang[i]][ind];\n            s2_plot.data['percent'][i] = s2.data[per[i]][ind];\n        }\n        for (i = 0; i < country.length; i++) {\n            s3_plot.data['count'][i] = s3.data[country[i]][ind];\n        }\n    }\n    else {\n        for (i = 0; i < ang.length; i++) {\n            s2_plot.data['angle'][i] = undefined;\n            s2_plot.data['percent'][i] = undefined;\n        }\n        for (i = 0; i < country.length; i++) {\n            s3_plot.data['count'][i] = undefined;\n        }\n    }\n    s2_plot.change.emit();\n    s3_plot.change.emit();\n''')    \n    \n# When tapping the plot \"p1\" execute \"callback4\"\np1.js_on_event('tap', callback4)\n\n# Display \"p1\",\"p2\", \"p3\" and \"button\" in the specified layout\nl = layout([[p1, p2], [p3], [button]])\nshow(l)","17acff47":"# 4. Choropleth map with reset button\n\nThe third chart will display home countries of the Titanic survivors depending on the lifeboats. For this purpose I will be using a choropleth map and will do it in two steps. During the first step, I will import the countries coordinates and plot their boundaries. During the second step, I will fill in the shapes of the obtained countries with the numbers of people from these countries depending on the lifeboats.","6bbf64b1":"Below is the code for the complete choropleth map.\n\nIn addition to the test choropleth map, I created the colormap `cmap` that is used to fill in multipolygons. The upper limit of `cmap` is set to 1 so that all countries that have more than 1 person are highlighted with dark blue. In this way, it is easier to see smaller countries.\n\nI also adapted the hover tooltip to show the number of people after the country name.\n\nFinally, to choose a lifeboat, I have added the same dropdown menu as in the pie chart.","f59ab6cf":"The coordinates of the countries boundaries are stored in the column `geometry` as Polygon or MultiPolygon objects. When using the method `boundary` these objects return LineString and MultiLineString objects respectively.  The coordinates of a LineString object can be directly accessed using the method `xy`. The coordinates of the MultiLineString object need, however, to be extracted separately for every line. Therefore, the LineString and MultiLineString objects should be treated differently. Note that the boundary coordinates for Bokeh should be 3-times nested lists in order to plot them as multiple multipolygons. This complicated structure allows to distinguish multipolygons from each other, individual polygons inside a multipolygon and holes inside an individual polygon. One should keep this structure in mind when extracting the coordinates and add nested lists where necessary.\n\nFinally, I create a DataFrame `df3_plot` that contains countries names, x-y coordinates of their boundaries and a counter for the number of people. For this test chart I fill the counter with `NaN`.","4c5a08a6":"Note that some countries in `df3` are spelled as abbreviations (for example, \"US\" or \"UK) or have references (for example, \"UK[note 3]\"), or don't exist anymore (for example, \"Russian Empire\").","4a119358":"Thanks for **UPVOTING** this kernel! Trying to become a Kernels Master. \ud83e\udd18\n\nCheck out my other cool projects:\n- [\ud83d\udcb2 Minimizing investment risk for high interest loans](https:\/\/www.kaggle.com\/pavlofesenko\/minimizing-investment-risk-for-high-interest-loans)\n- [\ud83c\udf10 Extending Titanic dataset using Wikipedia](https:\/\/www.kaggle.com\/pavlofesenko\/extending-titanic-dataset-using-wikipedia)\n- [\ud83d\udc6a Titanic extended dataset (Kaggle + Wikipedia)](https:\/\/www.kaggle.com\/pavlofesenko\/titanic-extended)","1377795d":"I will be visualizing some features of the Titanic survivors depending on the lifeboats which they boarded. For this purpose I am going to use my own [Titanic extended dataset](https:\/\/www.kaggle.com\/pavlofesenko\/titanic-extended) that combines features from Kaggle and Wikipedia (see below). More information on how this dataset was obtained can be found in my kernel [\"Extending Titanic dataset using Wikipedia\"](https:\/\/www.kaggle.com\/pavlofesenko\/extending-titanic-dataset-using-wikipedia).","7a91fe40":"Below is the code for the bar chart.\n\nIn order to interact with data in Bokeh, it is recommended to use its own data object ColumnDataSource (CDS). CDS allows some very nice interactive features like linking, streaming, etc. (see more in the [Bokeh User Guide](https:\/\/bokeh.pydata.org\/en\/latest\/docs\/user_guide\/data.html)). The Pandas DataFrame `df1` can be provided as input to create the CDS `s1`.\n\nThe central part of a Bokeh graph is the figure object that can be conveniently created with the function `figure()`. Since the bar chart will be categorical, the list of lifeboats should be passed from the CDS `s1.data['Lifeboat']` to the parameter `x_range`. Note that the list of lifeboats doesn't necessarily have to come from the CDS but I prefer to use only the CDS after it has been initialized. The tools `hover` and `tap`are added to the figure. The parameter `tooltips='@$name'` says that the hover tooltip will show the number of females\/males of each bar while hovering over them.\n\nHere I chose to create a stacked vertical bar chart and added the corresponding glyph `vbar_stack` to the figure `p1`. The numbers of females\/males in the lifeboats are taken from `s1` that was defined earlier. Some parameters of `p1` (like axis labels, grid lines, legend location, etc.) are adjusted separately.\n\nI would also like to create an HTML content block that will display additional text information about the specific lifeboat when its corresponding bar is selected. For this purpose I can initialize the Div object `div1` that encloses its contents in the HTML tag `<div>`.\n\nThe interaction between the figure `p1` and the object `div1` is specified by the method `js_on_event()` that executes `callback1` whenever the user clicks on a bar from the bar chart. `callback1` is a custom JavaScript object that brings additional interactivity. One could also use [Bokeh applications](https:\/\/bokeh.pydata.org\/en\/latest\/docs\/user_guide\/embed.html) that only requires Python but I couldn't figure out how to run Bokeh applications within a Kaggle noteobook.\n\nTo test the resulting bar chart, go ahead and click on one of the bars. \ud83d\ude0e","04dc4e03":"I filter out the entries that contain `NaN` or `?` in the column `Lifeboat` and remove the unnecessary symbols. Then I create dummy variables from the column `Sex` in order to count how many females\/males were present in each lifeboat. The prefix and the separator of dummy variables are made empty to avoid long column names.","98dab916":"It's worth noting that the number of people on this bar chart is lower than the real numbers. This is because there were quite some crew members in the lifeboats who are not included in this passengers list.\n\nAnother observation is that most of the lifeboats were not filled to their maximum capacity. The most striking examples is the lifeboat 1 that had only 12 people in it (5 passengers and 7 crew members) with its full capacity of 40 people! The reason behind it was that in the beginning many passengers didn't believe that Titanic would sink.\n\nOne might also notice that the number of males in the lifeboats was very high especially in the lifeboats launched from the starboard side (odd numbers). In comparison, the loading crew on the port side was much stricter with the rule \"women and children first\".","8c512a0d":"I thought that it would be interesting to arrange lifeboats according to the order in which they were launched (taken from [Wikipedia](https:\/\/en.wikipedia.org\/wiki\/Lifeboats_of_the_RMS_Titanic)).","8ab3db88":"Then I apply the rest of the familiar procedures to group the number of people from different countries for each lifeboat.","d0837763":"# 5. Interactive dashboard of all three charts\n\nNow that we have all 3 charts, let's combine them in one dashboard. I don't have to initialize the charts again but can simply display them in a preferred layout.\n\nThe only new element here is the `callback4` that updates the other two charts when a specific bar from the bar chart is tapped.","c4675095":"## 4.1. Plotting countries boundaries\n\nTo import the coordinates of the countries boundaries, one can use the [Natural Earth map datasets](https:\/\/github.com\/nvkelso\/natural-earth-vector). Geopandas can easily import a GeoJSON file and returns a GeoDataFrame. The latter is very similar to a Pandas DataFrame, however, it has additional methods that are useful for handling geospatial data.","c72b396a":"I extract home countries using regular expressions with matched groups. Then I remove the column `Hometown` since it is not needed anymore.","f12373a9":"## 4.2. Filling in countries shapes\n\nTo fill in countries shapes I need find the number of people for each country in lifeboats. This information can be extracted from the Titanic extended dataset. I begin by creating the DataFrame `df3` with the columns `Lifeboat` and `Hometown`.","5febff1e":"Then I group the rows according to the values in `Lifeboat` and sum up the number of females\/males.","52e046bb":"# 1. Introduction\n\nIn this project I'm going to show how to create interactive charts and dashboards using the Python library called [Bokeh](https:\/\/bokeh.pydata.org\/en\/latest\/). For those of you who aren't familiar with Bokeh, I would strongly recommend to go through their excellent [Bokeh User Guide](https:\/\/bokeh.pydata.org\/en\/latest\/docs\/user_guide.html) if you want to understand the code better. In addition to Bokeh, I'm also going to use the library [Geopandas](http:\/\/geopandas.org\/) for manipulation of geospatial data. Geopandas will be very intuitive if you already know Pandas.","bad20ec1":"Afterwards I apply the same procedure to remove missing values and clean the values as in the previous sections.","dae5e858":"# 3. Interactive pie chart with dropdown menu\n\nThe second chart will display distribution of classes among the Titanic survivors depending on the lifeboats. For this purpose I will be using the interactive pie chart and the dropdown menu with the list of all lifeboats. When a lifeboat number is selected in the dropdown menu, the pie chart should update the distribution of classes.\n\nI begin by creating a DataFrame `df2` with the columns `Lifeboat` and `Pclass`. Then I apply the same procedures for cleaning, creating dummy variables, grouping and reordering as in the previous section.","788328a9":"# 2. Interactive bar chart with text display block\n\nThe first chart will display the sex (female or male) of Titanic survivors depending on the lifeboats which they boarded. For this purpose I will be using an interactive bar chart which will display the number of people when hovering over the bars. To make this chart more interactive, I will add an HTML content block that will display additional text information about the lifeboat survivors when one of the bars is selected.\n\nI start by creating a new DataFrame `df1` with the columns `Lifeboat` and `Sex`. Don't forget to set is as a copy to avoid `SettingWithCopyWarning` further down the code.","27956bb0":"Below is the code for test choropleth map that plots only countries boundaries.\n\nIn addition to the `hover` tool, I include `pan` and `wheel_zoom` to easily navigate the map. The hover tooltip is set to display the country name.\n\nFor plotting countries boundaries I use the Bokeh glyph `multi_polygons` that takes countries coordinates from `s3_plot`.\n\nTo reset the map view, I add a button that executes `callback3_test` when clicking on it. The reset of the chart is also possible using the tool `reset` from the toolbar but I decided not to include the whole toolbar just for one button.","44d215b6":"Below is the code for the pie chart.\n\nJust like in the case of the bar chart, first I create the ColumnDataSource (CDS) objects. Here, however, two CDS `s2` and `s2_plot` are needed. `s2` will be used to store the percentages and angles for all lifeboats while `s2_plot` will contain information for only one lifeboat that is plotted at the moment. `s2` will be also used to update `s2_plot` when a different lifeboat is selected from the dropdown menu.\n\nDuring the initalization of the Figure object `p2` I slightly adjusted the `y_range` so that the legend doesn't cover the pie chart itself. I also changed the parameter `tooltips` to show the percentages rounded to one decimal digit when hovering over the sectors.\n\nThe pie chart is created by adding circular sectors using the glyph `wedge()`. Its parameters `start_angle` and `end_angle` are easily calculated from the sector angles using the Bokeh function `cumsum()`.\n\nThe dropdown menu is added with the Select object along with the options list. When the user chooses a different value from the dropdown menu, the method `js_on_change()` will execute the `callback2`. It checks if the value in the dropdown menu is not `Please choose...` and then updates `s2_plot` with the information from `s2` for the corresponding lifeboat. Note that `cb_obj` is the built-in Bokeh variable to store the value of the selected option when callbacks are used.","cb386c01":"Instead of the amount of people per class I would prefer to see their percentage per class in a certain lifeboat. Therefore, I add columns `1_per`, `2_per`, `3_per` that indicate percentages of the corresponding classes.\n\nFor a pie chart I will need to specify the angles (in radians) for each of the sectors. These angles are added as columns `1_ang`, `2_ang`, `3_ang` and can be easily obtained from the percentages.","8d1d2f5c":"Notice that first 6 lifeboats were almost exclusively filled with the passengers from the 1st class.","5c5f6d99":"I add the columns `female_per` and `male_per` that correspond to the percentages of females\/males (rounded to one decimal value), and the column `Side` that corresponds to the side of the ship from which the lifeboats were launched. Lifeboats with odd numbers were launched from the starboard side and lifeboats with even numbers from the port side.","e7b7a908":"Notice that `df2` contains percentages and angles for all lifeboats. On the pie chart, however, I can only display the distribution of classes for one lifeboat. Therefore, a separate DataFrame `df2_plot` like the one below is needed for plotting. The percentages and angles will be passed from `df2` to `df2_plot` when a particular lifeboat is selected from the dropdown menu.","1de413eb":"Note, however, that this is not the full list of countries that are displayed on the choropleth map. Therefore, I need to add the columns for all other countries from `d3_plot` and rearrange them in the same order as they appear in `d3_plot`.","45d7998c":"Therefore, the countries names need to be corrected according to their standard spelling.","f32b0255":"Let's remove Antarctica from `gdf` since nobody lives there and it occupies a lot of space on the plot (especially in the equirectangular projection). Usingt the Geopandas method `plot()` I quickly check that Antarctica was indeed removed from `gdf`.","a64dff7a":"Thanks for **UPVOTING** this kernel! Trying to become a Kernels Master. \ud83e\udd18\n\nCheck out my other cool projects:\n- [\ud83d\udcb2 Minimizing investment risk for high interest loans](https:\/\/www.kaggle.com\/pavlofesenko\/minimizing-investment-risk-for-high-interest-loans)\n- [\ud83c\udf10 Extending Titanic dataset using Wikipedia](https:\/\/www.kaggle.com\/pavlofesenko\/extending-titanic-dataset-using-wikipedia)\n- [\ud83d\udc6a Titanic extended dataset (Kaggle + Wikipedia)](https:\/\/www.kaggle.com\/pavlofesenko\/titanic-extended)"}}