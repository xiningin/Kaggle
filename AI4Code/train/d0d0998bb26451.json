{"cell_type":{"dfe69b92":"code","ca8b710c":"code","32f3e6eb":"code","cc829bc5":"code","296ae6fe":"code","57d2d4e0":"code","0a956087":"code","3cbc3b06":"code","a371e10d":"code","76c37dad":"markdown","c36c9814":"markdown","973c7dbd":"markdown","7fc083c7":"markdown","efcd0225":"markdown","04f003ba":"markdown","80b9da6b":"markdown","a85fc7f0":"markdown"},"source":{"dfe69b92":"import numpy as np, pandas as pd, pydicom as dcm\nimport matplotlib.pyplot as plt, seaborn as sns\nimport os, glob","ca8b710c":"train_df = pd.read_csv(\"..\/input\/rsna-str-pulmonary-embolism-detection\/train.csv\")\ntest_df = pd.read_csv(\"..\/input\/rsna-str-pulmonary-embolism-detection\/test.csv\")","32f3e6eb":"print(f\"Total no. of studies = {train_df['StudyInstanceUID'].unique().shape[0]}\")\nprint(f\"Total no. of series = {train_df['SeriesInstanceUID'].unique().shape[0]}\")","cc829bc5":"x = train_df.groupby('StudyInstanceUID').mean()\nx.sum()","296ae6fe":"# for i in ['qa_motion', 'qa_contrast', 'true_filling_defect_not_pe', 'flow_artifact']\nprint(f\"Total indeterminate using qa_motion and qa_contrast = {train_df[(train_df['qa_motion']== 1.0) | (train_df['qa_contrast']== 1.0)].shape[0]}\")\nprint(f\"Total indeterminate directly = {train_df[(train_df['indeterminate']== 1.0)].shape[0]}\")\n\nprint(f\"Total indeterminate and has PE = {train_df[(train_df['indeterminate']== 1.0) & (train_df['pe_present_on_image']== 1.0)].shape[0]}\")\n","57d2d4e0":"print(f\"Total Flow artifact and has PE = {train_df[(train_df['indeterminate']== 1.0) & (train_df['flow_artifact']== 1.0)].shape[0]}\")\nprint(f\"Total True filling defect not PE and has PE = {train_df[(train_df['indeterminate']== 1.0) & (train_df['true_filling_defect_not_pe']== 1.0)].shape[0]}\")\n","0a956087":"import pydicom as dicom\n# Load the scans in given folder path\ndef load_scan(path):\n    slices = [dicom.read_file(path + '\/' + s) for s in os.listdir(path)]\n    slices.sort(key = lambda x: float(x.ImagePositionPatient[2]))\n    try:\n        slice_thickness = np.abs(slices[0].ImagePositionPatient[2] - slices[1].ImagePositionPatient[2])\n    except:\n        slice_thickness = np.abs(slices[0].SliceLocation - slices[1].SliceLocation)\n        \n    for s in slices:\n        s.SliceThickness = slice_thickness\n        \n    return slices\n\ndef get_pixels_hu(slices):\n    image = np.stack([s.pixel_array for s in slices])\n    # Convert to int16 (from sometimes int16), \n    # should be possible as values should always be low enough (<32k)\n    image = image.astype(np.int16)\n\n    # Set outside-of-scan pixels to 0\n    # The intercept is usually -1024, so air is approximately 0\n    image[image == -2000] = 0\n    \n    # Convert to Hounsfield units (HU)\n    for slice_number in range(len(slices)):\n        \n        intercept = slices[slice_number].RescaleIntercept\n        slope = slices[slice_number].RescaleSlope\n        \n        if slope != 1:\n            image[slice_number] = slope * image[slice_number].astype(np.float64)\n            image[slice_number] = image[slice_number].astype(np.int16)\n            \n        image[slice_number] += np.int16(intercept)\n    \n    return np.array(image, dtype=np.int16)","3cbc3b06":"first_patient = load_scan('..\/input\/rsna-str-pulmonary-embolism-detection\/train\/0003b3d648eb\/d2b2960c2bbf')\nfirst_patient_pixels = get_pixels_hu(first_patient)\n\nplt.imshow(first_patient_pixels[80], cmap=plt.cm.gray)\nplt.show()","a371e10d":"fig, plots = plt.subplots(8, 10, sharex='col', sharey='row', figsize=(20, 16))\nfor i in range(80):\n    plots[i \/\/ 10, i % 10].axis('off')\n    plots[i \/\/ 10, i % 10].imshow(first_patient_pixels[i], cmap=plt.cm.bone) ","76c37dad":"> They are QA Contrast, QA Motion, True filling defect not PE, and Flow artifact, and are not scored, but are meant to be used as helpers. Also note that Acute PE is not an explicit label, but is implied by the lack of Chronic PE or Acute and Chronic PE.\n\nwe may not need the QA Contrast, QA Motion, flow artifact label but True filling defect not PE predictor may help us to find non PE images\/studies directly","c36c9814":"From this we can confirm that 'pe_present_on_image' label is image specific and rest of the  labels are study specific","973c7dbd":"More insights on the way...","7fc083c7":"# Insights on tabular data","efcd0225":"From this we can say that just predicting the indeterminate label would suffice and all the studies with indeterminate flag = 1 have no PE images","04f003ba":"# Insights on Images data","80b9da6b":"This shows that total studies = series which implies studies and series are one and the same (uniquely identify the study)","a85fc7f0":"**From this we can say that each study => each patient**"}}