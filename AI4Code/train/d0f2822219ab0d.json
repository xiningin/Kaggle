{"cell_type":{"ee2a59e6":"code","ca3ca895":"code","64c20903":"code","54747b38":"code","4e7ea5c4":"code","48524055":"code","685f4903":"code","cd678fec":"code","b964fadb":"code","2a8a4c85":"code","0c985043":"code","b0aa8904":"code","b00a7d54":"code","2f299d1e":"markdown"},"source":{"ee2a59e6":"%%capture\n!pip install --no-index --find-links ..\/input\/ktrain\/ ..\/input\/ktrain\/setuptools_scm-6.0.1-py3-none-any.whl\n!pip install --no-index --find-links ..\/input\/ktrain\/ ..\/input\/ktrain\/ktrain-0.26.4.tar.gz ","ca3ca895":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn.model_selection import train_test_split,KFold\nfrom sklearn.metrics import mean_squared_error\n\nimport ktrain\nfrom ktrain import text","64c20903":"data=pd.read_csv('..\/input\/commonlitreadabilityprize\/train.csv')\ndata=data[['excerpt','target']]\ndata.head()","54747b38":"test=pd.read_csv('..\/input\/commonlitreadabilityprize\/test.csv')\ntest.head()","4e7ea5c4":"def transformer(MODEL_NAME):\n    preproc  = text.Transformer(MODEL_NAME, maxlen=200)\n    x_test=test.excerpt.values\n    x_test = preproc.preprocess_test(x_test)\n    predictions,rmses=[],[]\n    for train_index, val_index in KFold(5).split(data):\n        train,val=data.iloc[train_index],data.iloc[val_index]\n        x_train=train.excerpt.values\n        x_val=val.excerpt.values\n\n        y_train=train.target.values\n        y_val=val.target.values\n\n        trn = preproc.preprocess_train(x_train, y_train)\n        val = preproc.preprocess_test(x_val, y_val)\n        model = preproc.get_regression_model()\n        learner = ktrain.get_learner(model, train_data=trn, val_data=val, batch_size=24)\n        learner.fit_onecycle(1e-5, 5)\n        print('mse',learner.validate())\n        pred=learner.predict(val)\n        rmse=mean_squared_error(y_val,pred,squared=False)\n        print('rmse',rmse)\n        predictions.append(learner.predict(x_test))\n        rmses.append(rmse)\n    return predictions,rmses","48524055":"%%capture\nMODEL_NAME_0 = '..\/input\/huggingface-bert-variants\/bert-base-uncased\/bert-base-uncased'\npredictions0,rmses0=transformer(MODEL_NAME_0)\nmean0=np.mean(rmses0)","685f4903":"%%capture\nMODEL_NAME_1 = '..\/input\/huggingface-bert-variants\/distilbert-base-uncased\/distilbert-base-uncased'\npredictions1,rmses1=transformer(MODEL_NAME_1)\nmean1=np.mean(rmses1)\n","cd678fec":"%%capture\nMODEL_NAME_2 = '..\/input\/huggingface-roberta-variants\/distilroberta-base\/distilroberta-base'\npredictions2,rmses2=transformer(MODEL_NAME_2)\nmean2=np.mean(rmses2)\n","b964fadb":"%%capture\nMODEL_NAME_3 = '..\/input\/huggingface-roberta-variants\/roberta-base\/roberta-base'\npredictions3,rmses3=transformer(MODEL_NAME_3)\nmean3=np.mean(rmses3)\n","2a8a4c85":"print('bert mean',rmses0,'all',mean0)\nprint('dbert mean',rmses1,'all',mean1)\nprint('droberta mean',rmses2,'all',mean2)\nprint('roberta mean',rmses3,'all',mean3)","0c985043":"pred0=np.mean(predictions0,0).ravel()\npred1=np.mean(predictions1,0).ravel()\npred2=np.mean(predictions2,0).ravel()\npred3=np.mean(predictions3,0).ravel()\npred1.shape","b0aa8904":"pred=np.average([pred0,pred1,pred2,pred3],weights=[1-mean0,1-mean1,1-mean2,1-mean3],axis=0)\npred.shape\n","b00a7d54":"sub=pd.read_csv('..\/input\/commonlitreadabilityprize\/sample_submission.csv')\nsub.target=pred\nsub.to_csv('submission.csv',index=False)\nsub.head()","2f299d1e":"# transformer"}}