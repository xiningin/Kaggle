{"cell_type":{"fa367565":"code","45c9706b":"code","b58c504d":"code","92618ad8":"code","b2f64891":"code","df38ccf3":"code","ab706608":"code","41b30114":"code","1eb29ea7":"code","da5b02ed":"code","15f19f0e":"code","a428532d":"code","f45e956c":"markdown","6ed41afb":"markdown","93e16b33":"markdown","2f7c3b20":"markdown","efd77dd9":"markdown","8c9f91e9":"markdown","a663c367":"markdown"},"source":{"fa367565":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport plotly.graph_objects as go\nimport plotly.express as px\n\nfrom scipy.signal import savgol_filter\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nfrom sklearn.model_selection import KFold, cross_val_predict\nfrom sklearn.cross_decomposition import PLSRegression\nfrom sklearn.metrics import mean_squared_error, r2_score","45c9706b":"df = pd.read_csv('\/kaggle\/input\/total-recore1\/public.csv')","b58c504d":"X = np.log(df.iloc[:,104:-149].values)\ny = df.CuPPM\nwl = np.arange(450, 3550, 1)\n\nwith plt.style.context('ggplot'):\n    plt.plot(wl, X.T)\n    plt.xlabel(\"Wavelengths (count from 450 to 16409.45)\")\n    plt.ylabel(\"Absorbance\")","92618ad8":"X1 = savgol_filter(X, 7, polyorder = 2, deriv=1)","b2f64891":"plt.figure(figsize=(8, 4.5))\nwith plt.style.context('ggplot'):\n    plt.plot(wl, X1.T)\n    plt.xlabel(\"Wavelengths (count from 450 to 16409.45)\")\n    plt.ylabel(\"Absorbance\")\n    plt.show()","df38ccf3":"def optimise_pls_cv(X, y, n_comp):\n    pls = PLSRegression(n_components=n_comp)\n    y_cv = cross_val_predict(pls, X, y, cv=10)\n    r2 = r2_score(y, y_cv)\n    rmse = np.sqrt(mean_squared_error(y, y_cv))\n    rpd = y.std()\/rmse\n    return (y_cv, r2, rmse, rpd)","ab706608":"r2s = []\nrmses = []\nrpds = []\nxticks = np.arange(1, 40)\nfor n_comp in xticks:\n    y_cv, r2, rmse, rpd = optimise_pls_cv(X1, y, n_comp)\n    r2s.append(r2)\n    rmses.append(rmse)\n    rpds.append(rpd)","41b30114":"def plot_metrics(vals, ylabel, objective):\n    with plt.style.context('ggplot'):\n        plt.plot(xticks, np.array(vals), '-v', color='blue', mfc='blue')\n        if objective=='min':\n            idx = np.argmin(vals)\n        else:\n            idx = np.argmax(vals)\n        plt.plot(xticks[idx], np.array(vals)[idx], 'P', ms=10, mfc='red')\n\n        plt.xlabel('Number of PLS components')\n        plt.xticks = xticks\n        plt.ylabel(ylabel)\n        plt.title('PLS')\n\n    plt.show()","1eb29ea7":"plot_metrics(rmses, 'RMSE', 'min')","da5b02ed":"plot_metrics(rpds, 'RPD', 'max')","15f19f0e":"plot_metrics(r2s, 'R2', 'max')","a428532d":"y_cv, r2, mse, rpd = optimise_pls_cv(X1, y, 20)\nprint('R2: %0.4f, RMSECV: %0.4f, RPD: %0.4f' %(r2, mse, rpd))","f45e956c":"# Research: \n## An application of Partial Linear Squares Regression\n\n* https:\/\/www.researchgate.net\/publication\/320574866_Vis-NIR_Spectroscopy_and_PLS_Regression_with_Waveband_Selection_for_Estimating_the_Total_C_and_N_of_Paddy_Soils_in_Madagascar\n\n* https:\/\/www.sciencedirect.com\/science\/article\/abs\/pii\/S1470160X20301734\n\n## Code\n* https:\/\/github.com\/nevernervous78\/nirpyresearch\/blob\/master\/snippets\/Wavelength%20band%20selection%20with%20simulated%20annealing.ipynb\n* https:\/\/nirpyresearch.com\/variable-selection-method-pls-python\/","6ed41afb":"# Optimisation for the number of components in PLS","93e16b33":"https:\/\/docs.scipy.org\/doc\/scipy\/reference\/generated\/scipy.signal.savgol_filter.html","2f7c3b20":"# Savitzky-Golay filter ","efd77dd9":"# Objective\n\nTo establish a quantitative model (i.e. Partial Least Squares) for estimating the concentration of a mineral using first derivative smoothing, Savitzky-Golay filter.","8c9f91e9":"* https:\/\/www.researchgate.net\/profile\/Zhihui-Gu-3\/publication\/222578126_A_simple_method_for_reconstructing_a_high-quality_NDVI_time-series_data_set_based_on_the_Savitzky-Golay_filter\/links\/5d382eca4585153e591c9210\/A-simple-method-for-reconstructing-a-high-quality-NDVI-time-series-data-set-based-on-the-Savitzky-Golay-filter.pdf\n* https:\/\/inst.cs.berkeley.edu\/~ee123\/fa12\/docs\/SGFilter.pdf\n* https:\/\/www.researchgate.net\/profile\/Jianwen-Luo-2\/publication\/220227041_Savitzky-Golay_smoothing_and_differentiation_filter_for_even_number_data\/links\/5c711401458515831f681fe3\/Savitzky-Golay-smoothing-and-differentiation-filter-for-even-number-data.pdf\n* https:\/\/aip.scitation.org\/doi\/pdf\/10.1063\/1.4822961","a663c367":"# Loading Libraries and Data"}}