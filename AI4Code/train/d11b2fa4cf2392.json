{"cell_type":{"d0b579d1":"code","47679e2c":"code","31601608":"code","d5c1f7a7":"code","0e6fdcc6":"code","5f33fd7f":"code","81c59a2f":"code","df9d1ea1":"code","9310e76d":"code","5e6d289f":"code","7194ada9":"code","439849b1":"code","e3b88d49":"code","d41bf955":"code","f68aba9c":"code","ff3cd089":"code","c5fcd92b":"code","562f776b":"code","0f5a8c2d":"code","85888f76":"code","59a195c1":"code","be77e04f":"code","762d374f":"code","75bd6d9e":"code","0fbc5b5e":"code","6ccadf44":"code","93c4f611":"code","e564ad72":"code","f1d24e0e":"code","3fe83a6d":"code","8257d119":"code","1ba5a802":"code","ec30e007":"code","a1262186":"code","04074540":"code","db8bcb1d":"code","41ac63e6":"code","8c603fd2":"code","5145d2a8":"code","b688e75b":"code","1fca6a19":"code","3ed3e20e":"code","579ea680":"code","d8968181":"code","5f2f522a":"code","f6e413d1":"code","5b396ad0":"code","e60f51cc":"code","b8a29d0d":"code","d7b6863f":"code","d742b944":"code","f3e4c624":"code","cf6d6757":"code","e48d06a7":"code","6dd7a2d8":"code","a768c992":"code","e3361fe3":"code","d28db144":"markdown","3da59742":"markdown","518fce3c":"markdown","b3a31b14":"markdown","a2fcf9c0":"markdown","90d3d305":"markdown","a60183d6":"markdown","835a2655":"markdown","bd8970d8":"markdown","cc9420ae":"markdown","0277d839":"markdown","e3963bdc":"markdown","6f30abff":"markdown","d324c64f":"markdown","48bc9f0e":"markdown","0c79e914":"markdown","e6761edb":"markdown","181535d9":"markdown","f3949089":"markdown","e60ce891":"markdown","465cc99e":"markdown","df02a41f":"markdown","2db27273":"markdown","05e66fb0":"markdown","ded94ac7":"markdown","64761e1e":"markdown","fb943267":"markdown","de996173":"markdown","a3f03374":"markdown","f912b70b":"markdown"},"source":{"d0b579d1":"# Load CSV \nimport csv\nimport numpy\nimport pandas\n%pylab inline\nfilename = '..\/input\/winemag-data_first150k.csv'\nwinedata = pandas.read_csv(filename)\nprint(winedata.shape)","47679e2c":"winedata.head()","31601608":"# Find out the duplicaet value\nprint(\"Total number of examples: \", winedata.shape[0])\nprint(\"Number of examples with the same description: \", winedata[winedata.duplicated(['description'])].shape[0])","d5c1f7a7":"Cleanwine = winedata.drop_duplicates('description', keep='first', inplace=False)\nCleanwine.dropna(subset=['description','points','price'], inplace=True)\nCleanwine.shape","0e6fdcc6":"## Finding missing values\ntotal = Cleanwine.isnull().sum().sort_values(ascending = False)\ntotal","5f33fd7f":"CountryList = Cleanwine['points'].groupby(winedata['country']).mean()\nCountryList = CountryList.to_frame().reset_index()\nCountryList.columns = ['country', 'AvgPoints']\nCountryList.sort_values(by='AvgPoints', ascending=False).head(10)\n# Calculate average points for wines from each country","81c59a2f":"count = Cleanwine.country.value_counts()\ncount = count.to_frame('count').reset_index()\ncount.columns = ['country', 'count']\nCountryList = CountryList.merge(count, on=\"country\", how='left')\nCountryList.sort_values(by='count',ascending=True).head(10)","df9d1ea1":"CountryList.sort_values(by='count',ascending=False).head(10)","9310e76d":"Cleanwine['country'].value_counts()[:10].plot(kind='bar',figsize=(12,8));\nplt.xticks(rotation=45)\nplt.xlabel('country')\nplt.ylabel('Number of country count')\nplt.show()","5e6d289f":"Cleanwine2 = Cleanwine.merge(CountryList, on=\"country\", how='left')\nMajor = Cleanwine2[Cleanwine2['count'] >= 500]\nMajor.shape\n","7194ada9":"MajorCountry = Major['points'].groupby(Major['country']).mean()\nMajorCountry= MajorCountry.to_frame().reset_index()\nMajorCountry.columns = ['country', 'AvgPoints']\nMajorCountry.sort_values(by='AvgPoints', ascending=False)","439849b1":"count2 = Major.variety.value_counts()\ncount2 = count2.to_frame('count').reset_index()\ncount2.columns = ['variety', 'countgrape']\ncount2.shape","e3b88d49":"count2.sort_values(by='countgrape', ascending=False).head(10)","d41bf955":"count2.sort_values(by='countgrape', ascending=True).head(10)","f68aba9c":"Cleanwine3 = Major.merge(count2, on=\"variety\", how='left')\nMajor2 = Cleanwine3[Cleanwine3['countgrape'] >= 500]\nMajor2. head(10)","ff3cd089":"Major2.variety.nunique()\n","c5fcd92b":"Major2.variety.value_counts()","562f776b":"import seaborn as sns\nsns.countplot(x='points',data = Major2, palette='hls' )\nplt.show()","0f5a8c2d":"CountryList2 = Major2['price'].groupby(Major2['country']).mean()\nCountryList2 = CountryList2.to_frame().reset_index()\nCountryList2.columns = ['country', 'price']\nCountryList2.sort_values(by='price', ascending=False).head(10)\n","85888f76":"plt.figure(figsize=(20,25))\nplt.subplot(2,1,1)\ng = sns.boxplot(x='country', y='price',data=Major2)\ng.set_title(\"Which country has the most expensive wines\", fontsize=25)\ng.set_xlabel(\"Country\", fontsize=20)\ng.set_ylabel(\"Price ($)\", fontsize=20)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n                \nplt.show()","59a195c1":"plt.figure(figsize=(20,5))\nplt.title(\"Distribution of price\")\nax = sns.distplot(Major2[\"price\"])","be77e04f":"# if we want to see better price distribution we have to scale our price or drop the tail.  \n\nplt.figure(figsize=(20,5))\nplt.title(\"Distribution of price\")\nax = sns.distplot(Major2[Major2[\"price\"]<200]['price'])\n\npercent=Major2[Major2['price']<200].shape[0]\/Major2.shape[0]*100\nprint(\"There are :\", percent, \"% wines less than 200 USD\")","762d374f":"percent=Major2[Major2['price']>200].shape[0]\/Major2.shape[0]*100\nprint(\"There are :\", percent, \"% wines more expensive than 200 USD\")","75bd6d9e":"print(\"Number of wines costs more than 200USD:\", Major2[Major2['price']>200].shape[1])","0fbc5b5e":"plt.figure(figsize=(20,16))\nplt.subplot(2,1,2)\ng1 = sns.boxplot(x='country', y='points',data=Major2)\ng1.set_title(\"Which country has the highest rated wines\", fontsize=25)\ng1.set_xlabel(\"Country's \", fontsize=20)\ng1.set_ylabel(\"Points\", fontsize=20)\ng1.set_xticklabels(g1.get_xticklabels(),rotation=45)\nplt.subplots_adjust(hspace = 0.6,top = 0.9)\nplt.show()","6ccadf44":"variety = Major2.variety.unique().tolist()\nvariety[:5]\n# Extract a list of grape varieties","93c4f611":"lcvariety = [x.lower() for x in variety]\nlcvariety[:5] #convert the grape varieties to lowercase","e564ad72":"bkvariety = [i.replace('-', ' ').replace(',', ' ').split(' ') for i in lcvariety] #generated a list of list\nbkvariety = [item for sublist in bkvariety for item in sublist] # convert list of list to a python list\nbkvariety[:8] #break down the grape variety names into separate words","f1d24e0e":"bkvariety.remove('red')\nbkvariety.remove('white')","3fe83a6d":"import nltk\nfrom nltk.corpus import stopwords\nstop = set(stopwords.words('english'))\nstop.update(variety,lcvariety,bkvariety) #update stop words","8257d119":"print(stop)","1ba5a802":"import sklearn\nsklearn.__version__","ec30e007":"from sklearn.model_selection import train_test_split\nX = Major2.description\ny = Major2.variety\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=15)\nprint(X_train.shape, X_test.shape, y_train.shape, y_test.shape)","a1262186":"Major2.info()","04074540":"#Heuristic data exploration\nprint(type(X))\nprint(type(y))\nprint(len(X))\nprint(len(y))","db8bcb1d":"set(y) #grape varieties as the target","41ac63e6":"#take a look at some sample data\nprint(X[17])\nprint(y[17])","8c603fd2":"from sklearn.feature_extraction.text import CountVectorizer\nvec = CountVectorizer(stop_words = stop, ngram_range=(1, 3), max_features=3000) \n#vec = CountVectorizer(stop_words = stop, ngram_range=(1, 3), min_df=3, max_features=5000) \nX_train_vec = vec.fit_transform(X_train)\nX_train_vec","5145d2a8":"from sklearn.linear_model import LogisticRegression\nlogit = LogisticRegression()\nlogit.fit(X_train_vec, y_train)","b688e75b":"X_test_vec= vec.transform(X_test)\ny_pred = logit.predict(X_test_vec)\nlist(zip(y_pred, y_test))[:10]","1fca6a19":"from sklearn import metrics\n\nmetrics.accuracy_score(y_test, y_pred)","3ed3e20e":"print(metrics.precision_score(y_test, y_pred, average='weighted'))\nprint(metrics.recall_score(y_test, y_pred, average='weighted'))\nprint(metrics.f1_score(y_test, y_pred, average='weighted'))","579ea680":"print(metrics.classification_report(y_test, y_pred))","d8968181":"Myreview =['This wine is clear pale lemon-green. The nose is crisp clean, full of lovely youthful aromas of grapfruit peel, lemon zest, and apricot. The signature herbaceous flavor is reminiscent of asparagus, green pepper, and a hint of crushed wet stones. The wine offers high acidity, balanced with pronounced fruitiness and decent length. Can drink now, but has potential for aging to further develop complexity and tertiary flavors. It pairs well with seafood - show off the umami in oysters or cut off the fattiness in salmon. It would also be a great choice to pair with Asian hotpot and sichuan cuisine with its refreshing acidity.']\nX_test_vec= vec.transform(Myreview)\ny_pred = logit.predict(X_test_vec)","5f2f522a":"print(y_pred)","f6e413d1":"from sklearn.feature_extraction.text import TfidfTransformer\ntf = TfidfTransformer()\nX_tf = tf.fit_transform(X_train_vec)\nX_tf.shape","5b396ad0":"from sklearn.linear_model import LogisticRegression\nlogit = LogisticRegression()\nlogit.fit(X_tf, y_train)","e60f51cc":"X_test_vec= vec.transform(X_test)\nX_test_tf = tf.transform(X_test_vec)\ny_pred = logit.predict(X_test_tf)","b8a29d0d":"from sklearn import metrics\n\nmetrics.accuracy_score(y_test, y_pred)","d7b6863f":"print(metrics.precision_score(y_test, y_pred, average='weighted'))\nprint(metrics.recall_score(y_test, y_pred, average='weighted'))\nprint(metrics.f1_score(y_test, y_pred, average='weighted'))","d742b944":"print(metrics.classification_report(y_test, y_pred))","f3e4c624":"from sklearn.tree import DecisionTreeClassifier\nclf = DecisionTreeClassifier(random_state=13)\nclf.fit(X=X_train_vec,y=y_train)","cf6d6757":"clf.score(X=X_test_vec, y=y_test)","e48d06a7":"df = Major2[['price','points']]\ndf.dropna(subset=['price','points'], inplace=True)","6dd7a2d8":"from scipy.stats import pearsonr\nprint(\"Pearson Correlation:\", pearsonr(df.price, df.points))\n","a768c992":"import statsmodels.api as sm\nprint(sm.OLS(df.points, df.price).fit().summary())","e3361fe3":"sns.lmplot(y = 'price', x='points', data=df)","d28db144":"### Scanning the data - (1) representitiveness of grape variety","3da59742":"### As shown in above chart, most great wines are not going to cost you a fortune. Even the highest priced wine in this dataset did not fetch the highest rating...\n## *******To be continued....","518fce3c":"## Bag of Words - Vectorization","b3a31b14":"### Clean up the data - Remove duplicaet and Null value, left with 89K data entries","a2fcf9c0":"### Some countries only have 1-2 wines represented in this dataset, and top country, US, has over 40k wines represented....\n### Therefore, executive decisions are made to remove all countries with less than 500 observations","90d3d305":"### 58K data entries for training, 15K data entries for testing","a60183d6":"### The list of countries that have highest rated wines looks odd, as England, India, Morocco, and Slovenia are not even considered major wine regions\n### -> Look into number of wines represented in this dataset for each country\n\n### Scanning the data - (1) representitiveness of wine region","835a2655":"### There are over 10,000 kinds of grape varieties in the world \n### 567 kinds of grape varieties are represented in[](http:\/\/) this dataset","bd8970d8":"### Test on the test set","cc9420ae":"### 13 countries representing the major wine regions are left","0277d839":"\n## Decision Tree Classifier Model\n\nhttp:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.tree.DecisionTreeClassifier.html","e3963bdc":"### The score is not particularly high, but it's reasonable. \n### Even well trained sommelier and wine masters would not be able to achieve 100% accuracy, so I'm very happy with the result so far","6f30abff":"## Training a Logistic Regression Model\n### Spliting the data: 80% for traning and 20% for testing","d324c64f":"### Above list shows the countries making the most expensive wines on average.... It's not surprising to see France come to the top, but I would expect to see Italy and Spain rank lower than where they are here. ","48bc9f0e":"### Executive decision are made to remove all grape varieties with less than 500 observations","0c79e914":"## Also wanted to test on some of external wine reviews that are not from this dataset... \n## so I wrote this fluffy wine review on Cloudy Bay Sauvignon Blanc 2017:\n\n### \"This wine is clear pale lemon-green. The nose is crisp clean, full of lovely youthful aromas of grapfruit peel, gooseberry, lime zest, and apricot. The signature herbaceous flavor is reminiscent of asparagus, green pepper, and a hint of crushed white stones. The wine offers high acidity, balanced with pronounced fruitiness and decent length. Can drink now, but has potential for aging to further develop complexity and tertiary flavors. It pairs well with seafood - shows off the umami in oysters or cuts off the fattiness in salmon. It would also be a great choice to pair with Asian hotpot and Sichuan cuisine with its refreshing acidity.\"","e6761edb":"### Now we made sure that all entreis that missing variety, price, points, and descriptions (review) are deleted from the dataset\n### Next step: Scanning the data for any bais or skewness","181535d9":"## (2) Explore relationship between wine price and and points\/wine region\/ grape variety\n\n### Relationship between points and price:\n#### Pearson's correlation coefficient between two variables is defined as the covariance of the two variables divided by the product of their standard deviations.","f3949089":"### Even with the variety included with stopwords, I still get unconvincingly high scores for Logistic Regression and Decision Tree Regression...\n### After some investigation I realized that varieties are mentioned in wine reviews often in lower case, so need to include lower case varietites as stop words, break down the hyphenated words...","e60ce891":"## Excited to see the model predicted correctly on my wine review!","465cc99e":"## With TF-IDF (Term Frequency-Inverse Document Frequency)","df02a41f":"## Without TF-IDF (Term Frequency-Inverse Document Frequency)","2db27273":"## Goal (1): Use wine review description to predict grape variety\n\n### often wine review mentions grape variety, therefore first step is to classify grape variety as stop words\n### -> Eliminate grape variety from  wine review description, so that description can serve as blind tasting notes, which is the ground for making judgement on grape variety","05e66fb0":"### we are left with 31 grape varieties representing the most commonly used grape varieties in wine production","ded94ac7":"### In this case, Logistic Regreesion Model with TF-IDF > Logistic Regreesion Model without TF-IDF > Decision Tree Classifier Model","64761e1e":"### Now we are happy with the dataset representing only wines from major wine regions and commonly seen grape varieties.\n### As shown in below chart, most wines are rated between the range of 84-92, \"wine points system\" has been a very controversial topic in the wine industry, as you can see here there are not much differentiation here as you would expect.","fb943267":"### Happy to report that wine price do show positive relationship with wine rating (implying quality), but it's not a strong relationship! \n### [](http:\/\/)There are other factors to be identified...","de996173":"### But I don't think it's fair to consider 'red' or 'white' as stop word, as in \"blind tasting\" you do see the color of the wine, color descriptions should not be included in the stopwords\n### Color descriptions like ruby, garnet, gold, lemon-green and color intensity descriptions are all important clues in deductive blind tasting","a3f03374":"### Test on the test set","f912b70b":"### Dataset: 150,000 wine reviews scrapped from Wine Enthusiast Magazine (winemag.com)\n\n### I took interest in this dataset as I have a WSET Level 3 blind tasting exam coming up next month, I'm curious to know if machine can perform deductive wine tasting as a trained human can do\n\n###  Goal: \n## (1) Use wine review description to predict grape variety \n### Wine reviews usually discuss level of tannin, acidity, aromas, color, intensity, which are important indicators of grape variety in a blind tasting situation\n\n## (2) Explore relationship between wine price and and points\/wine region\/ grape variety, \n### Unfortunately, the dataset do not show vintage, which is an important pricing factor"}}