{"cell_type":{"af808f30":"code","5e4f1cb9":"code","e75fb1bc":"code","ece9212b":"code","df58d56f":"code","716c916e":"code","048a5e5f":"code","f37f3551":"code","7aa8debb":"code","2a772d67":"code","37559781":"code","8bf6668b":"markdown","8f661a78":"markdown","e8842b39":"markdown","6d6e5db9":"markdown"},"source":{"af808f30":"!pip install Augmentor","5e4f1cb9":"# Importing necessary libraries\n\nfrom keras.layers import Input, Lambda, Dense, Flatten\nfrom keras.models import Model, Sequential\nfrom keras.applications.resnet50 import ResNet50\nfrom keras.preprocessing import image\nfrom keras.preprocessing.image import ImageDataGenerator\nfrom keras.models import Sequential\nimport numpy as np\nfrom glob import glob\nimport matplotlib.pyplot as plt\nimport os\nfrom pathlib import Path\nimport pandas as pd\nimport seaborn as sns\nimport cv2\nimport Augmentor\nfrom keras.applications.resnet50 import ResNet50\n\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=FutureWarning)","e75fb1bc":"# Input data files are available in the \"..\/input\/chest-xray-pneumonia\/chest_xray\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\ndirectory = os.listdir('..\/input\/chest-xray-pneumonia\/chest_xray')\nprint(directory)","ece9212b":"data_dir = Path('..\/input\/chest-xray-pneumonia\/chest_xray\/chest_xray')\n\n# Path to train directory \ntrain_dir = data_dir\/'train'\n\n# Path to validation directory\nval_dir = data_dir\/'val'\n\n# Path to test directory\ntest_dir = data_dir\/'test'\nprint(train_dir)","df58d56f":"# Get the list of all the images\nnormal_train_cases = train_dir.glob('NORMAL\/*.jpeg')\npneumonia_train_cases = train_dir.glob('PNEUMONIA\/*.jpeg')","716c916e":"train_data = []\n\n# Go through all the normal cases. The label for these cases will be 0\nfor img in normal_train_cases:\n    train_data.append((img,0))\n    \n# Go through all the pneumonia cases. The label for these cases will be 1\nfor img in pneumonia_train_cases:\n    train_data.append((img, 1))\n    \n# Get a pandas dataframe from the data we have in our list \ntrain_data = pd.DataFrame(train_data, columns=['image', 'label'],index=None)\n","048a5e5f":"train_data.head()","f37f3551":"train_data.tail()","7aa8debb":"sns.set_style('whitegrid')\nsns.countplot(x='label', data=train_data, palette='RdBu_r')","2a772d67":"resnet = ResNet50(weights='imagenet', include_top=False, input_shape=(256, 256, 3))\n\n# don't train existing weights\nfor layer in resnet.layers:\n    layer.trainable = False\n\n# useful for getting number of classes\nfolders = glob('..\/input\/chest-xray-pneumonia\/chest_xray\/train\/*')\n\nmodel = Sequential()\n\nmodel.add(resnet)\n\nmodel.add(Flatten())\n\nmodel.add(Dense(len(folders), activation='softmax'))\n\nmodel.summary()\n\n# Compile \nmodel.compile(loss='categorical_crossentropy', optimizer='adam',metrics=['accuracy'])","37559781":"# Part 2 - Fitting the CNN to the images\nfrom keras.preprocessing.image import ImageDataGenerator\n\nTRAIN_DIR = '..\/input\/chest-xray-pneumonia\/chest_xray\/train\/'\nHEIGHT = 256\nWIDTH = 256\nBATCH_SIZE = 32\n\nfrom imblearn.keras import balanced_batch_generator\n\n# Data Augmentation\ntrain_datagen = ImageDataGenerator(rescale = 1.\/255,\n                                   shear_range = 0.2,\n                                   zoom_range = 0.2,\n                                   horizontal_flip = True)\n\ntest_datagen = ImageDataGenerator(rescale = 1.\/255,\n                                   shear_range = 0.2,\n                                   zoom_range = 0.2,\n                                   horizontal_flip = True)\n\ndatagen = ImageDataGenerator()\nbalanced_gen = BalancedDataGenerator(x, y, datagen, batch_size=32)\n\n\ntraining_set = train_datagen.flow_from_directory(TRAIN_DIR',\n                                                 target_size = (HEIGHT, WIDTH),\n                                                 batch_size = BATCH_SIZE,\n                                                class_mode = 'categorical')\n\ntest_set = test_datagen.flow_from_directory('..\/input\/chest-xray-pneumonia\/chest_xray\/test\/',\n                                            target_size = (HEIGHT, WIDTH),\n                                            batch_size = BATCH_SIZE,\n                                           class_mode = 'categorical')\n\nmodel.fit_generator(training_set,\n                         steps_per_epoch=len(training_set),\n                         epochs=5,\n                         validation_data=test_set,\n                         validation_steps=len(test_set))","8bf6668b":"Checking wether images are Grey-Scale or RGB","8f661a78":"The dataset is divided into three sets: 1) train set 2) validation set and 3) test set. Let's grab the dataset","e8842b39":"Each of the above directory contains two sub-directories:\n* NORMAL: These are the samples that describe the normal (no pneumonia) case.\n* PNEUMONIA: This directory contains those samples that are the pneumonia cases.","6d6e5db9":"**Overview**\n\nPneumonia is an infection in one or both lungs. Bacteria, viruses, and fungi cause it.\nThe infection causes inflammation in the air sacs in your lungs, which are called alveoli. The alveoli fill with fluid or pus, making it difficult to breathe.\nThere are several types of infectious agents that can cause pneumonia.\n* Bacterial pneumonia\n* Viral pneumonia\n* Fungal pneumonia\n\n**Pneumonia diagnosis**\n\nDepending on the severity of your symptoms and your risk for complications, your doctor may also order one or more of these tests:\n* Chest X-ray\n* Blood culture\n* Sputum culture\n* Pulse oximetry\n* CT scan\n* Fluid sample\n* Bronchoscopy"}}