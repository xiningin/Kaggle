{"cell_type":{"e849af9f":"code","9007ccd9":"code","c937419b":"code","6e3ec9dc":"code","b482bb62":"code","426d1cf8":"code","407fc47e":"code","8e5c3e66":"code","ffae14fc":"code","fd11ddc5":"code","473baf00":"code","2db8a891":"code","5b00289d":"code","cd549538":"code","a98700bf":"code","6e732212":"code","6b63b435":"code","66fa2276":"code","a779f05d":"code","453f18ae":"code","476f8d78":"code","d7118a73":"code","4dcb4f6a":"code","e77e43c9":"code","39d6834f":"code","b34c6081":"code","543ca4e4":"code","c35d1cd2":"code","13cc9a9e":"code","a7adba71":"code","5c7cf3e4":"code","5d8a7136":"code","aa572282":"code","b4fd98dc":"code","40789f6c":"code","b20e7f62":"code","9dc8fbe8":"code","2df8e8e7":"code","2559294b":"code","825b178f":"code","63d8c020":"code","8a8a22b1":"code","037f873a":"code","755647ca":"code","a8796f39":"code","9feaee63":"code","061dc6b7":"code","d684ded6":"code","dfbdc518":"code","48c7d3b0":"code","fdf10689":"code","b5c62a37":"code","87ca8a56":"code","b9e107e7":"code","a2ab5a78":"code","62389b69":"code","e76224f6":"code","81d00b08":"code","3d38b998":"code","4f9fb860":"code","a563d230":"code","c91ddc84":"code","90fcd358":"code","eff6d83c":"code","7b3237f3":"code","f86875cc":"code","346bfad7":"markdown","6d469843":"markdown","52cf2342":"markdown","7425a62a":"markdown","afab7353":"markdown","7b78d4bc":"markdown","549e6b8d":"markdown","df61c8c3":"markdown","fb24507e":"markdown","3a3a78ab":"markdown","fd0b7f67":"markdown","0da68a83":"markdown","c2beab5a":"markdown","58dd186e":"markdown","09bd05e3":"markdown","f5b3108f":"markdown","6004d82e":"markdown","f7f9858b":"markdown","79e374c3":"markdown","f351f4f2":"markdown","1ff61cfb":"markdown","c916ed0c":"markdown","0f4619a6":"markdown","09a0a76c":"markdown","ab84a1c2":"markdown","8cf48be4":"markdown","0a521fe6":"markdown","3ec10623":"markdown","eba5596c":"markdown","0369a12a":"markdown","6599b47c":"markdown","06a0ada6":"markdown","2185938a":"markdown"},"source":{"e849af9f":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport ast\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\nimport plotly.graph_objects as go\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","9007ccd9":"movies = pd.read_csv(\"\/kaggle\/input\/tmdb-movie-metadata\/tmdb_5000_movies.csv\")\ncredits = pd.read_csv(\"\/kaggle\/input\/tmdb-movie-metadata\/tmdb_5000_credits.csv\")\n\nprint(\"Movies shape {}\".format(movies.shape))\nprint(\"Credits shape {}\".format(credits.shape))","c937419b":"movies.head()","6e3ec9dc":"credits.head()","b482bb62":"def parsing(column, data):  \n  data[column] = data[column].fillna('[]').apply(ast.literal_eval) # make it a list\n  data[column] = data[column].apply(lambda x: [i['name'] for i in x] if isinstance(x, list) else []) #iterate over its elements","426d1cf8":"def get_director(column, data):\n    data[column] = data[column].fillna('[]').apply(ast.literal_eval) # make it a list\n    data[column] = data[column].apply(lambda x: [i['name']  for i in x if i['job'] == \"Director\"] if isinstance(x, list) else []) #iterate over its elements","407fc47e":"parsing('genres', movies)\nparsing('production_companies', movies)\nparsing('production_countries', movies)\nparsing('spoken_languages', movies)\nparsing('keywords', movies)\nparsing('cast', credits)\nget_director('crew', credits)","8e5c3e66":"movies.head()","ffae14fc":"credits.head()","fd11ddc5":"credits.rename(columns={'movie_id': 'id', 'crew': 'Director'}, inplace=True)","473baf00":"df = pd.merge(movies, credits.drop(columns=['title']), on=\"id\")","2db8a891":"directors = []\nfor i in df.index:\n    current = df.iloc[i]['Director']\n    if(len(current) > 0):\n        directors.append(current[0])\n    else:\n        directors.append(\" \")","5b00289d":"df['Director'] = directors\ndf.head()","cd549538":"df.release_date = pd.to_datetime(df.release_date,  errors='coerce')\ndf['Year'] = df.release_date.dt.year\ndf['month'] = df.release_date.dt.month\ndf['weekday'] = df.release_date.dt.weekday","a98700bf":"df['profit'] = df['revenue'] - df['budget']\ndf['profit_rate'] = df['profit'] \/ df['budget']\n\ndf.head()","6e732212":"revenues = df.groupby('Year')['revenue'].sum()\nbudgets = df.groupby('Year')['budget'].sum()\nprofits = df.groupby('Year')['profit'].sum()\n\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=revenues.index, y=revenues.values,\n                    mode='lines',marker_color='blue',name='Revenues'))\n\nfig.add_trace(go.Scatter(x=budgets.index, y=budgets.values,\n                    mode='lines',marker_color='red',name='Budgets'))\n\nfig.add_trace(go.Scatter(x=profits.index, y=profits.values,\n                    mode='lines',marker_color='green',name='Profits'))\n\nfig.update_layout(title_text='Money Statistics')\nfig.add_annotation(\n            x=2012,\n            y=revenues.values.max(),\n            text=\"Peak\")\n\nfig.show()","6b63b435":"twenty_two = df[df['Year'] == 2012]\ntwenty_two.sort_values(by=\"profit\", ascending=False)[['title', 'budget', 'revenue', 'profit', 'genres']].head(10)","66fa2276":"twenty_four = df[df['Year'] == 2014]\ntwenty_four.sort_values(by=\"profit\", ascending=False)[['title', 'budget', 'revenue', 'profit', 'genres']].head(10)","a779f05d":"sub_data = df[(df['budget'] != 0) & (df['revenue'] != 0) & (df['budget'] > 10000000)]\nsub_data.sort_values(by='profit_rate', ascending=False)[['title', 'budget', 'profit', 'genres', 'profit_rate', 'Year']].head(20)","453f18ae":"fig = px.scatter(df, x=\"budget\", y=\"revenue\", trendline=\"ols\", title=\"Relationship between Budget and Revenue\")\nfig.update_layout(xaxis_title=\"Budget\", \n                 yaxis_title=\"Revenue\")\nfig.show()","476f8d78":"px.histogram(df[df['vote_count'] < 5000],x='vote_count',title='Distribution of Vote Counts',color_discrete_sequence=['#7D3C98'])","d7118a73":"fig = px.bar(df.sort_values(by=\"vote_count\", ascending=False).iloc[:20][::-1], x=\"vote_count\", y=\"title\", orientation='h', title=\"Movies with most vote counts\")\nfig.show()","4dcb4f6a":"fig = px.histogram(df,x='vote_average',title='Distribution of Vote Averages',color_discrete_sequence=['#7D3C98'])\nfig.update_layout(xaxis_title=\"Vote Average\", \n                 yaxis_title=\"Numbers\")\n\nfig.show()","e77e43c9":"from scipy.stats import skew\nskew(df['vote_average'])","39d6834f":"subdata = df[df['vote_count'] > 250]\nfig = px.bar(subdata.sort_values(by=\"vote_average\", ascending=False).iloc[:20][::-1], x=\"vote_average\", y=\"title\", orientation='h', title=\"Movies with most vote counts\",color_discrete_sequence=['#52BE80'])\nfig.update_layout(yaxis_title=\"Movie Title\",\n                 xaxis_title=\"\u0130mdb Score\")\nfig.show()","b34c6081":"def get_most_10(data, column):\n    temp_data = data.apply(lambda x: pd.Series(x[column], dtype='object'),axis=1).stack().reset_index(level=1, drop=True)\n    a = temp_data.value_counts().reset_index()\n    a.rename(columns={0: 'Value'})\n    fig = px.bar(a.iloc[:10][::-1], x=0, y='index', orientation='h', title=\"Top 10 {}\".format(column),color_discrete_sequence=['#707B7C '])\n    fig.show()\n    ","543ca4e4":"get_most_10(df, 'genres')","c35d1cd2":"get_most_10(df, 'cast')","13cc9a9e":"get_most_10(df, 'keywords')","a7adba71":"get_most_10(df, 'production_countries')","5c7cf3e4":"most_profit_movies = df.sort_values(by=\"profit\", ascending=False).head(200)\nget_most_10( most_profit_movies, 'genres')","5d8a7136":"get_most_10( most_profit_movies, 'keywords')","aa572282":"get_most_10( most_profit_movies, 'cast')","b4fd98dc":"get_most_10( most_profit_movies, 'spoken_languages')","40789f6c":"years = df.groupby('Year')['title'].count()\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=years.index, y=years.values,\n                    mode='lines+markers',marker_color='cyan',name='Number of Movies in Years'))\nfig.update_layout(title_text='Number of Movies in Years', \n                  plot_bgcolor='white',\n                 xaxis_title=\"Years\",\n                 yaxis_title=\"Number of Movies\")\nfig.show()","b20e7f62":"months = df.groupby('month')['title'].count()\nmonths_names = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\nfig = go.Figure()\nfig.add_trace(go.Bar(y=months_names[::-1], x=months.values[::-1],name='Number of Movies in Months', orientation='h'))\nfig.update_layout(title_text='Number of Movies in Months',\n                 xaxis_title=\"Number of Movies\",\n                 yaxis_title=\"Months\",\n                 plot_bgcolor='white')\nfig.show()","9dc8fbe8":"days = df.groupby('weekday')['title'].count()\ndays_names = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday' ]\nfig = go.Figure()\nfig.add_trace(go.Bar(y=days_names[::-1], x=days.values[::-1],name='Number of Movies in Days', orientation='h'))\nfig.update_layout(title_text='Number of Movies in Days',\n                 xaxis_title=\"Number of Movies\", \n                 yaxis_title=\"Week Days\",\n                 plot_bgcolor='white')\nfig.show()","2df8e8e7":"C = df['vote_average'].mean()\nm = df['vote_count'].quantile(0.75)\n","2559294b":"print(\"c is {}\".format(C))\nprint(\"m is {}\".format(m))","825b178f":"df['imdb_rating'] = (df['vote_average']*df['vote_count'] + C*m) \/ (df['vote_count'] + m)\ndf['imdb_rating']","63d8c020":"df.sort_values(by=\"imdb_rating\", ascending=False)[['title', 'imdb_rating']].reset_index(drop=True).iloc[:10]","8a8a22b1":"plt.figure(figsize=(15, 10))\ndata = df.sort_values(by=\"imdb_rating\", ascending=False)[['title', 'imdb_rating']][:20]\nfig = go.Figure()\nfig.add_trace(go.Bar(y=data['title'][::-1], x=data['imdb_rating'][::-1],name='Number of Movies in Months', orientation='h'))\nfig.update_layout(title_text='Movies with Highest IMDB RATING',\n                 xaxis_title=\"Movie Names\",\n                 yaxis_title=\"\u0130mdb Rating\",\n                 plot_bgcolor='white')\nfig.show()","037f873a":"def get_3_elements(column, data):\n    x1 = []\n    x2 = []\n    x3 = []\n\n    length = data.shape[0]\n\n    for i in range(length):\n        current = data.iloc[i][column]\n        cur_len = len(current)\n        if cur_len >= 3:\n            x1.append(current[0])\n            x2.append(current[1])\n            x3.append(current[2])\n        elif cur_len == 2:\n            x1.append(current[0])\n            x2.append(current[1])\n            x3.append(\"\")\n        elif cur_len == 1:\n            x1.append(current[0])\n            x2.append(\"\")\n            x3.append(\"\")\n        else:\n            x1.append(\"\")\n            x2.append(\"\")\n            x3.append(\"\")\n    \n    return x1, x2, x3","755647ca":"genre1, genre2, genre3 = get_3_elements('genres', df)\ndf['genre1'] = genre1\ndf['genre2'] = genre2\ndf['genre3'] = genre3\ndf[['genres', 'genre1', 'genre2', 'genre3']].head()","a8796f39":"actor1,actor2, actor3 = get_3_elements('cast', df)\ndf['actor1'] = actor1\ndf['actor2'] = actor2\ndf['actor3'] = actor3\ndf[['title', 'cast', 'actor1', 'actor2', 'actor3']].head()","9feaee63":"directors = df.groupby('Director')['imdb_rating'].agg(['min', 'max', 'mean', 'count']).reset_index()\nselected_directors = directors[directors['count'] > 3].sort_values(by=\"mean\", ascending=False).head(20).Director.values\nselected_directors","061dc6b7":"fig = px.box(df, x=\"genre1\", y=\"imdb_rating\")\nfig.show()","d684ded6":"selected = df[df['Director'].isin(selected_directors)]\nfig = px.box(selected, x=\"Director\", y=\"imdb_rating\", title=\"IMDB RATINGS OF DIRECTORS\")\nfig.show()","dfbdc518":"def get_recommend_by_genre_and_language(genre, language=\"en\"):\n    sub_data = df[(df['original_language'] == language) & (df['genre1'] == genre)& (df['vote_count'] > 250)]\n    return sub_data.sort_values(by=\"imdb_rating\",ascending=False)[['title', 'genres', 'vote_count', 'imdb_rating', 'original_language']].head(10)","48c7d3b0":"get_recommend_by_genre_and_language('Drama', 'en')","fdf10689":"recommend_columns = ['id', 'title', 'actor1', 'actor2', 'actor3', 'Director', 'genre1', 'genre2', 'genre3', 'imdb_rating']\nmovies_filter = df[recommend_columns]\n\n\ndef recommend_similar(movie):\n    director_movie = movies_filter['Director'][movies_filter['id'] == movie].values[0]\n    actor1_movie = movies_filter['actor1'][movies_filter['id'] == movie].values[0]\n    actor2_movie = movies_filter['actor2'][movies_filter['id'] == movie].values[0]\n    actor3_movie = movies_filter['actor3'][movies_filter['id'] == movie].values[0]\n    genre1_movie = movies_filter['genre1'][movies_filter['id'] == movie].values[0]\n    genre2_movie = movies_filter['genre2'][movies_filter['id'] == movie].values[0]\n    genre3_movie = movies_filter['genre3'][movies_filter['id'] == movie].values[0]\n\n\n    \n    temp = movies_filter.copy()\n    \n    \n    temp['same_director'] = np.nan\n    temp['same_ac1'] = np.nan\n    temp['same_ac2'] = np.nan\n    temp['same_ac3'] = np.nan\n    temp['same_g1'] = np.nan\n    temp['same_g2'] = np.nan\n    temp['same_g3'] = np.nan\n    \n    \n    temp['same_director'] = (temp['Director'] ==  director_movie)\n    temp['same_ac1'] = (temp['actor1'] ==  actor1_movie) | (temp['actor2'] ==  actor1_movie) | (temp['actor3'] ==  actor1_movie)\n    temp['same_ac2'] = (temp['actor1'] ==  actor2_movie) | (temp['actor2'] ==  actor2_movie) | (temp['actor3'] ==  actor2_movie)\n    temp['same_ac3'] = (temp['actor1'] ==  actor3_movie) | (temp['actor2'] ==  actor3_movie) | (temp['actor3'] ==  actor3_movie)\n    temp['same_g1'] = (temp['genre1'] ==  genre1_movie) | (temp['genre2'] ==  genre1_movie) | (temp['genre3'] ==  genre1_movie)\n    temp['same_g2'] = (temp['genre1'] ==  genre2_movie) | (temp['genre2'] ==  genre2_movie)  | (temp['genre3'] ==  genre2_movie)\n    temp['same_g3'] = (temp['genre1'] ==  genre3_movie) | (temp['genre2'] ==  genre3_movie) | (temp['genre3'] ==  genre3_movie)\n    \n    temp['similar_count'] = temp['same_director'].astype(int) + temp['same_ac1'].astype(int) + temp['same_ac2'].astype(int) + temp['same_ac3'].astype(int) + temp['same_g1'].astype(int) + temp['same_g2'].astype(int) + temp['same_g3'].astype(int)\n    \n    result = temp.sort_values(by=[\"similar_count\", 'imdb_rating'], ascending=False)[['id', 'title', 'similar_count', 'actor1', 'actor2', 'actor3','Director', 'genre1', 'genre2', 'genre3', 'imdb_rating']].head(10)\n    \n    return result\n\n    ","b5c62a37":"id_of_movie = df[df['title'] == \"Eternal Sunshine of the Spotless Mind\"]['id'].values[0]\na = recommend_similar(id_of_movie)\na","87ca8a56":"id_of_movie = df[df['title'] == \"Titanic\"]['id'].values[0]\na = recommend_similar(id_of_movie)\na","b9e107e7":"df[['title', 'overview']].head(5)","a2ab5a78":"from sklearn.feature_extraction.text import TfidfVectorizer\n\ndf['overview'] = df['overview'].fillna('')\n\nvectorizer = TfidfVectorizer(stop_words=\"english\")\n\n\ntf_idf_mat = vectorizer.fit_transform(df['overview'])\n\nprint(\"Shape is {}\".format(tf_idf_mat.shape))","62389b69":"from sklearn.metrics.pairwise import linear_kernel\n\ncosine_sim = linear_kernel(tf_idf_mat, tf_idf_mat)","e76224f6":"cosine_sim[1].mean()","81d00b08":"titles = pd.Series(df.index, index=df['title']).drop_duplicates()\ntitles","3d38b998":"def get_recommendations(movie_title, cosine_similarity = cosine_sim):\n    index_movie = titles[movie_title]\n    \n    similarities = cosine_similarity[index_movie]\n    \n    similarity_scores = list(enumerate(similarities))\n    \n    similarity_scores = sorted(similarity_scores , key=lambda x: x[1], reverse = True)\n    \n    similarity_scores = similarity_scores[1:11]\n    \n    similar_indexes = [x[0] for x in similarity_scores]\n    \n    print(\"\u0130f you liked {}, I can recommend you these movies based on the overview\\n\\n\".format(movie_title))\n    \n    return df['title'].iloc[similar_indexes]\n    \n","4f9fb860":"get_recommendations('The Dark Knight')","a563d230":"keyword1, keyword2, keyword3 = get_3_elements('keywords', df)\n\ndf['keyword1'] = keyword1\ndf['keyword2'] = keyword2\ndf['keyword3'] = keyword3\n\ndf[['title', 'keyword1', 'keyword2', 'keyword3']].head(5)","c91ddc84":"df2 = df.copy()\n\ndf2['total'] = \"\"\ncolumns_to_be_added = ['keyword1', 'keyword2', 'keyword3', 'actor1', 'actor2', 'actor3', 'genre1', 'genre2', 'genre3', 'Director']\n\nfor c in columns_to_be_added:\n    df2['total'] += (df2[c].str.lower() + \" \")\n\ndf2['total']","90fcd358":"vectorizer2 = TfidfVectorizer(stop_words=\"english\")\n\nX2 = vectorizer2.fit_transform(df2['total'])\n\nprint(\"Shape is {}\".format(X2.shape))","eff6d83c":"cosine_sim2 = linear_kernel(X2, X2)\ncosine_sim2.shape","7b3237f3":"get_recommendations('The Dark Knight', cosine_sim2)","f86875cc":"get_recommendations('The Godfather', cosine_sim2)","346bfad7":"### IMDB RATING OF EVERY GENRES","6d469843":"## Let's see the the statistics in Most Profitable Movies","52cf2342":"**MOVIES WITH HIGHEST VOTE AVERAGE AND HAVE MORE THAN 250 VOTE**","7425a62a":"One Common thing in the movies with high profit, they are mostly adventure and Science Fiction movies and their budget is also high. Let's see the movies with most profit rate.","afab7353":"Mostly films are in english. It is quite usual.","7b78d4bc":"### RECOMMENDATION BASED ON CAST, DIRECTOR AND CONTENT\n\nIn this recommendation, we will recommend movies based on their 3 genre type, their top 3 actors, and director of the movie. Movies with higher similarites will be recommended. ","549e6b8d":"## IMDB FORMULA RATING","df61c8c3":"**This notebook is inspired by [Erik Bruin's Notebook](https:\/\/www.kaggle.com\/erikbruin\/movie-recommendation-systems-for-tmdb\/report)**\n\n**This notebook is inspired by [Ibtesam Ahmed's Notebook](https:\/\/www.kaggle.com\/ibtesama\/getting-started-with-a-movie-recommendation-system)**\n","fb24507e":"Some of the famous actors such as Robert De Niro, Samuel el Jackson, Matt Damon are the ones with highest movie count.","3a3a78ab":"### RECOMMENDATION BASED ON OVERVIEW CONTENT","fd0b7f67":"We can change the weights of each component of similarity. For example, we can change the first genre's weight to 2 or we can add more components such as keywords, or the year of the movie.","0da68a83":"### MOVIES WITH HIGHEST PROFIT","c2beab5a":"this function returns the top 10 used feature in the column.","58dd186e":"Let's see some recommendations for *Eternal Sunshine of the Spotless Mind*","09bd05e3":"Let's see some recommendations for *Titanic*","f5b3108f":"The peak is in 2012 with **24.14 Billion Dollars**. Let's see the reason","6004d82e":"### DATA BUDGET, REVENUE AND PROFIT IN YEARS","f7f9858b":"**Getting some date information **","79e374c3":"As we can see **genres, keywords, production_companies, production_countries, spoken_languages** are in JSON FORMAT. Let's parse them.","f351f4f2":"**Create the profit column to see profit of each movie**","1ff61cfb":"It can be seen that movies with highest profit are mostly adventure action movies.","c916ed0c":"### DIRECTORS WITH MORE THAN 3 MOVIES AND HIGHEST IMDB RATINGS","0f4619a6":"## DATA EXPLORATION","09a0a76c":"Mostly drama, comedy and thriller movies are made.","ab84a1c2":"Mostly movies are made in United States which is quite normal.","8cf48be4":"Stan Lee (R.I.P) is the guy who played most in the movies with highest profits which is quite normal. Because the Marvel movies has a great profit and Stan Lee plays a part in every movie, which is a interesting statistics.","0a521fe6":"Let's see the relationship between budget and revenue","3ec10623":"The Movies with high profits came in 2012 apperantly. Let's see the movies in 2014.","eba5596c":"Most of the movies are released in Friday which is normal because Friday is the beginning of the Weekend","0369a12a":"## RECOMMENDATIONS","6599b47c":"Skew in the data is","06a0ada6":"As budget increases, mostly revenue increases.","2185938a":"### RECOMMENDATION BASED ON GENRE AND LANGUAGE\n\nIn this recommendation kind, we will recommend movies based on the selected genre and language. After that we will sort the movies by their *Imdb Rating* that we calculated in the upper part. Also we select the movies which has more than 250 vote counts."}}