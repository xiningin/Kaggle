{"cell_type":{"49a48bbf":"code","b04851e1":"code","38580f43":"code","77a0b179":"code","2e29d56e":"code","94a59cac":"code","ca7cd794":"code","4cc8fefe":"code","f6676943":"code","6295b185":"code","43010f06":"code","8b96ad7b":"code","96152aae":"code","baf54332":"code","7836b840":"code","a754e1cf":"code","1fdcf20f":"code","0bcbf1f8":"code","a9408ed9":"code","b3c4b402":"code","78a97e3d":"markdown"},"source":{"49a48bbf":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt \nfrom fastai.tabular import *\nfrom fastai.callbacks import ReduceLROnPlateauCallback,EarlyStoppingCallback\nfrom imblearn.over_sampling import SMOTE\nfrom sklearn.metrics import roc_auc_score\nimport os\nprint(os.listdir(\"..\/input\"))","b04851e1":"class roc(Callback):\n    \n    def on_epoch_begin(self, **kwargs):\n        self.total = 0\n        self.batch_count = 0\n    \n    def on_batch_end(self, last_output, last_target, **kwargs):\n        preds = F.softmax(last_output, dim=1)\n        roc_score = roc_auc_score(to_np(last_target), to_np(preds[:,1]))\n        self.total += roc_score\n        self.batch_count += 1\n    \n    def on_epoch_end(self, num_batch, **kwargs):\n        self.metric = self.total\/self.batch_count","38580f43":"train = pd.read_csv(\"..\/input\/train.csv\").drop('ID_code',axis=1)\ntest = pd.read_csv(\"..\/input\/test.csv\")","77a0b179":"dep_var = 'target'\ncont_names = train.iloc[:,1:].columns.tolist()","2e29d56e":"sns.set(style=\"darkgrid\")\nax =  sns.countplot(x=\"target\", data=train)","94a59cac":"procs = [Normalize]","ca7cd794":"test = TabularList.from_df(test,cont_names=cont_names)","4cc8fefe":"data = (TabularList.from_df(train,cont_names=cont_names, procs=procs)\n                           .random_split_by_pct(0.25)\n                           .label_from_df(cols=dep_var)\n                           .add_test(test)\n                           .databunch(bs=128))","f6676943":"learn = tabular_learner(data, \n                        layers=[200,100], \n                        metrics=[accuracy,roc()]\n                       )","6295b185":"learn.lr_find()","43010f06":"learn.recorder.plot()","8b96ad7b":"ES = EarlyStoppingCallback(learn, monitor='roc',patience = 5)\nRLR = ReduceLROnPlateauCallback(learn, monitor='roc',patience = 2)","96152aae":"learn.fit(1, .01, callbacks = [ES,RLR])","baf54332":"preds,_ = learn.get_preds(DatasetType.Test)","7836b840":"preds = preds.tolist()","a754e1cf":"preds_nn = []\nfor i in range(len(preds)):\n    preds_nn.append(preds[i][0])","1fdcf20f":"subby = pd.read_csv(\"..\/input\/test.csv\")\nsubby['target'] = preds_nn\n","0bcbf1f8":"subby = subby[['ID_code','target']]","a9408ed9":"subby.to_csv('subby.csv',index=False)","b3c4b402":"subby.head()","78a97e3d":"## Load Data"}}