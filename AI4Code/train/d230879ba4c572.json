{"cell_type":{"fd8b9c88":"code","01ffd335":"code","ec42bc63":"code","34f213c5":"code","7675ce14":"code","15dda6b9":"code","c47e1ceb":"code","88b13c9d":"code","45ee7fae":"code","36f429c7":"code","cc192516":"code","adad7ca8":"code","bc993be6":"code","c409d255":"code","d55fa050":"code","f0f85bc9":"code","9e633db6":"code","fa679ae2":"code","ab103caf":"code","4746654a":"code","dab892a8":"code","4418026a":"code","3b2e36cd":"code","a7c4beca":"code","6c64eb4e":"code","66225edf":"code","aed957b1":"code","4aa1505f":"code","96541596":"code","b607ba9d":"code","650581ab":"code","4c9fd499":"code","d6457b99":"code","10e95533":"code","3e66cd22":"code","fd67b231":"code","4d9acf28":"code","1cb0ec26":"code","bb53e861":"code","9eb897f0":"code","7cdb8115":"code","dd523a62":"code","8afb195c":"code","18f7ded5":"code","38e89498":"code","a763fd83":"code","10711278":"code","0f1431e0":"code","61f04b1b":"markdown","79978622":"markdown","12642d11":"markdown","1cd557d5":"markdown","c76fdf84":"markdown","6bcf9e87":"markdown","4efb6245":"markdown","cea269d3":"markdown","47baa6b2":"markdown","314d7387":"markdown","6ad15f71":"markdown","48f09ec4":"markdown","66afcd8e":"markdown","4f323674":"markdown","7eeed6d4":"markdown","c0351248":"markdown","bbd0a162":"markdown","4f9e93c0":"markdown","db22e42a":"markdown","9bd5858f":"markdown"},"source":{"fd8b9c88":"#Loading data\nimport pandas as pd\ntransaction_data_aug_2018=pd.read_csv('..\/input\/RFM201808.csv')\ntransaction_data_sep_2018=pd.read_csv('..\/input\/RFM201809.csv')\ntransaction_data_oct_2018=pd.read_csv('..\/input\/RFM201810.csv')\ntransaction_data=pd.concat([transaction_data_aug_2018,transaction_data_sep_2018,transaction_data_oct_2018],ignore_index=True)\ntransaction_data.head()","01ffd335":"#checking data types of the columns\ntransaction_data.info()","ec42bc63":"#checking shape of the dataset\ntransaction_data.shape","34f213c5":"#checking duplicate\ntransaction_data.duplicated().value_counts()","7675ce14":"#checking for missing values\ntransaction_data.isnull().sum()","15dda6b9":"# Summary Statistics of numeric feature\ntransaction_data.describe()","c47e1ceb":"#checking return invoice\nreturn_invoice_number=transaction_data.query('Amount<0')['Amount'].count()\nprint(\"Return Invoice No: %d\"%return_invoice_number)","88b13c9d":"#plotting distribution of Invoice Amount\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()\nplt.figure(figsize=(12,5))\nsns.boxplot(transaction_data['Amount'],orient='v')\nplt.title('Distribution of Invoice Amount')\nplt.show()","45ee7fae":"#plotting distribution of Invoice Amount\nplt.figure(figsize=(12,5))\nsns.distplot(transaction_data['Amount'])\nplt.title('Distribution of Invoice Amount')\nplt.show()","36f429c7":"#removing outliers by z-score method\n\nimport numpy as np\ntransaction_data=transaction_data[np.abs(transaction_data.Amount-transaction_data.Amount.mean()) <= (3*transaction_data.Amount.std())]","cc192516":"#plotting distribution of Amount after outliers removal\nplt.figure(figsize=(12,5))\nsns.boxplot(transaction_data['Amount'],orient='v')\nplt.title('Distribution of Invoice Amount after outliers removing')\nplt.show()","adad7ca8":"#plotting distribution of Invoice Amount after outliers removal\nplt.figure(figsize=(12,5))\nsns.distplot(transaction_data['Amount'],color='red')\nplt.title('Distribution of Invoice Amount after outliers detection')\nplt.show()","bc993be6":"#converting to invoiceDate to date time type\ntransaction_data['InvoiceDate']=transaction_data['InvoiceDate'].apply(pd.to_datetime)","c409d255":"#Building recency feature\nimport datetime\nreference_date = transaction_data.InvoiceDate.max()\nreference_date = reference_date + datetime.timedelta(days = 1)\ntransaction_data['days_since_last_purchase'] = reference_date - transaction_data.InvoiceDate\ntransaction_data['days_since_last_purchase_num'] = transaction_data['days_since_last_purchase'].astype('timedelta64[D]')","d55fa050":"transaction_data.head()","f0f85bc9":"customer_history_df = transaction_data.groupby(\"CustomerCode\").min().reset_index()[['CustomerCode', 'days_since_last_purchase_num']]\ncustomer_history_df.rename(columns={'days_since_last_purchase_num':'recency'}, inplace=True)\ncustomer_history_df.head()","9e633db6":"#building frequency and monetary feaures\ncustomer_monetary_val = transaction_data[['CustomerCode', 'Amount']].groupby(\"CustomerCode\").sum().reset_index()\ncustomer_history_df = customer_history_df.merge(customer_monetary_val, how='outer')\ncustomer_history_df.Amount = customer_history_df.Amount+0.001\ncustomer_freq = transaction_data[['CustomerCode', 'Amount']].groupby(\"CustomerCode\").count().reset_index()\ncustomer_freq.rename(columns={'Amount':'frequency'},inplace=True)\ncustomer_history_df = customer_history_df.merge(customer_freq, how='outer')\ncustomer_history_df.head()","fa679ae2":"#plotting recncy Distribution\nplt.figure(figsize=(12,5))\nsns.distplot(customer_history_df['recency'])\nplt.title('Recency Distrubtion')\nplt.show()","ab103caf":"#plotting recncy Distribution\nplt.figure(figsize=(12,5))\nsns.boxplot(customer_history_df['recency'],orient='v')\nplt.title('Recency Distrubtion')\nplt.show()","4746654a":"#plotting Amount Distribution\nplt.figure(figsize=(12,5))\nsns.distplot(customer_history_df['Amount'])\nplt.title('Distrubtion Of Monetary Value')\nplt.show()","dab892a8":"#plotting Amount Distribution\nplt.figure(figsize=(12,5))\nsns.boxplot(customer_history_df['Amount'],orient='v')\nplt.title('Distrubtion Of Monetary Value')\nplt.show()","4418026a":"#plotting frequency Distribution\nplt.figure(figsize=(12,5))\nsns.distplot(customer_history_df['frequency'])\nplt.title('Distrubtion Of Frequency Value')\nplt.show()","3b2e36cd":"#plotting Amount Distribution\nplt.figure(figsize=(12,5))\nsns.boxplot(customer_history_df['frequency'],orient='v')\nplt.title('Distrubtion Of Frequency')\nplt.show()","a7c4beca":"#removing outliers \ncustomer_history_df=customer_history_df[np.abs(customer_history_df.Amount-customer_history_df.Amount.mean()) <= (3*customer_history_df.Amount.std())]\ncustomer_history_df=customer_history_df[np.abs(customer_history_df.frequency-customer_history_df.frequency.mean()) <= (3*customer_history_df.frequency.std())]","6c64eb4e":"#plotting Amount Distribution after outliers removal\nplt.figure(figsize=(12,5))\nsns.boxplot(customer_history_df['Amount'],orient='v')\nplt.title('Distrubtion Of Monetary Value after outliers removal')\nplt.show()","66225edf":"#plotting frequency Distribution\nplt.figure(figsize=(12,5))\nsns.boxplot(customer_history_df['frequency'],orient='v')\nplt.title('Distrubtion Of Frequency after outliers removal')\nplt.show()","aed957b1":"#taking log of RFM Feature\ncustomer_history_df['recency_log'] = customer_history_df['recency'].apply(np.log)\ncustomer_history_df['frequency_log'] = customer_history_df['frequency'].apply(np.log)\ncustomer_history_df['amount_log'] = customer_history_df['Amount'].apply(np.log)","4aa1505f":"#3d scatter plot of recency, frequency, monetary value\nfrom mpl_toolkits.mplot3d import Axes3D\n\nfig = plt.figure(figsize=(10, 10))\nax = fig.add_subplot(111, projection='3d')\n\nxs =customer_history_df.recency_log\nys = customer_history_df.frequency_log\nzs = customer_history_df.amount_log\nax.scatter(xs, ys, zs, s=15)\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.title('3d scatter plot of recency, frequency, monetary value')\nplt.show()","96541596":"#checking for null values\ncustomer_history_df.isnull().sum()","b607ba9d":"#removing null\ncustomer_history_df=customer_history_df.dropna()","650581ab":"#summary statidtics\ncustomer_history_df.describe()","4c9fd499":"#selecting feature\nfeature=['recency_log','frequency_log','amount_log']\nX=customer_history_df[feature].values","d6457b99":"#scaling the feature\nfrom sklearn.preprocessing import MinMaxScaler\nscaler=MinMaxScaler()\nscaler.fit(X)\nX=scaler.transform(X)","10e95533":"#checking feature array\nX","3e66cd22":"#elbow method to select optimum cluster number\nfrom sklearn.cluster import KMeans\ndistortions = []\nfor i in range(1, 11):\n  km = KMeans(n_clusters=i,init='k-means++',n_init=10,max_iter=300,random_state=0)\n  km.fit(X)\n  distortions.append(km.inertia_)\nplt.plot(range(1,11), distortions, marker='o')\nplt.xlabel('Number of clusters')\nplt.ylabel('Distortion')\nplt.show()","fd67b231":"#KMeans Clustering\nfrom sklearn.cluster import KMeans\nclustering=KMeans(n_clusters=7,init='k-means++',n_init=10,max_iter=1000,random_state=0).fit(X)\nprint(\"Clusters:\",np.unique(clustering.labels_))\ns=pd.Series(clustering.labels_)\nprint(s.value_counts())\nprint(len(s))","4d9acf28":"#Assigning Cluster Label\ncustomer_history_df['Cluster_Label']=clustering.labels_","1cb0ec26":"#Difference in recency among clusters\nplt.figure(figsize=(12,7))\nsns.boxplot(x='Cluster_Label',y='recency',data=customer_history_df)\nplt.title('Difference in recency among clusters')\nplt.show()","bb53e861":"#Difference in monetary value among clusters\nplt.figure(figsize=(12,7))\nsns.boxplot(x='Cluster_Label',y='Amount',data=customer_history_df)\nplt.title('Difference in monetary value among clusters')\nplt.show()","9eb897f0":"#Difference in frequency among clusters\nplt.figure(figsize=(12,7))\nsns.boxplot(x='Cluster_Label',y='frequency',data=customer_history_df)\nplt.title('Difference in frequency among clusters')\nplt.show()","7cdb8115":"import matplotlib.pyplot as plt\nfrom mpl_toolkits.mplot3d import Axes3D,axes3d\n\n\nfigure=plt.figure(figsize=(12,7))\nax=Axes3D(figure,elev=30,azim=150)\n\nfigure.set_size_inches(10,10)\nfor i,colors in zip(range(0,7),['green','blue','red','cyan','magenta','yellow','black']):\n        ax.scatter(customer_history_df.loc[:,['recency_log']][customer_history_df.Cluster_Label==i], customer_history_df.loc[:,['frequency']][customer_history_df.Cluster_Label==i], customer_history_df.loc[:,['amount_log']][customer_history_df.Cluster_Label==i], s=5,color=colors)\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.legend(map(lambda x:str(x),range(0,7)))\nplt.title('3d scatter plot of recency, frequency, monetary value of clusters')\n\nplt.show()","dd523a62":"#Cluster 0\nfigure=plt.figure()\nax=Axes3D(figure,elev=20,azim=160)\n\nfigure.set_size_inches(10,10)\n\nax.scatter(customer_history_df.loc[:,['recency']][customer_history_df.Cluster_Label==0], customer_history_df.loc[:,['frequency']][customer_history_df.Cluster_Label==0], customer_history_df.loc[:,['Amount']][customer_history_df.Cluster_Label==0], s=10,color='green',marker='^')\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.title(\"Cluster0\")\nplt.show()","8afb195c":"#Cluster 1\nfigure=plt.figure()\nax=Axes3D(figure,elev=20,azim=160)\n\nfigure.set_size_inches(10,10)\n\nax.scatter(customer_history_df.loc[:,['recency']][customer_history_df.Cluster_Label==1], customer_history_df.loc[:,['frequency']][customer_history_df.Cluster_Label==1], customer_history_df.loc[:,['Amount']][customer_history_df.Cluster_Label==1], s=10,color='green',marker='^')\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.title(\"Cluster1\")\nplt.show()","18f7ded5":"#Cluster 2\nfigure=plt.figure()\nax=Axes3D(figure,elev=20,azim=160)\n\nfigure.set_size_inches(10,10)\n\nax.scatter(customer_history_df.loc[:,['recency']][customer_history_df.Cluster_Label==2], customer_history_df.loc[:,['frequency']][customer_history_df.Cluster_Label==2], customer_history_df.loc[:,['Amount']][customer_history_df.Cluster_Label==2], s=10,color='green',marker='^')\n\n\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.title(\"Cluster2\")\nplt.show()","38e89498":"#Cluster 3\nfigure=plt.figure()\nax=Axes3D(figure,elev=10,azim=160)\n\nfigure.set_size_inches(10,10)\n\nax.scatter(customer_history_df.loc[:,['recency']][customer_history_df.Cluster_Label==3], customer_history_df.loc[:,['frequency']][customer_history_df.Cluster_Label==3], customer_history_df.loc[:,['Amount']][customer_history_df.Cluster_Label==3], s=10,color='green',marker='^')\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.title(\"Cluster3\")\nplt.show()","a763fd83":"#cluster 4\nfigure=plt.figure()\nax=Axes3D(figure,elev=10,azim=160)\n\nfigure.set_size_inches(10,10)\n\nax.scatter(customer_history_df.loc[:,['recency']][customer_history_df.Cluster_Label==4], customer_history_df.loc[:,['frequency']][customer_history_df.Cluster_Label==4], customer_history_df.loc[:,['Amount']][customer_history_df.Cluster_Label==4], s=10,color='green',marker='^')\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.title(\"Cluster4\")\nplt.show()","10711278":"#cluster 5\nfigure=plt.figure()\nax=Axes3D(figure,elev=10,azim=160)\n\nfigure.set_size_inches(10,10)\n\nax.scatter(customer_history_df.loc[:,['recency']][customer_history_df.Cluster_Label==5], customer_history_df.loc[:,['frequency']][customer_history_df.Cluster_Label==5], customer_history_df.loc[:,['Amount']][customer_history_df.Cluster_Label==5], s=10,color='green',marker='^')\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.title(\"Cluster5\")\nplt.show()","0f1431e0":"#cluster six\nfigure=plt.figure()\nax=Axes3D(figure,elev=10,azim=160)\n\nfigure.set_size_inches(10,10)\n\nax.scatter(customer_history_df.loc[:,['recency']][customer_history_df.Cluster_Label==6], customer_history_df.loc[:,['frequency']][customer_history_df.Cluster_Label==6], customer_history_df.loc[:,['Amount']][customer_history_df.Cluster_Label==6], s=10,color='green',marker='^')\n\nax.set_xlabel('Recency')\nax.set_ylabel('Frequency')\nax.set_zlabel('Monetary')\nplt.title(\"Cluster6\")","61f04b1b":"## Individual Cluster Behavior Analysis","79978622":"## From the Distribution of Customer Monetary Value and frequency value we can see that we have lots of outliers value in both monetary and frequency","12642d11":"### From the 3d scatter plot of RFM of Cluster 1 we can see that less recency , good monetary value and frequency range from 2-4 . this customers shopped 2-4 times in last three month. This is new emerging customer","1cd557d5":"# RFM (Recency, Frequency, Monetary) Analysis And Customer Clustering\nRFM (Recency, Frequency, Monetary) analysis is a proven marketing model for behavior based customer segmentation. It groups customers based on their transaction history \u2013 how recently, how often and how much did they buy.\n\nRFM helps divide customers into various categories or clusters to identify customers who are more likely to respond to promotions and also for future personalization services.\n\n## In this Notebook: <br>\n**1.Statistical Analysis And Exploitarory Data Analysis Of Retail Transaction  Data <br>\n2.RFM Features are built from Retail Transaction Data <br>\n3.Statistical Analysis Of RFM Feature <br>\n4.Customer Clustering Based on RFM Feature <br>\n5.Cluster Behavior Analysis and Identifying loyal, churned, emerging customer **","c76fdf84":"# 5.Cluster Behavior Analysis and Identifying loyal, churned, emerging customer","6bcf9e87":"## From the distribution of Invoice amount after outliers removal , we can see that invoice amount follows a skewed normal distribution (Dense in centre) with some outliers. ","4efb6245":"## 4.Customer Clustering Based On RFM Feaure","cea269d3":" ### From the 3d scatter plot of RFM of Cluster 6 we can see that recency value is high and monetary value and frequency value are good. so this is  and churned customer cluster (Once used to shop regularly)","47baa6b2":"## Data Preprocessing","314d7387":"# Conclusion\nFinding optimum number of cluster and pure cluster in unsupervised learning is difficult for large volume of data. Overlapping between cluster is common scenario in unsupervised learning. This clustering does not ensure pure cluster. ","6ad15f71":"# Dataset Description\n ** One of the largest retail chain in Bangladesh named Shwapno, I used here  August, September and October  2018 data  ** <br>\n ** Dataset fileds are InvoiceNo, CustomerCode, InvoiceDate, Amount** ","48f09ec4":"# 1.Data Collection And Statistical Analysis","66afcd8e":"### From the 3d scatter plot of RFM of Cluster 0 we can see that frequency is 1 and recency value is greater than 50 days . This customer only shopped once 50 days ago . So this cluster is walking customer cluster  ","4f323674":"### From the summary Statistics Of Amount we can see that we have return invoice (negative values of amount)","7eeed6d4":"## 3.RFM Features Analysis","c0351248":"### From the 3d scatter plot of RFM of Cluster 2 we can see that frequency is good, less recency, good monetary value. this cluster is the loyal customers cluster","bbd0a162":"## 2.RFM(Recency, Frequency, Monetary Value) Feature Building","4f9e93c0":" ### From the 3d scatter plot of RFM of Cluster 4 we can see that recency value is high and monetary value and frequency value are quite good. so this is  churning customer cluster (Shopped for 2 to 4 times then stopped shopping)","db22e42a":"### From the Distribution of Amount  We can see that we have some  outliers Invoices. Outliers Invoices are not our concerned for modeling and we will remove outliers value from dataset.","9bd5858f":"### From the 3d scatter plot of RFM of Cluster 3 we can see that frequency value is 1 and recency value is less than 30 . These customer shopped only once in last month so this is new customer cluster"}}