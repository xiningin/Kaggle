{"cell_type":{"faa712a0":"code","fc91edff":"code","85ab6aa9":"code","78d1e150":"code","3d9c9e09":"code","3bdb28b2":"code","0ac0d883":"code","baf5001c":"code","24ae1f5c":"code","c2cdfb71":"code","45c10a4a":"code","d631317f":"code","6b50f47c":"code","0d41059d":"code","436987af":"code","e65f5f14":"code","5d42e5bd":"code","679927f9":"code","c1b6c418":"code","d0a19e4b":"code","e29ceb3f":"code","9664a0c5":"code","3be0f0c9":"code","61e3ad61":"code","dcc7fbc2":"code","6fa02608":"code","55d48ce9":"code","77b8dc65":"code","ad31d293":"code","dd2fcb2a":"code","9c9e134f":"code","acd2b395":"code","1ba57442":"code","3024959b":"code","00671c2c":"code","7c9da608":"code","9131d497":"code","2918b022":"code","71b28cb1":"code","ca568418":"code","624a40e2":"code","2341880f":"code","197ff952":"code","33dbe04b":"code","32e29784":"code","b758b02d":"code","8a265eca":"code","caee91cd":"code","f5887469":"code","cde560c0":"code","cdb4e986":"code","0ce3b1f4":"code","10239135":"code","0226ec6f":"code","c75bde83":"code","f7f04015":"code","024467e8":"code","6c36d270":"code","fa01df5a":"code","0e3dde1f":"code","57538e51":"code","82f8fc88":"code","41122213":"code","0b4c2ce5":"code","a029079f":"markdown","c2d55869":"markdown","2e8d4bd8":"markdown","0a456b04":"markdown","709aa604":"markdown","67e8e02f":"markdown","82e736ce":"markdown","779723ae":"markdown","728a0d4f":"markdown","8c798dff":"markdown","68207810":"markdown","3bab3558":"markdown","bb22e692":"markdown","e0d94b21":"markdown","839b5598":"markdown","1f01b0f3":"markdown","c4e59791":"markdown","af89b9a6":"markdown","66604f2b":"markdown","17351152":"markdown","161af745":"markdown","bb4e5136":"markdown","36e85a82":"markdown","7a2e9879":"markdown","fe02e5da":"markdown","cd16fac7":"markdown","3ac6b7a2":"markdown","4db66023":"markdown","155a9f47":"markdown","bab1e621":"markdown","84de837c":"markdown","c1641f6b":"markdown","d4579bd1":"markdown","26d6ac54":"markdown","b069ebf0":"markdown","9caca3fc":"markdown","f9c0b0fc":"markdown","9281ab75":"markdown","7da3a2b1":"markdown","000b69b8":"markdown","d5136a05":"markdown","f2aa78c3":"markdown"},"source":{"faa712a0":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.metrics import classification_report,roc_auc_score,roc_curve,confusion_matrix,accuracy_score\nfrom sklearn.model_selection import GridSearchCV","fc91edff":"df = pd.read_csv('..\/input\/heart-failure-prediction\/heart.csv')","85ab6aa9":"df.head()","78d1e150":"df.info()","3d9c9e09":"df.describe()","3bdb28b2":"cols = [i for i in df.columns if i!='HeartDisease' and df[i].dtypes!='O' and i!='FastingBS']","0ac0d883":"for i in cols: #Before treating outliers..\n    sns.boxplot(df[i])\n    plt.show()","baf5001c":"Q1 = df.quantile(0.25)\nQ3 = df.quantile(0.75)\nIQR = Q3-Q1\nlower = Q1 - 1.5 * IQR\nupper = Q3 + 1.5 * IQR\nnewdf = df[~((df[cols] < (lower)) |(df[cols] > (upper))).any(axis=1)]","24ae1f5c":"print(f'Before treating outliers {df.shape} || After treating outliers {newdf.shape}')","c2cdfb71":"for i in cols: #After treating outliers..\n    sns.boxplot(newdf[i])\n    plt.show()","45c10a4a":"#Much better, Now lets deep dive into each feature and get some insights about that..\n","d631317f":"HD = newdf[newdf['HeartDisease'] == 1] #Only rows where people had Heart Disease","6b50f47c":"plt.figure(figsize=(20,10))\nplt.xticks(rotation = 90)\nsns.countplot(newdf.Age)\nplt.show()","0d41059d":"plt.figure(figsize=(20,10))\nplt.xticks(rotation = 90)\nsns.countplot(HD.Age)\nplt.show()","436987af":"plt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nsns.countplot(newdf.Sex,hue = newdf.HeartDisease)\nplt.show()","e65f5f14":"plt.figure(figsize=(10,5)) #Ratio where Males and Females had Heart Disease\nplt.xticks(rotation = 90)\nsns.countplot(HD.Sex,palette='dark')\nplt.show()","5d42e5bd":"plt.figure(figsize=(10,5)) \nplt.xticks(rotation = 90)\nplt.title('Overall Chest Pain Type Count')\nsns.countplot(newdf.ChestPainType,palette='Oranges')\nplt.show()","679927f9":"plt.figure(figsize=(10,5)) \nplt.xticks(rotation = 90)\nplt.title('Chest Pain Type Count (Heart Disease)')\nsns.countplot(HD.ChestPainType,palette='Oranges')\nplt.show()","c1b6c418":"df.head()","d0a19e4b":"plt.figure(figsize=(10,5)) \nplt.xticks(rotation = 90)\nplt.title('Overall Resting BP Count')\nsns.countplot(newdf.RestingBP,palette='RdPu')\nplt.show()","e29ceb3f":"plt.figure(figsize=(10,5)) \nplt.xticks(rotation = 90)\nplt.title('Resting BP Count (Heart Disease)')\nsns.countplot(HD.RestingBP,palette='RdPu')\nplt.show()","9664a0c5":"newdf.RestingBP.corr(newdf.HeartDisease)","3be0f0c9":"#As predicted , Slight positive correlation","61e3ad61":"plt.figure(figsize=(50,20)) \nplt.xticks(rotation = 90)\nplt.title('Overall Cholesterol Count')\nsns.countplot(newdf.Cholesterol,palette='YlOrRd_r')\nplt.show()\n\n#Double tap on the diagram to get the zoomed view","dcc7fbc2":"plt.figure(figsize=(50,20)) \nplt.xticks(rotation = 90)\nplt.title('Cholesterol Count (Heart Disease)')\nsns.countplot(HD.Cholesterol,palette='YlOrRd_r')\nplt.show()\n\n#Double tap on the diagram to get the zoomed view","6fa02608":"newdf.Cholesterol.corr(newdf.HeartDisease) #ALmost no correlation","55d48ce9":"newdf.FastingBS.unique()","77b8dc65":"newdf.FastingBS.corr(newdf.HeartDisease)","ad31d293":"newdf.FastingBS.value_counts()","dd2fcb2a":"plt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('FastingBS Count')\nplt.text(0.7,590,'0 --> Fasting BS < 120mg\/dl',fontsize=10)\nplt.text(0.7,550,'1--> Fasting BS >120mg\/dl',fontsize=10)\nsns.countplot(newdf.FastingBS,palette='rainbow_r')\nplt.show()\n","9c9e134f":"#Lets check wrt people had Heart Disease\n\nplt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('FastingBS Count (Heart Disease)')\nplt.text(0.7,240,'0 --> Fasting BS < 120mg\/dl',fontsize=10)\nplt.text(0.7,220,'1--> Fasting BS >120mg\/dl',fontsize=10)\nsns.countplot(HD.FastingBS,palette='rainbow_r')\nplt.show()\n","acd2b395":"newdf.RestingBP.value_counts()[:5]","1ba57442":"plt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('Resting ECG Count')\nsns.countplot(newdf.RestingECG,palette='coolwarm_r')\nplt.show()\n\n\"Normal: Normal ST: having ST-T wave abnormality (T wave inversions and\/or ST elevation or depression of > 0.05 mV), LVH: showing probable or definite left ventricular hypertrophy by Estes' criteria\"","3024959b":"#Lets see the impact of Resting ECG onto Heart Disease\n\nplt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('Resting ECG Count (Heart Diesease)')\nsns.countplot(HD.RestingECG,palette='coolwarm_r')\nplt.show()\n","00671c2c":"df.MaxHR.value_counts()[:5]","7c9da608":"plt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('Max Heart Rate Count')\nsns.distplot(newdf.MaxHR)\nplt.show()","9131d497":"\nplt.figure(figsize=(20,10))\nplt.xticks(rotation = 90)\nplt.title('Max Heart Rate Count')\nsns.countplot(newdf.MaxHR,hue = newdf.HeartDisease,palette='nipy_spectral_r')\nplt.show()","2918b022":"#Impact on Heart Disease\n\nplt.figure(figsize=(20,10))\nplt.xticks(rotation = 90)\nplt.title('Max Heart Rate Count ( Heart Disease)')\nsns.countplot(HD.MaxHR,palette='nipy_spectral_r')\nplt.show()","71b28cb1":"newdf.ExerciseAngina.value_counts()","ca568418":"\nplt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('Overall Exercise Angina Count')\nsns.countplot(newdf.ExerciseAngina,palette='gnuplot')\nplt.show()","624a40e2":"#Impact on Heart Disease\nplt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('Exercise Angina Count ( Heart Disease )')\nsns.countplot(HD.ExerciseAngina,palette='gnuplot')\nplt.show()","2341880f":"\nplt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('Overall Old Peak Count based on Heart Disease')\nsns.countplot(newdf.Oldpeak,hue = newdf.HeartDisease,palette='rocket_r')\nplt.show()","197ff952":"sns.catplot(x = 'Oldpeak',y = 'Age',kind='swarm',data = newdf,hue = 'HeartDisease',aspect=3)\n","33dbe04b":"newdf.Oldpeak.corr(newdf.HeartDisease) #Correlation to confirm the linear relationship","32e29784":"plt.figure(figsize=(10,5))\nplt.xticks(rotation = 90)\nplt.title('Overall ST Slope Count based on Heart Disease')\nsns.countplot(newdf.ST_Slope,hue = newdf.HeartDisease,palette='pastel')\nplt.show()","b758b02d":"sns.catplot(x = 'ST_Slope',y = 'Age',kind='swarm',data = newdf,hue = 'HeartDisease',aspect=3)\n","8a265eca":"newdf.head()","caee91cd":"#Checking Unique No. of values in each Categorical Feature (Concerning Dimensions)\n\ncatcols = [i for i in newdf.columns if newdf[i].dtypes=='O' and i!='Sex' and i!='ExerciseAngina']\nfor i in catcols:\n    print(f'Total Unique Enteries in {i} = {newdf[i].nunique()}')","f5887469":"#LabelEncoding Sex & ExerciseAngina\n\n# Import label encoder\nfrom sklearn.preprocessing import LabelEncoder\nlabel_encoder = LabelEncoder()\nle = ['Sex','ExerciseAngina']\nfor i in le:\n    df[i] = label_encoder.fit_transform(df[i] )","cde560c0":"#We can directly go for One-Hot Encoding because Categorical features does not contains lot of unique enteries\n\nfinaldf = pd.get_dummies(newdf,drop_first=False)","cdb4e986":"finaldf.head()","0ce3b1f4":"finaldf.isna().sum()","10239135":"plt.figure(figsize=(15,10))\nsns.heatmap(finaldf.corr(),annot=True,cmap='coolwarm')","0226ec6f":"y = finaldf.HeartDisease\nx = finaldf.drop('HeartDisease',axis=1)","c75bde83":"xtrain,xtest,ytrain,ytest = train_test_split(x,y,test_size=0.2,random_state=42)","f7f04015":"#Lets define every model with multiple parameters for the selection of best model with best parameters.\nmodel_params = {\n    'svm':{\n        'model': SVC(),\n        'params':{\n            'C' : [1,2,3],\n            'kernel' : ['linear', 'poly', 'rbf', 'sigmoid']\n        }\n    },\n    'logistic':{\n        'model':LogisticRegression(),\n        'params':{\n            'penalty' : ['l1', 'l2', 'elasticnet'],\n            'solver' : ['newton-cg', 'lbfgs', 'liblinear', 'sag', 'saga']\n            \n        }\n    },\n    'RF':{\n        'model':RandomForestClassifier(n_jobs = -1),\n        'params':{\n            'n_estimators':[10,50,100,150],\n            'criterion' : [\"gini\", \"entropy\"]\n            \n        }\n    },\n    'DT':{\n        'model':DecisionTreeClassifier(),\n        'params':{\n            'criterion' : [\"gini\", \"entropy\"],\n            'splitter':[\"best\", \"random\"]\n        }\n    }\n}","024467e8":"scores = [] #List for all the best scores\nfor model_name, modelp in model_params.items():\n    clf = GridSearchCV(modelp['model'],modelp['params'],cv = 5,return_train_score=False)\n    clf.fit(x,y)\n    scores.append({\n        'model': model_name,\n        'best_score': clf.best_score_,\n        'best_params': clf.best_params_\n    })\nscoreddf = pd.DataFrame(scores,columns=['model','best_score','best_params'])\nscoreddf","6c36d270":"#From the above results, We can see that RandomForest and SVM outperformed other classifiers.\n#I'll be using RandomForest for this use case..\n\nmodel = RandomForestClassifier(n_estimators=100,criterion='entropy',n_jobs=-1)\nmodel.fit(xtrain,ytrain)","fa01df5a":"ypred = model.predict(xtest)","0e3dde1f":"print(f'Models Score = {round(accuracy_score(ytest,ypred)*100,2)}%')","57538e51":"matrix = confusion_matrix(ytest,ypred) ","82f8fc88":"sns.heatmap(matrix,cmap = 'coolwarm',annot=True)","41122213":"falsep,truep,thresholds = roc_curve(ytest,ypred)\nauc = roc_auc_score(ytest,ypred)\nns_probs = [0 for _ in range(len(ytest))]\nns_fpr, ns_tpr, _ = roc_curve(ytest, ns_probs)\nplt.xlim([0,1])\nplt.ylim([0,1])\nplt.text(0.7,0.95,f\"AUC = {round(auc,2)}\")\nplt.title('ROC_AUC Curve')\nplt.plot(ns_fpr, ns_tpr, linestyle='--', label='No Skilled Model')\nplt.plot(falsep,truep,linestyle=':',label = \"RF\")\nplt.legend()\nplt.xlabel(\"False Positive Rate\")\nplt.ylabel(\"True Positive Rate\")\nplt.show()","0b4c2ce5":"print(classification_report(ytest, ypred))","a029079f":"***People with More likely to get Heart Disease had Max Heart Rate's : 140,150,130,125,120***\n\n***slight negatively linearly related to Target Feature***","c2d55869":"## EDA","2e8d4bd8":"## --SEX--","0a456b04":"**Lets check for outliers**","709aa604":"### --CHEST PAIN TYPE-- ","67e8e02f":"## Feature Engineering","82e736ce":"***There's a slight linear relationship between Age and ST_Slope as well***\n\n***Flat ST_Slope led towards higher chance of getting Heart Disease then Down ST_Slope followed by Up ST_Slope***","779723ae":"## Conclusion","728a0d4f":"***Max Occuring Heart Rate's were - 150,140,130,160***\n\n***From the above graph we can note that people with low heart rate are more likely to get heart disease than the one's with high heart rate***","8c798dff":"**Converting Categorical Features to Numeric Type**","68207810":"**Males were more likely to have Heart Disease rather than Females**","3bab3558":"## -- ST Slope --","bb22e692":"***From the above graphs, We can see that Resting BP is not linearly related to Heart Disease***\n\n***Most occuring values for Overall RestingBP were 120,130,140,150..***\n\n***Most impacting values for RestingBP were people had Heart Disease are : 140 , 130 ,120 respectively***\n\n***There were randomness in RestingBP, It might not be highly impacting feature for Heart Disease , Lets check the correlation***","e0d94b21":"## -- Age --","839b5598":"***Most of the people had Fasting Blood Sugar smaller than 120mg\/dl***","1f01b0f3":"**Confusion Matrix**","c4e59791":"***ASY Type Chest Pain was the most occuring ChestPain, Lets see if this type of Chest Pain provoked the Heart Disease the most?***","af89b9a6":"### --Resting BP--","66604f2b":"**From the above heatmap following are the insights:**\n    \n***1) There are some positively correlated features which have significant impact onto Heart Disease, Those are (ST_Slope Flat, ChestPainType ASY, ExerciseAngina, Sex_M,OldPeak and Age)..Which also means if these features increase their are higher chances of getting Heart Disease***\n\n***2) There are features which are negatively correlated with the Heart Disease, Which means having those conditions into the person would decrease the chance of getting affected by Heart Disease.. Thode Conditions are ST_Slope UP, ChestPainType NAP, ChestPainType ATA, Exercise Angina No, Sex Female, MaxHR*** \n\n","17351152":"***Females were safer as compared to Male's, From the above graph we can see the ratio of Males and Females related to Heart Disease***","161af745":"## --Cholesterol--","bb4e5136":"# --Old Peak--","36e85a82":"***Its not necessary people dealing with Heart Disease can't have Normal Resting ECG***\n\n***Most frequent people with Heart Disease had Normal ECG***\n\n","7a2e9879":"***As we can see from the above graphs, There are outliers present in some of the features***\n\n**We can treat the outliers based on IQR, and cap the outliers on the basis of lower visker and upper visker.**","fe02e5da":"***As guessed from the overall count, People with having ASY Type chest pain were more likely to have heart disease as compared to other kind of chest pains***\n\n***ASY surpassed every type of chest pain in terms of overall people with chest pain count or Impacting onto Heart Disease***","cd16fac7":"***1) Age is not linearly related to HeartDisease, Which means it not like if the person is getting older and older will be more likely to be affected by Heart Diesase***\n\n***2) Most of the affected people were from age group between 52 to 62***\n\n***3) People of age 58 had Heart Disease the most***","3ac6b7a2":"**Lets create a Classification Report for the overall model performance check**","4db66023":"## --Resting ECG--","155a9f47":"**No null values**","bab1e621":"## --Exercise Angina--","84de837c":"## --Max Heart Rate-- ","c1641f6b":"***From the above graph we can say:***\n    \n***1) Most of the people having heart disease had Old Peak recored as 0 becausse 0 was the most occuring value but if we will look at the graph we can predict that having Old Peak higher is becoming more sensitive to have Heart Disease***\n\n***2) Most of the people having heart disease had old peak of 0,1,1.5,2,3***\n\n***3) There's a significant linear relationship between OldPeak and HeartDisease***\n\n\n    ","d4579bd1":"***People who had Cholesterol level of (282,216,254) was more likely to had Heart Disease***\n\n***Not linearly correlated with Target Feature, Which also means higher the Cholesterol doesn't mean the probability of having Heart disease will increase***","26d6ac54":"## --Fasting BS--","b069ebf0":"-->> Most of the people were of age = 54, Most frequently occuring Age was around (51 - 62)\n\n***Lets check the most occuring age for the people having HeartDisease***","9caca3fc":"### Insights about Age Feature","f9c0b0fc":"***From the above graph we can see there's a quite good linear realtionship between OldPeak and HeartDisease***\n\n***As the OldPeak increases there are very high chance that the person is more likely to have a HeartDisease***\n\n***There's a kind of linear relationship between Age and OldPeak as well, Higher Age and Old peak greater chances of Heart Disease***","9281ab75":" ***ROC AUC SCORE AND CURVE***","7da3a2b1":"## Model Building","000b69b8":"***Overall most of the people didn't had Exercise Angina Condition, But after observing the above plot we can clearly say that people having heart disease, Most of them had Exercise Angina condition***","d5136a05":"**If this notebook helped you in anyway.. Please Consider Upvoting.. Thank you!**","f2aa78c3":"***Same we can observe from the above graph, People having Heart Disease didn't had Fasting BS > 120mg\/dl***\n\n***Its not necessary that people with high Fasting BS will be more likely to have a Heart Disease, From the above graph people with low Fasting BS were more oftenly having Heart Disease***"}}