{"cell_type":{"15627eda":"code","8c441109":"code","d23f63c6":"code","98cb4cd1":"code","df39fe74":"code","8d7fc232":"code","3c2df1f8":"code","5d81d34e":"code","bafabb72":"code","49103a3f":"code","bdf5c3d6":"code","96e34d73":"code","7edc9397":"code","78e48499":"code","7d482e65":"markdown","fde53ad2":"markdown","929c7f16":"markdown","45f417e6":"markdown","06b08b9d":"markdown","b15bf768":"markdown","3d6298e3":"markdown","fc36f921":"markdown","f8bbee2d":"markdown","42ff5b17":"markdown","aef8651e":"markdown","0acfe10b":"markdown"},"source":{"15627eda":"#make sure we have latest build\n! [ -e \/content ] && pip install -Uqq fastai ","8c441109":"from fastai.basics import *\nfrom fastai.callback.all import *\nfrom fastai.vision.all import *\nfrom fastai.medical.imaging import *\n\nimport pydicom,kornia,skimage\nfrom pydicom.dataset import Dataset as DcmDataset\nfrom pydicom.tag import BaseTag as DcmTag\nfrom pydicom.multival import MultiValue as DcmMultiValue\nfrom PIL import Image\n\ntry:\n    import cv2\n    cv2.setNumThreads(0)\nexcept: pass","d23f63c6":"path = Path('..\/input\/vinbigdata-chest-xray-abnormalities-detection')\ntrain_imgs = path\/'train'","98cb4cd1":"fname = train_imgs\/'000434271f63a053c4128a0ba6352c7f.dicom'\ndcm = fname.dcmread()\ndcm.show(scale=False)","df39fe74":"items = get_dicom_files(train_imgs)","8d7fc232":"train,val = RandomSplitter()(items)","3c2df1f8":"patient = 3\nxray_sample = items[patient].dcmread()","5d81d34e":"xray_sample","bafabb72":"xray_sample.PixelData[:200]","49103a3f":"xray_sample.pixel_array, xray_sample.pixel_array.shape","bdf5c3d6":"xray_sample.show()","96e34d73":"%%time \n# takes 7-8 minutes, so load from pickle\ndicom_dataframe = pd.DataFrame.from_dicoms(items, window=dicom_windows.lungs, px_summ=False)\n\ndicom_dataframe.to_pickle('.\/dicom_dataframe_pickle.pkl')\ndicom_dataframe.shape","7edc9397":"dicom_dataframe = pd.read_pickle('.\/dicom_dataframe_pickle.pkl')\ndicom_dataframe.shape # should be 15k by 29","78e48499":"dicom_dataframe.head()","7d482e65":"There is a lot of information here and the good news is there is an excellent resource to learn more about these:\n\nhttp:\/\/dicom.nema.org\/medical\/dicom\/current\/output\/chtml\/part03\/sect_C.7.6.3.html#sect_C.7.6.3.1.4\n\nOne row you will notice is pixel data as an array. We can view this, although in its raw for, isn't very useful. ","fde53ad2":"**Getting Started with Dicom using fastai**\n\nI haven't spent a lot of time using fastai with dicom files and since I'm entering this competition I wanted to use my fastai knowledge to learn more about the dataset and to generally understand everything better with a starter notebook.\n\nThis will be one of a few notebooks. I'll link here to the bounding box version soon after, but first wanted to get a look at the data and follow the [fastai medical imaging tutorial](https:\/\/docs.fast.ai\/tutorial.medical_imaging.html). ","929c7f16":"Because of the complexity in interpreting PixelData, pydicom provides an easy way to get it in a convenient form: pixel_array which returns a numpy.ndarray containing the pixel data:","45f417e6":"We can view the image again.","06b08b9d":"Import what we will need. Take special note of the fastai.medical. That will give us some great tools to work with dicom files, etc. ","b15bf768":"Now we can view the header meta data within the dicom file. ","3d6298e3":"Set up our images to get dicom files and read them.","fc36f921":"Remember all the meta data? \nThat data can be pulled into a dataframe.\n\nThanks to [Ben](https:\/\/www.kaggle.com\/beezus666\/chest-x-ray-with-fastai) for finding a solution with the dataframe hanging!","f8bbee2d":"Set our paths for files and for our training dicom set. ","42ff5b17":"We can now split the set for or training and validation sets","aef8651e":"Pydicom is a python package for parsing DICOM files, making it easier to access the header of the DICOM as well as coverting the raw pixel_data into pythonic structures for easier manipulation. fastai.medical.imaging uses pydicom.dcmread to load the DICOM file.\n\nTo plot an X-ray, we can select an entry in the items list and load the DICOM file with dcmread.","0acfe10b":"A quick look to make sure we are on track before we get too far. "}}