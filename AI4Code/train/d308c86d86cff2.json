{"cell_type":{"475a84ac":"code","c6e10ac7":"code","2317a197":"code","bfca2bb3":"code","eb547e9d":"code","91ed1883":"code","334c95fe":"code","cc06c85d":"code","4bbdfa07":"code","9d606424":"code","70ecc21c":"code","a4444691":"code","61eec39f":"code","84a96a7f":"code","db30f6a3":"code","4446822d":"code","9da47950":"code","7c65caa6":"code","b7b53373":"code","e648f3f6":"code","740fbc11":"code","69427c02":"code","49efe0c7":"code","f4ca7e0b":"code","e44b3a04":"code","83082f34":"code","f6929c18":"code","e8583bb9":"code","2851467f":"code","b7200c23":"code","3a73212a":"code","791fe71d":"code","eea32363":"code","1eb5d9b1":"code","7c33939d":"code","7acb87af":"code","3aa172d6":"code","bc1d094b":"code","262fafc3":"code","14b32d94":"code","b8f5504e":"code","83724dc7":"code","4c668652":"code","2e7a5132":"code","101cb40a":"code","57f4a101":"code","61b22643":"code","340f58f7":"code","20ee03eb":"code","710fe689":"code","7c442d62":"code","36f8ead7":"code","3b92a5e9":"code","67891e8d":"code","5108f24e":"code","8073754d":"code","b1b9d80f":"code","d06220c6":"code","e24a4c8e":"code","e54f821e":"code","d9624187":"code","bbfb8af2":"code","c4b65f8a":"code","5a694600":"code","e1ec6f43":"code","397ab3e7":"code","88b57e22":"code","198b6460":"code","c9b282b7":"code","07a2a599":"code","6f3f9f29":"code","4e769d8a":"code","be07a360":"code","84b71960":"code","c7574a12":"code","22e33f76":"code","02ff7bb9":"code","0571d1e0":"code","8a012e15":"code","f3b1fc93":"code","85a15853":"code","e0b35796":"code","16ef7f39":"code","e8e15b56":"code","448b6a87":"code","a2cc3810":"code","20a3eba8":"markdown","fd8edfaf":"markdown","500cc2e1":"markdown","8928a051":"markdown","0626d985":"markdown","fee98d3a":"markdown","74b0cfa6":"markdown","9dc8f6f1":"markdown","3524bb21":"markdown","491b0181":"markdown","277a6ae1":"markdown","10c42ed4":"markdown","c8009469":"markdown","fe5cdc9d":"markdown","30166adb":"markdown","b42755ac":"markdown","704c6285":"markdown","da966494":"markdown","71a4038c":"markdown","3f820e23":"markdown","1218ff02":"markdown","e109394f":"markdown","935dd03a":"markdown","d0758113":"markdown","f5626a42":"markdown","f39f978d":"markdown","c6783b46":"markdown","c985266d":"markdown","df6128df":"markdown","59942f94":"markdown","b2d6782f":"markdown","03f914e8":"markdown","b9207b90":"markdown","83447007":"markdown","2cf7bf4b":"markdown","22d11752":"markdown","d7eb624b":"markdown","53999a3d":"markdown","4b42b8db":"markdown","ab012153":"markdown"},"source":{"475a84ac":"import pandas as pd\nimport numpy as np \nfrom pandas import Series,DataFrame\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n% matplotlib inline","c6e10ac7":"titanic_df = pd.read_csv('..\/input\/train.csv')\ntest_df = pd.read_csv('..\/input\/test.csv')\n\n# making a list of both files\n\ncombined_df = [titanic_df,test_df]\ncombined_Data = pd.concat(combined_df,axis=0,sort=True)\ntitanic_df.head()","2317a197":"print('Traning Data -->',titanic_df.shape)\nprint('-'*58)\nprint('Testing Data  -->',test_df.shape)\n","bfca2bb3":"titanic_df.info()","eb547e9d":"titanic_df.describe()","91ed1883":"titanic_df.describe(include=['O'])","334c95fe":"titanic_df['Sex'].value_counts()","cc06c85d":"plt.figure(figsize=(8,7))\nsns.countplot(data=titanic_df,x='Sex')","4bbdfa07":"plt.figure(figsize=(9,7))\nplt.style.use('seaborn')\nsns.countplot(data=titanic_df,x='Sex',hue='Survived')","9d606424":"titanic_df['Survived'].groupby(titanic_df['Sex']).mean() *100","70ecc21c":"survived = titanic_df['Survived'].groupby(titanic_df['Sex']).value_counts().unstack()","a4444691":"survived","61eec39f":"# check for NULL values\n\nsum(titanic_df['Pclass'].isnull())","84a96a7f":"titanic_df['Pclass'].value_counts()","db30f6a3":"plt.figure(figsize=(8,6))\nplt.style.use('seaborn')\nsns.countplot(data=titanic_df,x='Pclass')","4446822d":"# Standard excel pivot style\ntitanic_df['Sex'].groupby(titanic_df['Pclass']).value_counts().unstack()","9da47950":"# let's Visualize  \nplt.style.use('seaborn')\nplt.figure(figsize=(8,7))\nsns.countplot(data=titanic_df,x='Pclass',hue='Sex')","7c65caa6":"(titanic_df['Sex'].groupby(titanic_df['Pclass']).value_counts().unstack()['male']\/titanic_df['Pclass'].value_counts()[3]) *100","b7b53373":"(titanic_df['Sex'].groupby(titanic_df['Pclass']).value_counts().unstack()['female']\/titanic_df['Pclass'].value_counts()[3]) *100","e648f3f6":"titanic_df['Age'].describe()","740fbc11":"# number of NULL values in age \n\nsum(titanic_df['Age'].isnull()) ","69427c02":"# number of Null values in test file\n\nsum(test_df['Age'].isnull())","49efe0c7":"# new borns\n\ntitanic_df[titanic_df['Age']<1]","f4ca7e0b":"len(titanic_df[titanic_df['Age']<=16])","e44b3a04":"# Distribution of age in each Pclass \n\nplt.figure(figsize=(100,80))\ng = sns.FacetGrid(data=titanic_df,hue='Pclass',aspect=4)\ng.map(sns.kdeplot,'Age',shade=True)\n\nplt.style.use('seaborn')\ng.add_legend()","83082f34":"# Let's check out the head of dataframe and see to which columns is more relateable to the those the age\n\ntitanic_df.head()","f6929c18":"sum(titanic_df['Name'].isnull())","e8583bb9":"for df in combined_df:\n    df['Title'] = df['Name'].str.extract(r' ([A-Za-z]+)\\.',expand=True)","2851467f":"# check if every thing works fine\ntitanic_df['Title'].head()","b7200c23":"titanic_df['Title'].value_counts()","3a73212a":"plt.figure(figsize=(16,8))\nplt.style.use('seaborn')\nsns.countplot(data=titanic_df,x='Title')","791fe71d":"title_map = {'Mr':1,\n             'Miss':2,\n             'Mrs' :3,\n             'Master':4,\n             \"Dr\": 4, \"Rev\": 4, \"Col\": 4, \"Major\": 4, \"Mlle\": 4,\"Countess\": 4, \"Ms\": 4, \n            \"Lady\": 4, \"Jonkheer\": 4,\"Don\": 4, \"Dona\" : 4, \"Mme\": 4,\"Capt\": 4,\"Sir\": 4\n             \n            }","eea32363":"for df in combined_df:\n    df['Title'] = df['Title'].map(title_map)","1eb5d9b1":"titanic_df[['Title','Age']].groupby('Title').mean()","7c33939d":"def compute_age(dataframe):\n    Age = dataframe['Age']\n    Title = dataframe['Title']\n    \n    if pd.isnull(Age):\n        if Title == 1:\n            return titanic_df['Age'][titanic_df['Title']==1].mean()\n        if Title == 2:\n            return titanic_df['Age'][titanic_df['Title']==2].mean()\n        if Title == 3:\n            return titanic_df['Age'][titanic_df['Title']==3].mean()\n        if Title == 4:\n            return titanic_df['Age'][titanic_df['Title']==4].mean()\n        \n    else:\n        return Age\n    \n    ","7acb87af":"for df in combined_df:\n    df['Age'] = df[['Age','Title']].apply(compute_age,axis=1)\n","3aa172d6":"# now check for null in age column\n\nsum(titanic_df['Age'].isnull()),sum(test_df['Age'].isnull())\n","bc1d094b":"g=sns.FacetGrid(data=titanic_df,aspect=5)\nplt.style.use('seaborn')\ng.map(sns.kdeplot,'Age',shade=True)","262fafc3":"def age_group(age):\n    if age <=16:\n        return 1\n    if (age > 16) & (age <=26):\n        return 2\n    if (age > 26) & (age <=36):\n        return 3 \n    if (age > 36) & (age <=46):\n        return 4\n    if (age > 46) & (age <=56):\n        return 5\n    if age > 56:\n        return 6\n      ","14b32d94":"for df in combined_df:\n    df['Age_group'] = df['Age'].apply(age_group)\n","b8f5504e":"titanic_df['Age_group'].value_counts()","83724dc7":"plt.figure(figsize=(10,8))\nplt.style.use('seaborn')\nsns.countplot(data=titanic_df,x='Age_group',hue='Survived')","4c668652":"survived_num = titanic_df[titanic_df['Survived']==1]['Age_group'].value_counts()\ndead_num = titanic_df[titanic_df['Survived']==0]['Age_group'].value_counts()\n\nsurvived_num,dead_num","2e7a5132":"plt.style.use('seaborn')\nstacked_df = pd.DataFrame([survived_num,dead_num])\n\nstacked_df.index = ['Survived','Dead']\nstacked_df.columns = ['0-16','17-26','27-36','37-46','47-56','57+']\n\nstacked_df.plot(kind='bar',stacked=True,figsize=(10,6))\n\nplt.legend(bbox_to_anchor=(1, 1), loc=2, borderaxespad=1)\n","101cb40a":"titanic_df.head()","57f4a101":"titanic_df.isna().sum()","61b22643":"sns.heatmap(titanic_df.isnull(),yticklabels=False,cbar=False,cmap='viridis')","340f58f7":"fig,ax = plt.subplots(1,2)\n\nplt.title('Null values in Traning and Test Data')\n\nsns.heatmap(titanic_df.isnull(),yticklabels=False,cbar=False,cmap='viridis',ax=ax[0])\nsns.heatmap(test_df.isnull(),yticklabels=False,cbar=False,cmap='viridis',ax=ax[1])","20ee03eb":"print('Traning Data -->',titanic_df.shape)\nprint('-'*58)\nprint('Testing Data  -->',test_df.shape)","710fe689":"# to check the Null Values and the describe Fare in each traning and tests dataset\n\nfor df in combined_df:\n    print(sum(df['Fare'].isna()))\n    print('--'*25)\n    print(df['Fare'].describe())","7c442d62":"test_df[test_df['Fare'].isna()]","36f8ead7":"# Calculate the mean and replace this v\n# Combined_Data is just the concacated datatframe of the traninng and test \n\ntest_df['Fare']  = test_df['Fare'].fillna(combined_Data['Fare'][combined_Data['Pclass'] == 3].mean())","3b92a5e9":"test_df[test_df['Fare'].isna()]  # this should be empty","67891e8d":"sum(titanic_df['Fare'].isnull())   # Null Vlaues in Fare ","5108f24e":"# test_df.loc[test_df['Fare']<17,'Fare']\n\n# use this if you want to change the fare in its place\n# we i want to keep the oroginal price column and create a new Fare_group column\n# just like the i did above with Age\n\n# for df in combined_df: \n#     df['Fare_Class'] = df.loc[df['Fare'] <10 ,'Fare'] == 1\n#     df['Fare_Class'] = df.loc[ (df['Fare'] >= 10)  & (df['Fare'] < 30) ,'Fare'] == 2\n#     df['Fare_Class'] = df.loc[ (df['Fare'] >= 30)  & (df['Fare'] < 70) ,'Fare'] == 3\n#     df['Fare_Class'] = df.loc[ (df['Fare'] >= 70)  ,'Fare'] == 4\n\n","8073754d":"def fare_class(Fare):\n    if Fare < 10 :\n        return 1\n    if (Fare >= 10)& (Fare < 30):\n        return 2\n    if (Fare >= 30) & (Fare < 70):\n        return 3\n    if (Fare >= 70):\n        return 4","b1b9d80f":"for df in combined_df:\n    df['Fare_group'] = df['Fare'].apply(fare_class)","d06220c6":"# Checking null values in\n\nfor df in combined_df:\n    print('Number of null Values are ---> ' + str(sum(df['Cabin'].isna())))\n    print('Sample data\\n')\n    print(df['Cabin'].tail())\n    print('--'*25)\n    ","e24a4c8e":"# Sepaarte the Cabin names to Cabin_name column\n\nfor df in combined_df:\n    df['Cabin_Name'] = df['Cabin'].str.extract(r'([A-Za-z])')","e54f821e":"\nfor df in combined_df:\n    print(df['Cabin_Name'].tail())\n    print('--'*25)","d9624187":"\n\nfig,ax = plt.subplots(nrows=1,ncols=2)\n\nsns.countplot(titanic_df['Cabin_Name'].sort_values(ascending=True),ax=ax[0])\nsns.countplot(test_df['Cabin_Name'].sort_values(ascending=True),ax=ax[1])\n\n","bbfb8af2":"cabin_dict = { 'A':1,'B':2,'C':3,'D':4,'E':5,'F':6,'G':7,'T':8}","c4b65f8a":"for df in combined_df:\n    df['Cabin_Number'] = df['Cabin_Name'].map(cabin_dict)","5a694600":"fig,ax = plt.subplots(nrows=1,ncols=2)\n\nsns.countplot(titanic_df['Cabin_Number'].sort_values(ascending=True),ax=ax[0])\nsns.countplot(test_df['Cabin_Number'].sort_values(ascending=True),ax=ax[1])\n\n","e1ec6f43":"titanic_df['Cabin_Name'].unique()","397ab3e7":"for df in combined_df:\n    df.loc[df['Cabin_Number'].isna(),'Cabin_Number'] = 0\n    df.loc[df['Cabin_Number'].isna(),'Cabin_Number'] = 0","88b57e22":"titanic_df.head()","198b6460":"gender_dict = {'male' :1,'female':0}","c9b282b7":"titanic_df['Embarked'].unique()","07a2a599":"titanic_df[titanic_df['Embarked'].isnull()]","6f3f9f29":"titanic_df.groupby([titanic_df['Embarked']]).mean()","4e769d8a":"titanic_df['Embarked'] = titanic_df['Embarked'].fillna('C')","be07a360":"embarked_dict = {'S':1,'C':2,'Q':3}","84b71960":"for df in combined_df:\n    df['Embarked'] = df['Embarked'].map(embarked_dict)\n    df['Sex'] = df['Sex'].map(gender_dict)","c7574a12":"titanic_df.head(2)","22e33f76":"plt.style.use('seaborn')\nfig,ax = plt.subplots(nrows=1,ncols=2)\n\n\ntitanic_df['PassengerId'].groupby(titanic_df['SibSp']).count().plot(kind='bar',ax=ax[0])\ntitanic_df['PassengerId'].groupby(titanic_df['Parch']).count().plot(kind='bar',ax=ax[1])","02ff7bb9":"def isAlone(cols):\n    Parch = cols[0]\n    SibSp = cols[1]\n    \n    if (Parch == 0) & (SibSp == 0):\n        return 1\n    else:\n        return 0\n    ","0571d1e0":"titanic_df['Alone'] = titanic_df[['Parch','SibSp']].apply(isAlone,axis=1)","8a012e15":"X = titanic_df[['Pclass','Age_group','Alone','SibSp','Parch','Fare_group','Age_group','Cabin_Number',\n                   'Sex','Embarked']]\ny = titanic_df['Survived']","f3b1fc93":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.30, random_state=101)","85a15853":"from sklearn.linear_model import LogisticRegression\nlog_model = LogisticRegression()\nlog_model.fit(X_train,y_train)","e0b35796":"log_model_Predict = log_model.predict(X_test)\nfrom sklearn.metrics import classification_report,confusion_matrix\nprint('Confusion Matrix \\n',confusion_matrix(y_test,log_model_Predict))\nprint('\\n')\nprint('Classsification Report \\n',classification_report(y_test,log_model_Predict))","16ef7f39":"from sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.metrics import classification_report,confusion_matrix\nknn = KNeighborsClassifier(n_neighbors=3)         # deafult value is 5\nknn.fit(X_test,y_test)","e8e15b56":"knn_predict = knn.predict(X_test)\nprint('Confusion Matrix \\n',confusion_matrix(y_test,knn_predict))\nprint('\\n')\nprint('Classsification Report \\n',classification_report(y_test,knn_predict))","448b6a87":"error_rate = []\n\nfor k in range(1,40):\n    \n    knn_k = KNeighborsClassifier(n_neighbors=k)\n    knn_k.fit(X_train,y_train)\n    knn_predict_k = knn_k.predict(X_test)\n    \n    error_rate.append(np.mean(y_test != knn_predict_k))\n","a2cc3810":"plt.style.use('seaborn')\nplt.figure(figsize=(10,6))\nplt.plot(range(1,40),error_rate,color='blue',ls='dashed',lw=2,marker='o',markerfacecolor='red')","20a3eba8":"To make stacked countplot","fd8edfaf":"## Working with Alone Feature","500cc2e1":"This really comes in handly to see check the duplicacy \n\n1.There are more Male on the ship.\n\n2.Most of people embarked from the S port and there are 3 unique port.","8928a051":"After checking the model accuracy on a random value for k (or your leave to the deafualt which is K=5) .Now let's check the Error Rate for the different values of k(number of neighbors). Choose the first value where error rate fall.","0626d985":"If you check the description for the data,there are two columns(Sibsp,Parch) which defines the passenger family relations.\n\nI just copy paste the below lines from the description page. \n\n1. **sibsp** column \nSibling = brother, sister, stepbrother, stepsister\nSpouse = husband, wife (mistresses and fianc\u00e9s were ignored)\n\n2.**parch** column\n Parent = mother, father\n Child = daughter, son, stepdaughter, stepson\n Some children travelled only with a nanny, therefore parch=0 for them.","fee98d3a":"I will update the notebook with more models and a summarize table of  their cross validation scores.","74b0cfa6":"In the above KDE plot it's very hard to understand the distribution of ages in each class plus there are NULL values for the \nage column as well.\n\nIt would be great to fill up those null values and divide the age into different age groups and then visualize it to get a better picture.\n","9dc8f6f1":"## Creating New features","3524bb21":"Describe on categorical feature \n\nAs you can see there are few columns missing from the above table","491b0181":"## Working with Fare","277a6ae1":"Let's see who survived","10c42ed4":"So most of the passenger were in Pclass 3. \n\nIf you look at the ratio of male & female in each class.\n\nIt will be intresting to see the percentage of male and female in the Pclass 3 ","c8009469":"Now divide the age into group to get more clear picture and then we will visulize it.\n\nThere are couple of ways to do this but the way i like you do is make a function to create a new column and we use that column later for visualization. ","fe5cdc9d":"Linear Regression would now work here as we want our predicted variable to be classified into the 2 groups (survived or not)\n\nSo, now let's jump on to the Logistics regression\n","30166adb":"We can fill the NULL values of Age column with the help of **Name** column as it also have the salutation along with the name \nof passenger.\n\nFor this to work we need to do few things\n\n1.Check out the data in **Name** column.\n\n2.Look for duplicasy and NULL values.\n\n3.Create a new column and separate the salutation from the actual name.This often known as creating **new features** in data analysis.","b42755ac":"## Working with Age","704c6285":"**Conclusion**\n\n1.Minumum value for the age is 0.4 . Look's like there are newborns.Keep that in mind when working with ages.\n\n2.There is huge variation in the fare column ","da966494":"\n## Logistics Regression","71a4038c":"**Remember there are few NULL values in age column**","3f820e23":"Now check the mean age in each group and with the help of these fill Null vaulue in age column","1218ff02":"So most of most the women survived.\n\nLet's check out the average count of men & women who survived.","e109394f":"Creating a fucntion","935dd03a":"There are Null values in both the file.Later we will figure out how to fill these Null values","d0758113":"Now Replace all Null values from Cabin to 0 which means missing Cabin info.\n\nReplacing Nulll values with a number will help while traning our model.(Let's see)","f5626a42":"So, we have one Null Value in Test dataset. \n\nSince Fare is directly related to the Class to we can repalce the null values from the mean values of Classs","f39f978d":"** Percentage of Male in Pclass**","c6783b46":"## KNN ","c985266d":"## Modeling \n\n","df6128df":"The minimum value for the age is 4 Months.It will be intresting to see how many newborn were there on the ship.\n\nAlso let's a change in the Sex column and <= 16 year as a child","59942f94":"## Linear Regression \n\n","b2d6782f":"Later,we have to deal with Null values in Age & Cabin ","03f914e8":"Wow 70% of Male are in Pclas 3. Let's check out the Female percentage ","b9207b90":"Let's differenciate them on gender basis","83447007":"## Working with Cabin ","2cf7bf4b":"## Who are the passenger ?","22d11752":"## Woking with Embarked","d7eb624b":"We want to discover which passengers survived through the data.\n\nThis notebook contains:\n* Data analysis\n* Feature Engineer at:\n   * Gender, Embarked type, Name, Age ,Fare and Alone\n* Modeling with:\n   * LogisticRegression,KNeighborsClassifier, , DecisionTreeClassifier, RandomForestClassifier\n   * Score and Cross-Validation","53999a3d":"Let's assign a number for the title just like the Sex column","4b42b8db":"## Working with Pclass ","ab012153":"So over 74.2% of women were saved but only 18.89% of men survived. \n\nIt woulbe de intresting to see the number of women & men survived,"}}