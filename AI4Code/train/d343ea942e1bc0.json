{"cell_type":{"154231e0":"code","9251f05a":"code","5e42d29b":"code","d9f9c47e":"code","a7db8203":"code","993dca4d":"code","acff18c5":"code","f3b2581e":"code","9322c000":"code","4a66e91d":"code","31d3c009":"code","f2e581aa":"code","4d7caffa":"code","73aa768f":"code","79f50e8a":"code","9d2baf85":"code","9356b7c2":"code","146cf8d3":"code","6b2fd933":"code","92a6e01e":"code","ad2bd905":"code","d20abefb":"code","4147bab7":"code","ff6f1d45":"code","3c6f2905":"code","bf29129f":"code","21b55ba9":"code","0cb323c4":"code","806ee646":"code","fa9b1559":"code","14e78f61":"code","411d234c":"code","04ae95dd":"code","afd10763":"code","a4641b47":"code","56b7d5f0":"code","78dcae41":"code","690343c6":"code","406f62b7":"code","85991db8":"code","21b83209":"code","4b731116":"code","58682fe2":"code","c21e822f":"code","71806abb":"code","b3251906":"code","803f3184":"code","cbf1d50c":"code","b79a5af8":"code","68d287b0":"code","8593eba7":"code","5ab640b3":"code","12ab98cf":"code","7b36bf66":"code","4a1ce9cb":"code","beb3608a":"code","f7e10870":"code","874d21be":"code","a9501b36":"code","c73687f2":"code","39a67bc4":"code","773e9c20":"code","156c810f":"code","ad2d98b9":"code","e5b0c9aa":"code","7ae0d053":"code","c6947a12":"code","804c5631":"code","90ebf188":"code","bf52faba":"code","3e310fbc":"code","7de0b962":"code","b217ebc4":"code","dfa70f62":"code","fcf42f86":"code","bb731738":"code","f5ed0d89":"code","bec2807c":"code","98631909":"code","1801faa4":"code","ca6b6575":"code","215ebf8a":"code","bcac3d87":"code","27813007":"code","e198943b":"code","17abc723":"code","c557488a":"code","861046b9":"code","1b3df827":"code","868e6067":"code","74c5c059":"code","efea22a1":"code","8e458b66":"code","f04ee777":"code","e7b15d59":"code","59d80507":"code","d3abae75":"code","3a75838a":"code","71720dfd":"code","ddc5237b":"code","d92d4011":"code","4aaf8c6f":"markdown"},"source":{"154231e0":"import pandas as pd\npd.set_option('display.max_columns', None)\npromo=pd.read_csv('..\/input\/promo-abuse-detection-for-payment-apps\/Promo_Abuse_Detection_Dataset.csv')\npromo.head()","9251f05a":"promo.nunique().sort_values(ascending=False)","5e42d29b":"promo['UserId'].value_counts().sort_values(ascending=False)[:1] #abuse detected","d9f9c47e":"promo[promo['UserId']==13341428].head()","a7db8203":"promo.loc[promo['Unnamed: 0'] == 16, \"Target\"] = 0\npromo.loc[promo['Unnamed: 0'] == 17, \"Target\"] = 1\npromo[promo['UserId']==13341428].head()","993dca4d":"promo['Device Id'].value_counts().sort_values(ascending=False)[:1]#abuse detected","acff18c5":"fix=promo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']\nfix.head()","f3b2581e":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","9322c000":"promo.loc[promo['Unnamed: 0'] == 950, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']","4a66e91d":"promo['Ref PC AC Number'].value_counts().sort_values(ascending=False)[:6]#abuse detected","31d3c009":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1298']\nfix.head()","f2e581aa":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","4d7caffa":"promo.loc[promo['Unnamed: 0'] == 656, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1298']","73aa768f":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1299']\nfix.head()","79f50e8a":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","9d2baf85":"promo.loc[promo['Unnamed: 0'] == 666, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1299']","9356b7c2":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1188']\nfix.head()","146cf8d3":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","6b2fd933":"promo.loc[promo['Unnamed: 0'] == 19, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1188']","92a6e01e":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1190']\nfix.head()","ad2bd905":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","d20abefb":"promo.loc[promo['Unnamed: 0'] == 678, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1190']","4147bab7":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1186']\nfix.head()","ff6f1d45":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","3c6f2905":"promo.loc[promo['Unnamed: 0'] == 18, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1186']","bf29129f":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1185']\nfix.head()","21b55ba9":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","0cb323c4":"promo.loc[promo['Unnamed: 0'] == 658, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1185']","806ee646":"promo['Name']=promo['FirstName']+' '+promo['LastName']\npromo.nunique().sort_values(ascending=False)","fa9b1559":"promo=promo.drop(['FirstName','LastName'],axis=1)\npromo.head()","14e78f61":"promo['Name'].value_counts().sort_values(ascending=False)[:6]#abuse detected","411d234c":"fix=promo[promo['Name']=='amit kumar']\nfix.head()","04ae95dd":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","afd10763":"promo.loc[promo['Unnamed: 0'] == 595, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='amit kumar']","a4641b47":"fix=promo[promo['Name']=='akash gupta']\nfix.head()","56b7d5f0":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","78dcae41":"promo.loc[promo['Unnamed: 0'] == 822, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='akash gupta']","690343c6":"fix=promo[promo['Name']=='rohit kumar']\nfix.head()","406f62b7":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","85991db8":"promo.loc[promo['Unnamed: 0'] == 886, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='rohit kumar']","21b83209":"fix=promo[promo['Name']=='raman ralhan']\nfix.head()","4b731116":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","58682fe2":"promo.loc[promo['Unnamed: 0'] == 456, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='raman ralhan']","c21e822f":"fix=promo[promo['Name']=='sunil kumar']\nfix.head()","71806abb":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","b3251906":"promo.loc[promo['Unnamed: 0'] == 490, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='sunil kumar']","803f3184":"round(promo.Name.isnull().sum()*100\/len(promo),2)","cbf1d50c":"promo[['Name']]=promo[['Name']].fillna('Unknown')\nfix=promo[promo['Name']=='Unknown']#abuse detected as posssibility of hacker expected.\nfix.head()","b79a5af8":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)\nlen(i)","68d287b0":"for j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo.head()","8593eba7":"round(promo.Target.isnull().sum()*100\/len(promo),2)","5ab640b3":"promo.Target=promo.Target.fillna(0)\nround(promo.Target.value_counts()*100\/len(promo),2)","12ab98cf":"promo[['Sim_OS','Sim_Info','Sim_User']] = promo['Sim Id'].str.split(':',expand=True)\npromo.head()","7b36bf66":"promo[['Device_OS','Device_Info','Device_User']] = promo['Device Id'].str.split(':',expand=True)\npromo.head()","4a1ce9cb":"promo=promo.drop(['Device Id','Sim Id'],axis=1)\npromo.head()","beb3608a":"promo[['LastLoginTime','PresentLoginTime']].info()","f7e10870":"promo['LastLoginTime']=promo['LastLoginTime'].replace('01-01-1900 00:00','00:00:00')\npromo['LastLoginTime'].unique()","874d21be":"promo[['LastLoginTime_HH','LastLoginTime_MM','LastLoginTime_SS']] = promo['LastLoginTime'].str.split(':',expand=True)\npromo.head()","a9501b36":"promo[['PresentLoginTime_HH','PresentLoginTime_MM','PresentLoginTime_SS']] = promo['PresentLoginTime'].str.split(':',expand=True)\npromo.head()","c73687f2":"promo=promo.drop(['LastLoginTime','PresentLoginTime'],axis=1)\npromo.head()","39a67bc4":"promo[['Meta Data_1','Meta Data_2','Meta Data_3','Meta Data_4']] =promo['Meta Data'].str.split('-',expand=True)\npromo.head()","773e9c20":"promo[['Email_user','Email_Domain']] =promo['Email'].str.split('@',expand=True)\npromo.head()","156c810f":"promo=promo.drop(['Email','Meta Data'],axis=1)\npromo.head()","ad2d98b9":"promo[['Reg Client IP_1','Reg Client IP_2','Reg Client IP_3','Reg Client IP_4']] =promo['Reg Client IP'].str.split('.',expand=True)\npromo.head()","e5b0c9aa":"promo=promo.drop(['Unnamed: 0','Reg Client IP'],axis=1)\npromo.head()","7ae0d053":"promo.nunique().sort_values(ascending=False)","c6947a12":"promo=promo.drop(['ProgramId','ProgramName','Meta Data_1','Meta Data_3','Status','Email_Domain','BadTryCount'],axis=1)\npromo.head()","804c5631":"promo['Reg Referral Code']=promo['Reg Referral Code'].str.strip().str[-3:]\npromo['Reg Referral Code'].head()","90ebf188":"promo['RegisteredOn']=pd.to_datetime(promo['RegisteredOn'])\npromo['Dob']=pd.to_datetime(promo['Dob'])\npromo.head()","bf52faba":"promo.info()","3e310fbc":"promo[['UserId','Mobile','PostalCode']]=promo[['UserId','Mobile','PostalCode']].astype(object)\npromo.info()","7de0b962":"promo.nunique().sort_values(ascending=False)","b217ebc4":"promo.columns","dfa70f62":"promo.info()","fcf42f86":"(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","bb731738":"promo[['Reg Referral Code','Reg Referral Prefix']]=promo[['Reg Referral Code',\n                                                                 'Reg Referral Prefix']].fillna('Unknown')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","f5ed0d89":"promo.Gender.value_counts()","bec2807c":"promo['Gender']=promo['Gender'].fillna('U')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","98631909":"promo.nunique().sort_values(ascending=False)","1801faa4":"promo.Name.value_counts()[:5]","ca6b6575":"!pip install pycaret","215ebf8a":"promo.nunique().sort_values(ascending=False)*100\/len(promo)","bcac3d87":"promo.columns\n","27813007":"promo.info()","e198943b":"promo.nunique().sort_values(ascending=False)","17abc723":"!pip install pandas-profiling","c557488a":"from pandas_profiling import ProfileReport\nProfileReport(promo, title=\"EDA Report\")","861046b9":"data = promo.sample(frac=0.8, random_state=42)\ndata_unseen = promo.drop(data.index)\ndata.reset_index(inplace=True, drop=True)\ndata_unseen.reset_index(inplace=True, drop=True)\nprint('Data for Modeling: ' + str(data.shape))","1b3df827":"print('Unseen Data For Predictions: ' + str(data_unseen.shape))","868e6067":"from pycaret.classification import *\npromo= setup(data =data, session_id=42,\n             target = 'Target',\n                  normalize = True, \n                  transformation = True, \n                  log_experiment = True,\n                  remove_multicollinearity = True, #rop one of the two features that are highly correlated with each other\n                  date_features=['RegisteredOn','Dob'],\n            categorical_features=[ 'Gender', 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code', 'Reg Referral Prefix',\n       'Ref PC AC Number', 'Name', 'Sim_OS', 'Sim_Info', 'Sim_User',\n       'Device_OS', 'Device_Info', 'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS', 'Meta Data_2',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4'],\n            high_cardinality_features =[ 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code',\n       'Ref PC AC Number', 'Name', 'Sim_User',\n        'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4']  ,         \n            train_size = 0.8)","74c5c059":"lr = create_model('lr')","efea22a1":"print(lr)","8e458b66":"tuned_lr = tune_model(lr,optimize = 'MCC')","f04ee777":"plot_model(tuned_lr, plot = 'auc')","e7b15d59":"plot_model(tuned_lr, plot = 'pr')","59d80507":"plot_model(tuned_lr, plot='feature')","d3abae75":"plot_model(tuned_lr, plot = 'confusion_matrix')","3a75838a":"evaluate_model(tuned_lr)","71720dfd":"predict_model(tuned_lr)","ddc5237b":"unseen_predictions = predict_model(tuned_lr, data=data_unseen)\nunseen_predictions.head()","d92d4011":"print(\"Confidence Score :   {}\".format(round(unseen_predictions.Score.mean(),2)))#Confidence Score","4aaf8c6f":"There are few considerations , we are working with.\n- A device can be use once\n- Cashback to same account more than once is an abuse\n- Name with same email ID is an abuse"}}