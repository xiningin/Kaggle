{"cell_type":{"2532596b":"code","0ad17974":"code","00844e20":"code","d46ac7f0":"code","7b57254e":"code","1554e13a":"code","ea5a6e26":"code","a0d88591":"code","e10f5c74":"code","60170034":"code","5e9bed33":"code","1c3ff566":"code","581e10a3":"code","8cd3d88e":"code","33d10306":"code","59aad42f":"code","d4c228e5":"code","3c025540":"markdown","cd2c8d6f":"markdown","f5528570":"markdown","a47fb9b3":"markdown","82a8b82f":"markdown","0e174f24":"markdown","ea7b8813":"markdown","007e5d44":"markdown","535899b0":"markdown","893ccc6d":"markdown","a7d5f195":"markdown","d57decf4":"markdown"},"source":{"2532596b":"import pandas as pd\nfrom fastai.vision.all import *\nimport fastai as fa\nimport os\nfrom fastai import losses","0ad17974":"fa.__version__","00844e20":"path = Path('..\/input\/cassava-leaf-disease-classification')","d46ac7f0":"train_df = pd.read_csv(path\/'train.csv')\ntrain_df","7b57254e":"train_df = train_df[~train_df['image_id'].isin(['1562043567.jpg', '3551135685.jpg', '2252529694.jpg'])]","1554e13a":"def get_x(r):\n    return path\/'train_images'\/r['image_id']\n\ndef get_y(r):\n    return r['label']","ea5a6e26":"def get_data(size=224,bs=128,data_df=train_df):\n    dblock = DataBlock(blocks=(ImageBlock, CategoryBlock),\n                       splitter=RandomSplitter(seed=42),\n                       get_x=get_x, \n                       get_y=get_y,\n                       item_tfms = RandomResizedCrop(460),\n                       batch_tfms = [*aug_transforms(size=size),Normalize.from_stats(*imagenet_stats)]\n                      )\n    return dblock.dataloaders(data_df,bs=bs)","a0d88591":"dls = get_data()\ndls.show_batch()","e10f5c74":"if not os.path.exists('\/root\/.cache\/torch\/hub\/checkpoints\/'):\n        os.makedirs('\/root\/.cache\/torch\/hub\/checkpoints\/')\n!cp '..\/input\/resnet34\/resnet34.pth' '\/root\/.cache\/torch\/hub\/checkpoints\/resnet34-333f7ec4.pth'","60170034":"loss_func = losses.LabelSmoothingCrossEntropy()\ncbs = MixUp","5e9bed33":"learn = cnn_learner(dls, resnet34, loss_func=loss_func, metrics=accuracy, cbs=cbs).to_native_fp16()","1c3ff566":"learn.lr_find()","581e10a3":"learn.fine_tune(50, freeze_epochs=8, cbs=EarlyStoppingCallback(monitor='valid_loss', min_delta=0.003, patience=3))","8cd3d88e":"learn = learn.to_native_fp32()","33d10306":"submission_df = pd.read_csv(path\/'sample_submission.csv')\nlen(submission_df)","59aad42f":"test_data_path = submission_df['image_id'].apply(lambda x: path\/'test_images'\/x)\ntst_dl = learn.dls.test_dl(test_data_path)\npredictions = learn.tta(dl = tst_dl, n=10)\n\nsubmission_df['label'] = np.argmax(predictions[0],axis=1)\nsubmission_df","d4c228e5":"submission_df.to_csv('submission.csv',index=False)","3c025540":"## Moving resnet34 pretrained model to checkpoints ","cd2c8d6f":"## Using LabelSmoothingCE & MixUp Augmentations in training loop","f5528570":"## Data Generators with Augmentations ","a47fb9b3":"## Loading the dataset","82a8b82f":"## Attempting the Cassava Leaf Disease Prediction with FastAI using Resnet34 Model.","0e174f24":"## Remapping the labels for test and Making Predictions","ea7b8813":"## Fine Tuning with EarlyStopping","007e5d44":"## Smart LRFind to predict perfect LR to start","535899b0":"Removing the Mislabeled and Duplicates as per a discussion\n","893ccc6d":"## View of a batch of images ","a7d5f195":"## Preparing Submission","d57decf4":"## Data Labeling "}}