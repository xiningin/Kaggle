{"cell_type":{"48273dfb":"code","1730e17c":"code","96afb516":"code","d0b64c0b":"code","3a57e82b":"code","2317fef1":"code","0f84dae0":"code","066ab742":"code","d19d49ce":"code","0a12ed3c":"code","e668c88e":"code","abdb2070":"code","40b445a8":"code","278a1815":"code","eebd36d4":"code","4de9da3d":"code","ea6edd04":"code","06dc6b0d":"code","7c19909f":"code","b6db1898":"code","eba49567":"markdown","2a43b370":"markdown","7cba45c5":"markdown","abbe3552":"markdown","2030a381":"markdown","5c3dbda1":"markdown","8ac4479a":"markdown","3f06df95":"markdown","a59a5745":"markdown","e2e9e5b3":"markdown"},"source":{"48273dfb":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","1730e17c":"# importing our dependencies \/ Packages\nfrom fastai import *\nfrom fastai.vision import *\nimport pandas as pd\nimport numpy as np","96afb516":"# viewing our data\ndata_folder = Path(\"..\/input\")\ndata_folder.ls()","d0b64c0b":"# Getting the data\ntrain_df = pd.read_csv(\"..\/input\/train.csv\")\ntest_df = pd.read_csv(\"..\/input\/sample_submission.csv\")","3a57e82b":"test_img = ImageList.from_df(test_df, # test data frame\n                             path=data_folder\/'test', \n                             folder='test' \n                            )\n\ntrain_img = (\n    ImageList.from_df(train_df, #train data frame\n                      path=data_folder\/'train', \n                      folder='train')\n        .split_by_rand_pct(0.2) # making 20% of validation dataset\n        .label_from_df() # it labels according to dataframe passed to it\n        .add_test(test_img) # adding test data\n        .transform(get_transforms(flip_vert=True), size=128) # adding transforms\n        .databunch(path='.', bs=64) # create databunch \/\/ path is used internally to store temporary files \/\/ bs = batch size\n        .normalize(imagenet_stats) #  normalise according to pretained model\n       )","2317fef1":"learn = cnn_learner(train_img, #training data\n                    models.resnet34,#model\n                    metrics=[error_rate, accuracy] #error rate\n                   )","0f84dae0":"learn.fit_one_cycle(4) #learning for 4 epochs","066ab742":"learn.save('model-1') # saving the model","d19d49ce":"interp = ClassificationInterpretation.from_learner(learn)","0a12ed3c":"# for plotting top losses\nlosses,idxs = interp.top_losses() \ninterp.plot_top_losses(9,figsize=(15,11))","e668c88e":"# to view confusion matrix of model\ninterp.plot_confusion_matrix()","abdb2070":"learn.unfreeze()","40b445a8":"learn.fit_one_cycle(1)","278a1815":"learn.lr_find()","eebd36d4":"learn.recorder.plot()","4de9da3d":"learn.fit_one_cycle(4, max_lr=slice(1e-05))","ea6edd04":"learn.validate()","06dc6b0d":"preds,_ = learn.get_preds(ds_type=DatasetType.Test)","7c19909f":"test_df.has_cactus = preds.numpy()[:, 0]","b6db1898":"test_df.to_csv('submission.csv', index=False)","eba49567":"# Getting data for Fastai","2a43b370":"# UNFREEZING\nBasically in a pretrained model you are freezing the earlier layers by making the weights unchangeable. This is so it can retain the already learned basic representations. The later layers are not frozen so that they can learn the representations specific to your task","7cba45c5":"## in this competion the train images have been kept in train folder and its labels kept in \/train.csv file. \n\n### further in \/sample_submission.csv contains sample submissions","abbe3552":"We use the lr_find method to find the optimum learning rate. Learning Rate is an important hyper-parameter to look for.","2030a381":"### Finding Learning Rate","5c3dbda1":"## Let's create imagelist in this example.\n#### First create test_img which contains list of images in ImageList\n#### then train_img containing training images in ImageList","8ac4479a":"## Now we have found out in unfreeze model we have found out we got greater accuracy than freeze one, otherwise we have used the freeze one model for analysis","3f06df95":"# Interpretaion\nLets understand our model and data and why it has given less accurcay","a59a5745":"# Prediction","e2e9e5b3":"#### From above graph we see different learning rate in which our model perform. choose accordingly.\n\nAs example in cats vs dogs we need to lower learning rate for earlier layers and higher one for the last layers.\nbut in this test i think to keep one"}}