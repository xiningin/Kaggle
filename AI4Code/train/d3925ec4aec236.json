{"cell_type":{"4b2b7bbf":"code","7d641c23":"code","79e78c8b":"code","c00d9378":"code","3697b7b0":"code","36903e84":"code","1d7da3fc":"code","1b6467c1":"code","2584fcf0":"code","99cadc19":"code","c2f1c3b0":"code","a791a89c":"code","c55b79d4":"code","2e5b7dd5":"code","cf63f674":"code","358e3ed1":"markdown","05cb56f0":"markdown","f699a7b1":"markdown","98495b91":"markdown","8b207f4d":"markdown","c3b0aea8":"markdown","d36b835e":"markdown"},"source":{"4b2b7bbf":"import pandas as pd\nimport numpy as np\nfrom glob import glob\nimport cv2\nfrom skimage import io\nfrom tqdm import tqdm\nimport seaborn as sns","7d641c23":"!mkdir '1024x1024-dataset-melanoma'\n","79e78c8b":"df_train = pd.read_csv('..\/input\/siim-isic-melanoma-classification\/train.csv')","c00d9378":"df_gt = pd.read_csv('..\/input\/isic-2019\/ISIC_2019_Training_GroundTruth.csv')\nimage_id = df_gt.iloc[25]['image']\nimage = cv2.imread(f'..\/input\/isic-2019\/ISIC_2019_Training_Input\/ISIC_2019_Training_Input\/{image_id}.jpg', cv2.IMREAD_COLOR)\nimage = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\nio.imshow(image);","3697b7b0":"df_downsampled = df_gt[df_gt['image'].str.contains('downsampled')]\ndf_downsampled.shape[0]","36903e84":"print('[ALL]:', df_gt.shape[0])\nprint('[\u2229 isic2020]:', len(set(df_train['image_name'].values).intersection(df_gt['image'].values)))\nprint('[downsampled isic2019 \u2229 isic2020]:', len(set(df_train['image_name'].values).intersection([\n    image_id[:-12] for image_id in df_downsampled['image'].values\n])))\nprint('[downsampled isic2019 \u2229 isic2019]:', len(set(df_gt['image'].values).intersection([\n    image_id[:-12] for image_id in df_downsampled['image'].values\n])))","1d7da3fc":"paths = glob('..\/input\/skin-lesion-analysis-toward-melanoma-detection\/skin-lesions\/*\/*\/*.jpg')\nimage = cv2.imread(paths[777], cv2.IMREAD_COLOR)\nimage = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\nio.imshow(image);","1b6467c1":"image_ids = [path.split('\/')[-1][:-4] for path in paths]\nprint('[ALL]:', len(image_ids))\nprint('[\u2229 isic2020]:', len(set(image_ids).intersection(df_train['image_name'].values)))\nprint('[\u2229 isic2019]:', len(set(image_ids).intersection(df_gt['image'].values)))\nprint('[\u2229 isic2019 downsampled]:', len(set(image_ids).intersection([image_id[:-12] for image_id in df_gt[df_gt['image'].str.contains('downsampled')]['image'].values])))","2584fcf0":"df_meta = pd.read_csv('..\/input\/skin-cancer-mnist-ham10000\/HAM10000_metadata.csv')","99cadc19":"image_id = df_meta.iloc[777]['image_id']\nimage = cv2.imread(f'..\/input\/skin-cancer-mnist-ham10000\/HAM10000_images_part_1\/{image_id}.jpg', cv2.IMREAD_COLOR)\nimage = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\nio.imshow(image);","c2f1c3b0":"print('[ALL]:', df_meta.shape[0])\nprint('[\u2229 isic2020]:', len(set(df_meta['image_id'].values).intersection(df_train['image_name'].values)))\nprint('[\u2229 isic2019]:', len(set(df_meta['image_id'].values).intersection(df_gt['image'].values)))\nprint('[\u2229 slatmd]:', len(set(df_meta['image_id'].values).intersection(image_ids)))","a791a89c":"NEED_IMAGE_SAVE = True","c55b79d4":"dataset = {\n    'patient_id' : [],\n    'image_id': [],\n    'target': [],\n    'source': [],\n    'sex': [],\n    'age_approx': [],\n    'anatom_site_general_challenge': [],\n}\n\n# isic2020\ndf_train = pd.read_csv('..\/input\/siim-isic-melanoma-classification\/train.csv', index_col='image_name')\nfor image_id, row in tqdm(df_train.iterrows(), total=df_train.shape[0]):\n    if image_id in dataset['image_id']:\n        continue\n    dataset['patient_id'].append(row['patient_id'])\n    dataset['image_id'].append(image_id)\n    dataset['target'].append(row['target'])\n    dataset['source'].append('ISIC20')\n    dataset['sex'].append(row['sex'])\n    dataset['age_approx'].append(row['age_approx'])\n    dataset['anatom_site_general_challenge'].append(row['anatom_site_general_challenge'])\n\n    if NEED_IMAGE_SAVE:\n        image = cv2.imread(f'..\/input\/siim-isic-melanoma-classification\/jpeg\/train\/{image_id}.jpg', cv2.IMREAD_COLOR)\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n        image = cv2.resize(image, (1024, 1024), cv2.INTER_AREA)\n        cv2.imwrite(f'.\/1024x1024-dataset-melanoma\/{image_id}.jpg', image)\n\n# isic2019\ndf_gt = pd.read_csv('..\/input\/isic-2019\/ISIC_2019_Training_GroundTruth.csv', index_col='image')\ndf_meta = pd.read_csv('..\/input\/isic-2019\/ISIC_2019_Training_Metadata.csv', index_col='image')\nfor image_id, row in tqdm(df_meta.iterrows(), total=df_meta.shape[0]):\n    if image_id in dataset['image_id']:\n        continue\n\n    dataset['patient_id'].append(row['lesion_id'])\n    dataset['image_id'].append(image_id)\n    dataset['target'].append(int(df_gt.loc[image_id]['MEL']))\n    dataset['source'].append('ISIC19')\n    dataset['sex'].append(row['sex'])\n    dataset['age_approx'].append(row['age_approx'])\n    dataset['anatom_site_general_challenge'].append(\n        {'anterior torso': 'torso', 'posterior torso': 'torso'}.get(row['anatom_site_general'], row['anatom_site_general'])\n    )\n    \n    if NEED_IMAGE_SAVE:\n        image = cv2.imread(f'..\/input\/isic-2019\/ISIC_2019_Training_Input\/ISIC_2019_Training_Input\/{image_id}.jpg', cv2.IMREAD_COLOR)\n        image = cv2.resize(image, (1024, 1024), cv2.INTER_AREA)\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n        cv2.imwrite(f'.\/1024x1024-dataset-melanoma\/{image_id}.jpg', image)\n\n    \ndataset = pd.DataFrame(dataset)    ","2e5b7dd5":"dataset.head()","cf63f674":"dataset.to_csv('marking.csv', index=False)","358e3ed1":"## [@ipateam](https:\/\/www.kaggle.com\/ipateam) Thanks a lot for [finding dublicated images](https:\/\/www.kaggle.com\/c\/siim-isic-melanoma-classification\/discussion\/155859#878163)! ","05cb56f0":"# Skin Cancer MNIST: HAM10000 [Repeated]","f699a7b1":"# isic 2019","98495b91":"# Merge datasets & metadata","8b207f4d":"# Thank you all for reading my kernel!\n\n","c3b0aea8":"# Main Idea\n\nLets merge these datasets from [topic](https:\/\/www.kaggle.com\/c\/siim-isic-melanoma-classification\/discussion\/154296#864656) by [@andrewmvd](https:\/\/www.kaggle.com\/andrewmvd):\n\n---\n- [Melanoma Detection Dataset](https:\/\/www.kaggle.com\/wanderdust\/skin-lesion-analysis-toward-melanoma-detection)\n- [Skin Lesion Images for Melanoma Classification](https:\/\/www.kaggle.com\/andrewmvd\/isic-2019)\n- [Skin Cancer MNIST: HAM10000](https:\/\/www.kaggle.com\/kmader\/skin-cancer-mnist-ham10000)\n---\n\n- [SIIM-ISIC Melanoma Classification](https:\/\/www.kaggle.com\/c\/siim-isic-melanoma-classification\/data)\n","d36b835e":"# SLATMD [Almost completely repeated] [Removed]"}}