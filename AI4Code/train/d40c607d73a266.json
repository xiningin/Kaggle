{"cell_type":{"f85fe3d4":"code","d187f50a":"code","9d9888cf":"code","6a9b88fe":"code","724c96fc":"code","a279a81b":"code","dc9e3077":"code","25869bbd":"code","b428bd69":"code","0d2a7016":"code","b0cd1f1e":"code","d3cecf22":"code","5f5468b6":"code","8aa60f84":"code","179307a0":"code","d1c9ddb7":"code","30c1e217":"code","146b921b":"code","e7e35f7d":"code","9c54ecc2":"code","5f1745aa":"code","80d5ea19":"code","c6000628":"code","2b576389":"code","97f07642":"code","2d59d315":"code","5755b3e0":"code","8d0bbb4f":"markdown"},"source":{"f85fe3d4":"import os\nfrom fastai.vision import *\nfrom fastai import *\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom functools import partial\nfrom tqdm.notebook import tqdm\nimport gc\nfrom pylab import imread,subplot,imshow,show\n%matplotlib inline","d187f50a":"path = \"\/kaggle\/input\/kermany2018\/OCT2017 \/\"","9d9888cf":"data\n","6a9b88fe":"size = 224\nbs=6","724c96fc":"size = 224\nbs = 64\ndata = ImageDataBunch.from_folder(path, \n                                  ds_tfms=get_transforms(max_rotate=0.1,max_lighting=0.15),\n                                  valid_pct=0.2, \n                                  size=size, \n                                  bs=bs)","a279a81b":"data.show_batch(rows=4)","dc9e3077":"fb = FBeta()\nfb.average='macro'","25869bbd":"learner = cnn_learner(data, models.resnet18, metrics=[accuracy])","b428bd69":"learner.fit_one_cycle(1,1e-3)","0d2a7016":"learner.save('model_retina2')","b0cd1f1e":"learner.model_dir='\/kaggle\/working\/'","d3cecf22":"learner.export('\/kaggle\/working\/export2.pkl')","5f5468b6":"l=load_learner('\/kaggle\/working\/')","8aa60f84":"learner=load_learner('\/kaggle\/input\/modelx\/')","179307a0":"learner","d1c9ddb7":"learner.load('\/kaggle\/input\/modelx\/model_retina')","30c1e217":"interp= ClassificationInterpretation.from_learner(learner)","146b921b":"preds,y,losses = learner.get_preds(with_loss=True)","e7e35f7d":"interp.plot_confusion_matrix()","9c54ecc2":"import cv2\nimport numpy as np\nimg = cv2.imread('\/kaggle\/input\/kermany2018\/OCT2017 \/val\/DME\/DME-9721607-2.jpeg')\ngray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)\nimg2 = np.zeros_like(img)\nimg2[:,:,0] = gray\nimg2[:,:,1] = gray\nimg2[:,:,2] = gray\n","5f1745aa":"path2='\/kaggle\/input\/kermany2018\/OCT2017 \/test\/'","80d5ea19":"img=pil2tensor(img2,dtype=np.float32)","c6000628":"cl=['CNV','DME','DRUSEN','NORMAL']","2b576389":"for i in range(len(cl)):\n    for file in os.listdir(path2+str(cl[i])):\n        path3='\/kaggle\/input\/kermany2018\/OCT2017 \/test\/'+str(cl[i])+\"\/\"+str(file)\n        \n        img=cv2.imread(str(path3))\n        gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)\n        img2 = np.zeros_like(img)\n        img2[:,:,0] = gray\n        img2[:,:,1] = gray\n        img2[:,:,2] = gray\n        gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)\n        img2 = np.zeros_like(img)\n        img2[:,:,0] = gray\n        img2[:,:,1] = gray\n        img2[:,:,2] = gray\n        print(cl[i])\n        img=pil2tensor(img2,dtype=np.float32)\n        print(learner.predict(Image(img)))\n        \n\n        \n    \n    ","97f07642":"pre=[]\nfor i in preds:\n    a=max(i)\n    pre.append(a)\npre = np.array(pre, dtype=np.float32)","2d59d315":"path2='\/kaggle\/input\/kermany2018\/OCT2017 \/val\/'\nimg=cv2.imread('\/kaggle\/input\/kermany2018\/OCT2017 \/val\/CNV\/CNV-6294785-1.jpeg')\ngray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)\nimg2 = np.zeros_like(img)\nimg2[:,:,0] = gray\nimg2[:,:,1] = gray\nimg2[:,:,2] = gray\ngray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)\nimg2 = np.zeros_like(img)\nimg2[:,:,0] = gray\nimg2[:,:,1] = gray\nimg2[:,:,2] = gray\n\nimg=pil2tensor(img2,dtype=np.float32)\n        \n","5755b3e0":"print(learner.predict(Image(img)))","8d0bbb4f":"TESTING"}}