{"cell_type":{"f7c79634":"code","1f641065":"code","17c567cb":"code","f8457d6c":"code","cedca22e":"code","09f5fba7":"code","77775a8b":"code","671415ce":"code","88d296fd":"code","3420acca":"code","b97548e9":"code","d95ce8c3":"code","6f3286f6":"code","6c8037cb":"code","983803fb":"code","d7bc81ea":"code","f51c03ae":"code","07792844":"code","f430fd94":"code","bb2f76cc":"code","639e78f6":"code","b3523dc8":"code","049e80b0":"code","39eca2b8":"markdown","106cf317":"markdown","156130c1":"markdown"},"source":{"f7c79634":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom datetime import datetime, date\nfrom matplotlib import pyplot as plt\n!pip install chart_studio\nimport chart_studio.plotly as py\nimport plotly.graph_objs as go\n\n# these two lines are what allow your code to show up in a notebook! - thanks, Rachael\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode(connected=True)\n%matplotlib inline\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\n# Any results you write to the current directory are saved as output.","1f641065":"import os, time\n# print(os.listdir(\"..\/input\/\"))\nfile_mod_time = os.path.getmtime(\"..\/input\/daily-inmates-in-custody.csv\")\nprint(\"The data file was last modified\", time.ctime(file_mod_time), \"UTC.\")","17c567cb":"df = pd.read_csv(\"..\/input\/daily-inmates-in-custody.csv\")\nprint(df.head(10))\nlist(df) # list the column names; uncomment for reference as needed\nprint(len(df))\nprint(df.nunique()) # check that INMATEID is unique for every entry -- it is","f8457d6c":"df.sample(10)","cedca22e":"# explore male-female numbers by race\ncolor_and_sex = df.groupby(['RACE','GENDER']).INMATEID.count().reset_index()\nc_and_s_pivot = color_and_sex.pivot(columns=\"RACE\", index=\"GENDER\", values='INMATEID').reset_index()\nprint(c_and_s_pivot)","09f5fba7":"women_race = c_and_s_pivot.iloc[0,1:]\n# print(women_race)\nmen_race = c_and_s_pivot.iloc[1,1:]\n# print(men_race)\nlist_of_races = ['Asian','Black','Inidian','Other','Unspecified','White']\n\ntrace1 = go.Bar(\n    x= list_of_races,\n    y= men_race,\n    name='Men'\n)\ntrace2 = go.Bar(\n    x= list_of_races,\n    y= women_race,\n    name='Women'\n)\n\ndata = [trace1, trace2]\nlayout = go.Layout(\n    barmode='stack',\n    title='NYC Incarceration by Race and Sex'\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig)","77775a8b":"fig = {\n  \"data\": [\n    {\n      \"values\": men_race,\n      \"labels\": list_of_races,\n      \"domain\": {\"x\": [0, .48]},\n      \"name\": \"Men\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    },\n    {\n      \"values\": women_race,\n      \"labels\": list_of_races,\n      \"text\":[\"Women\"],\n      \"textposition\":\"inside\",\n      \"domain\": {\"x\": [.52, 1]},\n      \"name\": \"Women\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    }],\n  \"layout\": {\n        \"title\":\"NYC Incarceration by Race and Sex\",\n        \"annotations\": [\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Men\",\n                \"x\": 0.2,\n                \"y\": 0.5\n            },\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Women\",\n                \"x\": 0.82,\n                \"y\": 0.5\n            }\n        ]\n    }\n}\niplot(fig, filename='donut')","671415ce":"# challenge: populate with a for loop\ntrace1 = go.Bar(\n    x=['Men', 'Women'],\n    y=[men_race[1], women_race[1]],\n    name='Black'\n)\ntrace2 = go.Bar(\n    x=['Men', 'Women'],\n    y=[men_race[3], women_race[3]],\n    name='Other'\n)\ntrace3 = go.Bar(\n    x=['Men', 'Women'],\n    y=[men_race[5], women_race[5]],\n    name='White'\n)\ntrace4 = go.Bar(\n    x=['Men', 'Women'],\n    y=[men_race[0], women_race[0]],\n    name='Asian'\n)\ntrace5 = go.Bar(\n    x=['Men', 'Women'],\n    y=[men_race[2], women_race[2]],\n    name='Indian'\n)\ntrace6 = go.Bar(\n    x=['Men', 'Women'],\n    y=[men_race[4], women_race[4]],\n    name='Unspecified'\n)\n\ndata = [trace1, trace2, trace3, trace4, trace5, trace6]\nlayout = go.Layout(\n    barmode='group',\n    title=\"NYC Incarceration by Race and Sex\"\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='grouped-bar')\n\n# here's the for loop\n# data = []\n# for i in range(length(list_of_races)):\n#     trace = go.Bar(\n#    x=['Men', 'Women'],\n#    y=[men_race[i], women_race[i]],\n#    name=list_of_races[i])\n#    data.append(trace)\n# modify the loop so it displays in the same order as the non-for loop chart -- aids readability ","88d296fd":"# explore numbers by race and gang affiliation\nrace_gang = df.groupby(['RACE','SRG_FLG']).INMATEID.count().reset_index()\nrace_gang_pivot = race_gang.pivot(columns=\"RACE\", index=\"SRG_FLG\", values='INMATEID').reset_index()\nprint(race_gang_pivot)\nrace_no_gang = race_gang_pivot.iloc[0,1:]\n# print(women_race)\nrace_gang = race_gang_pivot.iloc[1,1:]\ngang_list = ['No Gang Affiliation', 'Gang Affilition']\ntrace1 = go.Bar(\n    x=gang_list,\n    y=[race_no_gang[1], race_gang[1]],\n    name='Black'\n)\ntrace2 = go.Bar(\n    x=gang_list,\n    y=[race_no_gang[3], race_gang[3]],\n    name='Other'\n)\ntrace3 = go.Bar(\n    x=gang_list,\n    y=[race_no_gang[5], race_gang[5]],\n    name='White'\n)\ntrace4 = go.Bar(\n    x=gang_list,\n    y=[race_no_gang[0], race_gang[0]],\n    name='Asian'\n)\ntrace5 = go.Bar(\n    x=gang_list,\n    y=[race_no_gang[2], race_gang[2]],\n    name='Indian'\n)\ntrace6 = go.Bar(\n    x=gang_list,\n    y=[race_no_gang[4], race_gang[4]],\n    name='Unspecified'\n)\n\ndata = [trace1, trace2, trace3, trace4, trace5, trace6]\nlayout = go.Layout(\n    barmode='group',\n    title=\"NYC Incarceration by Race and Gang Affiliation\"\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='grouped-bar_gang')","3420acca":"# explore numbers by age\nage_sort = df.groupby('AGE').INMATEID.count().reset_index()\n# print(age_sort.head())\nage_x = age_sort.iloc[:,0]\nage_y = age_sort.iloc[:,1]\n# print(age_x)\n# print(age_y)\ndata = [go.Scatter(x=age_x, y=age_y)]\n\n# specify the layout of our figure\nlayout = dict(title = \"NYC Incarceration by Age\",\n              xaxis= dict(title= 'Age',ticklen=5,zeroline=False))\n\n# create and show our figure\nfig = dict(data = data, layout = layout)\niplot(fig)","b97548e9":"# compare numbers by age and race\nage_race_sort = df.groupby(['AGE','RACE']).INMATEID.count().reset_index()\nage_race_pivot = age_race_sort.pivot(columns=\"RACE\", index=\"AGE\", values='INMATEID').reset_index()\n# print(age_race_sort.head())\nprint(\"age_race_pivot \\n\", age_race_pivot.head())","d95ce8c3":"title = 'NYC Incarceration by Age and Race'\nlabels = list_of_races\ncolors = ['red', 'orange', 'brown', 'green', 'blue', 'indigo']\nmode_size = [8] * 6\nline_size = [2] * 6\n\nx_data = [\n    age_race_pivot.iloc[:,0],\n    age_race_pivot.iloc[:,0],\n    age_race_pivot.iloc[:,0],\n    age_race_pivot.iloc[:,0],\n    age_race_pivot.iloc[:,0],\n    age_race_pivot.iloc[:,0],\n]\n\ny_data = [\n    np.array(age_race_pivot.iloc[:,1]),\n    np.array(age_race_pivot.iloc[:,2]),\n    np.array(age_race_pivot.iloc[:,3]),\n    np.array(age_race_pivot.iloc[:,4]),\n    np.array(age_race_pivot.iloc[:,5]),\n    np.array(age_race_pivot.iloc[:,6]),\n]\n\ntraces = []\n\nfor i in range(0,6):\n    traces.append(go.Scatter(\n        x=x_data[i],\n        y=y_data[i],\n        mode='lines',\n        name=labels[i],\n        line=dict(color=colors[i], width=line_size[i]),\n        connectgaps=True,\n    ))\n\nlayout = go.Layout(\n    xaxis=dict(\n        showline=True,\n        showgrid=True,\n        showticklabels=True,\n        linecolor='rgb(204, 204, 204)',\n        linewidth=2,\n        ticks='outside',\n        tickcolor='rgb(204, 204, 204)',\n        tickwidth=2,\n        ticklen=5,\n        tickfont=dict(\n            family='Arial',\n            size=12,\n            color='rgb(82, 82, 82)',\n        ),\n    ),\n    yaxis=dict(\n        showgrid=True,\n        zeroline=False,\n        showline=False,\n        showticklabels=True,\n    ),\n    autosize=True,\n    margin=dict(\n        autoexpand=False,\n        l=100,\n        r=20,\n        t=110,\n    ),\n    showlegend=True\n)\n\nannotations = []\n\n# Title\nannotations.append(dict(xref='paper', yref='paper', x=0.0, y=1.05,\n                              xanchor='left', yanchor='bottom',\n                              text=title,\n                              font=dict(family='Arial',\n                                        size=30,\n                                        color='rgb(37,37,37)'),\n                              showarrow=False))\n# Source\nannotations.append(dict(xref='paper', yref='paper', x=0.5, y=-0.1,\n                              xanchor='center', yanchor='top',\n                              text='Age',\n                              font=dict(family='Arial',\n                                        size=12,\n                                        color='black'),\n                              showarrow=False))\n\nlayout['annotations'] = annotations\n\nfig = go.Figure(data=traces, layout=layout)\niplot(fig)","6f3286f6":"q75, q25 = np.percentile(age_x, [75 ,25])\nmean_age = np.mean(age_x)\nmedian_age = np.median(age_x)\nprint(f\"The 25th percentile age is {int(q25)}, and the 75th percentile age is {int(q75)}.\")\nprint(f\"The mean age is {int(mean_age)}, and the median age is {int(median_age)}.\")\nprint(f\"The youngest is {min(age_x)}, and the oldest is {max(age_x)}.\")","6c8037cb":"# explore custody level numbers by race\ncolor_and_custody = df.groupby(['RACE','CUSTODY_LEVEL']).INMATEID.count().reset_index()\nc_and_c_pivot = color_and_custody.pivot(columns=\"RACE\", index=\"CUSTODY_LEVEL\", values='INMATEID').reset_index()\nprint(c_and_c_pivot)","983803fb":"max_race = np.array(c_and_c_pivot.iloc[0,1:])\nmed_race = np.array(c_and_c_pivot.iloc[1,1:])\nmin_race = np.array(c_and_c_pivot.iloc[2,1:])\n# print(max_race)  # for reference \ntrace1 = go.Bar(\n    x= list_of_races,\n    y= max_race,\n    name='Maximum'\n)\ntrace2 = go.Bar(\n    x= list_of_races,\n    y= med_race,\n    name='Medium'\n)\ntrace3 = go.Bar(\n    x= list_of_races,\n    y= min_race,\n    name='Minimum'\n)\ndata = [trace1, trace2, trace3]\nlayout = go.Layout(\n    barmode='stack',\n    title='NYC Incarceration by Race and Custody Level'\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig)","d7bc81ea":"custody_legend = ['Maximum', 'Medium', 'Minimum']\ncolor_max = 'rgb(230, 76, 0)'\ncolor_med = 'rgb(230, 191, 0)'\ncolor_min = 'rgb(128, 128, 128)'\n\nx_list = [[0, 0.31], [ 0.33, 0.64], [0.66, 1]] # x-coordinates for pie plots (three columns)\ny_list = [[0, 0.49], [ 0.51, 1]]               # y-coordinates for pie plots (two rows)\ndata_pie = []\nfor i in range(len(max_race)):\n    data_pie.append({\n        'labels': custody_legend,\n        'values': [max_race[i], med_race[i], min_race[i]],\n        'type': 'pie',\n        'name': list_of_races[i],\n        'marker': {'colors': [color_max,\n                              color_med,\n                              color_min]},\n        'domain': {'x': x_list[i % 3],\n                   'y': y_list[i % 2]},\n        'hoverinfo':'label+percent+name',\n        'textinfo':'none',\n        'title': list_of_races[i]\n    })\n    \nfig = {\n    'data': data_pie,\n    'layout': {'title': 'NYC Custody Level by Race - Shown Proportionally',\n               'showlegend': True}\n}\n\niplot(fig, filename='pie_chart_subplots')","f51c03ae":"# compare numbers by age and sex using a bar chart\nage_sex_sort = df.groupby(['AGE','GENDER']).INMATEID.count().reset_index()\nage_sex_pivot = age_sex_sort.pivot(columns=\"GENDER\", index=\"AGE\", values='INMATEID').reset_index()\n# print(age_sex_sort.head())\nprint(age_sex_pivot.head())","07792844":"age_array = np.array(age_sex_pivot.iloc[:,0]) # take all rows of of column 0 (AGE)\nage_women = np.array(age_sex_pivot.iloc[:,1]) \n# age_women[~(age_women > 0)] = 0 # replace null values with 0 to keep the array the same size as the age_array\nage_men = np.array(age_sex_pivot.iloc[:,2])\n# print(age_women, age_men)\n# a_s_labels = []\na_s_legend = ['Men', 'Women']\nplt.figure(figsize=(10,8))\nplt.bar(age_array, age_men)\nplt.bar(age_array, age_women)\nplt.legend(a_s_legend, loc=1)\nplt.xlabel('Age')\nplt.ylabel('Incarcerated')\nplt.title('NYC Incarceration by Sex and Age')\nplt.show()","f430fd94":"# compare numbers by age and race\nage_race_sort = df.groupby(['AGE','RACE']).INMATEID.count().reset_index()\nage_race_pivot = age_race_sort.pivot(columns=\"RACE\", index=\"AGE\", values='INMATEID').reset_index()\n# print(age_race_sort.head())\nprint(age_race_pivot.head())","bb2f76cc":"df[\"duration\"] = df.ADMITTED_DT.apply(lambda x: (datetime.now() - datetime.strptime(x, \"%Y-%m-%dT%H:%M:%S.000\")).days)\n# print(\"full DataFrame length is\", len(df))\ndays_offset = min(df.duration)\n\nprint(\"The minimum stay is\", min(df.duration) - days_offset, \"day(s).\")\nprint(\"The maximum stay (so far) is\", max(df.duration) - days_offset, \"days.\")\nprint(\"The average stay is\", round(np.mean(df.duration),0) - days_offset, \"days.\")\nprint(\"The median length of stay is\", round(np.median(df.duration) - days_offset,0), \"days.\")\nprint(\"The standard deviation is\", round(np.std(df.duration),0) - days_offset, \"days.\")","639e78f6":"data = [go.Histogram(x=df.duration)]\nlayout = go.Layout(\n    title='Duration of Stay',\n    xaxis=dict(\n        title='Days'\n    ),\n    yaxis=dict(\n        title='Number of Inmates'\n    ),\n) # end layout\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='basic histogram')","b3523dc8":"# df_short = df[df.duration < 1500] \ndf_short = df[df.duration < np.percentile(df.duration, 90)]\n# print(len(df_short))\nprint(\"The minimum stay is\", min(df_short.duration) - days_offset, \"day(s).\")\nprint(\"The maximum stay (so far) is\", max(df_short.duration) - days_offset, \"days.\")\nprint(\"The average stay is\", round(np.mean(df_short.duration) - days_offset,0), \"days.\")\nprint(\"The median length of stay is\", round(np.median(df_short.duration) - days_offset,0), \"days.\")\nprint(\"The standard deviation is\", round(np.std(df_short.duration),0) - days_offset, \"days.\")\n\ndata = [go.Histogram(x=df_short.duration)]\nlayout = go.Layout(\n    title='Duration of Stay',\n    xaxis=dict(\n        title='Days'\n    ),\n    yaxis=dict(\n        title='Number of Inmates'\n    ),\n) # end layout\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='basic_histogram')","049e80b0":"# compare by race and length of stay (so far)\n# compare by sex and length of stay (so far)\n# compare by age and length of stay (so far)","39eca2b8":"The breakout of [NYC population by race from the U.S. Census Bureau](https:\/\/www.census.gov\/quickfacts\/fact\/table\/newyorkcitynewyork\/PST045217) gives the following information:\nRacial categories are explained at this [link](https:\/\/www.census.gov\/quickfacts\/fact\/note\/US\/RHI125217). The list used for this analysis is consistent with the Census Bureau's description.\nThe population estimates by percentage are \n- White: 42.8\n- Black or African American: 24.3\n- American Indian or Alaska Native: 0.4\n- Asian: 14.0\n- This leaves Other, including unspecified or not provided: 18.5\n\nWe can use this information to calculate probabilities of incarceration based on race.","106cf317":"This page last updated 27 March 2020 (EDT).  The data file is updated periodically, not necessarily on a regular schedule.","156130c1":"This table is modified below: the maximum duration is set to the 90th percentile to remove outliers.  Observe the differences in the mean and, especially, the standard deviation.  The medians aren't very different on a relative basis compared to the mean and standard deviation.  \n\nThe 75th percentile, on the other hand, has numbers at about \n- maximum stay: 239 days\n- average stay: 80 days\n- median stay: 63 days\n- standard deviation: 59 days\n\nAn earlier iteration used 1500 days as a cut-off and removed about 0.25 percent of the dataset.\nThe data are offset based on the latest data file update so the minimum number of days is set to zero."}}