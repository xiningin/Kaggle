{"cell_type":{"097ad14a":"code","903a5441":"code","594e6023":"code","71daab15":"code","c20150eb":"code","547ece23":"code","18117f24":"code","17378bf0":"code","294086cc":"code","ae8afaa4":"code","732d418e":"code","03dbfbc4":"code","8756f1bf":"code","37715a32":"code","f66f4472":"code","3e2550e2":"code","d381af2c":"code","1071e3d5":"code","fec1026d":"code","8c9317a1":"code","8a73aa03":"code","29f5898e":"code","324e82c4":"code","3fcb1da5":"code","3788c4e4":"code","9fe6f7ae":"code","bc55ae0a":"code","d6d80e4f":"code","e669a8f1":"code","08255327":"code","3a8ea9ab":"code","f9d95023":"code","1bc1ed50":"code","3d5b91b6":"code","0e403b71":"code","e99936a9":"code","ffe2638d":"code","b6c82f67":"markdown","52946fdf":"markdown","9206028b":"markdown","7428a2d5":"markdown"},"source":{"097ad14a":"import pandas as pd\nimport numpy as np\nimport os\nimport matplotlib.pyplot as plt\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.preprocessing import OneHotEncoder\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.metrics import mean_absolute_error\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.metrics import mean_squared_error\nfrom xgboost import XGBRegressor\nfrom sklearn.model_selection import GridSearchCV\nimport category_encoders as ce\n","903a5441":"test_filepath = '..\/input\/tmdb-box-office-prediction\/test.csv'\ntrain_filepath = '..\/input\/tmdb-box-office-prediction\/train.csv'","594e6023":"test_set = pd.read_csv(test_filepath)\ntrain_data = pd.read_csv(train_filepath)\ntrain_data = train_data.replace(0,np.nan)","71daab15":"test_set.head()","c20150eb":"test_set.columns.drop([\"belongs_to_collection\", \"id\", \"tagline\", \"imdb_id\",\"homepage\", \"poster_path\", \"original_title\", \"overview\",\"crew\", \"status\" ])","547ece23":"y = train_data.revenue\ntrain_set = train_data.drop([\"revenue\"], axis=1)","18117f24":"X_train, X_val, y_train, y_val = train_test_split(train_set,y,test_size=0.2, random_state=42)","17378bf0":"print(train_set.shape,X_train.shape,X_val.shape,y_train.shape,y_val.shape)","294086cc":"%matplotlib inline\ntrain_set.hist(bins=50, figsize =(20,15))","ae8afaa4":"corr = train_data.corr()\ncorr[\"revenue\"].sort_values(ascending=False)","732d418e":"numeric_features =[\"budget\", \"popularity\", \"runtime\"]\npd.plotting.scatter_matrix(train_data[numeric_features], figsize=(12,8))","03dbfbc4":"train_data.plot(kind=\"scatter\", x = \"runtime\", y = \"revenue\")","8756f1bf":"X_test = test_set.copy()","37715a32":"cols_with_missing = [cols for cols in X_train.columns if X_train[cols].isnull().any()]","f66f4472":"missing_val_count_by_column = (X_train[numeric_features].isnull().sum())\nprint(missing_val_count_by_column[missing_val_count_by_column >0])","3e2550e2":"X_train[\"budget\"].skew() #high skew","d381af2c":"X_train[\"runtime\"].skew() #high skew","1071e3d5":"X_train[X_train._get_numeric_data().columns].plot(kind=\"box\", figsize = (10,10))","fec1026d":"X_train[\"budget\"].plot(kind=\"box\", figsize = (10,10))","8c9317a1":"# find number of unique entries\n\ns= train_set.dtypes == \"object\"\nobject_cols = list(s[s].index)\n\nfor col in object_cols:\n    print(str(col) +\": \" + str(train_set[col].nunique()))","8a73aa03":"X_train[object_cols].nunique()","29f5898e":"# if not using cross-validation\n\n# def get_mae(max_leaf_nodes,X_train, X_val, y_train, y_val):\n#     model = RandomForestRegressor(max_leaf_nodes=max_leaf_nodes, random_state = 42)\n#     my_pipeline = Pipeline(steps = [(\"preprocessor\", preprocessor), (\"model\", model)])\n#     my_pipeline.fit(X_train,y_train)\n#     val_predictions = my_pipeline.predict(X_val)\n#     mae = mean_absolute_error(val_predictions,y_val)\n#     print(mae)","324e82c4":"object_cols = [\"genres\", \"original_language\", 'production_companies',\n 'production_countries','spoken_languages','Keywords']","3fcb1da5":"numerical_imputer = SimpleImputer(strategy=\"median\")\nimputed_numerical_X_train = pd.DataFrame(numerical_imputer.fit_transform(X_train[numeric_features]))\nimputed_numerical_X_val = pd.DataFrame(numerical_imputer.transform(X_val[numeric_features]))\nimputed_numerical_X_train.columns = numeric_features\nimputed_numerical_X_val.columns = numeric_features\nimputed_numerical_X_test = pd.DataFrame(numerical_imputer.fit_transform(X_test[numeric_features]))\nimputed_numerical_X_test.columns = numeric_features\n","3788c4e4":"categorical_imputer = SimpleImputer(strategy=\"most_frequent\")\nimputed_categorical_X_train = pd.DataFrame(categorical_imputer.fit_transform(X_train[object_cols]))\nimputed_categorical_X_val = pd.DataFrame(categorical_imputer.transform(X_val[object_cols]))\nimputed_categorical_X_train.columns = object_cols\nimputed_categorical_X_val.columns = object_cols\nimputed_categorical_X_test = pd.DataFrame(categorical_imputer.fit_transform(X_test[object_cols]))\nimputed_categorical_X_test.columns = object_cols\n","9fe6f7ae":"count_enc = ce.CountEncoder(cols = object_cols)\ncount_encoded_train = count_enc.fit_transform(imputed_categorical_X_train)\ncount_encoded_val = count_enc.transform(imputed_categorical_X_val)\ncount_encoded_test = count_enc.fit_transform(imputed_categorical_X_test)","bc55ae0a":"X_train = pd.concat([imputed_numerical_X_train,count_encoded_train], axis= 1)\nX_val = pd.concat([imputed_numerical_X_val,count_encoded_val], axis= 1)\nX_test = pd.concat([imputed_numerical_X_test,count_encoded_test], axis= 1)","d6d80e4f":"X_test","e669a8f1":"XGBRmodel = XGBRegressor(random_state = 42)","08255327":"param_grid = {\n        \"xgbrg__n_estimators\": [10,25, 50, 100, 150, 200, 300,400],\n    \"xgbrg__learning_rate\": [0.01,0.05,0.1, 0.75, 1]\n}","3a8ea9ab":"# fit_params = {\"xgbrg__eval_set\": [(X_val,y_val)], \n#               \"xgbrg__early_stopping_rounds\": 5, \n#               \"xgbrg__verbose\": False   \n# }","f9d95023":"grid_search = GridSearchCV(XGBRmodel, param_grid,scoring=\"neg_mean_squared_error\", cv=5, n_jobs=1 )","1bc1ed50":"grid_search.fit(X_train, y_train, early_stopping_rounds=5,           eval_set=[(X_val, y_val)],           verbose=True) #","3d5b91b6":"# grid_search.best_estimator_","0e403b71":"test_predictions = grid_search.predict(X_test)","e99936a9":"output = pd.DataFrame({\"id\": test_set.id,\n                      \"revenue\":test_predictions})","ffe2638d":"output.to_csv(\"submission.csv\", index=False)","b6c82f67":"Set up a validation set to validate the accuracy of the model on.","52946fdf":"# Visualise numeric fields for outliers","9206028b":"# Lots of outliers and skew, impute the median not the mean, on numerical data","7428a2d5":"Define model, fit and predict"}}