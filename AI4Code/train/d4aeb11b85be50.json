{"cell_type":{"1c3109a0":"code","c54fb5e3":"code","c61495e5":"code","dd960efd":"code","78751c28":"code","ead3a1f0":"code","c28f5e89":"code","408377b5":"code","a32cda54":"code","e6b3daf1":"code","f10e2582":"code","42d5c5fc":"code","4f6985b8":"code","4d3bc1d1":"code","cec8d5fc":"code","e780bd59":"code","a82b63ce":"code","6703b956":"code","41a8c9c8":"code","41ede8af":"code","6c48aeb8":"code","37a234da":"code","1428891f":"code","77c12d3c":"code","e8dd7518":"code","73be2df1":"markdown","3efaa8ef":"markdown","2117474f":"markdown","734ff3cb":"markdown","06475bb4":"markdown","d7414c36":"markdown","d96a0cd5":"markdown","d3a28979":"markdown","936277e0":"markdown","d998c4e5":"markdown","0734e519":"markdown","7d173035":"markdown","f55e180e":"markdown","9aec3825":"markdown","012ec963":"markdown","308422c4":"markdown","7661dd4c":"markdown","b7ce28f6":"markdown","09c77675":"markdown"},"source":{"1c3109a0":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom mpl_toolkits.mplot3d import Axes3D\nimport seaborn as sns\n\n#Importing K-means\nfrom sklearn.cluster import KMeans\n#Scaling Data\nfrom sklearn.preprocessing import StandardScaler,normalize\n#Metrics\nfrom sklearn.metrics import davies_bouldin_score,silhouette_score\n\n","c54fb5e3":"def reduce_memory_pd(df):\n    initial_memory = df.memory_usage().sum() \/ (1024**2)\n    print(\"Initial Memory Usage :\",initial_memory,\" MB\")\n    NAlist = [] # Columns with NAN values. \n    for col in df.columns:\n        if df[col].dtype != object:  # No strings or object           \n\n            minimo = df[col].max()\n            maximo = df[col].min()\n            integer = False\n            # Fill NAN with mean of the column\n            if not np.isfinite(df[col]).all(): \n                NAlist.append(col)\n                df[col].fillna(df[col].mean(),inplace=True)  \n                   \n            # Checking if column can be converted to integer, analyzing the residual of the substraction.\n            asinteger = df[col].fillna(0).astype(np.int64)\n            test_integer = (df[col] - asinteger)\n            test_integer = test_integer.sum()\n            if test_integer > -0.01 and test_integer < 0.001:\n                integer = True\n\n            # Convert to Int\n            if integer:\n                if minimo >= 0:\n                    if minimo < 255:\n                        df[col] = df[col].astype(np.uint8)\n                    elif minimo < 65535:\n                        df[col] = df[col].astype(np.uint16)\n                    elif minimo < 4294967295:\n                        df[col] = df[col].astype(np.uint32)\n                    else:\n                        df[col] = df[col].astype(np.uint64)\n                else:\n                    if minimo > np.iinfo(np.int8).min and maximo < np.iinfo(np.int8).max:\n                        df[col] = df[col].astype(np.int8)\n                    elif minimo > np.iinfo(np.int16).min and maximo < np.iinfo(np.int16).max:\n                        df[col] = df[col].astype(np.int16)\n                    elif minimo > np.iinfo(np.int32).min and maximo < np.iinfo(np.int32).max:\n                        df[col] = df[col].astype(np.int32)\n                    elif minimo > np.iinfo(np.int64).min and maximo < np.iinfo(np.int64).max:\n                        df[col] = df[col].astype(np.int64)    \n            \n            # Convert to float32\n            else:\n                df[col] = df[col].astype(np.float32)\n    # Print final result\n        mem_usg = df.memory_usage().sum() \/ 1024**2 \n    print(\"Final memory usage: \",mem_usg,\" MB\")\n    print(\"Final Memory Usage: \",100*mem_usg\/initial_memory,\"% of initial memory usage\")\n    return df\n\ndef info_table(df):\n    print(f\"Dataset Shape: {df.shape}\")\n    summary = pd.DataFrame(df.dtypes,columns=['dtypes'])\n    summary = summary.reset_index()\n    summary['Name'] = summary['index']\n    summary = summary[['Name','dtypes']]\n    summary['Miscoreing'] = df.isnull().sum().values    \n    summary['NaN'] = df.isna().sum().values\n    summary['Uniques'] = df.nunique().values\n    return summary","c61495e5":"data = pd.read_csv('..\/input\/customer-segmentation-tutorial-in-python\/Mall_Customers.csv')","dd960efd":"info_table(data)","78751c28":"data.drop([\"CustomerID\"], axis = 1, inplace=True)\ndata.head()","ead3a1f0":"data.describe()","c28f5e89":"sns.pairplot(data)","408377b5":"data['Age']","a32cda54":"plt.figure(figsize=(15,6))\nplt.subplot(1,2,1)\nsns.boxplot(y=data[\"Age\"], color=\"red\")\nplt.subplot(1,2,2)\nsns.histplot(x=data[\"Age\"])\n","e6b3daf1":"plt.figure(figsize=(15,6))\nplt.subplot(1,2,1)\nsns.boxplot(y=data[\"Spending Score (1-100)\"], color=\"red\")\nplt.subplot(1,2,2)\nsns.boxplot(y=data[\"Annual Income (k$)\"])\nplt.show()","f10e2582":"gender_count = data[\"Gender\"].value_counts()\nplt.figure(figsize=(10,4))\nsns.barplot(x=gender_count.index, y=gender_count.values)\nplt.show()","42d5c5fc":"Gender = data.pop('Gender')","4f6985b8":"score1_20 = data[\"Spending Score (1-100)\"][(data[\"Spending Score (1-100)\"] >= 1) & (data[\"Spending Score (1-100)\"] <= 20)]\nscore21_40 = data[\"Spending Score (1-100)\"][(data[\"Spending Score (1-100)\"] >= 21) & (data[\"Spending Score (1-100)\"] <= 40)]\nscore41_60 = data[\"Spending Score (1-100)\"][(data[\"Spending Score (1-100)\"] >= 41) & (data[\"Spending Score (1-100)\"] <= 60)]\nscore61_80 = data[\"Spending Score (1-100)\"][(data[\"Spending Score (1-100)\"] >= 61) & (data[\"Spending Score (1-100)\"] <= 80)]\nscore81_100 = data[\"Spending Score (1-100)\"][(data[\"Spending Score (1-100)\"] >= 81) & (data[\"Spending Score (1-100)\"] <= 100)]\n\nx_labels = [\"1-20\", \"21-40\", \"41-60\", \"61-80\", \"81-100\"]\ny_values = [len(score1_20.values), len(score21_40.values), len(score41_60.values), len(score61_80.values), len(score81_100.values)]\n\nplt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\nsns.barplot(x=x_labels, y=y_values, palette=\"pastel\")\nplt.title(\"Spending Scores\")\nplt.xlabel(\"Score\")\nplt.ylabel(\"Count of Customers\")\n\nplt.show()","4d3bc1d1":"incomes0_30 = data[\"Annual Income (k$)\"][(data[\"Annual Income (k$)\"] >= 0) & (data[\"Annual Income (k$)\"] <= 30)]\nincomes31_60 = data[\"Annual Income (k$)\"][(data[\"Annual Income (k$)\"] >= 31) & (data[\"Annual Income (k$)\"] <= 60)]\nincomes61_90 = data[\"Annual Income (k$)\"][(data[\"Annual Income (k$)\"] >= 61) & (data[\"Annual Income (k$)\"] <= 90)]\nincomes91_120 = data[\"Annual Income (k$)\"][(data[\"Annual Income (k$)\"] >= 91) & (data[\"Annual Income (k$)\"] <= 120)]\nincomes121_150 = data[\"Annual Income (k$)\"][(data[\"Annual Income (k$)\"] >= 121) & (data[\"Annual Income (k$)\"] <= 150)]\n\nx_labels = [\"$ 0 - 30,000\", \"$ 30,001 - 60,000\", \"$ 60,001 - 90,000\", \"$ 90,001 - 120,000\", \"$ 120,001 - 150,000\"]\ny_values = [len(incomes0_30.values), len(incomes31_60.values), len(incomes61_90.values), len(incomes91_120.values), len(incomes121_150.values)]\n\nplt.figure(figsize=(15,6))\nsns.barplot(x=x_labels, y=y_values, palette=\"pastel\")\nplt.title(\"Annual Incomes\")\nplt.xlabel(\"Income\")\nplt.ylabel(\"Count of costumers\")\nplt.show()","cec8d5fc":"db_score = []\nsilhou_score = []\nfor i in range(2,20):\n    k_means=KMeans(n_clusters=i,random_state=22).fit_predict(data)\n    silhou_score.append(silhouette_score(data,k_means,metric='euclidean'))\n    db_score.append(davies_bouldin_score(data,k_means))","e780bd59":"\nplt.figure(figsize=(16,5))\nplt.suptitle('Determining Number of Clusters Using K-means')\nplt.subplot(1,2,1)\nplt.title('Davies Bouldin Score')\nplt.plot(np.arange(2,20),db_score, marker='*',color='r',label='Davies Bouldin Score')\nplt.xlabel('Number of clusters')\nplt.ylabel('Davies Bouldin Score')\ntext = \"Lowest Davies-Bouldin Score is {} for n= {} clusters\".format(min(db_score).round(3),(db_score.index(min(db_score))+2))\nplt.text(4.1, 1.2,text, fontsize=11,color='blue')\nplt.subplot(1,2,2)\nplt.title('Silhouette Score')\nplt.plot(np.arange(2,20),silhou_score, marker='*',color='r',label='Silhouette Score')\nplt.xlabel('Number of clusters')\nplt.ylabel('Silhouette Score')\ntext = \"Highest Silhouette Score is {} for n= {} clusters\".format(max(silhou_score).round(3),(silhou_score.index(max(silhou_score))+2))\nplt.text(8, 0.45,text, fontsize=11,color='blue')\n\nplt.show()\n","a82b63ce":"k_means = KMeans(n_clusters = 6,random_state=22)\nclusters = k_means.fit_predict(data)\ndata[\"label\"] = clusters\ndata['Gender'] = Gender","6703b956":"fig = plt.figure(figsize=(20,10))\nax = fig.add_subplot(111, projection='3d')\nax.scatter(data.Age[data.label == 0], data[\"Annual Income (k$)\"][data.label == 0], data[\"Spending Score (1-100)\"][data.label == 0], c='tab:blue', s=60)\nax.scatter(data.Age[data.label == 1], data[\"Annual Income (k$)\"][data.label == 1], data[\"Spending Score (1-100)\"][data.label == 1], c='tab:red', s=60)\nax.scatter(data.Age[data.label == 2], data[\"Annual Income (k$)\"][data.label == 2], data[\"Spending Score (1-100)\"][data.label == 2], c='tab:green', s=60)\nax.scatter(data.Age[data.label == 3], data[\"Annual Income (k$)\"][data.label == 3], data[\"Spending Score (1-100)\"][data.label == 3], c='tab:orange', s=60)\nax.scatter(data.Age[data.label == 4], data[\"Annual Income (k$)\"][data.label == 4], data[\"Spending Score (1-100)\"][data.label == 4], c='tab:purple', s=60)\nax.scatter(data.Age[data.label == 5], data[\"Annual Income (k$)\"][data.label == 5], data[\"Spending Score (1-100)\"][data.label == 5], c='tab:brown', s=60)\nax.view_init(30, 185)\nplt.xlabel(\"Age\")\nplt.ylabel(\"Annual Income  (k$)\")\nax.set_zlabel('Spending Score (1-100)')\nplt.show()","41a8c9c8":"plt.figure(figsize=(20,10))\nplt.subplot(1,3,1)\nsns.scatterplot(x = 'Annual Income (k$)',y = 'Spending Score (1-100)',hue=\"label\",  \n                 palette='pastel', legend='full',data = data  ,s = 60 )\n\nplt.xlabel('Annual Income (k$)')\nplt.ylabel('Spending Score (1-100)') \nplt.title('Spending Score (1-100) vs Annual Income (k$)')\nplt.subplot(1,3,2)\nsns.scatterplot(x = 'Age',y = 'Spending Score (1-100)',hue=\"label\",  \n                 palette='pastel', legend='full',data = data  ,s = 60 )\nplt.xlabel('Age')\nplt.ylabel('Spending Score (1-100)') \nplt.title('Spending Score (1-100) vs Age')\nplt.subplot(1,3,3)\nsns.scatterplot(x = 'Age',y = 'Annual Income (k$)',hue=\"label\",  \n                 palette='pastel', legend='full',data = data  ,s = 60 )\nplt.xlabel('Age')\nplt.ylabel('Annual Income (k$)') \nplt.title('Annual Income (k$) vs Age')\n\nplt.show()","41ede8af":"grouped = data.groupby(by='label').mean().round(4)","6c48aeb8":"labels = ['Class 0','Class 1','Class 2','Class 3','Class 4','Class 5']\ncolors = ['tab:blue', 'tab:red', 'tab:green', 'tab:orange', 'tab:purple','tab:brown']\nfig = plt.figure(figsize = (15, 5))\n# creating the bar plot\nplt.subplot(1,2,1)\nplt.bar(grouped['Age'].to_dict().keys(), grouped['Age'].values,\n        width = 0.4,color=colors)\nplt.title(\"Average Age in Each Cluster\")\nplt.ylabel(\"Average Age\")\nplt.xlabel(\"Cluster\")\nplt.subplot(1,2,2)\nage = []\nfor i in range(0,6):\n    age.append(data[data['label']==i]['Age'].tolist())\nplt.boxplot(age, vert=False, patch_artist=True, labels=labels) \nplt.ylabel('Clascorees')\nplt.xlabel('Age')\nplt.title('Age in each clascore')  \nplt.show()\n","37a234da":"fig = plt.figure(figsize = (15, 5))\n# creating the bar plot\nplt.subplot(1,2,1)\nplt.bar(grouped['Annual Income (k$)'].to_dict().keys(), grouped['Annual Income (k$)'].values,\n        width = 0.4,color=colors)\nplt.title(\"Average Annual Income (k$) in Each Cluster\")\nplt.ylabel(\"Average Annual Income (k$)\")\nplt.xlabel(\"Cluster\")\nplt.subplot(1,2,2)\nincome = []\nfor i in range(0,6):\n    income.append(data[data['label']==i]['Annual Income (k$)'].tolist())\nplt.boxplot(income, vert=False, patch_artist=True, labels=labels) \nplt.ylabel('Clascorees')\nplt.xlabel('Annual Income (k$)')\nplt.title('Annual Income (k$)')  \n\nplt.show()","1428891f":"fig = plt.figure(figsize = (15, 5))\n# creating the bar plot\nplt.subplot(1,2,1)\nplt.bar(grouped['Spending Score (1-100)'].to_dict().keys(), grouped['Spending Score (1-100)'].values,\n        width = 0.4,color=colors)\nplt.title(\"Average Spending Score (1-100) in Each Cluster\")\nplt.ylabel(\"Spending Score (1-100)\")\nplt.xlabel(\"Cluster\")\nplt.subplot(1,2,2)\nspending = []\nfor i in range(0,6):\n    spending.append(data[data['label']==i]['Spending Score (1-100)'].tolist())\nplt.boxplot(spending, vert=False, patch_artist=True, labels=labels) \nplt.ylabel('Clascorees')\nplt.xlabel('Spending Score (1-100)')\nplt.title('Spending Score (1-100)')  \nplt.show()","77c12d3c":"fig = plt.figure(figsize = (15, 6))\nplt.subplot(1,3,1)\nplt.boxplot(age, vert=False, patch_artist=True, labels=labels) \nplt.ylabel('Clascorees')\nplt.xlabel('Age')\nplt.title('Age in each clascore')  \nplt.subplot(1,3,2)\nplt.boxplot(income, vert=False, patch_artist=True, labels=labels) \nplt.ylabel('Clascorees')\nplt.xlabel('Annual Income (k$)')\nplt.title('Annual Income (k$)') \nplt.subplot(1,3,3)\nplt.boxplot(spending, vert=False, patch_artist=True, labels=labels) \nplt.ylabel('Clascorees')\nplt.xlabel('Spending Score (1-100)')\nplt.title('Spending Score (1-100)')  \nplt.show()\n\n","e8dd7518":"fig = plt.figure(figsize = (15, 6))\nplt.subplot(1,3,1)\nplt.bar(grouped['Age'].to_dict().keys(), grouped['Age'].values,\n        width = 0.4,color=colors)\nplt.title(\"Average Age in Each Cluster\")\nplt.ylabel(\"Average Age\")\nplt.xlabel(\"Cluster\")\nplt.subplot(1,3,2)\nplt.bar(grouped['Annual Income (k$)'].to_dict().keys(), grouped['Annual Income (k$)'].values,\n        width = 0.4,color=colors)\nplt.title(\"Average Annual Income (k$) in Each Cluster\")\nplt.ylabel(\"Average Annual Income (k$)\")\nplt.xlabel(\"Cluster\")\nplt.subplot(1,3,3)\nplt.bar(grouped['Spending Score (1-100)'].to_dict().keys(), grouped['Spending Score (1-100)'].values,\n        width = 0.4,color=colors)\nplt.title(\"Average Spending Score (1-100) in Each Cluster\")\nplt.ylabel(\"Spending Score (1-100)\")\nplt.xlabel(\"Cluster\")\nplt.show()\n\n\n","73be2df1":"There are no miscoreing or NaN values. It's necescoreary to delete the customerID column, because it won't be useful for clustering. It is the same case for the gender column, altough it will be used after the clustering procescore, in order to offer a better analysis of the data.","3efaa8ef":"# Analyzing data, consulting NaN and Null values","2117474f":"# Clustering 3 variables datasets using K-means.\n\n### Mateo Caro","734ff3cb":"# Exploring data using graphs.","06475bb4":"## Class 5\n* People between 45 and 70 years old. With an average of almost 55 years.\n* Spending Score between 30 and 60, with an average of almost 50.\n* Anual Income between 40kusd and 65kusd, with an average of almost 55kusd.\n\nWe can conclude that this class groups old people with a decent annual income, that also have a consistent spending","d7414c36":"# Analyzing Clusters","d96a0cd5":"## Using Silhouette Score and Davies Bouldin","d3a28979":"## Notes\n\n* Taking a deep look in the graphs and according to the analysis made, the class 0 and class 5 can be merged, as they fit the same characteristics, at least in Annual Income and Spending score. The characteristic that allows to differentiate these two groups is the age, being the former the group that has a lower average age and being the latter the group of old people.","936277e0":"# Analysis and conclusions","d998c4e5":"# Future Work\n\n* Analysis including gender of each person.","0734e519":"# Select number of k clusters ","7d173035":"## Class 0\n* People between 18 and 40 years old. With an average of almost 30 years.\n* Spending Score between 25 and 60, with an average of almost 50.\n* Anual Income between 40kusd and 80kusd, with an average of almost 60kusd.\n\nWe can conclude that this class defines young and mid-age people with a decent annual income, that also have a consistent spending. score.","f55e180e":"## Class 4\n* People between 25 and 40 years old. With an average of almost 35 years.\n* Spending Score between 60 and 95, with an average of almost 85.\n* Anual Income between 70kusd and 120kusd, with an average of almost 85kusd.\n\nWe can conclude that this class groups a wide range of people,according to their age,who have a high annual income and who spend a lot.\n","9aec3825":"## Class 2\n* People between 18 and 70 years old. With an average of almost 45 years.\n* Spending Score between 5 and 40, with an average of almost 20.\n* Anual Income between 15kusd and 40kusd, with an average of almost 25kusd.\n\nWe can conclude that this class groups a wide range of people,according to their age, who also have a low annual income and that do not spend much","012ec963":"# Importing data","308422c4":"# References\n\n* https:\/\/www.kaggle.com\/kushal1996\/customer-segmentation-k-means-analysis\n* https:\/\/github.com\/muhammetbektas\/Unsupervised-Learning\/blob\/master\/Segmentation_of_Credit_Card_Users.ipynb\n* https:\/\/github.com\/prateekmaj21\/Mall-Customer-Segementation\/blob\/master\/Customer%20Segmentation%20(Clustering).ipynb","7661dd4c":"## Class 1\n* People between 18 and 35 years old. With an average of almost 25 years.\n* Spending Score between 60 and 100, with an average of almost 80.\n* Anual Income between 15kusd and 40kusd, with an average of almost 25kusd.\n\nWe can conclude that this class defines young,mostly, and mid-age people with a low annual income but who also spend a lot, despite their low annual income.","b7ce28f6":"## Class 3\n* People between 20 and 60 years old. With an average of almost 45 years.\n* Spending Score between 5 and 40, with an average of almost 25.\n* Anual Income between 70kusd and 125kusd, with an average of almost 85kusd.\n\nWe can conclude that this class groups a wide range of people,according to their age, who, despite having a high annual income,they don't spend a lot.\n","09c77675":"# Using K-Means for clustering"}}