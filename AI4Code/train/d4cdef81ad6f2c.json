{"cell_type":{"50279d80":"code","12e2e2bc":"code","206a78cc":"code","1327a33b":"code","bbf16e3c":"code","97f910e7":"code","8f1229ab":"code","93775404":"code","07e6d3bc":"code","2b3ca40c":"code","132c4252":"code","e15eaf57":"code","a9e14a0d":"code","10bc1cf9":"code","c3ae9970":"code","16bba86c":"code","36b70b3a":"code","487c6db4":"code","7b6abd3c":"code","b3112ad2":"code","97bc7edf":"code","392757b6":"code","3a612633":"markdown","d5377ef3":"markdown","d8e022b3":"markdown","e0dee602":"markdown","66f64636":"markdown","9afd9ae3":"markdown","753c661e":"markdown","ad0421b5":"markdown","0228e008":"markdown","f789dac6":"markdown","d85841eb":"markdown","739a1d35":"markdown","6c3166a8":"markdown","8a5d3617":"markdown"},"source":{"50279d80":"import numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\nfrom os import listdir\n\n\nimport plotly.express as px\nimport plotly.graph_objs as go\n\n\nimport pydicom\nimport glob\nimport imageio\nfrom IPython.display import Image\n\n\nimport warnings\nwarnings.filterwarnings('ignore')","12e2e2bc":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    i=0\n    for filename in filenames:\n        i+=1        \n        print(os.path.join(dirname, filename))\nprint(str(i))\n","206a78cc":"len(os.listdir('\/kaggle\/input\/osic-pulmonary-fibrosis-progression\/train\/'))","1327a33b":"list(os.listdir(\"..\/input\/osic-pulmonary-fibrosis-progression\"))","bbf16e3c":"traindf = pd.read_csv(\"..\/input\/osic-pulmonary-fibrosis-progression\/train.csv\")\ntestdf = pd.read_csv(\"..\/input\/osic-pulmonary-fibrosis-progression\/test.csv\")\nsample_submissiondf = pd.read_csv(\"..\/input\/osic-pulmonary-fibrosis-progression\/sample_submission.csv\")","97f910e7":"traindf.describe()","8f1229ab":"traindf.info()","93775404":"testdf.info()","07e6d3bc":"testdf.describe()","2b3ca40c":"traindf.head()","132c4252":"traindf['Patient'].count()","e15eaf57":"patients_with_multiple_data = traindf[\"Patient\"].value_counts()\n\npatients_with_multiple_data.count()\npatients_with_multiple_data.describe()","a9e14a0d":"new_df = traindf.groupby([traindf.Patient,traindf.Age,traindf.Sex, traindf.SmokingStatus])['Patient'].count()\nnew_df.index = new_df.index.set_names(['id','Age','Sex','SmokingStatus'])\nnew_df = new_df.reset_index()\nnew_df.rename(columns = {'Patient': 'freq'},inplace = True)\nnew_df.head(5)","10bc1cf9":"new_df.shape","c3ae9970":"fig = px.bar(new_df, x=\"id\", y=\"freq\", color='freq')\nfig.update_layout(xaxis={'categoryorder':'total ascending'},title='number of data entries for each patient')\nfig.update_xaxes(showticklabels=False)\nfig.show()","16bba86c":"hst = px.histogram(new_df, x='Age', nbins=40, opacity=0.7,title='Age of patients against the number of records', labels={'Age':'Age of patients', 'freq':'Records available for each patient'})\nhst.update_traces(marker_color='rgb(123,125,222)', marker_line_color='rgb(9,4,21)', marker_line_width=1.5)\nhst.show()","36b70b3a":"agehst = px.histogram(new_df, x='Sex')\nagehst.show()","487c6db4":"sexdf = new_df['Sex'].value_counts()\ntotal = new_df.shape[0]\nmale = sexdf['Male']\n\nfemale = sexdf['Female']\nprint('Out of %d patients' % total)\nprint('%.2f percent are male' % (male\/total))\nprint('%.2f percent are females' % (female\/total))","7b6abd3c":"image = '\/kaggle\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00060637202187965290703\/107.dcm'\nds = pydicom.dcmread(image)\nplt.figure(figsize=(12,12))\nplt.imshow(ds.pixel_array, cmap=plt.cm.bone)","b3112ad2":"imgdir = '\/kaggle\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00060637202187965290703\/'\nimg_list = os.listdir(imgdir)\nimg_list.sort()\nlen(img_list)\n\n\nfig=plt.figure(figsize=(15,20))\ncolumns = 5\nrows = 10\n\nfor i in range(1, columns*rows +1):\n    filename = imgdir + \"\/\" + str(i) + \".dcm\"\n    ds = pydicom.dcmread(filename)\n    fig.add_subplot(rows, columns, i)\n    plt.imshow(ds.pixel_array, cmap=plt.cm.bone)","97bc7edf":"def load_scan(path):\n    slices = [pydicom.read_file(path + '\/' + s) for s in os.listdir(path)]\n    slices.sort(key = lambda x: float(x.ImagePositionPatient[2]))\n    try:\n        slice_thickness = np.abs(slices[0].ImagePositionPatient[2] - slices[1].ImagePositionPatient[2])\n    except:\n        slice_thickness = np.abs(slices[0].SliceLocation - slices[1].SliceLocation)\n        \n    for s in slices:\n        s.SliceThickness = slice_thickness\n        \n    return slices\n\n\ndef get_pixels_hu(slices):\n    image = np.stack([s.pixel_array for s in slices])\n    # Convert to int16 (from sometimes int16), \n    # should be possible as values should always be low enough (<32k)\n    image = image.astype(np.int16)\n\n    # Set outside-of-scan pixels to 0\n    # The intercept is usually -1024, so air is approximately 0\n    image[image == -2000] = 0\n    \n    # Convert to Hounsfield units (HU)\n    for slice_number in range(len(slices)):\n        \n        intercept = slices[slice_number].RescaleIntercept\n        slope = slices[slice_number].RescaleSlope\n        \n        if slope != 1:\n            image[slice_number] = slope * image[slice_number].astype(np.float64)\n            image[slice_number] = image[slice_number].astype(np.int16)\n            \n        image[slice_number] += np.int16(intercept)\n    \n    return np.array(image, dtype=np.int16)\n\ndef set_lungwin(img, hu=[-1200., 600.]):\n    lungwin = np.array(hu)\n    newimg = (img-lungwin[0]) \/ (lungwin[1]-lungwin[0])\n    newimg[newimg < 0] = 0\n    newimg[newimg > 1] = 1\n    newimg = (newimg * 255).astype('uint8')\n    return newimg\n","392757b6":"scans = load_scan('..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00060637202187965290703\/')\nscan_array = set_lungwin(get_pixels_hu(scans))\n\n\n\nimageio.mimsave(\"\/tmp\/gif.gif\", scan_array, duration=0.0001)\nImage(filename=\"\/tmp\/gif.gif\", format='png')","3a612633":"This means that there are 176 unique patient ids and the data of 1549 images is from these 176 patients. \nThe maximum number of images corresponding to a single patient is 10 and the minimum is 6. \n\nHence, each patient has between 6 and 10 image files and data files available in the data.","d5377ef3":"Most people in the training data appear to be in the age between 63 to 74","d8e022b3":"The Mininum age of the patients is 49 years and the maximum is 88 years old.\n","e0dee602":"Number of image directories in the folder set. Each directory consists of images of one unique patient. So the unique patients are expected to be 176","66f64636":"# Data Distribution","9afd9ae3":"# The Dicom files\nThe DICOM file or \"Digital Imaging and Communications in Medicine\" format contains an image from a medical scan, like a CT scan + information about the patient.\n\nDICOM is the standard for the medical imaging information and related data. Hence, it is expected that all medical related analyses will include scans in this format.\n","753c661e":"# Looking at a sample image","ad0421b5":"# Sex Distribution","0228e008":"# Showing multiple images of one patient","f789dac6":"Thanks to other notebooks, I have been learning about dicom processing. \n","d85841eb":"# Age Distribution","739a1d35":"# Trying out an animation\nTrying to learn to use animations after having a look at https:\/\/www.kaggle.com\/danpresil1\/dicom-basic-preprocessing-and-visualization and https:\/\/www.kaggle.com\/twinkle0705\/your-starter-notebook-for-osic\nThanks to these works :)","6c3166a8":"Out of 176 patients, 139 are males and 37 are females","8a5d3617":"no missing values seen in the train or test data."}}