{"cell_type":{"b85c97e3":"code","6c9b1619":"code","a17babf4":"code","a2f4ff17":"code","7e8263fc":"code","5da3a837":"code","c7c20baa":"code","330f9d34":"code","05578755":"code","e78460c4":"code","93bf4195":"code","71eea583":"code","34d3e332":"code","936305a3":"code","24a1eeb3":"code","272c2b19":"code","250bfff0":"code","295b1d26":"code","5b1c2b59":"code","b4d84c37":"code","d9688f77":"code","e4792286":"code","7691e833":"code","b72a551d":"code","f8ea0434":"code","e68de22a":"code","d2ff7703":"code","cfab5de1":"code","8f5929c5":"code","e98dabf4":"code","93be19f5":"markdown","69bda49e":"markdown","99605a84":"markdown","35c1fbe7":"markdown","aa2f12b6":"markdown","d877b86b":"markdown","b3a3c99d":"markdown","2e76e5e7":"markdown","524f4f0a":"markdown","9c8289c5":"markdown","f4dc4737":"markdown","043e3bd6":"markdown","fe719d8c":"markdown","cf42e631":"markdown","4c16dd71":"markdown","6e7c7440":"markdown","818f8b9e":"markdown","dce7b53d":"markdown"},"source":{"b85c97e3":"import os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","6c9b1619":"from datetime import datetime\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport statsmodels.api as sm\nimport seaborn as sns\nimport sys, os\nimport warnings\nwarnings.simplefilter(action='ignore')","a17babf4":"# Jalankan kode ini untuk install library\n!pip install pmdarima","a2f4ff17":"import fbprophet\nimport pmdarima as pm\nfrom statsmodels.tsa.statespace.sarimax import SARIMAX","7e8263fc":"train = pd.read_csv(\"..\/input\/bri-data-hackathon-cr-optimization\/train.csv\")\ntrain.head()","5da3a837":"train = train[['periode', 'kas_kantor', 'kas_echannel']]\ntrain.head()","c7c20baa":"# Angka pada kas_kantor paling awal kelihatannya invalid, saya akan impute dari harga sesudahnya saja untuk simplicity\ntrain['kas_kantor'].iloc[0] = train['kas_kantor'].iloc[1]\ntrain.head()","330f9d34":"train['periode'] = pd.to_datetime(train['periode'])\ntrain.set_index(['periode'], inplace=True)\ntrain.head()","05578755":"train['kas_kantor'].plot(title=\"Kas Kantor\", figsize = (14, 4));","e78460c4":"train['kas_echannel'].plot(title=\"Kas e-Channel\", figsize = (14, 4));","93bf4195":"train['kas_kantor'].pct_change().plot(title=\"% Perubahan dari Kas Kantor\", figsize = (14, 4));","71eea583":"train['kas_echannel'].pct_change().plot(title=\"% Perubahan dari Kas e-Channel\", figsize = (14, 4));","34d3e332":"train['kas_kantor'].resample('W').sum().plot(title=\"Kas Kantor - Mingguan\", figsize = (14, 4));","936305a3":"train['kas_echannel'].resample('W').sum().plot(title=\"Kas e-Channel - Mingguan\", figsize = (14, 4));","24a1eeb3":"from statsmodels.graphics.tsaplots import plot_acf, plot_pacf","272c2b19":"acf_plot = plot_acf(train['kas_kantor'], lags=30, title='Autokorelasi pada Kas Kantor')\npacf_plot = plot_pacf(train['kas_kantor'], lags=30, title='Autokorelasi Parsial pada Kas Kantor')","250bfff0":"acf_plot = plot_acf(train['kas_echannel'], lags=30, title='Autokorelasi pada Kas e-Channel')\npacf_plot = plot_pacf(train['kas_echannel'], lags=30, title='Autokorelasi Parsial pada Kas e-Channel')","295b1d26":"sar = sm.tsa.statespace.SARIMAX(train['kas_kantor'], \n                                order=(1,0,0), \n                                seasonal_order=(0,1,1,12), \n                                trend='c').fit()\nsar.summary()","5b1c2b59":"sar.plot_diagnostics(lags=12,figsize = (20,10),);","b4d84c37":"pd.plotting.register_matplotlib_converters()\nsar.get_forecast(31).predicted_mean.plot(title = \"Kas Kantor - Prediksi 31 Hari\",\n                                        figsize=(14, 5));","d9688f77":"stepwise_model = pm.auto_arima(train['kas_kantor'], start_p=1, start_q=1,\n                               max_p=3, max_q=3, m=12,\n                               start_P=0, seasonal=True,\n                               d=0, D=1, trace=True,\n                               error_action='ignore',  \n                               suppress_warnings=True, \n                               stepwise=True)\nprint(stepwise_model.aic())","e4792286":"from datetime import timedelta\n\n# Fungsi untuk membuat dataframe hasil prediksi\ndef future_preds_df(model,series,num_days):\n    pred_first = series.index.max()+timedelta(1)\n    pred_last = series.index.max()+timedelta(num_days)\n    date_range_index = pd.date_range(pred_first,pred_last,freq='D')\n    vals = model.predict(n_periods = num_days)\n    return pd.DataFrame(vals,index = date_range_index)","7691e833":"preds = future_preds_df(stepwise_model,train['kas_kantor'],31)\nplt.figure(figsize=(15,5));\nplt.plot(train['kas_kantor']);\nplt.plot(preds);\nplt.title(\"Data Asli + Prediksi dari Kas Kantor\")","b72a551d":"from fbprophet import Prophet\nplt.rcParams['figure.figsize'] = [15, 4]","f8ea0434":"# Baca ulang data\ntrain = pd.read_csv(\"..\/input\/bri-data-hackathon-cr-optimization\/train.csv\")\n# Ambil kolom yang kita minati saja\ntrain = train[['periode', 'kas_kantor']]\n# Ubah nama kolom\ntrain = train.rename(columns={'periode':'ds',\n                              'kas_kantor':'y'})\ntrain.head()","e68de22a":"m = Prophet()\nm.fit(train)","d2ff7703":"# Melakukan prediksi\nfuture = m.make_future_dataframe(periods=31)\nforecast = m.predict(future)","cfab5de1":"forecast.columns","8f5929c5":"# Plot hasil forecast\nm.plot(forecast);","e98dabf4":"# Plot masing-masing komponen\nm.plot_components(forecast);","93be19f5":"## AutoARIMA","69bda49e":"#### **Banyak uji statistik time-series yang penulis lewatkan karena keterbatasan waktu**\n\nBerikutnya kita akan melakukan forecast menggunakan Prophet\n\n## Prophet","99605a84":"Berikutnya kita akan melakukan pemodelan dengan menggunakan AutoARIMA. Memodelkan secara manual merupakan proses yang iteratif karena kita harus memilih banyak parameter dan melakukan penilaian statistik yang penulis tidak lakukan disini.","35c1fbe7":"## Resampling\n\nDisini kita akan mencoba melakukan resampling data dari harian menjadi mingguan.\n\nKetika kita melakukan resampling, data yang tadinya 7 hari kita ubah menjadi 1 minggu. Ketika data itu diubah, kita bisa jumlahkan atau ambil rata-ratanya.","aa2f12b6":"Hasil prediksi Prophet terdiri dari beberapa komponen seperti rata-rata prediksi, batas atas, batas bawah dan komponen lainnya.","d877b86b":"### Inisialisasi model, fit dan predict","b3a3c99d":"## SARIMA menggunakan Statsmodels","2e76e5e7":"### Forecast untuk 31 hari ke depan (SARIMA)","524f4f0a":"## Data Processing\n\n#### Filter data yang dibutuhkan saja","9c8289c5":"## Plotting\n\nMengapa penting? Selain untuk visualisasi, dalam melakukan prediksi time-series, opsi kita bukan hanya prediksi data mentah saja. **Kita bisa memprediksi dengan data transformasi (percent of changes, log, sqrt).**\n\nData time-series mayoritas adalah kombinasi dari data-data yang lain, misal kita mau memprediksi revenue yang merupakan kombinasi dari harga x jumlah konsumen x faktor tak terduga lainnya. Kita bisa **memprediksi masing-masing komponen lalu digabungkan** atau **memprediksi kombinasinya pada saat bersamaan.**","f4dc4737":"### Autokorelasi\n\nAutokorelasi adalah grafik yang menjelaskan bagaimana data pada hari-H berkorelasi dengan data pada H-1, H-2, dan seterusnya...\n\nAda dua grafik yang umumnya digunakan, ACF dan PACF (Partial ACF). Untuk perbedaannya, silakan cari referensi secara daring.","043e3bd6":"### Untuk sementara, sampai disini dulu ya.\n### Untuk mempelajari Prophet lebih lanjut dan untuk teknik yang lebih advanced, silakan kunjungi laman dari Prophet: https:\/\/facebook.github.io\/prophet\/\n\n#### To-do list:\n1. Advanced Prophet\n2. Hari libur, tanggal penting, dll\n3. Penanganan outlier\n4. Multivariate time-series\n5. Transformasi data\n6. Forecast komponen dari data target","fe719d8c":"### Konversi `periode` menjadi format yang sesuai dan jadikan index dari dataset","cf42e631":"**Halo semuanya :)**\n\nDi notebook kali ini, saya akan menjelaskan secara singkat mengenai konsep time-series serta bagaimana memodelkan time-series menggunakan ARIMA dan Prophet. Kedua teknik ini merupakan teknik yang paling sering diggunakan di time-series dan memiliki hasil yang cukup memuaskan. \n\nPada tutorial ini, saya hanya menggunakan variabel `periode`, `kas_kantor` dan `kas_echannel`. Variabel yang lain **mungkin bermanfaat**, tetapi saya tidak akan menggunakan variabel lain tersebut.\n\nNotebook ini tidak akan terlalu membahas EDA secara mendalam. Untuk EDA, silahkan referensi ke notebook lain.\n\n**Apabila tutorial ini bermanfaat, mohon untuk bantu upvote dan apabila ada pertanyaan silakan ditanyakan, selama penulis mengerti apa yang ditanyakan, nanti akan dijawab**","4c16dd71":"## Loading library dan data yang diperlukan","6e7c7440":"### Kita juga bisa plot persentase dari perubahan data","818f8b9e":"Pada Prophet, data harus dalam format kolom **ds** dan **y**, dimana **ds** adalah kolom yang berisi tanggal dan **y** adalah kolom dari variabel yang kita ingin prediksi.","dce7b53d":"Pada kedua gambar di atas kita lihat bahwa persentase perubahan dari kas kantor sangat fluktuatif di awal, kemudian perlahan-lahan menjadi lebih stasioner. Sedangkan pada persentase perubahan dari kas echannel cenderung lebih konsisten, hanya saja ada nilai pencilan pada sekitar bulan Agustus."}}