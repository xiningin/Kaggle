{"cell_type":{"ed805c63":"code","39756229":"code","b954ab90":"code","5ae268a1":"code","77b0755a":"code","ad949305":"code","20cff557":"code","ebf7056d":"code","1f281c14":"code","7c20a53c":"code","301cd1d0":"code","ffeebd68":"code","94c68b6a":"code","3e12dbd3":"code","4e53150c":"code","7d305ea7":"code","27f32f5f":"code","b9cdfbcd":"code","ef98fb03":"code","96d9c4a9":"code","311b9ed3":"code","a7582ada":"code","d7df887f":"code","4ea0bc9c":"code","ab9e5c2f":"code","eb3e11d2":"code","a8a35cee":"code","d271318e":"code","1c157369":"code","47cce411":"code","38ab577f":"markdown","e180588f":"markdown","caf619fc":"markdown","988fce6e":"markdown","8da46935":"markdown","83504049":"markdown","642399f7":"markdown","7cca214d":"markdown","b1d946dd":"markdown","aace806d":"markdown","8187a701":"markdown","25ab08f9":"markdown","c43d8926":"markdown","62992abc":"markdown","ae1d1eb3":"markdown","eff43ea0":"markdown","b2e327c8":"markdown","238c3fb4":"markdown","61616f6c":"markdown","c3d4efb1":"markdown","2d6a43c6":"markdown","1c473b15":"markdown","68e3489d":"markdown","f1ee9878":"markdown","97cf7949":"markdown","26594534":"markdown","df9f0a23":"markdown","d9de394f":"markdown","b9571f02":"markdown","1e5f732d":"markdown"},"source":{"ed805c63":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.cluster import KMeans\nimport os\n\n        \nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","39756229":"dfPlayers = pd.read_csv('\/kaggle\/input\/fifa-world-cup\/WorldCupPlayers.csv')\ndfMatches = pd.read_csv('\/kaggle\/input\/fifa-world-cup\/WorldCupMatches.csv')\ndfHistory = pd.read_csv('\/kaggle\/input\/fifa-world-cup\/WorldCups.csv')","b954ab90":"dfHistory[\"Attendance\"]=dfHistory[\"Attendance\"].str.replace('.','').astype(int)\n\ndfHistory[\"Winner\"] = dfHistory[\"Winner\"].replace('Germany FR','Germany')\ndfHistory[\"Runners-Up\"] = dfHistory[\"Runners-Up\"].replace('Germany FR','Germany')\ndfHistory[\"Third\"] = dfHistory[\"Third\"].replace('Germany FR','Germany')\ndfHistory[\"Fourth\"] = dfHistory[\"Fourth\"].replace('Germany FR','Germany')\n\ndfMatches[\"Stadium\"] = dfMatches[\"Stadium\"].replace(\"Maracan\ufffd - Est\ufffddio Jornalista M\ufffdrio Filho\",\"Estadio do Maracana\")\ndfMatches[\"Home Team Name\"] = dfMatches[\"Home Team Name\"].replace('Germany FR','Germany')\ndfMatches[\"Home Team Name\"] = dfMatches[\"Home Team Name\"].replace('rn\">','') \ndfMatches[\"Away Team Name\"] = dfMatches[\"Away Team Name\"].replace('Germany FR','Germany')\ndfMatches[\"Away Team Name\"] = dfMatches[\"Away Team Name\"].replace('rn\">','') ","5ae268a1":"dfHistory[\"Winner\"].value_counts().plot(kind = 'bar')","77b0755a":"\ncountries = []\nfor i in [\"Winner\",\"Runners-Up\",\"Third\",\"Fourth\"]:\n    for j in dfHistory[i]:\n        if j not in countries:\n            countries.append(j)\n\nwinner = np.zeros(len(countries))\nsecond = np.zeros(len(countries))\nthird = np.zeros(len(countries))\nfourth = np.zeros(len(countries))\n\nfor i in range(0,len(countries)):\n    for j in range(0,dfHistory.shape[0]):\n        if dfHistory.iloc[j][\"Winner\"] == countries[i]:\n            winner[i]+=1\n        if dfHistory.iloc[j][\"Runners-Up\"] == countries[i]:\n            second[i]+=1\n        if dfHistory.iloc[j][\"Third\"] == countries[i]:\n            third[i]+=1\n        if dfHistory.iloc[j][\"Fourth\"] == countries[i]:\n            fourth[i]+=1    \n","ad949305":"Res = {\"Winner\":winner,\"Second\":second,\"Third\":third,\"Fourth\":fourth}\ndfRes = pd.DataFrame(Res,index = countries)\ndfRes.plot(kind='bar')","20cff557":"col1 = 10*dfRes[\"Winner\"]\ncol2 = 5 *dfRes[\"Second\"]\ncol3 = 3 *dfRes[\"Third\"]\ncol4 = 1 *dfRes[\"Fourth\"]\ndfPoints = col1+col2+col3+col4\ndfPoints.sort_values(ascending=False)","ebf7056d":"dfHistory[dfHistory[\"Country\"]==dfHistory[\"Winner\"]]","1f281c14":"host1 =dfHistory[dfHistory[\"Country\"]==dfHistory[\"Winner\"]].shape[0]\nhost2 =dfHistory[dfHistory[\"Country\"]==dfHistory[\"Runners-Up\"]].shape[0]\nhost3 =dfHistory[dfHistory[\"Country\"]==dfHistory[\"Third\"]].shape[0]\nhost4 =dfHistory[dfHistory[\"Country\"]==dfHistory[\"Fourth\"]].shape[0]\nhost_top4 = host1+host2+host3+host4\nhost = [host1,host2,host3,host4,20-host_top4]","7c20a53c":"plt.figure(figsize=(9,9))\nplt.pie(host,labels=[\"Winner\",\"Runners-Up\",\"Third\",\"Fourth\",\"No top 4\"],startangle=90,autopct='%1.1f%%',colors=['navy','mediumblue','deepskyblue','lightblue','r'])\nplt.title(\"Host on the top 4\")\nplt.show()","301cd1d0":"plt.figure(figsize=(7,7))\nplt.plot(dfHistory.Year,dfHistory.GoalsScored)\nplt.xlabel(\"Year\")\nplt.ylabel(\"Goals\")\nplt.title(\"Total Goals Evolution\")","ffeebd68":"plt.figure(figsize=(7,7))\nplt.plot(dfHistory.Year,dfHistory.GoalsScored\/dfHistory.MatchesPlayed)\nplt.xlabel(\"Year\")\nplt.ylabel(\"Goals per game\")\nplt.title(\"Average Goal per game Evolution\")","94c68b6a":"plt.figure(figsize=(9,9))\nax = plt.figure().add_axes([0,0,1,1])\nax.bar(dfHistory.Year,dfHistory.QualifiedTeams) \nplt.ylabel('Number of teams')\nplt.xlabel('Year')\nplt.title('Number of teams per year')","3e12dbd3":"dfStadium_sum = dfMatches.groupby([\"Stadium\"]).sum().sort_values(by=['Attendance'], ascending=False)\ndfStadium_avg = dfMatches.groupby([\"Stadium\"]).mean().sort_values(by=['Attendance'], ascending=False)\ndfStadium_avg = dfStadium_avg[[\"Attendance\",\"Home Team Goals\",\"Away Team Goals\"]]\ndfStadium_sum = dfStadium_sum[[\"Attendance\",\"Home Team Goals\",\"Away Team Goals\"]]\ndfStadium_c = dfMatches.groupby([\"Stadium\"]).count()[[\"Year\",\"Attendance\"]]\ndfStadium_c = dfStadium_c.rename(columns={'Year': 'Count'})\ndfStadium_avg = dfStadium_avg.rename(columns={'Attendance': 'Attendance_avg', 'Home Team Goals': 'HTG_avg','Away Team Goals': 'ATG_avg'})\ndfStadium_sum = dfStadium_sum.rename(columns={'Attendance': 'Attendance_tot', 'Home Team Goals': 'HTG_tot','Away Team Goals': 'ATG_tot'})\ndfStadiums = pd.concat([dfStadium_sum, dfStadium_avg,dfStadium_c[\"Count\"]], axis=1, sort=False).sort_values(by=['Count'], ascending=False)\ndfStadiums[\"tot_goals\"]=dfStadiums[\"HTG_tot\"]+dfStadiums[\"ATG_tot\"]\ndfStadiums[\"avg_goals\"]=dfStadiums[\"HTG_avg\"]+dfStadiums[\"ATG_avg\"]\n                                                         ","4e53150c":"dfStadiums[dfStadiums[\"Count\"]>4].sort_values(by=['tot_goals'], ascending=False).head(3)","7d305ea7":"dfStadiums[dfStadiums[\"Count\"]>4].sort_values(by=['avg_goals'], ascending=False).head(3)","27f32f5f":"dfStadiums[dfStadiums[\"Count\"]>4].sort_values(by=['avg_goals'], ascending=True).head(3)","b9cdfbcd":"dfStadiums.sort_values(by=['Attendance_avg'], ascending=False).head(3)","ef98fb03":"dfStadiums.sort_values(by=['Attendance_tot'], ascending=False).head(3)","96d9c4a9":"dfMatches_HW =dfMatches[dfMatches[\"Home Team Goals\"]>dfMatches[\"Away Team Goals\"]]\ndfMatches_D =dfMatches[dfMatches[\"Home Team Goals\"]==dfMatches[\"Away Team Goals\"]]\ndfMatches_AW =dfMatches[dfMatches[\"Home Team Goals\"]<dfMatches[\"Away Team Goals\"]]\nAW = dfMatches_AW.count().Year\nHW = dfMatches_HW.count().Year\nD = dfMatches_D.count().Year\ntot_games = AW+HW+D","311b9ed3":"plt.figure(figsize=(9,9))\nplt.pie([HW,AW,D],labels=[\"Home Win\",\"Away Win\",\"Draw\"],startangle=90,autopct='%1.1f%%',colors=['r','g','b'])\nplt.title(\"Repartition of the result of the \"+str(tot_games)+\" games (without penalties)\")\nplt.show()","a7582ada":"a = dfMatches.groupby([\"Away Team Name\",\"Year\"])[\"Away Team Name\"].count()\nh = dfMatches.groupby([\"Home Team Name\",\"Year\"])[\"Home Team Name\"].count()\nal = list(a.index.value_counts().index)\nhl = list(h.index.value_counts().index)\ntot = al + hl\ntot = set(tot)\ncou = {}\nfor i in tot:\n    if (i[0] not in cou):\n        cou[i[0]]=1\n    else:\n        cou[i[0]]+=1\n        \npart = pd.DataFrame.from_dict(cou, orient='index',columns=['Participation'])\n\ndfMatches_HW_c = dfMatches_HW.groupby([\"Home Team Name\"]).count()[[\"Year\",\"Attendance\"]]\ndfMatches_HW_c = dfMatches_HW_c.rename(columns={'Year': 'Home_Win'})\ndfMatches_HL_c = dfMatches_AW.groupby([\"Home Team Name\"]).count()[[\"Year\",\"Attendance\"]]\ndfMatches_HL_c = dfMatches_HL_c.rename(columns={'Year': 'Home_Lost'})\ndfMatches_HD_c = dfMatches_D.groupby([\"Home Team Name\"]).count()[[\"Year\",\"Attendance\"]]\ndfMatches_HD_c = dfMatches_HD_c.rename(columns={'Year': 'Home_Draw'})\ndfMatches_H = pd.concat([dfMatches_HW_c[\"Home_Win\"], dfMatches_HL_c[\"Home_Lost\"],dfMatches_HD_c[\"Home_Draw\"]], axis=1, sort=False).sort_values(by=['Home_Win'], ascending=False)\ndfMatches_H = dfMatches_H.fillna(0)\ndfMatches_H[\"Home_games\"] = dfMatches_H[\"Home_Win\"]+dfMatches_H[\"Home_Lost\"]+dfMatches_H[\"Home_Draw\"]\n\ndfMatches_AW_c = dfMatches_AW.groupby([\"Away Team Name\"]).count()[[\"Year\",\"Attendance\"]]\ndfMatches_AW_c = dfMatches_AW_c.rename(columns={'Year': 'Away_Win'})\ndfMatches_AL_c = dfMatches_HW.groupby([\"Away Team Name\"]).count()[[\"Year\",\"Attendance\"]]\ndfMatches_AL_c = dfMatches_AL_c.rename(columns={'Year': 'Away_Lost'})\ndfMatches_AD_c = dfMatches_D.groupby([\"Away Team Name\"]).count()[[\"Year\",\"Attendance\"]]\ndfMatches_AD_c = dfMatches_AD_c.rename(columns={'Year': 'Away_Draw'})\ndfMatches_A = pd.concat([dfMatches_AW_c[\"Away_Win\"], dfMatches_AL_c[\"Away_Lost\"],dfMatches_AD_c[\"Away_Draw\"]], axis=1, sort=False).sort_values(by=['Away_Win'], ascending=False)\ndfMatches_A = dfMatches_A.fillna(0)\ndfMatches_A[\"Away_games\"] = dfMatches_A[\"Away_Win\"]+dfMatches_A[\"Away_Lost\"]+dfMatches_A[\"Away_Draw\"]\n\ndfMatches_res = pd.concat([dfMatches_H, dfMatches_A], axis=1, sort=False)\ndfMatches_res = dfMatches_res.fillna(0)\ndfMatches_res[\"Tot_Games\"] = dfMatches_res[\"Home_games\"]+dfMatches_res[\"Away_games\"]\ndfMatches_res[\"Tot_Wins\"] = dfMatches_res[\"Away_Win\"]+dfMatches_res[\"Home_Win\"]\ndfMatches_res[\"Tot_Lost\"] = dfMatches_res[\"Away_Lost\"]+dfMatches_res[\"Home_Lost\"]\ndfMatches_res[\"Tot_Draw\"] = dfMatches_res[\"Away_Draw\"]+dfMatches_res[\"Home_Draw\"]\n\n\ndfTeams_A_sum = dfMatches.groupby([\"Away Team Name\"]).sum()[[\"Home Team Goals\",\"Away Team Goals\",\"Attendance\"]]\ndfTeams_A_avg = dfMatches.groupby([\"Away Team Name\"]).mean()[[\"Home Team Goals\",\"Away Team Goals\",\"Attendance\"]]\ndfTeams_A_sum = dfTeams_A_sum.rename(columns={'Home Team Goals': 'Away_conceded_goals_tot', 'Away Team Goals': 'Away_scored_goals_tot','Attendance': 'Away_Attendance_tot'})\ndfTeams_A_avg = dfTeams_A_avg.rename(columns={'Home Team Goals': 'Away_conceded_goals_avg', 'Away Team Goals': 'Away_scored_goals_avg','Attendance': 'Away_Attendance_avg'})\ndfTeams_A_c = dfMatches.groupby([\"Away Team Name\"]).count()[[\"Year\",\"Attendance\"]]\ndfTeams_A_c = dfTeams_A_c.rename(columns={'Year': 'Away_Games'})\ndfTeams_H_sum = dfMatches.groupby([\"Home Team Name\"]).sum()[[\"Home Team Goals\",\"Away Team Goals\",\"Attendance\"]]\ndfTeams_H_avg = dfMatches.groupby([\"Home Team Name\"]).mean()[[\"Home Team Goals\",\"Away Team Goals\",\"Attendance\"]]\ndfTeams_H_sum = dfTeams_H_sum.rename(columns={'Home Team Goals': 'Home_scored_goals_tot', 'Away Team Goals': 'Home_conceded_goals_tot','Attendance': 'Home_Attendance_tot'})\ndfTeams_H_avg = dfTeams_H_avg.rename(columns={'Home Team Goals': 'Home_scored_goals_avg', 'Away Team Goals': 'Home_conceded_goals_avg','Attendance': 'Home_Attendance_avg'})\ndfTeams_H_c = dfMatches.groupby([\"Home Team Name\"]).count()[[\"Year\",\"Attendance\"]]\ndfTeams_H_c = dfTeams_H_c.rename(columns={'Year': 'Home_Games'})\ndfTeams_A = pd.concat([dfTeams_A_sum, dfTeams_A_avg,dfTeams_A_c[\"Away_Games\"]], axis=1, sort=False).sort_values(by=['Away_Games'], ascending=False)\ndfTeams_H = pd.concat([dfTeams_H_sum, dfTeams_H_avg,dfTeams_H_c[\"Home_Games\"]], axis=1, sort=False).sort_values(by=['Home_Games'], ascending=False)\ndfTeams = pd.concat([dfTeams_H, dfTeams_A,], axis=1, sort=False)\ndfTeams = dfTeams.fillna(0)\n\n\n\ndfTeamsWC = pd.concat([dfTeams, dfMatches_res,part,dfRes], axis=1, sort=False)\ndfTeamsWC = dfTeamsWC.fillna(0)\ndfTeamsWC = dfTeamsWC.drop(columns=[\"Home_games\",\"Away_games\"])","d7df887f":"home_p = (dfTeamsWC[\"Home_Games\"]\/dfTeamsWC[\"Tot_Games\"])*dfTeamsWC[\"Tot_Wins\"]\naway_p = (dfTeamsWC[\"Away_Games\"]\/dfTeamsWC[\"Tot_Games\"])*dfTeamsWC[\"Tot_Wins\"]\nind = np.arange(82)\nfig = plt.subplots(figsize =(20, 7)) \np1 = plt.bar(ind, home_p) \np2 = plt.bar(ind, away_p, bottom = home_p)  \nplt.ylabel('Wins')\nplt.xticks(ind, dfTeamsWC.index,rotation=90)\nplt.legend((p1[0], p2[0]), ('Home Games', 'Away Games'))\nplt.show()","4ea0bc9c":"dfTeamsWC[dfTeamsWC[\"Home_Games\"]==0][[\"Home_Games\",\"Tot_Wins\",\"Tot_Games\"]]","ab9e5c2f":"dfTeamsWC[\"Participation\"].sort_values(ascending=False).head(10)","eb3e11d2":"kmeans = KMeans(n_clusters=4, random_state=0)\nX = dfTeamsWC[[\"Home_Games\",\"Away_Games\",\"Tot_Wins\",\"Tot_Lost\",\"Tot_Draw\",\"Tot_Games\",\"Participation\",\"Winner\",\"Second\",\"Third\",\"Fourth\"]]\nkmeans.fit(X)\nX[\"Team_Category\"]=kmeans.labels_\nX = X.sort_values(by=[\"Team_Category\"],ascending=False)\nX[\"Team_Category\"] = X[\"Team_Category\"].replace(3,'GroupC')\nX[\"Team_Category\"] = X[\"Team_Category\"].replace(1,'GroupB')\nX[\"Team_Category\"] = X[\"Team_Category\"].replace(2,'GroupA')\nX[\"Team_Category\"] = X[\"Team_Category\"].replace(0,'GroupD')","a8a35cee":"X[X[\"Team_Category\"]==\"GroupA\"][[\"Tot_Games\",\"Participation\",\"Tot_Wins\",\"Winner\",\"Second\",\"Third\",\"Team_Category\"]]","d271318e":"X[X[\"Team_Category\"]==\"GroupB\"][[\"Tot_Games\",\"Participation\",\"Tot_Wins\",\"Winner\",\"Second\",\"Third\",\"Team_Category\"]]","1c157369":"X[X[\"Team_Category\"]==\"GroupC\"][[\"Tot_Games\",\"Participation\",\"Tot_Wins\",\"Winner\",\"Second\",\"Third\",\"Team_Category\"]]","47cce411":"X[X[\"Team_Category\"]==\"GroupD\"][[\"Tot_Games\",\"Participation\",\"Tot_Wins\",\"Winner\",\"Second\",\"Third\",\"Team_Category\"]].tail(15)","38ab577f":"Wich are the teams that have participated to the must world cups ?","e180588f":"Clustering the teams","caf619fc":"In this graph we can see that the number of teams in the world cup has increased since the creation. More teams means more games, and more games inmplies more total goals. We can see 3 steps on this histogram, starting at 1954, 1982 and 1998. This explain why we have 3 maximums on the total goals graph on those dates.","988fce6e":"This bar plot show us that teams that there is an uneven repartition of home and away games. We can see that FIFA designate more often as home team, the teams that win the most, so the bests teams. The teams that can be considered as 'little teams' play most of their games as away teams. This explain why home teams have more teams.","8da46935":"**Is there an influence between hosting the world cup and making a good result (top 4)?**","83504049":"For exemple we can see that 5 teams in the World Cup History have never played as a home team. The most flagrant exemple is El Salvador who has played 6 games, all as an away team and all losses.","642399f7":"As we can see the number of goals per game is generally decreasing since the creation of the world cup. Before 1960, there were between 4 and 5 goals a game. But since then, the game stabilazed ans nowadays there is only between 2 and 3 goals per game. This can be explainend with the next graph.","7cca214d":"**In which stadiums do we see the more goals ?** (We only consider stadiums with more than 4 games played in)","b1d946dd":"Not very clear for team comparison. We decided to rank them.\nThe winner get 10 points, second 5, third 3 and fourth 1.","aace806d":"**Information through years**","8187a701":"We represent the top 4 results for each team.","25ab08f9":"# **Fifa World Cup Analysis (before 2018)**","c43d8926":"# Teams analysis","62992abc":"6 teams won the world cup while they were hosting it. It represents 6 out of 20, so 30% of the teams that host the world cup win it.","ae1d1eb3":"In this pie chart we can see that 60% of the teams that host the world cup make a good result, 30% win it and only 40% doesn't make it to the semifinals.","eff43ea0":"Data importation","b2e327c8":"We obtained 4 clusters. It goes from GroupA to Group D, A being the best and D the worst.","238c3fb4":"The number of goals is increasing since the creation of the world cup. But this doesn't mean that the game is getting more offensive and the teams attack more and score more goals.","61616f6c":"# Stadium analysis","c3d4efb1":"**Wich are the most visited stadiums ?**","2d6a43c6":"# Analysis of games","1c473b15":"**How many times a country have won the World Cup ?**","68e3489d":"We can see that most of the time the designated home team wins the game. This doesn't really make sense because there all play away (except the host).","f1ee9878":"The Estadio Azteca is the stadium with more goals in the world cup history, but also the one with the most games played in. ","97cf7949":"The stadium were there are the more goals per game is the St. Jakob stadium with more than 7 goals. The three stadiums with the most goals per game are Swiss stadiums.","26594534":"**Which are the teams that perform the best in the World Cup ?**","df9f0a23":"Data preparation","d9de394f":"# General analysis of the World Cup","b9571f02":"On the other hand, the stadium with the worst goal scoring average is the Waldstadion, in Germany","1e5f732d":"On average the most visited stadium is the Estadio Azteca with more than 100 000 spectators per game, and it  is also the most visited stadium with almost 2M spectators. The Maracana has also 1M5 spectators. Again thoses are the stadiums with the most games played in. "}}