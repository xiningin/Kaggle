{"cell_type":{"d54ca912":"code","3eeef4c5":"code","c64effd8":"code","cb5b6023":"code","7dbf1758":"code","2584b1d7":"code","09710941":"code","4d3e38a7":"code","c768fc68":"code","131cc849":"code","fbe20dea":"code","99ae1214":"code","8e1e8c3f":"code","8f4a344f":"code","8106deeb":"code","6e5e170a":"code","88ed0526":"code","872d62e6":"code","7ad1e569":"code","d994290f":"code","af3cc079":"code","d4550133":"code","6b1af2c6":"code","3746d01c":"code","a9cd0135":"code","61e3741f":"code","95c1b697":"code","385e65dc":"code","840c0cf2":"code","2b78c3fd":"code","8de90085":"code","a055862e":"code","036d8c55":"code","2ed8cb6d":"code","4cccb074":"code","08e35ef2":"code","0ee91a80":"code","ca4b178a":"code","7a56edc8":"code","dacb7807":"code","0b2d469e":"code","b2cf48a8":"code","38883ab2":"code","f2300c10":"code","fef7ec67":"code","1fd25007":"code","5f526d37":"code","bc808420":"code","640c77d6":"code","b0b9351c":"code","e97fb894":"code","a70a9c4d":"code","ac50b452":"code","f86942db":"code","74acba6a":"code","ca6cbb20":"code","2c3babea":"code","9d6639f6":"code","aa6888ca":"code","63f23d00":"code","0132751b":"code","57dbddc8":"code","231062ba":"code","24c0ebe9":"code","a2c4a047":"code","1ac24b37":"code","2a6c7429":"code","9a11995b":"code","df6050ea":"code","d9a7235b":"code","fa5fc381":"code","cf28dd7a":"code","44d2e18f":"code","4368abc8":"code","50b7c9f4":"code","e0b851a7":"code","e5dc9176":"code","2a62ca0a":"code","515569dc":"code","1185a6ae":"code","df3a8062":"code","21b8a816":"code","dec74550":"markdown","7a1caefd":"markdown","730188bb":"markdown","913abbfd":"markdown","9a9268a0":"markdown","00a49e77":"markdown","0b789a84":"markdown","9802408e":"markdown","78614a85":"markdown","98771412":"markdown","44c811cc":"markdown","29a22b64":"markdown","d20ec611":"markdown","c4af6c72":"markdown","75994338":"markdown","a2be6e2a":"markdown","767c731a":"markdown","2bd0ad22":"markdown","a692b7ff":"markdown","19fc48c4":"markdown","b7e0d4f9":"markdown","d4735491":"markdown"},"source":{"d54ca912":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","3eeef4c5":"import matplotlib.pyplot as plt\nplt.rcParams[\"figure.figsize\"]=50,50\nplt.rcParams.update({'figure.max_open_warning': 0})\n%matplotlib inline","c64effd8":"from sklearn_pandas import CategoricalImputer\nfrom sklearn import preprocessing \nfrom sklearn.preprocessing import Imputer","cb5b6023":"import seaborn as sns\ncolor = sns.color_palette()","7dbf1758":"#Datatypes definition\ndtypes = {\n        'MachineIdentifier':                                    'str',\n        'ProductName':                                          'category',\n        'EngineVersion':                                        'category',\n        'AppVersion':                                           'category',\n        'AvSigVersion':                                         'category',\n        'IsBeta':                                               'int8',\n        'RtpStateBitfield':                                     'float16',\n        'IsSxsPassiveMode':                                     'int8',\n        'DefaultBrowsersIdentifier':                            'float16',\n        'AVProductStatesIdentifier':                            'float32',\n        'AVProductsInstalled':                                  'float16',\n        'AVProductsEnabled':                                    'float16',\n        'HasTpm':                                               'int8',\n        'CountryIdentifier':                                    'int16',\n        'CityIdentifier':                                       'float32',\n        'OrganizationIdentifier':                               'float16',\n        'GeoNameIdentifier':                                    'float16',\n        'LocaleEnglishNameIdentifier':                          'int8',\n        'Platform':                                             'category',\n        'Processor':                                            'category',\n        'OsVer':                                                'category',\n        'OsBuild':                                              'int16',\n        'OsSuite':                                              'int16',\n        'OsPlatformSubRelease':                                 'category',\n        'OsBuildLab':                                           'category',\n        'SkuEdition':                                           'category',\n        'IsProtected':                                          'float16',\n        'AutoSampleOptIn':                                      'int8',\n        'PuaMode':                                              'category',\n        'SMode':                                                'float16',\n        'IeVerIdentifier':                                      'float16',\n        'SmartScreen':                                          'category',\n        'Firewall':                                             'float16',\n        'UacLuaenable':                                         'float32',\n        'Census_MDC2FormFactor':                                'category',\n        'Census_DeviceFamily':                                  'category',\n        'Census_OEMNameIdentifier':                             'float16',\n        'Census_OEMModelIdentifier':                            'float32',\n        'Census_ProcessorCoreCount':                            'float16',\n        'Census_ProcessorManufacturerIdentifier':               'float16',\n        'Census_ProcessorModelIdentifier':                      'float16',\n        'Census_ProcessorClass':                                'category',\n        'Census_PrimaryDiskTotalCapacity':                      'float32',\n        'Census_PrimaryDiskTypeName':                           'category',\n        'Census_SystemVolumeTotalCapacity':                     'float32',\n        'Census_HasOpticalDiskDrive':                           'int8',\n        'Census_TotalPhysicalRAM':                              'float32',\n        'Census_ChassisTypeName':                               'category',\n        'Census_InternalPrimaryDiagonalDisplaySizeInInches':    'float16',\n        'Census_InternalPrimaryDisplayResolutionHorizontal':    'float16',\n        'Census_InternalPrimaryDisplayResolutionVertical':      'float16',\n        'Census_PowerPlatformRoleName':                         'category',\n        'Census_InternalBatteryType':                           'category',\n        'Census_InternalBatteryNumberOfCharges':                'float32',\n        'Census_OSVersion':                                     'category',\n        'Census_OSArchitecture':                                'category',\n        'Census_OSBranch':                                      'category',\n        'Census_OSBuildNumber':                                 'int16',\n        'Census_OSBuildRevision':                               'int32',\n        'Census_OSEdition':                                     'category',\n        'Census_OSSkuName':                                     'category',\n        'Census_OSInstallTypeName':                             'category',\n        'Census_OSInstallLanguageIdentifier':                   'float16',\n        'Census_OSUILocaleIdentifier':                          'int16',\n        'Census_OSWUAutoUpdateOptionsName':                     'category',\n        'Census_IsPortableOperatingSystem':                     'int8',\n        'Census_GenuineStateName':                              'category',\n        'Census_ActivationChannel':                             'category',\n        'Census_IsFlightingInternal':                           'float16',\n        'Census_IsFlightsDisabled':                             'float16',\n        'Census_FlightRing':                                    'category',\n        'Census_ThresholdOptIn':                                'float16',\n        'Census_FirmwareManufacturerIdentifier':                'float16',\n        'Census_FirmwareVersionIdentifier':                     'float32',\n        'Census_IsSecureBootEnabled':                           'int8',\n        'Census_IsWIMBootEnabled':                              'float16',\n        'Census_IsVirtualDevice':                               'float16',\n        'Census_IsTouchEnabled':                                'int8',\n        'Census_IsPenCapable':                                  'int8',\n        'Census_IsAlwaysOnAlwaysConnectedCapable':              'float16',\n        'Wdft_IsGamer':                                         'float16',\n        'Wdft_RegionIdentifier':                                'float16',\n        'HasDetections':                                        'int8'\n        }","2584b1d7":"#Data reading using dask\nimport dask\nimport dask.dataframe as dd\ntrain_data = dd.read_csv('..\/input\/train.csv', dtype=dtypes)\ntest_data = dd.read_csv('..\/input\/test.csv', dtype=dtypes)","09710941":"train_data.head(5)","4d3e38a7":"test_data.head(5)","c768fc68":"train_data = train_data.compute()  \ntest_data = test_data.compute()","131cc849":"print(train_data.shape)\nprint(test_data.shape)","fbe20dea":"submit_df = test_data[['MachineIdentifier']]","99ae1214":"#missing data\ndef display_missing_data(df):\n    total = df.isnull().sum().sort_values(ascending=False)\n    percent = (df.isnull().sum()\/df.isnull().count()).sort_values(ascending=False)\n    missing_data = pd.concat([total, percent], axis=1, keys=['Total', 'Percent'])\n    print(missing_data.head(40))","8e1e8c3f":"display_missing_data(train_data)","8f4a344f":"display_missing_data(test_data)","8106deeb":"train_data.set_index('MachineIdentifier', inplace=True)","6e5e170a":"cols_drop =['PuaMode','Census_ProcessorClass','DefaultBrowsersIdentifier','Census_IsFlightingInternal',\n            'Census_InternalBatteryType','Census_ThresholdOptIn','Census_IsWIMBootEnabled']","88ed0526":"def drop_missing_value_columns():\n    train_data.drop(cols_drop, axis=1,inplace=True)\n    test_data.drop(cols_drop, axis=1,inplace=True)","872d62e6":"drop_missing_value_columns()","7ad1e569":"\ntrain_data['Census_ProcessorCoreCount'] = train_data['Census_ProcessorCoreCount'].fillna(0).apply(np.int8)","d994290f":"train_data['Census_TotalPhysicalRAM'] = train_data['Census_TotalPhysicalRAM'].fillna(0).apply(np.int32)","af3cc079":"train_data_continuous = train_data.select_dtypes([np.int8,np.int16,np.int32,np.float16,np.float32])","d4550133":"def unique_category_count(colname):\n    print(train_data[colname].nunique()) ","6b1af2c6":"def populate_missing_category_values(colname):\n    cat_imputer = CategoricalImputer()\n    train_data[colname]= cat_imputer.fit_transform(train_data[colname]).ravel()\n    test_data[colname]= cat_imputer.fit_transform(test_data[colname]).ravel()","3746d01c":"def label_encode_category_values(colname):\n    lbl_encoder = preprocessing.LabelEncoder()\n    train_data[colname] = lbl_encoder.fit_transform(train_data[colname].astype(str))\n    test_data[colname] = lbl_encoder.fit_transform(test_data[colname].astype(str))","a9cd0135":"def calculate_corr_value(colname):\n    corr_val = train_data['HasDetections'].corr(train_data[colname])\n    print('The correlation between HasDetections variable and '+ colname +':'+ str(corr_val))","61e3741f":"def populate_missing_numerical_values(colname):\n    imputer = Imputer(strategy = 'median')\n    train_data[colname]= imputer.fit_transform(train_data[[colname]]).ravel()\n    test_data[colname]= imputer.fit_transform(test_data[[colname]]).ravel()\n    ","95c1b697":"def drop_column(colname):\n    train_data.drop(colname, axis=1,inplace=True)\n    test_data.drop(colname, axis=1,inplace=True)","385e65dc":"def draw_histogram(colname):\n    train_data[colname].hist()","840c0cf2":"def draw_category_histogram(colname):\n    train_data[colname].value_counts(sort=False).sort_values(ascending=False).nlargest(50).plot(kind='bar', figsize=[20,10],title=col)","2b78c3fd":"def display_valuecount_bytarget_variable(colname):\n    train_data.groupby(['HasDetections',colname])[colname].count()","8de90085":"def draw_box_plot(colname):\n    train_data.boxplot(column=colname)","a055862e":"def describe_numeric_data(colname):\n    train_data[colname].describe()","036d8c55":"def outliers_iqr(colname):\n        print(colname)\n        Q1 = train_data[colname].quantile(0.25)\n        Q3 = train_data[colname].quantile(0.75)\n        print(Q1)\n        print(Q3)\n        IQR = Q3 - Q1\n        print(IQR)\n        df_clean = train_data[(train_data[colname] < (Q1 - 1.5 * IQR)) | (train_data[colname] > (Q3 + 1.5 * IQR))]\n        return df_clean.shape[0]","2ed8cb6d":"def draw_values_distribution_plot(colname):\n    plt.figure(figsize=(8,4))\n    sns.violinplot(x=train_data[colname], y=train_data['HasDetections'], data=train_data)\n    plt.ylabel(colname, fontsize=12)\n    plt.xlabel('HasDetections', fontsize=12)\n    plt.title(colname+\" distribution\")\n    plt.show()","4cccb074":"train_data_continuous = train_data.select_dtypes([np.int8,np.int16,np.int32,np.float16,np.float32])\ncorr_low_value_variables =[]\ncorr_high_value_variables =[]\ncorr_low_value_df=[]\ncorr_high_value_df=[]\nfor i, col in enumerate(train_data_continuous.columns):\n    #print(train_data.groupby(['HasDetections',col])[col].count())\n    corr_val = train_data['HasDetections'].corr(train_data[col])\n    if(corr_val > 0.05  or corr_val < -0.05):\n        print(col)\n        corr_high_value_variables.append(col)\n        corr_high_value_df.append((col ,corr_val))\n    else:\n        print('correlating with target variable is very less for variable name: '+ col)\n        corr_low_value_variables.append(col)\n        corr_low_value_df.append((col,corr_val))\n    ","08e35ef2":"corr_low_Values_df= pd.DataFrame(corr_low_value_df, columns=('Variable Name','Corr value'))\ncorr_low_Values_df","0ee91a80":"corr_high_value_df =pd.DataFrame(corr_high_value_df, columns=('Variable Name','Corr value'))\ncorr_high_value_df","ca4b178a":"print(corr_low_value_variables)","7a56edc8":"print(corr_high_value_variables)","dacb7807":"for i, col in enumerate(corr_high_value_variables):\n    plt.figure(i)\n    train_data.boxplot(column=col)\n","0b2d469e":"draw_box_plot('AVProductStatesIdentifier')","b2cf48a8":"draw_box_plot('AVProductsInstalled')","38883ab2":"draw_box_plot('IsProtected')","f2300c10":"draw_box_plot('Census_IsVirtualDevice')","fef7ec67":"draw_box_plot('Census_IsAlwaysOnAlwaysConnectedCapable')","1fd25007":"draw_box_plot('Wdft_IsGamer')","5f526d37":"describe_numeric_data('AVProductStatesIdentifier')","bc808420":"display_valuecount_bytarget_variable('AVProductStatesIdentifier')","640c77d6":"draw_histogram('AVProductStatesIdentifier')","b0b9351c":"outliers_iqr('AVProductStatesIdentifier')","e97fb894":"train_data_cat = train_data.select_dtypes(['category'])","a70a9c4d":"train_data_cat.columns","ac50b452":"draw_category_histogram('ProductName')","f86942db":"draw_category_histogram('EngineVersion')","74acba6a":"draw_category_histogram('AppVersion')","ca6cbb20":"draw_category_histogram('AvSigVersion')","2c3babea":"draw_category_histogram('Platform')","9d6639f6":"draw_category_histogram('Processor')","aa6888ca":"train_data['Census_ChassisTypeName'].unique() ","63f23d00":"for i, col in enumerate(train_data_cat.columns):\n    print('The number of category values for the column : '+ col+ ' - '+str(len(list(train_data[col].unique()))))\n    ","0132751b":"train_data['ProductName'].value_counts(sort=False).sort_values(ascending=False)","57dbddc8":"train_data['Platform'].value_counts(sort=False).sort_values(ascending=False)","231062ba":"train_data['Processor'].value_counts(sort=False).sort_values(ascending=False) ","24c0ebe9":"\ncorr_low_value_cat_variables =[]\ncorr_high_value_cat_variables =[]\ncorr_low_value_cat_df=[]\ncorr_high_value_cat_df=[]\nfrom sklearn.preprocessing import LabelEncoder\nfor i, col in enumerate(train_data_cat.columns):\n    lbl_encoder = LabelEncoder()\n   \n    #if(col in ('OsBuildLab ','SmartScreen','Census_PrimaryDiskTypeName')):\n    train_data[col] = lbl_encoder.fit_transform(train_data[col].astype(str))\n    test_data[col] = lbl_encoder.fit_transform(test_data[col].astype(str))\n    #else:\n      #  train_data_encoded[col] = lbl_encoder.fit_transform(train_data_encoded[col])\n    corr_val = train_data['HasDetections'].corr(train_data[col])\n    print(corr_val)\n    if(corr_val > 0.05  or corr_val < -0.05):\n        print(col)\n        corr_high_value_cat_variables.append(col)\n        corr_high_value_cat_df.append((col ,corr_val))\n    else:\n        print('correlating with target variable is very less for variable name: '+ col)\n        corr_low_value_cat_variables.append(col)\n        corr_low_value_cat_df.append((col,corr_val))","a2c4a047":"corr_low_value_cat_df =pd.DataFrame(corr_low_value_cat_df, columns=('Variable Name','Corr value'))\ncorr_low_value_cat_df","1ac24b37":"corr_high_value_cat_df = pd.DataFrame(corr_high_value_cat_df, columns=('Variable Name','Corr value'))\ncorr_high_value_cat_df","2a6c7429":"train_data.head()","9a11995b":"test_data.set_index('MachineIdentifier', inplace=True)","df6050ea":"train_data_labels = train_data['HasDetections']","d9a7235b":"selected_columns =['EngineVersion','AvSigVersion','Processor','SmartScreen',\n                                       'Census_OSArchitecture','AVProductStatesIdentifier','AVProductsInstalled','IsProtected',\n                                       'Census_IsVirtualDevice','Census_IsAlwaysOnAlwaysConnectedCapable','Wdft_IsGamer']","fa5fc381":"train_data = train_data[selected_columns]","cf28dd7a":"test_data = test_data[selected_columns]","44d2e18f":"test_data.head()","4368abc8":"train_data.head()","50b7c9f4":"from sklearn.preprocessing import MinMaxScaler, Imputer\nimputer = Imputer(strategy = 'median')\nimputer.fit(train_data)\nimputer.fit(test_data)\ntrain_data = imputer.transform(train_data)\ntest_data =imputer.transform(test_data)\n","e0b851a7":"type(train_data)","e5dc9176":"from sklearn.linear_model import LogisticRegression\n\n# Make the model with the specified regularization parameter\nlog_reg = LogisticRegression(C = 0.0001)\n\n# Train on the training data\nlog_reg.fit(train_data, train_data_labels)","2a62ca0a":"log_reg_pred = log_reg.predict_proba(test_data)[:, 1]","515569dc":"log_reg_pred.shape","1185a6ae":"submit_df['HasDetections'] = log_reg_pred","df3a8062":"submit_df.head()","21b8a816":"submit_df.to_csv('submission.csv', index=False)","dec74550":"*The below method will populate the missing values in category column with most frequent value*","7a1caefd":"**Exploratory Data Analysis**","730188bb":"**Test Data Transformation**\n\n*Test data will be transformed as per input training data and predict the output*","913abbfd":"*The correlation is negligible   and also the response variable percentaget for 1 value is  very low . So, we will not conside this value in our model*","9a9268a0":"**Category variable  Analysis**","00a49e77":"1. Histogram of variable\n2. Find out whether is it right data type . It can be converted to int or bool based on the values\n3. Check the boxplot and find out if there are any outliers\n4. There are numeric variables which can be converted to category and then to label encoding\n5. populate missing values\n6. Draw historgram \n7. Calculate the correlation and decide whether to consider in the model or not\n8. Convert data type\n","0b789a84":"*Find out the unique category value count for each category column *","9802408e":"1. The number of unique values in the column (no of categories)\n2. Adding comment on missing values \n3. Draw histogram with value counts and also diplay the value counts of each category and target variable\n4. populate missing values\n5. Draw historgram with value counts and also diplay the value counts of each category and target variable\n6. Calculate the correlation and decide whether to consider in the model or not\n7. if yes , find out the distribution of each category and add inference comment.\n8. if the values are very less , decide on binary , multiple category or one hot encoding","78614a85":"**Missing Data**","98771412":"*Check the each data type of column  and convert the date type to a category or int *","44c811cc":"*The below method will populate the missing values in column with median value*","29a22b64":"*There are high cardinal category columns and we need to convert to numeric values by ordinal encoding.*","d20ec611":"*The below method will encode the category values with number *","c4af6c72":"**Model Training**","75994338":"*The below mehtod will get the unique category column count*","a2be6e2a":"*The variables with high value correlation are *","767c731a":"**Continuous  Variable Analysis**","2bd0ad22":"**Loading Data**","a692b7ff":"*We will find the number of outliers for the above variables*","19fc48c4":"*The variables with low value correlation are *","b7e0d4f9":"*We have outliers for the variables AVProductStatesIdentifier, Census_ProcessorCoreCount, Census_TotalPhysicalRAM*","d4735491":"*We will draw box plots to identify if there are any outliers*"}}