{"cell_type":{"4e0b0203":"code","71dc3156":"code","b85448cc":"code","5c4f6242":"code","be36aaa9":"code","fe55decd":"code","39f6242f":"code","ffcf5f46":"code","d4e47f08":"code","9411f5b1":"code","334b1215":"code","e24fd52f":"code","f7b9b2f3":"code","ee4d7311":"markdown","7b7c6e88":"markdown","914abdae":"markdown","a8c39613":"markdown","824430d9":"markdown","70df9b6e":"markdown","70617b6e":"markdown","1ee00712":"markdown","a194f462":"markdown","1f8eae70":"markdown"},"source":{"4e0b0203":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport plotly.graph_objs as go\nfrom plotly.offline import init_notebook_mode, iplot, plot\nimport plotly as py\ninit_notebook_mode(connected=True)\n\nimport ipywidgets as widgets\nfrom IPython.display import clear_output\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","71dc3156":"data_df = pd.read_csv('\/kaggle\/input\/novel-corona-virus-2019-dataset\/2019_nCoV_data.csv')","b85448cc":"# convert to datetime\ndata_df['Last Update'] = pd.to_datetime(data_df['Last Update'])\n# map Mainland China to China\ndata_df['Country'] = data_df['Country'].replace('Mainland China', 'China')","5c4f6242":"for column in data_df.columns:\n    print(f'{column}: {data_df[column].dtype}')\n    print(f'\\tUnique Values:{data_df[column].nunique()}')\n    print(f'\\tNormalized Unique Values:{data_df[column].nunique()\/data_df.shape[0]: .4f}')\n    print(f'\\tMissing:{data_df[column].isna().sum()}')","be36aaa9":"# fill missing values\ndata_df['Province\/State'] = data_df['Province\/State'].fillna('NA')\ndata_df['Full Location'] = data_df['Country'] + '_' + data_df['Province\/State']","fe55decd":"# Vis\ndef plot_trend(df, y_feature, loc_feature='Country', loc='All', freq='Daily'):\n    df = df.copy()\n    # filter by Location\n    if loc == 'All':\n        df = df.sort_values('Last Update').reset_index(drop=True)\n    else:\n        df = df[df[loc_feature] == loc].sort_values('Last Update').reset_index(drop=True)\n    # group by freq\n    df.index = df['Last Update']\n    if freq == 'Daily':\n        df = df.groupby(pd.Grouper(freq='D'))[y_feature].sum().reset_index()\n    elif freq == 'Hourly':\n        df = df.groupby(pd.Grouper(freq='H'))[y_feature].sum().reset_index()\n        \n    trace1 = go.Scatter(\n                        x = df['Last Update'],\n                        y = df[y_feature],\n                        mode = \"lines\",\n                        marker = dict(color = 'rgba(16, 112, 2, 0.8)'))\n\n    traces = [trace1]\n    layout = dict(title = f'[{y_feature}] {freq}',\n                  xaxis= dict(title='Date',ticklen= 5,zeroline= False)\n                 )\n    fig = dict(data=traces, layout = layout)\n    iplot(fig)\n\n# UI\ncountry_dropdown_1 = widgets.Dropdown(\n    options=data_df['Country'].unique().tolist() + ['All'],\n    value='All',\n    description='Country:',\n    disabled=False,\n)\n\ny_dropdown_1 = widgets.Dropdown(\n    options=['Confirmed', 'Deaths', 'Recovered'],\n    value='Confirmed',\n    description='Stats:',\n    disabled=False,\n)\n\ndef on_value_change(change):\n    clear_output()\n    display(country_dropdown_1, y_dropdown_1)\n    plot_trend(data_df, y_feature=y_dropdown_1.value, loc=country_dropdown_1.value, freq='Daily')\n\ncountry_dropdown_1.observe(on_value_change, names='value')\ny_dropdown_1.observe(on_value_change, names='value')\n# trigger init\non_value_change(None)","39f6242f":"# UI\nlocation_dropdown_2 = widgets.Dropdown(\n    options=data_df['Full Location'].unique().tolist() + ['All'],\n    value='All',\n    description='Location:',\n    disabled=False,\n)\n\ny_dropdown_2 = widgets.Dropdown(\n    options=['Confirmed', 'Deaths', 'Recovered'],\n    value='Confirmed',\n    description='Stats:',\n    disabled=False,\n)\n\ndef on_value_change(change):\n    clear_output()\n    display(location_dropdown_2, y_dropdown_2)\n    plot_trend(data_df, y_feature=y_dropdown_2.value, loc_feature='Full Location', loc=location_dropdown_2.value, freq='Daily')\n\nlocation_dropdown_2.observe(on_value_change, names='value')\ny_dropdown_2.observe(on_value_change, names='value')\n# trigger init\non_value_change(None)","ffcf5f46":"# calculate % change\ndef get_daily_change(df, y_feature, loc, loc_feature='Country'):\n    df = df.copy()\n    # filter by Location\n    if loc == 'All':\n        df = df.sort_values('Last Update').reset_index(drop=True)\n    else:\n        df = df[df[loc_feature] == loc].reset_index(drop=True).sort_values('Last Update')\n        \n    df.index = df['Last Update']\n    df = df.groupby(pd.Grouper(freq='D'))[y_feature].sum().reset_index()\n    df[f'{y_feature} Change'] = df[y_feature].diff() \n    df[f'{y_feature} % Change'] = df[y_feature].pct_change() * 100\n    return df\n\ncountry_dropdown_3 = widgets.Dropdown(\n    options=data_df['Country'].unique().tolist() + ['All'],\n    value='All',\n    description='Country:',\n    disabled=False,\n)\n\ny_dropdown_3 = widgets.Dropdown(\n    options=['Confirmed', 'Deaths', 'Recovered'],\n    value='Confirmed',\n    description='Stats:',\n    disabled=False,\n)\n\nabs_dropdown_3 = widgets.Dropdown(\n    options=['Abs. Change', '% Change'],\n    value='% Change',\n    description='Abs Change\/% Change:',\n    disabled=False,\n)\n\n\ndef on_value_change(change):\n    clear_output()\n    display(country_dropdown_3, y_dropdown_3, abs_dropdown_3)\n    df = get_daily_change(data_df, y_dropdown_3.value, country_dropdown_3.value)\n    if abs_dropdown_3.value == 'Abs. Change':\n        plot_trend(df, y_feature=f'{y_dropdown_3.value} Change', loc='All', freq='Daily')\n    else:\n        plot_trend(df, y_feature=f'{y_dropdown_3.value} % Change', loc='All', freq='Daily')\n\ncountry_dropdown_3.observe(on_value_change, names='value')\ny_dropdown_3.observe(on_value_change, names='value')\nabs_dropdown_3.observe(on_value_change, names='value')\n# trigger init\non_value_change(None)","d4e47f08":"location_dropdown_4 = widgets.Dropdown(\n    options=data_df['Full Location'].unique().tolist() + ['All'],\n    value='China_Hubei',\n    description='Location:',\n    disabled=False,\n)\n\ny_dropdown_4 = widgets.Dropdown(\n    options=['Confirmed', 'Deaths', 'Recovered'],\n    value='Confirmed',\n    description='Stats:',\n    disabled=False,\n)\n\nabs_dropdown_4 = widgets.Dropdown(\n    options=['Abs. Change', '% Change'],\n    value='% Change',\n    description='Abs Change\/% Change:',\n    disabled=False,\n)\n\n\ndef on_value_change(change):\n    clear_output()\n    display(location_dropdown_4, y_dropdown_4, abs_dropdown_4)\n    df = get_daily_change(data_df, y_dropdown_4.value, loc=location_dropdown_4.value, loc_feature='Full Location')\n    if abs_dropdown_4.value == 'Abs. Change':\n        plot_trend(df, y_feature=f'{y_dropdown_4.value} Change', loc_feature='Full Location', loc='All', freq='Daily')\n    else:\n        plot_trend(df, y_feature=f'{y_dropdown_4.value} % Change', loc_feature='Full Location', loc='All', freq='Daily')\n\nlocation_dropdown_4.observe(on_value_change, names='value')\ny_dropdown_4.observe(on_value_change, names='value')\nabs_dropdown_4.observe(on_value_change, names='value')\n# trigger init\non_value_change(None)","9411f5b1":"def get_moving_stat(df, y_feature, loc_feature='Country'):\n    df = df.copy()\n    df.index = df['Last Update']\n    df = df.groupby([pd.Grouper(freq='D'), loc_feature])[y_feature].sum().reset_index()\n    day_count_df = df.groupby(loc_feature)[y_feature].count().reset_index()\n    filted_locations = day_count_df[day_count_df['Confirmed']>=3][loc_feature].tolist()\n    df = df[df[loc_feature].isin(filted_locations)]    \n    df[f'{y_feature} Change'] = (df.groupby(loc_feature)[y_feature].apply(pd.Series.diff))\n    \n    for window_size in [1, 2, 3, 4]:\n        df[f'Lag {window_size} {y_feature}'] =  df.groupby(loc_feature)[y_feature].shift(window_size)\n        df[f'Last {window_size}Dy {y_feature} Change'] = df.groupby(loc_feature)[f'{y_feature} Change']\\\n            .transform(lambda x: x.rolling(window_size, min_periods=window_size).sum()).round(2)\n    df = df.groupby(loc_feature).last()\n    \n    for window_size in [1, 2, 3, 4]:\n        df[f'Last {window_size}Dy {y_feature} % Change'] = df[f'Last {window_size}Dy {y_feature} Change'] \/  df[f'Lag {window_size} {y_feature}']\n        \n#     display(df)\n    return df","334b1215":"country_growth_df = get_moving_stat(data_df, y_feature='Confirmed', loc_feature='Country')\ncountry_growth_df = country_growth_df.sort_values('Last 4Dy Confirmed Change', ascending=False)\ndisplay(country_growth_df[[f for f in country_growth_df.columns if 'Confirmed Change' in f or 'Update' in f or f == 'Confirmed']])","e24fd52f":"china_df = data_df[data_df['Country']=='China']\ncountry_growth_df = get_moving_stat(data_df, y_feature='Confirmed', loc_feature='Full Location')\ncountry_growth_df = country_growth_df.sort_values('Last 4Dy Confirmed Change', ascending=False)\ndisplay(country_growth_df[[f for f in country_growth_df.columns if 'Confirmed Change' in f or 'Update' in f or f == 'Confirmed']])","f7b9b2f3":"china_df = data_df[data_df['Country']=='China']\ncountry_growth_df = get_moving_stat(china_df, y_feature='Confirmed', loc_feature='Full Location')\ncountry_growth_df = country_growth_df.sort_values('Last 4Dy Confirmed % Change', ascending=False)\ndisplay(country_growth_df[[f for f in country_growth_df.columns if 'Confirmed % Change' in f or 'Update' in f or f == 'Confirmed']])","ee4d7311":"# Growth Visualization By Location","7b7c6e88":"# Features Summary\n* Sno: Serial number (Location Id)\n* Province\/State: Province or State of observation\n* Country: Country of observation\n* Last Update: Date of observation\n* Confirmed: Number of confirmed cases\n* Deaths: Number of deaths\n* Recovered: Number of recovered cases","914abdae":"# Last N Day Confirmed Cases % Change By Locations with Country == 'China'","a8c39613":"# Moving Sum of Confirmed Cases Change By Locations with Country == 'China'","824430d9":"# Last N Day Confirmed Cases Change By Country","70df9b6e":"# Dataset\n\nSource:\nThe dataset is scraped from https:\/\/docs.google.com\/spreadsheets\/d\/1yZv9w9zRKwrGTaR-YzmAqMefw4wMlaXocejdxZaTs6w\/htmlview?usp=sharing&sle=true# by @sudalairajkumar to the Kaggle platform.\n\n","70617b6e":"1. Sorted by: 3 Day Moving Sum of Confirmed Case Change. i.e Abs. Growth","1ee00712":"1. Sorted by: 3 Day Moving Sum of Confirmed Case Change. i.e Abs. Growth","a194f462":"# Visualization by Country","1f8eae70":"# Growth Visualization By Country"}}