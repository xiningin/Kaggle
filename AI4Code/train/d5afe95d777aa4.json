{"cell_type":{"9f6856c2":"code","138cc474":"code","9654c20e":"code","8f29fb0b":"code","2b5dbded":"code","a6eb9693":"code","a493715c":"code","93db2fab":"code","d7028f9d":"code","8a7622c0":"code","4dfb074b":"code","a8ffeb50":"code","2f4c5987":"markdown","85b2a272":"markdown","766c8129":"markdown","50358d5d":"markdown","f42368d2":"markdown","16bee90d":"markdown","f7fc53f1":"markdown","3cd0bd8c":"markdown","4025291d":"markdown","ef88080f":"markdown","dfdb4a9f":"markdown","1d002328":"markdown","fbfddc88":"markdown"},"source":{"9f6856c2":"# Import all of the usual libraries for analysis...\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n# ...set appropriate chart type for Jupyter notebook formatting\n%matplotlib inline\nsns.set(font_scale=1.3)\nplt.rcParams['figure.figsize'] = [14, 7]","138cc474":"# Load data\npenData = pd.read_csv('..\/input\/penalties_stats_aa.csv')\npenData.head()","9654c20e":"# Calculate penalties per match metric\npenData['PenaltiesPerMatch'] = penData['PenaltiesAwarded']\/penData['MatchesPlayed']\nsns.barplot(x='Year', y='PenaltiesPerMatch', data=penData, ci=None, palette=['skyblue']*(penData.shape[0]-1) + ['steelblue'])\nplt.ylabel(\"Penalties Awarded per World Cup Match\");","8f29fb0b":"# Look at outliers (roughly)\nsns.boxplot(penData.PenaltiesPerMatch)","2b5dbded":"# Add penalties to VAR to the dataset\npenData['VARScore'] = [0]*(penData.shape[0]-1) + [6]\npenData['VARMiss'] = [0]*(penData.shape[0]-1) + [3]\npenData['VARSave'] = [0]*(penData.shape[0]-1) + [1]","a6eb9693":"# Suppose that none of the VAR penalties were awarded\nwoVARPenPerMatch = (penData.loc[20, 'PenaltiesAwarded'] - penData.iloc[20, 8:11].sum()) \/ penData.loc[20, 'MatchesPlayed']\nprint(\"2018 Penalty Rate without VAR penalties: %.3f\" % woVARPenPerMatch)","a493715c":"# Compare to previous years\npenData[woVARPenPerMatch < penData.PenaltiesPerMatch].loc[[10, 12, 13], ['Year', 'Host', 'PenaltiesPerMatch']]","93db2fab":"# Scneario Analysis\nVARScenarios = penData.append([penData], ignore_index=True)\nVARScenarios['VARScenario'] = ['Excluding all VAR penalties']*(penData.shape[0]) + ['Include VAR-overturned penalties']*(penData.shape[0])\nVARScenarios.loc[20,'PenaltiesPerMatch'] = woVARPenPerMatch\nVARScenarios.loc[41,'PenaltiesPerMatch'] = (penData.loc[20, 'PenaltiesAwarded'] - penData.iloc[20, 8:11].sum() + 3) \/ penData.loc[20, 'MatchesPlayed']","d7028f9d":"# Scneario Analysis visual\nsns.set(font_scale=1.1)\ng = sns.FacetGrid(VARScenarios, row=\"VARScenario\", aspect=3)\ng = g.map(sns.barplot, 'Year', 'PenaltiesPerMatch')","8a7622c0":"# Converted penalties calculation\npenData['ScoreRate'] = penData['PenaltiesScored'] \/ penData['PenaltiesAwarded']\npenData['MissRate'] = (penData['PenaltiesAwarded'] - penData['PenaltiesScored']) \/ penData['PenaltiesAwarded']","4dfb074b":"# Plot converted penalties rate over time\nplt.stackplot(penData.Year, [penData.ScoreRate, penData.MissRate], labels=['Miss', 'Score'])\nplt.xlim(min(penData.Year),max(penData.Year))\nplt.ylim(0, 1);","a8ffeb50":"print(\"Average in-game penalty conversion rate: %.1f%%\" % (100*penData.ScoreRate.sum()\/21))","2f4c5987":"The outlier is even more apparent in a boxplot, where the 2018 *PenaltiesPerMatch* are close to 3 standard deviations away from the median.","85b2a272":"It's time to make a bold assumption... For the sake of simplicity, let's say that all of the above penalties would not have been awarded if VAR technology was not there to support the decision. Of course there were a number of penalties that were overturned by VAR, which would have the opposite effect if the tehcnology was not there. Most notably, a penalty was overtuned by VAR in the match between Costa Rica and Argentina. There was also Brazil vs Belgium and Sweden vs Switzerland (Source: [ESPN](http:\/\/www.espn.com\/soccer\/fifa-world-cup\/4\/blog\/post\/3533707\/var-at-the-world-cup-a-timeline-of-the-tournament)).  ","766c8129":"The top bargraph shows the penalty rates if all VAR penalties are excluded from the calculation. The bottom boxplot shows the scenario where all VAR penalties are excluded, but all VAR overtuned penalties are included. \n\nIn conclusion I would say that this world cup has seen an unprecendented rate of penalties. There is evidence to suggest that the increase is due to the use of VAR. Excluding VAR penalties would not make 2018 World Cup out of the ordinary, historically speaking. However, other factors (including chance) may be at play here as VAR did overturn at least 3 penalty calls which would otherwise be awarded.","50358d5d":"Plotting these in an area chart shows that up to about 1954 penalty takers did improve their strikes. Following that competition, the penalty conversion rate has stabilized around the 80% mark, on average.","f42368d2":"Had this been a normal distirbution (which it is not) we would have to say that the 2018 penalties awarded do not fit this distribution. No matter how we slice it, there seems to be a shift that happened this year with respect to penalties.","16bee90d":"## Penalties per Match\nFirst, we can see the that number of penalties has been increasing since the original 1930 tournament. However, this is simply due to the fact that much fewer games were played back then compared to modern format (18 games in 1930 vs. 64 games this year). \nI will create a variable that takes number of games into account, call it *PenaltiesPerMatch*. Creating a barplot of that variable indicates that the 2018 World Cup had a penalty almost every two games - a rate that has never been seen before in the tournament.","f7fc53f1":"## Bonus: Converted Penalties Over the Years\n\nWith the available data, I can't help but ask: did teams get better at converting in-game penalties? For this I'll add two simple features, *ScoreRate* and *MissRate*, for each competition.","3cd0bd8c":"## VAR at 2018 World Cup: Python Exploration\nThis notebook explores the effect of Video Assistant Referee (VAR) system in the 2018 World Cup in Russia. This was the first time VAR was used in the World Cup and it has certainly made the news on more than one occasion. The system uses multi-angle video feeds to assist referees in making the right calls during the game.","4025291d":"## Penalties due to VAR?\nOnce again turning to Linguasport source and other publications, I was able to find all of the penalty instances in 2018 World Cup where the penalty kick decision was either made due to or confirmed by VAR (Source: [The Sun](https:\/\/www.thesun.co.uk\/world-cup-2018\/6549345\/penalties-at-world-cup-2018\/)). There is only a handfull of such cases:\n* Australia scored vs. Denmark - VAR-assisted decision\n* Iran scored vs. Portugal - VAR-assisted decision\n* France scored vs. Croatia - confirmed by VAR\n* Belgium scored vs. Tunisia - VAR-assisted decision\n* France scored vs. Australia - confirmed by VAR\n* Sweden scored vs. South Korea - confirmed by VAR\n* Iceland missed vs. Nigeria - confirmed by VAR\n* Peru missed vs. Denmark - confirmed by VAR\n* Saudi Arabia saved by Egypt - confirmed by VAR","ef88080f":"## The Data\nWhile scored penalties in all historic World Cup tournaments are readily availble from the [Guardian Data Blog](https:\/\/www.theguardian.com\/news\/datablog\/2010\/may\/05\/world-cup-historical-statistics#data), getting the number of awarded penalties (including missed and saved shots) has proven to be tricky. After a few hours of scouring the internet and almost resorting to watching recaps of games, I came accross an amazing resource that contains the data in text format, going back to 1930. [Linguasport](http:\/\/www.linguasport.com\/) has short description of every match in the World Cup history, inclusing an easy to parse section called \"Incidents\" that includes penalty misses, saves, player names, bookings, and anything else that is out of the ordinary for each game. I've put together a dataset that captures the penalty information at an aggregate level. Since the dataset is very small and I carefully built it myself, I can dive directly into feature creation and exploration, without doing much integrity checking or cleaning.","dfdb4a9f":"These numbers are already included in my penalties dataset. I will only add special columns called VARScore, VARMIss, and VARSave to visualize the effect.","1d002328":"I will conclude this notebook by computing the averate penalty conversion rate from all World Cup tournaments since 1930.","fbfddc88":"This is closer to a normal penalty rate and is in fact less than the penalty rate of Argentina 1978 and Italy 1990. However, with the 3 penalties that have been overturned by VAR, Russian 2018 would still have the highest rate of penalties per game, though not as dramatic."}}