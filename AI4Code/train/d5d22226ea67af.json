{"cell_type":{"3d85321d":"code","87f2b213":"code","336e931b":"code","5046feae":"code","04f5dfd7":"code","e77e108c":"code","d8dde395":"code","9f28ee62":"code","074a0dfa":"code","0f4daae5":"code","d1ed6c98":"code","99a90c5e":"code","9929007b":"code","5c516409":"code","dbab9343":"code","540ee4f4":"code","e257d1b3":"code","042e7b6f":"code","3f223f08":"code","0bd788f4":"code","8ebcf945":"code","525e41dd":"code","909e3ebf":"code","acf2a677":"code","c8f43cd8":"code","4c0d7974":"code","54a8aaed":"code","830f26fa":"code","0ac1b6ea":"code","6f8f73b2":"code","789a5a3f":"code","d60ec1dc":"code","672cde64":"code","6eea2842":"code","64b62e48":"code","c63f4bf7":"code","340a6a00":"code","4302b137":"code","8f7827ed":"code","feb6dc11":"code","de590eb9":"code","c0126839":"code","f882c497":"code","2dc446cb":"code","a775526c":"code","afcb985b":"code","998cfdef":"code","42c55244":"code","29a49b16":"markdown","0eb0b561":"markdown","315051c9":"markdown","3d670bc6":"markdown","eeedf1af":"markdown","cf147b8a":"markdown","20c67c80":"markdown","4929c1f9":"markdown","7947915b":"markdown","2507af08":"markdown","dc8e69b6":"markdown"},"source":{"3d85321d":"# Calling Libraries\n\n# Warnings\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# Data manipulation library\nimport pandas as pd\nimport numpy as np\nimport re\n\n# Plotting library\nimport seaborn as sns; sns.set(style=\"white\", color_codes=True)\nimport plotly.express as px\nfrom plotly.subplots import make_subplots\nimport matplotlib.pyplot as plt\nfrom pandas.plotting import andrews_curves\n\n# Modeling librray\n# Class to develop kmeans model\nfrom sklearn.cluster import KMeans\n# Scale data\nfrom sklearn.preprocessing import StandardScaler\n# Split dataset\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.mixture import GaussianMixture\nfrom sklearn.manifold import TSNE\n\n# How good is clustering?\nfrom sklearn.metrics import silhouette_score\nfrom yellowbrick.cluster import SilhouetteVisualizer\n\n# os related\nimport os","87f2b213":"# Display multiple outputs from a jupyter cell\nfrom IPython.core.interactiveshell import InteractiveShell\nInteractiveShell.ast_node_interactivity = \"all\"","336e931b":"# Set numpy options to display wide array\nnp.set_printoptions(precision = 3,          # Display upto 3 decimal places\n                    threshold=np.inf        # Display full array\n                    )","5046feae":"# Seting display options\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', 100)","04f5dfd7":"#os.chdir(\"E:\\HPS\\Finance & Accounts\\One time activity\\SS\\Python for analytics\\Class Notes & Recordings\\Class-13_21-06-20\\Excercises & Solutions\")\n#os.listdir()","e77e108c":"# Reading dataset\ndf = pd.read_csv(\"..\/input\/customer-segmentation-tutorial-in-python\/Mall_Customers.csv\")","d8dde395":"df.dtypes","9f28ee62":"# cleaning\/renaming column names\ndf.rename(columns={'Annual Income (k$)':'AnnualIncome(k$)',\n                   'Spending Score (1-100)':'SpendingScore(1-100)',\n                  }, \n          inplace=True)                         \ndf.head()","074a0dfa":"# Dropping CustomerID column\ndf.drop(['CustomerID'], inplace = True, axis = 1) ","0f4daae5":"df.head()","d1ed6c98":"# Transforming Gender\n#pd.Series(np.where(df.Gender.values == 'Male', 1, 0, inplace = True))\ndf.Gender[df.Gender == 'Male'] = 1\ndf.Gender[df.Gender == 'Female'] = 0\n#df.Gender.map(dict(Male=1, Female=0))","99a90c5e":"df.head()","9929007b":"df[\"age_cat\"] = pd.cut(\n                       df['Age'],\n                       bins = [0,35,55,100],           # Else devise your bins: [0,20,60,110]\n                       labels= [\"y\", \"m\", \"s\"]\n                      )","5c516409":"df[\"income_cat\"] = pd.cut(\n                           df['AnnualIncome(k$)'],\n                           bins = 3,\n                           labels= [\"l\", \"m\", \"h\"]\n                         )","dbab9343":"df.head()","540ee4f4":"# Shows the relationship of each figure\n\nsns.pairplot(hue=\"age_cat\",data=df)","e257d1b3":"# Shows the relationship between annual income and spending score by line plot\n\nsns.relplot(x='AnnualIncome(k$)', y='SpendingScore(1-100)', col='age_cat',kind=\"line\",data=df)","042e7b6f":"sns.relplot(x='Age', y='SpendingScore(1-100)', kind=\"line\",data=df)\nsns.relplot(x='Age', y='AnnualIncome(k$)', kind=\"line\",data=df)","3f223f08":"#sns.jointplot(x=\"x\", y=\"y\", data=df)\nsns.jointplot(x='Age', y='SpendingScore(1-100)', kind = \"hex\", data=df)\nsns.jointplot(x='Age', y='AnnualIncome(k$)', kind=\"kde\",data=df)","0bd788f4":"sns.catplot(x='age_cat', y='SpendingScore(1-100)', kind = \"bar\", hue = 'Gender', data=df)\nsns.catplot(x='age_cat', y='AnnualIncome(k$)', kind=\"bar\", hue = 'Gender', data=df)","8ebcf945":"sns.catplot(x='income_cat', y='SpendingScore(1-100)', kind = \"bar\", hue = 'age_cat', data=df)","525e41dd":"sns.catplot(x='income_cat', y='SpendingScore(1-100)', kind = \"bar\", hue = 'Gender', data=df)","909e3ebf":"#box plot Gender vs Annual_Income_k\nsns.boxplot(x = 'Gender', y = 'AnnualIncome(k$)', data = df)","acf2a677":"sns.heatmap(df.corr(), linecolor = 'black', linewidth = 1, annot = True)","c8f43cd8":"#Drop Categorical Values\ndf.drop(columns=['age_cat', 'income_cat'], inplace=True)","4c0d7974":"# Scaling using StandardScaler\nss = StandardScaler()\nss.fit(df)\nX = ss.transform(df)","54a8aaed":"# 4.1 Perform clsutering\ngm = GaussianMixture(\n                     n_components = 2,\n                     n_init = 10,\n                     max_iter = 100)","830f26fa":"# 4.2 Train the algorithm\ngm.fit(X)","0ac1b6ea":"# 4.3 Where are the clsuter centers\ngm.means_","6f8f73b2":"# 4.4 Did algorithm converge?\ngm.converged_","789a5a3f":"# 4.5 How many iterations did it perform?\ngm.n_iter_","d60ec1dc":"# 4.6 Clusters labels\ngm.predict(X)","672cde64":"# 4.7 Weights of respective gaussians.\ngm.weights_","6eea2842":"# 4.7.1 What is the frequency of data-points\n#       for the three clusters. (np.unique()\n#       ouputs a tuple with counts at index 1)\nnp.unique(gm.predict(X), return_counts = True)[1]\/len(X)","64b62e48":"# 4.8 GMM is a generative model.\n#     Generate a sample from each cluster\n#     ToDo: Generate digits using MNIST\ngm.sample()","c63f4bf7":"bic = []\naic = []\nfor i in range(8):\n    gm = GaussianMixture(\n                     n_components = i+1,\n                     n_init = 10,\n                     max_iter = 100)\n    gm.fit(X)\n    bic.append(gm.bic(X))\n    aic.append(gm.aic(X))\n    \n# Look at the plots\n\nfig = plt.figure()\nplt.plot([1,2,3,4,5,6,7,8], aic, marker = \"d\", label = 'aic')\nplt.plot([1,2,3,4,5,6,7,8], bic, marker = \"d\", label = 'bic')\nplt.show()","340a6a00":"tsne = TSNE(n_components = 2)\ntsne_out = tsne.fit_transform(X)\nplt.scatter(tsne_out[:, 0], tsne_out[:, 1],\n            marker='x',\n            s=30,              # marker size\n            linewidths=5,      # linewidth of marker edges\n            c=gm.predict(X)   # Colour as per gmm\n            )","4302b137":"# 5.0 Plot cluster and cluster centers\n#     both from kmeans and from gmm\n\nfig = plt.figure()\n\n# 5.1\nplt.scatter(X[:, 0], X[:, 1],\n            c=gm.predict(X),\n            s=2)\n# 5.2\nplt.scatter(gm.means_[:, 0], gm.means_[:, 1],\n            marker='v',\n            s=5,               # marker size\n            linewidths=5,      # linewidth of marker edges\n            color='red'\n            )\nplt.show()","8f7827ed":"densities = gm.score_samples(X)\ndensities","feb6dc11":"density_threshold = np.percentile(densities,4)\ndensity_threshold","de590eb9":"anomalies = X[densities < density_threshold]\nanomalies\nanomalies.shape","c0126839":"# 6.1 Show anomalous points\nfig = plt.figure()\nplt.scatter(X[:, 0], X[:, 1], c = gm.predict(X))\nplt.scatter(anomalies[:, 0], anomalies[:, 1],\n            marker='v',\n            s=5,               # marker size\n            linewidths=5,      # linewidth of marker edges\n            color='red'\n            )\nplt.show()","f882c497":"# 7.1 Get first unanomalous data\nunanomalies = X[densities >= density_threshold]\nunanomalies.shape    # (192, 4)","2dc446cb":"# 7.2 Transform both anomalous and unanomalous data\n#     to pandas DataFrame\ndf_anomalies = pd.DataFrame(anomalies, columns = df.columns.values)\ndf_anomalies['UnAn_or_An'] = 'anomalous'   # Create a IIIrd constant column\ndf_anomalies\ndf_normal = pd.DataFrame(unanomalies, columns = df.columns.values)\ndf_normal['UnAn_or_An'] = 'unanomalous'    # Create a IIIrd constant column","a775526c":"# 7.3 Let us see density plots\nsns.distplot(df_anomalies['AnnualIncome(k$)'])\nsns.distplot(df_normal['AnnualIncome(k$)'])","afcb985b":"# 7.3 Let us see density plots\nsns.distplot(df_anomalies['SpendingScore(1-100)'])\nsns.distplot(df_normal['SpendingScore(1-100)'])","998cfdef":"# 7.4 Draw side-by-side boxplots\n# 7.4.1 Ist stack two dataframes\ndf1 = pd.concat([df_anomalies,df_normal])\n# 7.4.2 Draw featurewise boxplots\nsns.boxplot(x = df1['UnAn_or_An'], y = df1['SpendingScore(1-100)'])","42c55244":"sns.boxplot(x = df1['UnAn_or_An'], y = df1['AnnualIncome(k$)'])","29a49b16":"### <font color = blue>iv) Using sklearn's StandardScaler() to scale dataset<\/font>","0eb0b561":"### <font color = blue>viii) Lookup anomalous customers and try to understand their behavior<\/font>\n","315051c9":"#### How many clusters?","3d670bc6":"### <font color = blue>v) Perform clustering using Gaussian Mixture Modeling<\/font>","eeedf1af":"### <font color = blue>i) Reading dataset and renaming columns appropriately<\/font>","cf147b8a":"## <font color=blue>Loading Dataset:<\/font>","20c67c80":"# <font color=blue>Assignment:<\/font>  \n### <font color = green>Beginners: Mall Customer Segmentation using Gaussian Mixture Model<\/font>\n\ni) Read dataset and rename columns appropriately  \nii) Drop customerid column and also transform Gender column to [0,1]  \niii) Use seaborn to understand each feature and relationships among features  \niv) Use sklearn's StandardScaler() to scale dataset  \nv) Perform clustering using Gaussian Mixture Modeling  \nvi) Use aic and bic measures to draw a scree plot and discover ideal number of clusters  \nviii) Lookup anomalous customers and try to understand their behavior  ","4929c1f9":"### <font color = blue>vi) Using aic and bic measures to draw a scree plot and discover ideal number of clusters<\/font>","7947915b":"### <font color = blue>ii) Drop CustomerID column and also transform Gender column to [0,1]<\/font>","2507af08":"### <font color = blue>iii) Use seaborn to understand each feature and relationships among features<\/font>","dc8e69b6":"#### <font color = blue>Adding Age Category<\/font>"}}