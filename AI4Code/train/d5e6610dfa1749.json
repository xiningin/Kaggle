{"cell_type":{"98dc9353":"code","d08606e0":"code","c61596eb":"code","f238b64a":"code","1e9a4ba8":"code","d4569c5a":"code","df3a34c2":"code","214d6fc4":"markdown","423edc8f":"markdown","b3ce8d31":"markdown","f38a3ad2":"markdown","30de9545":"markdown","a53f5fdb":"markdown","541543d4":"markdown","8b3f7c67":"markdown","f9cf5bb3":"markdown","0a1127ac":"markdown","bc868baa":"markdown","e6818648":"markdown","98be88f8":"markdown","53c9bdc4":"markdown"},"source":{"98dc9353":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn import base\nfrom sklearn.model_selection import KFold\n\ntrain = pd.read_csv(\"..\/input\/titanic\/train.csv\")\ntest = pd.read_csv(\"..\/input\/titanic\/test.csv\")","d08606e0":"class KFoldTargetEncoderTrain(base.BaseEstimator,\n                               base.TransformerMixin):\n    def __init__(self,colnames,targetName,\n                  n_fold=5, verbosity=True,\n                  discardOriginal_col=False):\n        self.colnames = colnames\n        self.targetName = targetName\n        self.n_fold = n_fold\n        self.verbosity = verbosity\n        self.discardOriginal_col = discardOriginal_col\n    def fit(self, X, y=None):\n        return self\n    def transform(self,X):\n        mean_of_target = X[self.targetName].mean()\n        kf = KFold(n_splits = self.n_fold,\n                   shuffle = False, random_state=2019)\n        col_mean_name = self.colnames + '_' + 'Kfold_Target_Enc'\n        X[col_mean_name] = np.nan\n        for tr_ind, val_ind in kf.split(X):\n            X_tr, X_val = X.iloc[tr_ind], X.iloc[val_ind]\n            X.loc[X.index[val_ind], col_mean_name] = X_val[self.colnames].map(X_tr.groupby(self.colnames)\n                                     [self.targetName].mean())\n            X[col_mean_name].fillna(mean_of_target, inplace = True)\n        if self.verbosity:\n            encoded_feature = X[col_mean_name].values\n            print('Correlation between the new feature, {} and, {} is {}.'.format(col_mean_name,self.targetName,                    \n                   np.corrcoef(X[self.targetName].values,\n                               encoded_feature)[0][1]))\n        if self.discardOriginal_col:\n            X = X.drop(self.targetName, axis=1)\n        return X","c61596eb":"targetc = KFoldTargetEncoderTrain('Embarked','Survived',n_fold=5)\nnew_train = targetc.fit_transform(train)","f238b64a":"new_train.head()","1e9a4ba8":"class KFoldTargetEncoderTest(base.BaseEstimator, base.TransformerMixin):\n    \n    def __init__(self,train,colNames,encodedName):\n        \n        self.train = train\n        self.colNames = colNames\n        self.encodedName = encodedName\n        \n    def fit(self, X, y=None):\n        return self\n    def transform(self,X):\n        mean =  self.train[[self.colNames,\n                self.encodedName]].groupby(\n                                self.colNames).mean().reset_index() \n        \n        dd = {}\n        for index, row in mean.iterrows():\n            dd[row[self.colNames]] = row[self.encodedName]\n        X[self.encodedName] = X[self.colNames]\n        X = X.replace({self.encodedName: dd})\n        return X","d4569c5a":"test_targetc = KFoldTargetEncoderTest(new_train,\n                                      'Embarked',\n                                      'Embarked_Kfold_Target_Enc')\nnew_test = test_targetc.fit_transform(test)","df3a34c2":"new_test.head()","214d6fc4":"This is an introduction to Target Encoding, exhibiting the application of K-Fold Target Encoding technique on the Titanic competition data.","423edc8f":"Taking a look at the new_train dataset, we can see a new column named Embarked_Kfold_Target_Enc which is the target encoded version of the Embarked feature.","b3ce8d31":"![image.png](attachment:image.png)","f38a3ad2":"The idea is similar to k-fold cross validation. We divide the data in K-stratified or random folds, replace the observations present in the M-th fold with mean target of data from all other folds except the M-th fold. We are basically trying to use all the data given to us and not leak the information from self target label by allowing target information to flow from other fellow observations (same category but other folds).","30de9545":"Target Encoding is similar to label encoding, except here labels are correlated directly with the target. Mean target encoding for each category in the feature label is decided with the mean value of the target variable on a training data. This encoding method brings out the relation between similar categories, but the relations are bounded within the categories and target itself. \n\nThe advantages of the mean target encoding are that it does not affect the volume of the data and helps in faster learning. Many competition winning models make use of target encoding as it often produces higher accuracy (sometimes drastically high accuracies) because of the direct correlation between the encoded variable and the target. \n\nOverfitting can be a major problem while using target encoding which can be addressed by using the K-Fold Target Enoding technique.","a53f5fdb":"Taking a look at the new_test dataset, we can see a new column named Embarked_Kfold_Target_Enc which is the target encoded version of the Embarked feature.","541543d4":"First, a k-fold target encoder class will be created for the train set. The KFoldTargetEncoderTrain class gets the name of the feature column, target column and number of fold initially and then fit and transform the train data. ","8b3f7c67":"Finally, we need to create the \u201cEmbarked_Kfold_Target_Enc\u201d in the test dataset by using the following class. The class needs the train dataset and \u201cFeature\u201d (\"Embarked\") and the name of the encoded column. After that we fit and transform the test dataset.","f9cf5bb3":"# Introduction to Target Encoding","0a1127ac":"Now, we will create an object of this class and use it to fit and transform the test data.","bc868baa":"![image.png](attachment:image.png)","e6818648":"We will now apply K-Fold Target Enoding technique on the Titanic competition data by encoding the **Embarked feature** of the dataset.","98be88f8":"Now, we will create an object of this class and use it to fit and transform the train data. As mentioned earlier, we will encode the Embarked column of the dataset.","53c9bdc4":"# The Code for application"}}