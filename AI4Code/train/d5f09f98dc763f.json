{"cell_type":{"779674e4":"code","29b1c8b8":"code","7d537611":"code","e0b10089":"code","bc7fa60e":"code","0194c611":"code","f979c9ad":"code","a67b5fca":"code","2a82b381":"code","85580558":"code","50b08393":"code","99067759":"code","bf6f566c":"code","feaa3f2f":"code","fd53dc30":"code","b8002540":"code","868b794e":"code","928da2ad":"code","16f7435f":"code","6a913257":"code","a739f838":"code","d2aafff5":"code","98f61ab4":"code","59b08ff8":"code","8814034f":"code","996509cf":"code","f6d51921":"code","ecdc3098":"code","854430f6":"code","1ebe8513":"code","300f1c05":"code","2ec309ea":"code","f8183438":"code","c36b5b42":"code","01d6cd68":"code","458256fe":"code","f6819327":"code","8a5f45fe":"code","a1953070":"code","d68f0800":"code","d4319e3e":"code","727bb75b":"code","75619f51":"code","55a3f977":"code","3a567549":"code","f076eb41":"code","d6462015":"code","b64a7367":"code","e2cff9cd":"code","b0c9c737":"code","248b2a72":"code","0a5a7ac9":"code","5f8c51a9":"code","bda2f626":"code","bcf045e5":"code","3cc2e1e4":"code","f2f2f05c":"code","376d93e1":"code","0cf1983d":"code","3b5fa5d8":"code","15780f1b":"code","db045360":"code","604bdad8":"code","e1c035b3":"code","9bd4ea79":"code","a3188775":"code","b5d21288":"code","36909e52":"code","461aa7a1":"code","6ce9236c":"code","64bb9ed2":"code","e9bde70e":"code","8250a152":"code","6a68dca1":"code","77b21183":"markdown","b2138e87":"markdown","68a982be":"markdown","44f88726":"markdown","9fdc5d65":"markdown","1865ae9e":"markdown","c66aa8e6":"markdown","08c2d21c":"markdown","0e32733e":"markdown","640d9a2b":"markdown","bc427fa7":"markdown","e0cb8548":"markdown","52007c72":"markdown","77b0e7ed":"markdown","739f6681":"markdown","83a8d585":"markdown","29305332":"markdown","af1fc4de":"markdown","28338691":"markdown","a7fbc644":"markdown","88ca326a":"markdown","6841a99f":"markdown","48777d9a":"markdown","cf0333d2":"markdown","a37d61d7":"markdown","ffda603d":"markdown","561b314d":"markdown","4467f556":"markdown","21e1ea66":"markdown","56b2c676":"markdown","9ffe3ca2":"markdown","a6915fc5":"markdown","f7ba88e3":"markdown"},"source":{"779674e4":"import pandas as pd\nimport sklearn\nimport matplotlib.pyplot as plt\nimport seaborn as sns\npd.set_option(\"expand_frame_repr\", True)\nimport numpy as np","29b1c8b8":"from sklearn.model_selection import cross_val_score\nfrom sklearn.neighbors import KNeighborsClassifier","7d537611":"from sklearn import preprocessing","e0b10089":"adult = pd.read_csv(\"\/kaggle\/input\/adult-pmr3508\/train_data.csv\",names=[\n        \"Id\",\"Age\", \"Workclass\", \"fnlwgt\", \"Education\", \"Education-Num\", \"Marital Status\",\n        \"Occupation\", \"Relationship\", \"Race\", \"Sex\", \"Capital Gain\", \"Capital Loss\",\n        \"Hours per week\", \"Country\", \"Target\"])","bc7fa60e":"adult.head()","0194c611":"adult = adult.drop(0)","f979c9ad":"adult = adult.drop(['fnlwgt'],axis=1)\nadult = adult.drop(['Education'],axis=1)","a67b5fca":"adult.shape","2a82b381":"adult.Age.unique()","85580558":"adult.Workclass.unique()","50b08393":"adult['Education-Num'].unique()","99067759":"adult['Marital Status'].unique()","bf6f566c":"adult.Occupation.unique()","feaa3f2f":"adult.Relationship.unique()","fd53dc30":"adult.Race.unique()","b8002540":"adult.Sex.unique()","868b794e":"adult['Capital Gain'].unique()","928da2ad":"adult['Capital Loss'].unique()","16f7435f":"adult[\"Hours per week\"].unique()","6a913257":"adult.Country.unique()","a739f838":"adult.Target.unique()","d2aafff5":"adult[\"Workclass\"].value_counts()","98f61ab4":"adult.Occupation.value_counts()","59b08ff8":"adult[\"Country\"].value_counts()","8814034f":"remap_country = {'?':'Unitade-States'}\nremap_workclass = {'?':'Private'}\nadult=adult.replace({\"Country\": remap_country})\nadult=adult.replace({\"Workclass\": remap_workclass})\nadult.shape","996509cf":"adult['Age'] = adult['Age'].astype(int)\nadult['Hours per week'] = adult['Hours per week'].astype(int)\nadult['Capital Gain'] = adult['Capital Gain'].astype(int)\nadult['Capital Loss'] = adult['Capital Loss'].astype(int)\nadult['Education-Num'] = adult['Education-Num'].astype(int)","f6d51921":"adult_teste = pd.read_csv(\"\/kaggle\/input\/adult-pmr3508\/test_data.csv\",names=[\n        \"Id\",\"Age\", \"Workclass\", \"fnlwgt\", \"Education\", \"Education-Num\", \"Marital Status\",\n        \"Occupation\", \"Relationship\", \"Race\", \"Sex\", \"Capital Gain\", \"Capital Loss\",\n        \"Hours per week\", \"Country\"])\nadult_teste = adult_teste.drop(['fnlwgt'],axis=1)\nadult_teste = adult_teste.drop(['Education'],axis=1)\n#tirando a linha de t\u00edtulos\nadult_teste = adult_teste.drop(0)\n#tratando os dados faltantes\n\nadult_teste=adult_teste.replace({\"Country\": remap_country})\nadult_teste=adult_teste.replace({\"Workclass\": remap_workclass})\n#transformando os dados numericos em tipo inteiro\nadult_teste['Age'] = adult_teste['Age'].astype(int)\nadult_teste['Hours per week'] = adult_teste['Hours per week'].astype(int)\nadult_teste['Capital Gain'] = adult_teste['Capital Gain'].astype(int)\nadult_teste['Capital Loss'] = adult_teste['Capital Loss'].astype(int)\nadult_teste['Education-Num'] = adult_teste['Education-Num'].astype(int)\nadult_teste.shape","ecdc3098":"sns.histplot(data=adult, x='Hours per week',bins=20)\nplt.show()","854430f6":"sns.histplot(data=adult, y='Relationship')\nplt.show()","1ebe8513":"sns.histplot(data=adult, y='Marital Status')\nplt.show()","300f1c05":"sns.histplot(data=adult, y='Race')\nplt.show()","2ec309ea":"sns.histplot(data=adult, y='Occupation')\nplt.show()","f8183438":"sns.histplot(data=adult, y='Workclass')\nplt.show()","c36b5b42":"sns.histplot(data=adult, x='Capital Loss',bins=50)\nplt.show()","01d6cd68":"sns.histplot(data=adult, x='Capital Gain',bins=50)\nplt.show()","458256fe":"sns.histplot(data=adult, x='Age',bins=15)\nplt.show()","f6819327":"adult_numerico = adult[[\"Age\",\"Education-Num\",\"Capital Gain\", \"Capital Loss\", \"Hours per week\"]]\ntarget=adult.Target\nadult_numerico_teste = adult_teste[[\"Age\",\"Education-Num\",\"Capital Gain\", \"Capital Loss\", \"Hours per week\"]]","8a5f45fe":"adult_numerico.describe()","a1953070":"acuracia_maxima = 0\nmelhor_k = 1\nlista_de_acuracias =[]\nlista_de_ks = []\nfor i in range(1,50):\n    knn = KNeighborsClassifier(n_neighbors=i)\n    acuracia_atual = cross_val_score(knn, adult_numerico, target, cv=10).mean()\n    lista_de_acuracias.append(acuracia_atual)\n    lista_de_ks.append(i)\n    if acuracia_atual > acuracia_maxima:\n        acuracia_maxima = acuracia_atual\n        print(\"k = \", i)\n        print(acuracia_atual)\n        melhor_k = i","d68f0800":"plt.scatter(lista_de_ks,lista_de_acuracias)\nplt.show()","d4319e3e":"adult_qualitativo = adult[[\"Workclass\",\"Marital Status\",\"Occupation\",\"Relationship\",\"Race\",\"Sex\",\"Country\",\"Target\"]]","727bb75b":"adult_qualitativo_transformado = adult_qualitativo.apply(preprocessing.LabelEncoder().fit_transform)","75619f51":"adult_qualitativo_transformado.head()","55a3f977":"plt.figure(figsize=(10, 6))\nsns.heatmap(adult_qualitativo_transformado.corr(), square = True, annot = True, vmin = -1, vmax = 1)","3a567549":"sns.histplot(data=adult,y=\"Workclass\",hue=\"Target\")","f076eb41":"sns.histplot(data=adult,y=\"Marital Status\",hue=\"Target\")","d6462015":"sns.histplot(data=adult,y=\"Occupation\",hue=\"Target\")","b64a7367":"sns.histplot(data=adult,y=\"Relationship\",hue=\"Target\")","e2cff9cd":"sns.histplot(data=adult,y=\"Race\",hue=\"Target\")","b0c9c737":"sns.histplot(data=adult,y=\"Sex\",hue=\"Target\")","248b2a72":"adult_2 = adult_numerico.join(adult_qualitativo_transformado[\"Sex\"])","0a5a7ac9":"adult_2.head()","5f8c51a9":"acuracia_maxima = 0\nmelhor_k = 1\nlista_de_acuracias =[]\nlista_de_ks = []\nfor i in range(1,50):\n    knn = KNeighborsClassifier(n_neighbors=i)\n    acuracia_atual = cross_val_score(knn, adult_2, target, cv=10).mean()\n    lista_de_acuracias.append(acuracia_atual)\n    lista_de_ks.append(i)\n    if acuracia_atual > acuracia_maxima:\n        acuracia_maxima = acuracia_atual\n        print(\"k = \", i)\n        print(acuracia_atual)\n        melhor_k = i","bda2f626":"plt.scatter(lista_de_ks,lista_de_acuracias)\nplt.show()","bcf045e5":"adult_2 = adult_2.join(adult_qualitativo_transformado[\"Marital Status\"])","3cc2e1e4":"acuracia_maxima = 0\nmelhor_k = 1\nlista_de_acuracias =[]\nlista_de_ks = []\nfor i in range(1,50):\n    knn = KNeighborsClassifier(n_neighbors=i)\n    acuracia_atual = cross_val_score(knn, adult_2, target, cv=10).mean()\n    lista_de_acuracias.append(acuracia_atual)\n    lista_de_ks.append(i)\n    if acuracia_atual > acuracia_maxima:\n        acuracia_maxima = acuracia_atual\n        print(\"k = \", i)\n        print(acuracia_atual)\n        melhor_k = i","f2f2f05c":"plt.scatter(lista_de_ks,lista_de_acuracias)\nplt.show()","376d93e1":"adult_2 = adult_2.join(adult_qualitativo_transformado[\"Relationship\"])","0cf1983d":"acuracia_maxima = 0\nmelhor_k = 1\nlista_de_acuracias =[]\nlista_de_ks = []\nfor i in range(1,50):\n    knn = KNeighborsClassifier(n_neighbors=i)\n    acuracia_atual = cross_val_score(knn, adult_2, target, cv=10).mean()\n    lista_de_acuracias.append(acuracia_atual)\n    lista_de_ks.append(i)\n    if acuracia_atual > acuracia_maxima:\n        acuracia_maxima = acuracia_atual\n        print(\"k = \", i)\n        print(acuracia_atual)\n        melhor_k = i","3b5fa5d8":"plt.scatter(lista_de_ks,lista_de_acuracias)\nplt.show()","15780f1b":"adult_2 = adult_2.join(adult_qualitativo_transformado[\"Race\"])","db045360":"acuracia_maxima = 0\nmelhor_k = 1\nlista_de_acuracias =[]\nlista_de_ks = []\nfor i in range(1,50):\n    knn = KNeighborsClassifier(n_neighbors=i)\n    acuracia_atual = cross_val_score(knn, adult_2, target, cv=10).mean()\n    lista_de_acuracias.append(acuracia_atual)\n    lista_de_ks.append(i)\n    if acuracia_atual > acuracia_maxima:\n        acuracia_maxima = acuracia_atual\n        print(\"k = \", i)\n        print(acuracia_atual)\n        melhor_k = i","604bdad8":"plt.scatter(lista_de_ks,lista_de_acuracias)\nplt.show()","e1c035b3":"adult_2 = adult_2.join(adult_qualitativo_transformado[\"Occupation\"])","9bd4ea79":"acuracia_maxima = 0\nmelhor_k = 1\nlista_de_acuracias =[]\nlista_de_ks = []\nfor i in range(1,50):\n    knn = KNeighborsClassifier(n_neighbors=i)\n    acuracia_atual = cross_val_score(knn, adult_2, target, cv=10).mean()\n    lista_de_acuracias.append(acuracia_atual)\n    lista_de_ks.append(i)\n    if acuracia_atual > acuracia_maxima:\n        acuracia_maxima = acuracia_atual\n        print(\"k = \", i)\n        print(acuracia_atual)\n        melhor_k = i","a3188775":"plt.scatter(lista_de_ks,lista_de_acuracias)\nplt.show()","b5d21288":"adult_2.head()","36909e52":"adult_2 = adult_2[[\"Age\",\"Education-Num\",\"Capital Gain\",\"Capital Loss\",\"Hours per week\",\"Sex\",\"Marital Status\",\"Relationship\",\"Race\"]]","461aa7a1":"adult_teste_qualitativo = adult_teste[[\"Workclass\",\"Marital Status\",\"Occupation\",\"Relationship\",\"Race\",\"Sex\",\"Country\"]]","6ce9236c":"adult_teste_qualitativo_transformado = adult_teste_qualitativo.apply(preprocessing.LabelEncoder().fit_transform)","64bb9ed2":"adult_teste_2 = adult_numerico_teste.join(adult_teste_qualitativo_transformado[[\"Sex\",\"Marital Status\",\"Relationship\",\"Race\"]])","e9bde70e":"knn = KNeighborsClassifier(n_neighbors=26)\nknn.fit(adult_2,target)\ntarget_pred = knn.predict(adult_teste_2)","8250a152":"pred = pd.DataFrame(columns = [\"Id\",\"income\"])\n\npred.Id = adult_teste.Id\npred.income = target_pred","6a68dca1":"pred.to_csv(\"submission.csv\", index=False)\npred.shape","77b21183":"Para transformar as vari\u00e1veis qualitativas em num\u00e9ricas vamos usar o m\u00e9todo LabelEncoder().","b2138e87":"## Analise da distribui\u00e7\u00e3o dos dados","68a982be":"## Analisando o conte\u00fado de cada coluna:","44f88726":"## Importando o DataSet:","9fdc5d65":"Refazendo as configura\u00e7\u00f5es para os dados de teste:","1865ae9e":"# Gerando a resposta","c66aa8e6":"Retirando a primeira coluna em que est\u00e3o os t\u00edtulos:","08c2d21c":"## Bibliotecas:","0e32733e":"Agora a vari\u00e1vel Relationship","640d9a2b":"Agora com a vari\u00e1vel Marital Status","bc427fa7":"Observando os resultados acima percebemos que os dados faltantes est\u00e3o na forma de string \"?\" e n\u00e3o s\u00e3o vis\u00edveis por meio de m\u00e9todos como o .isna(), est\u00e3o presentes apenas nas classes Workclass, occupation e Country e n\u00e3o s\u00e3o muito numerosos (em rela\u00e7\u00e3o ao n\u00famero total de casos). Neste caso, podemos eliminar estes dados da seguinte maneira:","e0cb8548":"A seguir o knn \u00e9 testado para todos os k n\u00fameros de vizinhos entre 1 e 50 e avaliado por meio do cross validation com 10 divis\u00f5es, para determinar qual \u00e9 o melhor n\u00famero para k. A compara\u00e7\u00e3o \u00e9 feita com a m\u00e9dia dos valores de acur\u00e1cia do cross validation nos 10 subconjuntos. ","52007c72":"## Caracteristicas do DataSet:","77b0e7ed":"A coluna de fnlwgt n\u00e3o faz muito sentido para a an\u00e1lise, ent\u00e3o foi retirada. Al\u00e9m disso, a coluna de Education tem um equivalente em education-num, que \u00e9 muito mais \u00fatil para a an\u00e1lise, ent\u00e3o ela tamb\u00e9m foi retirada.","739f6681":"## An\u00e1lise inicial apenas com os dados num\u00e9ricos","83a8d585":"Agora com a vari\u00e1vel Occupation","29305332":"Para as colunas de Country e Workclass, como os valores de maior frequencia (Unitade-Satates e Private) aparecem muito mais vezes podemos substituir os valores desconhecidos por estes. J\u00e1 no caso do Occupation , como os dados s\u00e3o melhor divididos, podemos apenas manter o dado como desconhecido. ","af1fc4de":"# Dados faltantes:","28338691":"# Trabalhando com as vari\u00e1veis qualitativas","a7fbc644":"O primeiro que vamos adicionar \u00e9 a vari\u00e1vel Sex","88ca326a":"A vari\u00e1vel occupation j\u00e1 mostra um decr\u00e9scimo no valor da acur\u00e1cia m\u00e9dia e \u00e9 aqui que paramos de adicionar mais features na an\u00e1lise tomamos o conjunto anterior como o melhor.","6841a99f":"Com a vari\u00e1vel race houve um aumento maior que a da vari\u00e1vel Relationship, mas ainda pequeno, passando a acur\u00e1cia m\u00e9dia m\u00e1xima para 0,8535 com k = 26","48777d9a":"Vamos adicionar agora a vari\u00e1vel Race","cf0333d2":"A vari\u00e1vel Marital Status mostra novamente uma boa melhora em rela\u00e7\u00e3o as condi\u00e7\u00f5es anteriores, melhorando a acur\u00e1cia m\u00e9dia de 0,84 para 0.852, no melhor caso sendo para k=26.","a37d61d7":"A vari\u00e1vel relationship n\u00e3o adiciona muito \u00e0 acur\u00e1cia m\u00e9dia m\u00e1xima, muito provavelmente pela proximidade com a vari\u00e1vel Marital Status e seu valor de acur\u00e1cia m\u00e9dia m\u00e1xima ficou em 0,8524 com k=26.","ffda603d":"Analisando os plots acima podemos perceber que as vari\u00e1veis que mais possuem diferen\u00e7a da distribui\u00e7\u00e3o de renda entre as diferentes categorias s\u00e3o, em ordem: Sex, Marital Status e Relationship. Depois destas, com menor rela\u00e7\u00e3o ficam Race, Occupation e Country. Por fim, quase sem rela\u00e7\u00e3o, fica Workclass.","561b314d":"### Analisando a correla\u00e7\u00e3o entre as vari\u00e1veis","4467f556":"Agora vamos come\u00e7ar a adicionar os dados que se mostram mais relevantes para o modelo, enquanto testamos o mesmo atrav\u00e9s do cross validation e analisamos se ouve ou n\u00e3o uma melhoria","21e1ea66":"Adicionando a vari\u00e1vel Sex podemos ver que o classificador se comportou melhor, chegando a uma acur\u00e1cia m\u00e9dia m\u00e1xima de 0.8401 para k = 23","56b2c676":"Transformando as vari\u00e1veis n\u00famericas para inteiros.","9ffe3ca2":"Dessa forma, percebemos que s\u00f3 utilizando as vari\u00e1veis num\u00e9ricas o melhor K para o knn \u00e9 16, com uma acur\u00e1cia m\u00e9dia de 0,8362.","a6915fc5":"Ap\u00f3s fazer esta an\u00e1lise com os dados num\u00e9ricos, que com certeza impactam na target, podemos ir adicionando as outras vari\u00e1veis ","f7ba88e3":"Os dados quantitativos neste caso s\u00e3o Age, Education Num, Capital Gain, Capital Loss e Hour per week. Montando o DataSet com os dados num\u00e9ricos temos:"}}