{"cell_type":{"e45a943c":"code","5ad599b0":"code","1507202c":"code","853ca01d":"code","36fec7fd":"code","5db48c4b":"code","4bbd04af":"code","cfd7b11a":"code","e356ae74":"code","4d5f3c01":"code","765e11ca":"code","13e8ed32":"code","f3710b3a":"code","5231e941":"code","b0215fc1":"code","7cc44989":"code","b3e7dcc2":"code","13f48922":"code","c61ea882":"markdown","987639b3":"markdown","061d32d6":"markdown","64b59577":"markdown","89f17966":"markdown","44f79310":"markdown","294c8102":"markdown","625dcd70":"markdown","f404e1fb":"markdown","fb485fbf":"markdown","d337724e":"markdown","b5733180":"markdown","33f1e175":"markdown","7cc092e1":"markdown","75b4c4d7":"markdown","af187c16":"markdown","7f575280":"markdown","5d110cce":"markdown","1a22f6f0":"markdown","ccd72b15":"markdown","79fb3ae1":"markdown","c4216eb8":"markdown"},"source":{"e45a943c":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom datetime import datetime, timedelta\nimport warnings\nwarnings.filterwarnings(\"ignore\")","5ad599b0":"data = pd.read_csv('..\/input\/a4020102014\/a40_new.csv')\nfeatures = list(data.columns)\n\n# Converting str timestamps to pd.Timestamp\ndata['Date'] = pd.to_datetime(data['Date'],format='%m\/%d\/%Y')\n\n# Previewing different aspects of the data\n#print('Features of the Dataset:\\n\\n', features)\n#print('\\nData Type of different Features:\\n\\n', data.dtypes)\ndata.head()","1507202c":"numberOfDays = len(data.Date.unique())\nprint(\"Total number of Days: \", numberOfDays)\ntimePeriods = len(data.TimePeriod.unique())\nprint(\"Total number of TimePeriods: \", timePeriods)","853ca01d":"plt.figure(figsize=(20,5))\nplt.plot(data.index, data['Flow'])\nplt.title('Traffic Flow')\nplt.xlabel('Observation Index')\nplt.ylabel('Vehicle Count');\nplt.show(block=False)","36fec7fd":"avgAnnualData = data[['Flow']]\navgAnnualData['Year'] = data['Date'].apply(lambda x: datetime.strftime(x, '%Y'))\navgAnnualData = avgAnnualData.groupby('Year', as_index=False).mean()\n\nplt.figure(figsize=(10,5))\nplt.bar(avgAnnualData['Year'], avgAnnualData['Flow'])\nplt.title('Average Vehicle Flow for each Year')\nplt.xlabel('Year')\nplt.ylabel('Average Vehicle Count');\nplt.show(block=False)","5db48c4b":"# Converting the list of TimePeriod into HHMM 24-hr format\ntimeList = [datetime(2010, 1, 1, 0) + timedelta(minutes=15*x) for x in range(0, timePeriods)]\ntimeList=[x.strftime('%H%M') for x in timeList]\n\navgTimePeriodData = data[['TimePeriod', 'Flow']]\navgTimePeriodData = avgTimePeriodData.groupby('TimePeriod', as_index=False).mean()\n\nplt.figure(figsize=(20,5))\nplt.bar(avgTimePeriodData['TimePeriod'], avgTimePeriodData['Flow'])\nplt.xticks(np.arange(0,96), timeList, rotation='vertical')\nplt.title('Average Vehicle Flow for each TimePeriod of the day')\nplt.xlabel('TimePeriod')\nplt.ylabel('Vehicle Count');\nplt.show(block=False)","4bbd04af":"dayList = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']\n\nweekDayWiseAvgTPData = data[['TimePeriod', 'Flow']]\nweekDayWiseAvgTPData['Day'] = data['Date'].apply(lambda x: datetime.strftime(x, '%A'))\nweekDayWiseAvgTPData = weekDayWiseAvgTPData.groupby(['Day', 'TimePeriod'], as_index=False).mean()\n\nfig = plt.figure(figsize=(20,20))\nfig.tight_layout()\nfor i in range(7):\n    dataWeekly = weekDayWiseAvgTPData[weekDayWiseAvgTPData['Day'] == dayList[i]] # select dataframe with month = i\n    ax = fig.add_subplot(6,2,i+1) # add subplot in the i-th position on a grid 12x1  \n    ax.title.set_text('Average vehicle flow during the day for '+ dayList[i])\n    ax.plot(dataWeekly['TimePeriod'], dataWeekly['Flow'])\n    #ax.set_xticks(dataWeekly['TimePeriod'].unique()) # set x axis\n    ax.set_xticks([])\n    #ax.tick_params(labelrotation=90)","cfd7b11a":"avgDayOfWeekData = data[['Flow']]\navgDayOfWeekData['Day'] = data['Date'].apply(lambda x: x.weekday())#datetime.strftime(x, '%A'))\navgDayOfWeekData = avgDayOfWeekData.groupby(['Day'], as_index=False).mean()\navgDayOfWeekData['Day'] = avgDayOfWeekData['Day'].apply(lambda x: dayList[x])\n\nplt.figure(figsize=(10,5))\nplt.plot(avgDayOfWeekData['Day'], avgDayOfWeekData['Flow'])\nplt.xticks(np.arange(0,7), dayList, rotation='horizontal')\nplt.title('Average Vehicle Flow for each Day of Week')\nplt.xlabel('Day')\nplt.ylabel('Vehicle Count');\nplt.show(block=False)","e356ae74":"monthNumList = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12']\nmonthList= ['January','February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\n\nmthWiseAvgDayOfWeekData = data[['Flow']]\nmthWiseAvgDayOfWeekData['Day'] = data['Date'].apply(lambda x: x.weekday())#datetime.strftime(x, '%A'))\nmthWiseAvgDayOfWeekData['Month'] = data['Date'].apply(lambda x: datetime.strftime(x, '%m'))\nmthWiseAvgDayOfWeekData = mthWiseAvgDayOfWeekData.groupby(['Month','Day'], as_index=False).mean()\nmthWiseAvgDayOfWeekData['Day'] = mthWiseAvgDayOfWeekData['Day'].apply(lambda x: dayList[x])\n\nfig = plt.figure(figsize=(20,15))\nfig.tight_layout()\nfor i in range(12):\n    dataMonthly = mthWiseAvgDayOfWeekData[mthWiseAvgDayOfWeekData['Month'] == monthNumList[i]] # select dataframe with month = i\n    ax = fig.add_subplot(4,3,i+1) # add subplot in the i-th position on a grid 12x1  \n    ax.title.set_text('Average vehicle flow during the days for '+ monthList[i])\n    ax.plot(dataMonthly['Day'], dataMonthly['Flow'])\n    ax.set_xticks(dataMonthly['Day'].unique()) # set x axis\n    #ax.set_xticks([])\n    #ax.tick_params(labelrotation=45)","4d5f3c01":"monthWiseAvgData = data[['Flow']]\nmonthWiseAvgData['Month'] = data['Date'].apply(lambda x: datetime.strftime(x, '%m'))\nmonthWiseAvgData = monthWiseAvgData.groupby(['Month'], as_index=False).mean()\n\nplt.figure(figsize=(10,5))\nplt.bar(monthWiseAvgData['Month'], monthWiseAvgData['Flow'])\nplt.xticks(np.arange(0,12), monthList, rotation='vertical')\nplt.title('Average Vehicle Flow for each Month')\nplt.xlabel('Month')\nplt.ylabel('Vehicle Count');\nplt.show(block=False)","765e11ca":"yearList = ['2010','2011','2012','2013','2014']\nmonthWisePerYearAvgData = data[['Flow']]\nmonthWisePerYearAvgData['Month'] = data['Date'].apply(lambda x: datetime.strftime(x, '%m'))\nmonthWisePerYearAvgData['Year'] = data['Date'].apply(lambda x: datetime.strftime(x, '%Y'))\nmonthWisePerYearAvgData = monthWisePerYearAvgData.groupby(['Year', 'Month'], as_index=False).mean()\n\nfig = plt.figure(figsize=(20,20))\nfig.tight_layout()\nfor i in range(5):\n    dataYearly = monthWisePerYearAvgData[monthWisePerYearAvgData['Year'] == yearList[i]] # select dataframe with month = i\n    ax = fig.add_subplot(6,2,i+1) # add subplot in the i-th position on a grid 12x1  \n    ax.title.set_text('Average vehicle flow during the months for '+ yearList[i])\n    ax.plot(dataYearly['Month'], dataYearly['Flow'])\n    ax.set_xticks(dataYearly['Month'].unique()) # set x axis\n    #ax.set_xticks([])\n    #ax.tick_params(labelrotation=90)","13e8ed32":"'''\n# Function to plot the average daily data\n#dataTS.reset_index(level=0, inplace=True)\n#dataTS['Date'] = dataTS['Date'].apply(lambda x: datetime.strftime(x, '%Y-%m-%d'))\n#dataTS.groupby(dataTS.index).mean()\navgDailyData = data[['Date', 'Flow']]\navgDailyData = avgDailyData.groupby('Date').mean()\ndef plotDailyAvg(avgDailyData):\n    plt.figure(figsize=(20,5))\n    plt.plot(avgDailyData)\n    plt.title('Average Daily Vehicle Flow')\n    plt.xlabel('Date')\n    plt.ylabel('Vehicle Count');\n    plt.show(block=False)\n    # data.groupby('Date')['Flow'].mean().plot.line(figsize=(20,5))\n'''","f3710b3a":"# Preparing data for stationarity test\n# Combining 'Date' and 'Timeperiod' into a single Timestamp\ndataTS_Full = data[['Date', 'Flow']]\ndataTS_Full['Date'] = dataTS_Full['Date'].apply(lambda x: datetime.strftime(x, '%d-%m-%Y'))\ndataTS_Full['Date'] = dataTS_Full['Date'] + ' ' + data['TimePeriod']\ndataTS_Full['Date'] = dataTS_Full['Date'].apply(lambda x: datetime.strptime(x, '%d-%m-%Y %H:%M:%S'))\ndataTS_Full = dataTS_Full.rename(columns={'Date':'Timestamp'})\ndataTS_Full = dataTS_Full.set_index('Timestamp')\n\n# Converting the dataTS_Full df to series for Dickey-Fuller Test\ndataTS_Full = dataTS_Full['Flow']\n","5231e941":"# Extracting the 3 month subset\ndataTS = dataTS_Full['2010-01':'2010-03']\ndataTS.describe()","b0215fc1":"# Importing Dicky Fuller Test\nfrom statsmodels.tsa.stattools import adfuller\n\n# Defining the stationarity test function (Referred from Analytics Vidhya)\ndef stationarityTest(ts):\n    # Calculating the Moving Mean or Moving Average\n    rolMean = ts.rolling(96).mean()\n    # Calculating the Moving Standard Deviation (Variance = SD^2)\n    rolStd = ts.rolling(96).std()\n\n    # Plotting rolMean and rolStd with the TimeSeries\n    plt.figure(figsize=(20,5))\n    plt.plot(ts, label='Timeseries')\n    plt.plot(rolMean, color='red', label='Rolling Mean')\n    plt.plot(rolStd, color='green', label='Rolling SD')\n    plt.legend(loc='upper left')\n    plt.title('Rolling Mean & Standard Deviation')\n\n    # Performing the Dickey-Fuller test\n    print('Results of Augmented Dickey-Fuller Test:')\n    # The adfuller function takes data in series dtype\n    dfTest = adfuller(ts, autolag='AIC')\n    dfOutput = pd.Series(dfTest[0:4], index=['Test Statistic','p-value','#Lags Used','Number of Observations Used'])\n    for key,value in dfTest[4].items():\n        dfOutput['Critical Value \/ Significance Level (%s)'%key] = value\n    print(dfOutput)\n    \n# Performing the test on data\nstationarityTest(dataTS)","7cc44989":"# Importing decomposition function from statsmodels\nfrom statsmodels.tsa.seasonal import seasonal_decompose\n# Performing decomposition for a frequency of 1 week.\ndecomposition = seasonal_decompose(dataTS, freq=96*7)\n\ntrend = decomposition.trend\nseasonal = decomposition.seasonal\nresidual = decomposition.resid\n\nplt.figure(figsize=(20,10))\nplt.subplot(411)\nplt.plot(dataTS, label='Original')\nplt.legend(loc='upper left')\nplt.subplot(412)\nplt.plot(trend, label='Trend')\nplt.legend(loc='upper left')\nplt.subplot(413)\nplt.plot(seasonal,label='Seasonality')\nplt.legend(loc='upper left')\nplt.subplot(414)\nplt.plot(residual, label='Residuals')\nplt.legend(loc='upper left')\nplt.tight_layout()","b3e7dcc2":"# Checking stationarity of the weekly frequency timeseries by decomposition\nresidual.dropna(inplace=True)\nstationarityTest(residual)","13f48922":"from statsmodels.tsa.stattools import acf, pacf\nfrom statsmodels.graphics.tsaplots import plot_acf\nfrom statsmodels.graphics.tsaplots import plot_pacf\n\ndef acf_pacf_plot(ts, lags):\n    lagACF = acf(ts, nlags=lags)\n    lagPACF = pacf(ts, nlags=lags, method='ols')\n    \n    plt.figure(figsize=(20,5))\n    plot_acf(ts, ax=pyplot.gca(), lags=lags)\n    plt.plot(lagACF)\n    plt.axhline(y=-1.96\/np.sqrt(len(ts.dropna())),linestyle='--',color='gray')\n    plt.axhline(y=1.96\/np.sqrt(len(ts.dropna())),linestyle='--',color='gray')\n    \n    plt.figure(figsize=(20,5))\n    plot_pacf(series, ax=pyplot.gca(), lags=lags, method='ols')\n    plt.plot(lagPACF)\n    plt.axhline(y=-1.96\/np.sqrt(len(ts.dropna())),linestyle='--',color='gray')\n    plt.axhline(y=1.96\/np.sqrt(len(ts.dropna())),linestyle='--',color='gray')\nacf_pacf_plot(dataTS_Full, 40)","c61ea882":"### Feature Description\n- Date : The timestamp for a given day.\n- TimePeriod : Each day is split into 96 time slices at an interval of 15 minutes ((24*60)\/96 = 15).\n- AverageJT : The average time taken (in seconds) by the vehicles that traveled the road from start to end within each TimePeriod.\n- AverageSpeed : The average speed of the vehicles (in km\/hr) that traveled the road from start to end within each TimePeriod.\n- LinkLength : The distance of the road in kilometers.\n- Flow : The number of vehicles that passed through the road in each period of 15 minutes.\n- LinkRef \/ LinkDescription : These are constant and give information about the road. We will ignore.\n","987639b3":"**Observation**\n- The first graph illustrates the average flow of traffic during different days of week for the entire dataset.\n- The second graph illustrates the average flow of traffic during different days of the week for the individual months.\n- The graph shape of average plot and monthly plots are similar.\n\n**Conclusion:**\n- It can be safely concluded that there is a **weekly seasonality** in the data as similar patterns can be observed in traffic frequency for each week at a monthly scale.\n- The weekdays have more traffic with the highest reaching on Friday. The weekends have lesser traffic.","061d32d6":"### 2. Verifying Daily Seasonality\n**Claim:** The road traffic flow will dependent on the different hours of the day (rush hours vs off hours). Hence, **daily seasonality** can be expected.","64b59577":"**Observation**\n- The first graph illustrates the average flow of traffic during different time intervals of the day for the entire dataset.\n- The second graph illustrates the average flow of traffic during different time intervals of the day for the individual days of the week.\n- The graph shape of average plot and plots for weekdays are similar.\n- The graph shape for average plot and plots for weekends are not similar\n\n**Conclusion:**\n- It can be concluded that there is a **daily seasonality** in the data as similar patterns can be observed in traffic frequency for particular time intervals.\n- The rush hours for weekdays are around 11:45 in the morning and 16:15 in the evening.","89f17966":"### Import Libraries","44f79310":"### 4. Verifying Annual Seasonality\n**Claim:** The road traffic flow will dependent on the different months of the year, due to change in weather conditions. Hence **annual seasonality** can be expected.","294c8102":"### 1. Verifying Traffic Flow Trend\n**Claim:** With increase in time, the population of the area will probably increase. Hence, an **upward trend** can be expected in the traffic flow as the time goes by.","625dcd70":"**Observation**\n- The first graph illustrates the average flow of traffic during different months for the entire dataset.\n- The second graph illustrates the average flow of traffic during different months for each year.\n- The graph shape of average plot and yearly plots are similar.\n\n**Conclusion:**\n- It can be safely concluded that there is a **annual seasonality** in the data as similar patterns can be observed in traffic frequency for each month at an yearly scale.\n- The average traffic flow rises till August and then decreases till December-January.","f404e1fb":"**Inference**\n- Even upon decomposition, the test statistic is -16.49. Which is much lower than 1% significance level. Hence, we can conclude that the residual series is also stationary with 99% confidence.\n- P-value of 2.155886e-29 also proves that the null hypothesis is invalid for weekly seasonality.","fb485fbf":"**Observation:**\n- No trend can be identified.\n- No seasonality can be identified.\n\n**Conclusion:**\n- Further analysis required.","d337724e":"- PACF is significant till 3 lags.\n- ACF is geometric.\n\n**Inference**\n- The best model for this dataset is AR model with p=3.\n- For modeling with ARIMA, following can be used.\n\n> - From the given PACF plot, we can determine that the value of 'p' is 3.\n> - From the given ACF plot, we can determine that the value of 'q' is 24.","b5733180":"## D. Decomposition of Timeseries\n### Checking Weekly timeseries by performing Dickey-Fuller on the decomposed residual\n- Here we are performing a decomposition of the time series with a frequency interval of 1 week i.e. 96\\*7 data points.\n- This can help us in confirming whether weekly seasonality is affecting the stationarity of our time series.\n","33f1e175":"## C. Determining Stationarity of the Timeseries\n### Conditions for Stationarity of Time Series\n- The **mean** of the timeseries shouldn't be a function of time. It should be constant i.e. no rising or falling trend should be visible.\n- The **variance** of the timeseries (vertical spread of TS plot) shouldn't be a function of time. (Homoscedasticity).\n- The **covariance** of the i th term and (i+1)th term (Horizontal spread of TS) shouldn't be a function of time.\n\n### Dicky Fuller Test\n> - **Null-Hypothesis of the Dickey-Fuller test states that the timeseries is non-stationary (presence of unit root).**\n> - **Alternate Hypothesis of Dickey-Fuller test states that the times series is stationary (absence of unit root).**\n\n**For further analysis and processes we will perform the operations on a 3 month subset of data in dataframe 'dataTS'. This will help us by easing the plots for visual inferences.**","7cc092e1":"# Traffic Congestion - Data Exploration","75b4c4d7":"## E. Plotting ACF and PACF\nWe will use the best model out of AR, MA, ARMA and ARIMA models for forecasting in the modeling stage. So, in this section we will determine the various parameters that are required for the ARIMA model.\n> - 'p' or the number of Auto-Regressive terms: These are the lags of forecasted variable\n> - 'q' or the number of Moving-Average terms: These are the lagging forecasted error\n> - 'd' or number of differences: This is the number of non seasonal differences\n\n> - Autocorrelation Function (ACF): It is a measure of the correlation between the timeseries with a lagged version of itself. This will aid us in determining the value of 'q'.\n> - Partial Autocorrelation Function: It is a measure of the correlation between the timeseries with a lagges version of itself but after eliminating the variations already explained by the intervening comparisons. This will aid us in determining the value of 'p'.\n\n**A chart showing the right approach for choosing the AR and MA processes.**\n\n||ACF|PACF|\n|-|-|-|\n|AR|Geometric|Significant till N-lags|\n|MA|Significant till N-lags|Geometric|\n|ARMA|Geometric|Geometric","af187c16":"## B. Hypothesis Testing\n","7f575280":"**Observation**\n- From visual inspection it can be roughly estimated that the timeseries seems stationary.\n- The rolling mean and rolling standard deviation plots also appear to be constant.\n\n**Inference**\n- The p-value of 0 which is less than our 1% significance level value. This indicates that the null-hypothesis is invalid, with a certainity of 99%. Hence, timeseries is stationary.\n- The Test Statistic is much lower than Critical Values. Hence the null-hypothesis can be rejected. Hence, timeseries is stationary.","5d110cce":"### Import Data\nSince this just a time series analysis, no test-train data splitting is being performed.","1a22f6f0":"### 3. Verifying Weekly Seasonality\n**Claim:** The road traffic flow on weekdays will be greater than weekends. Hence **weekly seasonality** can be expected.","ccd72b15":"## A. Hypothesis\n\n### *Probable causes for Trend Component*\n1. With increase in time, the population of the area will probably increase. Hence, an **upward trend** can be expected in the traffic flow as the time goes by.\n\n### *Probable causes for Seasonality Component*\n2. The road traffic flow will dependent on the different hours of the day (rush hours vs off hours). Hence, **daily seasonality** can be expected.\n3. The road traffic flow on weekdays will be greater than weekends. Hence **weekly seasonality** can be expected.\n4. The road traffic flow will dependent on the different months of the year, due to change in weather conditions. Hence **annual seasonality** can be expected.\n\n>### *Probable Outliers*\n>1. Even if its a weekday, on national holidays road traffic flow will be different.\n>2. On account of road accidents \/ road repairs \/ natural calamities, the road traffic flow will be different.","79fb3ae1":"### Timeseries Plot - Observations vs Vehicle Count\nA simple line plot of all the observations.","c4216eb8":"**Obervation:**\n- The average annual traffic flow data is showing mixed trends. \n- For the first two years it is stationary. For the last three years its showing a rising trend.\n\n**Conclusion:** \n- The hypothesis cannot be deemed true for the given case."}}