{"cell_type":{"6315a08d":"code","a5ed98d3":"code","f63f1440":"code","e3aa1e9b":"code","12a0637b":"code","c806af83":"code","eecfc6a4":"code","f481e9ca":"code","fd9e93b9":"code","ecef5b4f":"code","f6b6ab51":"code","1586ba1c":"code","b82a1ffe":"code","3ac792cf":"code","ccabef87":"code","c2dbcbd5":"code","89bd0273":"code","840e4ace":"code","03b409ff":"code","080c3f88":"code","fdd09f78":"code","14e8a5f9":"code","0ffc5fa7":"markdown","4c13ff71":"markdown","d6cc45fa":"markdown","ce279879":"markdown","e2da8e9f":"markdown","9348f27d":"markdown"},"source":{"6315a08d":"import pandas as pd\nimport plotly.express as px\nimport matplotlib.pyplot as plt\nimport statsmodels.formula.api as sm\nimport seaborn as sns\nfrom sklearn.preprocessing import StandardScaler\n\n\ndf_coron=pd.read_csv(\"..\/input\/wind-coron\/coron_all.csv\",parse_dates=[\"time\"]).set_index(\"time\")\ndf_vigo=pd.read_csv(\"..\/input\/meteorological-model-versus-real-data\/vigo_model_vs_real.csv\",\n                           usecols=['mod_o','wind_gust_o','mod_4K',\"mod_36K\",\"datetime\",\"metar_o\"],index_col=\"datetime\",parse_dates=True)","a5ed98d3":"#mean speed ten minutes around exact hour\ndf={}\ndf[\"left\"]=df_coron[\"spd_o\"].resample(\"20min\").mean()\ndf[\"right\"]=df_coron[\"spd_o\"].resample(\"20min\",label='right',closed=\"right\").mean()\ndf_coron[\"spd_o_mean\"]=(df[\"left\"]+df[\"right\"])\/2\n\n#median speed one before\ndf_coron[\"spd_o_median\"]=df_coron[\"spd_o\"].resample(\"h\").quantile(.5)\n\n#display correlations and new columns\ndf_fil={}\n\n(df_coron[df_coron.mod_p>12])[[\"spd_o\",'mod_p', \"spd_o_median\",\"spd_o_mean\"]].dropna().describe()\n\n\n","f63f1440":"df_coron[[\"spd_o\",'mod_p', \"spd_o_median\",\"spd_o_mean\"]][df_coron.mod_p>12].describe()","e3aa1e9b":"\nfor speed in range (0,10,2):\n    \n    print(\"wind speed predicted > {} m\/s\".format(speed))\n    print((df_coron[[\"spd_o\",'mod_p', \"spd_o_median\",\"spd_o_mean\"]][df_coron.mod_p>speed]).corr().mod_p)   \n    print(\"**************************\")\n    \n","12a0637b":"for speed in range (0,10,2):\n    \n    print(\"wind speed predicted > {} m\/s\".format(speed))\n    print(((df_coron[df_coron.mod_p>speed])[[\"spd_o\",'mod_p', \"spd_o_median\",\"spd_o_mean\"]]).corr().mod_p)   \n    print(\"**************************\")","c806af83":"fig = px.scatter(df_coron.dropna(), x='mod_p',y='spd_o', trendline=\"ols\",)\nfig.show()","eecfc6a4":"fig = px.density_contour(df_coron, x=\"mod_p\", y=\"spd_o\")\nfig.show()","f481e9ca":"fig = px.scatter(df_coron.dropna(), x='mod_p',y='spd_o_median', trendline=\"ols\")\nfig.show()","fd9e93b9":"\ng=df_coron.spd_o.plot(kind=\"hist\", density=True,grid=True)","ecef5b4f":"df_coron[[\"mod_p\",\"spd_o\",\"spd_o_median\",\"spd_o_mean\"]].describe()","f6b6ab51":"formula='spd_o ~ mod_p'\nmodel=sm.ols(formula=formula,data=df_coron)\nfitted = model.fit()\nprint(fitted.summary())","1586ba1c":"\nres_anal=pd.DataFrame(data={\"residuals\":fitted.resid.values,\"std_residuals\":StandardScaler().fit_transform(fitted.resid.values.reshape(-1,1)).flatten()\n                  ,\"pred_spd\":fitted.predict(),})\ng1=res_anal[[\"residuals\",\"std_residuals\"]].plot(kind=\"kde\",grid=True, title=\"Coron residuals\")\n","b82a1ffe":"g=res_anal.std_residuals.plot(grid=True)","3ac792cf":"df_coron[\"dif_spd_o\"]=df_coron[\"mod_p\"]-df_coron[\"spd_o\"]\ndf_coron[\"dif_spd_median\"]=df_coron[\"mod_p\"]-df_coron[\"spd_o_median\"]\ndf_coron[\"dif_spd_mean\"]=df_coron[\"mod_p\"]-df_coron[\"spd_o_mean\"]\n\ndf_coron[\"residuals_linear_model\"]=fitted.resid\ng=df_coron[[\"dif_spd_o\",\"dif_spd_median\",\"dif_spd_mean\",\"residuals_linear_model\"]].plot(kind=\"box\",figsize=(10,10),grid=True,notch=5)\ndf_coron[[\"dif_spd_o\",\"dif_spd_median\",\"dif_spd_mean\",\"residuals_linear_model\"]].describe()","ccabef87":"fig = px.scatter(res_anal,x=\"pred_spd\", y=\"std_residuals\", trendline=\"ols\",)\nfig.show()","c2dbcbd5":"df_vigo.describe()","89bd0273":"df_vigo[[\"mod_4K\",\"mod_36K\",\"mod_o\"]].corr()","840e4ace":"g=sns.jointplot(x=\"mod_4K\", y=\"mod_o\", data=df_vigo, kind=\"reg\", )","03b409ff":"formula='mod_o ~ mod_4K'\nmodel=sm.ols(formula=formula,data=df_vigo)\nfitted = model.fit()\nprint(fitted.summary())","080c3f88":"res_anal=pd.DataFrame(data={\"residuals\":fitted.resid.values,\"std_residuals\":StandardScaler().fit_transform(fitted.resid.values.reshape(-1,1)).flatten()\n                  ,\"pred_spd\":fitted.predict(),})\ng1=res_anal[[\"residuals\",\"std_residuals\"]].plot(kind=\"kde\",grid=True,title=\"Vigo residuals\")","fdd09f78":"g=res_anal.std_residuals.plot(grid=True,title=\"Vigo residuals_std 4Km model\")","14e8a5f9":"df_vigo[\"dif_4K\"]=df_vigo[\"mod_o\"]-df_vigo[\"mod_4K\"]\ndf_vigo[\"dif_36K\"]=df_vigo[\"mod_o\"]-df_vigo[\"mod_36K\"]\ndf_vigo[\"residuals_linear_model_4K\"]=fitted.resid\ng=df_vigo[[\"dif_4K\",\"dif_36K\",\"residuals_linear_model_4K\"]].plot(kind=\"box\",grid=True,title=\"Vigo differences\")\ndf_vigo[[\"dif_4K\",\"dif_36K\",\"residuals_linear_model_4K\"]].describe()","0ffc5fa7":"**Vigo wind intensity regression**","4c13ff71":"Linear model fit","d6cc45fa":"**Calculating  mean speed  ten minutes around exact hour and median speed one hour before around exact hour**","ce279879":"**Differences**","e2da8e9f":"**Residuals analysis**","9348f27d":"***Results comparative***"}}