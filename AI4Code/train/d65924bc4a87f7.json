{"cell_type":{"3a0e82a4":"code","6aa368a8":"code","efb675f9":"code","293cb4e5":"code","36f795af":"code","1e991a91":"code","625a0fea":"code","93a80942":"code","ec479842":"code","a7419297":"code","f73a800a":"code","4e2d4e6d":"code","0f2db268":"code","0c5a17c6":"code","30ff7eff":"code","eb3bf8c4":"code","da766498":"code","007530d7":"code","cf3dd1f4":"code","4f3afb2a":"code","df06f64a":"code","e7f758e4":"code","de8f2aa0":"code","bf7b9b43":"code","5a1124b7":"code","138c603a":"code","7580672e":"code","6c3353c6":"code","4cdfcc96":"code","0dcababa":"code","c871b098":"code","f164e72b":"code","bf1b76b4":"code","acc1ea21":"code","e4924d04":"code","a17c5585":"code","fc8a3155":"code","4a2f708c":"code","6da3ac07":"code","0f631417":"code","d09be5a0":"code","c7afd7c1":"code","27da1a08":"code","8185547a":"code","5442add1":"code","0d320c8c":"code","cb2eb4fd":"code","0549b879":"code","5688ecda":"code","a1a85046":"code","7c0fda78":"code","aa53db0b":"code","01218e29":"code","b41aeff5":"code","c856aefe":"code","c4af1899":"code","c003b856":"code","cce7cdd5":"code","edcf50cb":"code","0de06ed6":"code","217ac57b":"code","58c162e5":"code","62da8e0c":"code","80ca57f8":"code","081795b3":"code","ca7059db":"code","3aa93950":"code","5f9da140":"code","76c0c8d0":"markdown","5a92a617":"markdown","95971085":"markdown","1bc1f0ce":"markdown","323a1ede":"markdown","dfa043b3":"markdown","e9c73a5a":"markdown","df740dae":"markdown","834e08a5":"markdown","4e272a83":"markdown","7f7d0304":"markdown","41b92f84":"markdown","8028b469":"markdown","7962dc75":"markdown","ebb690d4":"markdown","db898591":"markdown","78931c1e":"markdown","8fe7da70":"markdown","0edabc4c":"markdown","1e2e94e1":"markdown","047e154c":"markdown","225164ad":"markdown","df18560d":"markdown","c8435421":"markdown","0ac5acaa":"markdown","c4c099b5":"markdown","43b5911a":"markdown","2e841584":"markdown","431446d8":"markdown","05c55fd7":"markdown","f06e6345":"markdown","b38363fa":"markdown","974bd5ae":"markdown","6160010e":"markdown","bfe72e35":"markdown","3ff9d614":"markdown","5aa0f73f":"markdown","ee7b3ae2":"markdown","9e04d93a":"markdown","88c5dcc4":"markdown","b3307faa":"markdown","dcdc2279":"markdown","dbdc006d":"markdown","cb4878c6":"markdown","d30f83ee":"markdown"},"source":{"3a0e82a4":"%%bash\n\nls -l","6aa368a8":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\npd.set_option('display.max_columns', 500)","efb675f9":"train_trans = pd.read_csv('..\/input\/train_transaction.csv')\ntest_trans = pd.read_csv('..\/input\/test_transaction.csv')","293cb4e5":"SEED = 5000\ntrain_trans.sample(20, random_state=SEED)","36f795af":"train_trans.shape","1e991a91":"len(train_trans['TransactionID'].unique())","625a0fea":"fig = plt.figure(figsize=(10,7))\nsns.countplot(train_trans['isFraud'])","93a80942":"train_trans_stats = train_trans.describe(include='all')","ec479842":"train_trans_stats.loc['max', 'TransactionDT']","a7419297":"train_trans_stats.loc['min', 'TransactionDT']","f73a800a":"train_trans_stats.loc['max', 'TransactionDT'] \/ (60*60*24) \/ 30","4e2d4e6d":"train_trans_stats.loc['min', 'TransactionDT'] \/ (60*60*24)","0f2db268":"train_trans_stats.loc['na'] = train_trans.shape[0] - train_trans_stats.loc['count']","0c5a17c6":"fig, axes = plt.subplots(nrows=3, ncols=2, figsize = (15,20))\n\nfor ax, feature in zip(axes.flatten(), ['card' + str(x) for x in range(1,7)]):\n    ax.bar(train_trans[feature].value_counts().index, train_trans[feature].value_counts().values)\n    ax.set(title=feature.upper())","30ff7eff":"fig, axes = plt.subplots(nrows=1, ncols=2, figsize = (15,7), sharey=True)\n\nfor ax, card_type in zip(axes.flatten(), ['credit', 'debit']):\n    ax.bar(train_trans[train_trans['card6'] == card_type]['isFraud'].value_counts().index,\n           train_trans[train_trans['card6'] == card_type]['isFraud'].value_counts().values\/\\\n           train_trans[train_trans['card6'] == card_type]['isFraud'].value_counts().sum())\n    ax.set(title=card_type.upper())","eb3bf8c4":"fig, axes = plt.subplots(nrows=1, ncols=2, figsize = (15,7), sharey=True)\n\nfor ax, card_type in zip(axes.flatten(), ['visa', 'mastercard']):\n    ax.bar(train_trans[train_trans['card4'] == card_type]['isFraud'].value_counts().index,\n           train_trans[train_trans['card4'] == card_type]['isFraud'].value_counts().values\/\\\n           train_trans[train_trans['card4'] == card_type]['isFraud'].value_counts().sum())\n    ax.set(title=card_type.upper())","da766498":"fig, axes = plt.subplots(nrows=2, ncols=3, figsize = (15,7))\n\nfor ax, feature in zip(axes.flatten(), ['ProductCD', 'addr1', 'addr2', 'dist1','dist2']):\n    ax.bar(train_trans[feature].value_counts().index, train_trans[feature].value_counts().values)\n    ax.set(title=feature.upper())","007530d7":"p_emails = pd.DataFrame(data={'email_domains':train_trans['P_emaildomain'].value_counts().index,\n                      'email_counts':train_trans['P_emaildomain'].value_counts().values})\n\nr_emails = pd.DataFrame(data={'email_domains':train_trans['R_emaildomain'].value_counts().index,\n                      'email_counts':train_trans['R_emaildomain'].value_counts().values})","cf3dd1f4":"fig = plt.figure(figsize=(15,10))\n\nsns.set(style=\"whitegrid\")\n\nax = sns.barplot(x='email_counts', y='email_domains', data=p_emails)\n\n# Add a legend and informative axis label\nax.legend(ncol=2, loc=\"lower right\", frameon=True)\nax.set(xlim=(0, 250000), ylabel=\"\",\n       xlabel=\"'P' email domains (purchaser?)\")\nsns.despine(left=True, bottom=True)","4f3afb2a":"fig = plt.figure(figsize=(15,10))\n\nsns.set(style=\"whitegrid\")\n\nax = sns.barplot(x='email_counts', y='email_domains', data=r_emails)\n\n# Add a legend and informative axis label\nax.legend(ncol=2, loc=\"lower right\", frameon=True)\nax.set(xlim=(0, 250000), ylabel=\"\",\n       xlabel=\"'R' email domains (recipient?)\")\nsns.despine(left=True, bottom=True)","df06f64a":"fig, axes = plt.subplots(nrows=30, ncols=2, figsize = (15,120), sharey=True)\n\nfor ax, email_domain in zip(axes.flatten(), p_emails['email_domains']):\n    ax.bar(train_trans[train_trans['P_emaildomain'] == email_domain]['isFraud'].value_counts().index,\n           train_trans[train_trans['P_emaildomain'] == email_domain]['isFraud'].value_counts().values\/\\\n           train_trans[train_trans['P_emaildomain'] == email_domain]['isFraud'].value_counts().sum())\n    ax.set(title=email_domain.upper())","e7f758e4":"useful_p_domains = ['protonmail.com', 'mail.com', 'outlook.es', 'aim.com']","de8f2aa0":"p_train_emails = p_emails[p_emails['email_domains'].isin(useful_p_domains)]\np_train_emails['email_counts %'] = (p_train_emails['email_counts']*100)\/len(train_trans)\np_train_emails","bf7b9b43":"p_test_emails = pd.DataFrame(data={'email_domains':test_trans['P_emaildomain'].value_counts().index,\n                      'email_counts':test_trans['P_emaildomain'].value_counts().values})\n\np_test_emails = p_test_emails[p_test_emails['email_domains'].isin(useful_p_domains)]\np_test_emails['email_counts %'] = (p_test_emails['email_counts']*100)\/len(test_trans)\np_test_emails","5a1124b7":"fig, axes = plt.subplots(nrows=30, ncols=2, figsize = (15,120), sharey=True)\n\nfor ax, email_domain in zip(axes.flatten(), r_emails['email_domains']):\n    ax.bar(train_trans[train_trans['R_emaildomain'] == email_domain]['isFraud'].value_counts().index,\n           train_trans[train_trans['R_emaildomain'] == email_domain]['isFraud'].value_counts().values\/\\\n           train_trans[train_trans['R_emaildomain'] == email_domain]['isFraud'].value_counts().sum())\n    ax.set(title=email_domain.upper())","138c603a":"useful_r_domains = ['protonmail.com', 'mail.com', 'outlook.es', 'outlook.com', 'netzero.net']\nr_train_emails = r_emails[r_emails['email_domains'].isin(useful_r_domains)]\nr_train_emails['email_counts %'] = (r_train_emails['email_counts']*100)\/len(train_trans)\nr_train_emails","7580672e":"r_test_emails = pd.DataFrame(data={'email_domains':test_trans['R_emaildomain'].value_counts().index,\n                      'email_counts':test_trans['R_emaildomain'].value_counts().values})\n\nr_test_emails = r_test_emails[r_test_emails['email_domains'].isin(useful_r_domains)]\nr_test_emails['email_counts %'] = (r_test_emails['email_counts']*100)\/len(test_trans)\nr_test_emails","6c3353c6":"plt.figure(figsize=(15,9))\nsns.distplot(train_trans['TransactionAmt'])","4cdfcc96":"plt.figure(figsize=(15,9))\nsns.boxenplot(train_trans['TransactionAmt'])","0dcababa":"plt.figure(figsize=(15,9))\nsns.countplot(train_trans[train_trans['TransactionAmt'] > 30000]['isFraud'])","c871b098":"train_trans[train_trans['TransactionAmt'] > 30000]","f164e72b":"plt.figure(figsize=(15,9))\nsns.distplot(test_trans['TransactionAmt'])","bf1b76b4":"plt.figure(figsize=(15,9))\nsns.boxenplot(test_trans['TransactionAmt'])","acc1ea21":"train_trans['TransactionAmt'].describe()","e4924d04":"test_trans['TransactionAmt'].describe()","a17c5585":"plt.figure(figsize=(15,9))\nsns.distplot(train_trans[train_trans['TransactionAmt'] < 30000]['TransactionAmt'])","fc8a3155":"plt.figure(figsize=(15,9))\nsns.boxenplot(train_trans[train_trans['TransactionAmt'] < 30000]['TransactionAmt'])","4a2f708c":"train_trans[train_trans['TransactionAmt'] > 125]['isFraud'].value_counts()","6da3ac07":"fig, axes = plt.subplots(nrows=1, ncols=2, figsize = (15,7), sharey=True)\n\naxes = axes.flatten()\n\naxes[0].bar(train_trans[train_trans['TransactionAmt'] > 125]['isFraud'].value_counts().index,\n            train_trans[train_trans['TransactionAmt'] > 125]['isFraud'].value_counts().values\/\\\n            train_trans[train_trans['TransactionAmt'] > 125]['isFraud'].value_counts().sum())\naxes[0].set(title='Transaction amounts > 75th percentile'.upper(),\n            ylabel = 'Normalized count',\n            xlabel = 'isFraud')\n\naxes[1].bar(train_trans[train_trans['TransactionAmt'] < 125]['isFraud'].value_counts().index,\n            train_trans[train_trans['TransactionAmt'] < 125]['isFraud'].value_counts().values\/\\\n            train_trans[train_trans['TransactionAmt'] < 125]['isFraud'].value_counts().sum())\naxes[1].set(title='Transaction amounts < 75th percentile'.upper(),\n            ylabel = 'Normalized count',\n            xlabel = 'isFraud')","0f631417":"fig = plt.figure(figsize=(15,5))\nax = sns.barplot(x=train_trans_stats.columns, y=train_trans_stats.loc['na'])","d09be5a0":"fig = plt.figure(figsize=(15,10))\nax = sns.barplot(x=train_trans_stats.loc[:, (train_trans_stats.loc['na'] > 0) & (train_trans_stats.loc['na'] < 1500)].columns,\n                 y=train_trans_stats.loc[:, (train_trans_stats.loc['na'] > 0) & (train_trans_stats.loc['na'] < 1500)].loc['na'])\n","c7afd7c1":"'No. of featues without NaNs: {}'.format(len(train_trans_stats.loc[:, train_trans_stats.loc['na'] == 0].columns))","27da1a08":"fig = plt.figure(figsize=(15,10))\nax = sns.barplot(x=train_trans_stats.loc[:, train_trans_stats.loc['na'] > 450000].columns,\n                 y=train_trans_stats.loc[:, train_trans_stats.loc['na'] > 450000].loc['na'])","8185547a":"train_trans_stats.loc[:, train_trans_stats.loc['na'] > 450000].columns.values","5442add1":"v_features = train_trans_stats.loc[:, train_trans_stats.loc['na'] > 450000].columns.values[9:].tolist()","0d320c8c":"len(v_features)","cb2eb4fd":"fig = plt.figure(figsize=(15,10))\nax = sns.barplot(x=v_features[:30],\n                 y=train_trans_stats.loc[:, v_features[:30]].loc['na'])","0549b879":"train_trans['V138'].dtype","5688ecda":"plt.figure(figsize=(15,10))\nax = sns.violinplot(data=train_trans.loc[:, v_features])","a1a85046":"train_trans.loc[:, v_features].head(10)","7c0fda78":"fig, axes = plt.subplots(nrows=36, ncols=4, figsize = (15,120))\n\nfor ax, feature in zip(axes.flatten(), v_features):\n    ax.bar(train_trans[feature].value_counts().index, train_trans[feature].value_counts().values)\n    ax.set(title=feature.upper())","aa53db0b":"d_features = train_trans_stats.loc[:, train_trans_stats.loc['na'] > 450000].columns.values[2:8].tolist()","01218e29":"d_features","b41aeff5":"import matplotlib as mpl\nimport importlib\nimportlib.reload(mpl); importlib.reload(plt); importlib.reload(sns)","c856aefe":"fig, axes = plt.subplots(nrows=2, ncols=3, figsize = (15,10))\n\nfor ax, feature in zip(axes.flatten(), d_features):\n    ax.bar(train_trans[feature].value_counts().index, train_trans[feature].value_counts().values)\n    ax.set(title=feature.upper())","c4af1899":"fig, axes = plt.subplots(nrows=2, ncols=3, figsize = (15,10))\n\nfor ax, feature in zip(axes.flatten(), [feature for feature in d_features if feature not in 'D9']):\n    ax.bar(train_trans[feature].value_counts().index, train_trans[feature].value_counts().values)\n    ax.set(title=feature.upper())","c003b856":"train_trans_stats[d_features]","cce7cdd5":"fig = plt.figure(figsize=(15,10))\nax = sns.barplot(x=train_trans_stats.columns[:60], y=train_trans_stats.loc['na'][:60])","edcf50cb":"fig, axes = plt.subplots(nrows=2, ncols=4, figsize = (15,7))\n\nfor ax, feature in zip(axes.flatten(),\n                       train_trans.iloc[:, :60].loc[:, train_trans_stats.loc['na'][:60] > 500000].columns):\n    \n    ax.bar(train_trans[feature].value_counts().index, train_trans[feature].value_counts().values)\n    ax.set(title=feature.upper())","0de06ed6":"len([column for column in train_trans.columns.tolist() if column.startswith('D')])","217ac57b":"fig, axes = plt.subplots(nrows=4, ncols=4, figsize = (15,14))\n\nfor ax, feature in zip(axes.flatten(),\n                       [column for column in train_trans.columns.tolist() if column.startswith('D')]):\n    \n    ax.bar(train_trans[feature].value_counts().index, train_trans[feature].value_counts().values)\n    ax.set(title=feature.upper())","58c162e5":"train_trans_stats.loc[:, [column for column in train_trans.columns.tolist() if column.startswith('D')]]","62da8e0c":"correlations = train_trans.corr()['isFraud'].sort_values()","80ca57f8":"neg_corrs = correlations.head(10)\npos_corrs = correlations.tail(10)","081795b3":"corrs = pos_corrs.append(neg_corrs)","ca7059db":"corrs","3aa93950":"train_trans[corrs.index].corr()","5f9da140":"# Set up the matplotlib figure\nf, ax = plt.subplots(figsize=(11, 9))\n\n# Generate a custom diverging colormap\ncmap = sns.diverging_palette(220, 10, as_cmap=True)\n\n# Draw the heatmap with the mask and correct aspect ratio\nsns.heatmap(train_trans[corrs.index].corr(),  cmap=cmap, vmax=.3, center=0,\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5})","76c0c8d0":"Looks like too many simultaneous missing values between some of our features to calculate a correlation coefficient. Perhaps these features are dependent upon each other or another feature and cannot coexist.","5a92a617":"Slightly more fraudulent transactions above 125 - makes sense. If you're going to commit fraud, go big?","95971085":"These features among the first 60 may be missing values that can be imputed since the number of values missing don't seem to be systematic. These features are among:","1bc1f0ce":"The earliest cut off could be about 6 months ago with the latest cut off being 24 hours ago","323a1ede":"Each of the features is an int feature except for D9, which looks to be some sort of ratio or likelihood, and D8.","dfa043b3":"Quickly looking at the most positive and negative correlations with the target","e9c73a5a":"Quite a lot of missing values spread throughout dataset. A lot of features, that are presumably similar - particularly towards the right side of plot are consistently missing most of their values so this likely isn't an error in recording. The values are probably missing for a reason.","df740dae":"Similar counts between the two datasets. Happy days!","834e08a5":"Looking at transactions above the 75th percentile","4e272a83":"Calculating stats for the transaction data","7f7d0304":"# IEEE Fraud Detection Kaggle Competition\n## Exploratory Data Analysis\n\nThe objective of this notebook is to get an initial sense of the data and investigate the following properties:\n     - What kind of data do we have at hand?\n     - Get a sense of the target and its distribution\n     - Missing data\n     - Correlation between target and features\n     - Differences between train and test","41b92f84":"About the same across the board here.","8028b469":"Mostly the \"D\" features again. How many of these are there?","7962dc75":"Both domains dominated by gmail accounts. Let's see if theres any association between the domains and the label.","ebb690d4":"Looking at distributions of card features:","db898591":"protonmail.com will be important for our model as well as mail.com, outlook.es, and aim.com to lesser extents. There aren't many of these domains in the P_emaildomain column though, let's check their counts in test and double check their counts in train","78931c1e":"Yep looks like most of them are","8fe7da70":"Interesting! Looks like some more fraudulent transactions with credit cards for sure. Let's look at a similar breakdown between Visa and Mastercard. ","0edabc4c":"Let's check the distribution of transaction amounts","1e2e94e1":"Difficult to say what's going on here? Let's see if there's any similar rows in test.","047e154c":"Interesting that all the \"V\" features have values primarily at 0 or 1 have a positive skew. Again note that these are integers. It looks like they may be counts of values whose existence may possibly be determined by a categorical variable or variables elsewhere in the data. Let's see if this is similar for the \"D\" features that are missing a lot of values:","225164ad":"Mostly transactions around 0 but looks like some extremely expensive ones too around 30000. Are these extreme transactions straight up fraud?","df18560d":"Looks like even among the features that have the exact same number of missing values, we have pretty different distributions - but it's a bit difficult to tell from this plot due to differences in scale ","c8435421":"Despite a large number of missing values, most of these features (except for D9) seem to be positively skewed with the majority of their values around 0. Are most of them ints?","0ac5acaa":"ProductCD could be some sort of grouping for types of products purchased.\n\nInteresting that almost all of the addr2 values lie at 87 - maybe this really is a country code from a pretty homogenous dataset. Doesn't look like addr1 is an area code - no 264 code in the States anyway.","c4c099b5":"Yep - looks like a similar pattern here with even more of a concentration of values at 0. Let's see if we're still dealing with integers:","43b5911a":"Maybe these are seconds?","2e841584":"Looks like each of the D features follow a similar pattern except for D9 - let's remove this feature and re-plot","431446d8":"Looking at distributions of categorical variables","05c55fd7":"Initial observations:\n- from competition: \"The TransactionDT feature is a timedelta from a given reference datetime (not an actual timestamp).\" These could be seconds since transaction?\n- card features are categorical (from data tab) and related to physical(\/virtual?) card used to make online purchase\n- Is TransactionAmt the same currency throughout? Could this be normalized?\n- addr1 is area? addr2 is country?. Worth plotting their distributions\n- P_emaildomain and R_emaildomain for purchasing email address and recipient email address? Could be Amazon\/eBay sellers?\n- D features have a lot of missing values\n- M4 has values of M1, M2, M3, which are also features as well as some mystery M0\n- V features have a lot of missing values throughout in blocks. Seem to be mainly integer valued","f06e6345":"Looking at missing values among features:","b38363fa":"Let's plot all of their distributions","974bd5ae":"Nope. If anything, train is narrower around 0 than test is with the exception of the 30000 value outliers. Let's remove these and re-plot the train distribution","6160010e":"Let's look into some of these \"V\" features","bfe72e35":"These features with only a few missing values (comparitively) are also missing equal numbers of values so this probably isn't recording error.","3ff9d614":"A lot of visa cards and debit cards. Perhaps most fraud is committed using credit cards?","5aa0f73f":"Target distribution. Significant class imbalance in training data. Most cases are not fraud. We saw this previously in Home Credit Risk competition. Some sort of downsampling\/upsampling may be the way to go here.","ee7b3ae2":"Digging into features that are missing most of their values","9e04d93a":"Definitely more fraud with credit cards alright. ","88c5dcc4":"Looking at the features with most missing values here:","b3307faa":"Looks like these features have simultaneous missing values - it will be interesting to see how important these anonymised continuous features are to any models we train. Another interesting point to note is that each of these features seems to have integer values despite being decimal value types in the data.","dcdc2279":"That makes a lot more sense. It might be worthwhile to obtain a z-score for each value in this feature so we can easily see the variance between points","dbdc006d":"Looking at first 30:","cb4878c6":"Same again here. Good to see.","d30f83ee":"Nope. Could be missing values. Let's look at them:"}}