{"cell_type":{"0d36a535":"code","59900074":"code","d3431357":"code","4f7ffbd2":"code","69f0f635":"code","da4bfbba":"code","008e6b33":"code","e7905eb1":"code","e6dd2bde":"code","36728e33":"code","ef2c237e":"code","3d8e4214":"code","90d2d001":"code","e7c1c1b1":"code","72f5067a":"code","4b29502f":"code","2367804d":"code","835a3a08":"code","1507a88c":"code","b0b971cc":"code","a42ed565":"code","7f1d215d":"code","33a10871":"code","d531f816":"code","2428eb34":"code","a2eb053a":"code","1930a750":"code","3558016c":"code","24e9c7fc":"code","c61c8702":"code","bd9f73f4":"code","ae482761":"code","b087ae3c":"code","e64cab8d":"code","0b07e9ab":"code","20a3c1ef":"code","6f0861a7":"code","96edd397":"code","4fd54822":"code","a72aad9c":"code","4fc763a0":"code","cba5c1c5":"code","f7881caa":"code","5feeb79d":"code","0cf14a50":"code","743c38f6":"code","413f2ab8":"code","b480e8bb":"code","960a109d":"code","57777c06":"code","5cd3dbea":"code","e0010454":"code","b320f412":"code","b4ff5e27":"code","aac42c1c":"code","64aa8be3":"code","e64a077d":"code","10df129a":"code","232e6621":"code","e0ae0361":"code","f6ff6795":"code","ab59725f":"code","778da6a3":"code","60f546a8":"code","9fe0270f":"code","8ab7d539":"code","2d52d900":"code","6c0dc8fd":"code","1aee3762":"code","8fb4177c":"code","845a18f7":"code","f8d60f3d":"code","de15c4ea":"code","12155ab9":"code","3ee2bd6b":"code","6155c54d":"code","c48c715d":"code","5d2ffd57":"code","15d19f0f":"code","cea7bd63":"code","ae063eda":"code","85295a9a":"code","55626e96":"code","3eab8c31":"code","abfd1702":"code","d75176ca":"code","5f1e6092":"code","d9f0a20c":"code","4be89e79":"code","b1704060":"code","c63fd636":"code","e0759d5e":"code","75c229a4":"code","3a12ee74":"code","f3c3d300":"code","386fa470":"code","b5bfb3cd":"code","0052b8dd":"code","0b85e893":"code","beb10145":"code","622860d5":"code","f8392c82":"code","ad9a49e0":"code","e71c4167":"code","8c6896df":"code","5a25fa99":"code","a4db18e3":"code","966dc81b":"code","1d01d266":"code","5eac13f8":"code","9a52f9bd":"code","0b5b11a7":"code","baf1958e":"code","1d4d4503":"code","bbb30537":"code","96689da9":"code","fa21b426":"code","a60421c4":"code","988874f5":"code","b51df77f":"code","f75f9ad4":"code","4e344568":"code","72749bbc":"code","6881a3d8":"code","df31571f":"code","a63f0772":"code","3c6ada9c":"code","77939c92":"code","73b34499":"code","359952c7":"code","8261f623":"code","4bead637":"code","a96c4090":"code","e9456466":"code","7a585b9c":"code","6dfd9105":"code","30db60b3":"code","5cf24433":"markdown","97482257":"markdown","c5b131cd":"markdown","92447494":"markdown","5c450b46":"markdown","76ddff03":"markdown","23241c9f":"markdown","2b856ce7":"markdown","3d72e9a1":"markdown","832498e8":"markdown","b4810c3a":"markdown","f2f2abca":"markdown","82ad985c":"markdown","3bfacb28":"markdown","ec476264":"markdown","f44ab837":"markdown","ccb2b9be":"markdown","ef5de189":"markdown","9ab0ac70":"markdown","f13f33b0":"markdown","615dc0dc":"markdown","1022ca7b":"markdown","c9b17bdd":"markdown","ade5b046":"markdown","5e7c4e86":"markdown","c4b8b69c":"markdown","44ca515d":"markdown","09e896f5":"markdown","94cb3d8d":"markdown","0232e67e":"markdown","4745ecdb":"markdown","d1f504b8":"markdown","918d3517":"markdown","f23326af":"markdown","aa56086e":"markdown"},"source":{"0d36a535":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom matplotlib import rcParams\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn import tree","59900074":"features = pd.read_csv('..\/input\/walmart-recruiting-store-sales-forecasting\/features.csv.zip')\ntrain = pd.read_csv('..\/input\/walmart-recruiting-store-sales-forecasting\/train.csv.zip')\ntest = pd.read_csv('..\/input\/walmart-recruiting-store-sales-forecasting\/test.csv.zip')\nstores = pd.read_csv('..\/input\/walmart-recruiting-store-sales-forecasting\/stores.csv')","d3431357":"features.head()","4f7ffbd2":"features.tail()","69f0f635":"features.shape","da4bfbba":"features.info()","008e6b33":"features.isnull().sum()","e7905eb1":"features.describe()","e6dd2bde":"train.head()","36728e33":"train.tail()","ef2c237e":"train.info()","3d8e4214":"test.head()","90d2d001":"test.tail()","e7c1c1b1":"test.info()","72f5067a":"stores.head()","4b29502f":"stores.tail()","2367804d":"stores.info()","835a3a08":"features","1507a88c":"train","b0b971cc":"df = pd.merge(train, features, how = \"left\")\ndf","a42ed565":"df = pd.merge(df, stores, how = \"left\")\ndf","7f1d215d":"df.isnull().sum()","33a10871":"df.Date = pd.to_datetime(df.Date)","d531f816":"df.set_index(keys = \"Date\", inplace = True)","2428eb34":"df.head()","a2eb053a":"df.index","1930a750":"df.isnull().sum()","3558016c":"df.drop(axis = 1, columns = [\"MarkDown1\", \"MarkDown2\",\"MarkDown3\",\"MarkDown4\", \"MarkDown5\"], inplace = True)\ndf.head()","24e9c7fc":"df.Store = pd.Categorical(df.Store)\ndf.Dept = pd.Categorical(df.Dept)","c61c8702":"df.dtypes","bd9f73f4":"df.describe()","ae482761":"ax = sns.scatterplot(x = df.index , y =\"Weekly_Sales\", data = df)\nax.set_xlim(df.index.min(), df.index.max())\nfor item in ax.get_xticklabels():\n    item.set_rotation(90);","b087ae3c":"sns.boxplot(x = \"Weekly_Sales\", data = df);","e64cab8d":"df.Weekly_Sales[df.Weekly_Sales == max(df.Weekly_Sales)]","0b07e9ab":"top5_sales = list(df.Weekly_Sales.sort_values(ascending=False).head(5).values)\ntop5_sales","20a3c1ef":"df.loc[df.Weekly_Sales.isin(top5_sales)].sort_values(by = \"Weekly_Sales\", ascending = False)","6f0861a7":"df[['Store', 'Dept', 'Weekly_Sales', 'IsHoliday', 'Temperature',\n       'Fuel_Price', 'CPI', 'Unemployment', 'Type', 'Size']].plot(kind='box',subplots=1,layout=(3,5),figsize=(14,12))","96edd397":"plt.xlim(0, 150000)\nrcParams['figure.figsize'] = 1,6.0\nsns.distplot(df.Weekly_Sales, kde = False);","4fd54822":"rcParams['figure.figsize'] = 5,6.0\nsns.distplot(df.Unemployment, kde = False);","a72aad9c":"rcParams['figure.figsize'] = 14,5\nsns.lineplot(x = df.index, y = \"Weekly_Sales\", data = df);","4fc763a0":"rcParams['figure.figsize'] = 16.0,6.0\nsns.barplot(x = \"Store\", y = \"Weekly_Sales\", data = df);","cba5c1c5":"rcParams['figure.figsize'] = 16.0,6.0\nsns.barplot(x = \"Dept\", y = \"Weekly_Sales\", data = df);","f7881caa":"rcParams['figure.figsize'] = 10,6.0\nsns.lineplot(x = \"Fuel_Price\", y = \"Weekly_Sales\", data = df);","5feeb79d":"rcParams['figure.figsize'] = 10,6.0\nsns.lineplot(x = \"CPI\", y = \"Weekly_Sales\", data = df);","0cf14a50":"rcParams['figure.figsize'] = 10,6.0\nsns.lineplot(x = \"Unemployment\", y = \"Weekly_Sales\", data = df);","743c38f6":"rcParams['figure.figsize'] = 16,6.0\nsns.lineplot(x = df.index, y = \"Weekly_Sales\", hue = \"Type\", data = df);","413f2ab8":"sns.boxplot(x = \"Type\", y = \"Size\", data = df);","b480e8bb":"sns.lineplot(x = \"Size\" , y = \"Weekly_Sales\", hue = \"Type\", data = df);","960a109d":"rcParams['figure.figsize'] = 10,6.0\nsns.lineplot(x = \"Temperature\" , y = \"Weekly_Sales\", data = df);","57777c06":"sns.lineplot(x = df.index.month, y = \"Weekly_Sales\", data = df);","5cd3dbea":"sns.lineplot(x = df.index.month, y = \"Weekly_Sales\", hue = \"IsHoliday\", data = df);","e0010454":"sns.heatmap(df.corr(), vmin = -1, vmax = 1, annot = True);","b320f412":"df.dtypes","b4ff5e27":"df.IsHoliday = pd.Categorical(df.IsHoliday)\ndf.Type = pd.Categorical(df.Type)","aac42c1c":"df.dtypes","64aa8be3":"df","e64a077d":"df_X = df.drop(\"Weekly_Sales\", axis = 1)\ndf_X","10df129a":"df_Y = df.Weekly_Sales\ndf_Y","232e6621":"df_X = pd.get_dummies(df_X, drop_first = True)","e0ae0361":"df_X.reset_index(inplace = True)","f6ff6795":"df_X = df_X.iloc[:,1:]\ndf_X","ab59725f":"from sklearn.model_selection import train_test_split\ndf_X_train, df_X_validation, df_Y_train, df_Y_validation = train_test_split(df_X , df_Y, test_size = 0.2)","778da6a3":"df_X_train.head()","60f546a8":"df_X_validation","9fe0270f":"lm = LinearRegression()","8ab7d539":"model = lm.fit(df_X_train, df_Y_train)","2d52d900":"lm.score(df_X_validation, df_Y_validation)","6c0dc8fd":"lm.score(df_X_train, df_Y_train)","1aee3762":"from sklearn.model_selection import train_test_split, cross_val_score, cross_val_predict","8fb4177c":"cross_val_score(model, df_X_train, df_Y_train, cv = 10, scoring = \"r2\").mean()","845a18f7":"np.sqrt(-cross_val_score(model, \n                df_X_train, \n                df_Y_train, \n                cv = 10, \n                scoring = \"neg_mean_squared_error\")).mean()","f8d60f3d":"y_pred = lm.predict(df_X_validation)","de15c4ea":"y_pred","12155ab9":"from sklearn.metrics import mean_squared_error, r2_score","3ee2bd6b":"mse = mean_squared_error(df_Y_validation, y_pred)\nmse","6155c54d":"rmse = np.sqrt(mse)\nrmse","c48c715d":"df_Y.values.mean()","5d2ffd57":"clf = tree.DecisionTreeRegressor()","15d19f0f":"model = clf.fit(df_X_train, df_Y_train)","cea7bd63":"clf.score(df_X_validation, df_Y_validation)","ae063eda":"cross_val_score(model, df_X_train, df_Y_train, cv = 10, scoring = \"r2\").mean()","85295a9a":"y_pred = clf.predict(df_X_validation)","55626e96":"mse = mean_squared_error(df_Y_validation, y_pred)\nmse","3eab8c31":"rmse = np.sqrt(mse)\nrmse","abfd1702":"from xgboost import XGBRegressor","d75176ca":"xgb_model = XGBRegressor().fit(df_X_train, df_Y_train)","5f1e6092":"xgb_model.score(df_X_validation, df_Y_validation)","d9f0a20c":"y_pred = xgb_model.predict(df_X_validation)","4be89e79":"from sklearn.metrics import mean_squared_error","b1704060":"np.sqrt(mean_squared_error(df_Y_validation, y_pred))","c63fd636":"from lightgbm import LGBMRegressor","e0759d5e":"lgbm = LGBMRegressor()\nlgbm_model = lgbm.fit(df_X_train, df_Y_train)","75c229a4":"lgbm_model.score(df_X_validation, df_Y_validation)","3a12ee74":"y_pred = lgbm_model.predict(df_X_validation)","f3c3d300":"rmse = np.sqrt(mean_squared_error(df_Y_validation, y_pred))\nrmse","386fa470":"lgbm_grid = {'n_estimators': [20, 40, 100, 200, 500, 1000],\n             'learning_rate': [0.1, 0.01, 0.5]}","b5bfb3cd":"from sklearn.model_selection import GridSearchCV","0052b8dd":"lgbm = LGBMRegressor()\nlgbm_cv_model = GridSearchCV(lgbm, lgbm_grid, cv=5, n_jobs = -1, verbose = 2)","0b85e893":"lgbm_cv_model.fit(df_X_train, df_Y_train)","beb10145":"lgbm_cv_model.best_params_","622860d5":"lgbm_tuned = LGBMRegressor(learning_rate = 0.5, n_estimators = 1000)\n\nlgbm_tuned = lgbm_tuned.fit(df_X_train, df_Y_train)","f8392c82":"y_pred = lgbm_tuned.predict(df_X_validation)","ad9a49e0":"np.sqrt(mean_squared_error(df_Y_validation, y_pred))","e71c4167":"lgbm_tuned.score(df_X_validation, df_Y_validation)","8c6896df":"test.head()","5a25fa99":"features.head()","a4db18e3":"stores.head()","966dc81b":"df_test = pd.merge(test, features, how = \"inner\")\ndf_test","1d01d266":"df_test = pd.merge(df_test, stores, how = \"inner\")\ndf_test","5eac13f8":"df_test.info()","9a52f9bd":"df_test.drop(axis = 1, columns = [\"MarkDown1\", \"MarkDown2\",\"MarkDown3\",\"MarkDown4\", \"MarkDown5\"], inplace = True)\ndf_test.head()","0b5b11a7":"df_test.info()","baf1958e":"df_test.Date = pd.to_datetime(df_test.Date)\ndf_test.set_index(keys = \"Date\", inplace = True)\ndf_test.head()","1d4d4503":"df_test.IsHoliday = pd.Categorical(df_test.IsHoliday)\ndf_test.Store = pd.Categorical(df_test.Store)\ndf_test.Dept = pd.Categorical(df_test.Dept)\ndf_test.Type = pd.Categorical(df_test.Type)","bbb30537":"df_test.dtypes","96689da9":"df_test.describe()","fa21b426":"(115064-76902)\/115064","a60421c4":"df_test","988874f5":"df_test.dropna(inplace = True)","b51df77f":"df_test.head()","f75f9ad4":"df_test.info()","4e344568":"dftest_X = df_test ","72749bbc":"dftest_X.head()","6881a3d8":"dftest_X.reset_index(inplace = True)","df31571f":"dftest_X.head()","a63f0772":"dftest_X = dftest_X.iloc[:,1:]","3c6ada9c":"dftest_X.head()","77939c92":"dftest_X = pd.get_dummies(dftest_X, drop_first = True)","73b34499":"predictions = lgbm_tuned.predict(dftest_X)\npredictions","359952c7":"predictions.dtype","8261f623":"predictions = pd.Series(predictions)","4bead637":"predictions.describe()","a96c4090":"df_test","e9456466":"df_test[\"Prediction_Sales\"] = predictions","7a585b9c":"df_test","6dfd9105":"df_test.describe()","30db60b3":"sns.lineplot(x = df_test.Date, y = \"Prediction_Sales\", data = df_test);","5cf24433":"\"Test\", \"Features\" and \"Stores tables are merged. ","97482257":"### **Barplot and lineplot diagrams for each variable**","c5b131cd":"Four different tables are added. When we look at the beginning and end, we observe that it begins with 2010-02-05 and ends with 2013-07-26.","92447494":"### ML Algorithms ","5c450b46":"No missing values in \"stores\" table.","76ddff03":"Logistic Regression, Decision Tree, XGBoost and Light GBM models are applied. Best rmse value observed in tuned Light GBM model (4645). R2 is 96%. Therefore, final prediction will be done with tuned Light GBM model.","23241c9f":"Missing value rate of CPI and Unemployment variables are too much. Since they are included in the model, the missing observations are deleted.  ","2b856ce7":"Sales rate by store type: (A>B>C). ","3d72e9a1":"As in \"Features\" table, \"Train\" table starts with 2010-02-05 but it ends with 2012-10-26. The amount of sales and holiday information stand on the table. In addition there are store and departmant values. ","832498e8":"# 2. Data Observation","b4810c3a":"**Model Validation and Tuning**","f2f2abca":"# 4. Data Visualization","82ad985c":"**DECISION TREE**","3bfacb28":"# 3. Data Manipulation","ec476264":"**LINEAR REGRESSION**","f44ab837":"Below the amount of missing values are calculated. More than half of the observations are missing in Markdown variables. ","ccb2b9be":"There are no missing values in \"Train\" table.","ef5de189":"Markdown variables were not in the model, so they are also dropped in \"test\" table. ","9ab0ac70":"Markdown variables are dropped becuase more than half of the observations are missing.","f13f33b0":"### Prediction","615dc0dc":"No missing values in \"test\" table. ","1022ca7b":" **XGBoost**","c9b17bdd":"# 5. Correlation","ade5b046":"# 1. Library and Data Loading","5e7c4e86":" **Light GBM**","c4b8b69c":"Store size is also aligned with A>B>C. So it is correlated to sales rate.","44ca515d":"# Walmart Stores Sales Forecasting\n**Kaan Akkartal**","09e896f5":"Because of the possible outlier values \"Weekly_Sales\" and \"Unemployment\" variables are observed. Unlike \"Weekly_Sales\", \"Unemployment\" values are close to normal distribution. ","94cb3d8d":"Boxplotting for each variable. ","0232e67e":"\"Test\" table begins where \"Train\" table ends in terms of date. So it starts with \"2012-11-02\". ","4745ecdb":"# 6. Modelling","d1f504b8":"There are missing values in Markdown, CPI and Unemployment variables.","918d3517":"Top 5 sales take place in Thank's Giving week.","f23326af":"### Model Preparation","aa56086e":"Sales are increased dramaticly on year ends. Christmas and Thank's Giving affect those values directly."}}