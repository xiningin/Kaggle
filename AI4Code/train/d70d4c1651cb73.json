{"cell_type":{"7b6636e5":"code","c1371abb":"code","7ed4a3ba":"code","b3eeb1fc":"code","81ec2bcd":"code","05ef0327":"code","3725cc47":"code","92a4cbd4":"code","bb8cd3a2":"code","d60334fb":"code","50fac086":"code","65e8fdbd":"code","b2dbdcff":"code","e3b0f8ed":"code","a5109e3c":"markdown","d90e9ff0":"markdown","113be21c":"markdown","b1e6b8c9":"markdown","ffc87f92":"markdown","fb1b3f72":"markdown","ff62916e":"markdown","074cfe71":"markdown","2cc6e14a":"markdown","c3ddf83d":"markdown","dd9ca623":"markdown"},"source":{"7b6636e5":"# Import all the necessary Library \nimport torchvision\nimport torch.utils.data as utils\nfrom torchvision import datasets\nimport torchvision.transforms as transforms\nfrom torch.utils.data import DataLoader,Dataset\nfrom torch.autograd import Variable\nimport matplotlib.pyplot as plt\nimport torchvision.utils\nimport numpy as np\nimport time\nimport copy\nfrom torch.optim import lr_scheduler\nimport os\nfrom PIL import Image\nimport torch\nfrom torch.autograd import Variable\nimport PIL.ImageOps    \nimport torch.nn as nn\nfrom torch import optim\nimport torch.nn.functional as F\nimport pandas as pd \n","c1371abb":"def imshow(img,text=None,should_save=False):\n    npimg = img.numpy()\n    plt.axis(\"off\")\n    if text:\n        plt.text(75, 8, text, style='italic',fontweight='bold',\n            bbox={'facecolor':'white', 'alpha':0.8, 'pad':10})\n    plt.imshow(np.transpose(npimg, (1, 2, 0)))\n    plt.show()    \n\ndef show_plot(iteration,loss):\n    plt.plot(iteration,loss)\n    plt.show()","7ed4a3ba":"# First, look at everything.\nfrom subprocess import check_output\nprint(check_output([\"ls\", \"..\/input\/signature-verification-dataset\/sign_data\"]).decode(\"utf8\"))\n\n","b3eeb1fc":"class Config():\n    training_dir = \"..\/input\/sign_data\/sign_data\/train\"\n    testing_dir = \"..\/input\/sign_data\/sign_data\/test\"\n    train_batch_size = 32\n    train_number_epochs = 20","81ec2bcd":"training_dir=\"..\/input\/signature-verification-dataset\/sign_data\/train\"\ntraining_csv=\"..\/input\/signature-verification-dataset\/sign_data\/train_data.csv\"\ntesting_csv=\"..\/input\/signature-verification-dataset\/sign_data\/test_data.csv\"\ntesting_dir=\"..\/input\/signature-verification-dataset\/sign_data\/test\"","05ef0327":"class SiameseNetworkDataset():\n    \n    def __init__(self,training_csv=None,training_dir=None,transform=None):\n        # used to prepare the labels and images path\n        self.training_df=pd.read_csv(training_csv)\n        self.training_df.columns =[\"image1\",\"image2\",\"label\"]\n        self.training_dir = training_dir    \n        self.transform = transform\n\n    def __getitem__(self,index):\n        \n        # getting the image path\n        image1_path=os.path.join(self.training_dir,self.training_df.iat[index,0])\n        image2_path=os.path.join(self.training_dir,self.training_df.iat[index,1])\n        \n        \n        # Loading the image\n        img0 = Image.open(image1_path)\n        img1 = Image.open(image2_path)\n        img0 = img0.convert(\"L\")\n        img1 = img1.convert(\"L\")\n        \n        # Apply image transformations\n        if self.transform is not None:\n            img0 = self.transform(img0)\n            img1 = self.transform(img1)\n        \n        return img0, img1 , torch.from_numpy(np.array([int(self.training_df.iat[index,2])],dtype=np.float32))\n    \n    def __len__(self):\n        return len(self.training_df)","3725cc47":"# Load the the dataset from raw image folders\nsiamese_dataset = SiameseNetworkDataset(training_csv,training_dir,\n                                        transform=transforms.Compose([transforms.Resize((105,105)),\n                                                                      transforms.ToTensor()\n                                                                      ])\n                                       )","92a4cbd4":"# Viewing the sample of images and to check whether its loading properly\nvis_dataloader = DataLoader(siamese_dataset,\n                        shuffle=True,\n                        batch_size=8)\ndataiter = iter(vis_dataloader)\n\n\nexample_batch = next(dataiter)\nconcatenated = torch.cat((example_batch[0],example_batch[1]),0)\nimshow(torchvision.utils.make_grid(concatenated))\nprint(example_batch[2].numpy())","bb8cd3a2":"class SiameseNetwork(nn.Module):\n    def __init__(self):\n        super(SiameseNetwork, self).__init__()\n        \n        # Setting up the Sequential of CNN Layers\n        self.cnn1 = nn.Sequential(\n            \n            nn.Conv2d(1, 96, kernel_size=11,stride=1),\n            nn.ReLU(inplace=True),\n            nn.LocalResponseNorm(5,alpha=0.0001,beta=0.75,k=2),\n            nn.MaxPool2d(3, stride=2),\n            \n            nn.Conv2d(96, 256, kernel_size=5,stride=1,padding=2),\n            nn.ReLU(inplace=True),\n            nn.LocalResponseNorm(5,alpha=0.0001,beta=0.75,k=2),\n            nn.MaxPool2d(3, stride=2),\n            nn.Dropout2d(p=0.3),\n\n            nn.Conv2d(256,384 , kernel_size=3,stride=1,padding=1),\n            nn.ReLU(inplace=True),\n            nn.Conv2d(384,256 , kernel_size=3,stride=1,padding=1),\n            nn.ReLU(inplace=True),\n            nn.MaxPool2d(3, stride=2),\n            nn.Dropout2d(p=0.3),\n\n        )\n        \n        # Defining the fully connected layers\n        self.fc1 = nn.Sequential(\n            nn.Linear(30976, 1024),\n            nn.ReLU(inplace=True),\n            nn.Dropout2d(p=0.5),\n            \n            nn.Linear(1024, 128),\n            nn.ReLU(inplace=True),\n            \n            nn.Linear(128,2))\n        \n  \n  \n    def forward_once(self, x):\n        # Forward pass \n        output = self.cnn1(x)\n        output = output.view(output.size()[0], -1)\n        output = self.fc1(output)\n        return output\n\n    def forward(self, input1, input2):\n        # forward pass of input 1\n        output1 = self.forward_once(input1)\n        # forward pass of input 2\n        output2 = self.forward_once(input2)\n        return output1, output2\n","d60334fb":"# Check whether you have GPU is loaded or not\nif torch.cuda.is_available():\n    print('Yes')","50fac086":"# device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')\n# # Train the model\n# model = train()\n# torch.save(model.state_dict(), \"model.pt\")\n# print(\"Model Saved Successfully\")","65e8fdbd":"# Load the saved model\ndevice = torch.device('cuda' if torch.cuda.is_available() else 'cpu')\nmodel = SiameseNetwork().to(device)\nmodel.load_state_dict(torch.load(\"..\/input\/siamese-model1\/model.pt\"))","b2dbdcff":"# Load the test dataset\ntest_dataset = SiameseNetworkDataset(training_csv=testing_csv,training_dir=testing_dir,\n                                        transform=transforms.Compose([transforms.Resize((105,105)),\n                                                                      transforms.ToTensor()\n                                                                      ])\n                                       )\n\ntest_dataloader = DataLoader(test_dataset,num_workers=6,batch_size=1,shuffle=True)","e3b0f8ed":"# Print the sample outputs to view its dissimilarity\ncounter=0\nlist_0 = torch.FloatTensor([[0]])\nlist_1 = torch.FloatTensor([[1]])\nfor i, data in enumerate(test_dataloader,0): \n  x0, x1 , label = data\n  concatenated = torch.cat((x0,x1),0)\n  output1,output2 = model(x0.to(device),x1.to(device))\n  eucledian_distance = F.pairwise_distance(output1, output2)\n  if label==list_0:\n    label=\"Orginial\"\n  else:\n    label=\"Forged\"\n  imshow(torchvision.utils.make_grid(concatenated),'Dissimilarity: {:.2f} Label: {}'.format(eucledian_distance.item(),label))\n  counter=counter+1\n  if counter ==20:\n     break","a5109e3c":"# Siamese Neural Network\n\nSiamese neural network is a class of neural network architectures that contain two or more identical sub networks. identical here means they have the same configuration with the same parameters and weights. Parameter updating is mirrored across both sub networks.It is used find the similarity of the inputs by comparing its feature vectors.\n\nFor more details check this blog : https:\/\/innovationincubator.com\/siamese-neural-network-with-code-example\/","d90e9ff0":"## Import and Install all the necessary packages","113be21c":"### Preprocessing and Loading Dataset\n\nWe preprocessed all the images and loaded them as .npy files which is easy to transfer . You can follow your own preprocessing steps .\n","b1e6b8c9":"Let's  go step wise ","ffc87f92":"### Train the Model","fb1b3f72":"## Load Dataset :\n\nDatasets can be downloaded from this Link:  https:\/\/drive.google.com\/file\/d\/1q03FLpaolm6Jq5vM0a_AEnjJoqjtxgP8\/view?usp=sharing\n\n**Copy the dataset directly to your drive and load it from there**","ff62916e":"# Test the Model","074cfe71":"## Siamese Network Definition","2cc6e14a":"### Additional Utility Functions ","c3ddf83d":"### Loss Function","dd9ca623":"## Steps to create classifier using Siamese Neural Network \n\n\n1.   **Data Preprocessing**\n2.   **Define the Siamese Network**\n3.   **Feature Vector Extraction**\n4.   **Similarity Score Calculation**\n5.   **Defininf Loss Function**\n6.   **Optimizer**\n7.   **Testing using One-Shot Learnig**\n8.   **Making Predictions**\n\n"}}