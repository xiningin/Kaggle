{"cell_type":{"baf2f241":"code","3409f5a3":"code","d2100839":"code","10c3cefe":"code","797a1d24":"code","310b96d7":"markdown","bf105866":"markdown"},"source":{"baf2f241":"import numpy as np \nimport pandas as pd\n\nfrom PIL import Image, ImageDraw","3409f5a3":"BASEPATH = \"..\/input\/seti-breakthrough-listen\"\ndf_train = pd.read_csv(f\"{BASEPATH}\/train_labels.csv\")","d2100839":"def get_img(id, type=\"train\", normalize=False, thumbsize=None, colorize=False, add_id=False):    \n    f = f\"{BASEPATH}\/{type}\/{id[0]}\/{id}.npy\"\n    x = np.load(f\"{BASEPATH}\/{type}\/{id[0]}\/{id}.npy\")\n    c,h,w = x.shape\n    x = np.vstack(x).astype(np.float32)\n    \n    if normalize:\n        x = ((x - np.mean(x, axis=0)) \/ np.std(x, axis=0)).T\n        x = ((x - np.mean(x, axis=0)) \/ np.std(x, axis=0)).T\n\n    x = ((np.clip(x, -1, 3) + 1) \/ 4 * 255).astype(np.uint8)\n    \n    if colorize:\n        x = np.stack([x]*3, axis=2)\n        for i in range(0,6,2):\n            x[h*i    :h*(i+1), :, 2] = 0\n            x[h*(i+1):h*(i+2), :, 0] = 0\n    \n    \n    if colorize:\n        x = Image.fromarray(x)\n    else:\n        x = Image.fromarray(x, mode=\"L\")\n    \n    if thumbsize is not None:\n        x = x.resize(thumbsize, resample=Image.LANCZOS)\n    \n    if add_id:\n        d = ImageDraw.Draw(x)\n        d.text((1,1), id, fill=(0,0,0))\n        d.text((0,0), id, fill=(127,127,255))\n        \n    return x    ","10c3cefe":"for key, row in df_train.loc[df_train.target==1].head(10).iterrows():\n    print(f\"Example-ID: {row.id} - Target: {row.target}\")\n    mosaic = mosaic = Image.new(mode='RGB', size=(256*2+1, 256), color=(0,0,127))\n    mosaic.paste(get_img(row.id, normalize=False, thumbsize=(256,256)), (0, 0))\n    mosaic.paste(get_img(row.id, normalize=True, thumbsize=(256,256), colorize=True), (257, 0))    \n    display(mosaic)\n    \n# LEFT = no normalization\n# RIGHT = normalization by freq and timestep (i.e. row and column)","797a1d24":"all_needles = df_train.loc[df_train.target==1].id.values\ngrid_x = 6\ngrid_y = 6\nthumb_size = (128, 128)\npage_size = grid_x*grid_y\npage = 0\n\ndef show_page(page):\n    mosaic = mosaic = Image.new(mode='RGB', size=(thumb_size[0]*grid_x + grid_x-1, \n                                                  thumb_size[1]*grid_y + grid_y-1), color=(0,0,127))\n\n    for pos, idx in enumerate(all_needles[page*page_size : (page+1)*page_size]):\n        x = pos % grid_x\n        x = x*thumb_size[0] + x-1\n        y = pos \/\/ grid_x\n        y = y*thumb_size[1] + y-1\n        img = get_img(idx, normalize=True, colorize=True, thumbsize=thumb_size, add_id=True)\n        mosaic.paste(img, (x, y))\n\n    display(mosaic)\n\n#for i in range(len(all_needles) \/\/ page_size + 1):\nfor i in range(10):\n    show_page(i)","310b96d7":"## Normalization by frequency channel and time step\n\nYou can remove some artifacts in the data by normalizing every column and row of the spectrograms.\n\n\n<pre>\nx = np.load(f\"data.npy\")\nx = np.vstack(x).astype(np.float32)\nx = ((x - np.mean(x, axis=0)) \/ np.std(x, axis=0)).T\nx = ((x - np.mean(x, axis=0)) \/ np.std(x, axis=0)).T\n<\/pre>   \n","bf105866":"## A few target==1 examples more"}}