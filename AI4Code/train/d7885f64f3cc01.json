{"cell_type":{"819c186d":"code","c92d5c92":"code","eca0f293":"code","6c9bb7c4":"code","f0ada0b4":"code","d368fe27":"code","e093b0e0":"code","c6136529":"code","bb962e08":"code","5706db74":"code","6d2987c0":"code","e5a72803":"code","f41649f4":"code","ab23a051":"code","738bcc7a":"code","0ec8b38d":"code","cf5b96ce":"code","0cf846e6":"code","8ef69bb2":"code","1aea8efe":"code","79920dd4":"code","916c90e7":"code","d567383d":"code","9b49d1da":"code","fefcc398":"code","09a3c087":"code","3a2c5533":"code","554a9a51":"code","a332ae70":"code","39ea8166":"code","3cf7729c":"code","45719c3e":"markdown","df287afa":"markdown","42dcadd3":"markdown","bb8a1988":"markdown","ef748110":"markdown","177c7773":"markdown","508b35f3":"markdown","5ea86f44":"markdown","65babf38":"markdown","cc6af664":"markdown","caa29d38":"markdown","b471d2de":"markdown","4ab1f994":"markdown"},"source":{"819c186d":"import datetime as dt\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.cluster import KMeans\nfrom sklearn.preprocessing import MinMaxScaler\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\npd.set_option('display.float_format', lambda x: '%.5f' % x)","c92d5c92":"pip install openpyxl","eca0f293":"df = pd.read_excel('\/kaggle\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx')\ndf.head() #Veri setine ait ilk 5 g\u00f6zlem birimi","6c9bb7c4":"df[\"Description\"].nunique() #essiz \u00fcr\u00fcn say\u0131s\u0131","f0ada0b4":"df[\"TotalPrice\"] = df[\"Quantity\"]*df[\"Price\"] #fatura basina toplam para ","d368fe27":"df.head() #\"Total Price\" de\u011fi\u015fkeni eklendikten sonra","e093b0e0":"df.groupby(\"Invoice\").agg({\"TotalPrice\":\"sum\"}).head() #fatura ba\u015f\u0131na toplam ka\u00e7 kazan\u0131lan para","c6136529":"df.groupby(\"Description\").agg({\"Price\":\"max\"}).sort_values(\"Price\", ascending = False).head() #en pahal\u0131 \u00fcr\u00fcnler","bb962e08":"df.sort_values(\"Price\", ascending = False).head() #dataframe \u00fczerinden en pahal\u0131 \u00fcr\u00fcnler","5706db74":"df[\"Country\"].value_counts().head() #hangi \u00fclkeden kac sipari\u015f geldi?","6d2987c0":"df.groupby(\"Country\").agg({\"TotalPrice\":\"sum\"}).sort_values(\"TotalPrice\", ascending = False).head() #hangi \u00fclke ne kadar kazand\u0131rd\u0131?","e5a72803":"#en \u00e7ok iade alan \u00fcr\u00fcn\nreturned = df[df[\"Invoice\"].str.contains(\"C\",na=False)] #Invoice de\u011fi\u015fkeninde yer alan kodlar\u0131n ba\u015f\u0131na \"C\" ifadesi iade anlam\u0131nda \nreturned.sort_values(\"Quantity\", ascending = True).head()","f41649f4":"df.isnull().sum() #hangi degiskenden kacar tane eksik g\u00f6zlem var?","ab23a051":"df.dropna(inplace = True) #eksik g\u00f6zleri at\ndf.isnull().sum()","738bcc7a":"df.shape #yeni boyut bilgisi","0ec8b38d":"df.describe([0.05,0.01,0.25,0.50,0.75,0.80,0.90,0.95,0.99]).T #betimsel istatistikler","cf5b96ce":"#Recency Metric\nimport datetime as dt\ntoday_date = dt.datetime(2011,12,9)\ndf[\"Customer ID\"] = df[\"Customer ID\"].astype(int)\ntemp_df = (today_date - df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}))\ntemp_df.rename(columns={\"InvoiceDate\": \"Recency\"}, inplace = True)\nrecency_df = temp_df[\"Recency\"].apply(lambda x: x.days)\n\n# Frequency Metric\ntemp_df = df.groupby([\"Customer ID\",\"Invoice\"]).agg({\"Invoice\":\"count\"})\nfreq_df = temp_df.groupby(\"Customer ID\").agg({\"Invoice\":\"count\"})\nfreq_df.rename(columns={\"Invoice\": \"Frequency\"}, inplace = True)\n\n# Monetary Metric\nmonetary_df = df.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"})\nmonetary_df.rename(columns = {\"TotalPrice\": \"Monetary\"}, inplace = True)\nrfm = pd.concat([recency_df, freq_df, monetary_df],  axis=1)\ndf = rfm\ndf[\"RecencyScore\"] = pd.qcut(df['Recency'], 5, labels = [5, 4, 3, 2, 1])\ndf[\"FrequencyScore\"] = pd.qcut(df['Frequency'].rank(method = \"first\"), 5, labels = [1,2,3,4,5])\ndf[\"MonetaryScore\"] = pd.qcut(df['Monetary'], 5, labels = [1,2,3,4,5])\ndf[\"RFM_SCORE\"] = df['RecencyScore'].astype(str) + df['FrequencyScore'].astype(str) + df['MonetaryScore'].astype(str)\nseg_map = {\n        r'[1-2][1-2]': 'Hibernating',\n        r'[1-2][3-4]': 'At Risk',\n        r'[1-2]5': 'Can\\'t Loose',\n        r'3[1-2]': 'About to Sleep',\n        r'33': 'Need Attention',\n        r'[3-4][4-5]': 'Loyal Customers',\n        r'41': 'Promising',\n        r'51': 'New Customers',\n        r'[4-5][2-3]': 'Potential Loyalists',\n        r'5[4-5]': 'Champions'\n}\n\ndf['Segment'] = df['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str)\ndf['Segment'] = df['Segment'].replace(seg_map, regex=True)\ndf.head()","0cf846e6":"rfm = df.loc[:,\"Recency\":\"Monetary\"]","8ef69bb2":"df.groupby(\"Customer ID\").agg({\"Segment\": \"sum\"}).head()","1aea8efe":"#scale\nsc = MinMaxScaler((0,1))\ndf = sc.fit_transform(rfm)\n\n#k\u00fcmeleme\nkmeans = KMeans(n_clusters = 10)\nk_fit = kmeans.fit(df)","79920dd4":"k_fit.n_clusters #k\u00fcme say\u0131s\u0131","916c90e7":"k_fit.cluster_centers_ #g\u00f6zlem birimleri","d567383d":"k_fit.labels_ #her bir sat\u0131r\u0131n hangi k\u00fcmeye girdi\u011fi","9b49d1da":"k_fit.inertia_ #toplam hata","fefcc398":"df[0:5]","09a3c087":"kmeans = KMeans(n_clusters = 2)\nk_fit = kmeans.fit(df)\nssd = []  #hata kareler toplam\u0131\n\nK = range(1,30)\n\nfor k in K:\n    kmeans = KMeans(n_clusters = k).fit(df)\n    ssd.append(kmeans.inertia_)\n\nplt.plot(K, ssd, \"bx-\")\nplt.xlabel(\"Distance Residual Sums Versus Different k Values\")\nplt.title(\"Elbow method for Optimum number of clusters\")","3a2c5533":"from yellowbrick.cluster import KElbowVisualizer\nkmeans = KMeans()\nvisu = KElbowVisualizer(kmeans, k = (2,20))\nvisu.fit(df)\nvisu.poof();","554a9a51":"kmeans = KMeans(n_clusters = 6).fit(df)\nkumeler = kmeans.labels_\npd.DataFrame({\"Customer ID\": rfm.index, \"Kumeler\": kumeler})","a332ae70":"rfm[\"cluster_no\"] = kumeler\nrfm[\"cluster_no\"] = rfm[\"cluster_no\"] + 1","39ea8166":"rfm.groupby(\"cluster_no\").agg({\"cluster_no\":\"count\"})","3cf7729c":"rfm.head()","45719c3e":"**<h1><center><font color=\"red\">RFM Metrics<\/font>**","df287afa":"<div style=\"display:fill;\n            border-radius: false;\n            border-style: solid;\n            border-color:#000000;\n            border-style: false;\n            border-width: 2px;\n            color:;\n            font-size:15px;\n            font-family: Georgia;\n            background-color:;\n            text-align:center;\n            letter-spacing:0.1px;\n            padding: 0.1em;\">\n\n**<h2>Bu analizde kural tabanl\u0131 m\u00fc\u015fteri segmentasyonu y\u00f6ntemi RFM ile makine \u00f6\u011frenmesi y\u00f6ntemi olan K-Means'in m\u00fc\u015fteri segmentasyonu i\u00e7in kar\u015f\u0131la\u015ft\u0131r\u0131lmas\u0131 beklenmektedir.**","42dcadd3":"<div style=\"display:fill;\n            border-radius: false;\n            border-style: solid;\n            border-color:#000000;\n            border-style: false;\n            border-width: 2px;\n            color:;\n            font-size:15px;\n            font-family: Georgia;\n            background-color:;\n            text-align:center;\n            letter-spacing:0.1px;\n            padding: 0.1em;\">\n\n**InvoiceNo:** Fatura numaras\u0131. Her i\u015fleme yani faturaya ait e\u015fsiz numara. E\u011fer bu kod C ile ba\u015fl\u0131yorsa i\u015flemin iptal edildi\u011fini ifade eder.\n    \n**StockCode:** \u00dcr\u00fcn kodu. Her bir \u00fcr\u00fcn i\u00e7in e\u015fsiz numara   \n    \n**Description:** \u00dcr\u00fcn ismi   \n    \n**Quantity:** \u00dcr\u00fcn adedi. Faturalardaki \u00fcr\u00fcnlerden ka\u00e7ar tane sat\u0131ld\u0131\u011f\u0131n\u0131 ifade etmektedir.   \n    \n**InvoiceDate:** Fatura tarihi ve zaman\u0131.   \n    \n**UnitPrice:** \u00dcr\u00fcn fiyat\u0131 (Sterlin cinsinden) \n    \n**CustomerID:** E\u015fsiz m\u00fc\u015fteri numaras\u0131   \n    \n**Country:** \u00dclke ismi. M\u00fc\u015fterinin ya\u015fad\u0131\u011f\u0131 \u00fclke","bb8a1988":"<div style=\"display:fill;\n            border-radius: false;\n            border-style: solid;\n            border-color:#000000;\n            border-style: false;\n            border-width: 2px;\n            color:;\n            font-size:15px;\n            font-family: Georgia;\n            background-color:;\n            text-align:center;\n            letter-spacing:0.1px;\n            padding: 0.1em;\">\n\n**<h2>Online Retail II isimli veri seti \u0130ngiltere merkezli online bir sat\u0131\u015f \nma\u011fazas\u0131n\u0131n 01\/12\/2009 - 09\/12\/2011 tarihleri aras\u0131ndaki sat\u0131\u015flar\u0131n\u0131 \ni\u00e7ermektedir. Bu \u015firketin \u00fcr\u00fcn katalo\u011funda hediyelik e\u015fyalar yer almaktad\u0131r. \n\u015eirketin m\u00fc\u015fterilerinin b\u00fcy\u00fck \u00e7o\u011funlu\u011fu kurumsal m\u00fc\u015fterilerdir.**","ef748110":" **<h1><center><font color=\"red\">Clustering with the K-Means Algorithm<\/font>**","177c7773":"**<h1><center><font color=\"red\">Business Problem<\/font>**","508b35f3":"**<h1><center><font color=\"red\">Data Understanding<\/font>**","5ea86f44":"**<h1><center><font color=\"red\">Data Set Story<\/font>**","65babf38":"**<h1><center><font color=\"red\">Data Preparation<\/font>**","cc6af664":"![20.jpg](attachment:ffeb9cce-dc64-4930-bfdb-5e67a44e30aa.jpg)","caa29d38":"**<h1><center><font color=\"red\">Variables<\/font>**","b471d2de":" **<h1><center><font color=\"red\">Determining the Optimum Number of Clusters<\/font>**","4ab1f994":"<div style=\"display:fill;\n            border-radius: false;\n            border-style: solid;\n            border-color:#000000;\n            border-style: false;\n            border-width: 2px;\n            color:;\n            font-size:15px;\n            font-family: Georgia;\n            background-color:#ACCDD8;\n            text-align:center;\n            letter-spacing:0.1px;\n            padding: 0.1em;\">\n\n**<h2>THANK YOU FOR TAKING THE TIME**"}}