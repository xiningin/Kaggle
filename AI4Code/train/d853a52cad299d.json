{"cell_type":{"f1dd430b":"code","1333c11d":"code","b86daf67":"code","3553ba39":"code","87eb8367":"code","275b8b08":"code","cd65bd20":"code","f04e7ce5":"code","b6e05c7d":"code","b0417278":"code","db375ad7":"code","613a7eb7":"code","9749ef9f":"code","6dc5d921":"code","bad8cdc4":"code","08d36d65":"code","282e6a3a":"code","a415c3f8":"code","fba985a0":"code","984b638f":"code","39943e32":"markdown","c4222bb7":"markdown","e44359a4":"markdown","b25d8557":"markdown","7e2eb530":"markdown","9f6d280b":"markdown","3395a57a":"markdown","a1b7b7bd":"markdown","af97aa5b":"markdown","a72527a5":"markdown","1d8fe549":"markdown","28191d89":"markdown","ed545e11":"markdown"},"source":{"f1dd430b":"from sklearn import preprocessing\n\nimport pandas as pd \nimport numpy as np\nimport matplotlib.pyplot as plt\nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)","1333c11d":"df = pd.read_csv('\/kaggle\/input\/b3-stock-quotes\/COTAHIST_A2009_to_A2020_P.csv', \n                 parse_dates=['DATPRE', 'DATVEN'],\n                 date_parser=lambda x: pd.to_datetime(x, errors='coerce'),\n                 index_col=0)","b86daf67":"df.head()","3553ba39":"df.columns.values","87eb8367":"df.dtypes","275b8b08":"df.describe()","cd65bd20":"df.drop(columns=['TIPREG', 'MODREF', 'INDOPC'], inplace=True)","f04e7ce5":"df = df[(df.PRAZOT.isna()) | (df.PRAZOT == 0)]","b6e05c7d":"df = df[df.CODNEG.str.len() == 5]","b0417278":"df_bdi = pd.get_dummies(df['CODBDI'], prefix='BDI')\ndf.drop(columns=['CODBDI'], inplace=True)\ndf = pd.concat([df, df_bdi], axis=1)","db375ad7":"df_market_type = pd.get_dummies(df['TPMERC'], prefix='TPMERC')\ndf.drop(columns=['TPMERC'], inplace=True)\ndf = pd.concat([df, df_market_type], axis=1)","613a7eb7":"cols = ['PREABE', 'PREMAX', 'PREMIN', 'PREMED', 'PREULT', 'PREOFC', 'PREOFV']\n\nfor col in cols:\n    df[col + '_fat'] = df[col] \/ df['FATCOT']","9749ef9f":"df.head()","6dc5d921":"df.columns.values","bad8cdc4":"df.dtypes","08d36d65":"df.describe()","282e6a3a":"def group_quotes(min_date=None, max_date=None, min_year=None, max_year=None):\n    if min_date != None and max_date != None:\n        df_base = df[(df['DATPRE'] >= min_date) & (df['DATPRE'] <= max_date)]\n    elif max_date != None:\n        df_base = df[(df['DATPRE'] <= max_date)]\n    elif min_date != None:\n        df_base = df[(df['DATPRE'] >= min_date)]\n    else:\n        df_base = df\n    \n    df_cod_min_max_dt = df_base.groupby(by=['CODNEG'], as_index=False).agg({'DATPRE': ['min', 'max']})\n    df_cod_min_max_dt.columns = ['CODNEG', 'DATPRE_MIN', 'DATPRE_MAX']\n    df_cod_min_max_dt['PREMED_MIN'] = pd.merge(df_cod_min_max_dt.rename(columns={'DATPRE_MIN': 'DATPRE'}), df_base, how='inner', on=['CODNEG', 'DATPRE'])['PREMED']\n    df_cod_min_max_dt['PREMED_MAX'] = pd.merge(df_cod_min_max_dt.rename(columns={'DATPRE_MAX': 'DATPRE'}), df_base, how='inner', on=['CODNEG', 'DATPRE'])['PREMED']\n    \n    if min_year != None and max_year != None:\n        df_cod_min_max_dt = df_cod_min_max_dt[(df_cod_min_max_dt['DATPRE_MIN'].dt.year == min_year) & (df_cod_min_max_dt['DATPRE_MAX'].dt.year == max_year)]\n    elif max_year != None:\n        df_cod_min_max_dt = df_cod_min_max_dt[(df_cod_min_max_dt['DATPRE_MAX'].dt.year == max_year)]\n    elif min_year != None:\n        df_cod_min_max_dt = df_cod_min_max_dt[(df_cod_min_max_dt['DATPRE_MIN'].dt.year == min_year)]\n        \n    return df_cod_min_max_dt","a415c3f8":"df_cod_min_max_dt = group_quotes(min_date='2015-01-01', max_year=2020)\ndf_cod_min_max_dt['INC'] = df_cod_min_max_dt['PREMED_MAX'] \/ df_cod_min_max_dt['PREMED_MIN']\ndf_cod_min_max_dt['INC'] = preprocessing.MinMaxScaler().fit_transform(np.reshape(df_cod_min_max_dt['INC'].values, (-1, 1)))\ndf_cod_min_max_dt.sort_values(by='INC', ascending=False, inplace=True)\n\nfig = plt.figure()\nax = fig.add_axes([0,0,2,1])\nbest_quotes = df_cod_min_max_dt[:30]\nax.bar(best_quotes['CODNEG'], best_quotes['INC'])\nax.set_xticklabels(best_quotes['CODNEG'], rotation=45)\nplt.show()","fba985a0":"def plot_quote_timeserie(code):\n    quote = df[df['CODNEG'] == code][['PREMED', 'DATPRE']]\n    quote.set_index('DATPRE', inplace=True)\n    fig = plt.figure()\n    ax = fig.add_axes([0,0,2,1])\n    ax.plot(quote)\n    plt.show()","984b638f":"plot_quote_timeserie('BBDC4')","39943e32":"### Scaling valus\n> Converting prices accorging to their factor","c4222bb7":"# Brazil Stock Quotes\n> ## Data Analyze of [Brazilian Stock Quotes](https:\/\/www.kaggle.com\/gbonesso\/b3-stock-quotes)","e44359a4":"### Removing future trading\n> We are analyzing only trade current trade. For clarification, see [here](https:\/\/pt.wikipedia.org\/wiki\/Mercado_a_termo)","b25d8557":"### One hot enconding BDI column\n\n| COLUMN | DESCRIPTION IN PORTUGUESE | DESCRIPTION IN ENGLISH |\n| :---: | :--- | :--- |\n| BDI_02 | LOTE PADR\u00c3O | STANDARD PLOT |\n| BDI_06 | CONCORDAT\u00c1RIAS | AGREEMENTS |\n| BDI_10 | DIREITOS E RECIBOS | RIGHTS AND RECEIPTS |\n| BDI_12 | FUNDOS IMOBILI\u00c1RIOS | REAL ESTATE FUNDS |\n| BDI_14 | CERTIFIC. INVESTIMENTO \/ DEB\u00caNTURES \/ T\u00cdTULOS DIVIDA P\u00daBLICA | CERTIFICATION. INVESTMENT \/ DEBENTURES \/ PUBLIC DEBT SECURITIES |\n| BDI_18 | OBRIGA\u00c7\u00d5ES | OBLIGATIONS |\n| BDI_22 | B\u00d4NUS (PRIVADOS) | BONUS (PRIVATE) |\n| BDI_26 | AP\u00d3LICES \/ B\u00d4NUS \/ T\u00cdTULOS P\u00daBLICOS | POLICIES \/ BONUSES \/ PUBLIC SECURITIES |\n| BDI_32 | EXERC\u00cdCIO DE OP\u00c7\u00d5ES DE COMPRA DE \u00cdNDICE | EXERCISE OF INDEX PURCHASE OPTIONS |\n| BDI_33 | EXERC\u00cdCIO DE OP\u00c7\u00d5ES DE VENDA DE \u00cdNDICE | EXERCISE OF INDEX SALES OPTIONS |\n| BDI_38 | EXERC\u00cdCIO DE OP\u00c7\u00d5ES DE COMPRA | EXERCISE OF PURCHASE OPTIONS |\n| BDI_42 | EXERC\u00cdCIO DE OP\u00c7\u00d5ES DE VENDA | EXERCISE OF SELLING OPTIONS |\n| BDI_46 | LEIL\u00c3O DE T\u00cdTULOS N\u00c3O COTADOS | AUCTION OF UNLOCKED SECURITIES |\n| BDI_48 | LEIL\u00c3O DE PRIVATIZA\u00c7\u00c3O | PRIVATIZATION AUCTION |\n| BDI_50 | LEIL\u00c3O | AUCTION |\n| BDI_51 | LEIL\u00c3O FINOR | FINOR AUCTION |\n| BDI_52 | LEIL\u00c3O FINAM | FINAM AUCTION |\n| BDI_53 | LEIL\u00c3O FISET | FISET AUCTION |\n| BDI_54 | LEIL\u00c3O DE A\u00c7\u00d5ES EM MORA | AUCTION OF ACTIONS IN LATE PAYMENT |\n| BDI_56 | VENDAS POR ALVAR\u00c1 JUDICIAL | SALES BY JUDICIAL PERMIT |\n| BDI_58 | OUTROS | OTHERS |\n| BDI_60 | PERMUTA POR A\u00c7\u00d5ES | EXCHANGE FOR SHARES |\n| BDI_61 | META | GOAL |\n| BDI_62 | TERMO | TERM |\n| BDI_66 | DEB\u00caNTURES COM DATA DE VENCIMENTO AT\u00c9 3 ANOS | DEBENTURES WITH MATURITY DATE UP TO 3 YEARS |\n| BDI_68 | DEB\u00caNTURES COM DATA DE VENCIMENTO MAIOR QUE 3 ANOS | DEBENTURES WITH EXPIRATION DATE MORE THAN 3 YEARS |\n| BDI_70 | FUTURO COM MOVIMENTA\u00c7\u00c3O CONT\u00cdNUA | FUTURE WITH CONTINUOUS MOVEMENT |\n| BDI_71 | FUTURO COM RETEN\u00c7\u00c3O DE GANHO | FUTURE WITH GAIN RETENTION |\n| BDI_74 | OP\u00c7\u00d5ES DE COMPRA DE \u00cdNDICES | INDEX PURCHASE OPTIONS |\n| BDI_75 | OP\u00c7\u00d5ES DE VENDA DE \u00cdNDICES | INDEX SALES OPTIONS |\n| BDI_78 | OP\u00c7\u00d5ES DE COMPRA | PURCHASE OPTIONS |\n| BDI_82 | OP\u00c7\u00d5ES DE VENDA | SALES OPTIONS |\n| BDI_83 | DEB\u00caNTURES E NOTAS PROMISS\u00d3RIAS | DEBENTURES AND PROMISORY NOTES |\n| BDI_96 | FRACION\u00c1RIO | FRACTIONAL |\n| BDI_99 | TOTAL GERAL | GRAND TOTAL |","7e2eb530":"### Columns\n> Explanation about the columns can be found in portuguese [here](http:\/\/bvmf.bmfbovespa.com.br\/pt-br\/download\/SeriesHistoricas_Layout.pdf)","9f6d280b":"### Plot timeseries","3395a57a":"### Removing unknow data\n> For some reason, only codes with 5 characters are available on Google","a1b7b7bd":"### Ploting data","af97aa5b":"### Best 30 quotes\n> Best 30 quotes comparing their prices since 2015 and 2020","a72527a5":"### One hot enconding TPMERC column\n\n| COLUMN | DESCRIPTION IN PORTUGUESE | DESCRIPTION IN ENGLISH |\n| :---: | :--- | :--- |\n| TPMERC_10 | VISTA | VIEW |\n| TPMERC_12 | EXERC\u00cdCIO DE OP\u00c7\u00d5ES DE COMPRA | EXERCISE OF PURCHASE OPTIONS |\n| TPMERC_13 | EXERC\u00cdCIO DE OP\u00c7\u00d5ES DE VENDA | EXERCISE OF SELLING OPTIONS |\n| TPMERC_17 | LEIL\u00c3O | AUCTION |\n| TPMERC_20 | FRACION\u00c1RIO | FRACTIONAL |\n| TPMERC_30 | TERMO | TERM |\n| TPMERC_50 | FUTURO COM RETEN\u00c7\u00c3O DE GANHO | FUTURE WITH GAIN RETENTION |\n| TPMERC_60 | FUTURO COM MOVIMENTA\u00c7\u00c3O CONT\u00cdNUA | FUTURE WITH CONTINUOUS MOVEMENT |\n| TPMERC_70 | OP\u00c7\u00d5ES DE COMPRA | PURCHASE OPTIONS |\n| TPMERC_80 | OP\u00c7\u00d5ES DE VENDA | SALES OPTIONS |","1d8fe549":"### Ploting data","28191d89":"| COLUMN | DESCRIPTION | CONTENT |\n| :---: | :--- | :--- |\n| TIPREG | RECORD TYPE | FIXED 1 |\n| DATPRE | TRADE DATE | |\n| CODBDI | USED TO CLASSIFY PAPERS IN THE ISSUE OF THE DAILY INFORMATION BULLETIN | |\n| CODNEG | PAPER TRADING CODE | |\n| TPMERC | MARKET TYPE | MARKET CODE IN WHICH PAPER IS REGISTERED |\n| NOMRES | BRIEF NAME OF PAPER ISSUING COMPANY | |\n| ESPECI | PAPER SPECIFICATION | |\n| PRAZOT | TERM IN MARKET DAYS | |\n| MODREF | REFERENCE CURRENCY | CURRENCY USED ON THE TRADE DATE |\n| PREABE | OPENING PRICE OF MARKET PAPER | |\n| PREMAX | MAX PRICE OF MARKET PAPER | |\n| PREMIN | MIN PRICE OF MARKET PAPER | |\n| PREMED | MEAN PRICE OF MARKET PAPER | |\n| PREULT | LAST PRICE OF MARKET PAPER | |\n| PREOFC | BEST PURCHASE PRICE OF MARKET PAPER | |\n| PREOFV | BEST SELL PRICE OF MARKET PAPER | |\n| TOTNEG | NUMBER OF TRANSACTIONS OF MARKET PAPER | |\n| QUATOT | TOTAL TRANSACTIONS OF MARKET PAPER | |\n| VOLTOT | TOTAL TRANSACTIONS VOLUME OF MARKET PAPER  | |\n| PREEXE | ? | PRE\u00c7O DE EXERC\u00cdCIO PARA O MERCADO DE OP\u00c7\u00d5ES OU VALOR DO CONTRATO PARA O MERCADO DE TERMO SECUND\u00c1RIO  |\n| INDOPC | ? | INDICADOR DE CORRE\u00c7\u00c3O DE PRE\u00c7OS DE EXERC\u00cdCIOS OU VALORES DE CONTRATO PARA OS MERCADOS DE OP\u00c7\u00d5ES OU TERMO SECUND\u00c1RIO |\n| DATVEN | EXPIRATION DATE | |\n| FATCOT | QUOTE FACTOR | \u20181\u2019 = UNIT QUOTATION OR \u20181000\u2019 = QUOTATION PER THOUSAND |\n| PTOEXE | EXERCISE PRICE IN POINTS FOR OPTIONS REFERRED TO DOLLAR OR CONTRACT VALUE IN POINTS FOR SECONDARY TERM | FOR REFERENCES IN DOLLARS, EACH POINT IS EQUAL TO THE AMOUNT, IN THE CURRENT CURRENCY, OF ONE HUNDRED OF THE AVERAGE INTERBANK CLOSING DOLLAR OF THE PREVIOUS DAY, THAT IS, 1 POINT = 1\/100 US $ |\n| CODISI | PAPER CODE IN THE ISIN SYSTEM OR INTERNAL PAPER CODE | |\n| DISMES | PAPER DISTRIBUTION NUMBER | |","ed545e11":"### Removing useless data\n> TIPREG: this column has a value fixed (1)  \n> MODREF: this database has only values is real (Brazilian currency - R$)  \n> INDOPC: should be from 1 to 9, but this column has only 0 (Missing data)"}}