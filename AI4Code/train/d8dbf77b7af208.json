{"cell_type":{"015da35f":"code","e42f13d6":"code","cb753baf":"code","7760cfe1":"code","d767d1df":"code","a56d8acf":"code","c4c06c32":"code","4cb7e01b":"code","4f60dc9d":"code","d6d0f7ab":"code","a41f0762":"code","cf15f890":"code","ae22d66b":"code","2c5b0feb":"markdown","ffaa9c05":"markdown","2514b2d0":"markdown","f149e165":"markdown","eb173a5f":"markdown","c75a0adc":"markdown","f8ee5cc0":"markdown","3cce1db1":"markdown","40687ca1":"markdown","a438dead":"markdown","68b2d6b6":"markdown","02286634":"markdown","f544005b":"markdown"},"source":{"015da35f":"# Base \n# -----------------------------------\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport os\n\n# Models \n# -----------------------------------\nfrom lightgbm import LGBMClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier,RandomForestClassifier, BaggingClassifier, AdaBoostClassifier\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.tree import DecisionTreeClassifier\nfrom xgboost import XGBClassifier\nfrom sklearn.naive_bayes import GaussianNB\n\n# Metrics & Evaluation\n# -----------------------------------\nfrom sklearn.model_selection import KFold\nfrom sklearn.model_selection import train_test_split, GridSearchCV, cross_val_score\nfrom sklearn.metrics import accuracy_score, roc_auc_score, roc_curve, classification_report\n\n# Configuration\n# -----------------------------------\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nwarnings.simplefilter(action='ignore', category=FutureWarning)\n\npd.set_option('display.max_columns', None)\npd.options.display.float_format = '{:.2f}'.format","e42f13d6":"df = pd.read_csv(\"..\/input\/pima-indians-diabetes-database\/diabetes.csv\")\ndf.head()","cb753baf":"df.describe([0.01, 0.05, 0.10, 0.20, 0.7, 0.8, 0.9, 0.95, 0.99]).T","7760cfe1":"# Target\nprint(df.Outcome.value_counts())\nprint(df.Outcome.value_counts() \/ df.shape[0])","d767d1df":"print(df.isnull().sum() \/ df.shape[0], \"\\n\")\n\nmissing = [\"Glucose\", \"BMI\", \"BloodPressure\", \"SkinThickness\", \"Insulin\"]\nfor i in missing:\n    df[i] = np.where(df[i] == 0, np.nan, df[i])\n    \ndef missing_imp_category(data, group_variable, target, method = \"mean\"):\n    data[target] = data[target].fillna(data.groupby(group_variable)[target].transform(method))\n    \ndf.isnull().sum().sort_values(ascending = False) \/ df.shape[0]","a56d8acf":"# Age Category\ndf[\"AGECAT\"] = pd.cut(df.Age, 5, labels = np.arange(1,6,1))\n\n# Fill Missing\nmissing_imp_category(df, group_variable=[\"AGECAT\", \"Outcome\"], target = \"BMI\", method=\"median\")","c4c06c32":"# BMI Category\ndf[\"BMI_CAT\"] = np.where(df.BMI < 18.5, \"UNDERWEIGHT\", \"NORMAL\")\ndf[\"BMI_CAT\"] = np.where((df.BMI >= 25) & (df.BMI < 30), \"OVERRWEIGHT\", df[\"BMI_CAT\"])\ndf[\"BMI_CAT\"] = np.where((df.BMI >= 30) & (df.BMI < 35), \"OBESE\", df[\"BMI_CAT\"])\ndf[\"BMI_CAT\"] = np.where((df.BMI >= 35), \"EXTREMELY OBESE\", df[\"BMI_CAT\"])\ndf[\"ISOBESE\"] = np.where(df.BMI >= 30, 1, 0)\n\n# Fill Missing\nmissing_imp_category(df, group_variable=[\"BMI_CAT\", \"Outcome\"], target = \"SkinThickness\", method=\"median\")\n\n# Fill Missing\ndf[\"Glucose\"] = df.Glucose.fillna(df.Glucose.median())","4cb7e01b":"# Fill Missing\nmissing_imp_category(df, group_variable=[\"AGECAT\", \"Outcome\"], target = \"BloodPressure\", method=\"median\")\n\n# DIASTOLIC\ndf[\"DIASTOLIC\"] = np.where(df.BloodPressure < 80, \"Normal\", \"Hypertension Stg1\")\ndf[\"DIASTOLIC\"] = np.where((df.BloodPressure >= 90) & (df.BloodPressure < 120), \"Hypertension Stg2\", df[\"DIASTOLIC\"])\ndf[\"DIASTOLIC\"] = np.where((df.BloodPressure > 120), \"Hypertensive Crisis\", df[\"DIASTOLIC\"])\n\n\n# Fill Missing\nmissing_imp_category(df, group_variable=[\"AGECAT\", \"Outcome\"], target = \"Insulin\", method=\"median\")\nmissing_imp_category(df, group_variable=[\"Outcome\"], target = \"Insulin\", method=\"median\")","4f60dc9d":"# Pregnancies\ndf[\"CHILD\"] = np.where(df.Pregnancies > 0, 1, 0)\ndf[\"PregnanciesCAT\"] = np.where(df.Pregnancies == 0, \"No\", \"1-3\")\ndf[\"PregnanciesCAT\"] = np.where((df.Pregnancies > 3) & (df.Pregnancies < 10), \"4-9\", df[\"PregnanciesCAT\"])\ndf[\"PregnanciesCAT\"] = np.where((df.Pregnancies > 10), \"10+\", df[\"PregnanciesCAT\"])\n\n# Hypoglycemia\ndf[\"Hypoglycemia\"] = np.where(df.Glucose < 75, 1,0)\n\n# Risk Score\ndf[\"IDAgeRiskScore\"] = np.where(df.Age < 35, 0 , 20)\ndf[\"IDAgeRiskScore\"] = np.where(df.Age > 49, 30 , df[\"IDAgeRiskScore\"])\ndf[\"IDBMIRiskScore\"] = np.where(df.BMI < 30 , 0, 10)\ndf[\"IDBMIRiskScore\"] = np.where((df.BMI >= 45) & (df.BMI < 55) , 20, df[\"IDBMIRiskScore\"])\ndf[\"IDBMIRiskScore\"] = np.where((df.BMI >= 55), 30, df[\"IDBMIRiskScore\"])\n\n\n## Skin Thickness, BMI and Age\ndf[\"ST_BMI\"] = df[\"SkinThickness\"] \/ df[\"BMI\"]\ndf[\"ST_BMI_Age\"] = (df.BMI * df.SkinThickness ) \/ df.Age\n\ndf[\"New_SkinThickness\"] = df[\"SkinThickness\"] * 4\n\ndf.loc[(df['Age'] >= 21 ) & (df['Age'] <= 29) & (df[\"New_SkinThickness\"] < 34), 'Body_Fat'] = \"Underfat\"\ndf.loc[(df['Age'] >= 30 ) & (df['Age'] <= 39) & (df[\"New_SkinThickness\"] < 29), 'Body_Fat'] = \"Underfat\"\ndf.loc[(df['Age'] >= 40 ) & (df['Age'] <= 49) & (df[\"New_SkinThickness\"] < 23), 'Body_Fat'] = \"Underfat\"\ndf.loc[(df['Age'] >= 50 ) & (df[\"New_SkinThickness\"] < 20), 'Body_Fat'] = \"Underfat\"\n\ndf.loc[(df['Age'] >= 21 ) & (df['Age'] <= 29) & (df[\"New_SkinThickness\"] >= 34) & (df[\"New_SkinThickness\"] <= 79), 'Body_Fat'] = \"Healthy\"\ndf.loc[(df['Age'] >= 30 ) & (df['Age'] <= 39) & (df[\"New_SkinThickness\"] >= 29) & (df[\"New_SkinThickness\"] <= 73), 'Body_Fat'] = \"Healthy\"\ndf.loc[(df['Age'] >= 40 ) & (df['Age'] <= 49) & (df[\"New_SkinThickness\"] >= 23) & (df[\"New_SkinThickness\"] <= 59), 'Body_Fat'] = \"Healthy\"\ndf.loc[(df['Age'] >= 50 ) & (df[\"New_SkinThickness\"] >= 20) & (df[\"New_SkinThickness\"] <= 49), 'Body_Fat'] = \"Healthy\"\n\ndf.loc[(df['Age'] >= 21 ) & (df['Age'] <= 29) &( df[\"New_SkinThickness\"] > 79) & (df[\"New_SkinThickness\"] <= 120), 'Body_Fat'] = \"OverFat\"\ndf.loc[(df['Age'] >= 30) & (df['Age'] <= 39) & (df[\"New_SkinThickness\"] > 73) & (df[\"New_SkinThickness\"] <= 115), 'Body_Fat'] = \"OverFat\"\ndf.loc[(df['Age'] >= 40 ) & (df['Age'] <= 49) & (df[\"New_SkinThickness\"] > 59) & (df[\"New_SkinThickness\"] <= 95), 'Body_Fat'] = \"OverFat\"\ndf.loc[(df['Age'] >= 50 ) & (df[\"New_SkinThickness\"] > 49) & (df[\"New_SkinThickness\"] <= 77), 'Body_Fat'] = \"OverFat\"\n\ndf.loc[(df['Age'] >= 21 ) & (df['Age'] <= 29) & (df[\"New_SkinThickness\"] > 120), 'Body_Fat'] = \"Obese\"\ndf.loc[(df['Age'] >= 30 ) & (df['Age'] <= 39) & (df[\"New_SkinThickness\"] > 115) , 'Body_Fat'] = \"Obese\"\ndf.loc[(df['Age'] >= 40 ) & (df['Age'] <= 49) & (df[\"New_SkinThickness\"] > 95) , 'Body_Fat'] = \"Obese\"\ndf.loc[(df['Age'] >= 50 )  & (df[\"New_SkinThickness\"] > 77) , 'Body_Fat'] = \"Obese\"\n\ndf = df.drop([\"New_SkinThickness\"], axis=1)\n\n## Glucose\ndf.loc[(df[\"Glucose\"] < 140), \"GlucoseCAT\"] = \"No_Risk\"\ndf.loc[(df[\"Glucose\"] >= 140), \"GlucoseCAT\"] = \"Prediabetes\"","d6d0f7ab":"def num_plot(data, cat_length = 16, remove = [\"Id\"], hist_bins = 12, figsize = (20,4)):\n    \n    num_cols = [col for col in data.columns if data[col].dtypes != \"O\" \n                and len(data[col].unique()) >= cat_length]\n    \n    if len(remove) > 0:\n        num_cols = list(set(num_cols).difference(remove))\n            \n    for i in num_cols:\n        fig, axes = plt.subplots(1, 3, figsize = figsize)\n        data.hist(str(i), bins = hist_bins, ax=axes[0])\n        data.boxplot(str(i),  ax=axes[1], vert=False);\n        try: \n            sns.kdeplot(np.array(data[str(i)]))\n        except: ValueError\n        \n        axes[1].set_yticklabels([])\n        axes[1].set_yticks([])\n        axes[0].set_title(i + \" | Histogram\")\n        axes[1].set_title(i + \" | Boxplot\")\n        axes[2].set_title(i + \" | Density\")\n        plt.show()\n        \n        \nnum_plot(df, cat_length = 16, hist_bins = 10, figsize = (20,4))","a41f0762":"def cat_eda(data, cat_length, target = \"Outcome\"):  \n    dataframe = data.copy()\n    \n    #if len(ordinal_variable) > 0:\n    #    dataframe.drop(ordinal_variable, axis = 1, inplace = True)\n        \n    more_cat_cols = [col for col in dataframe.columns if len(dataframe[col].unique()) < cat_length]\n    \n    for i in more_cat_cols: \n        print(i, \":\", len(dataframe[i].value_counts()), \"Unique Category -\", str(dataframe[i].dtype))\n        print(pd.DataFrame({\"COUNT\": dataframe[i].value_counts(),\n                            \"RATIO\": dataframe[i].value_counts() \/ len(dataframe),\n                            \"TARGET_MEAN\": dataframe.groupby(i)[target].mean(),\n                            \"TARGET_COUNT\": dataframe.groupby(i)[target].count(),\n                            \"TARGET_STD\": dataframe.groupby(i)[target].std()}), end=\"\\n\\n\\n\")\n    \n    print(\"# DTYPES -----------------------------\")\n    print(\"Object Variables:\",dataframe[more_cat_cols].select_dtypes(\"object\").columns.tolist(), \"\\n\")\n    print(\"Integer Variables:\",dataframe[more_cat_cols].select_dtypes(\"integer\").columns.tolist(), \"\\n\")\n    print(\"Float Variables:\",dataframe[more_cat_cols].select_dtypes(\"float\").columns.tolist(), \"\\n\")\n\ncat_eda(df, cat_length=10)","cf15f890":"# Transform Object\ndf[\"AGECAT\"] = df[\"AGECAT\"].astype(object)\n\ncat_cols = [col for col in df.columns if df[col].dtypes == 'O']\n\ndef one_hot_encoder(dataframe, categorical_cols, nan_as_category=True):\n    original_columns = list(dataframe.columns)\n    dataframe = pd.get_dummies(dataframe, columns=categorical_cols, dummy_na=nan_as_category, drop_first=True)\n    new_columns = [c for c in dataframe.columns if c not in original_columns]\n    return dataframe, new_columns\n\n\ndf, new_cols_ohe = one_hot_encoder(df, cat_cols, nan_as_category=False)","ae22d66b":"# All Models & Train Validation Scores\nmodels = [('LR', LogisticRegression()),\n          (\"NBAYES\", GaussianNB()),\n          ('KNN', KNeighborsClassifier()),\n          ('CART', DecisionTreeClassifier()),\n          (\"BAGGING\", BaggingClassifier()),\n          ('RF', RandomForestClassifier()),\n          ('SVM', SVC(gamma='auto')),\n          (\"ADAB\",AdaBoostClassifier()),\n          ('GBM', GradientBoostingClassifier()),\n          (\"XGB\", XGBClassifier()),\n          (\"LGBM\", LGBMClassifier())]\n\n\ny = df[\"Outcome\"]\nX = df.drop([\"Outcome\"], axis=1)\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.20, random_state=46)\n\n# evaluate each model in turn\nresults = []\nnames = []\n\nprint(\"# Algorithm Comparison\")\nprint(\"-----------------------------------------\")\nfor name, model in models:\n    kfold = KFold(n_splits=10, random_state=123456)\n    cv_results = cross_val_score(model, X_train, y_train, cv=kfold, scoring=\"accuracy\")\n    results.append(cv_results)\n    names.append(name)\n    msg = \"%s: %f (%f)\" % (name, cv_results.mean(), cv_results.std())\n    print(msg)\n    \nprint(\"\\n\")    \n\n# boxplot algorithm comparison\nfig = plt.figure(figsize=(15, 10))\nfig.suptitle('Algorithm Comparison')\nax = fig.add_subplot(111)\nplt.boxplot(results)\nax.set_xticklabels(names)\nplt.show()","2c5b0feb":"<a id=\"section2\"><\/a>\n# 2. Data","ffaa9c05":"<a id=\"section3\"><\/a>\n# 3. Missing Values","2514b2d0":"<a id=\"section6\"><\/a>\n# 6. Numeric Variables ","f149e165":"<a id=\"section4\"><\/a>\n# 4. Filling Missing Values and Creating New Variables","eb173a5f":"<a id=\"section1\"><\/a>\n# 1. Packages","c75a0adc":"<center><img\nsrc=\"https:\/\/www.cdc.gov\/healthyweight\/images\/assessing\/bmi-adult-fb-600x315.jpg\" style=\"width:45%;height:40%;\">\n<\/center>","f8ee5cc0":"<a id=\"section5\"><\/a>\n# 5. New Features","3cce1db1":"<center> <h1 style=\"background-color:indianred; color:white\" >Pima Indians Diabetes Classification & Comparision<\/h1> \n\n<center><img\nsrc=\"https:\/\/upload.wikimedia.org\/wikipedia\/commons\/6\/6f\/Pima.jpg\" style=\"width:30%;height:40%;\">\n<\/center>\n    \n<br>    \n    \n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n  <h3 class=\"list-group-item list-group-item-action active\" style=\"background-color:indianred; color:white\" data-toggle=\"list\"  role=\"tab\" aria-controls=\"home\">Notebook Content!<\/h3>  \n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#section1\" role=\"tab\" aria-controls=\"profile\" style=\"color:indianred\">Import Libraries<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">1<\/span><\/a>    \n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#section2\" role=\"tab\" aria-controls=\"profile\" style=\"color:indianred\">Load Data<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">2<\/span><\/a>\n  <a id=\"section2\" class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#section3\" role=\"tab\" aria-controls=\"messages\" style=\"color:indianred\">Missing Values<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">3<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\"  data-toggle=\"list\" href=\"#section4\" role=\"tab\" aria-controls=\"settings\" style=\"color:indianred\">Filling Missing Values and Creating New Variables<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">4<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#section5\" role=\"tab\" aria-controls=\"settings\" style=\"color:indianred\">New Features<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">5<\/span><\/a> \n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#section6\" role=\"tab\" aria-controls=\"settings\" style=\"color:indianred\">Numeric Variables<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">6<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#section7\" role=\"tab\" aria-controls=\"settings\" style=\"color:indianred\">Categoric Variables<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">7<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#section8\" role=\"tab\" aria-controls=\"settings\" style=\"color:indianred\">One-Hot Encoder<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">8<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#section9\" role=\"tab\" aria-controls=\"settings\" style=\"color:indianred\">Model Comparision<span class=\"badge badge-primary badge-pill\" style=\"background-color:indianred; color:white\">9<\/span><\/a>","40687ca1":"<a id=\"section7\"><\/a>\n# 7. Categoric Variables","a438dead":"<a id=\"section9\"><\/a>\n# 9. Model Comparision","68b2d6b6":"<a id=\"section8\"><\/a>\n# 8. One-Hot Encoder","02286634":"- **Pregnancies:** Number of times pregnant\n- **Glucose:** Plasma glucose concentration a 2 hours in an oral glucose tolerance test\n- **BloodPressure:** Diastolic blood pressure (mm Hg)\n- **SkinThickness:** Triceps skin fold thickness (mm)\n- **Insulin:** 2-Hour serum insulin (mu U\/ml)\n- **BMI:** Body mass index (weight in kg\/(height in m)^2)\n- **DiabetesPedigreeFunction:** Diabetes pedigree function\n- **Age:** Age (years)\n- **Outcome:** Class variable (0 or 1)","f544005b":"<center><img\nsrc=\"https:\/\/img.webmd.com\/dtmcms\/live\/webmd\/consumer_assets\/site_images\/article_thumbnails\/other\/blood_pressure_charts\/basic_blood_pressure_chart.png\" style=\"width:45%;height:40%;\">\n<\/center>\n\n"}}