{"cell_type":{"e161b10d":"code","3d5c9536":"code","feba455f":"code","f534e2fc":"code","a65e9a47":"code","0afd431f":"code","6105d6f8":"code","1d7d412a":"code","8576b4e5":"code","3d2fb885":"code","39211318":"code","710f033d":"code","2bfe676e":"code","34a8eff9":"code","5a1ac220":"code","3ac57d92":"code","efdb923e":"code","65e475d4":"code","6657038e":"code","bdd187bc":"code","70f4dcd6":"code","29d11e70":"code","9955e173":"code","79c18631":"code","95ff852f":"code","53d9c6b2":"code","571396a3":"code","ff2e0f78":"code","f143e6d3":"code","56a6c2cf":"code","a0e6ffd7":"code","ded5e9ed":"code","d95b5e2b":"code","60432c61":"code","7aaf15c8":"code","3552c38e":"code","38aee55f":"markdown","14149576":"markdown","f5f30876":"markdown","10b8ce63":"markdown","f618fd97":"markdown","5ae92b29":"markdown","7fa79c1e":"markdown","21ecbf52":"markdown","295209f1":"markdown","ab4cba3a":"markdown","7980c5be":"markdown","00ff09f7":"markdown","bd824700":"markdown","d0c27bd3":"markdown","ac290494":"markdown","359025be":"markdown","87012a0a":"markdown","44cc02c6":"markdown","8cdf9dad":"markdown","43cce67a":"markdown","5e6ea33f":"markdown","002ddc19":"markdown","aa182681":"markdown","0e4e0075":"markdown","0e6699a4":"markdown","e8dfc388":"markdown","f45b53cd":"markdown","6208e4da":"markdown","037a69cd":"markdown","0179ac61":"markdown","39d394e4":"markdown","d5c3acb8":"markdown","115d68c1":"markdown","083efe91":"markdown","4b14b26c":"markdown","17f8d81a":"markdown","6f8820f3":"markdown"},"source":{"e161b10d":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","3d5c9536":"# import dataset using Pandas\ndata = pd.read_csv('..\/input\/insurance\/insurance.csv')\n\n# check if any columns have NaN values\ndata.isnull().sum()","feba455f":"# output first five rows of the dataset using the \".head()\" function\ndata.head()","f534e2fc":"data = pd.get_dummies(data)","a65e9a47":"data.head()","0afd431f":"# calculate variable correlations in regards to 'charges'\ncorr = data.corr()['charges'].sort_values()","6105d6f8":"# display correlation values\ncorr","1d7d412a":"corr = data.corr()\n\n# Generate a mask for the upper triangle\nmask = np.zeros_like(corr, dtype=np.bool)\n\n# Set up the matplotlib figure\nf, ax = plt.subplots(figsize=(11, 9))\n\n# Generate a custom diverging colormap\ncmap = sns.diverging_palette(220, 10, as_cmap=True)\n\n# Draw the heatmap with the mask and correct aspect ratio\nsns.heatmap(corr, mask=mask, cmap=sns.diverging_palette(250,10,as_cmap=True),\n            square=True,annot=True,ax=ax)","8576b4e5":"tmp_data = pd.read_csv('..\/input\/insurance\/insurance.csv')\n\n# Descriptive statistics smoker\nstatistics_smoker = tmp_data[tmp_data['smoker'] == 'yes'].describe()\nstatistics_smoker.rename(columns=lambda x: x + '_smoker', inplace=True)\n\n# Descriptive statistics non-smoker\nstatistics_non_smoker = tmp_data[tmp_data['smoker'] == 'no'].describe()\nstatistics_non_smoker.rename(columns=lambda x: x + '_non_smoker', inplace=True)\n\n# Dataframe that contains statistics for both male and female\nstatistics = pd.concat([statistics_smoker, statistics_non_smoker], axis=1)\nstatistics","3d2fb885":"from statistics import mode \n\nplt.style.use('ggplot')\n\n# histogram of ages\ndata.age.plot(kind='hist', color='orange', edgecolor='black', figsize=(10,7))\nplt.title('Distribution of Age', size=24)\nplt.xlabel('Age', size=18)\nplt.ylabel('Frequency', size=18)\n\n# find most frequent age\nmode_age = mode(data.age)\nprint('Mode of Age:', mode_age)","39211318":"# histogram of BMI\ndata.bmi.plot(kind='hist', color='orange', edgecolor='black', figsize=(10,7))\nplt.title('Distribution of BMI', size=24)\nplt.xlabel('Body Mass Index (BMI)', size=18)\nplt.ylabel('Frequency', size=18)\n\n# find average BMI\navg_BMI = data.bmi.mean()\nprint('Average BMI:', avg_BMI)","710f033d":"# countplot to compare the number of children\nplt.figure(figsize=(12,4))\nsns.countplot(x='children', data=data, color='orange', edgecolor='black') \nplt.title('Distribution of Children', size='24')\nplt.ylabel('Frequency',size=18)\nplt.xlabel('Number of Children',size=18)\nplt.show()","2bfe676e":"# countplot to compare the number of people from different regions\nplt.figure(figsize=(12,4))\nsns.countplot(x='region', data=tmp_data, color='orange', edgecolor='black') \nplt.title('Distribution of People Across Regions', size='24')\nplt.ylabel('Frequency',size=18)\nplt.xlabel('Region',size=18)\nplt.show()","34a8eff9":"# histogram of region\ndata[data['region_northeast'] == 1].charges.plot(kind='hist', color='blue', edgecolor='black', alpha=0.5, figsize=(10, 7))\ndata[data['region_northwest'] == 1].charges.plot(kind='hist', color='magenta', edgecolor='black', alpha=0.5, figsize=(10, 7))\ndata[data['region_southeast'] == 1].charges.plot(kind='hist', color='green', edgecolor='black', alpha=0.5, figsize=(10, 7))\ndata[data['region_southwest'] == 1].charges.plot(kind='hist', color='red', edgecolor='black', alpha=0.5, figsize=(10, 7))\nplt.legend(labels=['Northeast','Northwest','Southeast','Southwest'])\nplt.title('Distribution of Charges Between Regions', size=24)\nplt.xlabel('Medical Charges', size=18)\nplt.ylabel('Frequency', size=18)","5a1ac220":"data[data['smoker_yes'] == 1].charges.plot(kind='hist', color='blue', edgecolor='black', alpha=0.5, figsize=(10, 7))\ndata[data['smoker_no'] == 1].charges.plot(kind='hist', color='magenta', edgecolor='black', alpha=0.5, figsize=(10, 7))\nplt.legend(labels=['Smoker', 'Non-Smoker'])\nplt.title('Distribution of Charges on Smokers & Non-Smokers', size=24)\nplt.xlabel('Medical Charges', size=18)\nplt.ylabel('Frequency', size=18)","3ac57d92":"data[data['sex_male'] == 1].charges.plot(kind='hist', color='blue', edgecolor='black', alpha=0.5, figsize=(10, 7))\ndata[data['sex_female'] == 1].charges.plot(kind='hist', color='magenta', edgecolor='black', alpha=0.5, figsize=(10, 7))\nplt.legend(labels=['Male', 'Female'])\nplt.title('Distribution of Charges on Males & Females', size=24)\nplt.xlabel('Medical Charges', size=18)\nplt.ylabel('Frequency', size=18)","efdb923e":"# scatter plot of Age, Smokers, and Medical Charges\nax1 = data[data['smoker_yes'] == 1].plot(kind='scatter', x='age', y='charges', color='blue', alpha=0.5, figsize=(10, 7))\ndata[data['smoker_no'] == 1].plot(kind='scatter', x='age', y='charges', color='magenta', alpha=0.5, figsize=(10 ,7), ax=ax1)\n\n# legend, title, and labels\nplt.legend(labels=['Smoker', 'Non-Smoker'])\nplt.title('Relationship Between Age, Smoking, and Medical Charges', size=24)\nplt.xlabel('Age', size=18)\nplt.ylabel('Medical Charges', size=18);","65e475d4":"# scatter plot of BMI, Smokers, and Medical Charges\nax1 = data[data['smoker_yes'] == 1].plot(kind='scatter', x='bmi', y='charges', color='blue', alpha=0.5, figsize=(10, 7))\ndata[data['smoker_no'] == 1].plot(kind='scatter', x='bmi', y='charges', color='magenta', alpha=0.5, figsize=(10 ,7), ax=ax1)\nplt.legend(labels=['Smoker', 'Non-Smoker'])\nplt.title('Relationship Between BMI, Smoking, and Medical Charges', size=24)\nplt.xlabel('BMI', size=18)\nplt.ylabel('Medical Charges', size=18)","6657038e":"# plot for underweight\nplt.figure(figsize=(12,5))\nplt.title(\"Medical Charges of BMI < 18.5 (Underweight)\")\nax = sns.distplot(data[(data.bmi <= 18.5)]['charges'], color = 'm')\n\n# calculate average medical charge for someone underweight\nunderweight_charge = data[(data.bmi <= 18.5)]['charges'].mean()\nprint('Average Medical Charge (Underweight BMI):', underweight_charge)","bdd187bc":"# plot for normal weight\nplt.figure(figsize=(12,5))\nplt.title(\"Medical Charges of BMI Between 18.5 - 25 (Normal)\")\nax = sns.distplot(data[(data.bmi.between(18.5,25))]['charges'], color = 'g')\n\n# calculate average medical charge for someone normal\nnormal_charge = data[data.bmi.between(18.5,25)]['charges'].mean()\nprint('Average Medical Charge (Normal BMI):', normal_charge)","70f4dcd6":"# plot for overweight\nplt.figure(figsize=(12,5))\nplt.title(\"Medical Charges of BMI Between 25 - 30 (Overweight)\")\nax = sns.distplot(data[(data.bmi.between(25,30))]['charges'], color = 'y')\n\n# calculate average medical charge for someone overweight\noverweight_charge = data[data.bmi.between(25,30)]['charges'].mean()\nprint('Average Medical Charge (Overweight BMI):', overweight_charge)","29d11e70":"# plot for obese\nplt.figure(figsize=(12,5))\nplt.title(\"Medical Charges of BMI >= 30 (Obese)\")\nax = sns.distplot(data[(data.bmi >= 30)]['charges'], color = 'r')\n\n# calculate average medical charge for someone obese\nobese_charge = data[data.bmi >= 30]['charges'].mean()\nprint('Average Medical Charge (Obese BMI):', obese_charge)","9955e173":"# calculate average medical charge for someone with zero children\nzero_child = data[(data.children == 0)]['charges'].mean()\nprint('Average Medical Charge (Zero Children):', zero_child)\n\n# calculate average medical charge for someone with one child\none_child = data[(data.children == 1)]['charges'].mean()\nprint('Average Medical Charge (One Child):', one_child)\n\n# calculate average medical charge for someone with two children\ntwo_child = data[(data.children == 2)]['charges'].mean()\nprint('Average Medical Charge (Two Children):', two_child)\n\n# calculate average medical charge for someone with three children\nthree_child = data[(data.children == 3)]['charges'].mean()\nprint('Average Medical Charge (Three Children):', three_child)\n\n# calculate average medical charge for someone with four children\nfour_child = data[(data.children == 4)]['charges'].mean()\nprint('Average Medical Charge (Four Children):', four_child)\n\n# calculate average medical charge for someone with five children\nfive_child = data[(data.children == 5)]['charges'].mean()\nprint('Average Medical Charge (Five Children):', five_child)","79c18631":"g= sns.catplot(x=\"children\", y='charges', hue=None, data=tmp_data,\n                height= 6, kind=\"point\", aspect=1.0, legend_out=True, width=0.4, linewidth=3,  linestyles = '--', capsize=.1, dodge= 0.15,\n                sharey=True, \n                palette = sns.color_palette(\"deep\", n_colors = 1))\n\ng.despine(left=True)\ng.set_titles(\"Relationship Between Children and Medical Charges\", weight='bold')\ng.set_axis_labels(\"Number of Children\", \"Medical Charges\")","95ff852f":"g= sns.catplot(x=\"children\", y='charges', hue='smoker', data=tmp_data,\n                height= 6, kind=\"point\", aspect=1.0, legend_out=True, width=0.4, linewidth=3,  linestyles = '--', capsize=.1, dodge= 0.15,\n                sharey=True, \n                palette = sns.color_palette(\"deep\", n_colors = 2))\n\ng.despine(left=True)\ng.set_titles(\"Relationship Between Children, Smoker, and Medical Charges\", weight='bold')\ng.set_axis_labels(\"Number of Children\", \"Medical Charges\")\ng._legend.set_title(\"Smoker\")","53d9c6b2":"# import dataset using Pandas\ndata = pd.read_csv('..\/input\/insurance\/insurance.csv')\n\n# drop regions column\ndata = data.drop(['region'], axis=1)","571396a3":"data.head()","ff2e0f78":"# set independent and dependent variables\nx = data.iloc[:,:-1].values # age, sex, BMI, children, smoker, region\ny = data.iloc[:,-1].values # charges\n\nprint('Independent Variables\\n',x)\nprint('\\nDependent Variables\\n',y)","f143e6d3":"# get column index of categorical variables (sex, smoker, region)\nprint('Sex Column Index:', data.columns.get_loc('sex'))\nprint('Smoker Column Index:', data.columns.get_loc('smoker'))","56a6c2cf":"# import module for one-hot encoding scheme\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.preprocessing import OneHotEncoder\n\n# sex and smoker column index is 1 and 4\ndummy_transformer = ColumnTransformer(transformers=[('encoder', OneHotEncoder(), [1,4])], remainder='passthrough')\nx = np.array(dummy_transformer.fit_transform(x))","a0e6ffd7":"# import module to split data into training and test set\nfrom sklearn.model_selection import train_test_split \n\n# 80% training & 20% testing\nx_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.2, random_state=0)","ded5e9ed":"# import the LinearRegression() class\nfrom sklearn.linear_model import LinearRegression\n\n# create a regressor model\nregressor = LinearRegression()\n\n# fit the training data, feature scaling is not needed for regression models\nregressor.fit(x_train, y_train)","d95b5e2b":"# the vector of the predicted medical charges in the training set\ny_train_pred = regressor.predict(x_train)\n\n# the vector of the predicted medical charges in the test set\ny_test_pred = regressor.predict(x_test)","60432c61":"# compare y_test_pred (prediction) to the y_test (actual)\ni = 0\nwhile i < len(y_test_pred):\n    diff = abs(round(y_test_pred[i], 2) - y_test[i])\n    print(\"Predicted: \" + str(round(y_test_pred[i], 2)) + \" vs Actual: \" + str(round(y_test[i], 2)) +\n          \" ---> Difference: \" + str(round(diff, 2)))\n    i += 1","7aaf15c8":"from sklearn.metrics import mean_squared_error\nfrom sklearn.metrics import r2_score\n\n# calculate MSE values on the training and test set\nMSE_train = mean_squared_error(y_train, y_train_pred)\nMSE_test = mean_squared_error(y_test, y_test_pred)\n\n# calculate R2 values on the training and test set\nR2_train = r2_score(y_train, y_train_pred)\nR2_test = r2_score(y_test, y_test_pred)\n\nprint('MSE (Training):', MSE_train)\nprint('MSE (Test):', MSE_test)\n\nprint('\\nR2 (Training):', R2_train)\nprint('R2 (Test):', R2_test)","3552c38e":"\"\"\"\nregressor.predict([[sex_female, sex_male, smoker_no, smoker_yes, age, BMI, children]])\n\nOnly for categorical variables:\n1 - Yes\/True\n0 - No\/False\n\"\"\"\n# enter categorical and numerical inputs\nprint(regressor.predict([[1,0,0,1,19,27.90,0]]))","38aee55f":"## Train The Multiple Linear Regression Model On The Training Set","14149576":"### (B) Relationship Between BMI & Medical Charges\nHow does **BMI** affect medical charges?","f5f30876":"## Visualization of The Correlation Matrix (Heatmap)\n* A good way to check correlations among variables in a dataset is by visualizing the correlation matrix as a heatmap\n* I will be using the heatmap method in this article with the Seaborn library: https:\/\/heartbeat.fritz.ai\/seaborn-heatmaps-13-ways-to-customize-correlation-matrix-visualizations-f1c49c816f07\n\n**However, we must first encode our catageorical variables: *sex, smoker, and region***","10b8ce63":"* The **number of people** across the regions is about the same\n* The **amount of medical charges** between regions do no vary drastically","f618fd97":"## Import Libraries\n* To get started on our exploratory data analysis, let's first import all the libararies we'll be using","5ae92b29":"## Descriptive Statistics of Smokers and Non-Smokers\n* We can get more numerical insight on smokers & non-smokers by using the 'describe()' function on the dataset","7fa79c1e":"From the heatmap we can see that there is a **strong correlation** between being a **smoker** and the **medical charges.**\n\nThere is also small correlation between **age** and **medical charges** as well.","21ecbf52":"## Predict The Test Set Results","295209f1":"* There are no missing values so we can now start working with the dataset!","ab4cba3a":"## Import and Initialize Independent & Dependent Variables\nLet's import the dataset again and create our 'x' (independent) & 'y' (dependent) variables.\n\nWe will be dropping the **'regions'** column because of ***multicollinearity*** - this may skew our model.","7980c5be":"## Import The Dataset\n* Next, we will be importing the provided dataset, **\"insurance.csv,\"** into our notebook file\n* Before creating our exploratory data analysis and machine learning model, we must check if there are any missing values in the dataset","00ff09f7":"### (C) Relationship Between Children & Medical Charges\nWill the **number of children** affect medical charge?","bd824700":"# **1. Exploratory Data Analysis (EDA)**","d0c27bd3":"### (A) Relationship Between Age & Medical Charges\nHow does **age** affect medical charges?","ac290494":"## Making a Single Prediction\nFor example the medical charge of someone with these factors: \n* **Sex** = Female, **Smoker** = Yes, **Age** = 19, **BMI** = 27.9, **Children** = 0","359025be":"## Visulization of Variables Involving Medical Charges\n* From our variable distrubtions, we know that **smoking** greatly affects the price of medical charges\n* Medical charges are not affected by **sex** and **regions** as their distributions in regards to medical charges is normal\n\nWe will now further analyze if **age, BMI, and number of children** affects the price of medical charges.","87012a0a":"* From the plot above we can see the **difference of medical charge between smokers and non-smokers with having the same number of children**\n* The number of children doesn't seem to affect medical charges, rather **smoking** causes the great difference in medical charges","44cc02c6":"# References\nI definitely learned a lot on exploratory data analysis for this notebook from these sources:\n* https:\/\/www.kaggle.com\/hely333\/eda-regressio\n* https:\/\/towardsdatascience.com\/simple-and-multiple-linear-regression-with-python-c9ab422ec29c\n* https:\/\/heartbeat.fritz.ai\/seaborn-heatmaps-13-ways-to-customize-correlation-matrix-visualizations-f1c49c816f07","8cdf9dad":"<img src=\"https:\/\/github.com\/MCKasman\/mckasman.github.io\/blob\/master\/misc\/medical.png?raw=true\" width='300' height='300'>\n\n\n# Introduction\nI've always been curious why insurance rates differ between people, even if both individuals are identically healthy. How do health insurance agencies determine medical charges for individuals? *Should we eat more or eat less? To smoke or not to smoke?* Haha, it's always been clear in the real world that smoking will definitely hike up the price, but let's take advantage of the variables in this amazing dataset and see if they affect medical charges or not. Once we find out a pattern or variables related to charges, we can then develop a machine learning model to predict anyone else's medical charge within the constraints of the data we have. Most specifically, we'll be using **multiple linear regression (MLR)** in this notebook!","43cce67a":"It's quite interesting how **the average medical charge for someone underweight is less than someone with a normal BMI** since being underweight is related to more health issues.\n* Based on the plots and average medical charge across BMI types, **higher medical charge is dependent on higher BMI.**","5e6ea33f":"Now that it's encoded we can start the process of visualizing the correlation matrix","002ddc19":"## Split The Dataset Into The Training & Test Set","aa182681":"# 2. Multiple Linear Regression (MLR) Model\nWith the multiple variables we have within the dataset, we will create an MLR model to predict the price of someone's medical charge.","0e4e0075":"* The distribution of **medical charges on males and females** above show that it is normal\n\nWe now have more of an understanding of our dataset and what we should focus on: **age, BMI, number of children**","0e6699a4":"* We could infer from the upward trend in the plot above that **increasing age increases medical charges**\n* Other variables such as **BMI, and children** could also explain the deviation of points in medical charges straying away from the trend of smokers and non-smokers above","e8dfc388":"## EDA Results\nThrough analyzing the variables in the dataset we found that only your **age, BMI,** and being a **smoker** impacts medical charge prices. **Sex, region, and the number of children** does not affect the price of medical charges.\n\n**MEDICAL CHARGE WILL BE AFFECTED BECAUSE OF...** \n* **Age:** The price of medical charges increases the older you become.\n* **BMI:** The higher your BMI level, the higher your medical charge will be.\n* **Smoker:** *Smoke and become broke.* Medical charge price will sky rocket if you're a smoker!\n    * From our descriptive statistics analysis earlier: ***the average charge of smokers (32,050.23) is higher compared to non-smokers (8,434.27)***\n    \n**MEDICAL CHARGE WILL NOT BE AFFECTED BECAUSE OF...** \n* **Sex:** Your sex will not impact medical charges. Male or female, the medical charge price is approximate.\n* **Region:** Where you live will not affect medical charges, the distribution of charges is about the same across all regions.\n* **Number of Children:** The number of children  dependent on you will not affect the price of your medical charge.","f45b53cd":"* From the heatmap and descriptive statistics chart, we can infer that **being a smoker definitely increases medical charges**\n* The **average charge of smokers (32,050.23)** is higher compared to  **non-smokers (8,434.27)**\n\nBut what other variables impact medical charges?","6208e4da":"## Calculate Mean Squared Error (MSE) and R-Squared (R2) Values\nTo see how well the model predicts medical charges, we must calculate the MSE and R2 values","037a69cd":"We want to check if being unhealthy affects medical charges. Other than smoking, we can check the health of people with their BMI. Being **underweight, overweight, and obese** is considered unhealthy.","0179ac61":"## Encode Categorical Data (Independent Variables)\nInstead of using the 'pd.get_dummy()'function to encode our categorical variables, we'll be using a OneHotEncoder.","39d394e4":"## Distribution of Variables\n* Let's visualize the variables in our dataset, we want to view their distribution\n* We will be using **histograms** and **bar charts** to visualize the variable distributions","d5c3acb8":"* Majority of people paying for medical charges do not have children","115d68c1":"* We can see there is **no clear pattern between the number of children and medical charges.**\n\nLet's plot a comparison between smokers and non-smokers and the number of children they have.","083efe91":"* We can see that there are more non-smokers than smokers paying less medical charges","4b14b26c":"# Conclusion\n* **Age, BMI, and being a smoker** affects the price of medical charges for individuals\n    * Medical charge **increases** as age and BMI **increases**\n    * Medical charge will always be high if you're a smoker\n* Although not 100% accurate, our MLR model is **fairly accurate** as it predicates a medical charge close to the actual price. We can try other types of regression to get better results such as **random forest** and **support vector regression**\n\nIf you liked my notebook please give it an **upvote!** Also please comment if you have any feedback as this is my first notebook on Kaggle!","17f8d81a":"* A BMI of 30.7 is considered overweight which may possibly affect medical charges\n\n<img src = 'https:\/\/www.richardlipmanmd.com\/wp-content\/uploads\/2019\/01\/BMI-Chart.jpg'>","6f8820f3":"* There are more 18 year olds paying for medical charges than any other age\n* Most people paying for medical charges are young"}}