{"cell_type":{"6165ed05":"code","bd2f03f5":"code","590e5127":"code","0eed5ca1":"code","c478654f":"code","ffd69681":"code","c9ed832c":"code","abb691a5":"code","d692d082":"code","504fcb0a":"code","ad100e18":"code","f6f318c1":"code","faf51f46":"code","4efb52c6":"code","32395899":"code","8ffeaee9":"code","965df2a4":"code","30487fb6":"code","4448b8a5":"code","0f579a70":"code","677d95df":"code","ee9f34ff":"code","383ba106":"code","18b8a2dc":"code","a214a4a8":"code","b62a44c9":"code","1d42d3c1":"code","fce90cff":"code","771076cf":"code","902c6d25":"code","08167190":"code","482f29bf":"markdown","95d40a25":"markdown","93ea6137":"markdown","e5154221":"markdown","3dca63a8":"markdown","a2dffb5e":"markdown","7481fa39":"markdown","d975570d":"markdown","cf30a103":"markdown","48071df5":"markdown","b0cc6b68":"markdown","08bcc56c":"markdown","873f0be1":"markdown","d30c022d":"markdown","6852cb34":"markdown"},"source":{"6165ed05":"from __future__ import division\n\n%matplotlib inline\nimport networkx as nx\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nimport numpy as np\nimport warnings\nfrom collections import Counter\nimport sys\nimport os\nplt.rcParams[\"figure.figsize\"] = (20,10)\nimport tqdm as tqdm\n\nwarnings.filterwarnings('ignore')\nfrom IPython.core.display import display, HTML\ndisplay(HTML(\"<style>.container { width:80% !important; }<\/style>\"))","bd2f03f5":"books = []\nwd = '\/kaggle\/input\/interaction-networks-for-game-of-thrones-saga\/'\nfor i in range(5):\n    books.append(pd.read_csv(wd + 'asoiaf-book{}-edges.csv'.format(i+1)))","590e5127":"all_books = pd.concat(books)","0eed5ca1":"all_books.head()","c478654f":"edges = all_books.groupby(['Source','Target']).agg({'weight':'sum'}).reset_index()","ffd69681":"edges.sort_values('weight',ascending=False).head()","c9ed832c":"GOT = nx.from_pandas_edgelist(edges, \n                            source='Source',\n                            target='Target',\n                            edge_attr='weight' )","abb691a5":"print(nx.info(GOT))","d692d082":"weighted_degrees = dict(nx.degree(GOT,weight='weight'))\nmax_degree = max(weighted_degrees.values())","504fcb0a":"import seaborn as sns","ad100e18":"h = plt.hist(weighted_degrees.values(), bins = 30)","f6f318c1":"subG = GOT.subgraph([n for n in weighted_degrees if weighted_degrees[n]>200])","faf51f46":"print(nx.info(subG))","4efb52c6":"pos = nx.spring_layout(subG,weight='weight',iterations=20, k = 4)","32395899":"plt.axis('off')\nplt.title('Game of Thrones Network',fontsize = 24)\n\n\nfor node in subG.nodes():\n    size = 100*weighted_degrees[node]**0.5\n    ns = nx.draw_networkx_nodes(subG,pos,nodelist=[node], node_size=size, node_color='#009fe3')\n    ns.set_edgecolor('#f2f6fa')\n\nnx.draw_networkx_labels(subG,pos,{n:n.replace('-','\\n') for n in subG.nodes() if weighted_degrees[n]>100},font_size=10);\n\nfor e in subG.edges(data=True):\n    if e[2]['weight']>10:\n        nx.draw_networkx_edges(subG,pos,[e],width=e[2]['weight']\/100,edge_color='#707070')","8ffeaee9":"infection_times = {}","965df2a4":"def independent_cascade(G,t,infection_times):\n    #doing a t->t+1 step of independent_cascade simulation\n    #each infectious node infects neigbors with probabilty proportional to the weight\n    max_weight = max([e[2]['weight'] for e in G.edges(data=True)])\n    current_infectious = [n for n in infection_times if infection_times[n]==t]\n    for n in current_infectious:\n        for v in G.neighbors(n):\n            if v not in infection_times:\n                if  G.get_edge_data(n,v)['weight'] >= np.random.random()*max_weight:\n                    infection_times[v] = t+1\n    return infection_times","30487fb6":"def plot_G(G,pos,infection_times,t):\n    current_infectious = [n for n in infection_times if infection_times[n]==t]\n    plt.figure()\n    plt.axis('off')\n    plt.title('Game of Thrones Network, t={}'.format(t),fontsize = 24)\n\n    for node in G.nodes():\n        size = 100*weighted_degrees[node]**0.5\n        if node in current_infectious:\n            ns = nx.draw_networkx_nodes(G,pos,nodelist=[node], node_size=size, node_color='#feba02')\n        elif infection_times.get(node,9999999)<t:\n            ns = nx.draw_networkx_nodes(G,pos,nodelist=[node], node_size=size, node_color='#f2f6fa')\n        else:\n            ns = nx.draw_networkx_nodes(G,pos,nodelist=[node], node_size=size, node_color='#009fe3')\n        ns.set_edgecolor('#f2f6fa')\n    nx.draw_networkx_labels(G,pos,{n:n.replace('-','\\n') for n in G.nodes() if weighted_degrees[n]>100},font_size=10);\n\n    for e in G.edges(data=True):\n        if e[2]['weight']>10:\n            nx.draw_networkx_edges(G,pos,[e],width=e[2]['weight']\/100,edge_color='#707070')\n","4448b8a5":"infection_times = {'Bran-Stark':-1,'Samwell-Tarly':-1,'Jon-Snow':0}","0f579a70":"for t in range(10):\n    plot_G(subG,pos,infection_times,t)\n    infection_times = independent_cascade(subG,t,infection_times)","677d95df":"top = pd.DataFrame.from_dict(dict(nx.degree(subG)),orient='index').sort_values(0,ascending=False)\ntop.columns = ['Degree']\ntop['Weighted Degree'] =  pd.DataFrame.from_dict(dict(nx.degree(subG,weight='weight')),orient='index')\ntop['PageRank'] = pd.DataFrame.from_dict(dict(nx.pagerank_numpy(subG,weight='weight')),orient='index')\ntop['Betweenness'] =  pd.DataFrame.from_dict(dict(nx.betweenness_centrality(subG,weight='weight')),orient='index')","ee9f34ff":"top.head()","383ba106":"methods = top.columns\n\nprint(nx.info(subG))\nprint(nx.info(GOT))","18b8a2dc":"max_budget = len(subG.nodes())\ntrials = 50\nall_results = []\nfor budget in tqdm.tqdm_notebook(range(max_budget)):\n    results = {'budget':budget}\n    for method in methods:\n        infections = []\n        for i in range(trials):\n            infected = 0\n            t= 0\n            infection_times = {n:0 for n in top.sort_values(method,ascending=False).index[:budget]}\n            while len(infection_times)>infected:\n                #t+=1\n                infected = len(infection_times)\n                infection_times = independent_cascade(subG,t,infection_times)\n                t+=1\n            infections.append(infected)\n        results[method] = np.round(np.mean(infections)\/len(subG.nodes()),2)\n\n    all_results.append(results)\n              ","a214a4a8":"res_df = pd.concat([pd.DataFrame.from_dict(r,orient='index').T \n                        for r in all_results]).set_index('budget')","b62a44c9":"res_df.index = res_df.index\/len(subG.nodes())","1d42d3c1":"res_df.head()","fce90cff":"res_df.plot()\nplt.legend(fontsize = 18)\nplt.ylabel('Virality rate (out of total graph size)',fontsize = 18)\nplt.xlabel('Seeding Budget (out of graph size)', fontsize = 18)","771076cf":"from itertools import product\n\nbudget=2\n\nseed_sets = list(product(*[subG.nodes()]*budget))\n\nprint(len(seed_sets),'Seeding options')","902c6d25":"budget = 2\ntrials = 20\nall_results = []\nresults = {'budget':budget}\nfor seed in tqdm.tqdm_notebook(seed_sets[:]):\n    infections = []\n    for i in range(trials):\n        infected = 0\n        t= 0\n        infection_times = {n:0 for n in seed}\n        while len(infection_times)>infected:\n            #t+=1\n            infected = len(infection_times)\n            infection_times = independent_cascade(subG,t,infection_times)\n            t+=1\n        infections.append(infected)\n    results[seed] = np.round(np.mean(infections)\/len(subG.nodes()),2)\n\nall_results.append(results)","08167190":"sorted(results.items(), key = lambda x: x[1], reverse=True)[:10]","482f29bf":"# Character Interaction, Information spread and influence Maximization in social network of Game of Thrones\n","95d40a25":"Plot the network:","93ea6137":"Andrew J. Beveridge, an associate professor of mathematics at Macalester College, and Jie Shan, an undergraduate created a network from the book A Storm of Swords by extracting relationships between characters to find out the most important characters in the book(or GoT).\n\nThe dataset is publicly avaiable for the 5 books at https:\/\/github.com\/mathbeveridge\/asoiaf. This is an interaction network and were created by connecting two characters whenever their names (or nicknames) appeared within 15 words of one another in one of the books. The edge weight corresponds to the number of interactions.\n\nCredits:\n\nBlog: https:\/\/networkofthrones.wordpress.com\n\nMath Horizons Article: https:\/\/www.maa.org\/sites\/default\/files\/pdf\/Mathhorizons\/NetworkofThrones%20%281%29.pdf\n\nMridul Seth: https:\/\/github.com\/MridulS\/pydata-networkx\/\n","e5154221":"![](images\/got.png)","3dca63a8":"### we will sum all the books into a single edge between characters","a2dffb5e":"In this notebook we will explore the network of Game of Thrones characters and simulate information spread and influence maximization in the network.","7481fa39":"### Now we'll compare the methods on a plot (percentage of infected network)","d975570d":"### Suppose Bran and Sam told Jon a secret. Who will find out about it?","cf30a103":"### For different budgets lets compare the centrality metrics for seeding","48071df5":"### Let's focus on the subnetwork of the key characters:","b0cc6b68":"##### Let's load in the datasets","08bcc56c":"### Let's find the best seeding 'couple' (budget = 2) by bruteforce search","873f0be1":"### Game of thrones network","d30c022d":"#### Let's identify infuencers in the networkm","6852cb34":"### Simulate independent cascade:"}}