{"cell_type":{"a4ed14de":"code","dc80d862":"code","93d7e8d3":"code","77bb58ea":"code","edcd5a92":"code","1c5a5bc2":"code","ec86a8b1":"code","edba329d":"code","9d384952":"code","402f749c":"code","41c23993":"code","dac41a0d":"code","9b5d8e45":"code","ccca23b1":"code","e5e601f7":"code","ffedab87":"code","0ed40e44":"code","fb463fee":"code","7ba5246a":"code","aa6dcc67":"code","dd544b56":"code","a95f215b":"code","be21e8c8":"code","16b43524":"code","00509e81":"markdown","76c62d16":"markdown","50dc144e":"markdown"},"source":{"a4ed14de":"%matplotlib  inline\n\nimport numpy as np \nimport pandas as pd \n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()\n\nimport glob\nimport missingno as msno\nfrom fbprophet import Prophet\n\nfrom datetime import datetime, timedelta\nfrom statsmodels.tsa.arima_model import ARIMA\nfrom statsmodels.tsa.statespace.sarimax import SARIMAX\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\nfrom statsmodels.tsa.stattools import adfuller\nfrom statsmodels.tsa.seasonal import seasonal_decompose\nfrom scipy import stats\nimport statsmodels.api as sm\nfrom itertools import product\nfrom math import sqrt\nfrom sklearn.metrics import mean_squared_error \n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport os\nprint(os.listdir(\"..\/input\"))","dc80d862":"colors = [\"windows blue\", \"amber\", \"faded green\", \"dusty purple\"]\nsns.set(rc={\"figure.figsize\": (20,10), \"axes.titlesize\" : 18, \"axes.labelsize\" : 12, \n            \"xtick.labelsize\" : 14, \"ytick.labelsize\" : 14 })\nsns.set(context='poster', font_scale=.8, style='ticks')\n","93d7e8d3":"inspections = pd.read_csv('..\/input\/restaurant-and-market-health-inspections.csv', \n                          parse_dates=['activity_date'])\ninspections_raw = inspections.copy()\ninspections.set_index('serial_number', inplace=True)\n\nviolations = pd.read_csv('..\/input\/restaurant-and-market-health-violations.csv',\n                        parse_dates=['activity_date'])\nviolations_raw = violations.copy()","77bb58ea":"inspections = inspections[inspections.service_description == 'ROUTINE INSPECTION']\ninspections = inspections[inspections.program_status == 'ACTIVE']\n\ncols = ['activity_date', 'employee_id', 'facility_id', 'record_id', 'pe_description',\n       'score', 'grade']\n\ninspections = inspections[cols]\n\ninspections.head(3)","edcd5a92":"print(inspections.employee_id.nunique(), 'employees inspected', inspections.facility_id.nunique(), \n      'facilities and recorded', inspections.record_id.nunique(), 'entries from', \n      inspections.activity_date.min().date(), 'to',\n     inspections.activity_date.max().date())","1c5a5bc2":"daily_inspections = pd.DataFrame(inspections.groupby(['activity_date'])['facility_id'].nunique())\ndaily_inspections.reset_index(inplace=True)\ndaily_inspections.head(3)","ec86a8b1":"ax = sns.lineplot(x='activity_date', y='facility_id',  data=daily_inspections)\nax.set_xlim(daily_inspections.activity_date.min(), daily_inspections.activity_date.max())\nax.set_title('Number of facilities visited per day')\nax.set_xlabel('Date')\nax.set_ylabel('# Facilities')\nsns.despine();","edba329d":"facility_type = pd.DataFrame(inspections.groupby(['pe_description'])['facility_id'].nunique())\nfacility_type.reset_index(inplace=True)\nfacility_type = facility_type.sort_values(by='pe_description')","9d384952":"ax = sns.barplot(y='pe_description', x='facility_id', data=facility_type, color='#081d58')\nax.set_xlabel('# Facilities')\nax.set_ylabel('Facility type')\nax.set_title('Number of facilities per Facility type')\nsns.despine();","402f749c":"facility_score = pd.DataFrame(inspections.groupby(['pe_description'])['score'].mean())\nfacility_score.reset_index(inplace=True)\nfacility_score = facility_score.sort_values(by='pe_description')\nfacility_score['score'] = np.round(facility_score['score'], 1)","41c23993":"ax = sns.barplot(y='pe_description', x='score', data=facility_score, color='#081d58')\nax.set_xlabel('Average Score')\nax.set_ylabel('Facility type')\nax.set_xlim(facility_score.score.min()-.5, facility_score.score.max()+.5)\nax.set_title('Avg Score per Facility type')\nsns.despine();","dac41a0d":"facility_grade = pd.DataFrame(inspections.groupby(['pe_description', 'grade'])['score'].mean())\nfacility_grade.reset_index(inplace=True)\nfacility_grade = facility_grade.sort_values(by='pe_description')\nfacility_grade['score'] = np.round(facility_grade['score'], 1)","9b5d8e45":"ax = sns.barplot(y='pe_description', x='score', data=facility_grade[facility_grade.grade == 'A'], color='#225ea8')\nax.set_xlabel('Average Score')\nax.set_ylabel('Facility type')\nax.set_title('Avg Grade A Score per Facility type')\nax.set_xlim(facility_grade.score.min()-.5, facility_grade.score.max()+.5)\nsns.despine();","ccca23b1":"ax = sns.barplot(y='pe_description', x='score', data=facility_grade[facility_grade.grade == 'B'], color='#7fcdbb')\nax.set_xlabel('Average Score')\nax.set_ylabel('Facility type')\nax.set_title('Avg Grade B Score per Facility type')\nax.set_xlim(facility_grade.score.min()-.5, facility_grade.score.max()+.5)\nsns.despine();","e5e601f7":"ax = sns.barplot(y='pe_description', x='score', data=facility_grade[facility_grade.grade == 'C'], color='#edf8b1')\nax.set_xlabel('Average Score')\nax.set_ylabel('Facility type')\nax.set_title('Avg Grade C Score per Facility type')\nax.set_xlim(facility_grade.score.min()-.5, facility_grade.score.max()+.5)\nsns.despine();","ffedab87":"most_inspected = pd.DataFrame(inspections.groupby('facility_id')['record_id'].count())\nmost_inspected = most_inspected.sort_values('record_id', ascending=False)\nmost_inspected.head(1)","0ed40e44":"most_inspected_facility = inspections_raw[inspections_raw.facility_id == most_inspected.index[0]]\nmost_inspected_facility.head(3)","fb463fee":"dodgers_score  = pd.DataFrame(most_inspected_facility.groupby('activity_date')['score'].mean())\ndodgers_score.reset_index(inplace=True)\ndodgers_score['score'] = np.round(dodgers_score.score, 1)\ndodgers_score.head(3)","7ba5246a":"ax = sns.lineplot(x='activity_date', y='score', data=dodgers_score)\nax = sns.scatterplot(x='activity_date', y='score', data=dodgers_score)\nax.set_xlim(dodgers_score.activity_date.min(), dodgers_score.activity_date.max())\nax.set_title('Score of Dodger Stadium is decreasing every year')\nax.set_xlabel('Date')\nax.set_ylabel('Avg Score')\nsns.despine();","aa6dcc67":"dodger_violations = violations[violations.facility_id == most_inspected.index[0]]\ndodger_violations.head(3)","dd544b56":"dodger_violation_count = pd.DataFrame(dodger_violations.groupby(['activity_date'])['violation_code'].count())\ndodger_violation_count.reset_index(inplace=True)\ndodger_violation_count.tail(3)","a95f215b":"ax = sns.lineplot(x='activity_date', y='violation_code', data=dodger_violation_count)\nax = sns.scatterplot(x='activity_date', y='violation_code', data=dodger_violation_count)\nax.set_xlim(dodger_violation_count.activity_date.min(), dodger_violation_count.activity_date.max())\nax.set_title('Violations by Dodger Stadium is increasing every year')\nax.set_xlabel('Date')\nax.set_ylabel('# Violations')\nsns.despine();","be21e8c8":"dodger_violation_type = pd.DataFrame(dodger_violations.groupby(['violation_description'])['violation_code'].count())\ndodger_violation_type.reset_index(inplace=True)\ndodger_violation_type = dodger_violation_type.sort_values('violation_code', ascending=False)\ndodger_violation_type = dodger_violation_type.head(6)","16b43524":"ax = sns.barplot(y='violation_description', x='violation_code', data=dodger_violation_type, color='#081d58')\nax.set_xlabel('# Violations')\nax.set_ylabel('Violation type')\nax.set_title('Top 6 Non-Compliance violation in Dodger Stadium')\nsns.despine();","00509e81":"# Read in data","76c62d16":"# Most inspected facility?","50dc144e":"## What led to decrease in score?"}}