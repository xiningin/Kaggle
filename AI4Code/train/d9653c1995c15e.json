{"cell_type":{"5da6a3bd":"code","9d63ff6b":"code","b3e29598":"code","986a5928":"code","641c2170":"code","70b16b7e":"code","8bbd81c5":"code","69404ee7":"code","6fbcad39":"code","539d7c91":"code","aaa91976":"code","1d9203b0":"code","79c27c49":"code","9e9ad5b1":"code","e9f551e3":"code","1b2dcf98":"code","1f16e7b5":"code","5d56eb49":"code","ddbebc2b":"code","6a9ba0ce":"code","fe3279e8":"code","ce279e1c":"code","6e4582fd":"code","12906df7":"code","f91aaeb2":"code","b73b839e":"code","1509a054":"code","6d104108":"code","3baab4e7":"code","c3325842":"code","bdb3b9a1":"code","69b1acb3":"code","03b68b03":"code","a1d378b2":"code","9f73b93b":"code","094a76aa":"code","c37a17d6":"code","d6fd10cb":"code","36f16a6d":"code","82c28ba4":"code","8aa1d830":"code","3cbf8726":"code","4e72dcee":"code","cecaa4c3":"code","7fdabfc1":"code","5e0b01df":"markdown","bee1a120":"markdown","a159a5b2":"markdown","51b5567f":"markdown","cbc62db3":"markdown","9ce18ef7":"markdown","d0d40172":"markdown","9e7a32b3":"markdown","ae9337ea":"markdown","a608ff8b":"markdown","eb40423c":"markdown","4ae1e814":"markdown","c012f7b4":"markdown","095995c2":"markdown","e665ce68":"markdown","7d8a6128":"markdown","ce0aa196":"markdown","62ff5d1c":"markdown","d5af3966":"markdown","bcad398e":"markdown","4251b57c":"markdown","2b00c2f6":"markdown","dc9367ac":"markdown","3e650c3e":"markdown","a49cf680":"markdown"},"source":{"5da6a3bd":"import pandas as pd","9d63ff6b":"dados_de_teste = pd.read_csv(\"..\/input\/adult-pmr3508\/test_data.csv\", na_values=\"?\")\ndados_de_teste.head()","b3e29598":"dados_de_treino = pd.read_csv(\"..\/input\/adult-pmr3508\/train_data.csv\", na_values=\"?\")\ndados_de_treino.head()","986a5928":"dados_de_treino = dados_de_treino.dropna()\ndados_de_teste = dados_de_teste.dropna()","641c2170":"from sklearn.preprocessing import LabelEncoder\nimport seaborn as sns\nimport matplotlib as plt","70b16b7e":"dados_de_treino['income'] = LabelEncoder().fit_transform(dados_de_treino['income'])","8bbd81c5":"sns.heatmap(dados_de_treino.corr(), annot = True)","69404ee7":"dados_de_treino = dados_de_treino.drop(columns=[\"Id\", \"fnlwgt\"])\ndados_de_teste = dados_de_teste.drop(columns=[\"Id\", \"fnlwgt\"])","6fbcad39":"sns.heatmap(dados_de_treino.corr(), annot = True)","539d7c91":"dados_de_treino['income'].value_counts()\/dados_de_treino['income'].count() * 100","aaa91976":"dados_de_treino.groupby(['sex'])['income'].aggregate('mean').plot(kind='bar', ylabel=\"m\u00e9dia de income\", title=\"Tend\u00eancia a sal\u00e1rio >50k por sexo\")","1d9203b0":"dados_de_treino['sex'].value_counts()\/dados_de_treino['sex'].count() * 100","79c27c49":"dados_de_treino.groupby(['race'])['income'].aggregate('mean').plot(kind='bar', ylabel=\"m\u00e9dia de income\", title=\"Tend\u00eancia a sal\u00e1rio >50k por ra\u00e7a\")","9e9ad5b1":"dados_de_treino['race'].value_counts()\/dados_de_treino['race'].count() * 100","e9f551e3":"dados_de_treino.groupby(['native.country'])['income'].aggregate('mean').plot(kind='bar', ylabel=\"m\u00e9dia de income\", title=\"Tend\u00eancia a sal\u00e1rio >50k por pa\u00eds de origem\")","1b2dcf98":"dados_de_treino['native.country'].value_counts()\/dados_de_treino['income'].count() * 100","1f16e7b5":"dados_de_treino.groupby(['education'])['income'].aggregate('mean').plot(kind='bar', ylabel=\"m\u00e9dia de income\", title=\"Tend\u00eancia a sal\u00e1rio >50k por n\u00edvel educacional\")","5d56eb49":"dados_de_treino.groupby(['education.num'])['income'].aggregate('mean').plot(kind='bar', ylabel=\"m\u00e9dia de income\", title=\"Tend\u00eancia a sal\u00e1rio >50k por anos de estudo\")","ddbebc2b":"dados_de_treino['education'].value_counts()\/dados_de_treino['education'].count() * 100","6a9ba0ce":"dados_de_treino.groupby(['marital.status'])['income'].aggregate('mean').plot(kind='bar', ylabel=\"m\u00e9dia de income\", title=\"Tend\u00eancia a sal\u00e1rio >50k por status de relacionamento\")","fe3279e8":"dados_de_treino['marital.status'].value_counts()\/dados_de_treino['marital.status'].count() * 100","ce279e1c":"idades = list(set(dados_de_treino['age'].to_list())) #retira valores duplicados\nmedias_income = dados_de_treino.groupby(['age'])['income'].aggregate('mean').to_list()\nplt.pyplot.title(\"M\u00e9dia de sal\u00e1rio >50k por idade\")\nplt.pyplot.xlabel(\"age\")\nplt.pyplot.ylabel(\"M\u00e9dia de income\")\nplt.pyplot.scatter(x=idades, y=medias_income)","6e4582fd":"dados_de_treino['age'].value_counts().sort_index()[40:72]","12906df7":"dados_de_treino.groupby(['workclass'])['income'].aggregate('mean').plot(kind='bar', title=\"Tend\u00eancia a sal\u00e1rio >50k por tipo de emprego\")","f91aaeb2":"dados_de_treino['workclass'].value_counts()\/dados_de_treino['workclass'].count() * 100","b73b839e":"horas = list(set(dados_de_treino['hours.per.week'].to_list())) #retira valores duplicados\nmedias_income = dados_de_treino.groupby(['hours.per.week'])['income'].aggregate('mean').to_list()\nprint(medias_income.index(max(medias_income))+1) #valor de idade que possu\u00ed maior m\u00e9dia\nplt.pyplot.title(\"M\u00e9dia de sal\u00e1rio >50k por horas de trabalho na semana\")\nplt.pyplot.scatter(x=horas, y=medias_income)","1509a054":"dados_de_treino['hours.per.week'].value_counts().sort_index()[40:99]","6d104108":"dados_de_treino = pd.read_csv(\"..\/input\/adult-pmr3508\/train_data.csv\", na_values=\"?\")\ndados_de_treino['income'] = LabelEncoder().fit_transform(dados_de_treino['income'])\ndados_de_treino = dados_de_treino.drop(columns=[\"Id\", \"fnlwgt\"])\ndados_de_treino.isna().sum()","3baab4e7":"dados_de_teste = pd.read_csv(\"..\/input\/adult-pmr3508\/test_data.csv\", na_values=\"?\")\ndados_de_teste = dados_de_teste.drop(columns=[\"Id\", \"fnlwgt\"])\ndados_de_teste.isna().sum()","c3325842":"dados_de_treino = dados_de_treino.drop(columns=[\"native.country\"])\ndados_de_teste = dados_de_teste.drop(columns=[\"native.country\"])","bdb3b9a1":"dados_de_treino = dados_de_treino.apply(lambda col: LabelEncoder().fit_transform(col.astype(str)), axis=0, result_type='expand')\ndados_de_teste = dados_de_teste.apply(lambda col: LabelEncoder().fit_transform(col.astype(str)), axis=0, result_type='expand')","69b1acb3":"sns.heatmap(dados_de_treino.corr()[\"income\"].to_frame(), annot = True)","03b68b03":"dados_de_treino = dados_de_treino.drop(columns=[\"workclass\", \"education\", \"occupation\", \"race\"])\ndados_de_teste = dados_de_teste.drop(columns=[\"workclass\", \"education\", \"occupation\", \"race\"])","a1d378b2":"dados_de_teste.isna().sum()","9f73b93b":"dados_de_treino.head()","094a76aa":"dados_de_teste.head()","c37a17d6":"dados_de_treino_y = dados_de_treino[\"income\"]\ndados_de_treino_x = dados_de_treino.drop(columns=[\"income\"]).values","d6fd10cb":"from sklearn.model_selection import cross_val_score\nfrom sklearn.neighbors import KNeighborsClassifier","36f16a6d":"max_score = 0\nmax_k = 0\nfor k in range(15,40):\n    estimador = KNeighborsClassifier(n_neighbors = k)\n    scores = cross_val_score(estimador, dados_de_treino_x, dados_de_treino_y, cv=10)\n    if scores.mean() > max_score:\n        max_k = k\n        max_score = scores.mean()\nprint(\"Max k:\", max_k, \"max score m\u00e9dio:\", max_score)","82c28ba4":"estimador = KNeighborsClassifier(n_neighbors=24)","8aa1d830":"estimador = estimador.fit(dados_de_treino_x, dados_de_treino_y)","3cbf8726":"previsao = estimador.predict(dados_de_teste.values)","4e72dcee":"previsao_str = []\nfor i in previsao:\n    if i == 1:\n        previsao_str.append(\">50K\")\n    else:\n        previsao_str.append(\"<=50K\")","cecaa4c3":"df_submissao = pd.DataFrame({\"Id\": range(len(previsao)), \"income\": previsao_str})","7fdabfc1":"df_submissao.to_csv(\"submissao.csv\", index = False)","5e0b01df":"Antes de decidir o que fazer com os outros, vale a pena transformar os dados n\u00e3o-num\u00e9ricos em num\u00e9ricos e ver sua correla\u00e7\u00e3o com o income. Caso ela seja baixa podemos j\u00e1 retir\u00e1-los sem precisar pensar se a substitui\u00e7\u00e3o pela moda \u00e9 uma op\u00e7\u00e3o melhor.","bee1a120":"A an\u00e1lise das idades parece indicar que pessoas de por volta de 50 anos tendem a ter melhores sal\u00e1rios. H\u00e1 certas idades na faixa dos 75-85 anos que parecem superar as de 50 por\u00e9m, observando atentamente, vemos que o n\u00famero de casos destas idades \u00e9 muito pequeno e provavelmente se tratam de outliers.","a159a5b2":"Em primeira an\u00e1lise, o gr\u00e1fico parece justo, bem distribuido. Por\u00e9m quando olhamos para a concentra\u00e7\u00e3o de dados do pa\u00eds de origem, encontramos uma concentra\u00e7\u00e3o enorme nos Estados Unidos, o que pode comprometer a credibilidade dos outros dados.","51b5567f":"Partamos para a an\u00e1lise gr\u00e1fica. O m\u00e9todo principal que ultilizaremos para facilitar a interpreta\u00e7\u00e3o dos dados \u00e9 a continuiza\u00e7\u00e3o destes atrav\u00e9s da m\u00e9dia. Quanto mais pr\u00f3ximo de 1, mais indiv\u00edduos com o atributo observado possuem sal\u00e1rio anual >50k, enquanto quanto mais pr\u00f3ximo de 0, menos t\u00eam. Primeiro, a an\u00e1lise por sexo:","cbc62db3":"O gr\u00e1fico parece indicar que brancos e asi\u00e1ticos tem maiores tend\u00eancias a ganhar sal\u00e1rios altos, por\u00e9m os dados est\u00e3o concentrados em pessoas brancas, o que novamente pode indicar vi\u00e9s.","9ce18ef7":"Podemos ver que os tipos de casamento que possivelmente tornam mais lucrativas as familias s\u00e3o o casamento civil e o \"Married-AF-spouse\". Analisando as frequ\u00eancias de cada atributo no entanto vemos que este segundo talvez n\u00e3o seja um dado confi\u00e1vel, visto que ele \u00e9 observado em apenas 0,07% dos indiv\u00edduos.","d0d40172":"Vemos portanto que tanto occupation quanto workclass pouco influenciam em nossa vari\u00e1vel de interesse, e assim podemos nos desvencilhar delas. Por inspe\u00e7\u00e3o, vemos tamb\u00e9m que os atributos race e education podem ser retirados tamb\u00e9m.","9e7a32b3":"Primeiramente, iremos an\u00e1lisar a correla\u00e7\u00e3o entre as vari\u00e1veis num\u00e9ricas. Como nos interessamos no atributo \"income\", j\u00e1 o transformaremos em num\u00e9rico. ","ae9337ea":"\u00c9 muito claro observando a coluna \"income\" que os atributos Id e fnlwgt n\u00e3o influenciam relevantemente a nossa vari\u00e1vel de interesse. Retiremos portanto elas dos dados.","a608ff8b":"Assim ficam nossos dados de treino e teste:","eb40423c":"Vemos que os homens tem uma tend\u00eancia maior a ter sal\u00e1rios altos do que mulheres, embora mais homens tenham sido analisados, indicando um poss\u00edvel vi\u00e9s dos dados.","4ae1e814":"<font size='5'><b>4. Cria\u00e7\u00e3o do modelo e sele\u00e7\u00e3o de par\u00e2metros<\/b><\/font> <br>\nPrimeiramente, separemos nossos dados em \"x\" (atributos dispon\u00edveis) e \"y\" (vari\u00e1vel de interesse):","c012f7b4":"<font size='5'><b>2. An\u00e1lise de dados<\/b><\/font> <br>\nImportando as bibliotecas necess\u00e1rias:","095995c2":"Analisamos n\u00edvel educacional e anos de estudo juntos pois s\u00e3o dados muito intimamente relacionados. A an\u00e1lise dos dados tamb\u00e9m parece indicar o j\u00e1 esperado, niveis educacionais maiores e mais anos de estudo profissional tendem a proporcionar melhores chances de um alto sal\u00e1rio.","e665ce68":"Por fim, vendo o atributo de horas de trabalho por semana, vemos que a tend\u00eancia geral de pico \u00e9 em torno de 50 horas por semana, contando, similarmente \u00e0 an\u00e1lise das idades, com alguns outliers, como no caso dos 61 anos de idade, que possu\u00ed m\u00e9dia muito superior \u00e0s outras, mas porque conta com apenas duas apari\u00e7\u00f5es no dataset, como visto na an\u00e1lise.","7d8a6128":"Como vimos, o atributo native.country tem grandes chances de ser enviesado e portanto deve ser retirado","ce0aa196":"Novo heatmap:","62ff5d1c":"<font size='4'><b>2.1 Gr\u00e1ficos e estat\u00edsticas<\/b><\/font> <br>\nPrimeiramente, vejamos quantos porcento dos dados de interesse s\u00e3o maiores que 50k (indicado por 1) e menores (0):","d5af3966":"Para a decis\u00e3o do par\u00e2metro k, necess\u00e1rio na implementa\u00e7\u00e3o do algoritmo knn, utilizaremos do m\u00e9todo de valida\u00e7\u00e3o cruzada 10-fold iteradamente, analisando valores de k de 15 a 40, por serem de tamanho adequado para nossos dados, e encontraremos qual deles gera melhor resultado, olhando a pontua\u00e7\u00e3o m\u00e9dia fornecida pela valida\u00e7\u00e3o de cada k. Importando as bibliotecas necess\u00e1rias:","bcad398e":"Similar aos pa\u00edses de origem, os dados parecem at\u00e9 bem distribu\u00eddos por\u00e9m a inspe\u00e7\u00e3o da frequ\u00eancia de cada tipo poss\u00edvel revela que h\u00e1 concentra\u00e7\u00e3o na \u00e1rea privada. A tend\u00eancia maior de pessoas auto-empregadas pode ser contestada portanto devido \u00e0 sua baixa frequ\u00eancia nos dados.","4251b57c":"O valor de k que gera melhores resultados portanto \u00e9 24. Com isso, conseguimos criar o classificador utilizando a biblioteca sklearn.","2b00c2f6":"<font size='5'><b>3. Tratamento de dados<\/b><\/font> <br>\n<font size='3'><b>3.1 Dados faltantes<\/b><\/font> <br>\nAgora que analisamos que atributos podem estar enviesados, vejamos quais deles possuem lacunas e o que devemos fazer com elas: ","dc9367ac":"Por fim, devemos carregar nossos resultados num arquivo csv. ","3e650c3e":"<font size='5'><b>1. Importa\u00e7\u00e3o dos dados<\/b><\/font> <br>\nPrimeiramente, importamos a biblioteca pandas para facilmente ler os conte\u00fados csv de teste e de treino.","a49cf680":"Antes de analisar os dados faltantes com cuidado, pode valer a pena eliminar diretamente os indiv\u00edduos com dados faltantes de forma a fazer gr\u00e1ficos de an\u00e1lise realistas."}}