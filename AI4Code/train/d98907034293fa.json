{"cell_type":{"43d8df26":"code","2ae68d24":"code","3ff5fe06":"code","d33183c9":"code","2364ce0a":"code","c0b13ba2":"code","b13a0478":"code","3732125c":"code","793de15e":"code","96f88d00":"code","bd51cf0e":"code","b244851d":"code","5e143884":"code","a76cebf4":"code","6c18eb60":"code","44814606":"code","c64e6674":"code","88ae4fc2":"code","88b4a9d1":"code","45892625":"code","95c2fe4f":"code","697b0db5":"code","93b014ce":"code","84cc2143":"code","f2473521":"code","43d651f5":"code","aec41f5e":"code","3a31687e":"code","c0a21409":"code","6c1991eb":"code","d6e7626b":"code","bb83b3f9":"code","deaa107e":"code","6386c395":"code","bf29fdc1":"code","cd381400":"code","3e5fc222":"code","0b0e58fe":"code","d40681e5":"code","052f0d25":"code","c4d0ed9a":"code","8bc90925":"code","7bdf5007":"code","540e2065":"code","899656a9":"code","6eb7f986":"code","78944a3f":"code","dd0d932d":"code","328bcba3":"code","2f837047":"code","32578e04":"code","24bf3483":"code","7d910ff5":"code","06fd7c97":"code","62bfe95c":"code","bfb63d94":"code","111f538a":"code","5d1f76c5":"code","b64c6312":"code","49cdead7":"code","8a763d19":"code","a5e2efee":"code","2d66017e":"code","7f78aa9c":"code","9b5abf0d":"code","463c2ee6":"code","88265b51":"code","a260b48a":"code","ad687bd6":"code","4d02b02e":"markdown","af158355":"markdown","3dd85e77":"markdown"},"source":{"43d8df26":"!pip install catboost","2ae68d24":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport warnings\nimport numpy as np\nimport random\nfrom scipy.stats import zscore\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.metrics import mean_squared_error\n\nfrom xgboost import XGBRegressor\nfrom sklearn.ensemble import AdaBoostRegressor\nfrom catboost import CatBoostRegressor\nfrom lightgbm import LGBMRegressor\nwarnings.filterwarnings(\"ignore\")\n\nplt.ion()","3ff5fe06":"def set_seed(seed=42):\n    random.seed(seed)\n    np.random.seed(seed)","d33183c9":"set_seed()","2364ce0a":"df=pd.read_csv(\"..\/input\/beyond-analysis\/train.csv\")\ndf.head()","c0b13ba2":"df.describe()","b13a0478":"df.info()","3732125c":"sns.distplot(x=df[\"Y1\"])","793de15e":"sns.distplot(x=df[\"Y2\"])","96f88d00":"sns.countplot(x=\"STATUS_CHECK\", data=df)\nplt.show()","bd51cf0e":"sns.countplot(x=\"CATEGORY_1\", data=df)\nplt.show()","b244851d":"sns.countplot(x=\"CATEGORY_2\", data=df)\nplt.show()","5e143884":"sns.countplot(x=\"ACTIVE_YN\", data=df)\nplt.show()","a76cebf4":"df[\"DEPOSIT_TRAILS\"].nunique()","6c18eb60":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"DEPOSIT_TRAILS\")\nsns.distplot(x=df[\"DEPOSIT_TRAILS\"],ax=ax[0])\nax[1].set_title(\"DEPOSIT_TRAILS Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"DEPOSIT_TRAILS\"],0.25)), ax=ax[1])\nplt.show()","44814606":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"REVENUE\")\nsns.distplot(x=df[\"REVENUE\"],ax=ax[0])\nax[1].set_title(\"REVENUE Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"REVENUE\"],0.25)), ax=ax[1])\nplt.show()","c64e6674":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"WINNINGS_1\")\nsns.distplot(x=df[\"WINNINGS_1\"],ax=ax[0])\nax[1].set_title(\"WINNINGS_1 Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"WINNINGS_1\"],0.25)), ax=ax[1])\nplt.show()","88ae4fc2":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"WINNINGS_2\")\nsns.distplot(x=df[\"WINNINGS_2\"],ax=ax[0])\nax[1].set_title(\"WINNINGS_2 Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"WINNINGS_2\"],0.25)), ax=ax[1])\nplt.show()","88b4a9d1":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"DISCOUNT\")\nsns.distplot(x=df[\"DISCOUNT\"],ax=ax[0])\nax[1].set_title(\"DISCOUNT Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"DISCOUNT\"],0.1)), ax=ax[1])\nplt.show()","45892625":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"DEPOSIT\")\nsns.distplot(x=df[\"DEPOSIT\"],ax=ax[0])\nax[1].set_title(\"DEPOSIT Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"DEPOSIT\"],0.25)), ax=ax[1])\nplt.show()","95c2fe4f":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"WITHDRAW\")\nsns.distplot(x=df[\"WITHDRAW\"],ax=ax[0])\nax[1].set_title(\"WITHDRAW Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"WITHDRAW\"],0.25)), ax=ax[1])\nplt.show()","697b0db5":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"ENTRY_NUMBER\")\nsns.distplot(x=df[\"ENTRY_NUMBER\"],ax=ax[0])\nax[1].set_title(\"ENTRY_NUMBER Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"ENTRY_NUMBER\"],0.25)), ax=ax[1])\nplt.show()","93b014ce":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"WINNINGS_NUMBER\")\nsns.distplot(x=df[\"WINNINGS_NUMBER\"],ax=ax[0])\nax[1].set_title(\"WINNINGS_NUMBER Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"WINNINGS_NUMBER\"],0.25)), ax=ax[1])\nplt.show()","84cc2143":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"PRACTICE_ENTRY\")\nsns.distplot(x=df[\"PRACTICE_ENTRY\"],ax=ax[0])\nax[1].set_title(\"PRACTICE_ENTRY Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"PRACTICE_ENTRY\"],0.25)), ax=ax[1])\nplt.show()","f2473521":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"PRACTICE_WINNINGS\")\nsns.distplot(x=df[\"PRACTICE_WINNINGS\"],ax=ax[0])\nax[1].set_title(\"PRACTICE_WINNINGS Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"PRACTICE_WINNINGS\"],0.25)), ax=ax[1])\nplt.show()","43d651f5":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"PRACTICE_ENTRY_NUMBER\")\nsns.distplot(x=df[\"PRACTICE_ENTRY_NUMBER\"],ax=ax[0])\nax[1].set_title(\"PRACTICE_ENTRY_NUMBER Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"PRACTICE_ENTRY_NUMBER\"],0.25)), ax=ax[1])\nplt.show()","aec41f5e":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"PRACTICE_WINNINGS_NUMBER\")\nsns.distplot(x=df[\"PRACTICE_WINNINGS_NUMBER\"],ax=ax[0])\nax[1].set_title(\"PRACTICE_WINNINGS_NUMBER Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"PRACTICE_WINNINGS_NUMBER\"],0.25)), ax=ax[1])\nplt.show()","3a31687e":"sns.jointplot(data=df, y=\"REVENUE\", x=\"Y1\")","c0a21409":"categorical_variables=[\"STATUS_CHECK\", \"CATEGORY_1\", \"CATEGORY_2\", \"ACTIVE_YN\"]","6c1991eb":"plt.rcParams['figure.figsize'] = [14,14]\nfig,ax=plt.subplots(2,2)\nfor i in range(4):\n    sns.violinplot(x=categorical_variables[i], y=\"Y1\", data=df,ax=ax[i\/\/2][i%2])\nplt.show()","d6e7626b":"plt.rcParams['figure.figsize'] = [14,14]\nfig,ax=plt.subplots(2,2)\nfor i in range(4):\n    sns.violinplot(x=categorical_variables[i], y=\"Y2\", data=df,ax=ax[i\/\/2][i%2])\nplt.show()","bb83b3f9":"le_cat1=LabelEncoder()\nle_cat1.fit(df[\"CATEGORY_1\"])","deaa107e":"le_cat2=LabelEncoder()\nle_cat2.fit(df[\"CATEGORY_2\"])","6386c395":"continuous_variables=[\"REVENUE\", \"WINNINGS_1\", \"DEPOSIT_2\", \"DISCOUNT\", \"DEPOSIT\", \"WITHDRAW\", \"ENTRY_NUMBER\", \"ENTRY_NUMBER\", \"WINNINGS_NUMBER\"]","bf29fdc1":"df[\"CATEGORY_1\"]=le_cat1.transform(df[\"CATEGORY_1\"])\ndf[\"CATEGORY_2\"]=le_cat2.transform(df[\"CATEGORY_2\"])","cd381400":"df=df.groupby([\"UNIQUE_IDENTIFIER\"]).mean().reset_index(drop=True)\ndf.head()","3e5fc222":"num_bins = int(np.floor(1 + np.log2(len(df)))) \ndf.loc[:, \"bins\"] = pd.cut(df[\"Y2\"], bins=num_bins, labels=False)","0b0e58fe":"trans_df=df","d40681e5":"for col in continuous_variables:\n    trans_df[f\"t_{col}\"]=np.log(1+np.power(df[col],0.25))","052f0d25":"drop_cols=[\"SEQUENCE_NO\", \"PRACTICE_ENTRY\", \"PRACTICE_WINNINGS\", \"PRACTICE_ENTRY_NUMBER\", \"PRACTICE_WINNINGS_NUMBER\", \"CATEGORY_1\", \"CATEGORY_2\"]","c4d0ed9a":"trans_df=trans_df.drop(columns=continuous_variables+drop_cols,axis=1)","8bc90925":"trans_df.head()","7bdf5007":"sns.heatmap(trans_df.corr(),annot=True)","540e2065":"train_df,val_df=train_test_split(trans_df,test_size=0.2,stratify=trans_df[\"bins\"])","899656a9":"y1_train=train_df[\"Y1\"].values\ny1_val=val_df[\"Y1\"].values\ny2_train=train_df[\"Y2\"].values\ny2_val=val_df[\"Y2\"].values","6eb7f986":"X_train=train_df.drop(columns=[\"Y1\",\"Y2\",\"bins\"]).values\nX_val=val_df.drop(columns=[\"Y1\",\"Y2\",\"bins\"]).values","78944a3f":"xgb1=XGBRegressor(n_estimators=200, max_depth=9 ,verbosity=0,learning_rate=0.10)\nxgb1.fit(X_train,y1_train)","dd0d932d":"pred_val=xgb1.predict(X_val)","328bcba3":"mean_squared_error(y1_val, pred_val, squared=False)","2f837047":"xgb2=XGBRegressor()\nxgb2.fit(X_train,y2_train)\npred_val=xgb2.predict(X_val)\nmean_squared_error(y2_val, pred_val, squared=False)","32578e04":"test_df=pd.read_csv(\"..\/input\/beyond-analysis\/test.csv\")\ntest_df.head()","24bf3483":"test_df=test_df.groupby([\"UNIQUE_IDENTIFIER\"]).mean()","7d910ff5":"print(len(test_df))","06fd7c97":"for col in continuous_variables:\n    test_df[f\"t_{col}\"]=np.log(1+np.power(test_df[col],0.25))","62bfe95c":"test_df.head()","bfb63d94":"drop_cols_test=[\"SEQUENCE_NO\", \"PRACTICE_ENTRY\", \"PRACTICE_WINNINGS\", \"PRACTICE_ENTRY_NUMBER\", \"PRACTICE_WINNINGS_NUMBER\"]","111f538a":"test_df=test_df.drop(columns=continuous_variables+drop_cols_test,axis=1)","5d1f76c5":"test_df.head()","b64c6312":"X_test=test_df.values\ny1_pred=xgb1.predict(X_test)\ny2_pred=xgb2.predict(X_test)","49cdead7":"ids=list(test_df.index)","8a763d19":"sub=pd.DataFrame(columns=[\"UNIQUE_IDENTIFIER\",\"Y1\",\"Y2\"])\nsub[\"UNIQUE_IDENTIFIER\"]=ids\nsub[\"Y1\"]=np.clip(y1_pred,0,1e9)\nsub[\"Y2\"]=np.clip(y2_pred,0,1e9)\nsub.head()","a5e2efee":"sub.to_csv(\"xgb.csv\",index=None)","2d66017e":"cat2=CatBoostRegressor(depth=7, learning_rate=0.05)\ncat2.fit(X_train,y2_train,eval_set=(X_val,y2_val))\npred_val=cat2.predict(X_val)\nmean_squared_error(y2_val, pred_val, squared=False)","7f78aa9c":"cat1=CatBoostRegressor(depth=5, learning_rate=0.05)\ncat1.fit(X_train,y1_train,eval_set=(X_val,y1_val))\npred_val=cat1.predict(X_val)\nmean_squared_error(y1_val, pred_val, squared=False)","9b5abf0d":"X_test=test_df.values\ny1_pred=cat1.predict(X_test)\ny2_pred=cat2.predict(X_test)","463c2ee6":"ids=list(test_df.index)\nsub=pd.DataFrame(columns=[\"UNIQUE_IDENTIFIER\",\"Y1\",\"Y2\"])\nsub[\"UNIQUE_IDENTIFIER\"]=ids\nsub[\"Y1\"]=np.clip(y1_pred,0,1e9)\nsub[\"Y2\"]=np.clip(y2_pred,0,1e9)\nsub.head()","88265b51":"sub.to_csv(\"cat.csv\",index=None)","a260b48a":"lgbm2=LGBMRegressor()\nlgbm2.fit(X_train,y2_train,eval_set=(X_val,y2_val))\npred_val=lgbm2.predict(X_val)\nmean_squared_error(y2_val, pred_val, squared=False)","ad687bd6":"lgbm1=LGBMRegressor()\nlgbm1.fit(X_train,y1_train,eval_set=(X_val,y1_val))\npred_val=lgbm1.predict(X_val)\nmean_squared_error(y1_val, pred_val, squared=False)","4d02b02e":"# LGBM","af158355":"# CATBOOST","3dd85e77":"# XGBOOST"}}