{"cell_type":{"afbfbcec":"code","c5747b74":"code","d2be1bb0":"code","679bb0f6":"code","2cd993b3":"code","527fcf13":"code","f577968e":"code","38eb0f55":"code","64f8f12d":"code","a9642a5b":"code","25668ffc":"code","e4c96aad":"code","68a90535":"code","2bbec3b5":"code","3151001c":"code","19aca821":"code","7cdf9314":"code","ddca2586":"code","bb8c3290":"code","a35335e5":"code","3f189920":"code","e5cef15c":"code","d9c634ef":"code","42ad3b5b":"code","6cc6aa80":"code","602b94dd":"code","daecc6d8":"code","4a28b397":"code","4318e53c":"code","59b3d017":"code","8c1d10c5":"code","a2cfdd30":"code","07f08b57":"code","7c211f34":"code","5c12b36c":"code","d02cab5b":"code","67963ecc":"code","56a187fe":"code","182d648a":"code","c4ea54c1":"code","84aea9f0":"code","202af08d":"markdown","0930bd35":"markdown","d671ec51":"markdown","d76af078":"markdown","29062a33":"markdown","9ac7f229":"markdown","ec2f9a55":"markdown","71856e52":"markdown","7dca16e8":"markdown","2a7eba84":"markdown","15ccbd5e":"markdown","6064da10":"markdown","a5704b4d":"markdown","a760f875":"markdown","55b16da4":"markdown","0e8f9ea3":"markdown","efa5c5ed":"markdown","f4b00505":"markdown","c2aa89ec":"markdown","02a61fc2":"markdown"},"source":{"afbfbcec":"import numpy as np\nimport pandas as pd\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","c5747b74":"import pandas as pd \nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# to suppress warnings \nfrom warnings import filterwarnings\nfilterwarnings('ignore')\n\n# display all columns of the dataframe\npd.options.display.max_columns = None\n\n# display all rows of the dataframe\npd.options.display.max_rows = None\n \n# to display the float values upto 6 decimal places     \npd.options.display.float_format = '{:.6f}'.format\n\n# import train-test split \nfrom sklearn.model_selection import train_test_split\n\n# import StandardScaler to perform scaling\nfrom sklearn.preprocessing import StandardScaler \n\nplt.rcParams['figure.figsize'] = [15,8]\n\n# import various functions from sklearn\nfrom sklearn.metrics import classification_report\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn import tree\nfrom sklearn.model_selection import GridSearchCV","d2be1bb0":"train = pd.read_csv(\"..\/input\/food-demand-forecasting\/train.csv\")\ntest = pd.read_csv(\"..\/input\/food-demand-forecasting\/test.csv\")","679bb0f6":"train.head()","2cd993b3":"test.head()","527fcf13":"meal_info = pd.read_csv(\"..\/input\/food-demand-forecasting\/meal_info.csv\")\ncenter_info = pd.read_csv(\"..\/input\/food-demand-forecasting\/fulfilment_center_info.csv\")","f577968e":"train.shape","38eb0f55":"train.info()","64f8f12d":"test.info()","a9642a5b":"train.isnull().sum()","25668ffc":"test.isnull().sum()","e4c96aad":"train['num_orders'].describe()","68a90535":"trainfinal = pd.merge(train, meal_info, on=\"meal_id\", how=\"outer\")\ntrainfinal = pd.merge(trainfinal, center_info, on=\"center_id\", how=\"outer\")\ntrainfinal.head()","2bbec3b5":"trainfinal = trainfinal.drop(['center_id', 'meal_id'], axis=1)\ntrainfinal.head()","3151001c":"cols = trainfinal.columns.tolist()\nprint(cols)","19aca821":"trainfinal = trainfinal[cols]","7cdf9314":"from sklearn.preprocessing import LabelEncoder","ddca2586":"lb1 = LabelEncoder()\ntrainfinal['center_type'] = lb1.fit_transform(trainfinal['center_type'])\n\nlb2 = LabelEncoder()\ntrainfinal['category'] = lb1.fit_transform(trainfinal['category'])\n\nlb3 = LabelEncoder()\ntrainfinal['cuisine'] = lb1.fit_transform(trainfinal['cuisine'])","bb8c3290":"trainfinal.head()","a35335e5":"trainfinal.shape","3f189920":"trainfinal2 = trainfinal.drop(['id'], axis=1)\ncorrelation = trainfinal2.corr(method='pearson')\ncolumns = correlation.nlargest(8, 'num_orders').index\ncolumns","e5cef15c":"correlation_map = np.corrcoef(trainfinal2[columns].values.T)\nsns.set(font_scale=1.0)\nheatmap = sns.heatmap(correlation_map, cbar=True, annot=True, square=True, fmt='.2f', yticklabels=columns.values, xticklabels=columns.values)\nplt.show()","d9c634ef":"features = columns.drop(['num_orders'])\ntrainfinal3 = trainfinal[features]\nX = trainfinal3.values\ny = trainfinal['num_orders'].values\n\nfrom sklearn.model_selection import train_test_split\nX_train, X_val, y_train, y_val = train_test_split(X, y, test_size = 0.30)","42ad3b5b":"trainfinal3.head()","6cc6aa80":"from sklearn.linear_model import LinearRegression\nfrom sklearn.linear_model import Lasso\nfrom sklearn.linear_model import ElasticNet\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor","602b94dd":"from xgboost import XGBRegressor\nXG = XGBRegressor()\nXG.fit(X_train, y_train)\ny_pred = XG.predict(X_val) \ny_pred[y_pred<0] = 0 \nfrom sklearn import metrics \nprint('RMSLE:', 100*np.sqrt(metrics.mean_squared_log_error(y_val, y_pred)))","daecc6d8":"LR = LinearRegression()\nLR.fit(X_train, y_train) \ny_pred = LR.predict(X_val) \ny_pred[y_pred<0] = 0 \nfrom sklearn import metrics \nprint('RMSLE:', 100*np.sqrt(metrics.mean_squared_log_error(y_val, y_pred)))","4a28b397":"DT = DecisionTreeRegressor()\nDT.fit(X_train, y_train)\ny_pred = DT.predict(X_val)\ny_pred[y_pred<0] = 0\nfrom sklearn import metrics\nprint('RMSLE:', 100*np.sqrt(metrics.mean_squared_log_error(y_val, y_pred)))","4318e53c":"KNN = KNeighborsRegressor()\nKNN.fit(X_train, y_train)\ny_pred = KNN.predict(X_val)\ny_pred[y_pred<0] = 0\nfrom sklearn import metrics\nprint('RMSLE:', 100*np.sqrt(metrics.mean_squared_log_error(y_val, y_pred)))","59b3d017":"from sklearn import preprocessing\nfrom sklearn.model_selection import GridSearchCV, cross_val_score","8c1d10c5":"param_grid = { \"min_samples_split\": [2, 4, 8, 16], \"min_samples_leaf\": [1, 2, 3, 4], \"max_leaf_nodes\": [None, 10, 20, 100] }\ngrid_cv_dtm = GridSearchCV(DT, param_grid, cv=5)\ngrid_cv_dtm.fit(X_train, y_train)","a2cfdd30":"print(\"R-Squared::{}\".format(grid_cv_dtm.best_score_))\nprint(\"Best Hyperparameters::\\n{}\".format(grid_cv_dtm.best_params_))","07f08b57":"df = pd.DataFrame(data=grid_cv_dtm.cv_results_)\ndf.head()","7c211f34":"predicted = grid_cv_dtm.best_estimator_.predict(X)\nresiduals = y.flatten()-predicted\n\nfig, ax = plt.subplots()\nax.scatter(y.flatten(), residuals)\nax.axhline(lw=2,color='black')\nax.set_xlabel('Observed')\nax.set_ylabel('Residual')\nplt.show()","5c12b36c":"grid_cv_dtm.best_estimator_.fit(X_train, y_train)\ny_pred = grid_cv_dtm.best_estimator_.predict(X_val)\ny_pred[y_pred<0] = 0\nfrom sklearn import metrics\nprint('RMSLE:', 100*np.sqrt(metrics.mean_squared_log_error(y_val, y_pred)))","d02cab5b":"testfinal = pd.merge(test, meal_info, on=\"meal_id\", how=\"outer\")\ntestfinal = pd.merge(testfinal, center_info, on=\"center_id\", how=\"outer\")\ntestfinal = testfinal.drop(['meal_id', 'center_id'], axis=1)\ntestcols = testfinal.columns.tolist()\nprint(testcols)","67963ecc":"lb1 = LabelEncoder()\ntestfinal['center_type'] = lb1.fit_transform(testfinal['center_type'])\n\nlb2 = LabelEncoder()\ntestfinal['category'] = lb1.fit_transform(testfinal['category'])\n\nlb3 = LabelEncoder()\ntestfinal['cuisine'] = lb1.fit_transform(testfinal['cuisine'])\n\ntestfinal.head()","56a187fe":"X_test = testfinal[features].values\nX_test","182d648a":"pred = DT.predict(X_test)\npred[pred<0] = 0\nsubmission = pd.DataFrame({\n    'id' : testfinal['id'],\n    'num_orders' : pred})","c4ea54c1":"submission.to_csv(\"submission.csv\", index=False)","84aea9f0":"submission.head()","202af08d":"## Hyperparameter Tuning on Decision Tree Regressor Model","0930bd35":"**Data Dictionary**\n \n\n**Weekly Demand data (train.csv): Contains the historical demand data for all centers, test.csv contains all the following features except the target variable.**\n\nVariable               Definition\n\nid                     Unique ID\n\nweek                    Week No\n\ncenter_id               Unique ID for fulfillment center\n\nmeal_id                 Unique ID for Meal\n\ncheckout_price          Final price including discount, taxes & delivery charges\n\nbase_price              Base price of the meal\n\nemailer_for_promotion   Emailer sent for promotion of meal\n\nhomepage_featured       Meal featured at homepage\n\nnum_orders              (Target) Orders Count\n   \n\n**fulfilment_center_info.csv: Contains information for each fulfilment center**\n \n\nVariable                 Definition\n\ncenter_id                Unique ID for fulfillment center\n\ncity_code                Unique code for city\n\nregion_code              Unique code for region\n\ncenter_type              Anonymized center type\n\nop_area                  Area of operation (in km^2)\n \n\n**meal_info.csv: Contains information for each meal being served**\n \n\nVariable          Definition\n\nmeal_id           Unique ID for the meal\n\ncategory          Type of meal (beverages\/snacks\/soups\u2026.)\n\ncuisine           Meal cuisine (Indian\/Italian\/\u2026)\n \n\n**Evaluation Metric**\n\nThe evaluation metric for this competition is 100*RMSLE where RMSLE is Root of Mean Squared Logarithmic Error across all entries in the test set.","d671ec51":"**Splitting the dataset into 30% test and 70% train.**","d76af078":"**Let us now see the number of variables and observations in the train data.**","29062a33":"Obtaining 8 features which are having high correlation  with respect to the target.","9ac7f229":"## K Neighbors Classifier","ec2f9a55":"**Checking Null values**","71856e52":"**The RMSLE did not change before tuning and after tuning.**","7dca16e8":"**Merging dataframes**","2a7eba84":"## Linear Regression","15ccbd5e":"**(456548,13) is the shape of the final train dataset.**","6064da10":"**Label Encoding required features**","a5704b4d":"*The data has 456548 observations and 9 variables.*","a760f875":"## XGBoost Regressor Model","55b16da4":"**Checking correlation**","0e8f9ea3":"## Decision Tree Regressor","efa5c5ed":"**Importing libraries for model building**","f4b00505":"**Importing necessary libraries**","c2aa89ec":"**Importing the datasets**","02a61fc2":"**PROBLEM STATEMENT**\n\nYour client is a meal delivery company which operates in multiple cities. They have various fulfillment centers in these cities for dispatching meal orders to their customers. The client wants you to help these centers with demand forecasting for upcoming weeks so that these centers will plan the stock of raw materials accordingly.\n\nThe replenishment of majority of raw materials is done on weekly basis and since the raw material is perishable, the procurement planning is of utmost importance. Secondly, staffing of the centers is also one area wherein accurate demand forecasts are really helpful. Given the following information, the task is to predict the demand for the next 10 weeks (Weeks: 146-155) for the center-meal combinations in the test set:  \n\nHistorical data of demand for a product-center combination (Weeks: 1 to 145)\nProduct(Meal) features such as category, sub-category, current price and discount\nInformation for fulfillment center like center area, city information etc."}}