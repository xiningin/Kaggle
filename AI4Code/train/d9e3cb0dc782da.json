{"cell_type":{"f0bbd85f":"code","655eafe6":"code","9f548697":"code","96de0921":"code","62fdc47d":"code","6156f58b":"code","17fd44f8":"code","4b7d39a1":"code","22943b34":"code","085f9630":"code","17a3c700":"code","6443254c":"code","5603e42c":"code","dda7bce9":"code","2cf64a1c":"code","967bf355":"markdown","d1b394d6":"markdown","9de127ad":"markdown","f4e810a1":"markdown","58067cb8":"markdown","8d5ecbe9":"markdown","b344285a":"markdown","ecfc165f":"markdown","69841894":"markdown","245176ea":"markdown","0c1e9246":"markdown"},"source":{"f0bbd85f":"! conda install -c conda-forge gdcm -y","655eafe6":"import pandas as pd, numpy as np, os, glob\nimport pydicom\nimport cv2\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom pydicom.pixel_data_handlers.util import apply_voi_lut","9f548697":"base_dir = \"..\/input\/rsna-miccai-brain-tumor-radiogenomic-classification\/\"\ntrain_df = pd.read_csv(\"..\/input\/rsna-miccai-brain-tumor-radiogenomic-classification\/train_labels.csv\")\ntrain_df","96de0921":"train_df.shape","62fdc47d":"print ('Train , test total cases \/ patient ids ')\nlen(sorted(os.listdir(base_dir + 'train\/'))), len(sorted(os.listdir(base_dir + 'test\/'))) ","6156f58b":"train_dcm_list = sorted(glob.glob(base_dir + 'train\/*\/*\/*.dcm'))\ntest_dcm_list = sorted(glob.glob(base_dir + 'test\/*\/*\/*.dcm'))\nsequencing = [ 'FLAIR','T1w','T1wCE','T2w' ]","17fd44f8":"print (f'Total dcm files provided : {len(train_dcm_list)}')\nprint (f'Total dcm files provided : {len(test_dcm_list)}')","4b7d39a1":"print (train_dcm_list[0].split('\/'))","22943b34":"test_ids = []\ntest_paths = sorted(glob.glob(base_dir + 'test\/*'))\ntest_ids = [x.split('\/')[-1] for x in test_paths ]\n","085f9630":"def load_dicom(path):\n    dicom = pydicom.read_file(path)\n    data = dicom.pixel_array\n    data = data - np.min(data)\n    data = data \/ np.max(data)\n    data = (data * 255).astype(np.uint8)\n    return data","17a3c700":"# sample image for sequencing 'FLAIR' train image '01000'\nBraTS21ID = '1000'\nimgs = [x for x in train_dcm_list if (x.split('\/')[-4] == 'train' and x.split('\/')[-3] == BraTS21ID.zfill(5)  and x.split('\/')[-2] == sequencing[0])]\ndata = load_dicom(imgs[int(len(imgs)-1)])\nplt.imshow(data, cmap=\"pink\")\n#plt.title( fontsize=16)\nplt.axis(\"off\")","6443254c":"def display_images(BraTS21ID, voi_lut=True, fix_monochrome=True, train_test = 'train'):\n    dicom_paths = base_dir +'\/'+ train_test +'\/'+ str(BraTS21ID).zfill(5) +'\/'\n    plt.figure(figsize=(16, 5))\n    for i, seq in enumerate(sequencing):\n        if train_test == 'train':\n            imgs = [x for x in train_dcm_list if (x.split('\/')[-4] == train_test and x.split('\/')[-3] == str(BraTS21ID).zfill(5)  and x.split('\/')[-2] == seq)]\n        else:\n            imgs = [x for x in test_dcm_list if (x.split('\/')[-4] == train_test and x.split('\/')[-3] == str(BraTS21ID)  and x.split('\/')[-2] == seq)]\n\n        data = load_dicom(imgs[int(len(imgs)-1)])\n        plt.subplot(1, 4, i+1)\n        np.seterr(divide='ignore', invalid='ignore')\n        plt.imshow(data, cmap = 'gist_earth')\n        if train_test == 'train':\n            label = train_df.loc[train_df.BraTS21ID == BraTS21ID,'MGMT_value'].values[0]\n        \n        plt.title(f\"(MRI Seq) :({seq} )\", fontsize=14)\n        plt.axis(\"off\")\n    if train_test == 'train': plt.suptitle(f\"MGMT_value: {label}\", fontsize=16)\n    plt.show()","5603e42c":"for idx, row in train_df.iterrows():\n    if idx == 10:  break\n    \n    display_images(row.BraTS21ID,voi_lut=True, fix_monochrome=True,train_test = 'train' )","dda7bce9":"for idx in range(10):\n    \n    display_images(test_ids[idx],voi_lut=True, fix_monochrome=True,train_test = 'test' )","2cf64a1c":"# sample image for sequencing 'FLAIR' for test image '00013'\nBraTS21ID = '00013'\n\nimgs = [x for x in test_dcm_list if (x.split('\/')[-4] == 'test' and x.split('\/')[-3] == BraTS21ID  and x.split('\/')[-2] == sequencing[0])]\ndata = load_dicom(imgs[int(len(imgs)-1)])\nprint (np.max(data))\nnp.seterr(divide='ignore', invalid='ignore')\nplt.imshow(data, cmap=\"Oranges\")\n#plt.title( fontsize=16)\nplt.axis(\"off\")","967bf355":"# Visualize Few Test images ....","d1b394d6":"# PHYSICS OF MRI\n\n* MRI is based on the magnetization properties of atomic nuclei. A powerful, uniform, external magnetic field is employed to align the protons that are normally randomly oriented within the water nuclei of the tissue being examined. \n* This alignment (or magnetization) is next perturbed or disrupted by introduction of an external Radio Frequency (RF) energy. The nuclei return to their resting alignment through various relaxation processes and in so doing emit RF energy. \n* After a certain period following the initial RF, the emitted signals are measured. Fourier transformation is used to convert the frequency information contained in the signal from each location in the imaged plane to corresponding intensity levels, which are then displayed as shades of gray in a matrix arrangement of pixels. \n* By varying the sequence of RF pulses applied & collected, different types of images are created. **Repetition Time (TR) is the amount of time between successive pulse sequences applied to the same slice**. \n* **Time to Echo (TE) is the time between the delivery of the RF pulse and the receipt of the echo signal**.\n\n* Tissue can be characterized by two different relaxation times \u2013 T1 and T2. \n1. **T1 (longitudinal relaxation time)** is the time constant which determines the rate at which excited protons return to equilibrium. It is a measure of the time taken for spinning protons to realign with the external magnetic field. \n1. **T2 (transverse relaxation time)** is the time constant which determines the rate at which excited protons reach equilibrium or go out of phase with each other. It is a measure of the time taken for spinning protons to lose phase coherence among the nuclei spinning perpendicular to the main field.","9de127ad":"https:\/\/case.edu\/med\/neurology\/NR\/MRI%20Basics.htm","f4e810a1":"[From competition overview](https:\/\/www.kaggle.com\/c\/rsna-miccai-brain-tumor-radiogenomic-classification\/overview)\n1. A malignant tumor in the brain is a life-threatening condition. Known as glioblastoma, it's both the most common form of brain cancer in adults and the one with the worst prognosis, with median survival being less than a year. The presence of a specific genetic sequence in the tumor known as MGMT promoter methylation has been shown to be a favorable prognostic factor and a strong predictor of responsiveness to chemotherapy.\n1. Currently, genetic analysis of cancer requires surgery to extract a tissue sample. Then it can take several weeks to determine the genetic characterization of the tumor. Depending upon the results and type of initial therapy chosen, a subsequent surgery may be necessary. If an accurate method to predict the genetics of the cancer through imaging (i.e., radiogenomics) alone could be developed, this would potentially minimize the number of surgeries and refine the type of therapy required.\n1. The **Radiological Society of North America (RSNA)** has teamed up with the **Medical Image Computing and Computer Assisted Intervention Society (the MICCAI Society)** to improve diagnosis and treatment planning for patients with glioblastoma. ","58067cb8":"***In this competition you will predict the genetic subtype of glioblastoma using MRI (magnetic resonance imaging) scans to train and test your model to detect for the presence of MGMT promoter methylation.***","8d5ecbe9":"# MRI IMAGING SEQUENCES\n\nThe most common MRI sequences are **T1-weighted and T2-weighted** scans. \n1. T1-weighted images are produced by using short TE and TR times. The contrast and brightness of the image are predominately determined by T1 properties of tissue. Conversely, \n2. T2-weighted images are produced by using longer TE and TR times. In these images, the contrast and brightness are predominately determined by the T2 properties of tissue.\n\nIn general, T1- and T2-weighted images can be easily differentiated by looking the CSF. ***CSF is dark on T1-weighted imaging and bright on T2-weighted imaging.***\n\n3. A third commonly used sequence is the **Fluid Attenuated Inversion Recovery (Flair)**. *The Flair sequence is similar to a T2-weighted image except that the TE and TR times are very long. By doing so, abnormalities remain bright but normal CSF fluid is attenuated and made dark. This sequence is very sensitive to pathology and makes the differentiation between CSF and an abnormality much easier.*\n\n\n\n![image.png](attachment:61f018df-5a5f-468e-a547-736373a99c16.png)","b344285a":"# Many images in both train and test set are empty, [Refer Discussion thread 1](https:\/\/www.kaggle.com\/c\/rsna-miccai-brain-tumor-radiogenomic-classification\/discussion\/252884) and [Refer Discussion thread 2](https:\/\/www.kaggle.com\/c\/rsna-miccai-brain-tumor-radiogenomic-classification\/discussion\/252968)","ecfc165f":"# Visualize few train images ....","69841894":"Each independent case has a dedicated folder identified by a five-digit number. Within each of these \u201ccase\u201d folders, there are four sub-folders, each of them corresponding to each of the structural multi-parametric MRI (mpMRI) scans, in DICOM format. The exact mpMRI scans included are:\n\n* Fluid Attenuated Inversion Recovery (FLAIR)\n* T1-weighted pre-contrast (T1w)\n* T1-weighted post-contrast (T1Gd)\n* T2-weighted (T2)","245176ea":"![image.png](attachment:1318c284-5579-42ba-98c4-03e521d9c887.png)","0c1e9246":"# RSNA-MICCAI Brain Tumor Radiogenomic Classification\n# Predict the status of a genetic biomarker important for brain cancer treatment"}}