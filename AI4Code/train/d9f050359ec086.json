{"cell_type":{"a5781639":"code","2e436c0f":"code","5c4d78b0":"code","0b667c88":"code","90b9ccb4":"code","dd3aa41c":"code","201606c6":"code","eb56d027":"code","5ee31f1c":"code","f80fc5ec":"code","c7ddf824":"code","d2b75475":"code","bd2de4e8":"code","288ee5cc":"code","f4712db8":"code","a50d3cf5":"code","53f3c433":"code","744f9a20":"code","dfd27ac5":"code","5934c67f":"code","8391dd5e":"code","96195027":"code","03228c35":"code","59717c00":"code","9f20fbc2":"code","378e993f":"markdown","2db0d596":"markdown","797ba03e":"markdown","5b9c3df3":"markdown","a356b78c":"markdown","8b7e1a2a":"markdown","f527a3e3":"markdown","0199272b":"markdown","d04488e1":"markdown","2b5efdb5":"markdown","eed1d1c0":"markdown","32426697":"markdown"},"source":{"a5781639":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport cv2 # import cv2","2e436c0f":"import os\nprint(os.listdir(\"..\/input\"))","5c4d78b0":"DIR = os.listdir('..\/input\/chest-xray-pneumonia\/chest_xray')\nprint(DIR)","0b667c88":"train_folder = '..\/input\/chest-xray-pneumonia\/chest_xray\/train'\ntest_folder = '..\/input\/chest-xray-pneumonia\/chest_xray\/test'\nval_folder = '..\/input\/chest-xray-pneumonia\/chest_xray\/val'","90b9ccb4":"import matplotlib.pyplot as plt\nimport seaborn as sns\nfrom PIL import Image\nimport random","dd3aa41c":"labels = [\"NORMAL\", \"PNEUMONIA\"] # each folder has two sub folder name \"PNEUMONIA\", \"NORMAL\"\nIMG_SIZE = 50 # resize image\n\ndef get_data_train(data_dir):\n    data = []\n    for label in labels:\n        path = os.path.join(data_dir, label)\n        class_num = labels.index(label)\n        for img in os.listdir(path):\n            try:\n                img_array = cv2.imread(os.path.join(path, img), cv2.IMREAD_GRAYSCALE)\n                new_array = cv2.resize(img_array, (IMG_SIZE, IMG_SIZE))\n                data.append([new_array, class_num])\n            except Exception as e:\n                print(e)\n    return np.array(data)","201606c6":"train = get_data_train(train_folder)\ntest = get_data_train(test_folder)\nval = get_data_train(val_folder)","eb56d027":"l = []\nfor i in train:\n    if(i[1] == 0):\n        l.append(\"Normal\")\n    else:\n        l.append(\"Pneumonia\")\n        \nsns.countplot(l)","5ee31f1c":"X_train = []\ny_train = []\n\nX_val = []\ny_val = []\n\nX_test = []\ny_test = []\n\nfor feature, label in train:\n    X_train.append(feature)\n    y_train.append(label)\n\nfor feature, label in test:\n    X_test.append(feature)\n    y_test.append(label)\n    \nfor feature, label in val:\n    X_val.append(feature)\n    y_val.append(label)","f80fc5ec":"X_train = np.array(X_train) \/ 255\nX_val = np.array(X_val) \/ 255\nX_test = np.array(X_test) \/ 255","c7ddf824":"X_test.shape","d2b75475":"X_train = X_train.reshape(-1, IMG_SIZE, IMG_SIZE, 1)\ny_train = np.array(y_train)\n\nX_val = X_val.reshape(-1, IMG_SIZE, IMG_SIZE, 1)\ny_val = np.array(y_val)\n\nX_test = X_test.reshape(-1, IMG_SIZE, IMG_SIZE, 1)\ny_test = np.array(y_test)","bd2de4e8":"import tensorflow as tf\nfrom tensorflow.keras.layers import Flatten, Conv2D, Activation, Dense, Dropout, MaxPooling2D\nfrom tensorflow.keras.models import Sequential","288ee5cc":"model = Sequential()\n\nmodel.add(Conv2D(32, (3, 3), padding=\"same\", input_shape=X_train.shape[1:]))\nmodel.add(Activation(\"relu\"))\nmodel.add(MaxPooling2D(2, 2))\nmodel.add(Dropout(0.2))\n\nmodel.add(Conv2D(64, (3, 3), padding=\"same\"))\nmodel.add(Activation(\"relu\"))\nmodel.add(MaxPooling2D(2, 2))\nmodel.add(Dropout(0.2))\n\nmodel.add(Conv2D(128, (3, 3), padding=\"same\"))\nmodel.add(Activation(\"relu\"))\nmodel.add(MaxPooling2D(2, 2))\nmodel.add(Dropout(0.2))\n\nmodel.add(Flatten())\nmodel.add(Dense(128, activation=\"relu\"))\n\nmodel.add(Dense(1))\nmodel.add(Activation(\"sigmoid\"))\n\nmodel.compile(loss=\"binary_crossentropy\", optimizer=\"adam\", metrics=[\"accuracy\"])\nhistory = model.fit(X_train, y_train, epochs=25, validation_data=(X_val, y_val), shuffle=True)\nscores = model.evaluate(X_test, y_test)\n\nmodel.save(\"cnn.model\")","f4712db8":"# scores\nprint(\"Test loss {}\".format(scores[0]))\nprint(\"Test accuracy {}\".format(scores[1]))","a50d3cf5":"# visualization\n\nimport matplotlib.pyplot as plt\naccuracy = history.history['accuracy']\nval_accuracy = history.history['val_accuracy']\nloss = history.history['loss']\nval_loss = history.history['val_loss']\nepochs = range(len(accuracy))\n\nplt.plot(epochs, accuracy, \"b\", label=\"trainning accuracy\")\nplt.plot(epochs, val_accuracy, \"r\", label=\"validation accuracy\")\nplt.legend()\nplt.show()\n\nplt.plot(epochs, loss, \"b\", label=\"trainning loss\")\nplt.plot(epochs, val_loss, \"r\", label=\"validation loss\")\nplt.legend()\nplt.show()","53f3c433":"# predict classes\n\nprediction = model.predict_classes(X_test)\nprediction = prediction.reshape(1, -1)[0]\nprediction[:15]","744f9a20":"# correct and incorrect\n# you can check tensorflow website\n\ncorrect = np.nonzero(prediction == y_test)[0]\nincorrect = np.nonzero(prediction != y_test)[0]","dfd27ac5":"j = 0\nfor i in correct[:6]:\n    plt.subplot(3,2,j+1)\n    plt.xticks([])\n    plt.yticks([])\n    plt.imshow(X_test[i].reshape(50,50), cmap=\"gray\", interpolation='none')\n    plt.title(\"Predicted Class {},Actual Class {}\".format(prediction[i], y_test[i]))\n    plt.xlabel(labels[prediction[i]])\n    plt.tight_layout()\n    j += 1","5934c67f":"j = 0\nfor i in incorrect[:6]:\n    plt.subplot(3,2,j+1)\n    plt.xticks([])\n    plt.yticks([])\n    plt.imshow(X_test[i].reshape(50,50), cmap=\"gray\", interpolation='none')\n    plt.title(\"Predicted Class {},Actual Class {}\".format(prediction[i], y_test[i]))\n    plt.xlabel(labels[prediction[i]])\n    plt.tight_layout()\n    j += 1","8391dd5e":"# load model and predict some some external photo\n\nlabels = [\"NORMAL\", \"PNEUMONIA\"]\ndef prepare(filepath):\n    img_array = cv2.imread(filepath, cv2.IMREAD_GRAYSCALE)\n    new_array = cv2.resize(img_array, (IMG_SIZE, IMG_SIZE))\n    return new_array.reshape(-1, IMG_SIZE, IMG_SIZE, 1)\n\nmodel = tf.keras.models.load_model(\"cnn.model\") # load model","96195027":"# extra pneumonia photo from google\nprediction = model.predict([prepare(\"..\/input\/images\/left-lower-lobe-pneumonia.jpg\")])\nprint(labels[int(prediction[0])])","03228c35":"# extra normal x-ray photo from google\nprediction = model.predict([prepare(\"..\/input\/images\/normal.jpeg\")])\nprint(labels[int(prediction[0])])","59717c00":"prediction = model.predict([prepare(\"..\/input\/chest-xray-pneumonia\/chest_xray\/test\/PNEUMONIA\/person100_bacteria_475.jpeg\")])\nprint(labels[int(prediction[0])])","9f20fbc2":"prediction = model.predict([prepare(\"..\/input\/chest-xray-pneumonia\/chest_xray\/test\/PNEUMONIA\/person101_bacteria_486.jpeg\")])\nprint(labels[int(prediction[0])])","378e993f":"# If you like please upvote","2db0d596":"# PNEUMONIA\n\n**Pneumonia is an infection in one or both lungs. Bacteria, viruses, and fungi cause it.\nThe infection causes inflammation in the air sacs in your lungs, which are called alveoli. The alveoli fill with fluid or pus, making it difficult to breathe.**\n\n#  Is pneumonia contagious?\n\n**The germs that cause pneumonia are contagious. This means they can spread from person to person.\nBoth viral and bacterial pneumonia can spread to others through inhalation of airborne droplets from a sneeze or cough. You can also get these types of pneumonia by coming into contact with surfaces or objects that are contaminated with pneumonia-causing bacteria or viruses.\nYou can contract fungal pneumonia from the environment. However, it doesn\u2019t spread from person to person.** \n\n# Symptoms of pneumonia\n\n**Pneumonia symptoms can be mild to life-threatening. They can include:**\n\n*     coughing that may produce phlegm (mucus)\n*     fever\n*     sweating or chills\n*     shortness of breath that happens while doing normal activities or even while resting\n*     chest pain that\u2019s worse when you breathe or cough\n*     feelings of tiredness or fatigue\n*     loss of appetite\n*     nausea or vomiting\n*     headaches\n\n**Other symptoms can vary according to your age and general health:**\n\n*     Children under 5 years old may have fast breathing or wheezing.\n*     Infants may appear to have no symptoms, but sometimes they may vomit, lack energy, or have trouble drinking or eating.\n*     Older people may have milder symptoms. They can also exhibit confusion or a lower than normal body temperature.\n\n# There are several types of infectious agents that can cause pneumonia. \n\n# Bacterial pneumonia\n\n**The most common cause of bacterial pneumonia is Streptococcus pneumoniae. Other causes include:**\n\n*     Mycoplasma pneumoniae\n*     Haemophilus influenzae\n*     Legionella pneumophila\n\n# Viral pneumonia\n\n**Respiratory viruses are often the cause of pneumonia. Some examples include:**\n\n*     influenza (flu)\n*     respiratory syncytial virus (RSV)\n*     rhinoviruses (common cold)\n\n# Fungal pneumonia\n\n**Fungi from soil or bird droppings can cause pneumonia. They most often cause pneumonia in people with weakened immune systems. Examples of fungi that can cause pneumonia include:**\n\n*     Pneumocystis jirovecii\n*     Cryptococcus species\n*     Histoplasmosis species","797ba03e":"# reshape train, test and validation","5b9c3df3":"# Noramalization","a356b78c":"## Input data files are available in the \"..\/input\/\" directory.\n## For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n","8b7e1a2a":"# If you like, please upvote","f527a3e3":"# Training the Model","0199272b":"## import visualization package","d04488e1":"# Some inccorect visualization","2b5efdb5":"# Visualize some correct","eed1d1c0":"## train, test, validation folder","32426697":"# Load important packages"}}