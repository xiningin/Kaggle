{"cell_type":{"e8bd9dea":"code","a35e605c":"code","89db13db":"code","a03d17ef":"code","c576c9e6":"code","d05595d7":"code","6139f8b8":"code","2ece9875":"code","25aa8d9f":"code","2b512fc6":"code","b90e49f3":"code","efa9f830":"code","387c85c8":"code","fd870c79":"code","c27cade1":"code","4550029c":"code","e6fdd63d":"code","adcb0d6c":"code","57981e71":"code","2e8e9b69":"code","c705a0e0":"code","d5abbe23":"code","7f41eaa8":"code","bb399834":"code","ddb4a4f0":"code","b40b432c":"code","b11f34c9":"code","ae585c35":"code","09790de5":"code","a3308e28":"code","101e7977":"code","35198e95":"code","7c38119d":"code","d99bfc26":"code","0a3cd454":"markdown","1dacb8d0":"markdown","af745239":"markdown","da57dc9f":"markdown","92a4c3b6":"markdown","a66cb02a":"markdown","9dbbc9cb":"markdown","712e3644":"markdown","608ed7ff":"markdown","0400cf07":"markdown","16b15a1b":"markdown","ac1fabc0":"markdown","8eaffc2a":"markdown","bcb8702d":"markdown","625dc83d":"markdown","598ce375":"markdown","c7836365":"markdown","2b607e88":"markdown","6c44d7ee":"markdown","2c03ab29":"markdown","1995cb8c":"markdown","76feb646":"markdown","1251e081":"markdown"},"source":{"e8bd9dea":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","a35e605c":"#This data is a time series of advance retail sales: Clothing and clothing accessory stores\ncloth = pd.read_csv(\"\/kaggle\/input\/advance-retail-sales-time-series-collection\/RSCCASN.csv\",parse_dates=[\"date\"],index_col=\"date\")\ncloth = cloth.drop([\"realtime_start\",\"realtime_end\"],axis=1)\ncloth.head()","89db13db":"cloth.tail()","a03d17ef":"import matplotlib.pyplot as plt\ncloth.plot()\nplt.show()","c576c9e6":"#Checking the stationarity - Augmented Dickey-Fuller Test(ADF Test)\n\nfrom statsmodels.tsa.stattools import adfuller\n\nadf_stat = adfuller(cloth['value'])\nprint(adf_stat)","d05595d7":"cloth[\"2013\":\"2014\"].plot()\nplt.show()","6139f8b8":"#Removing stationarity\ncloth_yoy = cloth.pct_change(12).dropna()\ncloth_yoy.head(5)","2ece9875":"cloth_yoy.plot()","25aa8d9f":"print(adfuller(cloth_yoy['value']))","2b512fc6":"cloth_yoy2 = cloth_yoy.diff().dropna()\ncloth_yoy2.plot()","b90e49f3":"print(adfuller(cloth_yoy2['value']))","efa9f830":"#Set the frequency to Days\ncloth_yoy2 = cloth_yoy2.asfreq(\"MS\")","387c85c8":"#Splitting into train and test\ntrain = cloth_yoy2.loc[:\"2016\"]\ntest = cloth_yoy2.loc[\"2017\":]\ntest.head()","fd870c79":"#Fitting a simple AR model\nfrom statsmodels.tsa.statespace.sarimax import SARIMAX\nmodel10 = SARIMAX(train,order=(1,0,1),trend=\"c\")\nresults = model10.fit()\nprint(results.summary())","c27cade1":"#One step ahead Forecasting\nforecast = results.get_prediction(start=-24)\nmean_forecast = forecast.predicted_mean\nconf_int = forecast.conf_int()\nfig,ax = plt.subplots(figsize=(18,6))\ntrain.plot(ax=ax,label=\"observed\")\nmean_forecast.plot(ax=ax,color=\"r\",label=\"predicted\")\nax.fill_between(conf_int.index,conf_int[\"lower value\"],conf_int[\"upper value\"],color=\"pink\")\nax.legend()\nfig.show()","4550029c":"#Dynamic Forecasting in the past\nforecast = results.get_prediction(start=-24,dynamic=True)\nmean_forecast = forecast.predicted_mean\nconf_int = forecast.conf_int()\nfig,ax = plt.subplots(figsize=(18,6))\ntrain.plot(ax=ax,label=\"observed\")\nmean_forecast.plot(ax=ax,color=\"r\",label=\"predicted\")\nax.fill_between(conf_int.index,conf_int[\"lower value\"],conf_int[\"upper value\"],color=\"pink\")\nax.legend()\nfig.show()","e6fdd63d":"#Dynamic Forecasting into the future\nforecast = results.get_forecast(steps=36)\nmean_forecast = forecast.predicted_mean\nconf_int = forecast.conf_int()\nfig,ax = plt.subplots(figsize=(18,6))\ntrain.plot(ax=ax,label=\"observed\")\nmean_forecast.plot(ax=ax,color=\"r\",label=\"predicted\")\nax.fill_between(conf_int.index,conf_int[\"lower value\"],conf_int[\"upper value\"],color=\"pink\")\nax.legend()\nfig.show()","adcb0d6c":"#ARMAX model\ntrainx = train.copy()\ntrainx[\"month\"] = trainx.index.month\ntrainx.head()","57981e71":"modelx = SARIMAX(trainx[\"value\"],order=(1,0,1),exog=trainx[\"month\"])\nresultsx = modelx.fit()\nprint(resultsx.summary())","2e8e9b69":"from statsmodels.graphics.tsaplots import plot_acf,plot_pacf\nfig, ax = plt.subplots(2,1,figsize=(18,10))\nplot_acf(cloth_yoy2,lags=10,zero=False,ax=ax[0])\nplot_pacf(cloth_yoy2,lags=10,zero=False,ax=ax[1])","c705a0e0":"aic_dict = {}\nfor p in range(0,4):\n    for q in range(0,4):\n        model = SARIMAX(train,order=(p,0,q),trend=\"c\")\n        res = model.fit(maxiter=500)\n        print(p,q,res.aic,res.bic)","d5abbe23":"#ARMA(2,3) process\n\nmod23 = SARIMAX(train,order=(2,0,3),trend=\"c\")\nres23 = mod23.fit(maxiter=500)\n\nforecast = res23.get_forecast(steps=36)\nmean_forecast = forecast.predicted_mean\nconf_int = forecast.conf_int()\nfig,ax = plt.subplots(figsize=(18,6))\ntrain.plot(ax=ax,label=\"observed\",color=\"blue\")\ntest.plot(ax=ax,color=\"blue\")\nmean_forecast.plot(ax=ax,color=\"r\",label=\"predicted\")\nax.fill_between(conf_int.index,conf_int[\"lower value\"],conf_int[\"upper value\"],color=\"pink\")\nax.legend()\nfig.show()","7f41eaa8":"print(\"Mean absolute error: {}\".format(np.mean(np.abs(res23.resid))))","bb399834":"res.plot_diagnostics(figsize=(15,8))\nplt.show()","ddb4a4f0":"print(res.summary())","b40b432c":"#Seasonal decomposition\nfrom statsmodels.tsa.seasonal import seasonal_decompose\ndecomp = seasonal_decompose(cloth[\"value\"],period=12)\ndecomp.plot()\nplt.show()","b11f34c9":"#Seasonal differencing and normal differencing\ncloth_diff = cloth.diff(1).diff(12).dropna()\ncloth_diff.plot()\nplt.show()","ae585c35":"#Seasonal ACF and PACF\nlags = [12, 24, 36, 48, 60]\nfig, (ax1, ax2) = plt.subplots(2,1,figsize=(18,8))\nplot_acf(cloth_diff,lags=lags,zero=False,ax=ax1)\nplot_pacf(cloth_diff,lags=lags,zero=False,ax=ax2)","09790de5":"#SARIMAX\ntrain_full = cloth.loc[:\"2016\"]\ntest_full = cloth.loc[\"2017\":]\n\nsarima_mod = SARIMAX(train_full,order=(2,1,3),seasonal_order=(0,1,0,12))\nsarima_res = sarima_mod.fit(maxiter=500)\nprint(sarima_res.summary())","a3308e28":"import pmdarima as pm\nresults = pm.auto_arima(cloth,maxiter=500,seasonal=True,m=12,information_criterion=\"aic\",trace=True,error_action=\"ignore\")\nprint(results.summary())","101e7977":"results.plot_diagnostics()","35198e95":"sarima_mod = SARIMAX(train_full,order=(1,0,2),seasonal_order=(2,1,2,12))\nsarima_res = sarima_mod.fit(maxiter=500)\nprint(sarima_res.summary())","7c38119d":"forecast = sarima_res.get_forecast(steps=60)\nmean_forecast = forecast.predicted_mean\nconf_int = forecast.conf_int()\nfig,ax = plt.subplots(figsize=(18,6))\ntrain_full.plot(ax=ax,label=\"observed\",color=\"blue\")\ntest_full.plot(ax=ax,color=\"blue\")\nmean_forecast.plot(ax=ax,color=\"r\",label=\"predicted\")\nax.fill_between(conf_int.index,conf_int[\"lower value\"],conf_int[\"upper value\"],color=\"pink\")\nax.legend()\nfig.show()","d99bfc26":"print(mean_forecast.iloc[-1])\nprint(conf_int.iloc[-1])","0a3cd454":"From the above AIC values, we can see that ARMA(2,3) ia the best fit","1dacb8d0":"# Choosing the best model","af745239":"We can see from above graph that the prediction is lot better than AR(1) modelled previously","da57dc9f":"We can see from the above plots that the model is good except some outliers","92a4c3b6":"We can see that AR1 coefficient is significant and the bias term or intercept is not at all significant","a66cb02a":"We can see from seasonal ACF anf PACF plots that there is no seasonal orders significant","9dbbc9cb":"We have to remove the stationarity. We can see from the plot that data is seasonal every year and also increasing with time. One easy way to take care of both problems is calculating percent change YoY","712e3644":"# Simple ARMA and ARMAX models","608ed7ff":"The plot looks even more stationary. The p-value is close to 0 now and we can proceed with this data to build ARMA models","0400cf07":"The p-value is down to 0.02 after transforming the data. Let's try differenencing on these values to check the p-value","16b15a1b":"We can see from the above plot that the data looks more stationary. Let's do a ADF test to confirm the stationarity","ac1fabc0":"# Seasonal Time Series Analysis\n\nWe can use the original dataset instead of the YoY change data","8eaffc2a":"Model forecasts that sales will be ~37 Billion USD in December 2021","bcb8702d":"First element of the tuple is the test statistic which is -0.844. The more negative it is, more stationary the data is.\n\nSecond element of the tuple is p-value of the test-statistic which is 0.8. Since it is very high, we cannot reject the null hypothesis (non-stationary)\n\nFifth element is a dictionary. To get a p-value of 0.01 we need a test statistic of -3.45","625dc83d":"We can see that data is present from January 1992 to October 2019. Also the value is in million dollars of retail sales","598ce375":"# Diagnostics","c7836365":"From the above plots we can see that both ACF and PACF tails off constantly","2b607e88":"# Data Preprocessing","6c44d7ee":"As expected, the month variable turned out to be insignificant","2c03ab29":"# Automation of ARIMA modelling","1995cb8c":"We can see from the graph that there is a seasonality in the data","76feb646":"The residuals are completely uncorrelated. But they don't have a normal distribution because of the outliers","1251e081":"# ACF and PACF"}}