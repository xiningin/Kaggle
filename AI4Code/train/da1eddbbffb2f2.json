{"cell_type":{"e46796c0":"code","9f847bfe":"code","d04fcb3f":"code","a7572136":"code","d771c171":"code","1de55b56":"code","2aec1d42":"code","652e27f7":"code","dd3e4007":"code","db85abce":"code","d8a1786c":"code","0d5cd4bd":"code","276e9b70":"code","3e279a89":"code","e319a608":"code","5ac98017":"code","ce4ad623":"code","41611219":"code","168d7b15":"code","df50a57d":"code","2915601f":"code","0b5112d9":"code","ff5d29e1":"markdown","32a4a324":"markdown","e18cbc93":"markdown","dd24115f":"markdown","14decc22":"markdown"},"source":{"e46796c0":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\n\nhistorical_transactions = pd.read_csv('..\/input\/historical_transactions.csv',\n                                      parse_dates=['purchase_date'])\n\nnew_transactions = pd.read_csv('..\/input\/new_merchant_transactions.csv',\n                               parse_dates=['purchase_date'])\n\ntrain = pd.read_csv('..\/input\/train.csv')","9f847bfe":"def view_purchase_graph(card_id):\n    purchases = historical_transactions[historical_transactions['card_id'] == card_id].sort_values('purchase_date')\n    plt.figure(figsize=(8,6))\n    plt.scatter(pd.to_datetime(purchases['purchase_date']).astype(np.int),\n                               purchases['purchase_amount'],\n                               c=['red' if a == 'N' else 'blue' for a in purchases['authorized_flag']])\n    plt.xlabel('time', fontsize=12)\n    plt.ylabel('Historical Purchase Amount', fontsize=12)\n    plt.show()\n\ndef view_new_purchase_graph(card_id):\n    purchases = new_transactions[new_transactions['card_id'] == card_id].sort_values('purchase_date')\n    plt.figure(figsize=(8,6))\n    plt.scatter(pd.to_datetime(purchases['purchase_date']).astype(np.int), purchases['purchase_amount'])\n    plt.xlabel('time', fontsize=12)\n    plt.ylabel('New Purchase Amount', fontsize=12)\n    plt.show()","d04fcb3f":"select = train[train['target'] > 0][train['target'] < 1]\nselect.head()","a7572136":"select.shape","d771c171":"historical_transactions.merge(select).sort_values(['card_id', 'purchase_date']).head()","1de55b56":"new_transactions.merge(select).sort_values(['card_id', 'purchase_date']).head()","2aec1d42":"for card in select['card_id'][:20]:\n    print('-')\n    print(train[train['card_id'] == card]['target'])\n    view_purchase_graph(card)\n    view_new_purchase_graph(card)","652e27f7":"select = train[train['target'] > 10]\nselect.head()","dd3e4007":"select.shape","db85abce":"historical_transactions.merge(select).sort_values(['card_id', 'purchase_date']).head()","d8a1786c":"new_transactions.merge(select).sort_values(['card_id', 'purchase_date']).head()","0d5cd4bd":"for card in select['card_id'][:20]:\n    print('-')\n    print(train[train['card_id'] == card]['target'])\n    view_purchase_graph(card)\n    view_new_purchase_graph(card)","276e9b70":"select = train[train['target'] < -10][train['target'] > -30]\nselect.head()","3e279a89":"select.shape","e319a608":"historical_transactions.merge(select).sort_values(['card_id', 'purchase_date']).head()","5ac98017":"new_transactions.merge(select).sort_values(['card_id', 'purchase_date']).head()","ce4ad623":"for card in select['card_id'][:20]:\n    print('-')\n    print(train[train['card_id'] == card]['target'])\n    view_purchase_graph(card)\n    view_new_purchase_graph(card)","41611219":"select = train[train['target'] < -30]\nselect.head()","168d7b15":"select.shape","df50a57d":"historical_transactions.merge(select).sort_values(['card_id', 'purchase_date']).head()","2915601f":"new_transactions.merge(select).sort_values(['card_id', 'purchase_date']).head()","0b5112d9":"for card in select['card_id'][:20]:\n    print('-')\n    print(train[train['card_id'] == card]['target'])\n    view_purchase_graph(card)\n    view_new_purchase_graph(card)","ff5d29e1":"## Target close to 0","32a4a324":"## Target > 10","e18cbc93":"## Outliers (Target < -30)","dd24115f":"## Target < -10 but > -30","14decc22":"I imagine purchase amounts over time are especially relevant to determining loyalty score. Maybe we could stare at some of these purchase over time curves and see if we can derive any insights for our aggregations. Actual insights from these curves are left as an exercise for the reader. :)"}}