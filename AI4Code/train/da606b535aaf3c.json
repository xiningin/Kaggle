{"cell_type":{"860c7946":"code","656b66bf":"code","ae1c5a93":"code","5dfc020c":"code","f0616fd1":"code","ffbd0be9":"code","ba2986f5":"markdown","10fe1f77":"markdown","cfa87d19":"markdown","4702e98b":"markdown","5e07732d":"markdown","b4f7e503":"markdown"},"source":{"860c7946":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\n# print(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.\nimport plotly.offline as py\npy.init_notebook_mode(connected=True)\nimport plotly.graph_objs as go\nfrom datetime import datetime\nimport pandas_datareader.data as web\n# print(os.listdir('..\/input'))\ndfAll = pd.read_csv('..\/input\/openaq.csv')","656b66bf":"dfAll['city'].unique()","ae1c5a93":"\n#If you want to visualize some other city's pollution, then change Delhi below with one of available cities printed above\ndf = dfAll[dfAll['city'] == 'Delhi']\n# df = df[df['location'] == 'Anand Vihar, Delhi - DPCC']\ndf = df[df.parameter == 'pm25']\ndf_pivot=df[['location', 'local', 'value']].pivot_table(index='location', aggfunc={np.mean})\ndf_pivot_sorted=df_pivot.reindex(df_pivot[df_pivot.columns[0]].sort_values(ascending=False).index)\ndf_pivot_sorted.head()","5dfc020c":"for i in range(0, 5):   #draw a plot of top 5 locations in selected city\n    location_index = i\n    data_to_analyase = df[df.location == df_pivot_sorted.index[location_index]] #take top contributor location\n    data_to_analyase = data_to_analyase[data_to_analyase.value > 0]  #do not consider values with 0 or negative\n    \n    data_to_analyase_hourly = data_to_analyase\n    data_to_analyase_hourly.index = pd.to_datetime(data_to_analyase['local'])\n    data_to_analyase_hourly = data_to_analyase_hourly.resample('d').mean()\n\n    layout = go.Layout(title=df_pivot_sorted.index[location_index])\n    #safe level set as 60 : https:\/\/en.wikipedia.org\/wiki\/Air_pollution_in_Delhi\n    data = [go.Scatter(x=data_to_analyase.local, y=data_to_analyase['value'], name='Actual PM2.5 level'), \n            go.Scatter(x=data_to_analyase.local, y=[60]*len(data_to_analyase), name='Safe Level (60)'),\n            go.Scatter(x=data_to_analyase_hourly.index, y=data_to_analyase_hourly.value, name='Daily Average')\n           ]\n    fig = go.Figure(data, layout=layout)\n    py.iplot(fig)\n","f0616fd1":"import matplotlib.pyplot as plt\nimport matplotlib.cm\n\nfrom mpl_toolkits.basemap import Basemap\nfrom matplotlib.patches import Polygon\nfrom matplotlib.collections import PatchCollection\nfrom matplotlib.colors import Normalize\n\nimport matplotlib.pyplot as plt\nimport matplotlib.cm\n \nfrom mpl_toolkits.basemap import Basemap\nfrom matplotlib.patches import Polygon\nfrom matplotlib.collections import PatchCollection\nfrom matplotlib.colors import Normalize\nfrom scipy.stats import gaussian_kde","ffbd0be9":"#You can fork the notebook and beauify India map further.\n\n# fig, ax = plt.subplots(figsize=(5,5))\nfig, ax = plt.subplots(figsize=(10,10))\nm = Basemap(\n    llcrnrlon=68.0996943,llcrnrlat=5.610304,\n#             #llcrnrlon=dfAll.longitude.min(), llcrnrlat=dfAll.latitude.min(),\n            urcrnrlon=97.4,urcrnrlat=35.610304,\n#             #urcrnrlon=dfAll.longitude.max(), urcrnrlat=dfAll.latitude.max(),\n            resolution='i', # Set using letters, e.g. c is a crude drawing, f is a full detailed drawing\n#             projection='merc', \n            ax = ax,\n            lon_0=77.0996943,lat_0=28.610304 # Setting the central point of the image\n           ) \nm.drawmapboundary(fill_color='#46bcec') # Make your map into any style you like\nm.fillcontinents(color='#f2f2f2',lake_color='#46bcec') # Make your map into any style you like\n# m.drawcoastlines()\n# m.drawrivers() # Default colour is black but it can be customised\nm.drawcountries()\nm.drawstates()\n\ndfplot = dfAll.dropna()[dfAll.value > 0]\ndffinal = None\n#Get a dataframe having day wise average pollution level\nfor c in dfplot.location.unique():\n    data_to_analyase_daily = dfplot[dfplot.location == c]\n    data_to_analyase_daily.index = pd.to_datetime(data_to_analyase_daily['local'])\n#     data_to_analyase_daily = data_to_analyase_daily.resample('d').median()   #Day wise average\n    data_to_analyase_daily = data_to_analyase_daily[data_to_analyase_daily.parameter == 'pm25']\n#     print(data_to_analyase_daily.columns)\n    df_pivot=data_to_analyase_daily[['location', 'local', 'latitude', 'longitude', 'value']].pivot_table(values=['latitude', 'longitude', 'value'], index='location', aggfunc={np.mean})\n#     print(df_pivot.columns)\n    if dffinal is not None:\n        dffinal = pd.concat([dffinal, df_pivot])\n    else:\n        dffinal = df_pivot\n\n# print(dffinal.columns)\n\nsafe_level = 60\nmarker_size = 4\n\ncm = plt.cm.RdYlGn_r   #Green -> Yellow -> Red\nax.scatter(dffinal['longitude']['mean'], dffinal['latitude']['mean'], [x * marker_size if(x <= safe_level)  else safe_level * marker_size for x in dffinal['value']['mean'] if type(x) != str], marker='o', zorder=10, c=[x if(x <= safe_level)  else safe_level for x in dffinal['value']['mean'] if type(x) != str], cmap=cm)  \n# cb = plt.colorbar(ax=ax)\n# cb.set_label('Pollution Density')\n\nplt.show()","ba2986f5":"**Import libraries and data**","10fe1f77":"**Visualize PM2.5 levels for each date for top polluted locations in Delhi**","cfa87d19":"**Pollution density plot on India map with given data**\n\n**These may be the Areas of interest  for Business like - Air Purifier business or Pollution Mask business**   \n*These business can place their stalls in areas shown in the map\/table below* ;)","4702e98b":"**Display available PM2.5 data in tabular format for respective dates in Descending order**   \n*Top 5 Polluted locations in Delhi*","5e07732d":"**Let us see this on map**","b4f7e503":"List of available cities in the data provided:"}}