{"cell_type":{"a356877f":"code","a17598da":"code","b4ca51fe":"code","b353c54c":"code","1f2d76b0":"code","fcb0ba24":"code","a5ec7c15":"code","de8357c4":"code","e5cbeff7":"code","12328ebf":"code","9d3f3184":"code","0613f995":"code","56035bf3":"code","4e3931f0":"code","664cc141":"code","f8e912dd":"code","6c1204b1":"code","7dda457a":"code","3172c616":"code","ee9f1437":"code","1ffbba36":"code","27f84ff2":"code","f31782b8":"code","eefba7af":"code","255fba92":"code","c288145c":"code","6eec4a79":"code","459d9d1f":"code","e03626ae":"code","da3511fc":"code","a9da1b7e":"code","be990dd4":"code","9f03eba0":"code","d98462dc":"code","21b5341b":"code","ee61f192":"code","40bb9a52":"code","87a92818":"code","729d63fc":"code","cb372dfb":"code","1b9224d3":"code","703f3639":"code","2973c8be":"code","fb0acc51":"markdown","899b42d0":"markdown","0ae2ed56":"markdown","061f9dc4":"markdown","e8446d37":"markdown"},"source":{"a356877f":"import pandas as pd\nimport numpy as np\nimport matplotlib.pylab as plt","a17598da":"dat_1=pd.read_csv('..\/input\/havingfun\/current-data-on-the-geographic-distribution-of-covid-19-cases-worldwide.csv')\ndat_2=pd.read_csv('..\/input\/havingfun\/coronavirus-world-airport-impacts.csv')\ndat_3=pd.read_csv('..\/input\/havingfun\/acaps-covid-19-government-measures-dataset.csv')\ndat_4=pd.read_csv('..\/input\/havingfun\/global-school-closures-covid-19.csv')\ndat_5=pd.read_csv('..\/input\/havingfun\/regional-mobility.csv')","b4ca51fe":"print(dat_1.keys())\nprint(dat_2.keys())\nprint(dat_3.keys())\nprint(dat_4.keys())\nprint(dat_5.keys())","b353c54c":"C=list(set(dat_1['countriesandterritories']))\nlen(C)","1f2d76b0":"j=np.where(dat_1['countriesandterritories']=='Colombia')\ndeath = dat_1['deaths'][j[0]]\ncases = dat_1['cases'][j[0]]\nn=len(j[0])\ny=abs(np.arange(n))\nplt.figure(figsize=(10,5))\nplt.subplot(121)\nplt.title('Deaths')\nplt.scatter(y,np.cumsum(np.array(death)),s=2,label='Colombia')\nplt.legend(loc=0.0)\nplt.xlabel('Number of days')\nplt.subplot(122)\nplt.title('Cases')\nplt.scatter(y,np.cumsum(np.array(cases)),s=2,label='Colombia')\nplt.legend(loc=0.0)\nplt.xlabel('Number of days')","fcb0ba24":"C","a5ec7c15":"plt.figure(figsize=(14,5))\nC1=C[:5]+['Colombia']\nplt.subplot(121)\nfor cpa in C1:\n    j=np.where(dat_1['countriesandterritories']==cpa)\n    death = dat_1['deaths'][j[0]]\n    cases = dat_1['cases'][j[0]]\n    n=len(j[0])\n    y=abs(np.arange(n))\n    plt.scatter(y,np.cumsum(np.array(death)),s=2,label=cpa)\nplt.title('Deaths')\nplt.legend(loc=0.0)\nplt.xlabel('Number of days')\nplt.subplot(122)\nplt.title('Cases')\nfor cpa in C1:\n    j=np.where(dat_1['countriesandterritories']==cpa)\n    death = dat_1['deaths'][j[0]]\n    cases = dat_1['cases'][j[0]]\n    n=len(j[0])\n    y=abs(np.arange(n))\n    plt.scatter(y,np.cumsum(np.array(cases)),s=2,label=cpa)\nplt.legend(loc=0.0)\nplt.xlabel('Number of days')","de8357c4":"plt.figure(figsize=(18,5))\nplt.subplot(121)\nD=['Argentina','United Kingdom','Colombia','Italy','China','Germany','United_States_of_America']\nfor cpa in D:\n    j=np.where(dat_1['countriesandterritories']==cpa)\n    death = dat_1['deaths'][j[0]]\n    cases = dat_1['cases'][j[0]]\n    n=len(j[0])\n    y=abs(np.arange(n))\n    plt.scatter(y,np.cumsum(np.array(death)),s=2,label=cpa)\nplt.legend(loc=0.0)\nplt.title('Deaths')\nplt.xlabel('Number of days')\nplt.subplot(122)\nplt.title('Cases')\nfor cpa in D:\n    j=np.where(dat_1['countriesandterritories']==cpa)\n    death = dat_1['deaths'][j[0]]\n    cases = dat_1['cases'][j[0]]\n    n=len(j[0])\n    y=abs(np.arange(n))\n    plt.scatter(y,np.cumsum(np.array(cases)),s=2,label=cpa)\nplt.xlabel('Number of days')\nplt.legend(loc=0.0)","e5cbeff7":"A=set(dat_2['continent'])\nplt.figure(figsize=(10,6))\nfor i in A:\n    k = np.where(dat_2['continent']==i)\n    plt.scatter(dat_2['longitude'][k[0]],dat_2['latitude_d'][k[0]],s=0.2,label=i)\nplt.xlabel('Longitude')\nplt.ylabel('Latitude')\nplt.title('Airports around the world')","12328ebf":"Country=list(set(dat_1['countriesandterritories']))\n#2 letras\nD1_2l=list(set(dat_1['geoid']))\n#3 letras\nD1_3l=list(set(dat_1['countryterritorycode']))\n\n#2 letras\nD2=list(set(dat_2['iso_countr']))[1:]\n\n#3 letras\nD3=list(set(dat_3['iso']))\n\n#3 letras\nD4=list(set(dat_4['iso']))\n\n#Country\nD5=list(set(dat_5['country']))","9d3f3184":"Country_C=[]\nfor i in D5:\n    if i in Country:\n        Country_C.append(i)","0613f995":"len(Country_C)","56035bf3":"Iso_2=[]\nfor i in D1_2l:\n    if i in D2:\n        Iso_2.append(i)","4e3931f0":"len(Iso_2)","664cc141":"Iso_3=[]\nfor i in D1_3l:\n    if (i in D3)&(i in D4):\n        Iso_3.append(i)","f8e912dd":"len(Iso_3)","6c1204b1":"def contin(Name):\n    x=0\n    if(Name=='Europe'):\n        x=1\n    elif(Name=='Asia'):\n        x=2\n    elif(Name=='Africa'):\n        x=3\n    elif(Name=='Oceania'):\n        x=4\n    \n    return x","7dda457a":"Country_list=[]\ntarget=[]\nfor i in Country_C:\n    ii=np.where(dat_1['countriesandterritories']==i)[0][0]\n    l2=dat_1['geoid'][ii]\n    l3=dat_1['countryterritorycode'][ii]\n    continent=dat_1['continentexp'][ii]\n    con=contin(continent)\n    if(l2 in Iso_2)&(l3 in Iso_3):\n        Country_list.append([i,l2,l3,con])\n        target.append(con)","3172c616":"print(len(target),len(Country_list))","ee9f1437":"n=len(Country_list)\ndata=np.zeros((n,18))\ndat_6=np.array(dat_5)","1ffbba36":"#Funciones\ndef data1(name):\n    j=np.where(dat_1['countriesandterritories']==name)[0]\n    casos=np.sum(dat_1['cases'][j])\n    muertes=np.sum(dat_1['deaths'][j])\n    \n    return [muertes,casos]\n\ndef data2(l2):\n    j=np.where(dat_2['iso_countr']==l2)[0]\n    cant=len(j)\n    a=len(dat_2['type'][j])\n    b=len(np.where(dat_2['type'][j]=='large_airport'))\n    \n    return [cant,b\/a]\n\ndef data34(l3):\n    j=np.where(dat_3['iso']==l3)[0]\n    k=np.where(dat_4['iso']==l3)[0]\n    \n    return [len(j),len(k)]\n\ndef data5(name):\n    b=np.where((dat_5['country']==name) & (dat_5['region']=='Total'))[0]\n    c=int(len(b)\/4)\n    A=list(np.mean(dat_6[b,3:][:c],axis=0))+list(np.mean(dat_6[b,3:][-c:],axis=0))\n    \n    return A\n\ndef data_obt(name,l2,l3):\n    return data1(name)+data2(l2)+data34(l3)+data5(name)","27f84ff2":"for i in range(len(Country_list)):\n    da=Country_list[i]\n    data[i,:]=data_obt(da[0],da[1],da[2])","f31782b8":"print(np.sum(np.isnan(data)))","eefba7af":"Warn=[]\nfor i in range(len(Country_list)):\n    na=np.sum(np.isnan(data[i,:]))\n    if na!=0:\n        Warn.append(i)\n        print(i,Country_list[i][0])\nWarn=np.array(Warn)","255fba92":"data=np.delete(data, Warn, axis=0)\nCountry_list=np.delete(Country_list,Warn,axis=0)\ntarget=np.delete(target,Warn)","c288145c":"print(np.sum(np.isnan(data)))","6eec4a79":"print(np.shape(data),np.shape(target))","459d9d1f":"Country_list","e03626ae":"import sklearn.ensemble # para el random forest\nimport sklearn.model_selection # para split train-test\nimport sklearn.metrics # para calcular el f1-score","da3511fc":"x_train, x_test, y_train, y_test = sklearn.model_selection.train_test_split(data, target, test_size=0.5)","a9da1b7e":"predictors=['cases','deaths','Number of Airports','Medium size of airports','Number of Measures','Schools closed']\npredictors=predictors+list(dat_5.keys()[3:])\nfor i in dat_5.keys()[3:]:\n    j=i+' end'\n    predictors=predictors+[j]","be990dd4":"n_trees = np.arange(1,400,25)\nf1_train = []\nf1_test = []\nfeature_importance = np.zeros((len(n_trees), len(predictors)))\n\nfor i, n_tree in enumerate(n_trees):\n    clf = sklearn.ensemble.RandomForestClassifier(n_estimators=n_tree, max_features='sqrt')\n    clf.fit(x_train, y_train)\n    f1_train.append(sklearn.metrics.f1_score(y_train, clf.predict(x_train),average='macro'))\n    f1_test.append(sklearn.metrics.f1_score(y_test, clf.predict(x_test),average='macro'))\n    feature_importance[i, :] = clf.feature_importances_","9f03eba0":"plt.scatter(n_trees,f1_test)\nplt.ylim(0.3,1)\nplt.xlabel('n_trees')\nplt.ylabel('F1 Score')","d98462dc":"# Grafica los features mas importantes\navg_importance = np.average(feature_importance, axis=0)\na = pd.Series(avg_importance, index=predictors)\na.nlargest().plot(kind='barh')\nplt.xlabel('Average Feature Importance')","21b5341b":"def stat(data,avg):\n    rt=np.zeros(len(avg))\n    for i in range(len(avg)):\n        rt[i]=np.mean(data[:,avg[i]])\n    return rt","ee61f192":"avg=[6,0,14,8,5]\navg_data=np.zeros((5,5))\nfor i in range(5):\n    n_1=np.where(target==i)[0]\n    avg_data[i,:]=stat(data[n_1,:],avg)","40bb9a52":"name_con=['America','Europe','Asia','Africa','Oceania']","87a92818":"plt.figure(figsize=(26,6))\ncol=['blue','orange','green','red','purple']\nfor i in range(5):\n    k=150+i+1\n    plt.subplot(k)\n    plt.scatter(name_con,avg_data[:,i],label=predictors[avg[i]],c=col[i])\n    plt.legend(loc=0.0)    \n    plt.xlabel('Continents')\n    if i==1:\n        plt.ylabel('Number of cases')\n    elif i==4:\n        plt.ylabel('Number of Schools Closed')\n    else:\n        plt.ylabel('Mobility')","729d63fc":"import sklearn.cluster","cb372dfb":"tsne = sklearn.manifold.TSNE(perplexity=20)\ntsne.fit(data)\nembedding = tsne.embedding_\nplt.scatter(embedding[:,0], embedding[:,1], c=target, cmap='Paired', s=1.0)\nplt.colorbar(boundaries=np.arange(6)-0.5).set_ticks(np.arange(5))\nprint(name_con)","1b9224d3":"# clusters sobre los resultados de tsne\nn_clusters = 5\nk_means = sklearn.cluster.KMeans(n_clusters=n_clusters)\nk_means.fit(embedding)\ncluster = k_means.predict(embedding) \ndistance = k_means.transform(embedding) \n\nplt.scatter(embedding[:,0], embedding[:,1], c=cluster, cmap='Paired', s=1.0)\nplt.colorbar(boundaries=np.arange(6)-0.5).set_ticks(np.arange(5))","703f3639":"# clusters sobre los resultados de tsne\nplt.figure(figsize=(12,6))\nn_clusters = 5\nk_means = sklearn.cluster.KMeans(n_clusters=n_clusters)\nk_means.fit(embedding)\ncluster = k_means.predict(embedding) \ndistance = k_means.transform(embedding) \n\nplt.scatter(embedding[:,0], embedding[:,1], c=cluster, cmap='Paired', s=1.0)\nplt.colorbar(boundaries=np.arange(6)-0.5).set_ticks(np.arange(5))\ni_1=np.where(target==0)[0]\nplt.scatter(embedding[i_1,0], embedding[i_1,1], c='red', cmap='Paired', s=2.0)\nfor i in i_1:\n    if np.array(Country_list)[i,2]=='COL':\n        plt.text(embedding[i,0]+0.2, embedding[i,1]-0.4, np.array(Country_list)[i,2],color='red',fontsize=12)\n    else:\n        plt.text(embedding[i,0]+0.2, embedding[i,1]+0.2, np.array(Country_list)[i,2])","2973c8be":"np.array(Country_list)[i_1,2]","fb0acc51":"# **Now we want to graph the behavior of our F1**","899b42d0":"We have a little problem because some rows have null values","0ae2ed56":"# **Collecting enough data**","061f9dc4":"# **In order to find the Feature Importance we use Random Forest**","e8446d37":"# **Let's use TSNE to find another separation for the data**"}}