{"cell_type":{"96689f93":"code","c085d07a":"code","fb075826":"code","4e1ae365":"code","0d7be1ec":"code","11ac1f99":"code","d4dbe6fa":"code","2cc28106":"code","d26cf11f":"code","b32376a4":"code","8e37d2fd":"code","f666a253":"code","ba26a83a":"code","6e93bea3":"code","e515771c":"code","dc6237a6":"code","8f8296ec":"code","e1ac4f9b":"code","d24fdf34":"code","6cb128c2":"code","c530be0d":"markdown","c02007da":"markdown","59451729":"markdown","9bbd67ae":"markdown","a232ec01":"markdown","296eeece":"markdown","567b2e68":"markdown","d9956abf":"markdown","1f5b7175":"markdown","32f362c0":"markdown","e7ee031b":"markdown","6c1784db":"markdown","c6e958f4":"markdown","76453812":"markdown","ee2d866a":"markdown","23f769f5":"markdown","e353c56e":"markdown","4dd42de6":"markdown","26afd887":"markdown","1a6d29c7":"markdown","8c7572d3":"markdown","41c99b8e":"markdown"},"source":{"96689f93":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom scipy.stats import norm\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.metrics import confusion_matrix,accuracy_score,roc_curve,auc\nfrom sklearn.model_selection import GridSearchCV","c085d07a":"dataset = pd.read_csv(\"\/kaggle\/input\/heart-failure-clinical-data\/heart_failure_clinical_records_dataset.csv\")\ndataset.head()","fb075826":"dataset.isnull().sum()","4e1ae365":"f,ax = plt.subplots(figsize=(6,6))\nsns.distplot(dataset[\"age\"],kde=True,axlabel=\"Age\",fit=norm)\nax.text(0.8,0.9,\"Mean -\" + str(\"{:.2f}\".format(dataset[\"age\"].mean())),transform=ax.transAxes)\nax.text(0.8,0.85,\"SD -\" + str(\"{:.2f}\".format(dataset[\"age\"].std())),transform=ax.transAxes)\nax.set_title(\"Age Distribution\")","0d7be1ec":"f,ax = plt.subplots(figsize=(6,6))\nsns.boxplot(x=\"DEATH_EVENT\",y=\"age\",data=dataset)\nax.set_title(\"Age by Death Event\")\nax.set_xlabel(\"Death Event (0-No, 1-Yes)\")\nax.set_ylabel(\"Age\")","11ac1f99":"data_anaemia = dataset[\"anaemia\"].value_counts()\nplt.pie(data_anaemia,explode=(0,0.1),labels=[\"Non Anaemic\",\"Anaemic\"],shadow=True,startangle=90,autopct=\"%1.1f%%\")","d4dbe6fa":"f,ax = plt.subplots(figsize=(6,6))\nax=sns.countplot(x=\"anaemia\",hue=\"DEATH_EVENT\",data=dataset)\npatch = ax.patches\nhalf = int(len(patch)\/2)\n\nfor i in range(half):\n    pat_1= patch[i]\n    pat_2 = patch[i+half]\n    height_1 = pat_1.get_height()\n    height_2 = pat_2.get_height()\n    total = height_1  + height_2\n    width_1 = pat_1.get_x()+pat_1.get_width()\/2-.05\n    width_2 = pat_2.get_x()+pat_2.get_width()\/2-.05\n    ax.text(width_1,height_1+2,\"{:.0%}\".format(height_1\/total))\n    ax.text(width_2,height_2+2,\"{:.0%}\".format(height_2\/total))","2cc28106":"data_diabetes = dataset[\"diabetes\"].value_counts()\nplt.pie(data_diabetes,explode=(0,0.1),labels=[\"Non Diabetic\",\"Diabetic\"],shadow=True,startangle=90,autopct=\"%1.1f%%\")","d26cf11f":"f,ax = plt.subplots(figsize=(6,6))\nax=sns.countplot(x=\"diabetes\",hue=\"DEATH_EVENT\",data=dataset)\npatch = ax.patches\nhalf = int(len(patch)\/2)\n\nfor i in range(half):\n    pat_1= patch[i]\n    pat_2 = patch[i+half]\n    height_1 = pat_1.get_height()\n    height_2 = pat_2.get_height()\n    total = height_1  + height_2\n    width_1 = pat_1.get_x()+pat_1.get_width()\/2-.05\n    width_2 = pat_2.get_x()+pat_2.get_width()\/2-.05\n    ax.text(width_1,height_1+2,\"{:.0%}\".format(height_1\/total))\n    ax.text(width_2,height_2+2,\"{:.0%}\".format(height_2\/total))","b32376a4":"f,ax = plt.subplots(figsize=(6,6))\nsns.boxplot(x=\"DEATH_EVENT\",y=\"ejection_fraction\",data=dataset)\nax.set_title(\"Ejection Fraction by Death Event\")\nax.set_xlabel(\"Death Event (0-No, 1-Yes)\")\nax.set_ylabel(\"Ejection Fraction\")","8e37d2fd":"dataset=dataset[dataset[\"creatinine_phosphokinase\"]<3000]","f666a253":"f,ax=plt.subplots(1,2,figsize=(15,7))\nsns.distplot(dataset.loc[dataset[\"DEATH_EVENT\"]==0][\"creatinine_phosphokinase\"],kde=True,axlabel=\"CP- Death(No)\",fit=norm,ax=ax[0])\nsns.distplot(dataset.loc[dataset[\"DEATH_EVENT\"]==1][\"creatinine_phosphokinase\"],kde=True,axlabel=\"CP - Death(Yes)\",fit=norm,ax=ax[1])\nax[0].text(.8,.9,\"Mean - \" + str(\"{:.0f}\".format(dataset.loc[dataset[\"DEATH_EVENT\"]==0][\"creatinine_phosphokinase\"].mean())),transform=ax[0].transAxes)\nax[0].text(.8,.8,\"S.D. - \" + str(\"{:.0f}\".format(dataset.loc[dataset[\"DEATH_EVENT\"]==0][\"creatinine_phosphokinase\"].std())),transform=ax[0].transAxes)\nax[1].text(.8,.9,\"Mean - \" + str(\"{:.0f}\".format(dataset.loc[dataset[\"DEATH_EVENT\"]==1][\"creatinine_phosphokinase\"].mean())),transform=ax[1].transAxes)\nax[1].text(.8,.8,\"S.D. - \" + str(\"{:.0f}\".format(dataset.loc[dataset[\"DEATH_EVENT\"]==1][\"creatinine_phosphokinase\"].std())),transform=ax[1].transAxes)","ba26a83a":"f,ax = plt.subplots(figsize=(6,6))\nax=sns.countplot(x=\"high_blood_pressure\",hue=\"DEATH_EVENT\",data=dataset)\npatch = ax.patches\nhalf = int(len(patch)\/2)\n\nfor i in range(half):\n    pat_1= patch[i]\n    pat_2 = patch[i+half]\n    height_1 = pat_1.get_height()\n    height_2 = pat_2.get_height()\n    total = height_1  + height_2\n    width_1 = pat_1.get_x()+pat_1.get_width()\/2\n    width_2 = pat_2.get_x()+pat_2.get_width()\/2\n    ax.text(width_1,height_1+2,\"{:.0%}\".format(height_1\/total))\n    ax.text(width_2,height_2+2,\"{:.0%}\".format(height_2\/total))","6e93bea3":"f,(ax1,ax2) = plt.subplots(1,2,figsize=(7,8))\ndata_female = dataset[dataset[\"sex\"]==0]\ndata_male = dataset[dataset[\"sex\"]==1]\nsns.countplot(x=\"DEATH_EVENT\",hue=\"smoking\",data=data_female,ax=ax1)\nsns.countplot(x=\"DEATH_EVENT\",hue=\"smoking\",data=data_male,ax=ax2)\nax1.set_title(\"Female\")\nax2.set_title(\"Male\")\npatch_1 = ax1.patches\npatch_2 = ax2.patches\nhalf = int(len(patch_1)\/2)\n\nfor i in range(half):\n    pat_1= patch_1[i]\n    pat_2 = patch_1[i+half]\n    height_1 = pat_1.get_height()\n    height_2 = pat_2.get_height()\n    total = height_1  + height_2\n    width_1 = pat_1.get_x()+pat_1.get_width()\/2-.05\n    width_2 = pat_2.get_x()+pat_2.get_width()\/2-.05\n    ax1.text(width_1,height_1+1,\"{:.0%}\".format(height_1\/total))\n    ax1.text(width_2,height_2+1,\"{:.0%}\".format(height_2\/total))\n\nfor i in range(half):\n    pat_1= patch_2[i]\n    pat_2 = patch_2[i+half]\n    height_1 = pat_1.get_height()\n    height_2 = pat_2.get_height()\n    total = height_1  + height_2\n    width_1 = pat_1.get_x()+pat_1.get_width()\/2-.05\n    width_2 = pat_2.get_x()+pat_2.get_width()\/2-.05\n    ax2.text(width_1,height_1+1,\"{:.0%}\".format(height_1\/total))\n    ax2.text(width_2,height_2+1,\"{:.0%}\".format(height_2\/total))","e515771c":"f,ax=plt.subplots(1,2,figsize=(15,7))\nsns.distplot(dataset.loc[dataset[\"DEATH_EVENT\"]==0][\"platelets\"],kde=True,axlabel=\"Platelet- Death(No)\",fit=norm,ax=ax[0])\nax[0].text(.8,.9,\"Mean - \" + str(\"{:.0f}\".format(dataset.loc[dataset[\"DEATH_EVENT\"]==0][\"platelets\"].mean())),transform=ax[0].transAxes)\nax[0].text(.8,.8,\"S.D. - \" + str(\"{:.0f}\".format(dataset.loc[dataset[\"DEATH_EVENT\"]==0][\"platelets\"].std())),transform=ax[0].transAxes)\nsns.distplot(dataset.loc[dataset[\"DEATH_EVENT\"]==1][\"platelets\"],kde=True,axlabel=\"Platelet - Death(Yes)\",fit=norm,ax=ax[1])\nax[1].text(.8,.9,\"Mean - \" + str(\"{:.0f}\".format(dataset.loc[dataset[\"DEATH_EVENT\"]==1][\"platelets\"].mean())),transform=ax[1].transAxes)\nax[1].text(.8,.8,\"S.D. - \" + str(\"{:.0f}\".format(dataset.loc[dataset[\"DEATH_EVENT\"]==1][\"platelets\"].std())),transform=ax[1].transAxes)","dc6237a6":"f,ax = plt.subplots(figsize=(6,6))\nsns.boxplot(x=\"DEATH_EVENT\",y=\"serum_creatinine\",data=dataset)\nax.set_title(\"Serum Cretanine by Death Event\")\nax.set_xlabel(\"Death Event (0-No, 1-Yes)\")\nax.set_ylabel(\"Serum Creatinine\")","8f8296ec":"f,ax = plt.subplots(figsize=(6,6))\nsns.boxplot(x=\"DEATH_EVENT\",y=\"serum_sodium\",data=dataset)\nax.set_title(\"Serum Sodium by Death Event\")\nax.set_xlabel(\"Death Event (0-No, 1-Yes)\")\nax.set_ylabel(\"Serum Sodium\")","e1ac4f9b":"corr_matrix = np.triu(dataset.corr())\nf,ax = plt.subplots(figsize=(10,10))\nsns.heatmap(dataset.corr(),cmap=\"coolwarm\",mask=corr_matrix,vmin=-1,annot=True)","d24fdf34":"y=dataset[\"DEATH_EVENT\"]\nX = dataset.drop([\"time\",\"DEATH_EVENT\"],axis=1)\nX_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.2,random_state=42)","6cb128c2":"\n\nrf= RandomForestClassifier()\n\nn_estimators = [100,200,300]\nmax_depth = [4,5,6,7]\nmin_samples_split = [4,5,6,7]\n\nparams = dict(n_estimators = n_estimators, max_depth = max_depth, min_samples_split = min_samples_split)\n\ngrid = GridSearchCV(rf, params, cv = 5, verbose = 1, n_jobs = -1)\n\ngrid_r = grid.fit(X_train, y_train)\n\ny_scores = grid_r.best_estimator_.predict_proba(X_test)\ny_scores = y_scores[:,1]\nfpr,tpr,threshold = roc_curve(y_test,y_scores)\n\nroc_auc = auc(fpr, tpr)\nplt.title('Receiver Operating Characteristic')\nplt.plot(fpr, tpr, 'b', label = 'AUC = %0.2f' % roc_auc)\nplt.legend(loc = 'lower right')\nplt.plot([0, 1], [0, 1],'r--')\nplt.xlim([0, 1])\nplt.ylim([0, 1])\nplt.ylabel('True Positive Rate')\nplt.xlabel('False Positive Rate')\nplt.show()","c530be0d":"Let us see how significant is the ejection fraction\n\nWe can observe that patients with a lower ejection fraction are at higher risk","c02007da":"Let us study the impact of diabetes on fatal heart attacks\n\nAs far as fatal heart attacks are concerned we can see that diabetes does not play a part according to our sample.","59451729":"Let us study the impact of smoking on fatal heart attacks\n\nCompared to men, women are at greater risk from smoking","9bbd67ae":"Now let us see if the findings from the heatmap corroborate to the EDA that we have done so far.\n1. We have seen higher age patients are at higher risk and in the heatmap also we can see there is a strong positive correlation between age and Death_Event\n2. Anaemic patients are at higher risk as per our findings earlier and we can see a postive correlation in the heatmap\n3. For Creatanine Phosphokinase we were unable to find a definite relation to the death rate, but from the heatmap we can find it has a negative correlation with the death rate, albeit a small one.\n4. For diabetes we concluded earlier that we could not find a strong correlation to the death rate. The heatmap also shows a very small negative correlation to the detah rate.\n5. For ejection fraction both our heatmap and analysis earlier are the same, higher the ejection rate lower the risk\n6. Higher the blood pressure higher the risk of death event, again our heatmap and analysis are in sync\n7. Higher platelet count is better for health, evident from the heatmap. Our distribution was ambiguous but the mean pointed out that higher platelet count is better.\n8. Serum Cretanine and Serum Sodium are positively and negatively correlated to the death rate both according our analysis and the heatmap\n9. For smoking we failed to find any correlation with the death rate","a232ec01":"Let's remove some outliers which i observed through a boxplot","296eeece":"Being anaemic may have an effect on your heart also. Let us find out.\n\nPatients with anaemia are at a higher risk of death - 36% of patients who died had anaemia, while only 29% of the patients who are still alive have anaemia","567b2e68":"% of Anaemic and Non Anaemic patients.\nHigher percentage of our dataset are non Anaemic","d9956abf":"Let us study the impact of high blood pressure on fatal heart attacks\n\nDeath rate in higher in patients with high blood pressure","1f5b7175":"Platelet count has lower impact on the death rate. The mean and SD for both cases where there has been a fatality and non fatality are comparable","32f362c0":"Distribution plot for age\nThe distribution for age has a mean of 60.8 and S.D. of 11.89. The distribution is close to a normal distribution","e7ee031b":"Importing all the necessary libraries","6c1784db":"Let us create a heatmap of the correlation matrix of the features to compare it to our EDA so far.","c6e958f4":"# **Analysing the Heart Failure prediction dataset.**\n\n\nWe have been provided 12 key features of a set of patients who then may or may not have died during their followup period.\nOur task is to study these features as to how are they correlated to the target and create a model to predict the probability of death of a patients given his current condition\/status.\n\nThe primary purpose of this notebook is to gain an understanding of how the features are related to our Target (Death Event) and then we move on to the model.\n\nI have avoided putting in visualizations just for the sake of it. I have put in visualizations in such a way that post studying all the visualizations we have an understanding of all the features and how are they relevant in the dataset.\n\nTo keep this notebook simple I haven't added any automated hyperparameter optimization techniques. In case you are interested in those methods please check my notebook here - > [Click Here](https:\/\/www.kaggle.com\/ankur123xyz\/advanced-hyperparameter-tuning-techniques).\n\nFor anyone looking to gain further understanding into this dataset, there is an intersesting study I found:-\n[Click Here](https:\/\/bmcmedinformdecismak.biomedcentral.com\/articles\/10.1186\/s12911-020-1023-5)\n\nA snapshot of the data before we start so that it is easier to delve in to the data.\n\n![](https:\/\/www.linkpicture.com\/q\/Screenshot-2020-08-25-at-5.39.20-PM.png)\nSource:- [Link](https:\/\/bmcmedinformdecismak.biomedcentral.com\/articles\/10.1186\/s12911-020-1023-5\/tables\/1)\n\nPlease do upvote if you learn something out of this notebook. Cheers !\n","76453812":"We would apply the Random Forest model on our data and do a grid search to tune our hyperparameters.\n\nEvaluating the model gives us a AUC of 0.75","ee2d866a":"Import the dataset and check the first few rows to get a glimpse at the data","23f769f5":"Check for missing data.\nNone of the data is missing, so we can proceed further.","e353c56e":"Now let us build a model which can predict the death event basis the data provided. We will drop the followup time since it is natural for patients with death event as yes to have lower followup periods.\n\nLet us split the data between training and test sets\n\n\nPlease note we are dropping the time feature as it is evident that the followup period of many of the patients may have been cutoff who died due to heart failure. We may not have the followup period when we are trying to make predictions in the real world.","4dd42de6":"% of Diabetic and Non Diabetic patients\n\nHigher percentage of our datset is non diabetic","26afd887":"Let us see how significant is the ejection fraction\n\nWe can see that it is better to maintain lower Serum Ceatanine to stay healthy","1a6d29c7":"Let us see the significance of age for fatal heart attacks.\n\nWe can see that age is defintely a factor in fatal heart attacks","8c7572d3":"Let us see how significant is the ejection fraction\n\nWe can see that it is better to maintain a higher Serum Sodium to stay healthy","41c99b8e":"The CP Distribution plot is similar for both death event values which signifies it has lower impact on the death event"}}