{"cell_type":{"81b63695":"code","d6338b40":"code","a84d7a40":"code","59227eb6":"code","577cc9d8":"code","577bf0af":"code","1730d6c1":"code","4af7a06c":"code","cdee84ec":"code","bce810ad":"code","258a7849":"code","39671a28":"code","60af542f":"code","b434ee97":"code","82f2206c":"code","4320c81c":"code","84f5571d":"code","dd0c2d84":"code","102bdf61":"code","acb69347":"code","c92b9579":"code","4d8de551":"code","a8906180":"code","bfbf37ad":"code","3ece991a":"code","edaa6f51":"code","e9e12f6d":"code","8e4496e2":"code","a63e5d76":"code","0428b144":"code","9f5a839e":"code","6566f72e":"code","2776c7e6":"code","1e511fa3":"code","1bbfb95c":"code","f498a8f1":"code","21e4bb31":"code","ea369ddc":"code","baa9303c":"code","4fa8a880":"code","7c121806":"code","21a25cbc":"code","2e5548cd":"code","25a2685f":"code","4330ca09":"code","be4f74a1":"code","fceb3b5b":"code","df858ed9":"code","320e09e6":"code","053a30be":"code","620c213e":"code","790dc710":"code","f98016f5":"code","29edc43b":"code","9cfc4f86":"code","24f0dee8":"code","dfbd6544":"code","38996749":"code","ab65d0c5":"code","bedf823f":"code","01c4b1dd":"code","5b0b79fe":"code","eb19b9ea":"code","f8645499":"code","11196ccd":"code","54f16183":"markdown","b08e67f2":"markdown","2f858967":"markdown","c68f902a":"markdown","adef7453":"markdown","70f03776":"markdown","3710dd1a":"markdown","59f74600":"markdown","666f5a31":"markdown","75df6fb6":"markdown","184d3847":"markdown","54f0f949":"markdown","894d7e68":"markdown","5b0e57db":"markdown","b886af2e":"markdown","6c0a30b9":"markdown","654e9851":"markdown","02e2dd80":"markdown","62a20e3a":"markdown","ca36fafb":"markdown","715f4b9a":"markdown","ec8daad8":"markdown","e96eaabe":"markdown","b4174c9a":"markdown","ebee1e1d":"markdown","cb1309f5":"markdown"},"source":{"81b63695":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\npd.set_option(\"display.max_columns\",None);\npd.set_option(\"display.max_rows\",None);\nretail=pd.read_excel(\"..\/input\/online-retail-ii-dataset\/online_retail_II.xlsx\", sheet_name=\"Year 2010-2011\")\n","d6338b40":"df=retail.copy()\ndf.head(5)","a84d7a40":"df.info()","59227eb6":"df.isna().sum()  ","577cc9d8":"import missingno as msno\nmsno.bar(df);","577bf0af":"df[df.isnull().any(axis=1)].shape","1730d6c1":"import missingno as msno\nmsno.heatmap(df);","4af7a06c":"df[df.isnull().any(axis=1)].shape","cdee84ec":"135080\/541910","bce810ad":"missingdf=df[(df[\"Description\"].isnull()==True)  & (df[\"Customer ID\"].isnull()==True)].head()\nmissingdf.head()","258a7849":"missingdf.groupby(\"Country\").agg({\"Price\":np.mean})","39671a28":"df=df[df.notnull().all(axis=1)]\nprint(df.shape)","60af542f":"df.head()","b434ee97":"df[\"Customer ID\"]=df[\"Customer ID\"].astype(\"int64\")","82f2206c":"df.head(1)","4320c81c":"df[df[\"Invoice\"].astype(\"str\").str.get(0)==\"C\"].shape","84f5571d":"df[df[\"Invoice\"].astype(\"str\").str.get(0)==\"C\"].head()","dd0c2d84":"df=df[df[\"Invoice\"].astype(\"str\").str.get(0)!=\"C\"]","102bdf61":"df[df[\"Invoice\"].astype(str).str.get(0)!=\"5\"].head()","acb69347":"df[df[\"Quantity\"]<0]","c92b9579":"df.info()","4d8de551":"df.Country.value_counts().head()","a8906180":"df[df.duplicated([\"Description\",\"Invoice\"],keep=False)].head()","bfbf37ad":"df=df.drop([125])\ndf[df.duplicated([\"Description\",\"Invoice\"],keep=False)].head()","3ece991a":"df.groupby(\"Country\").agg({\"Price\":\"sum\"}).applymap('{:,.2f}'.format).sort_values(by=\"Price\", ascending=True).head(10)","edaa6f51":"# Unique products","e9e12f6d":"df[\"Description\"].nunique()","8e4496e2":"# Each products counts are..","a63e5d76":"df.Description.value_counts().head() # counts of categorical values","0428b144":"# Best-seller","9f5a839e":"df.groupby(\"Description\").agg({\"Quantity\":sum}).sort_values(by=\"Quantity\", ascending=False).head()","6566f72e":"# Unique invoice","2776c7e6":"df[\"Invoice\"].nunique()","1e511fa3":"df[\"Total_price\"]=df[\"Quantity\"]*df[\"Price\"]","1bbfb95c":"df.head(5)","f498a8f1":"pd.set_option(\"display.float_format\", lambda x: \"%.2f\" % x)","21e4bb31":"# The top invoices for price","ea369ddc":"df.groupby(\"Invoice\").agg({\"Total_price\":sum}).head()","baa9303c":"df.groupby(\"Invoice\").agg({\"Total_price\":\"sum\"}).sort_values(\"Total_price\", ascending=False).head(11)","4fa8a880":"# The highest invoice","7c121806":"df[df[\"Invoice\"]==581483]","21a25cbc":"# The most expensive product is \"POSTAGE\"","2e5548cd":"df.sort_values(\"Price\",ascending=False).head()","25a2685f":"# Countries total prices","4330ca09":"df.groupby(\"Country\").agg({\"Total_price\":\"sum\"}).sort_values(\"Total_price\",ascending=False).head()","be4f74a1":"import datetime as dt\ntoday_date=dt.datetime(2011,12,10)\n\nrec_df=today_date-df.groupby(\"Customer ID\").agg({\"InvoiceDate\":max})\nrec_df.rename(columns={\"InvoiceDate\": \"Recency\"}, inplace=True)\nrec_df=rec_df[\"Recency\"].apply(lambda x: x.days)\n\n#FRQUENCY\n\nfreq_df=df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"nunique\"})\nfreq_df.rename(columns={\"InvoiceDate\": \"Frequency\"}, inplace=True)\n\n#MONETARY\nmonetary_df=df.groupby(\"Customer ID\").agg({\"Total_price\":\"sum\"})\nmonetary_df.rename(columns={\"Total_price\":\"Monetary\"}, inplace=True)\n\nrfm=pd.concat([rec_df,freq_df, monetary_df], axis=1)\nrfm.head()","fceb3b5b":"rfmm=rfm.copy()","df858ed9":"#SKEWNESS\nrfmm.skew()","320e09e6":"import matplotlib.pyplot as plt\nfig, ax = plt.subplots(1, 3, figsize=(15,3))\nsns.distplot(rfmm['Recency'], ax=ax[0])\nsns.distplot(rfmm['Frequency'], ax=ax[1])\nsns.distplot(rfmm['Monetary'], ax=ax[2]);","053a30be":"# Log transformation\n\nrfmm['Recency']=np.log1p(rfmm['Recency'])\nrfmm['Frequency']=np.log1p(rfmm['Frequency'])\nrfmm['Monetary']=np.log1p(rfmm['Monetary'])","620c213e":"rfmm.head(3)","790dc710":"# Scaling\n\nfrom sklearn.preprocessing import Normalizer\ntransformer = Normalizer().fit(rfmm)\nnormalized=transformer.transform(rfmm)\nnormalized_rfm=pd.DataFrame(normalized,columns=rfm.columns)\nnormalized_rfm.head()","f98016f5":"from sklearn.cluster import KMeans\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=DeprecationWarning) \nwarnings.filterwarnings(\"ignore\", category=FutureWarning)\n\n\n\npd.set_option('display.max_rows', None)\npd.set_option('display.max_columns', None)","29edc43b":"from sklearn.cluster import KMeans\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=DeprecationWarning) \nwarnings.filterwarnings(\"ignore\", category=FutureWarning)\n\n\n\npd.set_option('display.max_rows', None)\npd.set_option('display.max_columns', None)","9cfc4f86":"#optimum k\n\nfrom sklearn.cluster import KMeans\n\nsse = {}\nfor k in range(1, 10):\n    kmeans = KMeans(n_clusters=k, random_state=42)\n    kmeans.fit(normalized_rfm)\n    sse[k] = kmeans.inertia_ # SSE to closest cluster centroid\n\nplt.title('The Elbow Method')\nplt.xlabel('k')\nplt.ylabel('SSE')\nsns.pointplot(x=list(sse.keys()), y=list(sse.values()))\nplt.show()","24f0dee8":"!pip install --upgrade pip\n!pip install yellowbrick\nfrom yellowbrick.cluster import KElbowVisualizer","dfbd6544":"kmeans=KMeans()\nvisu=KElbowVisualizer(kmeans, k=(2,10))\nvisu.fit(normalized_rfm)\nvisu.poof()","38996749":"# K=3 is the optimal choice\n\nk_means = KMeans(n_clusters = 3).fit(normalized_rfm)\nsegments=k_means.labels_\nsegments","ab65d0c5":"print(segments.shape)\nprint(normalized_rfm.shape)","bedf823f":"sns.distplot(segments);","01c4b1dd":"normalized_rfm[\"Segments\"] = k_means.labels_\nnormalized_rfm.head(3)","5b0b79fe":"rfmm.shape","eb19b9ea":"normalized_rfm.shape","f8645499":"# To analyze well\n\nS=pd.DataFrame(normalized_rfm[\"Segments\"])\nS=S.reset_index(drop=True)\nrfm=rfm.reset_index(drop=True)\ndf_all=pd.concat([rfm, S], axis=1)\ndf_all.head(10)","11196ccd":"df_all[[\"Segments\",\"Recency\",\"Frequency\",\"Monetary\"]].groupby(\"Segments\").agg([\"min\",\"max\",\"mean\",\"count\"])","54f16183":"### I grouped this data set by country. \n### Price mean is 0 and there is only one country. Therefore, trying to fill these observations will be meaningless.","b08e67f2":"# DATA UNDERSTANDING AND PREPROCESSING","2f858967":"There are 1477 customers in this group.\n\n* Their last purchases was 200 days ago, meanly.\n* The frequency of the group's purchase mean is 1.4.\n* The mean of the total purchase for one person who is in this group is 346 sterlin.\n","c68f902a":"## Identify the data","adef7453":"# \"Segment 2\"","70f03776":"# \"Segment 0\"\n\n\nThere are 1026 customers in this group.\n\n* Their last purchases was 8.5 days ago, meanly.\n* The frequency of the group's purchase mean is 10.15.\n* The mean of the total purchase for one person who is in this group is 5816 sterlin.","3710dd1a":"# New df without NA","59f74600":"# \"Segment 1\"","666f5a31":"> # K-Means","75df6fb6":"### This dataset has 8 columns and 541.910 observations.","184d3847":"### How about the Price?","54f0f949":"# K-Means ANALYSIS FOR ONL\u0130NE RETAIL DATA SET","894d7e68":"# ANALYSIS","5b0e57db":"### There are 135.080 NA values in Customer ID column and 1.454 NA values in Description column.","b886af2e":"## NA VALUES","6c0a30b9":"### Whole data value count is 397.925 and 354.345 of these data from UK. Nearly 90% of the data observations are from United Kingdom. ","654e9851":"## Description of data set\n* InvoiceNo: Invoice number. Nominal. A 6-digit integral number uniquely assigned to each transaction. **If this code starts with the letter 'c', it indicates a cancellation.**\n* StockCode: Product (item) code. Nominal. A 5-digit integral number uniquely assigned to each distinct product.\n* Description: Product (item) name. Nominal.\n* Quantity: The quantities of each product (item) per transaction. Numeric.\n* InvoiceDate: Invice date and time. Numeric. The day and time when a transaction was generated.\n* UnitPrice: Unit price. Numeric. Product price per unit in sterling (\u00c2\u00a3).\n* CustomerID: Customer number. Nominal. A 5-digit integral number uniquely assigned to each customer.\n* Country: Country name. Nominal. The name of the country where a customer resides.","02e2dd80":"As a result,\nIt seems that the Champion group is represented by 0. Their monetary and frequency values are higher than others and recency values are smaller.\n","62a20e3a":"# REPORTING","ca36fafb":"### I focused Customer ID and Invoice No then checked the price values.","715f4b9a":"### I used heatmap method.\n### I concluded that %10 of the observations which have NA for ID also have NA for Description.","ec8daad8":"## Are these NA Values are formed RANDOMLY?","e96eaabe":"## %24 of the dataset is missing. It so much.","b4174c9a":"## I checked Invoice values if it starts with \"c\" letter or not","ebee1e1d":"There are 1836 customers in this group.\n\n* Their last purchases was 52 days ago, meanly.\n* The frequency of the group's purchase mean is 3.2.\n* The mean of the total purchase for one person who is in this group is 1324 sterlin.","cb1309f5":"# RFM"}}