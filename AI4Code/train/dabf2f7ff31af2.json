{"cell_type":{"07c8dce4":"code","0784a5dc":"code","225388bd":"code","8b676026":"code","21387411":"code","abb541de":"code","0f3bb685":"code","9677aa49":"code","99d20708":"code","0792f131":"code","752196f3":"code","e0ccf76f":"code","2c20a128":"code","aebd9297":"code","f8b280bb":"code","2232c2b3":"code","0f1e4a9b":"code","c232d131":"code","2bd008c0":"code","20187cbe":"code","e8665830":"markdown","a59b3e37":"markdown","9f9e3c54":"markdown","a015a9f3":"markdown","a4991cbf":"markdown","273476f9":"markdown","01d366cc":"markdown","d3d00c33":"markdown","b8aa3faa":"markdown","68fdd3a9":"markdown"},"source":{"07c8dce4":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib","0784a5dc":"spx = pd.read_csv('..\/input\/sp-500-historical-data\/SPX.csv', parse_dates = [0])\nspx.head()","225388bd":"plt.plot(\n        matplotlib.dates.date2num(spx['Date']), \n        spx['Adj Close'],\n        color = 'k'\n)\n\n#Format x axis\nax = plt.gca()\nax.xaxis.set_major_locator(   matplotlib.dates.YearLocator(10) )\nax.xaxis.set_major_formatter( matplotlib.dates.DateFormatter('%Y') )\n\n#Format y axis\nplt.ylabel('SPX 500')\nplt.yscale('log')","8b676026":"spx_after_war = spx[ spx['Date'] > np.datetime64('1945') ]","21387411":"t     = matplotlib.dates.date2num(spx_after_war['Date'])\nlog_p = np.log10(spx_after_war['Adj Close'])\n\nfit   = np.polyfit(t, log_p, deg = 1)\n\ntypical_daily_appreciation  = fit[0]\ntypical_annual_appreciation = 10**(365*typical_daily_appreciation) - 1.\n\nprint(f'Typical daily appreciation is {100*typical_daily_appreciation:.2f}%')\nprint(f'Typical annual appreciation is {100*typical_annual_appreciation:.2f}%')","abb541de":"plt.plot(\n            matplotlib.dates.date2num(spx_after_war['Date']), \n            spx_after_war['Adj Close'],\n            color = 'k',\n            label = 'S&P 500'\n)\nplt.plot(\n            matplotlib.dates.date2num(spx_after_war['Date']), \n            10**(fit[0]*t + fit[1]),\n            color = 'r',\n            ls = '--',\n            label = 'Fit'\n)\n\nplt.legend()\n\nax = plt.gca()\nax.xaxis.set_major_locator(matplotlib.dates.YearLocator(10))\nax.xaxis.set_major_formatter(matplotlib.dates.DateFormatter('%Y'))\n\nplt.ylabel('SPX 500')\nplt.yscale('log')","0f3bb685":"daily_fractional_gain = spx_after_war['Adj Close'][1:].values \/ spx_after_war['Adj Close'][:-1].values - 1\n\nplt.hist(daily_fractional_gain, bins = 40, log = True)\nplt.xlabel('Daily fractional change');","9677aa49":"for pct in [1, 2, 5, 10]:\n    prob_daily_over_Xpct = sum( abs(daily_fractional_gain) > pct\/100 )\/len( daily_fractional_gain )\n    print(f'Probability of seeing {pct}+% daily change is {100*prob_daily_over_Xpct:.2f}%')","99d20708":"prob_daily_up = sum(daily_fractional_gain > 0)\/len(daily_fractional_gain)\nprint(f'Probability of market going up on a random day is {100*prob_daily_up:.1f}%')\n","0792f131":"spx_years = np.arange(1928, 2021)\nspx_at_beginning_of_the_year = np.array([\n    spx[spx.Date.dt.year == year]['Adj Close'].values[0]\n    for \n    year in spx_years\n])","752196f3":"spx_annual_gains = np.array([\n    spx_at_beginning_of_the_year[idx+1]\/spx_at_beginning_of_the_year[idx]-1\n    for \n    idx in range(len(spx_at_beginning_of_the_year)-1)\n])","e0ccf76f":"plt.hist(spx_annual_gains, 20)\nplt.title('Distribution of SPX 500 annual gains')\nplt.show()","2c20a128":"plt.bar(spx_years[:-1], spx_annual_gains)\nplt.ylabel('SPX annual gain')\nplt.title('Annual gains of SPX 500')\nplt.show()","aebd9297":"max_drop_ever = 0 #Will be negative\ndate_of_max_drop_ever = None\n\nfor idx in range(len(spx)):\n    #Assume we buy on the day's high and hold. What is the lowest we would see the price go?\n    buy_price    = spx['High'][idx]\n    lowest_price = np.min(spx['Low'][idx:])\n    max_drop     = lowest_price \/ buy_price - 1\n    if max_drop < max_drop_ever:\n        max_drop_ever         = max_drop\n        date_of_max_drop_ever = spx['Date'][idx].date()\n        \nprint(f'If we bought on {date_of_max_drop_ever} and held, we would at one point lost {-100*max_drop_ever:.0f}% of the initial investment')","f8b280bb":"gold = pd.read_csv('..\/input\/gold-prices\/monthly_csv.csv', parse_dates = [0])","2232c2b3":"#Allow pandas to process MS Excel files\n!pip install xlrd","0f1e4a9b":"from calendar import isleap #Check whether year is leap\nimport datetime\n\ndef decimal_year_to_datetime(year):\n    \"\"\"\n    Takes in a float such as 1980.45 and converts it into a date\n    \"\"\"\n    whole_year    = int(year)\n    residual      = year - whole_year\n    days_in_year  = 366. if isleap(whole_year) else 365.\n    residual_days = residual*days_in_year\n    \n    return datetime.datetime(year = whole_year, month = 1, day = 1) + datetime.timedelta(days = residual_days)","c232d131":"housing = pd.read_excel('..\/input\/housing-market-data-used-inirrational-exuberance\/House prices.xls', \n                        skiprows = 6,\n                        usecols = [0,8])\nhousing.columns = ['Date', 'Nominal Index']\nhousing['Date'] = [decimal_year_to_datetime(d) for d in housing['Date']]\nhousing.head()","2bd008c0":"russell2000 = pd.read_csv('..\/input\/russell-2000\/russell_2000.csv', parse_dates = [0])\nrussell2000.head()","20187cbe":"plt.plot(\n        matplotlib.dates.date2num(spx['Date']), \n        spx['Adj Close'],\n        color = 'k',\n        label = 'S&P 500'\n)\nplt.plot(\n        matplotlib.dates.date2num(gold['Date']), \n        gold['Price'],\n        color = 'orange',\n        label = 'Gold'\n)\nplt.plot(\n        matplotlib.dates.date2num(housing['Date']), \n        housing['Nominal Index'],\n        color = 'Green',\n        label = 'Housing'\n)\nplt.plot(\n        matplotlib.dates.date2num(russell2000['Date']), \n        russell2000['Close'],\n        color = 'Red',\n        label = 'Russel 2000'\n)\n\nplt.legend(loc = 2)\n\n#Format x axis\nax = plt.gca()\nax.xaxis.set_major_locator(   matplotlib.dates.YearLocator(20) )\nax.xaxis.set_major_formatter( matplotlib.dates.DateFormatter('%Y') )\n\n#Format y axis\nplt.ylabel('SPX 500')\nplt.yscale('log')","e8665830":"# S&P analysis","a59b3e37":"# Annual gains","9f9e3c54":"## Load libraries, data","a015a9f3":"## What is the maximal drop anyone ever suffered if holding indefinitely?","a4991cbf":"In this notebook we first look at historical gains of the Standard & Poor's 500 stock market index, especially after the second World War. Later we compare the gains from S&P 500 with other investments.","273476f9":"# Compare with other investments","01d366cc":"## Situation after the second world war","d3d00c33":"**We see a pronounced tail to negative gains.**","b8aa3faa":"## Distribution of daily gains","68fdd3a9":"## Price evolution since 1928"}}