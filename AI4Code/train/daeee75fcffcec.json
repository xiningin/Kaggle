{"cell_type":{"35d17c0e":"code","44758cea":"code","09dd3983":"code","56b428ae":"code","0931a0c0":"code","58e1e29f":"code","642cfca8":"code","4812ba93":"code","1a931b3f":"code","f1bb957a":"code","b35af790":"code","b5ccd9e2":"code","df451cad":"code","10b00e44":"code","ba5654b3":"code","bdedaf4d":"code","4fc63a19":"code","ac79bc1b":"markdown","ced1f879":"markdown","6da98a56":"markdown","c547d7d4":"markdown","5c2879f1":"markdown","cc79acb1":"markdown","1abcd66d":"markdown","190d7cbb":"markdown","8088a15c":"markdown","88e26403":"markdown","2d107179":"markdown","ea13924a":"markdown","1371ef68":"markdown","6c0ca846":"markdown"},"source":{"35d17c0e":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom datetime import datetime\nfrom statsmodels.graphics.gofplots import qqplot\nfrom IPython import display\nimport warnings\nwarnings.filterwarnings('ignore')\ndef clear():\n    display.clear_output(wait=True)\n    display.clear_output()    \nclear()\n\nimport requests\nfrom datetime import datetime\n\nclass  IFIX:\n    \n    def __init__(self):\n        self.indices = self.createIndices()\n        self.historical = self.createHistorical()\n        \n    def  remove_outliers(self, data):\n        Q1 = data.quantile(0.25)\n        Q3 = data.quantile(0.75)\n        IQR = Q3 - Q1\n        data = np.where(data>(Q3+1.5*IQR),(Q3+1.5*IQR),data)\n        data = np.where(data<(Q1-1.5*IQR),(Q1-1.5*IQR),data)\n        return data\n    \n    def create_indicators(self, data):\n        #Fibonacci 0,1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144,\n        #Cacl o MACD e sinal\n        #short - Exponetial Moving Avage - EMA \n        short_EMA = data.close.ewm(span=30,adjust=False).mean()\n        #long - Exponetial Moving Avage - EMA\n        long_EMA = data.close.ewm(span=60,adjust=False).mean()\n        #MACD line\n        macd = short_EMA - long_EMA\n        #MACD signal\n        signal = macd.ewm(span=5,adjust=False).mean()\n        data['monthly_ma'] = short_EMA\n        data['semiannually_ma'] = long_EMA\n        data['macd'] = macd\n        data['signal'] = signal\n        media = data['return'].rolling(30).mean()\n        media = media.fillna(0)\n        data['monthly_ma'] = media\n        return data\n    \n    def createHistorical(self):\n        ifix = pd.read_csv('..\/input\/d\/franckepeixoto\/ifixhistorical\/IFIX.SA.csv',squeeze=True, keep_default_na=False)\n        ifix.close = ifix.close.apply(lambda r: str(r).replace(\",\",\".\")).astype(np.float32)\n        ifix.open = ifix.open.apply(lambda r: str(r).replace(\",\",\".\")).astype(np.float32)\n        ifix['return'] = ifix['return'].apply(lambda r: str(r).replace(\",\",\".\")).astype(np.float32)\n        ifix['data'] = ifix['data'].apply(lambda x: datetime.strptime(x, '%d\/%m\/%Y'))\n        return self.create_indicators(ifix)\n    \n    def createIndices(self):\n        url = 'https:\/\/raw.githubusercontent.com\/franckepeixoto\/franckepeixoto.github.io\/master\/indices.json'\n        response = requests.get(url)\n        indices = response.json()\n        nomesSeries  = ['date']+indices[\"nomesSeries\"]\n        retorno_diario_indices = pd.DataFrame(columns=nomesSeries)\n        columns  = indices[\"nomesSeries\"]\n        #retorno_diario_indices \n\n        data_list = []\n        series_list = []\n        count = len(indices[\"datasGrafico\"])\n        for index in  range(count):\n            data = indices[\"datasGrafico\"][index][\"data\"]\n            data = datetime.fromtimestamp(float(data\/1000)).strftime('%d\/%m\/%Y')\n            serie = np.array(indices[\"datasGrafico\"][index][\"series\"])\n            data_list.append(data)\n            series_list.append(serie)\n        retorno_diario_indices['date'] = data_list\n        retorno_diario_indices[columns] = series_list\n        retorno_diario_indices[columns] = retorno_diario_indices[columns].astype(np.float32)\n        retorno_diario_indices['date'] = retorno_diario_indices['date'].apply(lambda x: datetime.strptime(x, '%d\/%m\/%Y'))\n        return retorno_diario_indices\nifix = IFIX()","44758cea":"plt.clf()\nclear()\nplt.figure(figsize=(30,5))\nsns.lineplot(x=ifix.historical['data'] , linestyle=\"-\", linewidth=3, y=np.log(ifix.historical['close']), color='blue')\nclear()\nplt.grid(True)\nplt.show()","09dd3983":"plt.clf()\nclear()\nplt.figure(figsize=(30,5))\nsns.lineplot(x=ifix.historical['data'] ,linestyle=\"-\", linewidth=3, y=np.log(ifix.historical['close'])             , color='blue')\n\nplt.title('How IFIX index reacted to important moments on the economy and politics?', size=16)\nplt.xlabel('Years', size=16)\nplt.ylabel('Price', size=16)\nplt.xticks(size=14)\nplt.yticks(size=14)\nsetup = dict(size = 21, color = \"black\")\n\nplt.text(\"2014-02-14\", np.log(1000),'Brazil faces a war against pessimism in the economy', **setup)\nplt.axvline(\"2014-02-14\", color='red'\n            , linestyle=\"-\"\n            , linewidth=3\n            , label='Brazil faces a war against pessimism in the economy')\n\n\nplt.text(\"2016-06-01\", np.log(3000),'Impeachment Dilma Rousseff', **setup)\nplt.axvline(\"2016-06-01\", color='green'\n            , linestyle=\"-\"\n            , linewidth=3\n            , label='Impeachment Dilma Rousseff')\n\nplt.text(\"2020-01-31\", np.log(2000),'Brazil approaches 160,000 deaths from coronaviruses', **setup)\nplt.axvline(\"2020-01-31\", color='orange'\n            , linestyle=\"-\"\n            , linewidth=3\n            , label='Brazil approaches 160,000 deaths from coronaviruses')\n\n\nclear()\nplt.grid(True)\nplt.show()","56b428ae":"ifix.historical.head()","0931a0c0":"# defyning the plotsize\nplt.figure(figsize=(10,7))\n\n# creating the plot to returns\nsns.lineplot(x='data'\n             ,y='return'\n             ,data=ifix.historical\n             ,label='daily returns'\n            ,color='lightgreen')\n\n# creating the plot to average returns\nsns.lineplot(x='data'\n             ,y='monthly_ma'\n             ,data=ifix.historical\n             ,label='monthly average returns'\n            ,color='blue')\n\n# setting title, labels and ticks parameters\nplt.title('IFIX index returns over the years', size=14)\nplt.xlabel('Years', size=14)\nplt.ylabel('Returns', size=14)\nplt.xticks(size=15)\nplt.yticks(size=15)\n\n# setting legend parameters\nplt.legend(loc = \"lower left\"\n           , frameon = True\n           , fontsize = 15\n           , ncol = 2 \n           , fancybox = True\n           , framealpha = 0.95\n           , shadow = True\n           , borderpad = 1);\nplt.grid(True)","58e1e29f":"returns_by_year = pd.DataFrame(round(ifix.historical['return'].groupby(ifix.historical.data.dt.year).sum()*100,2))\nreturns_by_year['pos_neg'] = returns_by_year>0\n\nplt.figure(figsize=(20,4))\nreturns_by_year[\"return\"].plot(kind='bar'\n                      , color=returns_by_year.pos_neg.map({True: 'forestgreen', False: 'red'})\n                      , label='return')\n\naverage_returns = np.mean(returns_by_year['return'])\n\nplt.axhline(y=average_returns, color='blue', linestyle='-', label='Average returns')\n\nplt.title('Acumulated returns by year vs average returns',size=14)\nplt.xlabel('Years',size=14)\nplt.ylabel('Acumulated in %',size=14)\nplt.yticks(np.arange(-40,170,step=10), size=15)\nplt.xticks(rotation=45, size=15)\n\nplt.legend(loc = \"upper right\"\n           , frameon = True\n           , fontsize = 13\n           , ncol = 2 \n           , fancybox = True\n           , framealpha = 0.95\n           , shadow = True\n           , borderpad = 1);\nplt.grid(True)","642cfca8":"data = returns_by_year['pos_neg'].value_counts().values.tolist()\npos_neg = pd.DataFrame(data=data,columns=['counts'],index=['positive','negative'])\n\n# difyning plot size\nplt.figure(figsize=(10,6))\n\n # here i use .value_counts() to count the frequency that each category occurs of dataset\npos_neg['counts'].plot(kind='pie'\n                       , colors=['lightgreen','lightgray']\n                       , autopct='%1.1f%%' # adding percentagens\n                       , shadow=True\n                       , startangle=140)\n\n# defyning title and legend parameters\nplt.title(\"What's the proportion of positive annual returns?\",size=14)\nplt.legend(loc = \"upper right\"\n           , frameon = True\n           , fontsize = 14\n           , ncol = 2 \n           , fancybox = True\n           , framealpha = 0.95\n           , shadow = True\n           , borderpad = 1);","4812ba93":"plt.clf()\nclear()\nplt.figure(figsize=(30,5))\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\", linewidth=10, y=(ifix.indices['SELIC']), color='blue')\nclear()\nplt.grid(True)\nplt.show()","1a931b3f":"ifix.indices[['date','SELIC']].tail()","f1bb957a":"plt.clf()\nclear()\nplt.figure(figsize=(30,5))\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\", linewidth=10, y=(ifix.indices['IPCA']), color='purple')\nclear()\nplt.grid(True)\nplt.show()","b35af790":"ifix.indices[['date','IPCA']].tail()","b5ccd9e2":"plt.clf()\nclear()\nplt.figure(figsize=(30,5))\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\", linewidth=10, y=(ifix.indices['CDI']), color='orange')\nclear()\nplt.grid(True)\nplt.show()","df451cad":"ifix.indices[['date','CDI']].tail()","10b00e44":"plt.clf()\nclear()\nplt.figure(figsize=(30,5))\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\", linewidth=10, y=(ifix.indices['IGP-M']), color='lightblue')\nclear()\nplt.grid(True)\nplt.show()","ba5654b3":"ifix.indices[['date','IGP-M']].tail()","bdedaf4d":"plt.clf()\nclear()\nplt.figure(figsize=(30,15))\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\",label=\"IFIX\", linewidth=5, y=(ifix.indices['IFIX']), color='black')\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\",label='IGP-M', linewidth=7, y=(ifix.indices['IGP-M']), color='green')\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\",label=\"CDI\", linewidth=13, y=(ifix.indices['CDI']), color='orange')\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\",label=\"IPCA\",linewidth=5, y=(ifix.indices['IPCA']), color='purple')\nsns.lineplot(x=ifix.indices['date'] , linestyle=\"-\",label=\"SELIC\",linewidth=5, y=(ifix.indices['SELIC']), color='blue')\n\n# defyning title and legend parameters\nplt.title(\"Daily return | IFIX x CDI x IPCA X SELIC x IGP-M\",size=25)\nplt.legend(loc = \"upper left\"\n           , frameon = True\n           , fontsize = 22\n           , ncol = 2 \n           , fancybox = True\n           , framealpha = 0.95\n           , shadow = True\n           , borderpad = 2);\nclear()\nplt.grid(True)\nplt.show()","4fc63a19":"ifix.indices","ac79bc1b":"#### Setup and load datasets","ced1f879":"#### CDI\n\n<IMG SRC='https:\/\/upload.wikimedia.org\/wikipedia\/commons\/thumb\/9\/90\/ANBIMA.svg\/1200px-ANBIMA.svg.png'  STYLE='float:right; width:100px'\/>\n\n\nThe CDI (Certificate of Interbank Deposit) is a very short-term security issued by banks. To some degree it resembles the **CBD**. This is because the **CDI** is also used by institutions to raise funds.","6da98a56":"thanks to [ @Wellington Silva](https:\/\/www.kaggle.com\/gatunnopvp)\n\n[Exploring Bovespa index(IBOV)](https:\/\/www.kaggle.com\/gatunnopvp\/exploring-bovespa-index-ibov-in-progress)\n\n**data source by** https:\/\/infofundos.com.br\/\n\n<IMG SRC='https:\/\/i.pinimg.com\/originals\/c1\/e2\/31\/c1e23101b8ae4e6536a6326b14dea06b.gif' \n     style=\"width:80px;float:right;\" \/>","c547d7d4":"### Approach\n\nMy focus here will be on visualizations to understand better this index and answer the following questions:\n\n<img src='https:\/\/images-2.wuaki.tv\/system\/shots\/197968\/original\/snapshot-1590666404.jpeg' style=\"float:right; width:250px\" \/>\n\n- How the index behave in important events in the local and international?\n- How are daily returns compared to average monthly returns?\n- Daily return - IFIX x CDI x IPCA X SELIC x IGP-M ?\n","5c2879f1":"# B3 index(IFIX)\n\n<img src=\"https:\/\/logospng.org\/download\/b3\/logo-b3-brasil-bolsa-balcao-256.png\"  style=\"float:left;position:absolute; top:10px; border:0px solid red; width:150px\"\/>\n<img src=\"https:\/\/i.pinimg.com\/originals\/dc\/8a\/02\/dc8a0226bd44d814ff526341e88f3d51.png\"  style=\"float:right; width:150px\"\/>\n\n","cc79acb1":"### continue...\n","1abcd66d":"### Exploratory Data Analysis\n\n#### How IFIX index reacted to important moments on the economy and politics?\n","190d7cbb":"#### Daily returns vs Average monthly returns\n\nLet's take a look into daily returns and compare then with the average monthly returns to understand how great falls or ups are mitigated when we compare with averages. ","8088a15c":"### Introduction\n\nThe IFIX is the result of a theoretical portfolio of assets, prepared in accordance with the criteria established in this methodology.\n\nB3 indices use procedures and rules contained in the B3 Indices Definitions and Procedures Manual.\n\n**objective**\nThe purpose of the IFIX is to be an indicator of the average performance of the prices of real estate funds traded on B3's stock exchange and organized over-the-counter markets.\n\n**index type**\nThe IFIX is a total return index (see B3 Index Definitions and Procedures Manual).\n\nE**ligible assets**\nThe IFIX comprises the shares of Real Estate Investment Funds listed on B3's stock exchange and over-the-counter markets.\n\n[B3 source](http:\/\/www.b3.com.br\/pt_br\/market-data-e-indices\/indices\/indices-de-segmentos-e-setoriais\/indice-de-fundos-de-investimentos-imobiliarios-ifix.htm)","88e26403":"#### SELIC\n\n<IMG SRC='https:\/\/upload.wikimedia.org\/wikipedia\/commons\/b\/b5\/Banco_Central_do_Brasil_logo.png'  STYLE='float:right; width:100px'\/>\n\n\nSelic is the economy's basic interest rate. It is the main instrument of monetary policy used by the **[Central Bank (BC)](https:\/\/www.bcb.gov.br\/controleinflacao\/taxaselic)** to control an issue. It influences all interest rates in the country, such as interest rates on loans, financing and financial investments.\n\n","2d107179":"<img src=\"https:\/\/i.pinimg.com\/originals\/1e\/93\/e9\/1e93e90925ca7620397c4cd80442e125.png\"  style=\"float:right; width:110px\"\/>\n\nThe Real Estate Investment Funds Index ([IFIX](http:\/\/www.b3.com.br\/pt_br\/market-data-e-indices\/indices\/indices-de-segmentos-e-setoriais\/indice-fundos-de-investimentos-imobiliarios-ifix-composicao-da-carteira.htm)) was launched on **September 3, 2012** by the former BM&F Bovepa, now [B3](http:\/\/www.b3.com.br).\n\nLike other stock market indices, it measures the performance of a theoretical asset portfolio, which is made up of Real Estate Investment Fund (**FII**) shares, which are mandatory in B3's stock and over-the-counter markets.\n\nAlthough its debut date was in **2012**, the index's profitability calculation incorporates values since **December 30, 2010**, providing a greater comparative horizon for investors in the variable income capital market.","ea13924a":"#### IPCA  \n\n<IMG SRC='https:\/\/s.concursosnobrasil.com.br\/media\/cache\/f\/concurso-ibge-2021-saiba-tudo-sobre-o-cargo-de-recenseador-960x540.jpg'  STYLE='float:right; width:100px'\/>\n\n\nThe National Consumer Price Index System \u2013 SNIPC continuously and systematically produces the **[Broad National Consumer Price Index \u2013 IPCA](https:\/\/www.ibge.gov.br\/estatisticas\/economicas\/precos-e-custos\/9256-indice-nacional-de-precos-ao-consumidor-amplo.html?=&t=o-que-e)**, which aims to measure the inflation of a set of products and services sold in retail, related to the personal consumption of families. This income range was created with the objective of guaranteeing coverage of 90% of families belonging to urban areas covered by the National System of Consumer Price Indexes - SNIPC.\n\nThis price index has as its collection unit commercial and service provision establishments, public service concessionaires and the internet and its collection extends, in general, from the 1st to the 30th of the reference month.","1371ef68":"#### IGP-M\n\n<IMG SRC='https:\/\/logovtor.com\/wp-content\/uploads\/2021\/01\/fgv-fundacao-getulio-vargas-logo-vector.png'  STYLE='float:right; width:100px'\/>\n\n\nThe General Price Index - Market (IGP-M) is released monthly by the Brazilian Institute of Economics of the **[Getulio Vargas Foundation (FGV IBRE)](https:\/\/portal.fgv.br\/noticias\/igp-m-resultados-2021).** In this space, all information regarding the publications of this important indicator will be published.","6c0ca846":"#### Daily return\n\nIFIX x CDI x IPCA X SELIC x IGP-M"}}