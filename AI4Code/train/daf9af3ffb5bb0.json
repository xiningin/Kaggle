{"cell_type":{"3eda061a":"code","2c9eb982":"code","9335c6dc":"code","95fba986":"code","fbce16f6":"code","cc6459f3":"code","59271260":"code","3a7e6532":"code","a8c67710":"code","19bef5c5":"code","efbe40dc":"code","80eda024":"code","49fda538":"code","c69440b0":"code","4d6bd4e3":"code","a62c04de":"code","a0122052":"code","2450b11c":"code","4e0fb81f":"code","e191c184":"code","622d8dc0":"code","0460d4f1":"code","f1fdc56a":"code","0c1a9b1e":"code","100393b0":"code","324537f0":"code","650bec0d":"code","e3bf10e4":"code","71bc0b7f":"code","c3d8e584":"code","f50a310e":"code","b4d1f5ba":"code","c3556b2b":"code","2aaa87d3":"code","1fc642b6":"code","08392a45":"code","a803a92b":"code","219d0a1a":"code","e5a16668":"code","97450c51":"code","026030a9":"code","1df1ca47":"code","c06e9197":"code","af33a7a4":"code","d2c607df":"markdown","ebaa2745":"markdown","4454394e":"markdown","a29e617d":"markdown","8f8a2f50":"markdown","cd351de4":"markdown","9533724a":"markdown","2c56f89c":"markdown","37ca9858":"markdown","d6b4c3f2":"markdown","633480e7":"markdown","bfea95bd":"markdown"},"source":{"3eda061a":"import numpy as np\nimport pandas as pd\nimport plotly.express as px\nimport plotly.graph_objects as go","2c9eb982":"!ls ..\/input\/data.csv","9335c6dc":"df = pd.read_csv('..\/input\/data.csv', parse_dates=[\"from_date\"])\n\n# list first few rows\ndf.head()","95fba986":"# check datatypes\ndf.dtypes","fbce16f6":"# check statistics of the features\ndf.describe()","cc6459f3":"print(df.isnull().sum())","59271260":"# minimum and maximum longitude\nmin_long = min(df.from_long.min(), df.to_long.min())\nmax_long = max(df.from_long.max(), df.to_long.max())","3a7e6532":"# minimum and maximum lattitude\nmin_lat = min(df.from_lat.min(), df.to_lat.min())\nmax_lat = max(df.from_lat.max(), df.to_lat.max())","a8c67710":"df.head()","19bef5c5":"df['count'] = 1","efbe40dc":"accesstoken = \"pk.eyJ1IjoidGFubWF5cGFuZGV5NyIsImEiOiJjazE4NDAyM3cwNTVtM210Y3FibnBuamhwIn0.yzvv5xRDq657q45CDihkeA\"","80eda024":"fig = go.Figure(go.Densitymapbox(lat=df.from_lat, lon=df.from_long, radius=10, \n                                 colorscale=[[0, 'rgb(255,255,0)'], [1, 'rgb(178,34,34)']]))\nfig.update_layout(mapbox_accesstoken=accesstoken)\nfig.update_layout(mapbox_style=\"streets\", mapbox_center_lon=77.6, mapbox_center_lat=13, \n                  mapbox_zoom=9.4)\nfig.update_layout(margin={\"r\":0,\"t\":0,\"l\":0,\"b\":0})\nfig.show()","49fda538":"by_area_id = df.groupby('from_area_id').count()['count'].sort_values(ascending = False).reset_index()\nby_area_id_top_10 = by_area_id[:10]\nby_area_id_top_10","c69440b0":"by_area_id_top_10.from_area_id.to_list()","4d6bd4e3":"lat_long_avg = df.groupby('from_area_id').mean()[['from_lat','from_long']].reset_index()\nlat_long_avg[lat_long_avg.from_area_id.isin(by_area_id_top_10.from_area_id.to_list())]","a62c04de":"fig = go.Figure(data=[go.Pie(labels=by_area_id_top_10['from_area_id'], values=by_area_id_top_10['count'],\n                            )])\nfig.update_layout(title_text='Top 10 Areas with Most Pickups in Bangalore')\nfig.show()","a0122052":"df['time'] = df.from_date.dt.time","2450b11c":"time_vs_count = df.groupby(\"time\").count()[\"count\"].reset_index()","4e0fb81f":"time_vs_count.rename(columns={\"user_id\": \"count\"}, inplace=True)","e191c184":"time_vs_count.head()","622d8dc0":"days_vs_count = df.groupby(\"from_area_id\").count()[\"count\"].reset_index()\ndays_vs_count.sort_values(\"count\", ascending=False, inplace=True)\ndays_vs_count.head(10)","0460d4f1":"area_time_count = df.groupby([\"from_area_id\",\"time\"]).count()[\"user_id\"].reset_index()\narea_time_count.sort_values(\"user_id\", ascending=False).head(10)","f1fdc56a":"area_time_count_no_outlier = area_time_count[area_time_count.from_area_id != 393.0]\narea_time_count_no_outlier.sort_values(\"time\", inplace=True)","0c1a9b1e":"area_time_count_outlier = area_time_count[area_time_count.from_area_id == 393.0]\narea_time_count_outlier.sort_values(\"user_id\", ascending=False).head(10)","100393b0":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=area_time_count_outlier.time, y=area_time_count_outlier.user_id, \n                         name=\"Total Kempegowda Pickups\",\n                         line_color='deepskyblue'))\n\n# fig.add_trace(go.Scatter(x=df.Date, y=df['AAPL.Low'], name=\"AAPL Low\",\n#                          line_color='dimgray'))\n\nfig.update_layout(title_text='Total Kempegowda Pickups',\n                  xaxis_rangeslider_visible=True)\nfig.show()","324537f0":"df.head()\n","650bec0d":"top_10_areas = by_area_id.from_area_id.to_list()\n","e3bf10e4":"area_time_count.head()\n","71bc0b7f":"area_time_count_20_no_airport = area_time_count.loc[(area_time_count.user_id>20) & \n                    (area_time_count.from_area_id!=393.0)].sort_values(by='time')","c3d8e584":"fig = px.scatter(area_time_count_20_no_airport, x=\"time\", y=\"user_id\",\n            size=\"user_id\", color=\"from_area_id\")","f50a310e":"fig.update_layout(title_text='Areas with total count>20 excluding Kempegowda',  xaxis_title=\"Time\", yaxis_title=\"Count\")\n","b4d1f5ba":"fig.show()\n","c3556b2b":"area_time_count_top_10 = area_time_count[area_time_count.from_area_id.isin(top_10_areas)]\n","2aaa87d3":"area_time_count_top_10 = area_time_count_top_10.sort_values(by=\"time\", ascending=True)\n","1fc642b6":"fig = px.scatter(area_time_count_top_10, x=\"time\", y=\"user_id\",\n            size=\"user_id\", color=\"from_area_id\"\n                 )\n\nfig.update_layout(title_text='Top 10 Popular Areas Pickups',  xaxis_title=\"Time\", yaxis_title=\"Count\")\nfig.show()","08392a45":"area_time_count_top_10.head()\n","a803a92b":"area_time_count_top_10_airport = area_time_count_top_10.loc[(area_time_count_top_10[\"user_id\"]>20) &  \n                                                       (area_time_count_top_10[\"from_area_id\"]==393)]","219d0a1a":"fig = px.scatter(area_time_count_top_10_airport, x=\"time\", y=\"user_id\",\n            size=\"user_id\", color=\"from_area_id\"\n                 )\nfig.update_layout(title_text='Kempegowda - Total Pickups > 20',  xaxis_title=\"Time\", yaxis_title=\"Count\", showlegend=False)\nfig.update_layout(showlegend=False)\n\nfig.show()","e5a16668":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=area_time_count_top_10_airport.time, y=area_time_count_top_10_airport.user_id, \n                         name=\"Total Kempegowda Pickups\",\n                         line_color='deepskyblue'))\n\nfig.update_layout(title_text='Kempegowda - Total Pickups > 20',\n                  xaxis_rangeslider_visible=True)\nfig.show()","97450c51":"area_time_count_top_10","026030a9":"area_time_count_top_10_others = area_time_count_top_10.loc[(area_time_count_top_10[\"user_id\"]>20) &  \n                                                       (area_time_count_top_10[\"from_area_id\"]!=393)]","1df1ca47":"area_time_count_top_10_others","c06e9197":"fig = px.scatter(area_time_count_top_10_others, x=\"time\", y=\"user_id\",\n            size=\"user_id\", color=\"from_area_id\")\nfig.update_layout(title_text='Total Pickups excluding Kempegowda')\nfig.show()","af33a7a4":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=area_time_count_top_10_others.time, y=area_time_count_top_10_others.user_id, \n                         name=\"Excluding Kempegowda - Total Pickups > 20\",\n                         line_color='green'))\n\n# fig.add_trace(go.Scatter(x=df.Date, y=df['AAPL.Low'], name=\"AAPL Low\",\n#                          line_color='dimgray'))\n\nfig.update_layout(title_text='Excluding Kempegowda - Total Pickups > 20',\n                  xaxis_rangeslider_visible=True)\nfig.show()","d2c607df":"Let's try to make a plot of count vs days of week.","ebaa2745":"Looks like area_id 393 is extremely popular. This seems to be the Kempegowda International Airport.\nThis behaves as an outlier in our data. We will try to seperate it from our current dataset.","4454394e":"Kempegowda Airport accounts for more than 1\/3rd of top 10 bookings. This seems to be an outlier in our data. We will focus on treating in seperately.","a29e617d":"These areas seem to get the most number of bookings. We will now try to group area by time and count.","8f8a2f50":"Let's see with Kempegowda Airport","cd351de4":"# Total Pickups excluding Kempegowda","9533724a":"# Total Number of Bookings by Area Id","2c56f89c":"A lot of destination columns like 'to_area_id', 'to_city_id', 'to_date' seem to be missing. I think it's not that important right now since we are focusing mainly on pickups.","37ca9858":"Note: recommendations based on total counts as counts over an year were not that meaningful.","d6b4c3f2":"There is a lot of noise from lower counts. We will try to include only counts > 20.\n\n\n\n\n\n\n","633480e7":"# Number of bookings by Area and Time","bfea95bd":"# A familiar map "}}