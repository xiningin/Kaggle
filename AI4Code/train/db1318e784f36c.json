{"cell_type":{"e91e9f1b":"code","2ab42ae2":"code","2fadd410":"code","9a6788cb":"code","2ed6b808":"code","38adf742":"code","7a105b55":"code","b83664d8":"code","2668f5cf":"code","6ca94981":"code","3084b588":"code","9896af15":"code","5e1b8b0c":"code","3dc12384":"code","d94af6e2":"code","1cf75276":"code","7b84091e":"code","58402bf7":"code","77f593c7":"code","1fc7075c":"code","4ba1feba":"code","bcbd339c":"code","0be5c2a7":"code","7231fb86":"code","50b28d98":"code","a40a85c6":"code","883a05fd":"code","3bfb6d87":"code","1fad2ff4":"code","87df25ec":"markdown","a8b435e9":"markdown","d9df6c59":"markdown","94def3be":"markdown"},"source":{"e91e9f1b":"import numpy as np \nimport pandas as pd\nfrom fastai.vision.all import *","2ab42ae2":"datadir = Path.cwd().parent \/ 'input' \/ 'street-view-getting-started-with-julia'\ndatadir.ls()","2fadd410":"output_dir = Path.cwd().parent\/'output'\/'working'\noutput_dir","9a6788cb":"file_extract(datadir\/\"train.zip\", dest=output_dir)\ntrain_image_dir = output_dir\/'train'","2ed6b808":"train_image_dir.ls()","38adf742":"train_labels = pd.read_csv(datadir\/\"trainLabels.csv\")","7a105b55":"train_labels.head()","b83664d8":"im = Image.open([f for f in train_image_dir.iterdir()][0])\nim.to_thumb(128,128)","2668f5cf":"fns = get_image_files(train_image_dir)\nfns","6ca94981":"failed = verify_images(fns)\nfailed","3084b588":"def label_func(fname):\n    the_id = int(re.findall(\"[0-9]+\",fname.name)[0])\n    label = train_labels.loc[train_labels['ID'] == the_id, \"Class\"].values.item()\n    return label","9896af15":"fns[0]","5e1b8b0c":"label_func(fns[0])","3dc12384":"db = DataBlock(\n    blocks=(ImageBlock, CategoryBlock), \n    get_items=get_image_files, \n    splitter=RandomSplitter(valid_pct=0.2, seed=42),\n    get_y=label_func,\n    item_tfms=Resize(128, method='squish'),\n    batch_tfms=aug_transforms(do_flip=False))","d94af6e2":"dls = db.dataloaders(train_image_dir)","1cf75276":"dls.show_batch(nrows=1, ncols=3)","7b84091e":"learn = cnn_learner(dls, resnet34, metrics=error_rate)","58402bf7":"lr_min,lr_steep = learn.lr_find()\nprint(f\"Minimum\/10: {lr_min:.2e}, steepest point: {lr_steep:.2e}\")","77f593c7":"learn.fine_tune(4, base_lr=1.32e-02)","1fc7075c":"interp = ClassificationInterpretation.from_learner(learn)","4ba1feba":"interp.most_confused(min_val=5)","bcbd339c":"file_extract(datadir\/\"test.zip\", dest=output_dir)\ntest_image_dir = output_dir\/'test'","0be5c2a7":"tst_files = get_image_files(test_image_dir)\ntst_files","7231fb86":"tst_dl = dls.test_dl(tst_files)","50b28d98":"def make_prediction(learn):\n    result = learn.get_preds(dl = tst_dl)\n    the_pred_num = np.argmax(result[0], axis=1)\n    the_pred_label = [learn.dls.vocab[i] for i in the_pred_num]\n    return the_pred_label","a40a85c6":"prediction = make_prediction(learn)\npred_ids = [int(re.findall(\"[0-9]+\", i.name)[0]) for i in tst_files] ","883a05fd":"df_pred = pd.DataFrame({\"ID\":pred_ids, \"Class\":prediction}).sort_values(\"ID\", ignore_index=True)","3bfb6d87":"df_pred.head()","1fad2ff4":"df_pred.to_csv(\"submission.csv\",index=False)","87df25ec":"## Make Prediction","a8b435e9":"## Load and Examine the Data","d9df6c59":"## Interpret the Model","94def3be":"## Build Data Block and Train Model"}}