{"cell_type":{"1e6ca9d9":"code","962bc9df":"code","b61aeb6d":"code","f595a798":"code","7c51ff80":"code","0749f287":"code","7d10a751":"code","ed2293a2":"code","34b6417d":"code","19308470":"code","610501a6":"code","fde5d2e8":"code","a2258d41":"code","ef4bc399":"code","4448586c":"code","c42b5c6a":"code","b453fe0f":"code","9b7ab432":"code","16fd3c78":"code","6fb2f92d":"code","d5efd01b":"code","c8e36e45":"code","9ce45500":"code","9dea89be":"code","3cc7b1eb":"code","56e1381a":"code","37b29da7":"code","c3ff00eb":"code","0ae1dffd":"code","ce807c45":"code","0287ae2b":"code","8e962181":"code","eb6b4844":"code","2d9e1e25":"code","50204b46":"code","dc509cab":"code","c25faeb1":"code","af072817":"code","274c5ba1":"code","f670c083":"code","181c056a":"code","ab17d1a8":"code","e17e8acf":"code","6164a0ea":"code","85a8d450":"code","a2f7df50":"code","b6ae227e":"code","161c9129":"code","365d239a":"code","ffedf30d":"code","ec68814c":"code","ca1dc97d":"code","d3097f69":"code","1564e5dc":"code","09c443b9":"code","9fc64021":"code","a3f98f02":"code","7f0cb037":"code","96c7f3f7":"code","5a3cd4d2":"code","97ae5489":"code","3718a6b5":"code","a0c7e192":"markdown","f23dff42":"markdown","630edbf4":"markdown","90510852":"markdown","d38fc778":"markdown","6f1e60d0":"markdown","a98e29ce":"markdown","4ae00ffa":"markdown","2f8493d7":"markdown","9e69fc2c":"markdown","ef87a1df":"markdown","00dd6728":"markdown","7939ee7a":"markdown","49b4ac93":"markdown","d925feb1":"markdown","c9efb1cd":"markdown","a522ae14":"markdown","731d304d":"markdown","4d549558":"markdown","ffc8b35c":"markdown","2b00aaf5":"markdown"},"source":{"1e6ca9d9":"%reset -f\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport os","962bc9df":"from imblearn.over_sampling import SMOTE, ADASYN","b61aeb6d":"from sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import  OneHotEncoder as ohe\nfrom sklearn.preprocessing import StandardScaler as ss\nfrom sklearn.compose import ColumnTransformer as ct","f595a798":"from xgboost.sklearn import XGBClassifier\nfrom sklearn.metrics import precision_recall_fscore_support","7c51ff80":"from sklearn.metrics import confusion_matrix\nfrom sklearn.metrics import average_precision_score\nimport sklearn.metrics as metrics\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.metrics import auc, roc_curve","0749f287":"os.chdir(\"..\/input\")\ncr = pd.read_csv(\"creditcard.csv\")","7d10a751":"cr.head()","ed2293a2":"cr.info()","34b6417d":"cr.describe()","19308470":"cr.shape","610501a6":"cr.columns.values","fde5d2e8":"cr.dtypes.value_counts()","a2258d41":"f, axes = plt.subplots(2, 2, figsize=(7, 7))\nsns.boxplot(x=\"Class\", y=\"Time\", data=cr, ax=axes[0, 0])\nsns.boxplot(x=\"Class\", y=\"V1\", data=cr, ax=axes[0, 1])\nsns.boxplot(x=\"Class\", y=\"V2\", data=cr, ax=axes[1, 0])\nsns.boxplot(x=\"Class\", y=\"V3\", data=cr, ax=axes[1, 1])\nplt.show()","ef4bc399":"cr.corr()\nsns.heatmap(cr.corr())","4448586c":"sns.countplot(x='Class', data=cr)","c42b5c6a":"(cr.isnull()).apply(sum, axis = 0)","b453fe0f":"y = cr.iloc[:,30]\nX = cr.iloc[:,0:30]","9b7ab432":"X.shape              ","16fd3c78":"X.columns","6fb2f92d":"y.head()","d5efd01b":"X_trans = ss().fit_transform(X)\nX_trans.shape","c8e36e45":"X_train, X_test, y_train, y_test =   train_test_split(X_trans,\n                                                      y,\n                                                      test_size = 0.3,\n                                                      stratify = y\n                                                      )\n\n\nX_train.shape        ","9ce45500":"xg = XGBClassifier(learning_rate=0.5,\n                   reg_alpha= 5,\n                   reg_lambda= 0.1\n                   )","9dea89be":"xg_imb = xg.fit(X_train,y_train)","3cc7b1eb":"y_pred_xg_imb = xg_imb.predict(X_test)","56e1381a":"y_pred_xg_imb_prob = xg_imb.predict_proba(X_test)","37b29da7":"accuracy_score(y_test,y_pred_xg_imb)","c3ff00eb":"confusion_matrix(y_test,y_pred_xg_imb)","0ae1dffd":"fpr_xg_imb, tpr_xg_imb, thresholds = roc_curve(y_test,\n                                 y_pred_xg_imb_prob[: , 1],\n                                 pos_label= 1\n                                 )","ce807c45":"p_xg_imb,r_xg_imb,f_xg_imb,_ = precision_recall_fscore_support(y_test,y_pred_xg_imb)","0287ae2b":"print(auc(fpr_xg_imb,tpr_xg_imb))","8e962181":"p_xg_imb,r_xg_imb,f_xg_imb,_ = precision_recall_fscore_support(y_test,y_pred_xg_imb)","eb6b4844":"p_xg_imb","2d9e1e25":"r_xg_imb","50204b46":"f_xg_imb","dc509cab":"fig = plt.figure(figsize=(12,10)) \nax = fig.add_subplot(111)\nax.plot([0, 1], [0, 1], ls=\"--\")   \nax.set_xlabel('False Positive Rate')  \nax.set_ylabel('True Positive Rate')\nax.set_title('ROC curve for XGB and Unbalanced data')\nax.set_xlim([0.0, 1.0])\nax.set_ylim([0.0, 1.0])\nax.plot(fpr_xg_imb, tpr_xg_imb, label = \"xgb\")\nax.legend(loc=\"lower right\")\nplt.show()","c25faeb1":"sm = SMOTE(random_state=42)\nX_res, y_res = sm.fit_sample(X_train, y_train)","af072817":"X_res.shape","274c5ba1":"y_res.shape","f670c083":"xg_res = xg.fit(X_res, y_res)","181c056a":"#Predict\ny_pred_xg_res = xg_res.predict(X_test)\ny_pred_xg_res","ab17d1a8":"y_pred_xg_res_prob = xg_res.predict_proba(X_test)\ny_pred_xg_res_prob","e17e8acf":"#Accuracy\nprint ('Accuracy using XGB and SMOTE',accuracy_score(y_test,y_pred_xg_res))","6164a0ea":"#Confusion Matrix\nconfusion_matrix(y_test,y_pred_xg_res)","85a8d450":"fpr_xg_res, tpr_xg_res, thresholds = roc_curve(y_test,\n                                 y_pred_xg_res_prob[: , 1],\n                                 pos_label= 1\n                                 )\n","a2f7df50":"#Precion, Recall and F1 Score\np_xg_res,r_xg_res,f_xg_res,_ = precision_recall_fscore_support(y_test,y_pred_xg_res)","b6ae227e":"p_xg_res,r_xg_res,f_xg_res","161c9129":"print ('AUC using XGB and SMOTE',auc(fpr_xg_res,tpr_xg_res))","365d239a":"fig = plt.figure(figsize=(12,10)) \nax = fig.add_subplot(111)\nax.plot([0, 1], [0, 1], ls=\"--\")   \nax.set_xlabel('False Positive Rate')  \nax.set_ylabel('True Positive Rate')\nax.set_title('ROC curve for XGB and SMOTE')\nax.set_xlim([0.0, 1.0])\nax.set_ylim([0.0, 1.0])\nax.plot(fpr_xg_res, tpr_xg_res, label = \"xgb\")\nax.legend(loc=\"lower right\")\nplt.show()","ffedf30d":"ad = ADASYN(random_state=42)\nX_ada, y_ada = sm.fit_sample(X_train, y_train)","ec68814c":"X_ada.shape","ca1dc97d":"y_ada.shape","d3097f69":"xg_ada = xg.fit(X_ada, y_ada)","1564e5dc":"y_pred_xg_ada = xg_ada.predict(X_test)\ny_pred_xg_ada","09c443b9":"y_pred_xg_ada_prob = xg_ada.predict_proba(X_test)\ny_pred_xg_ada_prob","9fc64021":"print ('Accuracy using XGB and ADASYN',accuracy_score(y_test,y_pred_xg_ada))","a3f98f02":"confusion_matrix(y_test,y_pred_xg_ada)","7f0cb037":"fpr_xg_ada, tpr_xg_ada, thresholds = roc_curve(y_test,\n                                 y_pred_xg_ada_prob[: , 1],\n                                 pos_label= 1\n                                 )","96c7f3f7":"p_xg_ada,r_xg_ada,f_xg_ada,_ = precision_recall_fscore_support(y_test,y_pred_xg_ada)","5a3cd4d2":"p_xg_ada,r_xg_ada,f_xg_ada","97ae5489":"print ('AUC using XGB and ADASYN',auc(fpr_xg_ada,tpr_xg_ada))","3718a6b5":"fig = plt.figure(figsize=(12,10))        \nax = fig.add_subplot(111)\nax.plot([0, 1], [0, 1], ls=\"--\")\nax.set_xlabel('False Positive Rate')\nax.set_ylabel('True Positive Rate')\nax.set_title('ROC curve for XGB and ADASYN')\nax.set_xlim([0.0, 1.0])\nax.set_ylim([0.0, 1.0])\nax.plot(fpr_xg_ada, tpr_xg_ada, label = \"xgb\")\nax.legend(loc=\"lower right\")\nplt.show()","a0c7e192":"####  Credit Card Fraud - Working with unbalanced dataset","f23dff42":"*As we can below the X_res and y_res are having same number of rows, that means we have balanced the data*","630edbf4":"<font color=blue>SMOTE-Balancing the data<\/font>","90510852":"_Explore data_","d38fc778":"<font color=blue>ADASYN-Balancing the data<\/font>","6f1e60d0":"_ROC Curve_","a98e29ce":"_Processing data_","4ae00ffa":"_Fit the data_","2f8493d7":"_Call Modeling module, we will be using XBG for modeling._","9e69fc2c":"_Just check any columns have missing data_","ef87a1df":"_Read data_","00dd6728":"_XGB Classifier_","7939ee7a":"_Split data into train\/test_     ","49b4ac93":"_Fit and transform_","d925feb1":"__Credit Card Fraud dataset__\n\n================================\n\nThe datasets contains transactions made by credit cards in September 2013 by European cardholders. This dataset presents transactions that occurred in two days, where we have 492 frauds out of 284,807 transactions. The dataset is highly unbalanced, the positive class (frauds) account for 0.172% of all transactions.\n\nIt contains only numerical input variables which are the result of a PCA transformation. Due to confidentiality issues, original features and more background information about the data can't be provided. Features V1, V2, ... V28 are the principal components obtained with PCA, the only features which have not been transformed with PCA are 'Time' and 'Amount'. Feature 'Time' contains the seconds elapsed between each transaction and the first transaction in the dataset. The feature 'Amount' is the transaction Amount, this feature can be used for example-dependant cost-senstive learning. Feature 'Class' is the response variable and it takes value 1 in case of fraud and 0 otherwise.","c9efb1cd":"_for ROC graphs & metrics_","a522ae14":"_Separation into target\/predictors_","731d304d":"_Import SMOTE AND ADASYN to balance the dataset_","4d549558":"<font color=blue>Modelling<\/font>","ffc8b35c":"__Call libraries__","2b00aaf5":"_ploting_"}}