{"cell_type":{"3aee08f3":"code","5c16204d":"code","707862d3":"code","594bdb62":"code","f6f1386b":"code","39fc2f24":"code","c5ee81cb":"code","d5d0856f":"code","003232eb":"code","0f787343":"code","28fb299e":"code","393e47b4":"code","264d0277":"code","b8f8a3ff":"code","f870ae51":"code","0a9ac990":"markdown","c94a5a1e":"markdown","bafbc12c":"markdown","a5ee7994":"markdown","c30ded25":"markdown","47b3dcf3":"markdown","cd66f85d":"markdown","26fb5f5e":"markdown","0ce9210c":"markdown","64dafd58":"markdown","594e755b":"markdown","413d9a01":"markdown"},"source":{"3aee08f3":"from IPython.display import display\nimport pandas as pd\ncovid_data = pd.DataFrame(pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/covid_19_data.csv'))\nindiv_list = pd.DataFrame(pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/COVID19_line_list_data.csv'))\nopen_list = pd.DataFrame(pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/COVID19_open_line_list.csv'))\nconfirmed_US = pd.DataFrame(pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_confirmed_US.csv'))\nconfirmed = pd.DataFrame(pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_confirmed.csv'))\ndeaths_US = pd.DataFrame(pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_deaths_US.csv'))\ndeaths = pd.DataFrame(pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_deaths.csv'))\nrecovered = pd.DataFrame(pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_recovered.csv'))\n \n\n# Check tail for most recent date\ndisplay(confirmed.tail())\n# Define dates for time series\ndates = confirmed.columns[4:]\n\n#  Getting the data into a dataframe\ndef country_row(df,cs):\n    return df[df['Country\/Region']==cs]\n\ncountry_row(confirmed,\"Singapore\")","5c16204d":"# Worldwide count\nimport matplotlib.pyplot as plt \n# import matplotlib.dates as mdates\n# Extract dates from one of the time series and Sum over each date value\nconfirmed_cases = confirmed.sum()\ndeaths_cases = deaths.sum()\nrecovered_cases = recovered.sum()\n\n## Adjust plotting style \nplt.style.use('fivethirtyeight')\nfig, ax = plt.subplots(figsize=(12, 8))\n# Plot the cases over extracted dates # dates = recovered.iloc[:,4:].columns\nactive_cases = confirmed_cases[dates]- deaths_cases[dates]-recovered_cases[dates]\nplt.plot(dates, confirmed_cases[dates].values.T)\nplt.plot(dates,active_cases[dates].values.T) # active cases \nplt.plot(dates, recovered_cases[dates].values.T)\nplt.plot(dates, deaths_cases[dates].values.T)\n\n# add nice label settings \nscale = 30 # scale text font and dates \nplt.xlabel('Dates', size=scale)\nplt.ylabel('Number of Cases', size=scale)\nplt.yticks(size=scale*2\/3)\nplt.title('Worldwide Count', size=20)\nplt.legend(['Confirmed', 'Active', 'Recovered', 'Deaths'], prop={'size': scale*2\/3}, bbox_to_anchor=(0.25, 1))\n\n## How to better see x labels\nx_ticks = range(0,dates.size, 20) # 97\/8 ~= 12 slices = 13 values\nplt.xticks(x_ticks,size=scale*2\/3)\nplt.gcf().autofmt_xdate()","707862d3":"# Adding that extra work into the plotting function \ndef plotting_covid(dates,country,text_scale):\n  import matplotlib.dates as mdates\n  # Extracting the row information\n  confirmed_cases = country_row(confirmed,country) \n  deaths_cases = country_row(deaths,country) \n  recovered_cases = country_row(recovered,country) \n  x = len(confirmed_cases); y = len(deaths_cases); z = len(recovered_cases)\n  if x == y == z == 1:\n    confirmed_cases = country_row(confirmed,country) \n    deaths_cases = country_row(deaths,country) \n    recovered_cases = country_row(recovered,country)    \n  elif x == y == z > 1: \n    # Aggregate data \n    confirmed_cases = country_row(confirmed,country).sum()\n    deaths_cases = country_row(deaths,country).sum()\n    recovered_cases = country_row(recovered,country).sum() \n  else:\n      print(\"Error: row sizes are not equal\")\n  \n  # Calculate the number of active cases [Problem: cannot subtract rows easily because some row numbers are different]\n  active_cases=confirmed_cases[dates].values.T-deaths_cases[dates].values.T-recovered_cases[dates].values.T\n  \n  # Plotting data\n  plt.plot(dates, confirmed_cases[dates].values.T)\n  plt.plot(dates,active_cases) # active cases \n  plt.plot(dates, recovered_cases[dates].values.T)\n  plt.plot(dates, deaths_cases[dates].values.T)\n  plt.xlabel('Dates', size=text_scale)\n  plt.ylabel('Number of Cases', size=text_scale)\n  plt.legend(['Confirmed', 'Active', 'Recovered', 'Deaths'], prop={'size': scale*2\/3}, bbox_to_anchor=(0.6, 1))\n  plt.yticks(size=scale*2\/3)\n  # How to better see x labels\n  plt.xticks(size=scale*2\/3)\n  x_ticks = range(0,dates.size,round(text_scale)) # 97\/8 ~= 12 slices = 13 values\n  plt.xticks(x_ticks)\n  plt.gcf().autofmt_xdate()\n","594bdb62":"# Top five countries + Australia\nCountries = confirmed.sort_values(by=[dates[-1]], ascending=False).head()['Country\/Region']\nCountries = [str(c) for c in Countries ]\nCountries.append('Australia')\n# Countries.append('Singapore')\n# Plot Australia with top 5 countries with most confirmed cases \n# fig, ax = plt.subplots(2, 3, sharex='col', sharey='row',figsize=(15, 12))\nscale = 20;\nfig = plt.figure(figsize=(15,10))\nfig.subplots_adjust(hspace=0.2, wspace=0.5)\nfor i in range(1,7): # 6 countries\n    ax = fig.add_subplot(2, 3, i)\n    country = Countries[i-1]\n    ax.title.set_text(Countries[i-1])\n    plotting_covid(dates, country, scale)","f6f1386b":"# 1. Calculate the number of active cases over time for each country\n# 2. Find countries (top 10) with large descreasing trend in active cases \n# 3. Find countries (top 10) with exponential growth in COVID cases\n### 1. Calculate the number of active cases over time for each country\ndf_active = pd.DataFrame([],columns = dates)\nrecorded_country = []\nfor country in confirmed['Country\/Region'].unique():\n  # Extracting the row information\n  confirmed_cases = country_row(confirmed,country) \n  deaths_cases = country_row(deaths,country) \n  recovered_cases = country_row(recovered,country) \n  x = len(confirmed_cases); y = len(deaths_cases); z = len(recovered_cases)\n  if x == y == z == 1:\n    confirmed_cases = country_row(confirmed,country) \n    deaths_cases = country_row(deaths,country) \n    recovered_cases = country_row(recovered,country) \n    # record country \n    recorded_country.append(country)  \n    # calculate active cases and put in data frame \n    data = confirmed_cases[dates].values.T-deaths_cases[dates].values.T-recovered_cases[dates].values.T\n    data = pd.DataFrame(data).transpose()\n    data.columns=dates\n    df_active=df_active.append(data)  \n  else:\n    # Aggregate data \n    confirmed_cases = country_row(confirmed,country).sum()\n    deaths_cases = country_row(deaths,country).sum()\n    recovered_cases = country_row(recovered,country).sum() \n    # record country\n    recorded_country.append(country)\n    # calculate active cases and put in data frame \n    data = confirmed_cases[dates].values.T-deaths_cases[dates].values.T-recovered_cases[dates].values.T\n    data = pd.DataFrame(data).transpose()\n    data.columns=dates\n    df_active = df_active.append(data) \n\n# Insert country names\ndf_active.insert(0, 'Country\/Region',recorded_country)\ndf_active.head()","39fc2f24":" # Plotting function\ndef plot_active(df,country_list,title,scale):\n  fig, ax = plt.subplots(figsize=(14, 10))\n  for i in range(len(country_list)): # 6 countries\n    country = country_list[i]\n    active_cases =  df[df['Country\/Region']==country]\n    plt.plot(dates,active_cases[dates].values.T) # active cases \n  plt.xlabel('Dates', size=text_scale)\n  plt.ylabel('Number of Cases', size=text_scale)\n  plt.legend(country_list, prop={'size': scale*2\/3},bbox_to_anchor=(1.2, 1))\n  plt.yticks(size=scale*2\/3)\n  plt.title(title)\n  # How to better see x labels\n  plt.xticks(size=scale*2\/3)\n  x_ticks = range(0,dates.size,round(text_scale)) # 97\/8 ~= 12 slices = 13 values\n  plt.xticks(x_ticks)\n  plt.gcf().autofmt_xdate()\n  plt.show()","c5ee81cb":"display(\"Data Format for matplotlib\",df_active.head())\ndft =df_active.iloc[:,1:].transpose()\ncountry_list = confirmed['Country\/Region'].unique()\ndft.columns= [ str(cl) for cl in country_list] \ndft['Dates'] = dft.index\n# display(\"Data Format for plotly\",dft.head())\ndf_melt = pd.melt(dft, id_vars=\"Dates\", value_vars=dft.columns[:-1])\ndisplay(\"Melting data for plotly\",df_melt)","d5d0856f":"df_covid = covid_data\ndf_covid['Active'] = df_covid['Confirmed'] - df_covid['Deaths'] - df_covid['Recovered']\ndf_covid = df_covid.groupby(['Country\/Region','ObservationDate'],as_index=False).sum()\ndf_covid.tail()\n# fig = px.line(df_covid[df_covid[\"Country\/Region\"]==country], x=\"ObservationDate\", y=\"Active\", color='Country\/Region')","003232eb":"import plotly.express as px \nimport pandas as pd \nimport numpy as np \ndef plotly_active(df_active,CL,title):\n    dft = df_active.iloc[:,1:].transpose()\n    country_list = df_active['Country\/Region']\n    dft.columns = [ str(cl) for cl in country_list] \n    dft['Dates'] = dft.index\n    df_melt = pd.melt(dft, id_vars=\"Dates\", value_vars = dft[CL])\n    fig = px.line(df_melt, x=\"Dates\", y=\"value\", color='variable')\n    xnum = [num for num in range(0,len(dates),20)]\n    xnum.append(len(dates)-1)\n    fig.update_layout(title={\n        'text': title,\n        'y':0.95,\n        'x':0.5,\n        'xanchor': 'center',\n        'yanchor': 'top'},\n        yaxis_title=\"Number of Active Cases\",\n        xaxis = dict(\n            tickmode = 'array',\n            tickvals = xnum,\n            ticktext = dates[xnum]\n        )\n    )\n    fig.show()","0f787343":"from datetime import datetime\n# check month... easier  \ndf4 = df_active[dates].apply(pd.to_numeric, errors='coerce')\ncheck_dates = df4.idxmax(axis=1).values\ndate_num = []\nfor d in check_dates:\n    datee = datetime.strptime(d, \"%m\/%d\/%y\")\n    date_num.append(datee.month)\ndate_num\n\n\n#FEB\ndf5 = pd.DataFrame({'Country\/Region':country_list,'PeakMonth':date_num})\n# Countries that peaked in Feb\ndff = df5.loc[(df5['PeakMonth']==2) ]#| (df5['PeakMonth']==3) ,:]\n# display(dff)\nstr(dff['Country\/Region'].values)\nCL = [str(el) for el in dff['Country\/Region'].values ]\n# plot_active(df_active,CL,\"Countries with COVID Peak in Feb\",20)\n\ndisplay(\"1. SELECT AREA to zoom in\")\ndisplay(\"2. RESET AXES button\")\nplotly_active(df_active,CL,\"Countries with COVID Peak in Feb\")\nlen(dff)\ndff.shape","28fb299e":"# MAR \ndf5 = pd.DataFrame({'Country\/Region':country_list,'PeakMonth':date_num})\n# Countries that peaked in Feb\ndff = df5.loc[df5['PeakMonth']==3,:]\n# display(dff)\nstr(dff['Country\/Region'].values)\nCL = [str(el) for el in dff['Country\/Region'].values ]\ndisplay(\"1. HOVER over data points\")\ndisplay(\"2. ZOOM IN button and PAN to move\")\ndisplay(\"3. AUTOSCALE button also resets axes \")\n\nplotly_active(df_active,CL,\"Countries with COVID Peak in Mar\")\n","393e47b4":"#APR\ndf5 = pd.DataFrame({'Country\/Region':country_list,'PeakMonth':date_num})\n# Countries that peaked in Feb\ndff = df5.loc[df5['PeakMonth']==4,:]\n# display(dff)\nstr(dff['Country\/Region'].values)\nCL = [str(el) for el in dff['Country\/Region'].values ]\n# plot_active(df,cnames,\"Countries with COVID Peak in April\",20)\ndisplay(\"1. DOUBLE CLICK curves of interest\")\ndisplay(\"2. Then CLICK to add other curves\")\ndisplay(\"3. DOUBLE CLICK to reset\")\nplotly_active(df_active,CL,\"Countries with COVID Peak in Apr\")\ndff.shape","264d0277":"#MAY \ndf5 = pd.DataFrame({'Country\/Region':country_list,'PeakMonth':date_num})\n# Countries that peaked in Feb\ndff = df5.loc[df5['PeakMonth']==5,:]\n# display(dff)\nstr(dff['Country\/Region'].values)\nCL = [str(el) for el in dff['Country\/Region'].values ]\n# plot_active(df,cnames,\"Countries with COVID Peak in May\",20)\nplotly_active(df_active,CL,\"Countries with COVID Peak in May\")","b8f8a3ff":"#MAY \ndf5 = pd.DataFrame({'Country\/Region':country_list,'PeakMonth':date_num})\n# Countries that peaked in Feb\ndff = df5.loc[df5['PeakMonth']==6,:]\n# display(dff)\nstr(dff['Country\/Region'].values)\nCL = [str(el) for el in dff['Country\/Region'].values ] \nplotly_active(df_active,CL,\"Countries with COVID Peak in Jun\")","f870ae51":"#MAY \ndf5 = pd.DataFrame({'Country\/Region':country_list,'PeakMonth':date_num})\n# Countries that peaked in Feb\ndff = df5.loc[df5['PeakMonth']==7,:]\n# display(dff)\nstr(dff['Country\/Region'].values)\nCL = [str(el) for el in dff['Country\/Region'].values ] \nplotly_active(df_active,CL,\"Countries with COVID Peak in Jul\")","0a9ac990":"\n### Compare top five countries with highest COVID count and compare it to Australia (I'm from OZ, that's why!)\n- Examine confirmed, active, recorded, deaths in SIX plots","c94a5a1e":"### Talk to me! \n- e-mail: eddie_toth@hotmail.com\n- Add me on: https:\/\/www.linkedin.com\/in\/edward-toth\/ \n- Join the community: https:\/\/www.meetup.com\/Get-Singapore-Meetup-Group\/","bafbc12c":"### Plot nature of COVID cases for different countries\n- Similar to the code for the worldwide count but you don't `sum` up values\n- Some countries are recorded by state, region or province. Thus there are multiple values recorded in some countries.\n- Solution: aggregate the cases of confirmed, recovered, deaths and active cases over the different regions of the country. ","a5ee7994":"Alternatively use `covid_data` and sum up the counts for each country but I don't like the messy country labels like \"('St. Martin',)\" or occupied Palestinian territory. So I choose to use the combined time series data. ","c30ded25":"Awesome!\nThese visualization tool can help you understand the spread of COVID in different countries. \n## Summary\n- pandas: different plots, labels, ticks \n- matplotlib: subplots, function\n- plotly: requires specific data frame, melt, awesome interactive features \n\n\n\n\n","47b3dcf3":"Using `matplotlib` vs. `plotly` for multiple line plots: \n- `matplotlib`: data frame with one country column and dates as new columns\n- `plotly`: data frame with one date column and each country as new columns\n- `plotly`: In this way you can merge data with `melt`","cd66f85d":"Interpretation\n- After around mid-March, worldwide confirmed cases of COVID virius are expontentially rises \n- Out of those confirmed cases; most are active, a large proportion have recovered and a smaller proportion are deaths. \n\n### Examine Specific Countries\n- Note that we are using three different files (confirmed, recovered, deaths)\n- Check if data frames are consistent with indices (BUT they're not!)\n- Use `IPython.display` for a nicer print out","26fb5f5e":"# COVID Data Visualization - Part 1\n[Edward Toth, PhD, University of Sydney]\n\n- e-mail: eddie_toth@hotmail.com\n- Add me on: https:\/\/www.linkedin.com\/in\/edward-toth\/ \n- Join the community: https:\/\/www.meetup.com\/Get-Singapore-Meetup-Group\/\n\nUsing different data visualization tools, we attempt to understand the spread of COVID through pretty pictures. In these tutorials you learn more about:\n- the spread of COVID\n- explore the following Python libraries for visualizing data\n\n__PART 1:__\n\n    - pandas (quick plots for data frames\/series)\n    - matplotlib (basic plotting library in Python)\n    - plotly (interactive plots)\n    \n\n<!-- ggplot (follows `R`'s ggplot2, concepts from 'The Grammar of Graphics'), web-based plot for dash, Gleam (inspired by R's Shiny package for interactive plotting apps) -->\n  \nFor more detail on data visualization libraries: https:\/\/mode.com\/blog\/python-data-visualization-libraries\/\n\nDataset from: \nhttps:\/\/www.kaggle.com\/sudalairajkumar\/novel-corona-virus-2019-dataset\n- 8 `.csv` files\n- records of confirmed cases, death and recovered patients\n- Short description of patients (gender, age, location, etc.)\n\n## In Part 1 of Visualizing COVID\nWe will visualize data mainly from:\n- `time_series_covid_19_confirmed.csv`\n- `time_series_covid_19_deaths.csv` \n- `time_series_covid_19_recovered.csv`","0ce9210c":"## NOT THE END, Just the beginning\n# Part 2 NEXT WEEK:\n- missingno\n- plotly\n\n","64dafd58":"Interpretation\n- Confirmed and active cases are growing exponentially in US, UK, Russia\n- The active cases have a downturn (decreasing COVID cases) in Spain, Italy, Australia\n- The active curve for Australia is similar to the COVID world count website\nhttps:\/\/www.worldometers.info\/coronavirus\/country\/australia\/\n### Let's examine the active cases more closely\n\n\n\n\n## Examine Active Cases using `plotly`\n- Great for interactive graphs (line graphs, contour plots, 3D charts, etc.)\n- Also available in R and you can access `plotly`, an online platform for visualizing data offer \n- Examining the nature of active cases\n\n### Simple analysis: \nWhich month (Feb, Mar, Apr, May)  does the the maximum value occurs?\n- If max occurs in Feb, Mar then early flattening of active curve\n- If max occurs Apr then COVID cases are beginning to decrease \n- If max occurs in May then COVID is still a problem\n\n### Advanced analysis (if you're bothered):\n- SIR epidemic models\n- Polynomial fits \n- Regression prediction\n- Use calculus find turning points \n","594e755b":"# matplotlib\nTime series data is easily plottled using `matplotlib`\n- `time_series_covid_19_confirmed.csv`, `time_series_covid_19_deaths.csv` and `time_series_covid_19_recovered.csv`. \n- Also calculate the active cases with the formula:\n\n`[Active] = [Confirmed] - [Recovered] - [Deaths`]\n\n\n\nTo visualize worldwide data over time using `matplotlib`:\n1. Sum up counts over all countries \n- Calculate the active cases\n- Plot confirmed, recovered, deaths and active cases over time [on same figure]\n- Modify labels, title, legend","413d9a01":"Just created a new data frame containing the active cases over time for each country. WOHOOOO!\n\n- Then create a plotting function similar to before"}}