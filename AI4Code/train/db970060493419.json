{"cell_type":{"bebec20a":"code","45152f18":"code","9619ce7d":"code","2dd05f6f":"code","969e8ec3":"code","896a191b":"code","4c476bd8":"code","53a85ac1":"code","2d600929":"code","8a7d0f7a":"code","04a6e0a3":"markdown"},"source":{"bebec20a":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport plotly.plotly as py\nimport pandas as pd\nimport plotly.graph_objs as go\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\ninit_notebook_mode(connected=True)    #THIS LINE IS MOST IMPORTANT AS THIS WILL DISPLAY PLOT ON \n#NOTEBOOK WHILE KERNEL IS RUNNING\n\nimport seaborn as sns\nimport datetime\n\nimport datetime as DT\n\n#Validator\nimport sys\n!{sys.executable} -m pip install csvvalidator\nimport sys\nimport csv\nfrom csvvalidator import *\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\nimport os\nprint(os.listdir(\"..\/input\"))\n\npd.set_option('display.float_format', lambda x: '%.3f' % x)\ndf = pd.read_csv('..\/input\/parking-citations.csv', low_memory=False)\n# Any results you write to the current directory are saved as output.","45152f18":"#Validate data\nfield_names = (\n               'Ticket number',\n               'Issue Date',\n               'Latitude',\n               'Longitude',\n               'Issue time',\n               'Violation Description'\n               )\nvalidator = CSVValidator(field_names)\n# basic header and record length checks\nvalidator.add_header_check('EX1', 'bad header')\nvalidator.add_record_length_check('EX2', 'unexpected record length')","9619ce7d":"#checking Issue Date format\nassert False not in df['Issue Date'].str.match(r\"^[\\d]{4}-[\\d]{2}-[\\d]{2}T.*$\").values\nprint('Issue Date is OK')\n\n#violation Description\nassert pd.api.types.is_string_dtype(df['Violation Description'])\nprint('Violation Description is OK')\n\n#ticket number\nassert pd.api.types.is_string_dtype(df['Ticket number'])\nprint('Ticket number is OK')\n\n#Lat\/Lon\nassert pd.api.types.is_float_dtype(df['Latitude'])\nprint('Latitude is OK')\nassert pd.api.types.is_float_dtype(df['Longitude'])\nprint('Longitude is OK')\n\n#Issue Time\nassert pd.api.types.is_float_dtype(df['Issue time'])\nprint('Issue time is OK')","2dd05f6f":"#updating formatting so that I can translate issue date to datetime\ndf['Issue Date'] = df[df['Issue Date'].notnull()]['Issue Date'].apply(lambda x: x.split('T')[0])\ndf['Issue Date'] = pd.to_datetime(df['Issue Date'], infer_datetime_format=True)\n\n#limiting dataset so it's easy to work with\ntoday = pd.Timestamp('today').normalize()\nweek_ago = today - DT.timedelta(days=7)\nmonth_ago = today - DT.timedelta(days=30)\ndf = df[df['Issue Date']>=month_ago]","969e8ec3":"#pad anything that is less than 4 digits then isolate just the hours\ndf['Issue time'] = df['Issue time'].astype(str)\ndf['Issue time'] = df['Issue time'].apply(lambda x: x.split('.')[0])\ndf['Issue time'] = df[df['Issue time'].notnull()]['Issue time'].apply(lambda x: x.zfill(4))\ndf['Issue Hour'] = df[df['Issue time']!='0nan']['Issue time'].apply(lambda x: DT.datetime.strptime(x,'%H%M').hour)\n\n#clean lat lon\ndf['Latitude'] = np.where(df['Latitude']==99999.000, np.nan, df['Latitude'])\ndf['Longitude'] = np.where(df['Longitude']==99999.000, np.nan, df['Longitude'])\n\n#string for ticketnum\ndf['Ticket number'] = df['Ticket number'].astype(str)","896a191b":"#Updating the Lat Lon\nimport pyproj\npm = '+proj=lcc +lat_1=34.03333333333333 +lat_2=35.46666666666667 +lat_0=33.5 +lon_0=-118 +x_0=2000000 +y_0=500000.0000000002 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs'\nx1m,y1m = df['Latitude'].values, df['Longitude'].values\nx2m,y2m = pyproj.transform(pyproj.Proj(pm,preserve_units = True), pyproj.Proj(\"+init=epsg:4326\"), x1m,y1m)\ndf['Latitude']=x2m\ndf['Longitude']=y2m","4c476bd8":"import folium\n\nLA_COORDINATES = (34.05, -118.24)\n\n# create empty map zoomed in on San Francisco\nmap = folium.Map(location=LA_COORDINATES, zoom_start=10) \n\n# add a marker for every record in the filtered data, use a clustered view\nfrom folium.plugins import FastMarkerCluster\nFastMarkerCluster(data=list(zip(df[(df['Issue Date']>week_ago) & (df['Longitude'].notnull())]['Longitude'],(df[(df['Issue Date']>week_ago) & (df['Latitude'].notnull())]['Latitude'])))).add_to(map)\n\nfolium.LayerControl().add_to(map)\n    \ndisplay(map)","53a85ac1":"#plot out scatter (line) graph of number of tickets \n\ndf.set_index(df[\"Issue Date\"],inplace=True)\n\n#Creating the plot\ndata = [go.Scatter(x=df['Ticket number'].resample('D').count().truncate(before=month_ago).index, y=df['Ticket number'].resample('D').count().truncate(before=month_ago))]\n\n# specify the layout of our figure\nlayout = dict(title = \"Daily Number of Incidents\",\n              xaxis= dict(title= 'Date',ticklen= 5,zeroline= False))\n\n# create and show our figure\nfig = dict(data = data, layout = layout)\niplot(fig)","2d600929":"#line chart of the counts by time during the last month\ndata = [go.Scatter(x=df[['Ticket number','Issue Hour']].groupby('Issue Hour').count().index, y=df[['Ticket number','Issue Hour']].groupby('Issue Hour').count()['Ticket number'])]\n\n# specify the layout of our figure\nlayout = dict(title = \"Time of Incidents\",\n              xaxis= dict(title= 'Hour',ticklen= 5,zeroline= False))\n\n# create and show our figure\nfig = dict(data = data, layout = layout)\niplot(fig)","8a7d0f7a":"#Top 10 reason codes during the last month\ndata = [go.Bar(x=df.groupby('Violation Description')['Ticket number'].count().sort_values(ascending = False)[:10].index, y=df.groupby('Violation Description')['Ticket number'].count().sort_values(ascending = False)[:10])]\n\n# specify the layout of our figure\nlayout = dict(title = \"Violations by Reason\",\n              xaxis= dict(ticklen= 5,zeroline= False))\n\n# create and show our figure\nfig = dict(data = data, layout = layout)\niplot(fig)","04a6e0a3":"# LA Parking Citation Dashboard\n### Dashboard from Kaggle Dashboarding training\n### Data is updated daily and dashboard is run nightly at midnight\n### Most recent month's data visualized \n### Map contains most recent week's data"}}