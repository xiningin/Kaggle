{"cell_type":{"9cf0b99e":"code","627c3472":"code","da276c3f":"code","664fb77f":"code","678f1b6e":"code","0a5de3f9":"code","4e69681f":"code","b91a1ec1":"code","2fd62bf9":"code","a294c75f":"code","c8ac4937":"code","a16e6d78":"code","01cf788e":"code","4b03d002":"code","9ca73abf":"markdown","cbdba121":"markdown","4b274fb3":"markdown","c33f3946":"markdown","3b520b44":"markdown","bea5fa93":"markdown","61c19697":"markdown","5b8787ca":"markdown","8dbe3aca":"markdown","bec72668":"markdown","9344ae5d":"markdown"},"source":{"9cf0b99e":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom scipy import stats \nfrom statsmodels.stats.contingency_tables import StratifiedTable\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","627c3472":"df = pd.read_csv('\/kaggle\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf.head()","da276c3f":"df.info()","664fb77f":"# calculations\ngoup_by_churn = df \\\n    .groupby('Churn', as_index = False) \\\n    .agg({'customerID' : 'count'}) \\\n    .rename(columns = {'customerID' : 'count'})\ngoup_by_churn['percentage'] = round(goup_by_churn['count'] \/ sum(goup_by_churn['count']) * 100, 2)\n\n# fig\nfig = plt.figure(figsize = (13, 6))\nax1 = fig.add_axes([0, 0, 1, 1])\nax2 = fig.add_axes([1.2, 0, 1, 1])\n\n# barh\nax1.barh(width = goup_by_churn['percentage'][0] + goup_by_churn['percentage'][1], y = 0, color = 'silver')\nax1.barh(width = goup_by_churn['percentage'][0], y = 0, color = 'MidnightBlue')\n\n# group_name\nax1.text((goup_by_churn['percentage'][0] + goup_by_churn['percentage'][1])\/3, 0.45, f\"{goup_by_churn['Churn'][0]}\", color = 'black', fontsize = 30, fontweight = 'bold')\nax1.text((goup_by_churn['percentage'][0] + goup_by_churn['percentage'][1])\/1.2, 0.45, f\"{goup_by_churn['Churn'][1]}\", color = 'black', fontsize = 30, fontweight = 'bold')\n\n# group_percentage\nax1.text((goup_by_churn['percentage'][0] + goup_by_churn['percentage'][1])\/3.4, 0.05, f\"{goup_by_churn['percentage'][0]}%\", color = 'goldenrod', fontsize = 30, fontweight = 'bold')\nax1.text((goup_by_churn['percentage'][0] + goup_by_churn['percentage'][1])\/1.25, 0.05, f\"{goup_by_churn['percentage'][1]}%\", color = 'goldenrod', fontsize = 30, fontweight = 'bold')\n\n# absolute_values\nax2.text(0.01, 0.9, f\"{goup_by_churn['Churn'][0]}:\", color = 'midnightblue', fontsize = 30, fontweight = 'bold')\nax2.text(0.01, 0.83, f\"{goup_by_churn['count'][0]}\", color = 'midnightblue', fontsize = 30, fontweight = 'bold')\nax2.text(0.01, 0.7, f\"{goup_by_churn['Churn'][1]}:\", color = 'silver', fontsize = 30, fontweight = 'bold')\nax2.text(0.01, 0.63, f\"{goup_by_churn['count'][1]}:\", color = 'silver', fontsize = 30, fontweight = 'bold')\n\n# axis\nax1.axis('off')\nax2.axis('off')\n\n# title\nplt.title('The ratio of the target', x = -0.95,  y = 1.2, color = 'black', fontsize = 36, fontweight = 'bold')\n\nplt.show()","678f1b6e":"# calculations\ngoup_by_senior = df \\\n    .groupby('SeniorCitizen', as_index = False) \\\n    .agg({'customerID' : 'count'}) \\\n    .rename(columns = {'customerID' : 'count'})\ngoup_by_senior['percentage'] = round(goup_by_senior['count'] \/ sum(goup_by_senior['count']) * 100, 2)\n\n# fig\nfig = plt.figure(figsize = (13, 6))\nax = fig.add_axes([0, 0, 1, 1])\n\n# bar\nax.bar(x = goup_by_senior['SeniorCitizen'], height = goup_by_senior['percentage'], color = '#B22222', width = 0.5)\n\n# axis\nsns.despine()\n\n# annotations\nfor p in ax.patches:\n    width = p.get_width()\n    height = p.get_height()\n    x, y = p.get_xy() \n    ax.annotate('{:.0f}%'.format(height), (x + width\/2, y + height*1.02), ha='center', color = 'black', fontsize = 16, fontweight = 'bold')\n    \n# ticks\nplt.xticks([])\nax.text(-0.1, -6, 'Young citizen', color = 'black', fontsize = 16)\nax.text(0.9, -6, 'Senior citizen', color = 'black', fontsize = 16)\nplt.tick_params(direction='out', length=6, width=3, colors='black', grid_color='black', labelsize = 16)\n\n# title\nplt.title('The ratio of the SeniorCitizen', x = 0.3,  y = 1.2, color = 'black', fontsize = 36, fontweight = 'bold')\n\nplt.show()","0a5de3f9":"# calculations\ngoup_by_internet = df \\\n    .groupby('InternetService', as_index = False) \\\n    .agg({'customerID' : 'count'}) \\\n    .rename(columns = {'customerID' : 'count'}) \\\n    .sort_values('count', ascending = False)\ngoup_by_internet['percentage'] = round(goup_by_internet['count'] \/ sum(goup_by_internet['count']) * 100, 2)\n\n# fig\nfig = plt.figure(figsize = (13, 6))\nax = fig.add_axes([0, 0, 1, 1])\n\n# bar\nax.bar(x = goup_by_internet['InternetService'], height = goup_by_internet['percentage'], color = '#B22222', width = 0.5)\n\n# axis\nsns.despine()\n\n# annotations\nfor p in ax.patches:\n    width = p.get_width()\n    height = p.get_height()\n    x, y = p.get_xy() \n    ax.annotate('{:.0f}%'.format(height), (x + width\/2, y + height*1.02), ha='center', color = 'black', fontsize = 16, fontweight = 'bold')\n    \n# ticks\nplt.xticks([])\nax.text(-0.12, -4, 'Fiber optic', color = 'black', fontsize = 16)\nax.text(0.95, -4, 'DSL', color = 'black', fontsize = 16)\nax.text(1.975, -4, 'No', color = 'black', fontsize = 16)\nplt.tick_params(direction='out', length=6, width=3, colors='black', grid_color='black', labelsize = 16)\n\n# title\nplt.title('The ratio of the InternetService', x = 0.3,  y = 1.2, color = 'black', fontsize = 36, fontweight = 'bold')\n\nplt.show()","4e69681f":"print(StratifiedTable.from_data('Churn', 'SeniorCitizen', 'InternetService', data = df).summary())","b91a1ec1":"dsl = df[df['InternetService'] == 'DSL']\nfiber_optic = df[df['InternetService'] == 'Fiber optic']\nno = df[df['InternetService'] == 'No']","2fd62bf9":"cross_dsl = round(pd.crosstab(dsl['Churn'], dsl['SeniorCitizen'], normalize = 1) * 100, 2).reset_index()\n\nplt.figure(figsize = (13, 6))\n\n# young\nplt.bar(x = '0', height = cross_dsl[0][0] + cross_dsl[0][1], color = 'silver', width = 0.5)\nplt.bar(x = '0', height = cross_dsl[0][0], color = 'midnightblue', width = 0.5)\n\n# senior\nplt.bar(x = '1', height = cross_dsl[1][0] + cross_dsl[1][1], color = 'silver', width = 0.5)\nplt.bar(x = '1', height = cross_dsl[1][0], color = 'midnightblue', width = 0.5)\n\n# axis\nsns.despine()\n\n# annotate\nplt.text(-0.065, 92, f'{cross_dsl[0][1]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\nplt.text(-0.065, 43, f'{cross_dsl[0][0]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\n\nplt.text(0.93, 80, f'{cross_dsl[1][1]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\nplt.text(0.93, 37, f'{cross_dsl[1][0]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\n\n# ticks\nplt.xticks([])\nplt.text(-0.1, -8, 'Young citizen', color = 'black', fontsize = 16)\nplt.text(0.9, -8, 'Senior citizen', color = 'black', fontsize = 16)\nplt.tick_params(direction='out', length=6, width=3, colors='black', grid_color='black', labelsize = 16)\n\n# title\nplt.title('The ratio of the tartget by SeniorCitizen (dsl)', x = 0.62,  y = 1.2, color = 'black', fontsize = 36, fontweight = 'bold')\n\nplt.show()","a294c75f":"prob = 0.95\nstat, p, dof, expected = stats.chi2_contingency(pd.crosstab(dsl['Churn'], dsl['SeniorCitizen']))\nalpha = 1.0 - prob\nif p <= alpha:\n    print('Reject H0 (The parameter influence on the target)')\nelse:\n    print('No reject H0 (The parameter no influence on the target)')","c8ac4937":"cross_fiber_optic = round(pd.crosstab(fiber_optic['Churn'], fiber_optic['SeniorCitizen'], normalize = 1) * 100, 2).reset_index()\n\nplt.figure(figsize = (13, 6))\n\n# young\nplt.bar(x = '0', height = cross_fiber_optic[0][0] + cross_fiber_optic[0][1], color = 'silver', width = 0.5)\nplt.bar(x = '0', height = cross_fiber_optic[0][0], color = 'midnightblue', width = 0.5)\n\n# senior\nplt.bar(x = '1', height = cross_fiber_optic[1][0] + cross_fiber_optic[1][1], color = 'silver', width = 0.5)\nplt.bar(x = '1', height = cross_fiber_optic[1][0], color = 'midnightblue', width = 0.5)\n\n# axis\nsns.despine()\n\n# annotate\nplt.text(-0.065, 79, f'{cross_fiber_optic[0][1]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\nplt.text(-0.065, 35, f'{cross_fiber_optic[0][0]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\n\nplt.text(0.93, 75, f'{cross_fiber_optic[1][1]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\nplt.text(0.93, 25, f'{cross_fiber_optic[1][0]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\n\n# ticks\nplt.xticks([])\nplt.text(-0.1, -8, 'Young citizen', color = 'black', fontsize = 16)\nplt.text(0.9, -8, 'Senior citizen', color = 'black', fontsize = 16)\nplt.tick_params(direction='out', length=6, width=3, colors='black', grid_color='black', labelsize = 16)\n\n# title\nplt.title('The ratio of the tartget by SeniorCitizen (fiber_optic)', x = 0.62,  y = 1.2, color = 'black', fontsize = 36, fontweight = 'bold')\n\nplt.show()","a16e6d78":"prob = 0.95\nstat, p, dof, expected = stats.chi2_contingency(pd.crosstab(fiber_optic['Churn'], fiber_optic['SeniorCitizen']))\nalpha = 1.0 - prob\nif p <= alpha:\n    print('Reject H0 (The parameter influence on the target)')\nelse:\n    print('No reject H0 (The parameter no influence on the target)')","01cf788e":"cross_no = round(pd.crosstab(no['Churn'], no['SeniorCitizen'], normalize = 1) * 100, 2).reset_index()\n\nplt.figure(figsize = (13, 6))\n\n# young\nplt.bar(x = '0', height = cross_no[0][0] + cross_no[0][1], color = 'silver', width = 0.5)\nplt.bar(x = '0', height = cross_no[0][0], color = 'midnightblue', width = 0.5)\n\n# senior\nplt.bar(x = '1', height = cross_no[1][0] + cross_no[1][1], color = 'silver', width = 0.5)\nplt.bar(x = '1', height = cross_no[1][0], color = 'midnightblue', width = 0.5)\n\n# axis\nsns.despine()\n\n# annotate\nplt.text(-0.065, 95, f'{cross_no[0][1]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\nplt.text(-0.065, 47, f'{cross_no[0][0]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\n\nplt.text(0.93, 94, f'{cross_no[1][1]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\nplt.text(0.93, 46, f'{cross_no[1][0]}%', color = 'goldenrod', fontsize = 16, fontweight = 'bold')\n\n# ticks\nplt.xticks([])\nplt.text(-0.1, -8, 'Young citizen', color = 'black', fontsize = 16)\nplt.text(0.9, -8, 'Senior citizen', color = 'black', fontsize = 16)\nplt.tick_params(direction='out', length=6, width=3, colors='black', grid_color='black', labelsize = 16)\n\n# title\nplt.title('The ratio of the tartget by SeniorCitizen (no)', x = 0.62,  y = 1.2, color = 'black', fontsize = 36, fontweight = 'bold')\n\nplt.show()","4b03d002":"prob = 0.95\nstat, p, dof, expected = stats.chi2_contingency(pd.crosstab(no['Churn'], no['SeniorCitizen']))\nalpha = 1.0 - prob\nif p <= alpha:\n    print('Reject H0 (The parameter influence on the target)')\nelse:\n    print('No reject H0 (The parameter no influence on the target)')","9ca73abf":"## Stratified table.\n\n**Check two H0:**\n* the feature has an influence on the target;\n* the similarity of the relationship across all levels of the stratifying variable.\n\n**I want to check whether the SeniorCitizen is affecting on the target in each InternetService group.**\n\n* target - Churn;\n\n* feature - SeniorCitizen;\n\n* stratifying variable - InternetService.","cbdba121":"**The variable influence on the target, but not in all types of Internet service. Let's check in which group of the InternetService feature doesn't influence on the target.**","4b274fb3":"**I don't observe a difference in the target ratio between young and senior citizens. The chi2 test also showed that the SeniorCitizen has influenced the target for no.**","c33f3946":"## EDA","3b520b44":"## Result\n\n**In this notebook, I used a stratified table to determine whether the feature has influenced the target in all stratified variables. Analyze showed that SeniorCitizen hasn't influenced on the target in group \"no\" of InternetService.**","bea5fa93":"**The chart showed that there are more young users than senior.**","61c19697":"**The chart showed that there are more loyal users than non-loyal.**","5b8787ca":"**The most popular InternetService is fiber optic. We also have users who do not use the Internet.**","8dbe3aca":"**I observe a difference in the target ratio between young and senior citizens. The chi2 test also showed that the SeniorCitizen has influenced on the target for fiber_opitc.**\n\n**Let's check no**","bec72668":"## Let's check hypotheses.\n**We can do this with \"StratifiedTable\" from the statsmodels, 4 arguments:**\n* target;\n* feature;\n* stratifying variable;\n* data.","9344ae5d":"**I observe a difference in the target ratio between young and senior citizens. The chi2 test also showed that the SeniorCitizen has influenced on the target for dsl.**\n\n**Let's check fiber_optic**"}}