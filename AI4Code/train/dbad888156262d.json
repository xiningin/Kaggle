{"cell_type":{"09ba7877":"code","45354ba1":"code","0e500648":"code","b7fdcfba":"code","40d2d8b0":"code","35536113":"code","83cc8176":"code","647ac6ea":"code","dcac1949":"code","c28f16c1":"code","dd3484cd":"code","d7d655fd":"code","e2d118d1":"code","0f2fbe4d":"code","6d546445":"code","576c005d":"code","e16b1f79":"code","23033f29":"code","3ca15471":"code","7db7e284":"code","9d33c5c5":"code","5b5628e1":"code","c00a6a99":"code","335ef8ec":"code","00c70949":"code","28fdb70a":"code","9acb7c54":"code","fde00fec":"code","6c256355":"code","6c95e10b":"code","fe15e64e":"code","cfadb48f":"code","bddddadb":"code","1cad1cd6":"code","363246eb":"code","b5c6084c":"code","1102588e":"code","35a81aef":"code","08c79751":"code","80b32a9d":"code","f637053b":"markdown","b3c46c49":"markdown","ba016100":"markdown","da32bab1":"markdown","c567090d":"markdown","bfa336d8":"markdown","cc62ab29":"markdown","5e0fc783":"markdown","cbcb9694":"markdown","988e4fba":"markdown"},"source":{"09ba7877":"import numpy as np\nimport pandas as pd\nimport os\n#import xgboost as xgb\n#from sklearn.model_selection import train_test_split","45354ba1":"train_df = pd.read_csv('..\/input\/train.csv')\ntest_df = pd.read_csv('..\/input\/test.csv')\n","0e500648":"train_df.dtypes","b7fdcfba":"train_df.head()","40d2d8b0":"test_df.tail()","35536113":"train_df['trsin_or_test'], test_df['trsin_or_test'] = 'train', 'test'\ndata_df = pd.concat([train_df, test_df])\ndata_df.head()","83cc8176":"data_df['date']=pd.to_datetime(data_df['date'])","647ac6ea":"data_df.dtypes","dcac1949":"data_df.info()","c28f16c1":"data_df['year'] = data_df['date'].dt.year\ndata_df['quarter'] = data_df['date'].dt.quarter\ndata_df['month'] = data_df['date'].dt.month\ndata_df['weekofyear'] = data_df['date'].dt.weekofyear\ndata_df['weekday'] = data_df['date'].dt.weekday\ndata_df['dayofweek'] = data_df['date'].dt.dayofweek","dd3484cd":"data_df.head()","d7d655fd":"data_df.groupby(['quarter', 'item'])['sales'].mean()","e2d118d1":"data_df['item_quarter_mean'] = data_df.groupby(['quarter', 'item'])['sales'].transform('mean')","0f2fbe4d":"data_df.head()","6d546445":"data_df['store_quarter_mean'] = data_df.groupby(['quarter', 'store'])['sales'].transform('mean')\ndata_df['store_item_quarter_mean'] = data_df.groupby(['quarter', 'item', 'store'])['sales'].transform('mean')","576c005d":"data_df['item_month_mean'] = data_df.groupby(['month', 'item'])['sales'].transform('mean')\ndata_df['store_month_mean'] = data_df.groupby(['month', 'store'])['sales'].transform('mean')\ndata_df['store_item_month_mean'] = data_df.groupby(['month', 'item', 'store'])['sales'].transform('mean')","e16b1f79":"data_df['item_weekofyear_mean'] = data_df.groupby(['weekofyear', 'item'])['sales'].transform('mean')\ndata_df['store_weekofyear_mean'] = data_df.groupby(['weekofyear', 'store'])['sales'].transform('mean')\ndata_df['store_item_weekofyear_mean'] = data_df.groupby(['weekofyear', 'item', 'store'])['sales'].transform('mean')\n","23033f29":"data_df['itemweekday_mean'] = data_df.groupby(['weekday', 'item'])['sales'].transform('mean')\ndata_df['storeweekday_mean'] = data_df.groupby(['weekday', 'store'])['sales'].transform('mean')\ndata_df['storeitemweekday_mean'] = data_df.groupby(['weekday', 'item', 'store'])['sales'].transform('mean')","3ca15471":"data_df.head()","7db7e284":"data_df.tail()","9d33c5c5":"data_df.isnull().sum().sum()","5b5628e1":"data_df.info()","c00a6a99":"data_df.head()","335ef8ec":"data_df.shape","00c70949":"data_df.columns","28fdb70a":"data_df.drop(['date','id','sales'],axis=1,inplace=True)","9acb7c54":"data_df.info()","fde00fec":"x= data_df[data_df['trsin_or_test'] == 'train']#.dropna().drop(['id', 'sales', 'trsin_or_test', 'date'], axis=1)\ntest = data_df[data_df['trsin_or_test'] == 'train']#.dropna()['sales']","6c256355":"x.head()","6c95e10b":"test.head()","fe15e64e":"x.drop(['trsin_or_test'],axis=1,inplace=True)\ntest.drop(['trsin_or_test'],axis=1,inplace=True)","cfadb48f":"y=pd.read_csv('..\/input\/train.csv',usecols=['sales'])\ny=y.sales","bddddadb":"y.shape","1cad1cd6":"y.head()","363246eb":"from sklearn import ensemble\nxbr=ensemble.GradientBoostingRegressor()\nxbr","b5c6084c":"%%time\nxbr.fit(x,y)","1102588e":"%%time\nxbr.score(x,y)","35a81aef":"%%time\npredict=pd.DataFrame(xbr.predict(test),columns=['sales'])","08c79751":"ids=pd.read_csv(\"..\/input\/test.csv\",usecols=['id'])\nsub=ids.join(predict)\nsub.head()","80b32a9d":"sub.to_csv('sample.csv',index=False)","f637053b":"> **New cols for mean() based on weekday** ","b3c46c49":"### Libraries","ba016100":"> **submssion of results**\n\n","da32bab1":"> **New cols for mean() based on month** ","c567090d":"%%time\nmodel = xgbmodel\n\n\npredict=pd.DataFrame(model.predict(xgb.DMatrix(test),ntree_limit=model.best_ntree_limit))\n","bfa336d8":"> **New cols for mean() based on weekof year** ","cc62ab29":"> **loading dataset**","5e0fc783":"x_train, x_validate, y_train, y_validate = train_test_split(x, y, random_state=0, test_size=0.25)\n\nprint(x_train.shape, x_validate.shape, y_train.shape, y_validate.shape)\n\n %%time\nparams = {\n    'colsample_bytree': 0.8,\n    'eta': 0.1,\n    'eval_metric': 'mae',\n    'lambda': 1,\n    'max_depth': 6,\n    'objective': 'reg:linear',\n    'seed': 0,\n    'silent': 1,\n    'subsample': 0.8,\n}\nxgbtrain = xgb.DMatrix(x_train, label=y_train)\nxgbvalidate = xgb.DMatrix(x_validate, label=y_validate)\nxgbmodel = xgb.train(list(params.items()), xgbtrain, early_stopping_rounds=50, evals=[(xgbtrain, 'train'), (xgbvalidate, 'validate')], num_boost_round=200, verbose_eval=50)","cbcb9694":"> **New cols for mean() based on quarter**","988e4fba":"> **Model Predection**"}}