{"cell_type":{"1c9d02b8":"code","a3cc1806":"code","01b09e85":"code","f3986f93":"code","02a5a10a":"code","2829e477":"code","4c5687e2":"code","4731f0e4":"code","faf91b32":"code","309cfa33":"code","5ae3cf3b":"code","f49efcf0":"code","713b2d89":"code","b63f2440":"code","fca2d35e":"code","aec0f641":"code","09d294b7":"code","070c0c4b":"code","89b06d8c":"code","24eb7d91":"code","0c3d1f96":"code","77dd418a":"code","097cfbc7":"code","25572442":"code","4c031e13":"code","2fe2f394":"code","3e408788":"code","228ea451":"code","9189d0f7":"code","75db2c74":"code","eadec23e":"markdown","d7f52b9e":"markdown","31af6764":"markdown","006393c2":"markdown","04b1befd":"markdown","bf2dee5b":"markdown","ec25dc56":"markdown","2b85a73f":"markdown","ffe38d04":"markdown","dee627cf":"markdown","d9f4a9db":"markdown","57dd3bf9":"markdown","3dc8ea62":"markdown","7a4f1046":"markdown","b96f120d":"markdown","a31f17c7":"markdown","a0936ddd":"markdown","9356108a":"markdown","35d09db1":"markdown","a0502ded":"markdown","ed53d818":"markdown","19f82424":"markdown","28d159e2":"markdown","8f2631e0":"markdown","0d20ad49":"markdown"},"source":{"1c9d02b8":"import numpy as np\nimport pandas as pd\nfrom pandas.api.types import is_numeric_dtype\n\nimport matplotlib.pyplot as plt\nfrom IPython.core.display import HTML\n\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport plotly.figure_factory as ff\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")\npd.set_option('display.max_columns', 300)\npd.set_option(\"display.max_rows\", 20)","a3cc1806":"# Install openpyxl to read xlsx files.\n!pip install openpyxl","01b09e85":"    df = pd.read_excel('..\/input\/state-of-indias-birds-2020\/State of Indias Birds - Essentials.xlsx', engine=\"openpyxl\", index_col=0)\nprint(df.shape)\ndf.head()","f3986f93":"keys = pd.read_excel('..\/input\/state-of-indias-birds-2020\/State of Indias Birds - Essentials.xlsx', engine=\"openpyxl\", sheet_name=1).values","02a5a10a":"for column, expl in keys[1:-2]:\n    print(column, ':' , expl)","2829e477":"cat_features = [c for c in df.columns if not is_numeric_dtype(df[c].dtype)]\nnum_features = [c for c in df.columns if is_numeric_dtype(df[c].dtype)]","4c5687e2":"df[num_features].describe()","4731f0e4":"df[cat_features].describe()","faf91b32":"names = df['Common Name (India Checklist)']\ndf = df.drop(columns=['Common Name (India Checklist)', 'Scientific Name (India Checklist)', 'Analysed Current', 'Analysed Long-term'])","309cfa33":"cat_features = [c for c in df.columns if not is_numeric_dtype(df[c].dtype)]","5ae3cf3b":"cat_features","f49efcf0":"import plotly.graph_objects as go\nfig = make_subplots( rows=2,cols=4, subplot_titles=cat_features, \n                    vertical_spacing = 0.45, horizontal_spacing = 0.1)\n\nfor i,c in enumerate(cat_features):\n    row = i\/\/4+1\n    col = i%4+1\n    fig.add_trace(go.Bar(x=df[c].unique(), y=df[c].value_counts()\/df[c].value_counts().sum()), col=col, row=row)\n\nfig.update_yaxes(title_text=\"Percent\", row=1, col=1)\nfig.update_yaxes(title_text=\"Percent\", row=2, col=1)\n\nfig.update_layout(\n    font_family=\"Times New Roman\",\n    title_font_family=\"Times New Roman\")\nfig.update_layout(showlegend=False, title_text=\"Barplots of repartition of categorical features (in percent)\", title_x=0.5)\n\nfig.show()","713b2d89":"missing_curchange = pd.isnull(df['Current Annual Change (%)'])\nmissing_cchange_prop = missing_curchange.sum()\/len(df)\ncurchange = df['Current Annual Change (%)'][~missing_curchange]\n\nprint(\"There is %.2F %% missing data in Current Annual Change variable\" %(missing_cchange_prop * 100))\n\nprint(\"Among them, %.2F %% are negative\" %( (curchange<0).mean()* 100))","b63f2440":"# Make a custom color map in order to always have the same colors\ncolor_map = px.colors.sequential.RdBu\ncolor_map_IUCN = {'Least Concern': color_map[9], \n                  'Near Threatened': color_map[7],\n                 'Vulnerable': color_map[4],\n                 'Endangered': color_map[2],\n                 'Critically Endangered': color_map[0]}","fca2d35e":"IUCN = ['Least Concern', 'Near Threatened', 'Vulnerable', 'Endangered', 'Critically Endangered']\nfig = px.bar(y=np.ones(len(IUCN)), x=IUCN, color=IUCN, color_discrete_map=color_map_IUCN, height=250)\nfig.update_layout(title_text=\"Colormap for IUCN Status\", title_x=0.45)","aec0f641":"argind = np.arange(len(df))[~missing_curchange][np.argsort(curchange.values)]\nfirsts = argind[:30]\nfig = px.bar(\n    y=df['Current Annual Change (%)'].iloc[firsts], x=names[firsts],\n    error_y=df['Current Annual Change CI (%)'].iloc[firsts], \n    color=df['IUCN Status'].iloc[firsts], \n    color_discrete_map=color_map_IUCN)\n\nfig.update_layout(title_text=\"Change in population size (in %) for the 30 species whose\"\n                  \"population tends to decrease the most (over 5 years)\", title_x=0.5)\nfig.update_layout(xaxis_categoryorder = 'total ascending', legend_traceorder=\"reversed\")\nfig.show()","09d294b7":"lasts = argind[-30:]\nfig = px.bar(\n    y=df['Current Annual Change (%)'].iloc[lasts], x=names[lasts],\n    error_y=df['Current Annual Change CI (%)'].iloc[lasts], \n    color=df['IUCN Status'].iloc[lasts],\n    color_discrete_map=color_map_IUCN)\nfig.update_layout(title_text=\"Change in population size (in %) for the 30 species whose\"\n                  \"population tends to increase the most (over 5 years)\", title_x=0.5)\nfig.update_layout(xaxis_categoryorder = 'total ascending')\nfig.show()","070c0c4b":"concerning_species = np.arange(len(df))[(~missing_curchange) & (df['IUCN Status']!='Least Concern')]\nfig = px.bar(\n    y=df['Current Annual Change (%)'].iloc[concerning_species], x=names[concerning_species],\n    error_y=df['Current Annual Change CI (%)'].iloc[concerning_species])\nfig.update_layout(title_text=\"Change in abundance (in %) for the concerning species\", title_x=0.5)\nfig.update_layout(xaxis_categoryorder = 'total ascending')\nfig.show()","89b06d8c":"img = pd.crosstab(df.iloc[concerning_species]['IUCN Status'],df.iloc[concerning_species]['Current Status'])\nfig = ff.create_annotated_heatmap(img.values, x = list(img.columns), y=list(img.index))\nfig.update_layout(title_text='Table of IUCN Status VS Current Status, i.e. vulnerability of species vs current change in population', title_x=0.1)","24eb7d91":"missing_ltrend_prop = pd.isnull(df['Long-term Trend (%)']).sum()\/len(df)\nprint(\"There is %.2F %% missing data in Long-term Trend variable\" %(missing_ltrend_prop * 100))","0c3d1f96":"missing_ltrend = pd.isnull(df['Long-term Trend (%)']).values\n\nneg_trend = (df['Long-term Trend (%)'][~missing_ltrend]<=0).sum()\nprint(\"Among the non-missing data, there are %.0F over %.0F \"\n      \"birds whose population is expected to decrease in the next 25+ years\" %(neg_trend, (~missing_ltrend).sum()))","77dd418a":"\nltrend = df['Long-term Trend (%)'][~missing_ltrend]\nargind = np.arange(len(df))[~missing_ltrend][np.argsort(ltrend.values)]\nfirsts = argind[:30]\nfig = px.bar(\n    y=df['Long-term Trend (%)'].iloc[firsts], x=names[firsts],\n    error_y=df['Long-term Trend CI (%)'].iloc[firsts], \n    color=df['IUCN Status'].iloc[firsts],\n    color_discrete_map=color_map_IUCN)\n\nfig.update_layout(title_text=\"Change in population size (in %) for the 30 species whose\"\n                  \"population tends to decrease the most (over 25+ years)\", title_x=0.5)\nfig.update_layout(xaxis_categoryorder = 'total ascending')\nfig.show()","097cfbc7":"lasts = argind[-30:]\nfig = px.bar(\n    y=df['Long-term Trend (%)'].iloc[lasts], x=names[lasts],\n    error_y=df['Long-term Trend CI (%)'].iloc[lasts], \n    color=df['IUCN Status'].iloc[lasts],\n    color_discrete_map=color_map_IUCN)\n\nfig.update_layout(title_text=\"Change in population size (in %) for the 30 species whose \"\n                  \"population tends to increase the most (over 25+ years)\", title_x=0.5)\nfig.update_layout(xaxis_categoryorder = 'total ascending')\nfig.show()","25572442":"fig = ff.create_distplot([df['Long-term Trend CI (%)'][~missing_ltrend].values], ['Long-term Trend CI (%)'], bin_size=10)\nfig.show()","4c031e13":"df_new = df.loc[df['Long-term Trend CI (%)']<30]\nconcerning_species = (df_new['IUCN Status']!='Least Concern') & (df_new['IUCN Status']!='Near Threatened')\ndf_new['concerning species']=concerning_species","2fe2f394":"fig = px.box(df_new, x=\"concerning species\", y=\"Long-term Trend (%)\")\nfig.show()","3e408788":"from mlxtend.evaluate import permutation_test\nmissing_ltrend = pd.isnull(df_new['Long-term Trend (%)']).values\npop_danger = df_new[(~missing_ltrend) & concerning_species]['Long-term Trend (%)']\npop_unconcerned = df_new[(~missing_ltrend) & (~concerning_species)]['Long-term Trend (%)']\np_value = permutation_test(pop_danger, pop_unconcerned,\n                           method='approximate',\n                           num_rounds=10000,\n                           seed=0)\nprint(p_value)","228ea451":"missing_range_prop = pd.isnull(df['Distribution Range Size (units of 10,000 sq. km.)']).sum()\/len(df)\nprint(\"There is %.2F %% missing data in Distribution Range Size variable\" %(missing_range_prop * 100))","9189d0f7":"missing_range = pd.isnull(df['Distribution Range Size (units of 10,000 sq. km.)'])\ndistributions = df['Distribution Range Size (units of 10,000 sq. km.)'][~missing_range]\nargind = np.argsort(distributions)\nfig = make_subplots( rows=1,cols=2, subplot_titles=[ 'Ten larger','Ten smaller'])\n\n\nten_smaller = np.arange(len(df))[~missing_range][argind][:10]\n\nfig.add_trace(go.Bar(\n    y=df['Distribution Range Size (units of 10,000 sq. km.)'].iloc[ten_smaller], x=names[ten_smaller],\n    error_y=dict(type='data', array=df['Distribution Range Size CI (units of 10,000 sq. km.)']),\n), row=1, col=2)\n\n\nten_larger = np.arange(len(df))[~missing_range][argind][-10:]\n\nfig.add_trace(go.Bar(\n    y=df['Distribution Range Size (units of 10,000 sq. km.)'].iloc[ten_larger], x=names[ten_larger],\n    error_y=dict(type='data', array=df['Distribution Range Size CI (units of 10,000 sq. km.)']),\n), row=1, col=1)\n\n\n\nfig.update_layout(showlegend=False,title_text=\"Distribution Range Size (units of 10,000 sq. km.).\", title_x=0.5)\n\nfig.show()","75db2c74":"px.scatter(df, x='Distribution Range Size (units of 10,000 sq. km.)', y='Long-term Trend (%)', \n           color='IUCN Status', color_discrete_map=color_map_IUCN)","eadec23e":"The result is that a 5% level test would reject. \nHence, there seems to be a relation between endangered status of the species and its Long-Term trend.\n\nRemark that if we had not selected the most informative observations for which CI < 30, we woud not have been able to conclude.","d7f52b9e":"# Long-term Trend of Birds in India.<a id=\"4\"><\/a>\nLet us look at the behavior of the population of birds over 25+ years (`Long-term Trend`).","31af6764":"One can check that the data are not Gaussian, hence we have to use an alternative test. For instance permutation test are well adapted to non-Gaussian data to test for equality of mean, this is the test we will use.","006393c2":"Most vulnerable and Near threatened birds are mainly uncertain.","04b1befd":"Vocabulary check : IUCN Status\n\n* Critically endangered (CR) \u2013 in a particularly and extremely critical state.\n* Endangered (EN) \u2013 very high risk of extinction in the wild, meets any of criteria A to E for Endangered.\n* Vulnerable (VU) \u2013 meets one of the 5 red list criteria and thus considered to be at high risk of unnatural (human-caused) extinction without further human intervention.\n* Near threatened (NT) \u2013 close to being at high risk of extinction in the near future.\n* Least concern (LC) \u2013 unlikely to become extinct in the near future.","bf2dee5b":"Some of the birds are present in about 70% of India while some birds are concentrated in 0.0001% (=100$\\mu$ in the plot) of India's territory. \n\nAs expected there are large errorbars on the observations where the area is small.","ec25dc56":"Notice the change of scale between the two. As a way to scale these data, we can look at the same values but as a percentage of India's area.","2b85a73f":"Unsurprisingly, there are only species that are not particularly in danger here.\n\nSome species have become Invasive like the Common Starling that is expected to increase by 150% its population in the next 25+ years.\n\n![](https:\/\/upload.wikimedia.org\/wikipedia\/commons\/thumb\/5\/5a\/Sturnus_vulgaris_2_%28Marek_Szczepanek%29.jpg\/640px-Sturnus_vulgaris_2_%28Marek_Szczepanek%29.jpg?download)\nThey are cute but they make a lot of noise and are often seen in groups which can be hurtfull for plants (they eat the seeds).","ffe38d04":"There is a tendancy among endangered species to have a small distribution range size which is logical because their population is small by definition. \n\nAnd there is a tendancy to have a higher long-term trend for birds that have a large Distribution Range Size.","dee627cf":"# Area occupied by birds <a id=\"6\"><\/a>","d9f4a9db":"Good news :\n* Most of the birds are \"Least Concern\" status, meaning they are not endangered or vulnerable (IUCN Status plot).\n* There are still birds in India that are seen in lot of places in India (Distribution  Status plot).\n* half of the birds are not concerning with respect to the concervation (Status of Conservation Concern plot).\n\nBad News:\n* Most population are expected to decrease in the next 25+ years (Long Term Status plot)\n* There are very few stable populations currently (Current Status plot)\n* There are not a lot of Migratory birds anymore (Migratory Status plot)","57dd3bf9":"In the statistical analysis, we restrict ourselves to species whose CI is less than 30 to avoid species on which the data are very imprecise.","3dc8ea62":"# Current Annual Change of Birds in India.<a id=\"3\"><\/a>\nLet us look at the behavior of the population of birds over 5 years (`Current Annual Change`)","7a4f1046":"# Area VS Long Term Trend <a id=\"7\"><\/a>","b96f120d":"The index, the `Common Name`, and `Scientific Name` columns all correspond to a unique identifier of the bird. For simplicity, we drop the two name columns. We also drop the two columns `Analysed Long-term` and `Analysed Current` columns because they only have one unique value.","a31f17c7":"# Libraries <a id=\"1\"><\/a>","a0936ddd":"Good news :\n* some concerning species have a population that is increasing by more than 10%, this is quite good.\n\nBad news :\n* Most of the concerning species have a population that is decreasing.\n\nSome of the error bars are quite large and make the measure quite uncertains.\n\nLet us look more precisely into these questions.","9356108a":"# Categorical features <a id=\"2\"><\/a>","35d09db1":"* Blue : Not Endangered\n* Red : Endangered","a0502ded":"### Description of the feature","ed53d818":"**Description of dataset :** \n\nThe State of India\u2019s Birds report was created to assess the conservation status of the majority of species that regularly occur in the country. Worldwide, common and widespread species are declining; but in India, lack of information has meant that conservation attention has been focussed on only a few species (usually large, charismatic and threatened).\n\nThe report fills this gap by using over 10 million observations uploaded to the eBird platform by more than 15,500 birdwatchers to evaluate the distribution range size of 867 Indian birds, and their trends in abundance in both the long term (over 25+ years) and currently (past 5 years). Using these three measures, plus information from the IUCN Red List of global threat status, this report places Indian species into Low, Moderate and High categories of Conservation Concern for India. A large number of species that are thought to be common and widespread find themselves as of High Conservation Concern.","19f82424":"# Table of contents\n1. [Libraries](#1)\n1. [Categorical Features](#2)\n1. [Current Annual Change of Birds in India](#3)\n1. [Long-term Trend of Birds in India](#4)\n1. [The beginning of a Statistical analysis: are endangered species the ones most likely to disappear ?](#5)     \n1. [Area occupied by birds](#6)     \n1. [Area VS Long Term Trend](#7)  ","28d159e2":"Some of the species of bird have a very large CI which makes us not confident in the measures.","8f2631e0":"**We expect the population of Cinereous Vulture (a Near Threatened species, not endangered yet) to drop by 97% in India in the next 25 years.**\n![](https:\/\/live.staticflickr.com\/3140\/3031348359_615c0371b9_w_d.jpg)","0d20ad49":"# The beginning of a Statistical analysis: are endangered species the ones most likely to disappear ? <a id=\"5\"><\/a>"}}