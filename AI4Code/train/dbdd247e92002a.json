{"cell_type":{"55966b29":"code","2ca63c23":"code","d0af45cd":"code","87664e4c":"code","bff8d57f":"code","8ff63b51":"code","faa04f75":"code","28a0fb03":"code","516dc9e5":"code","f557e979":"code","6ca4b6ab":"code","19cc6609":"code","60a6113d":"code","425c6ef1":"code","c74742a2":"code","bf61a1ba":"code","9fe1cf80":"code","aa9cb295":"code","786ba409":"code","7d585899":"code","372d0ee1":"code","388b10a8":"code","46235e89":"code","2530a079":"markdown","0811a76a":"markdown","20f350c2":"markdown","0942eeed":"markdown","7171b25c":"markdown","9fea226a":"markdown","c19a1a36":"markdown","83f2d51b":"markdown","4ca7c98f":"markdown","d82cd51a":"markdown","d64f5ac2":"markdown","4bede1f3":"markdown","b4be7271":"markdown"},"source":{"55966b29":"\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n","2ca63c23":"df_rides = pd.read_csv('..\/input\/uber-lyft-cab-prices\/cab_rides.csv')\ndf_weather = pd.read_csv('..\/input\/uber-lyft-cab-prices\/weather.csv')","d0af45cd":"# converting the timestamp data into real date format\ndf_rides['date'] = pd.to_datetime(df_rides['time_stamp']\/ 1000, unit = 's')\ndf_weather['date'] = pd.to_datetime(df_weather['time_stamp'], unit = 's')","87664e4c":"# Creating the new column that contain the location and \ndf_rides['merged_date'] = df_rides['source'].astype('str') + ' - ' + df_rides['date'].dt.strftime('%Y-%m-%d').astype('str') + ' - ' + df_rides['date'].dt.hour.astype('str')\ndf_weather['merged_date'] = df_weather['location'].astype('str') + ' - ' + df_weather['date'].dt.strftime('%Y-%m-%d').astype('str') + ' - ' + df_weather['date'].dt.hour.astype('str')","bff8d57f":"#  df_rides['date'].dt.strftime('%m').head()\ndf_weather.index = df_weather['merged_date']","8ff63b51":"# Join the weather date on rides data\ndf_joined = df_rides.join(df_weather, on = ['merged_date'], rsuffix ='_w')","faa04f75":"df_joined.info()","28a0fb03":"df_joined['id'].value_counts()","516dc9e5":"df_joined[df_joined['id'] == '29ce4d5f-07f9-4ce5-ada4-ae9ea49e92a6'].iloc[:,10:22]","f557e979":"id_group = pd.DataFrame(df_joined.groupby('id')['temp','clouds', 'pressure', 'rain', 'humidity', 'wind'].mean())\ndf_rides_weather = df_rides.join(id_group, on = ['id'])","6ca4b6ab":"# Creating the columns for Month, Hour and Weekdays \ndf_rides_weather['Month'] = df_rides_weather['date'].dt.month\ndf_rides_weather['Hour'] = df_rides_weather['date'].dt.hour\ndf_rides_weather['Day'] =  df_rides_weather['date'].dt.strftime('%A')","19cc6609":"# The distribution of rides in weekdays \nuber_day_count = df_rides_weather[df_rides_weather['cab_type'] == 'Uber']['Day'].value_counts()\nuber_day_count = uber_day_count.reindex(index = ['Friday','Saturday','Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday'])\nlyft_day_count = df_rides_weather[df_rides_weather['cab_type'] == 'Lyft']['Day'].value_counts()\nlyft_day_count = lyft_day_count.reindex(index = ['Friday','Saturday','Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday'])\n\nfig , ax = plt.subplots(figsize = (12,12))\nax.plot(uber_day_count.index, uber_day_count, label = 'Uber')\nax.plot(lyft_day_count.index, lyft_day_count, label = 'Lyft')\nax.set(ylabel = 'Number of Rides', xlabel = 'Weekdays')\nax.legend()\nplt.show()","60a6113d":"# The ride distribution in one day \nfig , ax = plt.subplots(figsize= (12,12))\nax.plot(df_rides_weather[df_rides_weather['cab_type'] == 'Lyft'].groupby('Hour').Hour.count().index, df_rides_weather[df_rides_weather['cab_type'] == 'Lyft'].groupby('Hour').Hour.count(), label = 'Lyft')\nax.plot(df_rides_weather[df_rides_weather['cab_type'] == 'Uber'].groupby('Hour').Hour.count().index, df_rides_weather[df_rides_weather['cab_type'] =='Uber'].groupby('Hour').Hour.count(), label = 'Uber')\nax.legend()\nax.set(xlabel = 'Hours', ylabel = 'Number of Rides')\nplt.xticks(range(0,24,1))\nplt.show()\n","425c6ef1":"# The Average price of rides by type of service\n\nuber_order =[ 'UberPool', 'UberX', 'UberXL', 'Black','Black SUV','WAV' ]\nlyft_order = ['Shared', 'Lyft', 'Lyft XL', 'Lux', 'Lux Black', 'Lux Black XL']\nfig, ax = plt.subplots(2,2, figsize = (20,15))\nax1 = sns.barplot(x = df_rides_weather[df_rides_weather['cab_type'] == 'Uber'].name, y = df_rides_weather[df_rides_weather['cab_type'] == 'Uber'].price , ax = ax[0,0], order = uber_order)\nax2 = sns.barplot(x = df_rides_weather[df_rides_weather['cab_type'] == 'Lyft'].name, y = df_rides_weather[df_rides_weather['cab_type'] == 'Lyft'].price , ax = ax[0,1], order = lyft_order)\nax3 = sns.barplot(x = df_rides_weather[df_rides_weather['cab_type'] == 'Uber'].groupby('name').name.count().index, y = df_rides_weather[df_rides_weather['cab_type'] == 'Uber'].groupby('name').name.count(), ax = ax[1,0] ,order = uber_order)\nax4 = sns.barplot(x = df_rides_weather[df_rides_weather['cab_type'] == 'Lyft'].groupby('name').name.count().index, y = df_rides_weather[df_rides_weather['cab_type'] == 'Lyft'].groupby('name').name.count(), ax = ax[1,1],order = lyft_order)\nfor p in ax1.patches:\n    ax1.annotate(format(p.get_height(), '.2f'), (p.get_x() + p.get_width() \/ 2., p.get_height()), ha = 'center', va = 'center', xytext = (0, 10), textcoords = 'offset points')\nfor p in ax2.patches:\n    ax2.annotate(format(p.get_height(), '.2f'), (p.get_x() + p.get_width() \/ 2., p.get_height()), ha = 'center', va = 'center', xytext = (0, 10), textcoords = 'offset points')\nax1.set(xlabel = 'Type of Service', ylabel = 'Average Price')\nax2.set(xlabel = 'Type of Service', ylabel = 'Average Price')\nax3.set(xlabel = 'Type of Service', ylabel = 'Number of Rides')\nax4.set(xlabel = 'Type of Service', ylabel = 'Number of Rides')\nax1.set_title('The Uber Average Prices by Type of Service')\nax2.set_title('The Lyft Average Prices by Type of Service')\nax3.set_title('The Number of Uber Rides by Type of Service')\nax4.set_title('The Number of Lyft Rides by Type of Service')\nplt.show()","c74742a2":"# The average price by distance\nfig , ax = plt.subplots(figsize = (12,12))\nax.plot(df_rides_weather[df_rides_weather['cab_type'] == 'Lyft'].groupby('distance').price.mean().index, df_rides_weather[df_rides_weather['cab_type'] == 'Lyft'].groupby('distance')['price'].mean(), label = 'Lyft')\nax.plot(df_rides_weather[df_rides_weather['cab_type'] == 'Uber'].groupby('distance').price.mean().index, df_rides_weather[df_rides_weather['cab_type'] =='Uber'].groupby('distance').price.mean(), label = 'Uber')\nax.set_title('The Average Price by distance', fontsize= 15)\nax.set(xlabel = 'Distance', ylabel = 'Price' )\nax.legend()\nplt.show()\n","bf61a1ba":"# The average price by distance \nfig, ax = plt.subplots(1,2 , figsize = (20,5))\nfor i,col in enumerate(df_rides_weather[df_rides_weather['cab_type'] == 'Uber']['name'].unique()):\n    ax[0].plot(df_rides_weather[ df_rides_weather['name'] == col].groupby('distance').price.mean().index, df_rides_weather[ df_rides_weather['name'] == col].groupby('distance').price.mean(), label = col)\nax[0].set_title('Uber Average Prices by Distance')\nax[0].set(xlabel = 'Distance in Mile', ylabel = 'Average price in USD')\nax[0].legend()\nfor i,col in enumerate(df_rides_weather[df_rides_weather['cab_type'] == 'Lyft']['name'].unique()):\n    ax[1].plot(df_rides_weather[ df_rides_weather['name'] == col].groupby('distance').price.mean().index, df_rides_weather[ df_rides_weather['name'] == col].groupby('distance').price.mean(), label = col)\nax[1].set(xlabel = 'Distance in Mile', ylabel = 'Average price in USD')\nax[1].set_title('Lyft Average Prices by Distance')\nax[1].legend()\nplt.show()\n","9fe1cf80":"# the average rate per mile\ndf_rides_weather['rate_per_mile'] = round((df_rides_weather['price'] \/ df_rides_weather['distance'] ),2)\n# The average rate per mile plot\nfig, ax = plt.subplots(1,2,figsize = (12,5))\nax1 = sns.lineplot(x = df_rides_weather.groupby(['distance'])['rate_per_mile'].mean().index, y = df_rides_weather.groupby('distance')['rate_per_mile'].mean(), ax = ax[0])\nax2 = sns.lineplot(x = df_rides_weather.groupby(['distance'])['rate_per_mile'].mean().index, y = df_rides_weather.groupby('distance')['rate_per_mile'].mean(), ax = ax[1])\nplt.xticks(range(0, 10,1))\nax1.set(xlabel = 'Distance', ylabel = 'Rate per Mile in USD')\nax2.set(xlabel = 'Distance', ylabel = 'Rate per Mile in USD', ylim = (0,15))\nax1.set_title('The Average Rate per Mile', fontsize = 16)\nax2.set_title('ZOOM Average Rate per Mile', fontsize = 16)\nplt.show()","aa9cb295":"# Scatter chart for Rate per mile and distance\n    # pivot table to calculate average rate based on cab_type, service type(name) and distance\nrates_per_mile_pivot = df_rides_weather.pivot_table(index = ['cab_type', 'name', 'distance'] , values = ['rate_per_mile'])\nrates_per_mile_pivot.reset_index(inplace = True)","786ba409":"fig, ax = plt.subplots(2,2, figsize = (20,8))\nax1 = sns.scatterplot(x = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Uber']['distance'], y = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Uber']['rate_per_mile'], hue = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Uber']['name'], ax = ax[0,0])\nax2 = sns.scatterplot(x = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Uber']['distance'], y = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Uber']['rate_per_mile'], hue = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Uber']['name'], ax = ax[1,0])\nax2.set( ylim = (0,20))\nax3 = sns.scatterplot(x = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Lyft']['distance'], y = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Lyft']['rate_per_mile'], hue = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Lyft']['name'], ax = ax[0,1])\nax4 = sns.scatterplot(x = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Lyft']['distance'], y = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Lyft']['rate_per_mile'], hue = rates_per_mile_pivot[rates_per_mile_pivot['cab_type'] == 'Lyft']['name'], ax = ax[1,1])\nax4.set( ylim = (0,20))\nhandles_uber, labels_uber = ax1.get_legend_handles_labels()\nhandles_uber = [handles_uber[6],handles_uber[3],handles_uber[4],handles_uber[5],handles_uber[1],handles_uber[2]]\nlabels_uber = [labels_uber[6],labels_uber[3],labels_uber[4],labels_uber[5],labels_uber[1],labels_uber[2]]\nax1.legend(handles_uber, labels_uber)\nax2.legend(handles_uber, labels_uber)\nhandles_lyft, labels_lyft = ax3.get_legend_handles_labels()\nhandles_lyft = [handles_lyft[6],handles_lyft[4],handles_lyft[5],handles_lyft[1],handles_lyft[2],handles_lyft[3]]\nlabels_lyft = [labels_lyft[6],labels_lyft[4],labels_lyft[5],labels_lyft[1],labels_lyft[2],labels_lyft[3]]\nax3.legend(handles_lyft, labels_lyft)\nax4.legend(handles_lyft, labels_lyft)\nax1.set_title('Uber Rate per Mile')\nax1.set(ylabel = 'Rate per Mile in USD', xlabel = ' ')\nax2.set_title('Uber Rate Zoom(0 to 20 USD)')\nax2.set(ylabel = 'Rate per Mile in USD', xlabel = 'Distance')\nax3.set_title('Lyft Rate per Mile')\nax3.set(ylabel = ' ', xlabel = ' ')\nax4.set_title('Lyft Rate Zoom(0 to 20 USD)')\nax4.set(ylabel = ' ', xlabel = 'Distance')\nplt.show()","7d585899":"# Overrated rides\nhigh_mile_rates = df_rides_weather[df_rides_weather['rate_per_mile'] > 80]\n# The number of overrated rides by cab type\nhigh_mile_rates['cab_type'].value_counts()","372d0ee1":"# Overrated Lyft rides\nhigh_mile_rates[high_mile_rates['cab_type'] == 'Lyft'].loc[:,['distance', 'cab_type', 'price', 'surge_multiplier','name', 'rate_per_mile']]\n","388b10a8":"# Overrated Uber Rides\nhigh_mile_rates[high_mile_rates['cab_type'] == 'Uber'].loc[:,['distance', 'cab_type', 'price', 'surge_multiplier','name', 'rate_per_mile']].sort_values(by = 'rate_per_mile', ascending = False).head(20)","46235e89":"# The number of rides based on service type, distance, and price \nover_rated_pivot = high_mile_rates[high_mile_rates['cab_type'] == 'Uber'].pivot_table(index = ['name', 'distance', 'price'], values = ['id'], aggfunc = len).rename(columns = {'id' : 'count_rides'})\nover_rated_pivot.reset_index(inplace =True)\nover_rated_pivot.sort_values(by = ['count_rides', 'name'], ascending = False).head(15)","2530a079":"All of the high prices of Lyft is belongs to Lux Black XL service. Moreover, Surge Multiplier is more than 1 for all high rated rides. It means that the rate per mile is high because of accupancy in the area.","0811a76a":"Compared to Lyft rides, Uber rides has very short distances which is almost 0 with high rate per mile. They have also same prices which is 27.5. So, we assume that they are cancellations.","20f350c2":"The rides and weather data have been joined by merged_date column.","0942eeed":"Average LYFT prices are slightly higher than UBER prices especially for higher distances.","7171b25c":"# **The Average Rate per Mile**","9fea226a":"As you can see that there are 693,071 unique records. I chose the most repetitive one. All of the weather information are really similar, so I decided to make group by id.","c19a1a36":"The number of rides that is paid more than 80 dollars per mile is 414 for Uber, and 39 for Lyft.","83f2d51b":"As you can seen from the first graphs, Uber has 200 - 1400 dollars mile rate in short distances. However, the average rate per mile is around 50 dollars for Lyft.","4ca7c98f":"* The first two charts in the first row show the comparison of prices by type of service for UBER and LYFT seperately.\n* While UBER has extra service for the people with disabilities, LYFT hasn't this service.\n* LYFT Shared prices is almost 30% lower that UberPool.\n-----------\n* UBER Black Car List: BMW 5,7 - Mercedes S,G,GLC... - Audi A6, A7, A8 - Volvo XC90\n* LYFT Lux Car List: BMW 3,5,7 - Mercedes all, Audi A4,A5,... - Volvo S60, S80, S90, XC60, XC90\n* LYFT LUX BLACK Car List: BMW 5,7 - Mercedes S,G,GLC... - Audi A6, A7, A8 - Volvo XC90\n* UBER has a black car type which refers Lux and Lux Black for LYFT, so that gives the customers who want a cheapher lux option. While UBER balck around 20 dollars, LYFT lux is about 17 dollars. However, based on the car models, UBER BLACK and LYFT LUX BLACK are same, so we can say the LFYT is more expensive than UBER.\n","d82cd51a":"As we can see from the joined data information, the rides data expanded from 693,070 records to 1,268,639. The data has bee expanded because the data has been joined by hour information, but the weather data has record more than one for same hour. I will show below.","d64f5ac2":"All of the ride distances are very short and the number of rides of one specific service type are very high. So, these are cancellations and their prices.\n\n**Cancellation prices by service type**\n* WAV: 7.0\n* UberPool: 4.5\n* UberX: 7.0\n* UberXL: 8.5\n* Black: 15.0\n* Black SUV: 27.5\n\nBased on these prices, if you are not ready to go, don't call Black SUV :D","4bede1f3":"The rate per mile is excessively high for short distance rides. I will show what the reason is. ","b4be7271":"The number of rides by weekday"}}