{"cell_type":{"6298874a":"code","a7b3015d":"code","17d7a901":"code","83e911ac":"code","bb1585ce":"code","cd80617f":"code","c74e72cd":"code","a6269424":"code","c860da24":"code","15602dab":"code","6dc8c30e":"code","ef689863":"code","3822ba79":"code","95af1206":"code","f940856b":"code","45c85eb7":"code","2e131b45":"code","fd6eccff":"code","378c6245":"code","6e14b19f":"code","b5c29f13":"code","b5771b2a":"code","4816321d":"code","4d3bf1e5":"code","53ba35d6":"code","5cc82aee":"code","547bd66e":"code","0cbe0cf8":"code","cc983804":"code","3e4e6b24":"code","f9445131":"code","82960c05":"code","6d993032":"code","557e1dd3":"code","ebad77fc":"code","4c4c35a7":"code","6b3ae5a1":"code","85733559":"code","f8f2aaac":"code","8395566c":"code","50c44aa2":"code","468c2740":"code","44fca7ab":"code","fc6903a4":"code","99ba6bc2":"code","257376ea":"code","5a4db9f9":"code","67b04a13":"code","9d72e6a5":"code","4a1ab610":"code","332fc14f":"code","feebd78a":"code","e9c25c8e":"code","a0cc917c":"code","05485f9b":"code","8c05d3e3":"code","ee81fb51":"code","b0bce521":"code","c414b657":"markdown","208523ed":"markdown","af6d2c0a":"markdown","b0bc18c7":"markdown","5e25dc62":"markdown","09036df4":"markdown","16af3912":"markdown","6110c474":"markdown","44833750":"markdown","a18f05c4":"markdown","bbc3c620":"markdown","41e41d98":"markdown","0ac1c1e0":"markdown","450ba891":"markdown","75b17e1e":"markdown","59faa9fe":"markdown","d59399b4":"markdown"},"source":{"6298874a":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sn\nimport re\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.model_selection import RandomizedSearchCV\nfrom joblib import dump, load","a7b3015d":"# from google.colab import files\n# uploaded1 = files.upload()\n# uploaded2 = files.upload()","17d7a901":"df_train=pd.read_excel('train.xlsx')\ndf_test=pd.read_excel('test.xlsx')","83e911ac":"df_train.to_csv('train_flight_data.csv',index=None)\ndf_test.to_csv('test_flight_data.csv',index=None)","bb1585ce":"df_train=pd.read_csv('train_flight_data.csv')","cd80617f":"df_test =pd.read_csv('test_flight_data.csv')","c74e72cd":"df_train.head()","a6269424":"df_train.shape","c860da24":"df_train.describe()","15602dab":"airline_vc=df_train['Airline'].value_counts()\nairline_vc","6dc8c30e":"\nx_data=airline_vc.index\ny_data=airline_vc.values\nplt.figure(figsize=(8,6))\nsn.barplot(x_data,y_data)\nplt.title('Frequency of the used airline')\nplt.xticks(rotation=90)","ef689863":"df_fp = df_train[['Price','Route']]\ndf_fp['Source_des'] =df_train['Source']+'-'+df_train['Destination']","3822ba79":"df_fp.sort_values(by='Price',ascending=False).head(15)","95af1206":"x_data=df_fp['Source_des']\ny_data=df_fp['Price']\nplt.figure(figsize=(8,6))\nplt.title('Mean fares for different paths')\nsn.barplot(x_data,y_data)\nplt.xticks(rotation=90)","f940856b":"plt.title('path which has maximum traffic')\ndf_fp['Source_des'].value_counts().plot(kind='bar')\n# plt.xlabel('Source-destination')\n# plt.ylabel('Frequency of that path')\nplt.show()","45c85eb7":"df_train['Total_Stops'].value_counts()","2e131b45":"df_train['Total_Stops'].replace(['1 stop','2 stops','3 stops','4 stops','non-stop'],[1,2,3,4,0],inplace=True)","fd6eccff":"def price_vs(df_obt,col_name):\n  data=df_obt.groupby(col_name)['Price'].apply(np.mean)\n  ax=sn.barplot(data.index,data.values)\n  ax.set(xlabel=col_name,ylabel='Price')\n  plt.title('Price vs '+col_name)\n  plt.xticks(rotation=90)\n  return data\n","378c6245":"price_vs(df_train,'Total_Stops')","6e14b19f":"\nprice_vs(df_train,\"Airline\")","b5c29f13":"\n\n#Also using catplot to see which airline has the maximum fare\nsn.catplot(x=\"Airline\", y=\"Price\",data=(df_train.sort_values(by='Price',ascending=False)),kind='boxen',height=7,aspect=2)\nplt.xticks(rotation=90)","b5771b2a":"df_train['Journey_day']=pd.to_datetime(df_train['Date_of_Journey']).dt.day\ndf_train['Journey_month']=pd.to_datetime(df_train['Date_of_Journey']).dt.month","4816321d":"df_train.head(5)","4d3bf1e5":"#dropping all nan values\ndf_train=df_train.dropna()\n# It has a wrong value of trip duration only 5 min which is not possible\ndf_train.drop([6474],inplace=True,axis=0)\ndf_train.reset_index(drop=True, inplace=True)","53ba35d6":"df_train.isnull().sum()","5cc82aee":"def time_hr():\n  duration_hr=[]\n  duration_min=[]\n  data_1=df_train['Duration'].apply(lambda x:re.split('h',x))\n  data_2=df_train['Duration'].apply(lambda x:re.split('m',x))\n  for data in data_1:\n    if (data[0]=='' or data[0]==' '):\n      duration_hr.append(0)\n    else:\n      duration_hr.append(int(data[0]))\n  for data in data_2:\n    if (data[0][3:]=='' or data[0][3:]==' '):\n      duration_min.append(0)\n    else:\n      duration_min.append(int(data[0][3:]))\n  dic={'Duration_hr':duration_hr,'Duration_min':duration_min}\n  return dic\n","547bd66e":"data=pd.DataFrame(data=time_hr())\ndf_train=pd.concat([df_train,data],axis=1)","0cbe0cf8":"df_train['Departure_hour']=pd.to_datetime(df_train['Dep_Time']).dt.hour\ndf_train['Departure_minute']=pd.to_datetime(df_train['Dep_Time']).dt.minute","cc983804":"df_train.head(2)","3e4e6b24":"df_train['Additional_Info'].value_counts()\n# most of the value is no info so we can drop this column","f9445131":"df_train['Source'].value_counts()","82960c05":"df_train['Destination'].value_counts()","6d993032":"df_train['Airline'].value_counts()","557e1dd3":"df_train=pd.get_dummies(df_train,columns=['Airline','Source','Destination'],drop_first=True)","ebad77fc":"df_train.head(2)","4c4c35a7":"# Now we can del the unnecessary columns","6b3ae5a1":"df_train.drop(columns=['Date_of_Journey','Route','Dep_Time','Arrival_Time','Duration','Additional_Info'],axis=1,inplace=True)","85733559":"df_train.head(3)","f8f2aaac":"X=df_train.drop(columns=['Price'],axis=1)\ny=df_train['Price']","8395566c":"X.head(4)","50c44aa2":"scaler = StandardScaler()\nX_scaled=scaler.fit_transform(X)","468c2740":"X_train,X_test,Y_train,Y_test = train_test_split(X_scaled, y, test_size=0.20, random_state=20)","44fca7ab":"model=RandomForestRegressor()\nmodel.fit(X_train,Y_train)","fc6903a4":"predictions=model.predict(X_test).round()","99ba6bc2":"predictions","257376ea":"model.score(X_train,Y_train)","5a4db9f9":"model.score(X_test,Y_test,)","67b04a13":"#MSE (squred=true returns mse)\nprint(mean_squared_error(Y_test,predictions,squared=True))\n#RMSE (squared=false returns rmse)\nprint(mean_squared_error(Y_test,predictions,squared=False))\n","9d72e6a5":"parameters={\n    'ccp_alpha':[0,1,3],\n    'bootstrap':[True, False],\n    'max_depth':[10, 20, 30, 40, 50],\n    'max_features':['auto', 'sqrt'],\n    'min_samples_leaf':[1, 2, 4],\n    'min_samples_split':[2, 5, 10],\n    'n_estimators':[200, 400, 600, 800, 1000]\n}","4a1ab610":"# rf_randomcv=RandomizedSearchCV(model,param_distributions=parameters,n_iter=50,cv=5,scoring='neg_root_mean_squared_error',n_jobs=-1)","332fc14f":"# rf_randomcv.fit(X_train,Y_train)","feebd78a":"rf_randomcv.best_params_","e9c25c8e":"model_new=RandomForestRegressor(bootstrap=True,ccp_alpha=3,max_depth=50,max_features='auto',min_samples_leaf=1,min_samples_split=10,\n n_estimators=1600)\nmodel_new.fit(X_train,Y_train)","a0cc917c":"predictions_new=model.predict(X_test)","05485f9b":"#MSE (squred=true returns mse)\nprint(mean_squared_error(Y_test,predictions_new,squared=True))\n#RMSE (squared=false returns rmse)\nprint(mean_squared_error(Y_test,predictions_new,squared=False))","8c05d3e3":"# R^2 cofficient (1=best)\nmodel_new.score(X_test,Y_test)\n","ee81fb51":"model_new.score(X_train,Y_train)","b0bce521":"# #Saving the trained model so that it can be used next time \n# to load the model use [model = load('filename.joblib')] \ndump(model_new, 'flight_fare_predictor_model.joblib')","c414b657":"## **Hypertuning the parameters**","208523ed":"*How price varies with Time*","af6d2c0a":"Converting Date of journey column to MOnth and Date column\n\n\n\n\n","b0bc18c7":"Converting Duration column into Duration_hr and Duration_min","5e25dc62":"## **To Check which path has the highest fare and frequency**","09036df4":"## Converting Excel sheet to csv","16af3912":"# **EDA**","6110c474":"## **Dumping the model into a pickel file**","44833750":"## **Splitting of data Test,Train and training model**","a18f05c4":"## **Final Model with hypertuned parameters**","bbc3c620":"**Importing libraries**","41e41d98":"This show that jet airways is the most used airline of all\n\n","0ac1c1e0":"## \n\n\n\n","450ba891":"## **Handling Categorical Features**","75b17e1e":"***Scaling the numerical values using standarscaler***","59faa9fe":"Changing departure time column to departure_hr and departure_min","d59399b4":"*This shows that Bangalore to delhi has the highest fare and the most frequent used path is Delhi to Cochin*"}}