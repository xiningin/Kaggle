{"cell_type":{"f9938407":"code","54401db1":"code","9aceb6bd":"code","89564249":"code","710ce78e":"code","7a2c281f":"code","6c41e2af":"code","3616c3b8":"code","6979c984":"code","d06e8983":"code","e0c50465":"code","612a1627":"code","905b4a83":"code","52994699":"code","8f8d9f35":"code","767806af":"code","3effc238":"code","d43277c8":"code","0e19d612":"code","0fd433b1":"code","d2d3b205":"code","f344213a":"code","4b9cb66e":"code","6346a8f2":"code","476badc9":"code","90202647":"code","89bdf53b":"code","e24153e3":"code","201bdd8e":"code","bf3177ed":"code","ff1ebe22":"code","df5a8185":"code","2eb12510":"code","431bde8e":"code","92ca243f":"code","6c5c272f":"code","f447ca2c":"code","856fb034":"code","027b03e2":"code","a38defeb":"code","e4c9a05f":"code","caf0f16b":"markdown","d5ebfcee":"markdown","33c33928":"markdown","6cb29362":"markdown","f47ccbd0":"markdown","d5cc11b0":"markdown","b8cd8e29":"markdown","44d3551c":"markdown","c9e988ba":"markdown","a976abf6":"markdown"},"source":{"f9938407":"#improve our model by a greater extend finding the best method\n#Using different Regression Models like Random Forest Regression \/ Decision Trees Regreesion \/ Linear Regression \/ ","54401db1":"import pandas as pd\nfrom matplotlib import pyplot as plt \nimport seaborn as sns\nimport datetime as dt\nimport numpy as np\n%matplotlib inline","9aceb6bd":"df = pd.read_csv('..\/input\/covid19-in-india\/covid_19_india.csv', parse_dates=['Date'], dayfirst=True)\ndf.head()","89564249":"df = df[['Date', 'State\/UnionTerritory','Cured','Deaths','Confirmed']]\ndf.columns = ['date', 'state','cured','deaths','confirmed']\ndf.head()","710ce78e":"#lets check for a date\naugust = df[df.date == '2020-08-09']\naugust.head()","7a2c281f":"max_confirmed_cases=august.sort_values(by=\"confirmed\",ascending=False)\nmax_confirmed_cases.head()","6c41e2af":"#Visulizations","3616c3b8":"#Top 5 states affected\ntop_states_confirmed=max_confirmed_cases[0:5]","6979c984":"#Barplot\nsns.barplot(x=\"state\",y=\"confirmed\",data=top_states_confirmed,hue=\"state\",palette=\"coolwarm\")","d06e8983":"max_cases_death=august.sort_values(by=\"deaths\",ascending=False)\nmax_cases_death.head()","e0c50465":"#Top 5 states affected\ntop_states_death=max_cases_death[0:5]","612a1627":"#Bar Plot\nsns.barplot(x=\"state\",y=\"deaths\",data=top_states_death,hue=\"state\",palette=\"coolwarm\")","905b4a83":"max_cases_cured=august.sort_values(by=\"cured\",ascending=False)\nmax_cases_cured.head()","52994699":"#States with max cured cases\ntop_states_cured=max_cases_cured[0:5]","8f8d9f35":"#Bar Plot\nsns.barplot(x=\"state\",y=\"cured\",data=top_states_cured,hue=\"state\",palette=\"coolwarm\")","767806af":"up = df[df.state == 'Uttar Pradesh']\nup.head()","3effc238":"sns.lineplot(x=\"date\",y=\"confirmed\",data=up,color=\"b\")","d43277c8":"sns.lineplot(x=\"date\",y=\"deaths\",data=up,color=\"r\")","0e19d612":"#making date a feature\npd.options.mode.chained_assignment = None  # default='warn'\nimport datetime as dt\nup['date'] = pd.to_datetime(up['date'])\nup['date']=up['date'].map(dt.datetime.toordinal)\nup.head()","0fd433b1":"up.drop('state',axis=1,inplace=True)","d2d3b205":"#getting dependent variable and inpedent variable\nX=up.drop('confirmed',axis=1)\ny=up['confirmed']\nfrom sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=101)\nfrom sklearn.linear_model import LinearRegression\nlm = LinearRegression()\nlm.fit(X_train,y_train)\npredictions=lm.predict(X_test)\nplt.scatter(y_test,predictions)","f344213a":"#Checking how well the predictions are\nfrom sklearn import metrics\nprint('MAE:', metrics.mean_absolute_error(y_test, predictions))\nprint('MSE:', metrics.mean_squared_error(y_test, predictions))\nprint('RMSE:', np.sqrt(metrics.mean_squared_error(y_test, predictions)))","4b9cb66e":"#To improve our previous model","6346a8f2":"from sklearn.preprocessing import StandardScaler\nscaler = StandardScaler()\nX_train = scaler.fit_transform(X_train)\nX_test = scaler.transform(X_test)","476badc9":"#Using different models\nfrom sklearn.metrics import mean_squared_error,mean_absolute_error\nfrom sklearn.linear_model import SGDRegressor\nfrom sklearn.svm import LinearSVR\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\n\nclassifiers = [\n    SGDRegressor(max_iter=100000),\n    LinearSVR(max_iter=100000),\n    LinearRegression(),\n    DecisionTreeRegressor(),\n    RandomForestRegressor(),\n]","90202647":"#Evaluating scores by cross-validation\nfrom sklearn.model_selection import cross_val_score\nfor clf in classifiers:\n    clf.fit(X_train, y_train)\n    name = clf.__class__.__name__\n    print(\"=\"*30)\n    print(name)\n    scores = cross_val_score(clf, X_train, y_train, scoring=\"neg_mean_squared_error\", cv=10)\n    rmse_scores = np.sqrt(-scores)\n    print(\"Mean: \", scores.mean())\n    print(\"Std deviation: \", scores.std())\n    \nprint(\"=\"*30)","89bdf53b":"#Linear Regression has the least mean but lets try with Random Forest Regression as it has least Std deviation.\n#if we can change estimators and other parameters to improve our model","e24153e3":"#We will use Grid Search to get best settings(estimator) for Random Forest Regression\nfrom sklearn.model_selection import GridSearchCV\n#param_grid is for our settings lets see what fits the best\nparam_grid = [\n    {'n_estimators': [3, 10, 30,50,100,200,300]},\n      ]\nrnd_reg = RandomForestRegressor(random_state=42)\ngrid_search = GridSearchCV(rnd_reg, param_grid, cv=10,scoring=\"neg_mean_squared_error\",\n                          return_train_score=True)\ngrid_search.fit(X_train, y_train)","201bdd8e":"grid_search.best_params_","bf3177ed":"#Predictions on best Parameters\nbest_reg = grid_search.best_estimator_\ny_pred = best_reg.predict(X_test)\nfinal_mse = mean_squared_error(y_test, y_pred)\nfinal_mae=mean_absolute_error(y_test, y_pred)\nfinal_rmse = np.sqrt(final_mse)\nprint(\"Final MAE:\",final_mae)\nprint(\"Final MSE:\",final_mse)\nprint(\"Final RMSE:\",final_rmse)","ff1ebe22":"#Our Initial Predictions\nprint('Initial MAE:', metrics.mean_absolute_error(y_test, predictions))\nprint('Initial MSE:', metrics.mean_squared_error(y_test, predictions))\nprint('Initial RMSE:', np.sqrt(metrics.mean_squared_error(y_test, predictions)))","df5a8185":"#Our new model Performs much better \nprint('Reduced MAE:',(metrics.mean_absolute_error(y_test, predictions))-final_mae)\nprint('Reduced MSE:',(metrics.mean_squared_error(y_test, predictions))-final_mse)\nprint('Reduced RMSE:',np.sqrt(metrics.mean_squared_error(y_test, predictions))-final_rmse)","2eb12510":"print(\"Our original model mean: \",up['confirmed'].mean())\nprint(\"Our proposed model mean: \",predictions.mean())","431bde8e":"# It seems pretty good!","92ca243f":"#lets make a scatter plot for our new model\nplt.scatter(y_test,y_pred)","6c5c272f":"plt.figure(figsize=(20,8))\nsns.distplot((y_test-y_pred),bins=200);","f447ca2c":"# After using the below function \n\n# from sklearn.model_selection import cross_val_score\n# for clf in classifiers:\n#     clf.fit(X_train, y_train)\n#     name = clf.__class__.__name__\n#     print(\"=\"*30)\n#     print(name)\n#     scores = cross_val_score(clf, X_train, y_train, scoring=\"neg_mean_squared_error\", cv=10)\n#     rmse_scores = np.sqrt(-scores)\n#     print(\"Mean: \", scores.mean())\n#     print(\"Std deviation: \", scores.std())\n    \n# print(\"=\"*30)\n\n#Linear Regression seems to perform better than Random Forest Regression\n#But after adjucting some parameters Random Forest Regression performs much better than that!","856fb034":"#Tweak some more settings in Random Forest Regression like finding out the best estimator using the code below","027b03e2":"from sklearn.model_selection import GridSearchCV\n#param_grid is for our settings lets see what fits the best\nparam_grid = [\n    {'n_estimators': [i for i in range(100,250,10)]},\n      ]\nrnd_reg = RandomForestRegressor(random_state=42)\ngrid_search = GridSearchCV(rnd_reg, param_grid, cv=10,scoring=\"neg_mean_squared_error\",\n                          return_train_score=True)\ngrid_search.fit(X_train, y_train)","a38defeb":"grid_search.best_params_","e4c9a05f":"#Seems we found a better estimator previously it was 200\n#likewise we can add more settings like max_features to improve our model","caf0f16b":"# 3. Proposed Model ","d5ebfcee":" # 5. Conclusion","33c33928":"## 4. Result Comparison","6cb29362":"# 2. Existing Model","f47ccbd0":"### Lets Predict for Uttar Pradesh","d5cc11b0":"# 6. Future Direction","b8cd8e29":"# 1. Problem Description","44d3551c":"Checking how well the predictions are","c9e988ba":"## A Much more improved model\n    ","a976abf6":"### Lets see if we can improve our model"}}