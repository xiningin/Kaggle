{"cell_type":{"e112e8c0":"code","5d9b73ab":"code","741502cd":"code","6056a7cf":"code","c8b57b80":"code","9269ca7e":"code","eeb18451":"code","b834dbb7":"code","14b13eb4":"code","4dac9c41":"code","5320a2d3":"code","fd772082":"code","e0b329bd":"code","4b9493a7":"code","d262eb4d":"code","cb8be35f":"code","dea7a1b7":"code","e7cf8cc6":"code","9a7e50f5":"code","72ef7856":"code","9f393e9c":"code","a628a282":"code","e1ee9e2c":"code","0ab4f239":"code","214fded1":"code","a471b484":"code","6a4565b6":"code","7f567a3a":"markdown","c603d5e2":"markdown","6c7c6157":"markdown","e52d0885":"markdown","a28042d9":"markdown","44b1aebb":"markdown","875bff51":"markdown","4120fa99":"markdown","4e787a58":"markdown","bf921e3c":"markdown","0fec456b":"markdown","9253343c":"markdown","b701d8ad":"markdown","7449dcc8":"markdown"},"source":{"e112e8c0":"from tensorflow.keras.datasets import imdb\nfrom tensorflow.keras.models import Sequential, load_model, Model\nfrom tensorflow.keras.layers import Dense, Dropout, Embedding, Bidirectional, Activation, LSTM, GRU, SpatialDropout1D, Flatten, MaxPooling1D, Conv1D\nfrom tensorflow.keras import utils\nfrom tensorflow.keras.preprocessing import sequence\nfrom tensorflow.keras.preprocessing.text import Tokenizer\nfrom tensorflow.keras.preprocessing.sequence import pad_sequences\nfrom tensorflow.keras.callbacks import EarlyStopping, ModelCheckpoint, ReduceLROnPlateau\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline","5d9b73ab":"num_words=20000","741502cd":"data = np.load('..\/input\/imdb_train.npz', allow_pickle=True) \nx_train_src = data['x'] \ny_train_src = data['y']","6056a7cf":"x_test_src = np.load('..\/input\/imdb_test.npy', allow_pickle=True)","c8b57b80":"index = 0\nprint(x_train_src[index])\nprint(y_train_src[index])","9269ca7e":"maxlen = 1000","eeb18451":"x_train = pad_sequences(x_train_src, maxlen=maxlen)\nx_test = pad_sequences(x_test_src, maxlen=maxlen)","b834dbb7":"word_index = imdb.get_word_index()","14b13eb4":"!wget http:\/\/nlp.stanford.edu\/data\/glove.6B.zip -O glove.6B.zip\n!unzip glove.6B.zip","4dac9c41":"embeddings_index = dict()\nwith open('glove.6B.300d.txt', 'r') as f:\n    for line in f:\n        values = line.split()\n        word = values[0]\n        word_vector = np.asarray(values[1:], dtype='float32')\n        embeddings_index[word] = word_vector","5320a2d3":"embedding_dim = 300\nembedding_matrix = np.zeros((num_words, embedding_dim))\nfor word, i in word_index.items():\n    if i < num_words - 3:\n        embedding_vector = embeddings_index.get(word)\n        if embedding_vector is not None:\n            embedding_matrix[i + 3] = embedding_vector","fd772082":"cb_EarlyStopping = EarlyStopping(monitor='val_acc', mode='max', verbose=1, patience=10)\ncb_ModelCheckpoint = ModelCheckpoint(filepath='model.best.hdf5', monitor='val_acc', mode='max', verbose=1, save_best_only=True)\ncb_ReduceLROnPlateau = ReduceLROnPlateau(monitor='val_acc', factor=0.1, patience=3, verbose=1, mode='max', min_lr=0.00000001)","e0b329bd":"model = Sequential()\nmodel.add(Embedding(num_words, embedding_dim, input_length=maxlen))\nmodel.add(SpatialDropout1D(0.2))\nmodel.add(Conv1D(filters=128, kernel_size=3, padding='same', activation='relu'))\nmodel.add(MaxPooling1D(pool_size=2))\nmodel.add(Bidirectional(LSTM(128, dropout=0.3, recurrent_dropout=0.3)))\nmodel.add(Dense(1, activation='sigmoid'))","4b9493a7":"model.layers[0].set_weights([embedding_matrix])\nmodel.layers[0].trainable = False","d262eb4d":"model.summary()","cb8be35f":"model.compile(optimizer='rmsprop', \n              loss='binary_crossentropy', \n              metrics=['accuracy'])","dea7a1b7":"max_epochs = (9*60\/\/20)\nprint(f'Allowed epochs: {max_epochs}')","e7cf8cc6":"history = model.fit(x_train, \n                    y_train_src, \n                    epochs=max_epochs,\n                    batch_size=128,\n                    callbacks = [cb_EarlyStopping, cb_ModelCheckpoint, cb_ReduceLROnPlateau],\n                    validation_split=0.1,\n                    verbose=1)","9a7e50f5":"plt.plot(history.history['acc'], \n         label='\u0414\u043e\u043b\u044f \u0432\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u043d\u0430 \u043e\u0431\u0443\u0447\u0430\u044e\u0449\u0435\u043c \u043d\u0430\u0431\u043e\u0440\u0435')\nplt.plot(history.history['val_acc'], \n         label='\u0414\u043e\u043b\u044f \u0432\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u043d\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u0447\u043d\u043e\u043c \u043d\u0430\u0431\u043e\u0440\u0435')\nplt.xlabel('\u042d\u043f\u043e\u0445\u0430 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f')\nplt.ylabel('\u0414\u043e\u043b\u044f \u0432\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432')\nplt.legend()\nplt.show()","72ef7856":"predictions = model.predict(x_test)","9f393e9c":"predictions[:5]","a628a282":"predictions = predictions.round()","e1ee9e2c":"predictions","0ab4f239":"out = np.column_stack((range(1, predictions.shape[0]+1), predictions))","214fded1":"out[:5]","a471b484":"np.savetxt('submission.csv', out, header=\"Id,Category\", \n            comments=\"\", fmt=\"%d,%d\")","6a4565b6":"!head submission.csv","7f567a3a":"## \u0413\u043e\u0442\u043e\u0432\u0438\u043c \u0444\u0430\u0439\u043b \u0441 \u0440\u0435\u0448\u0435\u043d\u0438\u0435\u043c \u0434\u043b\u044f Kaggle","c603d5e2":"\u0414\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u044b \u0434\u043b\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u0441\u043b\u043e\u0432 20000.","6c7c6157":"1. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0448\u0430\u0431\u043b\u043e\u043d \u043d\u043e\u0443\u0442\u0431\u0443\u043a\u0430, \u0447\u0442\u043e\u0431\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043d\u0430 Kaggle.\n2. \u0417\u0430\u043c\u0435\u043d\u0438\u0442\u0435 \u043f\u043e\u043b\u043d\u043e\u0441\u0432\u044f\u0437\u043d\u0443\u044e \u0441\u0435\u0442\u044c \u043d\u0430 \u0440\u0435\u043a\u0443\u0440\u0440\u0435\u043d\u0442\u043d\u0443\u044e. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0442\u0440\u0438 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b \u0441\u0435\u0442\u0438:\n    - SimpleRNN\n    - GRU\n    - LSTM\n3. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 DropOut, \u0447\u0442\u043e\u0431\u044b \u0441\u043d\u0438\u0437\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0435:\n    * \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0432\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043b\u043e\u0439 SpatialDropout1D \u043f\u043e\u0441\u043b\u0435 \u0441\u043b\u043e\u044f Embedding\n    * \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b dropout \u0438 recurrent_dropout \u0434\u043b\u044f \u0440\u0435\u043a\u0443\u0440\u0440\u0435\u043d\u0442\u043d\u044b\u0445 \u0441\u043b\u043e\u0435\u0432\n3. \u041c\u0435\u043d\u044f\u0439\u0442\u0435 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0443 \u0441\u0435\u0442\u0438 \u0438 \u0433\u0438\u043f\u0435\u0440\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0432\u044b\u0441\u0438\u0442\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u0440\u0430\u0441\u043f\u043e\u0437\u043d\u0430\u0432\u0430\u043d\u0438\u044f \u0442\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438:\n    - \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u0435 \u0434\u043b\u0438\u043d\u0443 \u0432\u0435\u043a\u0442\u043e\u0440\u0430 \u0432 \u0441\u043b\u043e\u0435 Embedding.\n    - \u0418\u0437\u043c\u0435\u043d\u044f\u0439\u0442\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043d\u0435\u0439\u0440\u043e\u043d\u043e\u0432 \u0432 \u0440\u0435\u043a\u0443\u0440\u0440\u0435\u043d\u0442\u043d\u043e\u043c \u0441\u043b\u043e\u0435.\n    - \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u0432\u0443\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u0440\u0435\u043a\u0443\u0440\u0440\u0435\u043d\u0442\u043d\u044b\u0435 \u0441\u043b\u043e\u0438 (Bidirectional)\n    - \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u043a\u0443\u0440\u0440\u0435\u043d\u0442\u043d\u044b\u0445 \u0441\u043b\u043e\u0435\u0432 \u0432 \u0441\u0435\u0442\u0438.\n    - \u0418\u0437\u043c\u0435\u043d\u044f\u0439\u0442\u0435 \u0440\u0430\u0437\u043c\u0435\u0440 \u043c\u0438\u043d\u0438-\u0432\u044b\u0431\u043e\u0440\u043a\u0438 \u0434\u043b\u044f \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f.\n    - \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0431\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0432\u0435\u043a\u0442\u043e\u0440\u044b (GloVe, Word2Vec \u0438 \u0442.\u043f.).    \n4. \u041f\u043e\u0441\u043b\u0435 \u043f\u043e\u0434\u0431\u043e\u0440\u0430 \u043b\u0443\u0447\u0448\u0438\u0445 \u0433\u0438\u043f\u0435\u0440\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432, \u043e\u0431\u0443\u0447\u0438\u0442\u0435 \u0441\u0435\u0442\u044c \u0435\u0449\u0435 \u0440\u0430\u0437 \u043d\u0430 \u043f\u043e\u043b\u043d\u043e\u043c \u043e\u0431\u044a\u0435\u043c\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0431\u0435\u0437 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u043d\u0430 \u043e\u0431\u0443\u0447\u0430\u044e\u0449\u0438\u0439 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u0447\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440\u044b.\n5. \u0421\u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043e\u0442\u0447\u0435\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442:\n     * \u041c\u0435\u0441\u0442\u043e \u0432 \u0441\u043e\u0440\u0435\u0432\u043d\u043e\u0432\u0430\u043d\u0438\u0438, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0432\u0430\u043c \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0434\u043e\u0441\u0442\u0438\u0447\u044c\n     * \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u043e\u0439 \u0441\u0435\u0442\u0438 \u0438 \u0433\u0438\u043f\u0435\u0440\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n     * \u0421\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u043d\u043e\u0443\u0442\u0431\u0443\u043a \u0441 \u043a\u043e\u0434\u043e\u043c \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n     * \u0413\u0440\u0430\u0444\u0438\u043a \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u043d\u0430 \u043e\u0431\u0443\u0447\u0430\u044e\u0449\u0435\u043c \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u0447\u043d\u043e\u043c \u043d\u0430\u0431\u043e\u0440\u0430\u0445 \u0434\u0430\u043d\u043d\u044b\u0445","e52d0885":"\u0417\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0432 \u0444\u0430\u0439\u043b ","a28042d9":"## \u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445","44b1aebb":"## \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0442\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u043e\u0442\u0437\u044b\u0432\u043e\u0432 \u043d\u0430 \u0444\u0438\u043b\u044c\u043c\u044b \u0441 \u0441\u0430\u0439\u0442\u0430 IMDB\n\n\u0417\u0430\u043d\u044f\u0442\u0438\u0435 \u043d\u043e\u043c\u0435\u0440 \u0441\u0435\u043c\u044c \u043a\u0443\u0440\u0441\u0430 [\"\u041e\u0441\u043d\u043e\u0432\u044b \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u0445 \u0441\u0435\u0442\u0435\u0439 \u043d\u0430 Python\"](https:\/\/neural-university.ru\/neural-kurs).\n","875bff51":"## \u0420\u0430\u0441\u043f\u043e\u0437\u043d\u0430\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0442\u0435\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043d\u0430\u0431\u043e\u0440\u0430","4120fa99":"## \u0414\u043e\u043c\u0430\u0448\u043d\u0435\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u0435","4e787a58":"## \u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0434\u043b\u044f \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u043e\u0439 \u0441\u0435\u0442\u0438","bf921e3c":"\u041e\u043a\u0440\u0443\u0433\u043b\u044f\u0435\u043c \u0434\u043e 0 \u0438\u043b\u0438 1","0fec456b":"## \u041e\u0431\u0443\u0447\u0430\u0435\u043c \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u0443\u044e \u0441\u0435\u0442\u044c","9253343c":"## \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0435","b701d8ad":"## \u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043d\u0430 \u0441\u043e\u0440\u0435\u0432\u043d\u043e\u0432\u0430\u043d\u0438\u0435","7449dcc8":"## \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u043e\u0439 \u0441\u0435\u0442\u0438"}}