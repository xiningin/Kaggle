{"cell_type":{"b8c410fa":"code","caf7afca":"code","901fc464":"code","c6f14d25":"markdown","678826da":"markdown","475a6bf4":"markdown"},"source":{"b8c410fa":"import os\nimport numpy as np\nimport pandas as pd\nimport plotly.graph_objects as go","caf7afca":"submission_path = \"..\/input\/covid19-global-forecasting-submissions\/week_1\"\nsubmission_files = os.listdir(submission_path)\n\nsubmissions_list = []\n\nfor f in submission_files:\n    submission = pd.read_csv(os.path.join(submission_path, f))\n    submission.insert(0, \"SubmissionId\", int(f[:-4]))\n    submissions_list.append(submission)\n\nsubmissions = pd.concat(submissions_list, ignore_index=True, sort=False)\n# submissions\n\n# Read in solution\/test files\nwk1_solution = pd.read_csv(\"..\/input\/covid-19-forecasting-ongoing-data-updates\/wk1_solution.csv\")\nwk1_test = pd.read_csv(\"..\/input\/covid19-forecasting-week-one-launch-data\/test.csv\")\nwk1_test = wk1_test.rename(columns={\"Province\/State\": \"Province_State\", \"Country\/Region\": \"Country_Region\"})\n\n# Merge submissions to solution and test files\nwk1 = submissions.merge(wk1_test, on=\"ForecastId\", how=\"left\")\nwk1 = wk1.merge(wk1_solution, on=\"ForecastId\", how=\"left\", suffixes=(\"\", \"Actual\"))\n\n# Add ranks and scores to the submissions\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=RuntimeWarning) \nwk1.loc[:,\"FatalitiesSLE\"] = (np.log(1+wk1[\"Fatalities\"])-np.log(1+wk1[\"FatalitiesActual\"]))**2\nwk1.loc[:,\"ConfirmedCasesSLE\"] = (np.log(1+wk1[\"ConfirmedCases\"])-np.log(1+wk1[\"ConfirmedCasesActual\"]))**2\nwk1_scores = wk1[wk1[\"Usage\"]==\"Private\"][[\"SubmissionId\", \"FatalitiesSLE\", \"ConfirmedCasesSLE\"]].groupby(\"SubmissionId\").mean().reset_index()\nwk1_scores.loc[:, \"FatalatiesRMSLE\"] = np.sqrt(wk1_scores[\"FatalitiesSLE\"])\nwk1_scores.loc[:, \"ConfirmedCasesRMSLE\"] = np.sqrt(wk1_scores[\"ConfirmedCasesSLE\"])\nwk1_scores.loc[:, \"OverallRMSLE\"] = (wk1_scores[\"FatalatiesRMSLE\"]+wk1_scores[\"ConfirmedCasesRMSLE\"])\/2.0\nwk1_scores = wk1_scores.sort_values(by=\"OverallRMSLE\")\nwk1 = wk1.merge(wk1_scores[[\"SubmissionId\", \"FatalatiesRMSLE\", \"ConfirmedCasesRMSLE\", \"OverallRMSLE\"]], on=\"SubmissionId\")\nwk1_ranks = wk1[[\"SubmissionId\", \"OverallRMSLE\"]].drop_duplicates().sort_values(by=\"OverallRMSLE\")\nwk1_ranks[\"Rank\"] = list(range(1, wk1_ranks.shape[0]+1))\nwk1 = wk1.merge(wk1_ranks[[\"SubmissionId\", \"Rank\"]], on=\"SubmissionId\", how=\"inner\")","901fc464":"states = sorted(set(wk1[wk1[\"Country_Region\"]==\"US\"][\"Province_State\"]))\n\nfig=go.Figure()\n\nregion_plot_names = []\nbuttons=[]\n\ndefault_state = \"California\"\n\nfor region_name in states:\n    region = wk1[(wk1[\"Province_State\"]==region_name) & (wk1[\"Usage\"]!=\"Public\") & (wk1[\"Rank\"]<=25)]\n    region_actual = region[(region[\"SubmissionId\"]==region[\"SubmissionId\"][region.index[1]]) & (region[\"Usage\"]==\"Private\")]\n    \n    # We have two traces we're plotting per state: a boxplot of the submission quartiles, and a line with the current data to-date\n    fig.add_trace(go.Box(x=region[\"Date\"], y=region[\"Fatalities\"], visible=(region_name==default_state)))\n    fig.add_trace(go.Scatter(x=region_actual[\"Date\"], y=region_actual[\"FatalitiesActual\"], line={}, visible=(region_name==default_state)))\n  \n    region_plot_names.extend([region_name]*2)\n    \nfor region_name in states:\n    buttons.append(dict(method='update',\n                        label=region_name,\n                        args = [{'visible': [region_name==r for r in region_plot_names]}]))\n\n# Add dropdown menus to the figure\nfig.update_layout(showlegend=False, updatemenus=[{\"buttons\": buttons, \"direction\": \"down\", \"active\": states.index(default_state), \"showactive\": True, \"x\": 0.5, \"y\": 1.15}])\nfig.show()","c6f14d25":"It's surprisingly easy to use a dropdown in Plotly to change a graph, helping make a more interactive dashboard in a Python notebook. Here's a quick demo on COVID19 submission data (which has a more complete [dasbhoard here](https:\/\/www.kaggle.com\/benhamner\/covid19-forecasting-submissions-dashboard))","678826da":"The code below creates our figure! It adds two traces to the figure per state (a boxplot and a line), and sets up the dropdown menu. The menu itself works by showing only the traces corresponding to the selected state (via the \"visible\" attribute), and hiding all the remaining traces.","475a6bf4":"I'm hiding the code below, which creates the dataframe I'm using to plot and isn't relevant for the demo"}}