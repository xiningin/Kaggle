{"cell_type":{"80a8eb02":"code","eafe96bc":"code","14f02051":"code","2a08d2de":"code","28e03acd":"code","a0573e32":"markdown"},"source":{"80a8eb02":"#add paths to dataframe\nimport pandas as pd\nimport numpy as np\nhpa_data_df=pd.read_pickle(\"..\/input\/hpadata\/hpa_data_df.pkl\")\n# line to add in the image paths in the resized datasets\n# datasets not connected to notebook right now, so this will only be the image file name\n# change this later: connect datasets and run this properly!\n# hpa_data_df[\"path\"] = hpa_data_df.apply(lambda x: imgid_paths[x.ID]+\"\/\"+x.ID+\"_\"+x.cell+\".png\", axis=1)\nhpa_data_df[\"path\"] = hpa_data_df.apply(lambda x: x.ID+\"_\"+x.cell+\".png\", axis=1)\nhpa_data_df","eafe96bc":"#only take some cells from each image to reduce dataset size\nsize = 4        # cells to take from each image_id\nreplace = True  # replace if not enough cells per image\nfn = lambda obj: obj.loc[np.random.choice(obj.index, size, replace),:]\nhpa_data_df=hpa_data_df.groupby('ID', as_index=False).apply(fn)","14f02051":"hpa_data_df","2a08d2de":"print(\"unique entries: \"+str(len(hpa_data_df[\"path\"].unique())))\nprint(\"total entries: \"+str(len(hpa_data_df[\"path\"])))\nprint(\"entries to be deleted: \"+str(len(hpa_data_df[\"path\"])-len(hpa_data_df[\"path\"].unique())))","28e03acd":"hpa_data_df=hpa_data_df.drop_duplicates(subset=['path'])\nhpa_data_df","a0573e32":"#### this notebook is part of the documentation on my HPA approach  \n    -> main notebook: https:\/\/www.kaggle.com\/philipjamessullivan\/0-hpa-approach-summary\n\n# 5: make a training subset\n\nThis step takes the preprocessed hpa dataframe and outputs a reduced dataframe. Every image id can only occur a maximum of 4 times. If an id occurs less than 4 times in the overall dataframe, it also only appears that number of times in this reduced dataframe. This step is important, because training with the entire dataframe means that an epoch lasts about 45min. With this reduced dataframe, one epoch lasts about 7min.\n\n**IMPORTANT:** for reproducability, one exact subset is the only one used for training to make comparisons between training progress possible. Once it is created, it must not be switched   \n(Note: this is only a notebook for demonstration of the process. Attached is the dataset with the subset that I have created and use for my training)\n\n ## INPUT:\n**images:** all of the resized image datasets (4 x 20=80 datasets)  \n**data:** the preproccessed HPA dataframe that has labels and bounding boxes  \n         -> \"hpa_data_df.pkl\" from \"hpa-data\" dataset\n ## RESULTS:\n**dataset name:** \"gtdataframes\"  \n**file type:** 8 dataframes(pickled)  \n        -> 4 with entire data  \n        -> 4 with specific subset of data  \n**contents:** ID, Label, cell, ymax, ymin, xmax, xmin, path to resized img"}}