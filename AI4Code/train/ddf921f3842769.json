{"cell_type":{"cd16afc4":"code","6e4b3cd2":"code","6e9be478":"code","61e7fef8":"code","1a22db3c":"code","632c02cb":"code","6a201210":"code","eb162e9c":"code","1c7f3ac9":"code","082af901":"code","ea1e57cf":"code","03ed95af":"code","b7c00e29":"code","c7223ff2":"code","7601eb5b":"code","b176d877":"code","1ec4e53e":"code","c366435d":"code","d6a1d9aa":"code","d9501db1":"code","06b51fd5":"markdown","8255d891":"markdown","47a74130":"markdown","1bb24618":"markdown","82cfd259":"markdown","da32b94f":"markdown","ea7dfc41":"markdown","edf9fa47":"markdown","a8db55e3":"markdown","5e3eeb03":"markdown","0b453c16":"markdown"},"source":{"cd16afc4":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\ndf = pd.read_csv(\"..\/input\/usa-cers-dataset\/USA_cars_datasets.csv\")\ndf.head(3)\n","6e4b3cd2":"#Grabbing column names\ncolumns=df.columns.tolist()\nprint(columns)","6e9be478":"#Dropping some columns that are not useful for our EDA\ndf.drop(['Unnamed: 0','lot','vin'],axis=1,inplace=True)","61e7fef8":"#Checking missing data\ndef missing_data(data):\n    total = data.isnull().sum()\n    percent = (data.isnull().sum()\/data.isnull().count()*100)\n    tt = pd.concat([total, percent], axis=1, keys=['Total', 'Percent'])\n    types = []\n    for col in data.columns:\n        dtype = str(data[col].dtype)\n        types.append(dtype)\n    tt['Types'] = types\n    return(np.transpose(tt))\n\nmissing=missing_data(df)\nprint(missing)","1a22db3c":"#Let's check prices and mileage. If we want to deply a model in the feature, we should remove outliers from our data.\ndf.describe()","632c02cb":"import pandasql as psql\nsql=psql.sqldf","6a201210":"df=sql('''select * from df where price !=0''')","eb162e9c":"#To start our analysis, let's check which brand has more cars for sale and what is the average price\nbrand_prices=sql('''select brand, avg(price) from df group by brand order by avg(price) desc''')\nplt.figure(figsize=(25,10))\nsns.barplot(x='brand',y='avg(price)',data=brand_prices)\nplt.xticks(rotation=90)","1c7f3ac9":"#Which states have higher prices, in average?\nstate_prices=sql('''select state, avg(price) from df group by state order by avg(price) desc''')\nplt.figure(figsize=(25,10))\nsns.barplot(x='state',y='avg(price)',data=state_prices)\nplt.xticks(rotation=90)","082af901":"kentucky=sql('''select brand,model,price from df where state=\"kentucky\"''')\nprint (kentucky)","ea1e57cf":"#Lets compare Ford Prices across all the states so we can have a better picture of what's going on.\n\nford_prices=sql('''select state,brand, avg(price),count(model) from df\n                where brand=\"ford\"\n                group by state, \n                brand order by avg(price) desc''')\nprint(ford_prices.head(5))","03ed95af":"#Number of Ford on Sale\nplt.figure(figsize=(25,10))              \nsns.barplot(x='state',y='count(model)',data=ford_prices.sort_values(by=['count(model)'],ascending=False))\nplt.xticks(rotation=90)","b7c00e29":"#Avg Price per State\nplt.figure(figsize=(25,10))              \nsns.barplot(x='state',y='avg(price)',data=ford_prices)\nplt.xticks(rotation=90)","c7223ff2":"#Lets come back to exploration. I'm curious to know which models have higher mileage - without exploring I'd say the japanese brands are in the top, let's see.\nbrand_mileage=sql('''select brand,model,mileage,price from df where title_status=\"clean vehicle\" order by mileage desc''')\nprint(brand_mileage.head(10))","7601eb5b":"#Let's check mileage variation using boxplot chart.\nplt.figure(figsize=(25,10))   \nsns.boxplot(x='brand',y='mileage',data=brand_mileage)","b176d877":"#lets compare the prices by maker\n#1st let's create a new column with the region of the maker.\ndf['brand'].unique()\n\nbrands_dict={'toyota':'JPN', 'ford':'USA', 'dodge':'USA', 'chevrolet':'USA', 'gmc':'USA', 'chrysler':'USA', 'kia':'SKR',\n       'buick':'USA', 'infiniti':'JPN', 'mercedes-benz':'GER', 'jeep':'USA', 'bmw':'GER', 'cadillac':'USA',\n       'hyundai':'SKR', 'mazda':'JPN', 'honda':'JPN', 'heartland':'Other', 'jaguar':'ENG', 'acura':'JPN',\n       'harley-davidson':'USA', 'audi':'GER', 'lincoln':'USA', 'lexus':'JPN', 'nissan':'JPN', 'land':'ENG',\n       'maserati':'ITA', 'peterbilt':'USA', 'ram':'USA'}\n\ndf['brand_region']= df['brand'].map(brands_dict)","1ec4e53e":"#Scatter shot comparing mileage x price by region\nbrandregion_mileage=sql('''select brand,brand_region,mileage,price from df where title_status=\"clean vehicle\" order by mileage desc''')\nplt.figure(figsize=(25,10))              \nsns.scatterplot(x='price',y='mileage',data=brandregion_mileage,hue='brand_region')\nplt.xticks(rotation=90)","c366435d":"#most expensive car is german - What's the model and where to find it?\ntop_expensive=sql('''select brand,model,state,mileage,year, max(price) from df''')\nprint(top_expensive)","d6a1d9aa":"#To practice a little bit more SQL..Lets create a table containing the prices by region and state\n\nregion_prices=sql('''select brand,brand_region,state,max(price),min(price),count(price) from df group by brand,brand_region,state order by count(price)desc ''')\nprint(region_prices)","d9501db1":"#What's the most popular colors?\ncolors=sql('''select color,count(color) from df group by color order by count(color) desc''')\nplt.figure(figsize=(25,10))              \nsns.barplot(x='color',y='count(color)',data=colors)\nplt.xticks(rotation=90)","06b51fd5":"For this I'll use Pandasql library! \n\nPandasql allows you to query pandas DataFrames using SQL syntax. It works similarly to sqldf in R. pandasql seeks to provide a more familiar way of manipulating and cleaning data for people new to Python or pandas. I used to work for a long time with SQL and it looks more intuitive to me.","8255d891":"That's why is so expensive..it is quite new car!\n\n![f453ddf18a7b0519f396d755858d8649.png](attachment:f453ddf18a7b0519f396d755858d8649.png)","47a74130":"The quality of the data is ok and there are no missing data.","1bb24618":"The price distribution varies a lot while the mileage seems to be concentrated around the area where mileage<200000. Oh, the most expensive car is German, what a surprise, I thought it would be Italian (Masserati)","82cfd259":"Washington has only one car for sale while Kentucky has 8, that's why the average for Washington is higher. ","da32b94f":"Just one japanese brand, I'm bit surprised, they tend to be pretty reliable. The top 1 looks weird though..","ea7dfc41":"Kentucky prices seems so much higher than others? Let's investigate.\n\nHouseholds in Kentucky have a median annual income of 50,247 Dollars,which is less than the average income of 61,937 Dollars across the entire United States. This is in comparison to a median income of $48,375 in 2017, which represents a 3.87% annual growth. (Source: Google)\n","edf9fa47":"The majority of cars sold in Kentucky are ford models and they look pretty expensive! Funny enough there is a chevrolet being sold at a price tag of 25 bucks..","a8db55e3":"As we can see we have prices = 0 and a very strange mileage.. for the sake of this analysis I'll only remove the cars where prices = 0.","5e3eeb03":"That's all for the moment. I wanted to show that is possible to combine SQL (which is very useful and requested in many companies) and Python. I hope you like it.\n\n# Please upvote if you like it! I'm planning to update the kernel later with more stuff :)\n","0b453c16":"We can clearly see that some brands are more premium than others, this is the case of Harley-Davidson,Lincoln, Mercedez-Benz, Maserati, etc."}}