{"cell_type":{"c82b6964":"code","c3852723":"code","04e1225d":"code","3db87269":"code","376342e7":"code","cd455517":"code","a3eef044":"code","5f5ed2ec":"code","f0d67d6b":"code","e10511fc":"code","91deef50":"code","a844c089":"code","a1afec1b":"code","8b42749d":"code","0323b2e6":"code","341fce5a":"code","fe3f1002":"code","305e5321":"code","c0df55b8":"code","f6abade7":"code","fe4374d0":"code","d4316ffe":"code","9073f4d1":"code","371c1fcf":"code","9e797668":"code","032cc90f":"code","52331109":"code","e3ae3451":"code","9526721f":"code","9ef13fc8":"code","2e08b7a2":"markdown","2166f83b":"markdown","969df706":"markdown","30f96b4f":"markdown","d4b14220":"markdown","26d02c2e":"markdown","1e93c672":"markdown","b4ef5887":"markdown","4ed519af":"markdown","0532463c":"markdown"},"source":{"c82b6964":"import numpy as np\nimport pandas as pd\n%matplotlib inline\nimport matplotlib.pyplot as plt\nfrom sklearn.model_selection import train_test_split, GridSearchCV\nfrom sklearn.metrics import accuracy_score, confusion_matrix\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.ensemble import RandomForestClassifier\nfrom lightgbm import LGBMClassifier","c3852723":"!ls ..\/input","04e1225d":"train = pd.read_csv('..\/input\/forest-cover-type-prediction\/train.csv',\n                   index_col='Id')\ntest = pd.read_csv('..\/input\/forest-cover-type-prediction\/test.csv',\n                  index_col='Id')","3db87269":"train.head(1).T","376342e7":"train['Cover_Type'].value_counts()","cd455517":"def write_to_submission_file(predicted_labels, out_file,\n                             target='Cover_Type', index_label=\"Id\", init_index=15121):\n    # turn predictions into data frame and save as csv file\n    predicted_df = pd.DataFrame(predicted_labels,\n                                index = np.arange(init_index, \n                                                  predicted_labels.shape[0] + init_index),\n                                columns=[target])\n    predicted_df.to_csv(out_file, index_label=index_label)","a3eef044":"X_train, X_valid, y_train, y_valid = train_test_split(\n    train.drop('Cover_Type', axis=1), train['Cover_Type'],\n    test_size=0.3, random_state=17)","5f5ed2ec":"logit = LogisticRegression(C=1, solver='lbfgs', max_iter=500,\n                           random_state=17, n_jobs=4,\n                          multi_class='multinomial')\nlogit_pipe = Pipeline([('scaler', StandardScaler()), \n                       ('logit', logit)])","f0d67d6b":"%%time\nlogit_pipe.fit(X_train, y_train)","e10511fc":"logit_val_pred = logit_pipe.predict(X_valid)","91deef50":"accuracy_score(y_valid, logit_val_pred)","a844c089":"first_forest = RandomForestClassifier(\n    n_estimators=100, random_state=17, n_jobs=4)","a1afec1b":"%%time\nfirst_forest.fit(X_train, y_train)","8b42749d":"forest_val_pred = first_forest.predict(X_valid)","0323b2e6":"accuracy_score(y_valid, forest_val_pred)","341fce5a":"pd.DataFrame(first_forest.feature_importances_,\n             index=X_train.columns, columns=['Importance']).sort_values(\n    by='Importance', ascending=False)[:10]","fe3f1002":"lgb_clf = LGBMClassifier(random_state=17)","305e5321":"%%time\nlgb_clf.fit(X_train, y_train)","c0df55b8":"accuracy_score(y_valid, lgb_clf.predict(X_valid))","f6abade7":"param_grid = {'num_leaves': [7, 15, 31, 63], \n              'max_depth': [3, 4, 5, 6, -1]}","fe4374d0":"grid_searcher = GridSearchCV(estimator=lgb_clf, param_grid=param_grid, \n                             cv=5, verbose=1, n_jobs=4)","d4316ffe":"grid_searcher.fit(X_train, y_train)","9073f4d1":"grid_searcher.best_params_, grid_searcher.best_score_","371c1fcf":"accuracy_score(y_valid, grid_searcher.predict(X_valid))","9e797668":"num_iterations = 200\nlgb_clf2 = LGBMClassifier(random_state=17, max_depth=-1, \n                          num_leaves=63, n_estimators=num_iterations,\n                          n_jobs=1)\n\nparam_grid2 = {'learning_rate': np.logspace(-3, 0, 10)}\ngrid_searcher2 = GridSearchCV(estimator=lgb_clf2, param_grid=param_grid2,\n                               cv=5, verbose=1, n_jobs=4)\ngrid_searcher2.fit(X_train, y_train)\nprint(grid_searcher2.best_params_, grid_searcher2.best_score_)\nprint(accuracy_score(y_valid, grid_searcher2.predict(X_valid)))","032cc90f":"final_lgb = LGBMClassifier(n_estimators=200, num_leaves=63,\n                           learning_rate=0.2, max_depth=-1,\n                         n_jobs=4)","52331109":"%%time\nfinal_lgb.fit(train.drop('Cover_Type', axis=1), train['Cover_Type'])","e3ae3451":"%%time\nlgb_final_pred = final_lgb.predict(test)","9526721f":"write_to_submission_file(lgb_final_pred, \n                         'lgb_forest_cover_type.csv')","9ef13fc8":"pd.DataFrame(final_lgb.feature_importances_,\n             index=X_train.columns, columns=['Importance']).sort_values(\n    by='Importance', ascending=False)[:10]","2e08b7a2":"* Elevation - Elevation in meters\n* Aspect - Aspect in degrees azimuth\n* Slope - Slope in degrees\n* Horizontal_Distance_To_Hydrology - Horz Dist to nearest surface water features\n* Vertical_Distance_To_Hydrology - Vert Dist to nearest surface water features\n* Horizontal_Distance_To_Roadways - Horz Dist to nearest roadway\n* Hillshade_9am (0 to 255 index) - Hillshade index at 9am, summer solstice\n* Hillshade_Noon (0 to 255 index) - Hillshade index at noon, summer solstice\n* Hillshade_3pm (0 to 255 index) - Hillshade index at 3pm, summer solstice\n* Horizontal_Distance_To_Fire_Points - Horz Dist to nearest wildfire ignition points\n* Wilderness_Area (4 binary columns, 0 = absence or 1 = presence) - Wilderness area designation\n* Soil_Type (40 binary columns, 0 = absence or 1 = presence) - Soil Type designation\n* Cover_Type (7 types, integers 1 to 7) - Forest Cover Type designation (target)","2166f83b":"## Kaggle Forest Cover Type Prediction\n### Logistic regression, Random Forest, and LightGBM","969df706":"**Perform train-test split**","30f96b4f":"[Competition](https:\/\/www.kaggle.com\/c\/forest-cover-type-prediction). \nIn this competition you are asked to predict the forest cover type (the predominant kind of tree cover) from strictly cartographic variables (as opposed to remotely sensed data). The actual forest cover type for a given 30 x 30 meter cell was determined from US Forest Service (USFS) Region 2 Resource Information System data. Independent variables were then derived from data obtained from the US Geological Survey and USFS. The data is in raw form (not scaled) and contains binary columns of data for qualitative independent variables such as wilderness areas and soil type.\n\nfeatures (more info on [this](https:\/\/www.kaggle.com\/c\/forest-cover-type-prediction\/data) competition page):","d4b14220":"**2 stage of hyper-param tuning: convergence:**","26d02c2e":"**Feature importance:**","1e93c672":"**1 stage of hyper-param tuning: tuning model complexity**","b4ef5887":"**Import libs and load data**","4ed519af":"**Kaggle Public LB accuracy - 0.76851.**","0532463c":"**Test logistic regression**"}}