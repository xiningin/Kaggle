{"cell_type":{"712839b2":"code","84640744":"code","1988184c":"code","06aad5c4":"code","db626ef7":"code","23d41eb6":"code","2cee3fae":"code","5bfd4633":"code","2a217b1e":"code","81131435":"code","e5ac4736":"code","e8b460a4":"code","b6b2f303":"code","c39ba7e9":"code","e10e8a4c":"code","83fafe5f":"code","834271e6":"code","45d1c703":"code","e1d6e5a3":"code","c43a9401":"code","61ae82b6":"code","cd4be7ed":"code","31652708":"code","5c95e077":"code","ee856121":"code","aa5024a0":"code","faa16995":"code","78b7f9dc":"code","8305a3d8":"code","8a444df5":"code","df0c873d":"code","8edd45d0":"code","3ae59bdb":"code","2aa245fa":"code","7b7bee18":"code","d60b3ece":"code","c1203dab":"code","67dea919":"code","bb8d9ac6":"code","ea6bad90":"code","8b5cae4b":"code","8797a7d3":"code","ef77cdb9":"code","598cc08e":"code","ab472878":"code","37abee55":"code","4c31f0f9":"code","eff12fc7":"code","588a0824":"code","1aa2d1e5":"code","df17c332":"code","b837a9d7":"code","00c13d33":"code","64f6131c":"code","2739284e":"code","df4d79b7":"code","83f202cc":"code","e4cf8b72":"code","53e9a0ea":"code","5d2e1731":"code","e1e19d8b":"code","19faa2e0":"code","0f34fee1":"code","f0d2be28":"code","faa5ae65":"code","b408e78a":"code","dd6caa94":"code","d3e7d3ce":"code","e9d530b6":"code","a2666f93":"code","a44b69c7":"code","ec0b0f8d":"code","0d0b2744":"code","26b4871d":"code","ab9844e5":"markdown","672fcebf":"markdown","96e3a01e":"markdown","bf512188":"markdown","cbf348c2":"markdown","d483982d":"markdown","8a35ec3d":"markdown","8133a3a8":"markdown","5c3e7f2b":"markdown","61dcc5f2":"markdown","895e63e3":"markdown","baaa9c20":"markdown","7dbee57d":"markdown","0bc0e7d6":"markdown","138cb532":"markdown","7c567b3c":"markdown","0e731b17":"markdown","aed720c4":"markdown","947b0be5":"markdown","7d13fb94":"markdown","d25bbcfe":"markdown","761b56af":"markdown"},"source":{"712839b2":"# import libs\nimport matplotlib.pyplot as plt\nimport seaborn as sns; sns.set_style(\"whitegrid\")\n\nimport numpy as np\n\nimport pandas as pd\n\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.preprocessing import OneHotEncoder, OrdinalEncoder\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import Pipeline\n\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.ensemble import RandomForestRegressor\nfrom xgboost import XGBRegressor\nfrom sklearn.compose import TransformedTargetRegressor\n\nfrom sklearn.metrics import make_scorer\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import cross_val_score","84640744":"iowa_file_path = '\/kaggle\/input\/house-prices-advanced-regression-techniques\/train.csv'\ntest_file_path = '\/kaggle\/input\/house-prices-advanced-regression-techniques\/test.csv'\n\nhome_data = pd.read_csv(iowa_file_path, index_col=\"Id\")","1988184c":"home_data.shape","06aad5c4":"for feature_name, dtype in zip(home_data.columns, home_data.dtypes):\n    print(f\"{feature_name:12s}: {dtype}\")","db626ef7":"print(\"Before applying log\")\nprint(f\"SalePrice skew: {home_data['SalePrice'].skew():.3f}\")\nsns.distplot(home_data['SalePrice'], hist=False)\nplt.show()\nprint(\"After applying log\")\nlogy = np.log(home_data['SalePrice'])\nprint(f\"SalePrice skew: {logy.skew():.3f}\")\nsns.distplot(logy, hist=False)\nplt.show()","23d41eb6":"data = home_data.corr()[\"SalePrice\"].sort_values()[::-1]\nplt.figure(figsize=(12, 8))\nsns.barplot(x=data.values, y=data.index)\nplt.title(\"Correlation with SalePrice\")\nplt.xlim(-0.2, 1)\nplt.show()","2cee3fae":"data = home_data.pivot_table(index=\"OverallQual\", values=\"SalePrice\", aggfunc=\"mean\")\nsns.barplot(x=data.index, y=data[\"SalePrice\"])\nplt.show()","5bfd4633":"data = home_data[[\"GrLivArea\", \"SalePrice\"]]\nsns.regplot(x=np.log(data[\"GrLivArea\"]), y=np.log(data[\"SalePrice\"]))\nplt.show()","2a217b1e":"sns.regplot(x=\"GarageArea\", y=\"SalePrice\", data=home_data[[\"GarageArea\", \"SalePrice\"]])\nplt.xlim(0, 1500)\nplt.ylim(0, 800000)\nplt.show()\ndata = home_data[[\"GarageArea\", \"SalePrice\"]]\ndata = data[data[\"GarageArea\"] > 0]\nsns.regplot(x=\"GarageArea\", y=\"SalePrice\", data=data)\nplt.xlim(0, 1500)\nplt.ylim(0, 800000)\nplt.show()","81131435":"data_tmp = pd.DataFrame(columns=[\"GarageArea\", \"SalePrice\"])\nfor garage_area, sale_price in home_data[[\"GarageArea\", \"SalePrice\"]].values:\n    data_tmp = data_tmp.append(pd.DataFrame([[\">0\" if garage_area > 0 else \"=0\", sale_price]], columns=data_tmp.columns))\ndata_tmp[\"SalePrice\"] = data_tmp[\"SalePrice\"].apply(float)\nsns.boxplot(x=\"GarageArea\", y=\"SalePrice\", data=data_tmp)\nplt.show()","e5ac4736":"data = home_data[[\"GarageCars\", \"SalePrice\"]]\nsns.boxplot(data[\"GarageCars\"], y=data[\"SalePrice\"])\nplt.show()\ndata = home_data[\"GarageCars\"].value_counts()\nprint(\"GarageCars: Entries count\")\nprint(data)\nsns.barplot(x=data.index, y=data.values)\nplt.show()","e8b460a4":"data = home_data[[\"MSZoning\", \"SalePrice\"]]\nsns.boxplot(x=\"MSZoning\", y=\"SalePrice\", data=data)\nplt.show()","b6b2f303":"data = home_data[[\"Alley\", \"SalePrice\"]]\nsns.boxplot(x=\"Alley\", y=\"SalePrice\", data=data)\nplt.show()","c39ba7e9":"data = home_data[[\"LotShape\", \"SalePrice\"]]\nsns.boxplot(x=\"LotShape\", y=\"SalePrice\", data=data)\nplt.show()","e10e8a4c":"data = home_data[[\"LandContour\", \"SalePrice\"]]\nsns.boxplot(x=\"LandContour\", y=\"SalePrice\", data=data)\nplt.show()","83fafe5f":"data = home_data[[\"Utilities\", \"SalePrice\"]]\nsns.boxplot(x=\"Utilities\", y=\"SalePrice\", data=data)\nplt.show()","834271e6":"data = home_data[[\"LotConfig\", \"SalePrice\"]]\nsns.boxplot(x=\"LotConfig\", y=\"SalePrice\", data=data)\nplt.show()","45d1c703":"data = home_data[[\"LandSlope\", \"SalePrice\"]]\nsns.boxplot(x=\"LandSlope\", y=\"SalePrice\", data=data)\nplt.show()","e1d6e5a3":"## Neighborhood\ndata = home_data[[\"Neighborhood\", \"SalePrice\"]]\nplt.figure(figsize=(10, 5))\nsns.boxplot(x=\"Neighborhood\", y=\"SalePrice\", data=data)\nplt.show()","c43a9401":"## Condition1\ndata = home_data[[\"Condition1\", \"SalePrice\"]]\nsns.boxplot(x=\"Condition1\", y=\"SalePrice\", data=data)\nplt.show()","61ae82b6":"## Condition2\ndata = home_data[[\"Condition2\", \"SalePrice\"]]\nsns.boxplot(x=\"Condition2\", y=\"SalePrice\", data=data)\nplt.show()","cd4be7ed":"## BldgType\ndata = home_data[[\"BldgType\", \"SalePrice\"]]\nsns.boxplot(x=\"BldgType\", y=\"SalePrice\", data=data)\nplt.show()","31652708":"## HouseStyle\ndata = home_data[[\"HouseStyle\", \"SalePrice\"]]\nsns.boxplot(x=\"HouseStyle\", y=\"SalePrice\", data=data)\nplt.show()","5c95e077":"## RoofStyle\ndata = home_data[[\"RoofStyle\", \"SalePrice\"]]\nsns.boxplot(x=\"RoofStyle\", y=\"SalePrice\", data=data)\nplt.show()","ee856121":"## RoofMatl\ndata = home_data[[\"RoofMatl\", \"SalePrice\"]]\nsns.boxplot(x=\"RoofMatl\", y=\"SalePrice\", data=data)\nplt.show()","aa5024a0":"## Exterior1st\ndata = home_data[[\"Exterior1st\", \"SalePrice\"]]\nsns.boxplot(x=\"Exterior1st\", y=\"SalePrice\", data=data)\nplt.show()","faa16995":"## Exterior2nd\ndata = home_data[[\"Exterior2nd\", \"SalePrice\"]]\nsns.boxplot(x=\"Exterior2nd\", y=\"SalePrice\", data=data)\nplt.show()","78b7f9dc":"## MasVnrType\ndata = home_data[[\"MasVnrType\", \"SalePrice\"]]\nsns.boxplot(x=\"MasVnrType\", y=\"SalePrice\", data=data)\nplt.show()","8305a3d8":"## ExterQual\ndata = home_data[[\"ExterQual\", \"SalePrice\"]]\nsns.boxplot(x=\"ExterQual\", y=\"SalePrice\", data=data)\nplt.show()","8a444df5":"## ExterCond\ndata = home_data[[\"ExterCond\", \"SalePrice\"]]\nsns.boxplot(x=\"ExterCond\", y=\"SalePrice\", data=data)\nplt.show()","df0c873d":"## Foundation\ndata = home_data[[\"Foundation\", \"SalePrice\"]]\nsns.boxplot(x=\"Foundation\", y=\"SalePrice\", data=data)\nplt.show()","8edd45d0":"## BsmtQual\ndata = home_data[[\"BsmtQual\", \"SalePrice\"]]\nsns.boxplot(x=\"BsmtQual\", y=\"SalePrice\", data=data)\nplt.show()","3ae59bdb":"## BsmtCond\ndata = home_data[[\"BsmtCond\", \"SalePrice\"]]\nsns.boxplot(x=\"BsmtCond\", y=\"SalePrice\", data=data)\nplt.show()","2aa245fa":"## BsmtExposure\ndata = home_data[[\"BsmtExposure\", \"SalePrice\"]]\nsns.boxplot(x=\"BsmtExposure\", y=\"SalePrice\", data=data)\nplt.show()","7b7bee18":"## BsmtFinType1\ndata = home_data[[\"BsmtFinType1\", \"SalePrice\"]]\nsns.boxplot(x=\"BsmtFinType1\", y=\"SalePrice\", data=data)\nplt.show()","d60b3ece":"## BsmtFinType2\ndata = home_data[[\"BsmtFinType2\", \"SalePrice\"]]\nsns.boxplot(x=\"BsmtFinType2\", y=\"SalePrice\", data=data)\nplt.show()","c1203dab":"## Heating\ndata = home_data[[\"Heating\", \"SalePrice\"]]\nsns.boxplot(x=\"Heating\", y=\"SalePrice\", data=data)\nplt.show()","67dea919":"## HeatingQC\ndata = home_data[[\"HeatingQC\", \"SalePrice\"]]\nsns.boxplot(x=\"HeatingQC\", y=\"SalePrice\", data=data)\nplt.show()","bb8d9ac6":"## CentralAir\ndata = home_data[[\"CentralAir\", \"SalePrice\"]]\nsns.boxplot(x=\"CentralAir\", y=\"SalePrice\", data=data)\nplt.show()","ea6bad90":"## Electrical\ndata = home_data[[\"Electrical\", \"SalePrice\"]]\nsns.boxplot(x=\"Electrical\", y=\"SalePrice\", data=data)\nplt.show()","8b5cae4b":"## KitchenQual\ndata = home_data[[\"KitchenQual\", \"SalePrice\"]]\nsns.boxplot(x=\"KitchenQual\", y=\"SalePrice\", data=data)\nplt.show()","8797a7d3":"## Functional\ndata = home_data[[\"Functional\", \"SalePrice\"]]\nsns.boxplot(x=\"Functional\", y=\"SalePrice\", data=data)\nplt.show()","ef77cdb9":"## FireplaceQu\ndata = home_data[[\"FireplaceQu\", \"SalePrice\"]]\nsns.boxplot(x=\"FireplaceQu\", y=\"SalePrice\", data=data)\nplt.show()","598cc08e":"## GarageType\ndata = home_data[[\"GarageType\", \"SalePrice\"]]\nsns.boxplot(x=\"GarageType\", y=\"SalePrice\", data=data)\nplt.show()","ab472878":"## GarageFinish\ndata = home_data[[\"GarageFinish\", \"SalePrice\"]]\nsns.boxplot(x=\"GarageFinish\", y=\"SalePrice\", data=data)\nplt.show()","37abee55":"## GarageQual\ndata = home_data[[\"GarageQual\", \"SalePrice\"]]\nsns.boxplot(x=\"GarageQual\", y=\"SalePrice\", data=data)\nplt.show()","4c31f0f9":"## GarageCond\ndata = home_data[[\"GarageCond\", \"SalePrice\"]]\nsns.boxplot(x=\"GarageCond\", y=\"SalePrice\", data=data)\nplt.show()","eff12fc7":"## PavedDrive\ndata = home_data[[\"PavedDrive\", \"SalePrice\"]]\nsns.boxplot(x=\"PavedDrive\", y=\"SalePrice\", data=data)\nplt.show()","588a0824":"## PoolQC\ndata = home_data[[\"PoolQC\", \"SalePrice\"]]\nsns.boxplot(x=\"PoolQC\", y=\"SalePrice\", data=data)\nplt.show()","1aa2d1e5":"## Fence\ndata = home_data[[\"Fence\", \"SalePrice\"]]\nsns.boxplot(x=\"Fence\", y=\"SalePrice\", data=data)\nplt.show()","df17c332":"## MiscFeature\ndata = home_data[[\"MiscFeature\", \"SalePrice\"]]\nsns.boxplot(x=\"MiscFeature\", y=\"SalePrice\", data=data)\nplt.show()","b837a9d7":"## SaleType\ndata = home_data[[\"SaleType\", \"SalePrice\"]]\nsns.boxplot(x=\"SaleType\", y=\"SalePrice\", data=data)\nplt.show()","00c13d33":"## SaleCondition\ndata = home_data[[\"SaleCondition\", \"SalePrice\"]]\nsns.boxplot(x=\"SaleCondition\", y=\"SalePrice\", data=data)\nplt.show()","64f6131c":"nulls = pd.DataFrame(home_data.isnull().sum().sort_values(ascending=False))\nnulls.columns = [\"Null count\"]\nnulls[\"Unique\"] = home_data[nulls.index].nunique()\nnulls[\"dtype\"] = home_data[nulls.index].dtypes\nnulls[nulls[\"Null count\"] > 0]","2739284e":"home_data[\"GarageArea=0\"] = (home_data[\"GarageArea\"] == 0).apply(float)\nhome_data[\"GarageCars=4\"] = (home_data[\"GarageCars\"] == 4).apply(float)\nhome_data[\"MSSubClass\"] = home_data[\"MSSubClass\"].apply(str)\n\nhome_data[\"NotHasBasement\"] = home_data[\"BsmtExposure\"].isnull()\nhome_data[\"BsmtExposure\"] = home_data[\"BsmtExposure\"].fillna(\"NoBasement\")\nhome_data[\"BsmtQual\"] = home_data[\"BsmtQual\"].fillna(\"NoBasement\")\nhome_data[\"BsmtCond\"] = home_data[\"BsmtCond\"].fillna(\"NoBasement\")\nhome_data[\"BsmtFinType1\"] = home_data[\"BsmtFinType1\"].fillna(\"NoBasement\")\nhome_data[\"BsmtFinType2\"] = home_data[\"BsmtFinType2\"].fillna(\"NoBasement\")\n\nhome_data[\"NotHasFireplace\"] = home_data[\"FireplaceQu\"].isnull()\nhome_data[\"FireplaceQu\"] = home_data[\"FireplaceQu\"].fillna(\"NoFireplace\")\n\nhome_data[\"NotHasGarage\"] = home_data[\"GarageFinish\"].isnull()\nhome_data[\"GarageFinish\"] = home_data[\"GarageFinish\"].fillna(\"NoGarage\")\nhome_data[\"GarageQual\"] = home_data[\"GarageQual\"].fillna(\"NoGarage\")\nhome_data[\"GarageType\"] = home_data[\"GarageType\"].fillna(\"NoGarage\")\nhome_data[\"GarageCond\"] = home_data[\"GarageCond\"].fillna(\"NoGarage\")\n\nhome_data[\"NotHasPool\"] = home_data[\"PoolQC\"].isnull()\nhome_data[\"PoolQC\"] = home_data[\"PoolQC\"].fillna(\"NoPool\")\n\nhome_data[\"NotHasFence\"] = home_data[\"Fence\"].isnull()\nhome_data[\"Fence\"] = home_data[\"Fence\"].fillna(\"NoFence\")\n\nhome_data[\"NotHasKitchen\"] = home_data[\"KitchenQual\"].isnull()\nhome_data[\"KitchenQual\"] = home_data[\"KitchenQual\"].fillna(\"NoKitchen\")\n\n#home_data[\"MiscFeature\"] = home_data[\"MiscFeature\"].fillna(\"NA\")\n#home_data[\"Alley\"] = home_data[\"Alley\"].fillna(\"NA\")\n#home_data[\"LotFrontage\"] = home_data[\"LotFrontage\"].fillna(home_data[\"LotFrontage\"].min())\n#home_data[\"GarageYrBlt\"] = home_data[\"GarageYrBlt\"].fillna(home_data[\"GarageYrBlt\"].min())\n#home_data[\"MasVnrType\"] = home_data[\"MasVnrType\"].fillna(\"NA\")\n#home_data[\"MasVnrArea\"] = home_data[\"MasVnrArea\"].fillna(home_data[\"MasVnrArea\"].min())\n#home_data[\"Electrical\"] = home_data[\"Electrical\"].fillna(\"NA\")","df4d79b7":"def show_nulls(df):\n    nulls = pd.DataFrame(df.isnull().sum().sort_values(ascending=False))\n    nulls.columns = [\"Null count\"]\n    nulls[\"Unique\"] = df[nulls.index].nunique()\n    nulls[\"dtype\"] = df[nulls.index].dtypes\n    return nulls[nulls[\"Null count\"] > 0]\nshow_nulls(home_data)","83f202cc":"y = home_data[\"SalePrice\"].values\nX = home_data.drop(\"SalePrice\", axis=1)","e4cf8b72":"models_performance = pd.DataFrame(columns=[\"Model\", \"CV\", \"Full\"])\n\ndef calc_score(y_true, y_pred):\n    logy_true = np.log1p(y_true)\n    logy_pred = np.log1p(y_pred)\n    return np.sqrt(np.sum((logy_true - logy_pred) ** 2) \/ y_true.shape[0]) \n\ndef test_pipeline(pipeline, name=\"Unnamed\"):\n    # Uncomment when commit\n    return\n    scores = cross_val_score(pipeline, X, y, cv=10, scoring=make_scorer(calc_score))\n    print(f\"Mean CV score: {scores.mean():,.5f}\")\n\n    pipeline.fit(X, y)\n    full_score = calc_score(y, pipeline.predict(X))\n    print(f\"Full score: {full_score:,.5f}\")\n    \n    global models_performance\n    models_performance = models_performance.append(pd.DataFrame([[name, scores.mean(), full_score]], columns=models_performance.columns))","53e9a0ea":"def log_model(model):\n    return TransformedTargetRegressor(model, func=np.log1p, inverse_func=np.expm1)","5d2e1731":"numerical_cols = X.select_dtypes(exclude=['object']).columns\nordinal_cols = [\"LotShape\", \"LandContour\", \"LandSlope\", \"ExterQual\", \"ExterCond\", \"BsmtQual\", \"BsmtCond\", \"BsmtExposure\", \"BsmtFinType1\", \"BsmtFinType2\", \"HeatingQC\", \"CentralAir\", \"KitchenQual\", \"FireplaceQu\", \"GarageFinish\", \"GarageQual\", \"GarageCond\", \"PavedDrive\", \"PoolQC\", \"Fence\"]\ncategorical_cols = [col for col in X.select_dtypes(include=[\"object\"]).columns if col not in ordinal_cols]\n\n# Impute numerical features with mean\n# Impute categoricals and onehot encode them\npreprocessor = ColumnTransformer(transformers=[\n    ('num', SimpleImputer(strategy='mean'), numerical_cols),\n    ('cat', Pipeline(steps=[\n        ('imputer', SimpleImputer(strategy='constant')),\n        ('onehot', OneHotEncoder(handle_unknown='ignore'))\n    ]), categorical_cols)\n##     ('num', SimpleImputer(strategy='mean', verbose=2), numerical_cols),\n##     ('imp', SimpleImputer(strategy='constant', verbose=2), ordinal_cols),\n##     ('const', SimpleImputer(strategy='constant', verbose=2), categorical_cols),\n##     ('onehot encode', OneHotEncoder(handle_unknown='ignore'), categorical_cols)\n#     ('encode Street', OrdinalEncoder(categories=[[\"Grvl\", \"Pave\"]]), [\"Street\"]),\n#     ('encode LotShape', OrdinalEncoder(categories=[[\"Reg\", \"IR1\", \"IR2\", \"IR3\"]]), [\"LotShape\"]),\n#     ('encode LandContour', OrdinalEncoder(categories=[[\"Lvl\", \"Bnk\", \"HLS\", \"Low\"]]), [\"LandContour\"]),\n#     ('encode LandSlope', OrdinalEncoder(categories=[[\"Gtl\", \"Mod\", \"Sev\"]]), [\"LandSlope\"]),\n#     ('encode ExterQual', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\"]]), [\"ExterQual\"]),\n#     ('encode ExterCond', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\"]]), [\"ExterCond\"]),\n#     ('encode BsmtQual', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\", \"NoBasement\"]]), [\"BsmtQual\"]),\n#     ('encode BsmtCond', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\", \"NoBasement\"]]), [\"BsmtCond\"]),\n#     ('encode BsmtExposure', OrdinalEncoder(categories=[[\"Gd\", \"Av\", \"Mn\", \"No\", \"NoBasement\"]]), [\"BsmtExposure\"]),\n#     ('encode BsmtFinType1', OrdinalEncoder(categories=[[\"GLQ\", \"ALQ\", \"BLQ\", \"Rec\", \"LwQ\", \"Unf\", \"NoBasement\"]]), [\"BsmtFinType1\"]),\n#     ('encode BsmtFinType2', OrdinalEncoder(categories=[[\"GLQ\", \"ALQ\", \"BLQ\", \"Rec\", \"LwQ\", \"Unf\", \"NoBasement\"]]), [\"BsmtFinType2\"]),\n#     ('encode HeatingQC', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\"]]), [\"HeatingQC\"]),\n#     ('encode CentralAir', OrdinalEncoder(categories=[[\"Y\", \"N\"]]), [\"CentralAir\"]),\n#     ('encode KitchenQual', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\"]]), [\"KitchenQual\"]),\n#     ('encode FireplaceQu', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\", \"NoFireplace\"]]), [\"FireplaceQu\"]),\n#     ('encode GarageFinish', OrdinalEncoder(categories=[[\"Fin\", \"RFn\", \"Unf\", \"NoGarage\"]]), [\"GarageFinish\"]),\n#     ('encode GarageQual', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\", \"NoGarage\"]]), [\"GarageQual\"]),\n#     ('encode GarageCond', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\", \"NoGarage\"]]), [\"GarageCond\"]),\n#     ('encode PavedDrive', OrdinalEncoder(categories=[[\"Y\", \"P\", \"N\"]]), [\"PavedDrive\"]),\n#     ('encode PoolQC', OrdinalEncoder(categories=[[\"Ex\", \"Gd\", \"TA\", \"Fa\", \"Po\", \"NoPool\"]]), [\"PoolQC\"]),\n#     ('encode Fence', OrdinalEncoder(categories=[[\"GdPrv\", \"MnPrv\", \"GdWo\", \"MnWw\", \"NoFence\"]]), [\"Fence\"])\n])","e1e19d8b":"lin2_pipeline = Pipeline(steps=[\n    ('preprocessor', preprocessor),\n    ('model', log_model(LinearRegression()))\n])\n\ntest_pipeline(lin2_pipeline, \"Linear regression[1]\")","19faa2e0":"xg_pipeline = Pipeline(steps=[\n    ('preprocessor', preprocessor),\n    ('model', log_model(XGBRegressor(n_estimators=500, objective='reg:squarederror')))\n])\n\ntest_pipeline(xg_pipeline, \"XGBoost[1]\")","0f34fee1":"from sklearn.ensemble import GradientBoostingRegressor\n\ngbr_pipeline = Pipeline(steps=[\n    ('preprocessor', preprocessor),\n    ('model', log_model(GradientBoostingRegressor()))\n])\n\ntest_pipeline(gbr_pipeline, \"GradientBoostingRegressor[1]\")","f0d2be28":"random_fores_pipeline = Pipeline(steps=[\n    ('preprocessor', preprocessor),\n    ('model', log_model(RandomForestRegressor(n_estimators=100, random_state=1)))\n])\n\ntest_pipeline(random_fores_pipeline, \"Random forest[1]\")","faa5ae65":"from lightgbm import LGBMRegressor\n\nlightgbm_pipeline = Pipeline(steps=[\n    ('preprocessor', preprocessor),\n    ('model', log_model(LGBMRegressor()))\n])\n\ntest_pipeline(lightgbm_pipeline, \"LightGBM[1]\")","b408e78a":"from sklearn.base import BaseEstimator\n\nclass Stacked(BaseEstimator):\n    def __init__(self, models, stacker):\n        self.models = models\n        self.stacker = stacker\n    def _meta_predict(self, X):\n        metaX = []\n        for model in self.models:\n            fX = model.predict(X)\n            metaX.append(fX)\n        return np.vstack(metaX).T\n    def fit(self, X, y):\n        for model in self.models:\n            model.fit(X, y)\n        finX = self._meta_predict(X)\n        self.stacker.fit(finX, y)\n    def predict(self, X):\n        finX = self._meta_predict(X)\n        return np.abs(self.stacker.predict(finX))\n\nstacked_model = Stacked([xg_pipeline, lightgbm_pipeline], LinearRegression())\ntest_pipeline(stacked_model, \"LinearRegression(XGBoost, LightGBM)\")","dd6caa94":"from sklearn.neural_network import MLPRegressor\n\nclass Stacked(BaseEstimator):\n    def __init__(self, models, stacker):\n        self.models = models\n        self.stacker = stacker\n    def _meta_predict(self, X):\n        metaX = []\n        for model in self.models:\n            fX = model.predict(X)\n            metaX.append(fX)\n        return np.vstack(metaX).T\n    def fit(self, X, y):\n        for model in self.models:\n            model.fit(X, y)\n        finX = self._meta_predict(X)\n        self.stacker.fit(finX, y)\n    def predict(self, X):\n        finX = self._meta_predict(X)\n        return np.abs(self.stacker.predict(finX))\n\nstacked_model2020 = Stacked([xg_pipeline, lightgbm_pipeline], MLPRegressor(learning_rate_init=0.01))\ntest_pipeline(stacked_model2020, \"NN(XGBoost, LightGBM)\")","d3e7d3ce":"class Stacked2(BaseEstimator):\n    def __init__(self, models, stacker):\n        self.models = models\n        self.stacker = stacker\n    def _meta_predict(self, X):\n        metaX = [preprocessor.transform(X)]\n        for model in self.models:\n            fX = model.predict(X)\n            metaX.append(fX.reshape(fX.shape[0], 1))\n        return np.concatenate(metaX, axis=1)\n    def fit(self, X, y):\n        for model in self.models:\n            model.fit(X, y)\n        finX = self._meta_predict(X)\n        self.stacker.fit(finX, y)\n    def predict(self, X):\n        finX = self._meta_predict(X)\n        return np.abs(self.stacker.predict(finX))\n\nstacked_model3 = Stacked2([xg_pipeline, lightgbm_pipeline], LinearRegression())\n#test_pipeline(stacked_model3, \"Stacked(XGBoost, LightGBM)\")","e9d530b6":"stacked_model4 = Stacked([xg_pipeline, gbr_pipeline], LinearRegression())\ntest_pipeline(stacked_model4, \"Stacked(XGBoost, GradientBoostingRegressor)\")","a2666f93":"models_performance.sort_values(\"CV\")","a44b69c7":"test_X = pd.read_csv(test_file_path, index_col='Id')\ntest_X[\"GarageArea=0\"] = (test_X[\"GarageArea\"] == 0).apply(float)\ntest_X[\"GarageCars=4\"] = (test_X[\"GarageCars\"] == 4).apply(float)\ntest_X[\"MSSubClass\"] = test_X[\"MSSubClass\"].apply(str)\n\ntest_X[\"NotHasBasement\"] = test_X[\"BsmtExposure\"].isnull()\ntest_X[\"BsmtExposure\"] = test_X[\"BsmtExposure\"].fillna(\"NoBasement\")\ntest_X[\"BsmtQual\"] = test_X[\"BsmtQual\"].fillna(\"NoBasement\")\ntest_X[\"BsmtCond\"] = test_X[\"BsmtCond\"].fillna(\"NoBasement\")\ntest_X[\"BsmtFinType1\"] = test_X[\"BsmtFinType1\"].fillna(\"NoBasement\")\ntest_X[\"BsmtFinType2\"] = test_X[\"BsmtFinType2\"].fillna(\"NoBasement\")\n\ntest_X[\"NotHasFireplace\"] = test_X[\"FireplaceQu\"].isnull()\ntest_X[\"FireplaceQu\"] = test_X[\"FireplaceQu\"].fillna(\"NoFireplace\")\n\ntest_X[\"NotHasGarage\"] = test_X[\"GarageFinish\"].isnull()\ntest_X[\"GarageFinish\"] = test_X[\"GarageFinish\"].fillna(\"NoGarage\")\ntest_X[\"GarageQual\"] = test_X[\"GarageQual\"].fillna(\"NoGarage\")\ntest_X[\"GarageType\"] = test_X[\"GarageType\"].fillna(\"NoGarage\")\ntest_X[\"GarageCond\"] = test_X[\"GarageCond\"].fillna(\"NoGarage\")\n\ntest_X[\"NotHasPool\"] = test_X[\"PoolQC\"].isnull()\ntest_X[\"PoolQC\"] = test_X[\"PoolQC\"].fillna(\"NoPool\")\n\ntest_X[\"NotHasFence\"] = test_X[\"Fence\"].isnull()\ntest_X[\"Fence\"] = test_X[\"Fence\"].fillna(\"NoFence\")\n\ntest_X[\"NotHasKitchen\"] = test_X[\"KitchenQual\"].isnull()\ntest_X[\"KitchenQual\"] = test_X[\"KitchenQual\"].fillna(\"NoKitchen\")\n\nbest_pipeline = stacked_model2020\nbest_pipeline.fit(X, y)\npred_y = best_pipeline.predict(test_X)\n\noutput = pd.DataFrame({\n    'Id': test_X.index,\n    'SalePrice': pred_y\n})\noutput.to_csv('submission.csv', index=False)\n!head -n5 submission.csv","ec0b0f8d":"show_nulls(test_X)","0d0b2744":"tft =  test_X\nfor vals in [tft[col].unique() for col in tft]:\n    if None in vals:\n        print(vals)","26b4871d":"prp = ColumnTransformer(transformers=[\n    ('num', SimpleImputer(strategy='mean'), numerical_cols),\n    ('const', SimpleImputer(strategy='constant'), categorical_cols)#,\n    #('onehot encode', OneHotEncoder(handle_unknown='ignore'), categorical_cols)\n])\ntft =  pd.DataFrame(prp.fit_transform(test_X))\nfor vals in [tft[col].unique() for col in tft]:\n    print(vals)","ab9844e5":"## Utilities","672fcebf":"## LotShape","96e3a01e":"## Null values research","bf512188":"## LandContour","cbf348c2":"SalePrice distribution is log-normal distributed, so it is reasonable to apply log to it before making model","d483982d":"## XGBoost","8a35ec3d":"## Linear regression","8133a3a8":"## MSZoning","5c3e7f2b":"## GarageArea","61dcc5f2":"## Alley","895e63e3":"## Stack XGBoost and LightGBM using linear regression","baaa9c20":"Function to transform model into model predicting log(target)","7dbee57d":"## SalePrice(target)","0bc0e7d6":"## LotConfig","138cb532":"## GrLiveArea","7c567b3c":"# Modelling","0e731b17":"## GarageCars","aed720c4":"## RandomForest","947b0be5":"# Data exploration","7d13fb94":"## OverallQual","d25bbcfe":"## LightGBM","761b56af":"Correlation with numerical features"}}