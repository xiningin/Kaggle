{"cell_type":{"9386210b":"code","18501352":"code","616a934e":"code","fcd4658a":"code","973e8432":"code","873fbbad":"code","4d6dd2c1":"code","6a77d11a":"code","eeda605d":"code","3aef83d1":"code","8148e2cd":"code","93d59295":"code","0137391f":"code","ab6d7a13":"code","d7db3606":"code","125522b2":"code","92156ef1":"code","ac6d2467":"code","d86d1c4f":"code","6afb74fc":"code","acddd687":"code","27754ef6":"code","36dd7993":"code","eec548df":"code","6a26ea01":"code","788bf002":"code","b46625d2":"code","49d3a6d9":"code","7e8682fb":"code","9406a353":"code","3d3aef39":"code","7e3a4292":"code","39da464e":"code","eb0c09fa":"code","68948efe":"code","cc83c394":"code","ddcd8295":"code","5dfbcae7":"code","a5540e12":"code","8159006b":"code","4d64aba9":"markdown","4bc8088b":"markdown","f5b75bf2":"markdown","9cfe5408":"markdown","b2b6a00d":"markdown","81c540c0":"markdown","44351710":"markdown","43721fdf":"markdown","f0222aa5":"markdown","c053bf5b":"markdown","07a15805":"markdown","a7c082d4":"markdown","2d904870":"markdown","3aa05c47":"markdown","2f9771b1":"markdown","9973e5a6":"markdown","7ff296fb":"markdown","17109288":"markdown","c7b5207d":"markdown","eaf56d0b":"markdown","0789d688":"markdown","0ffa17d1":"markdown","d2abdd83":"markdown","36a01b49":"markdown","35c6083e":"markdown","62f6d555":"markdown","1692ad72":"markdown","588a3f78":"markdown","31b6ce16":"markdown","a093f4be":"markdown","c7b8e168":"markdown","c774544d":"markdown","fc6caad2":"markdown"},"source":{"9386210b":"import pandas as pd\nimport numpy as np\n%matplotlib inline\nimport matplotlib.pyplot as plt\nfrom tqdm.notebook import tqdm\nimport seaborn as sns\nsns.set_style(\"darkgrid\")\nfrom sklearn.model_selection import train_test_split, GridSearchCV\nfrom sklearn.metrics import make_scorer, accuracy_score, f1_score\nfrom catboost import CatBoostClassifier\nfrom catboost import Pool, cv\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n","18501352":"heart = pd.read_csv('..\/input\/heart-attack-analysis-prediction-dataset\/heart.csv')\no2_sat = pd.read_csv('..\/input\/heart-attack-analysis-prediction-dataset\/o2Saturation.csv')","616a934e":"heart.head()","fcd4658a":"heart.info()","973e8432":"o2_sat.head()","873fbbad":"o2_sat.info()","4d6dd2c1":"o2_sat.hist()\nplt.title('Oxigen saturation values')\nplt.show()","6a77d11a":"o2_sat.value_counts()","eeda605d":"heart.duplicated().sum()","3aef83d1":"df = heart.drop_duplicates().reset_index(drop=True).copy()","8148e2cd":"df.info()","93d59295":"df.describe().T","0137391f":"train_set, test_set = train_test_split(df, test_size=0.2, random_state=42)","ab6d7a13":"len(train_set)","d7db3606":"len(test_set)","125522b2":"len(train_set) + len(test_set) == len(df)","92156ef1":"train_set.head()","ac6d2467":"train_set.hist(bins=50, figsize=(20,15), edgecolor='black', linewidth=2)\nplt.show()","d86d1c4f":"train_set['age_group'] = pd.qcut(train_set['age'], 5)","6afb74fc":"train_set.groupby('age_group')['output'].agg(['count', 'mean']).sort_values(by='mean', ascending=False)","acddd687":"train_set.groupby(['age_group', 'sex'])['output'].agg(['count', 'mean'])","27754ef6":"train_set.groupby(['sex'])['output'].agg(['count', 'mean'])","36dd7993":"\ncolumns_list = ['trtbps', 'chol', 'thalachh']\ntitle_list = ['Boxplot for resting blood pressure (in mm Hg)', 'Boxplot for chol values', \n              'Boxplot for thalach']\n\ncolor_list=['steelblue', 'skyblue', 'cyan']\n\n\nfor i in tqdm(range(len(columns_list))):\n    q75 = train_set[columns_list[i]].quantile([.75])\n    q25 = train_set[columns_list[i]].quantile([.25])\n    iqr = q75 - q25\n    low_range = q25 - (1.5 * iqr)\n    high_range = q75 + (1.5 * iqr)\n    plt.figure(figsize=(15, 5))\n    sns.boxplot(train_set[columns_list[i]], color=color_list[i])\n    plt.xlim = (low_range, high_range)\n    plt.title(title_list[i])\n    plt.xlabel('')\n    plt.show()\n","eec548df":"train_set.head()","6a26ea01":"train_set['trtbps_group'] = pd.qcut(train_set['trtbps'], 5)","788bf002":"train_set.groupby(['trtbps_group'])['output'].agg(['count', 'mean'])","b46625d2":"train_set['chol_group'] = pd.qcut(train_set['chol'], 5)","49d3a6d9":"train_set.groupby(['chol_group'])['output'].agg(['count', 'mean'])","7e8682fb":"def split_data(data, target_column):\n    return data.drop(columns=[target_column], axis=1), data[target_column]","9406a353":"train_features, train_target = split_data(train_set, 'output')","3d3aef39":"train_features = train_features.drop(['age_group',\t'trtbps_group',\t'chol_group'], axis=1)","7e3a4292":"train_features.head()","39da464e":"cat_model = CatBoostClassifier()\nparams = {'iterations': [100, 200, 500],\n          'depth': [4, 5, 6],\n          'loss_function': ['Logloss', 'CrossEntropy'],\n          'l2_leaf_reg': np.logspace(-20, -19, 3),\n          'leaf_estimation_iterations': [10],\n          'logging_level':['Silent'],\n          'random_seed': [42]\n         }\nscorer = make_scorer(accuracy_score)\nclf_grid = GridSearchCV(estimator=cat_model, param_grid=params, scoring=scorer, cv=5)","eb0c09fa":"clf_grid.fit(train_features, train_target)\nbest_param = clf_grid.best_params_\nbest_param","68948efe":"model = CatBoostClassifier(depth= 5,\n                           iterations = 500,\n                           l2_leaf_reg= 1e-20,\n                           leaf_estimation_iterations= 10,\n                           logging_level= 'Silent',\n                           loss_function= 'Logloss',\n                           random_seed= 42)","cc83c394":"cat_features = [0]\nxtrain, xval, ytrain, yval = train_test_split(\n                            train_features, train_target, \n                            train_size=0.8,random_state=42\n                            )\ntrain_pool = Pool(xtrain, ytrain, cat_features=cat_features)\n\nparams = {'depth': 5,\n          'iterations': 500,\n          'l2_leaf_reg': 1e-20,\n          'leaf_estimation_iterations': 10,\n          'logging_level': 'Silent',\n          'loss_function': 'Logloss',\n          'random_seed': 42}\n\n\n# Unfortunately plotting works only in Jupiter\n# scores = cv(train_pool,\n#             params,\n#             fold_count=2, \n#             plot=\"True\")","ddcd8295":"model.fit(train_pool, eval_set=(xval, yval))","5dfbcae7":"test_features, test_target = split_data(test_set, 'output')\ntest_features.head()","a5540e12":"test_predictions = model.predict(test_features)\ntest_acc = accuracy_score(test_target, test_predictions)\ntest_f1 = f1_score(test_target, test_predictions)\n\n\nprint(\"Accuracy\")\nprint(\"Test set:\", test_acc)\nprint(\"F1-score\")\nprint(\"Test set:\", test_f1)","8159006b":"(df['output'].value_counts()\/df.shape[0]).to_frame()","4d64aba9":"## Exploratory data analysis","4bc8088b":"## Feature engeneering","f5b75bf2":"A heart attack occurs when the flow of blood to the heart is blocked.  \n\nThe blockage is most often a buildup of fat, cholesterol and other substances, which form a plaque in the arteries that feed the heart (coronary arteries).  \n\n\nA heart attack, also called a **myocardial infarction**, can be **fatal** \n\nLets try to analyze data set and find some insights to predict heart attacks","9cfe5408":"And senity test:","b2b6a00d":"Let us plot hist of featires to see all values, that we have\n","81c540c0":"Train our model on train set","44351710":"We have no big outliners or anomaly","43721fdf":"Now it is time to our test set","f0222aa5":"# Conclusion\n\nKnow your blood pressure. High blood pressure is usually not accompanied by any symptoms, but it is one of the main causes of sudden stroke or heart attack. Check your blood pressure and know your numbers. If your blood pressure is high, you need to change your lifestyle - switch to a healthy diet, reduce your salt intake, and increase your levels of physical activity. You may need to take medication to control your blood pressure.\n\n\nElevated blood cholesterol levels increase the risk of heart attacks and strokes. It is necessary to control blood cholesterol levels with a healthy diet and, if necessary, appropriate medications\n\ntake care of yourself and loved ones","c053bf5b":"![](https:\/\/i.ibb.co\/bH86zpn\/EKG-Heart-concept-ML1701-ts484297336.png)","07a15805":"For dividing data we will use `train_test_split` from `scikit-Learn` library. Or we can use pandas method `sample()` with frac and random state.\n\n\nPS. you can do it also in this way:\n\n`train = df.sample(frac=0.8,random_state=42).copy()`. \n\n`test = df[~df.index.isin(train.index)].copy()`\n\n\nwe will work with `scikit-Learn`\n","a7c082d4":"Now we have can save the best model with the best parametrs and train it on train_pool for crossvalidation","2d904870":"We can see that level of cholesterin and resting blood pressure (in mm Hg) is affects frequency of heart attacks","3aa05c47":"### Conclusion\n\n\nAt first glance, we do not see anomalies in the data. There are no missing values, duplicates are removed. There is no need to convert data to other types. Let's get started with exploratory data analysis. But before that let us devide set to train and test and hide our test data to prevent data snooping bias","2f9771b1":"### Conclusion\n\n\nThe main risk factor for the development of myocardial infarction is arterial hypertension. And it is among female that this disease occurs quite often\n\nalso we can see, that the count of male with heart breaks is bigger than female. One of the reasons for this is that fewer atherosclerotic plaques form in the vessels of the female body, and therefore there is less likelihood of blood clots in the arteries of the heart.\n\nSummary, heart aches more offen affect male, but with age it is affect more femal\n\nWe can see that level of cholesterin and resting blood pressure (in mm Hg) is affects frequency of heart attacks\n\n\nIn summary age, gender, chol level and resting blood pressure is affect heart attacks","9973e5a6":"## General information about data","7ff296fb":"Let us try to choose parametrs of model via `GridSearchCV`","17109288":"## Train model and tune","c7b5207d":"Check the lens","eaf56d0b":"Our model better than random. We can try it on another set if we have","0789d688":"In my opinion iti is better to hide test now, before EDA - we have no NaN, we have no duplicates - in this case i decided to hide test to prevent snooping bias.  \nNow we have to sets - train for our model and test\n","0ffa17d1":"The main risk factor for the development of myocardial infarction is arterial hypertension. And it is among female that this disease occurs quite often\n\nalso we can see, that the count of male with heart breaks is bigger than femal. One of the reasons for this is that fewer atherosclerotic plaques form in the vessels of the female body, and therefore there is less likelihood of blood clots in the arteries of the heart.\n\nSummary, heart aches more offen affect male, but with age it is affect more femal","d2abdd83":"Lets split our train set for features and target","36a01b49":"We can see, that oxygen saturation tab consist of normal values of oxigen in blood. We will work only with `heart`-set further. \n\nLet check duplicates","35c6083e":"We have `age` feature with many values. It is","62f6d555":"### Loading and previewing data","1692ad72":"## Dividing data","588a3f78":"\nWe have a dateframe with the following features:\n\n- `Age`: Age of the patient\n- `Sex` : Sex of the patient *(1 = male; 0 = female)*\n- `exang`: exercise induced angina (1 = yes; 0 = no)\n- `ca`: number of major vessels (0-3)\n- `cp` : Chest Pain type chest pain type\n\n    -- Value 1: typical angina. \n\n    -- Value 2: atypical angina. \n\n    -- Value 3: non-anginal pain. \n\n    -- Value 4: asymptomatic. \n\n- `trtbps` : resting blood pressure (in mm Hg): *normal reading would be any blood pressure below 120\/80 mm Hg and above 90\/60 mm Hg in an adult*. \n\n- `chol` : cholestoral in mg\/dl fetched via BMI sensor: *normal range is <200 mg\/dL*. \n\n- `fbs` : (fasting blood sugar > 120 mg\/dl) (1 = true; 0 = false)\n- `rest_ecg` : resting electrocardiographic results\n\n    -- Value 0: normal\n\n    -- Value 1: having ST-T wave abnormality (T wave inversions and\/or ST elevation or depression of > 0.05 mV)\n\n    -- Value 2: showing probable or definite left ventricular hypertrophy by Estes' criteria\n\n- `thalach` : maximum heart rate achieved\n- `target` : 0= less chance of heart attack 1= more chance of heart attack","31b6ce16":"We see, that the highest amount of heart attack is in group of 29-44 years old. maybe it is due to irregular work, stress, poor nutrition, and the abuse of fast food smkoing and etc - a pretty young disease.  \n\nlet us group by sex and age","a093f4be":"# Heart Attack Analysis and Prediction (Catboost) (beginner)","c7b8e168":"We have the only one duplicated object here - we can drop it","c774544d":"A normal level of oxygen is usually 95% or higher. Some people with chronic lung disease or sleep apnea can have normal levels around 90%.","fc6caad2":"Now we can test our model on test set"}}