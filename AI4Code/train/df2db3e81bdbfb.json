{"cell_type":{"91e39f7b":"code","25ff23d5":"code","c80b818f":"code","527171ab":"code","d3208f20":"code","fee20460":"code","a1a77010":"code","cf868e9e":"code","7a069a0e":"code","2eb90e8d":"code","fff4df5f":"code","7ab9f7c2":"code","da59d59c":"code","7d346878":"code","c41da95a":"code","1313c807":"code","c666b546":"code","f28df863":"code","83c2aeda":"code","4ebcfaaf":"code","33fb3c4c":"code","c26000d9":"code","252f13cc":"code","af182ce1":"code","d5c0efa2":"markdown","466fdede":"markdown","6e56bb1b":"markdown","a2c061cd":"markdown","bf5a1f9b":"markdown","f427ca68":"markdown","25a493f5":"markdown"},"source":{"91e39f7b":"!rm -rf utils.py\n!wget https:\/\/raw.githubusercontent.com\/sevenfx\/fastai_audio\/master\/notebooks\/utils.py","25ff23d5":"%matplotlib inline\nimport os\nfrom pathlib import Path\nfrom IPython.display import Audio\nimport librosa\nimport librosa.display\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom utils import read_file, transform_path","c80b818f":"!rm -rf free-spoken-digit-dataset-master master.zip\n!wget https:\/\/github.com\/Jakobovski\/free-spoken-digit-dataset\/archive\/master.zip\n!unzip -q master.zip\n!rm -rf master.zip\n!ls","527171ab":"AUDIO_DIR = Path('free-spoken-digit-dataset-master\/recordings')\nIMG_DIR = Path('imgs')\n!mkdir {IMG_DIR} -p","d3208f20":"fnames = os.listdir(str(AUDIO_DIR))\nlen(fnames), fnames[:5]","fee20460":"fn = fnames[94]\nprint(fn)\nAudio(str(AUDIO_DIR\/fn))","a1a77010":"# ??read_file","cf868e9e":"x, sr = read_file(fn, AUDIO_DIR)\nx.shape, sr, x.dtype","7a069a0e":"def log_mel_spec_tfm(fname, src_path, dst_path):\n    x, sample_rate = read_file(fname, src_path)\n    \n    n_fft = 1024\n    hop_length = 256\n    n_mels = 40\n    fmin = 20\n    fmax = sample_rate \/ 2 \n    \n    mel_spec_power = librosa.feature.melspectrogram(x, sr=sample_rate, n_fft=n_fft, \n                                                    hop_length=hop_length, \n                                                    n_mels=n_mels, power=2.0, \n                                                    fmin=fmin, fmax=fmax)\n    mel_spec_db = librosa.power_to_db(mel_spec_power, ref=np.max)\n    dst_fname = dst_path \/ (fname[:-4] + '.png')\n    plt.imsave(dst_fname, mel_spec_db)","2eb90e8d":"log_mel_spec_tfm(fn, AUDIO_DIR, IMG_DIR)\nimg = plt.imread(str(IMG_DIR\/(fn[:-4] + '.png')))\nplt.imshow(img, origin='lower');","fff4df5f":"transform_path(AUDIO_DIR, IMG_DIR, log_mel_spec_tfm, fnames=fnames, delete=True)","7ab9f7c2":"os.listdir(str(IMG_DIR))[:10]","da59d59c":"import fastai\nfastai.__version__","7d346878":"from fastai.vision import *","c41da95a":"digit_pattern = r'(\\d+)_\\w+_\\d+.png$'","1313c807":"data = (ImageList.from_folder(IMG_DIR)\n        .split_by_rand_pct(.2)\n        .label_from_re(digit_pattern)\n        .transform(size=(128,64))\n        .databunch())\ndata.c, data.classes","c666b546":"xs, ys = data.one_batch()\nxs.shape, ys.shape","f28df863":"xs.min(), xs.max(), xs.mean(), xs.std()","83c2aeda":"data.show_batch(4, figsize=(5,9), hide_axis=False)","4ebcfaaf":"learn = cnn_learner(data, models.resnet18, metrics=accuracy)\nlearn.fit_one_cycle(4)","33fb3c4c":"learn.unfreeze()\nlearn.fit_one_cycle(4)","c26000d9":"interp = ClassificationInterpretation.from_learner(learn)","252f13cc":"interp.plot_confusion_matrix(figsize=(10, 10), dpi=60)","af182ce1":"# Clean up\n!rm -rf {AUDIO_DIR}\n!rm -rf {IMG_DIR}","d5c0efa2":"## Image Classifier","466fdede":"Next, let's download the data. We'll use the free spoken digits database: https:\/\/github.com\/Jakobovski\/free-spoken-digit-dataset","6e56bb1b":"# Audio Classification using FastAI\n\nSource: https:\/\/github.com\/sevenfx\/fastai_audio","a2c061cd":"We can import the necessary modules and functions","bf5a1f9b":"Let's see how many recordings we have, and some sample files.","f427ca68":"As before we can play the recording using the `Audio` widget.","25a493f5":"To begin, we download a bunch of [utility functions](https:\/\/github.com\/sevenfx\/fastai_audio\/blob\/master\/notebooks\/utils.py) for I\/O and conversion of audio files to spectrogram images."}}