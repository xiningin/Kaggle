{"cell_type":{"be6ec0aa":"code","479bf009":"code","036b0a11":"code","8bbb352a":"code","41920811":"code","439cbcee":"code","c093d5aa":"code","77c42eb3":"code","fdb230b2":"code","338204d0":"code","64c13df8":"code","4c9dda05":"code","04e35bf9":"code","c52eb7e5":"code","719476a2":"code","6039a6f0":"code","f04bc3e8":"code","7532ae03":"code","b0a26c9a":"code","62ece39c":"code","f5d81213":"code","b1f4b4e9":"code","09b882e8":"code","0b1d2efe":"code","80958e41":"markdown","1465b747":"markdown","4c3ed6c4":"markdown","7686074b":"markdown","0f73773a":"markdown"},"source":{"be6ec0aa":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","479bf009":"# Bibliotecas gr\u00e1ficas\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","036b0a11":"#entrada de dados\n# O banco de dados em quest\u00e3o, apresenta os missing como sendo '?'. ao carregar os dados com a biblioteca pandas, substitu\u00edmos por NAN\ndf = pd.read_csv('\/kaggle\/input\/diabetes\/diabetic_data.csv')\ndf.replace('?', np.nan, inplace=True)","8bbb352a":"#quantidade de linhas e colunas\ndf.shape","41920811":"#exibindo nomes de colunas\ndf.columns","439cbcee":"# EXCLU\u00cdNDO DADOS DUPLICADOS\n# Pegarei apenas a primeira visita de cada paciente para que n\u00e3o tenhamos interfer\u00eancias nos resultados\ndf['duplicado'] = df.patient_nbr.duplicated()\ndf = df[df['duplicado'] == False]\n\ndf.drop(['duplicado'], axis = 1, inplace = True)","c093d5aa":"df.shape","77c42eb3":"#Para possibilitar os c\u00e1lculos de predi\u00e7\u00e3o, todos os dados precisam ser num\u00e9ricos\n\n# Alterando vari\u00e1vel race\ndf.loc[df['race'] == 'Caucasian', ['race']] = 1\ndf.loc[df['race'] == 'AfricanAmerican', ['race']] = 0\n#df.loc[df['race'] == '?', ['race']] = 2\ndf.loc[df['race'] == 'Other', ['race']] = 2\ndf.loc[df['race'] == 'Asian', ['race']] = 2\ndf.loc[df['race'] == 'Hispanic', ['race']] = 2\n\n\n# Alterando vari\u00e1vel gender\ndf.loc[df['gender'] == 'Female', ['gender']] = 0\ndf.loc[df['gender'] == 'Male', ['gender']] = 1\ndf.replace('Unknown\/Invalid', np.nan, inplace=True)\n#df.loc[df['gender'] == 'Unknown\/Invalid', ['gender']] = -1000 #ausente\n\n# Alterando vari\u00e1vel age\ndf.loc[df['age'] == '[0-10)', ['age']] = 0\ndf.loc[df['age'] == '[10-20)', ['age']] = 0\ndf.loc[df['age'] == '[20-30)', ['age']] = 1\ndf.loc[df['age'] == '[30-40)', ['age']] = 1\ndf.loc[df['age'] == '[40-50)', ['age']] = 2\ndf.loc[df['age'] == '[50-60)', ['age']] = 2\ndf.loc[df['age'] == '[60-70)', ['age']] = 3\ndf.loc[df['age'] == '[70-80)', ['age']] = 3\ndf.loc[df['age'] == '[80-90)', ['age']] = 4\ndf.loc[df['age'] == '[90-100)', ['age']] = 4\n\n# Alterando vari\u00e1vel weight (excluida)\n#df.loc[df['weight'] == '?', ['weight']] = 0\ndf.loc[df['weight'] == '[0-25)', ['weight']] = 1\ndf.loc[df['weight'] == '[25-50)', ['weight']] = 2\ndf.loc[df['weight'] == '[50-75)', ['weight']] = 3\ndf.loc[df['weight'] == '[75-100)', ['weight']] = 4\ndf.loc[df['weight'] == '[100-125)', ['weight']] = 5\ndf.loc[df['weight'] == '[125-150)', ['weight']] = 6\ndf.loc[df['weight'] == '[150-175)', ['weight']] = 7\ndf.loc[df['weight'] == '[175-200)', ['weight']] = 8\ndf.loc[df['weight'] == '>200', ['weight']] = 9\n\n#Admission type\ndf['admission_type_id_II'] = \"\"\ndf.loc[df['admission_type_id'] == 1 , ['admission_type_id_II']] = 1\ndf.loc[df['admission_type_id'] == 2 , ['admission_type_id_II']] = 2\ndf.loc[df['admission_type_id'] == 3 , ['admission_type_id_II']] = 3\ndf.loc[df['admission_type_id'] == 5 , ['admission_type_id_II']] = 4 \ndf.loc[df['admission_type_id'] == 6 , ['admission_type_id_II']] = 4\ndf.loc[df['admission_type_id'] == 8 , ['admission_type_id_II']] = 4\ndf.loc[df['admission_type_id'] == 4 , ['admission_type_id_II']] = 5\ndf.loc[df['admission_type_id'] == 7 , ['admission_type_id_II']] = 5\ndf['admission_type_id'] = df['admission_type_id_II']\ndf = df.drop(['admission_type_id_II'],axis = 1)\n\n#Discharge disposition\n# Discharge to Home = 1 -> agrupar 1, 6, 8\ndf['discharge_disposition_id_II'] = \"\"\ndf.loc[df['discharge_disposition_id'] == 1 , ['discharge_disposition_id_II']] = 1\ndf.loc[df['discharge_disposition_id'] == 6 , ['discharge_disposition_id_II']] = 1\ndf.loc[df['discharge_disposition_id'] == 8 , ['discharge_disposition_id_II']] = 1\n# Agrupados por valors nulos, n\u00e3o mapeados etc.\ndf.loc[df['discharge_disposition_id'] == 18 , ['discharge_disposition_id_II']] = 3\ndf.loc[df['discharge_disposition_id'] == 25 , ['discharge_disposition_id_II']] = 3\ndf.loc[df['discharge_disposition_id'] == 26 , ['discharge_disposition_id_II']] = 3\n# Outros\ndf.loc[(df['discharge_disposition_id'] != 1) & (df['discharge_disposition_id'] > 1) , ['discharge_disposition_id_II']] = 2\ndf['discharge_disposition_id'] = df['discharge_disposition_id_II']\ndf = df.drop(['discharge_disposition_id_II'],axis = 1)\n\n#Admission source\ndf['admission_source_id_II'] = \"\"\ndf.loc[df['admission_source_id'] == 7, ['admission_source_id_II']] = 0\ndf.loc[df['admission_source_id'] == 1, ['admission_source_id_II']] = 1\ndf.loc[(df['admission_source_id'] > 1) & (df['admission_source_id'] < 7) | (df['admission_source_id'] > 7), ['admission_source_id_II']] = 2\ndf['admission_source_id'] = df['admission_source_id_II']\ndf = df.drop(['admission_source_id_II'],axis = 1)\n\n# Variaveis (time_in_hospital_II); \n#Classes: 0: 0 - 4 ; 1: 4-8 ; 2: >=8\ndf['time_in_hospital_II'] = \"\"\ndf.loc[(df['time_in_hospital'] >= 0) & (df['time_in_hospital'] < 4), ['time_in_hospital_II']] = 0\ndf.loc[(df['time_in_hospital'] >= 4) & (df['time_in_hospital'] < 8), ['time_in_hospital_II']] = 1\ndf.loc[(df['time_in_hospital'] >= 8), ['time_in_hospital_II']] = 2  \ndf['time_in_hospital'] = df['time_in_hospital_II']\ndf = df.drop(['time_in_hospital_II'],axis = 1)\n\n# Alterando vari\u00e1vel payer_code (excluida)\ndf.loc[df['payer_code'] == 'MC', ['payer_code']] = 1\ndf.loc[df['payer_code'] == 'MD', ['payer_code']] = 2\ndf.loc[df['payer_code'] == 'HM', ['payer_code']] = 3\ndf.loc[df['payer_code'] == 'UN', ['payer_code']] = 4\ndf.loc[df['payer_code'] == 'BC', ['payer_code']] = 5\ndf.loc[df['payer_code'] == 'SP', ['payer_code']] = 6\ndf.loc[df['payer_code'] == 'CP', ['payer_code']] = 7\ndf.loc[df['payer_code'] == 'SI', ['payer_code']] = 8\ndf.loc[df['payer_code'] == 'DM', ['payer_code']] = 9\ndf.loc[df['payer_code'] == 'CM', ['payer_code']] = 10\ndf.loc[df['payer_code'] == 'CH', ['payer_code']] = 11\ndf.loc[df['payer_code'] == 'PO', ['payer_code']] = 12\ndf.loc[df['payer_code'] == 'WC', ['payer_code']] = 13\ndf.loc[df['payer_code'] == 'OT', ['payer_code']] = 14\ndf.loc[df['payer_code'] == 'OG', ['payer_code']] = 15\ndf.loc[df['payer_code'] == 'MP', ['payer_code']] = 16\ndf.loc[df['payer_code'] == 'FR', ['payer_code']] = 17\n\n#Medical specialty\n\n# Variaveis (num_lab_procedures_II); \n#Classes: 0: 0 - 30 ; 1: 30-60 ; 2: >=60\ndf['num_lab_procedures_II'] = \"\"\ndf.loc[(df['num_lab_procedures'] >= 0) & (df['num_lab_procedures'] < 30), ['num_lab_procedures_II']] = 0\ndf.loc[(df['num_lab_procedures'] >= 30) & (df['num_lab_procedures'] < 60), ['num_lab_procedures_II']] = 1\ndf.loc[(df['num_lab_procedures'] >= 60), ['num_lab_procedures_II']] = 2\ndf['num_lab_procedures'] = df['num_lab_procedures_II']\ndf = df.drop(['num_lab_procedures_II'],axis = 1)\n\n# Variaveis (num_procedures_II); \n#Classes: 0: 0 - 2 ; 1: 2-4 ; 2: >=4\ndf['num_procedures_II'] = \"\"\ndf.loc[(df['num_procedures'] >= 0) & (df['num_procedures'] < 2), ['num_procedures_II']] = 0\ndf.loc[(df['num_procedures'] >= 2) & (df['num_procedures'] < 4), ['num_procedures_II']] = 1\ndf.loc[(df['num_procedures'] >= 4), ['num_procedures_II']] = 2\ndf['num_procedures'] = df['num_procedures_II']\ndf = df.drop(['num_procedures_II'],axis = 1)\n\n# Variaveis (num_medications_II); \n#Classes: 0: 0 - 10 ; 1: 10-20 ; 2: >=20\ndf['num_medications_II'] = \"\"\ndf.loc[(df['num_medications'] >= 0) & (df['num_medications'] < 10), ['num_medications_II']] = 0\ndf.loc[(df['num_medications'] >= 10) & (df['num_medications'] < 20), ['num_medications_II']] = 1\ndf.loc[(df['num_medications'] >= 20), ['num_medications_II']] = 2\ndf['num_medications'] = df['num_medications_II']\ndf = df.drop(['num_medications_II'],axis = 1)\n\n# Variaveis (number_outpatient_II); \n#Classes: 0: 0 - 10 ; 1: 10-20 ; 2: >= a 20\ndf['number_outpatient_II'] = \"\"\ndf.loc[(df['number_outpatient'] >= 0) & (df['number_outpatient'] < 10), ['number_outpatient_II']] = 0\ndf.loc[(df['number_outpatient'] >= 10) & (df['number_outpatient'] < 20), ['number_outpatient_II']] = 1\ndf.loc[(df['number_outpatient'] >= 20) , ['number_outpatient_II']] = 2\ndf['number_outpatient'] = df['number_outpatient_II']\ndf = df.drop(['number_outpatient_II'],axis = 1)\n             \n# Variaveis (number_emergency_II); \n#Classes: 0: 0 - 5 ; 1: 5-10 ; 2: >= 10\ndf['number_emergency_II'] = \"\"\ndf.loc[(df['number_emergency'] >= 0) & (df['number_emergency'] < 5), ['number_emergency_II']] = 0\ndf.loc[(df['number_emergency'] >= 5) & (df['number_emergency'] < 10), ['number_emergency_II']] = 1\ndf.loc[(df['number_emergency'] >= 10), ['number_emergency_II']] = 2\ndf['number_emergency'] = df['number_emergency_II']\ndf = df.drop(['number_emergency_II'],axis = 1)\n        \n# Variaveis (number_inpatient_II); \n#Classes: 0: 0 - 3 ; 1: 3-6 ; 2: >=6\ndf['number_inpatient_II'] = \"\"\ndf.loc[(df['number_inpatient'] >= 0) & (df['number_inpatient'] < 3), ['number_inpatient_II']] = 0\ndf.loc[(df['number_inpatient'] >= 3) & (df['number_inpatient'] < 6), ['number_inpatient_II']] = 1\ndf.loc[(df['number_inpatient'] >= 6), ['number_inpatient_II']] = 2\ndf['number_inpatient'] = df['number_inpatient_II']\ndf = df.drop(['number_inpatient_II'],axis = 1)\n\n#Diagnosis 1\n#Diagnosis 2\n#Diagnosis 3\n\n# Variaveis (number_diagnoses_II); \n#Classes: 0: 0 - 4 ; 1: 4-8 ; 2: >=8\ndf['number_diagnoses_II'] = \"\"\ndf.loc[(df['number_diagnoses'] >= 0) & (df['number_diagnoses'] < 4), ['number_diagnoses_II']] = 0\ndf.loc[(df['number_diagnoses'] >= 4) & (df['number_diagnoses'] < 8), ['number_diagnoses_II']] = 1\ndf.loc[(df['number_diagnoses'] >= 8), ['number_diagnoses_II']] = 2\ndf['number_diagnoses'] = df['number_diagnoses_II']\ndf = df.drop(['number_diagnoses_II'],axis = 1)\n\n\n# Alterando vari\u00e1vel MAX_GLU_SERUM\ndf.loc[df['max_glu_serum'] == 'None', ['max_glu_serum']] = 0\ndf.loc[df['max_glu_serum'] == 'Norm', ['max_glu_serum']] = 1\ndf.loc[df['max_glu_serum'] == '>200', ['max_glu_serum']] = 2\ndf.loc[df['max_glu_serum'] == '>300', ['max_glu_serum']] = 3\n\n# Alterando vari\u00e1vel A1Cresult\ndf.loc[df['A1Cresult'] == 'None', ['A1Cresult']] = 0\ndf.loc[df['A1Cresult'] == 'Norm', ['A1Cresult']] = 1\ndf.loc[df['A1Cresult'] == '>7', ['A1Cresult']] = 2\ndf.loc[df['A1Cresult'] == '>8', ['A1Cresult']] = 3\n\n# Alterando diversas vari\u00e1veis que t\u00eam classes iguais\nmetricas = [\"metformin\", \"repaglinide\", \"nateglinide\", \"chlorpropamide\", \"glimepiride\", \"acetohexamide\", \"glipizide\", \"glyburide\", \"tolbutamide\", \"pioglitazone\", \n           \"rosiglitazone\", \"acarbose\", \"miglitol\", \"troglitazone\", \"tolazamide\", \"examide\", \"citoglipton\", \"insulin\", \"glyburide-metformin\", \"glipizide-metformin\", \n           \"glimepiride-pioglitazone\", \"metformin-rosiglitazone\", \"metformin-pioglitazone\"]\nfor i in metricas:\n    df.loc[df[i] == 'Up', [i]] = 1  #sim o medicamento foi prescito-aumentou a doze\n    df.loc[df[i] == 'Down', [i]] = 1 #sim o medicamento foi prescito-baixou a doze\n    df.loc[df[i] == 'Steady', [i]] = 1 #sim o medicamento foi prescito -manteve a doze\n    df.loc[df[i] == 'No', [i]] = 0 #nao foi prescrito\n    \n\n# Alterando vari\u00e1vel change\ndf.loc[df['change'] == 'No', ['change']] = 0\ndf.loc[df['change'] == 'Ch', ['change']] = 1\n    \n# Alterando vari\u00e1vel DIABETESMED\ndf.loc[df['diabetesMed'] == 'Yes', ['diabetesMed']] = 1\ndf.loc[df['diabetesMed'] == 'No', ['diabetesMed']] = 0\n\n# Transformando vari\u00e1vel: readmitted; \ndf.loc[df['readmitted'] == '<30', ['readmitted']] = 1 #0,087\ndf.loc[df['readmitted'] == '>30', ['readmitted']] = 0 #0,912\ndf.loc[df['readmitted'] == 'NO', ['readmitted']] = 0","fdb230b2":"df.readmitted.value_counts()","338204d0":"# Excluindo os pacientes que MORRERAM ou est\u00e3o no HOSPICIO\n#df = df[~df.discharge_disposition_id.isin([11,13,14,19,20,21])]\ndf = df[~df.discharge_disposition_id.isin([4])]\n# Mostrando quantidade de casa registro com as seguintes vari\u00e1veis\nprint('4: ', df['discharge_disposition_id'][df['discharge_disposition_id'] == 4].count())","64c13df8":"#OVER SAMPLING, BALANCEANDO OS DADOS\n\n# Class count\ncount_class_0, count_class_1 = df.readmitted.value_counts()\n\n# Divide by class\ndf_class_0 = df[df['readmitted'] == 0]\ndf_class_1 = df[df['readmitted'] == 1]\ndf_class_1_over = df_class_1.sample(count_class_0, replace=True)\ndf_b = pd.concat([df_class_0, df_class_1_over], axis=0)","4c9dda05":"#Under-sumpling\n# Class count\n#count_class_0, count_class_1 = df.readmitted.value_counts()\n\n# Divide by class\n#df_class_0 = df[df['readmitted'] == 0]\n#df_class_1 = df[df['readmitted'] == 1]\n\n#df_class_0_under = df_class_0.sample(count_class_1)\n#df= pd.concat([df_class_0_under, df_class_1], axis=0)\n\n#print('Random under-sampling:')\n#print(df.readmitted.value_counts())\n\n#df.readmitted.value_counts().plot(kind='bar', title='Count (target)');","04e35bf9":"# Corpo do dataset ap\u00f3s tratamento dos dados\ndf_b.shape","c52eb7e5":"#Visualizando variavel Readmitted\n#df.readmitted.count()\ndf_b[\"readmitted\"].value_counts()","719476a2":"# Importando as bibliotecas necess\u00e1rias\nfrom sklearn import preprocessing\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.metrics import mean_squared_error","6039a6f0":"removed_cols = ['encounter_id',\n                'patient_nbr', \n                'weight',\n                'payer_code', \n                'medical_specialty',\n                'number_outpatient', \n                'number_emergency',\n                'diag_1',\n                'diag_2',\n                'diag_3',\n                'chlorpropamide',\n                'acetohexamide', \n                'tolbutamide',\n                'miglitol', \n                'troglitazone',\n                'tolazamide',\n                'examide',\n                'citoglipton', \n                'glipizide-metformin',\n                'glimepiride-pioglitazone',\n                'metformin-rosiglitazone',\n                'metformin-pioglitazone', \n                'readmitted',\n                'duplicado',\n                'random'\n               ]\n\n\n#feats = [c for c in df.columns if c in colunas_transformadas]\nfeats = [c for c in df_b.columns if c not in removed_cols]","f04bc3e8":"# Preenchendos os valores nulos com -1\ndf_b.fillna(-1, inplace=True)","7532ae03":"# Dividindo o df em treino e valida\u00e7\u00e3o\ntrain, valid = train_test_split(df_b, random_state=42)","b0a26c9a":"# Random Forest\n\n# Carregando o modelo\nrf = RandomForestClassifier(random_state=42, n_jobs=-1, n_estimators=150, min_samples_split=3, oob_score = True)\n\n# Treinando o modelo\nrf.fit(train[feats], train['readmitted'])\npreds = rf.predict(valid[feats])\n\nprint('Erro m\u00e9dio quadrado:', mean_squared_error(valid['readmitted'], preds)**(1\/2))\n\nprint('Acur\u00e1cia: ', accuracy_score(valid['readmitted'],preds))\n\n","62ece39c":"fi = pd.DataFrame({'feature': feats, 'importance': rf.feature_importances_}).sort_values(by='importance', ascending=False)\nfi = fi.reset_index()\n#fi[:11]\nfi.loc[fi['importance']>0.005, 'feature']","f5d81213":"#analiusando a importancia das caracteristicas.\nfig, ax = plt.subplots(figsize=(15,12))\n# Remove x,y Ticks\nax.xaxis.set_ticks_position('none')\nax.yaxis.set_ticks_position('none')\n\n# Add padding between axes and labels\nax.xaxis.set_tick_params(pad=5)\nax.yaxis.set_tick_params(pad=10)\n\n# Add annotation to bars\nfor i in ax.patches:\n    ax.text(i.get_width()+500, i.get_y()+0.5, str(round((i.get_width()), 2)),\n            fontsize=10, fontweight='bold', color='grey')\n    \n# Add Text watermark\nfig.text(0.9, 0.15, '@bmanohar16', fontsize=12, color='grey',\n         ha='right', va='bottom', alpha=0.5)\n\n\npd.Series(rf.feature_importances_, index=feats).sort_values().plot.barh(color=(0.2, 0.4, 0.6, 0.6))\n\nax.grid(b=True, color='grey', linestyle='-.', linewidth=0.5, alpha=0.2)","b1f4b4e9":"def plot_feature_importance(fi):\n    fig, (ax1, ax2) = plt.subplots(nrows=1, ncols=2, figsize=(24,8))\n    ax1.plot(np.arange(0, len(fi.index)), fi['importance'])\n    label_nrs = np.arange(0, len(fi.index), 5 )\n    ax1.set_xticks(label_nrs)\n    ax1.set_xticklabels(fi['feature'][label_nrs], rotation=90)\n    \n    num_bar = min(len(fi.index), 30)\n    ax2.barh(np.arange(0, num_bar), fi['importance'][:num_bar], align='center', alpha=0.5)\n    ax2.set_yticks(np.arange(0, num_bar))\n    ax2.set_yticklabels(fi['feature'][:num_bar])\n\nplot_feature_importance(fi)","09b882e8":"from sklearn.metrics import roc_auc_score\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.metrics import roc_curve, auc\nfrom sklearn import metrics\n#auc_roc\n\n# Logistic regression\nfalse_positive_rate, true_positive_rate, thresholds = roc_curve(valid['readmitted'], preds)\nroc_auc = auc(false_positive_rate, true_positive_rate)\nprint('random forest classifier: ', roc_auc)","0b1d2efe":"plt.figure(figsize=(10,10))\nplt.title('Graph')\nplt.plot(false_positive_rate,true_positive_rate, color='green',label = 'Random Forest Classifier = %0.2f' % roc_auc)\nplt.legend(loc = 'lower right')\nplt.plot([0, 1], [0, 1],linestyle='--')\nplt.axis('tight')\nplt.ylabel('True Positive Rate')\nplt.xlabel('False Positive Rate')","80958e41":"# Balanceamento de Dados","1465b747":"# Modelos","4c3ed6c4":"# Random forest classifier","7686074b":"# Tratamento dos dados","0f73773a":"## Features importances"}}