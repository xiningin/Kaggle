{"cell_type":{"3f0cd8ac":"code","e3e779c4":"code","8a64acab":"code","f394ca36":"code","52e6d74e":"code","7a603c88":"code","95327f8d":"code","71513c02":"code","60c4d283":"code","b0222a55":"markdown","b0019544":"markdown","af7ccb53":"markdown"},"source":{"3f0cd8ac":"import matplotlib.pyplot as plt\nimport numpy as np \nimport pandas as pd \n\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.pipeline import Pipeline","e3e779c4":"PATH_DATA = '..\/input\/covid19-global-forecasting-week-5\/'\nRANDOM_STATE = 0","8a64acab":"def MakeDataFrame(file, Path = PATH_DATA):\n    df = (pd.read_csv(f'{PATH_DATA}{file}.csv'\n                      , sep = ','\n                      , header = 0)\n         )\n    \n    df.Date = pd.to_datetime(df.Date).dt.strftime(\"%Y%m%d\").astype(int)\n    \n    return df\n\ndf = MakeDataFrame('train')\n\ndf.head()","f394ca36":"XE, XT, ye, yt = train_test_split(df.iloc[:,1:-1]\n                                  , df['TargetValue']\n                                  , test_size = 0.2\n                                  , random_state = RANDOM_STATE)\n\nXE.head()","52e6d74e":"Nums = Pipeline(\n    steps = [\n        ('imputer', SimpleImputer(strategy = 'median'))\n        , ('scaler' , StandardScaler())\n    ])\n\nText = Pipeline(\n    steps = [\n        ('imputer', SimpleImputer(strategy = 'constant', fill_value = 'missing'))\n        , ('onehot' , OneHotEncoder(handle_unknown = 'ignore'))\n    ])\n\nPipe = ColumnTransformer(\n    n_jobs = -1\n    , transformers = [\n        ('num', Nums, XE.select_dtypes(include = ['int64','float64']).columns)\n        , ('cat', Text, XE.select_dtypes(include = ['object']).columns)\n    ])\n\nModel = Pipeline(\n    steps=[\n        ('Prepo', Pipe)\n        , ('Clf', RandomForestRegressor()) \n    ])\n\nModel.fit(XE, ye)\n\nModel.score(XT, yt)","7a603c88":"df = MakeDataFrame('test')\n\ndf.head()","95327f8d":"pred = Model.predict(df[XE.columns.tolist()])\n\ndf = pd.DataFrame({'Id': df.index, 'TargetValue': pred.tolist()})","71513c02":"q = ['0.05', '0.5', '0.95']\ndfq = None\n\nfor i in q:\n    k = (df.groupby(['Id'])['TargetValue'].quantile(q=float(i)).reset_index()\n         .rename(columns = {'TargetValue':i})\n        )\n    if dfq is None:\n        dfq = k\n    else:\n        dfq = pd.concat([dfq, k[i]], 1)\n        \ndfq.Id = dfq.Id + 1\n\ndfq.head()","60c4d283":"df = (pd.melt(dfq, id_vars = ['Id'], value_vars = q)\n      .rename(columns = {'value':'TargetValue'})\n     )\n\ndf['ForecastId_Quantile'] = df['Id'].astype(str) + '_' + df['variable']\n\ndf[['ForecastId_Quantile','TargetValue']].to_csv('submission.csv', index=False)","b0222a55":"## Make Pipeline\n* `StandardScaler` to standardize numericals features.\n* `OneHotEncoder` to make dummies in categorical features.\n* `ColumnTransformer` to run previous two steps.\n* The estimator `RandomForestRegressor`.","b0019544":"## Make Submission","af7ccb53":"# Clean and simple code easy to understand...."}}