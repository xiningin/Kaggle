{"cell_type":{"856f5655":"code","a30bb049":"code","dcf30e8b":"code","325c062f":"code","d31f8143":"code","cb0609a1":"code","8c90e823":"code","f2ed1cfb":"code","7bc3f810":"code","8945a503":"code","fa5621dc":"markdown","218ce6cd":"markdown","15021a8f":"markdown","1545871d":"markdown","a8cacd80":"markdown","fc303b40":"markdown","98bfedaa":"markdown","44340be5":"markdown","e339d099":"markdown","5f0c6738":"markdown","ccb81519":"markdown"},"source":{"856f5655":"import pandas as pd\nimport numpy as np\nfrom collections import Counter\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport statsmodels.api as sm\nimport numpy as np\nfrom sklearn import preprocessing\nimport warnings\nwarnings.filterwarnings(\"ignore\")","a30bb049":"df=pd.read_csv('..\/input\/h1n1-new-york-2009\/Influenza_NY.csv')\ndf=df.drop(df.columns[0],axis='columns') #first column is useless\ndf['Prob_infected']=df['Infected']\/df['Population'] # Probability of being infected (Weekly)\ndf['Density']=df['Population']\/df['Area'] # Density of population of the area\ndf['Week Ending Date']=pd.to_datetime(df['Week Ending Date'], format='%m\/%d\/%Y')","dcf30e8b":"df_p=df.groupby(['County','Season'])['Prob_infected'].sum().reset_index()\ndf_p=df_p.groupby(['County']).mean()['Prob_infected'].reset_index()\nplt.figure(figsize=(16, 6))\nplt.title('Probability of influenza positive test per County during a Season (Oct-May)',fontsize=15)\nsns.set()\nax=sns.barplot(x='County',y='Prob_infected',data=df_p)\nfor item in ax.get_xticklabels():\n    item.set_rotation(90)\n","325c062f":"df_p=df.groupby(['County','Week Ending Date'])['Prob_infected'].sum().reset_index()\nplt.figure(figsize=(16, 6))\nplt.title('Probability of influenza positive test per County',fontsize=15)\nsns.set()\nax = sns.lineplot(x='Week Ending Date', y=\"Prob_infected\", hue=\"County\",data=df_p[['Week Ending Date','Prob_infected','County']],lw=0.6,legend=False)","d31f8143":"df_p=df.groupby(['County','Month'])['Prob_infected'].sum().reset_index()\nplt.figure(figsize=(16, 6))\nplt.title('Monthly probability of influenza positive test per County',fontsize=15)\nsns.set()\ndf_p=df.groupby(['County','Year','Month'])['Prob_infected'].sum().reset_index()\ndf_p=df_p.groupby(['County','Month']).mean()['Prob_infected'].reset_index() #\u00a0Mean per month \n\nax = sns.lineplot(x='Month', y=\"Prob_infected\", hue=\"County\",data=df_p[['Month','Prob_infected','County']],marker='o',lw=0.8,legend=False)\n\n#sns.set()","cb0609a1":"df_p=df.groupby(['County','Year','Month'])['Prob_infected'].sum().reset_index()\ndf_p=df_p.groupby(['County','Month']).mean()['Prob_infected'].reset_index() #\u00a0Mean per month \nMost_infected=df_p.groupby(['County']).sum()['Prob_infected'].reset_index().sort_values('Prob_infected').iloc[-15::]['County']\nLeast_infected=df_p.groupby(['County']).sum()['Prob_infected'].reset_index().sort_values('Prob_infected').iloc[0:15]['County']\nplt.figure(figsize=(16, 6))\nplt.title('Monthly probability of influenza positive test per County',fontsize=15)\nsns.set()\nselected_counties=np.concatenate([Most_infected[-4::],Least_infected[0:4]])\n\ndf_p=df_p[df_p['County'].isin(selected_counties)]\n\nax = sns.lineplot(x='Month', y=\"Prob_infected\", hue=\"County\",data=df_p[['Month','Prob_infected','County']],marker='o',lw=1,legend='full')\n","8c90e823":"df_p=df[['County','Year','Population','Beds_hospital','Service_hospital']]\ndf_p=df_p[df_p['Year']==2017]\ndf_p['Prop_hosp_beds']=df_p['Beds_hospital']\/df_p['Population']\ndf_p['Prop_hosp_service']=df_p['Service_hospital']\/df_p['Population']\ndf_p=df_p.drop_duplicates()\nplt.figure(figsize=(16, 6))\nplt.title('2020 proportion of hospital beds per County',fontsize=15)\n\nsns.set()\nax=sns.barplot(x='County',y='Prop_hosp_beds',data=df_p)\n\nfor item in ax.get_xticklabels():\n    item.set_rotation(90)\nsns.set()\n\nplt.figure(figsize=(16, 6))\nplt.title('2020 proportion of hospital service per County',fontsize=15)\nsns.set()\nax=sns.barplot(x='County',y='Prop_hosp_service',data=df_p)\nfor item in ax.get_xticklabels():\n    item.set_rotation(90)\nsns.set()\n\n\ndf_p=df[['County','Year','Population','Discharges_Other_Hospital_intervention',\n       'Discharges_Respiratory_system_interventions',\n       'Total_Charge_Other_Hospital_intervention',\n       'Total_Charge_Respiratory_system_interventions']]\ndf_p=df_p.groupby(['County','Year','Population']).sum().reset_index()\ndf_p=df_p[df_p['Year'].isin([2009,2010,2011,2012,2013,2014,2015,2016,2017])]\ndf_p=df_p.groupby(['County','Population']).mean().reset_index()\n\ndf_p['Discharges_respiratory_pp']=df_p['Discharges_Respiratory_system_interventions']\/df_p['Population']\ndf_p.head()\nplt.figure(figsize=(16, 6))\nplt.title('Average respiratory medical interventions per person',fontsize=15)\nsns.set()\nax=sns.barplot(x='County',y='Discharges_respiratory_pp',ci=None,data=df_p)\nfor item in ax.get_xticklabels():\n    item.set_rotation(90)\n\ndf_p=df[['County','Year','Population','Discharges_Other_Hospital_intervention',\n       'Discharges_Respiratory_system_interventions',\n       'Total_Charge_Other_Hospital_intervention',\n       'Total_Charge_Respiratory_system_interventions']]\ndf_p=df_p.groupby(['County','Year','Population']).sum().reset_index()\ndf_p=df_p[df_p['Year'].isin([2009,2010,2011,2012,2013,2014,2015,2016,2017])]\ndf_p=df_p.groupby(['County','Population']).mean().reset_index()\ndel df_p['Year']\n\ndf_p['Totcharge_respiratory_pp']=df_p['Total_Charge_Respiratory_system_interventions']\/df_p['Population']\ndf_p.head()\nplt.figure(figsize=(16, 6))\nplt.title('Average total expenditure of respiratory medical interventions per person',fontsize=15)\nsns.set()\nax=sns.barplot(x='County',y='Totcharge_respiratory_pp',ci=None,data=df_p)\nfor item in ax.get_xticklabels():\n    item.set_rotation(90)\nsns.set()\n#df_p=df_p[df_p['County'].isin(Most_infected)]\n#df_p.head(10)","f2ed1cfb":"df_p=df.groupby(['County','Year','Month'])['Prob_infected'].sum().reset_index()\ndf_p=df_p.rename(columns={'Prob_infected':'Prob_month_infected'})\n#df_p=df_p.groupby(['County','Year''Month']).mean()['Prob_infected'].reset_index() #\u00a0Mean per month \n\ndf=df.set_index(['County','Year','Month']).join(df_p.set_index(['County','Year','Month']))\ndf=df.reset_index()\n\ndf_p=df.groupby(['County','Season'])['Prob_infected'].sum().reset_index()\ndf_p=df_p.rename(columns={'Prob_infected':'Prob_season_infected'})\n\n\ndf=df.set_index(['County','Season']).join(df_p.set_index(['County','Season']))\ndf=df.reset_index()","7bc3f810":"df_p=df.groupby(['County','Year','Population','Month','Season','Region']).mean().reset_index()\ndf_month=df_p[['County', 'Year', 'Month','Avg household size','Area',\n       'Population', 'Under_18', '18-24', '25-44', '45-64', 'Above_65',\n       'Median_age', 'Medianfamilyincome', 'Number_households',\n       'Beds_adult_facility_care', 'Beds_hospital', 'County_Served_hospital',\n       'Service_hospital', 'Discharges_Other_Hospital_intervention',\n       'Discharges_Respiratory_system_interventions',\n       'Total_Charge_Other_Hospital_intervention',\n       'Total_Charge_Respiratory_system_interventions', 'Unemp_rate', 'Density', 'Prob_month_infected','Prob_season_infected']]\ndf_p=df.groupby(['County','Season','Region']).mean().reset_index()\ndf_season=df_p[['County','Season','Avg household size','Area',\n       'Population', 'Under_18', '18-24', '25-44', '45-64', 'Above_65',\n       'Median_age', 'Medianfamilyincome', 'Number_households',\n       'Beds_adult_facility_care', 'Beds_hospital', 'County_Served_hospital',\n       'Service_hospital', 'Discharges_Other_Hospital_intervention',\n       'Discharges_Respiratory_system_interventions',\n       'Total_Charge_Other_Hospital_intervention',\n       'Total_Charge_Respiratory_system_interventions', 'Unemp_rate', 'Density','Prob_season_infected']]","8945a503":"df_season=df_season.dropna()\nall_columns = \"+\".join(df_season.columns)\nall_columns=all_columns.replace('County+','')\nall_columns=all_columns.replace('+Prob_season_infected','')\nmy_formula = \"Prob_season_infected ~\" + all_columns\nimport statsmodels.api as sm\nimport statsmodels.formula.api as smf\nmd=smf.mixedlm(\"Prob_season_infected ~Area+Population+Under_18+Above_65+Median_age+Medianfamilyincome+Number_households+Beds_adult_facility_care+Beds_hospital+County_Served_hospital+Service_hospital+Discharges_Other_Hospital_intervention+Discharges_Respiratory_system_interventions+Total_Charge_Other_Hospital_intervention+Total_Charge_Respiratory_system_interventions+Unemp_rate+Density\", df_season,groups=df_season[\"County\"])\nmdf = md.fit()\nprint(mdf.summary())","fa5621dc":"<h1>EDA New York State Influenza 2009-2019<\/h1>\n<img src=\"https:\/\/www.news-medical.net\/image.axd?picture=2018%2F3%2Fshutterstock_Katryna_Kon-2.jpg\" width=500><\/img>\n# Introduction\nNew York is one of the most affected cities in the COVID-19 pandemia and the knowledge of the distribution of previous infections could be relevant in order to predict future spreadings or develop efficient sampling methods.\nHere I will do a simple EDA of our dataset with prospects of finding relevant information. \nLet\u00b4s start plotting the probability of being diagnosed with influenza.","218ce6cd":"Lets find significance of variables, as we pretend to understand how this variables can affect the probability of being infected. We will fit a Linear Mixed Effects Model since we are working with panel data (Counties are the Groups). As we want to know which variables are relevant in order to be diagnosed with Influenza, we will group our data by Season (Oct09-May10, Oct10-May11,...,Oct18-Mar19) since the effects of some variables wouldnt appear wiht weakly or even monthly data.","15021a8f":"We will try to see differences per county in health expenditure as this could explain the differences between counties.","1545871d":"Lets zoom the behavior of the Counties with the highest probability and those with the smallest","a8cacd80":"We see places with higher probabilities tend to remains higher during all months,this seemed possible since a bigger number of infected people will make the infection more persistent in time.","fc303b40":"The average total expenditure of respiratory data are not so relevant as they tend to be higher in high populated areas since they have bigger hospitals and some very expensive operations only can be made there and not in small counties.","98bfedaa":"Let\u00b4s see how the probability of being diagnosed with influenza varies monthly.","44340be5":"We can see important differences between Counties. Its very strange that places like New York City are suffering one of the smallest rates sice is one of the most densely populated places.  If we plot the probability of being diagnosed influenza weakly during the period we can see the cyclical behavior and a increasing trend.","e339d099":"Lets see which variables are affection the rates.","5f0c6738":"**Continue...**","ccb81519":"Clearly Unemployment is the variable more important to determine rates and the relation is negative. The higher the unemployment the lower is the amount of infections! This seems reasonable since people working are more likely to have a medical insurance.\nThis suggests the data is biased, and not showing the real amount of infected people.\n\nMedian family income is also significant and the meaning could be similar to Unemployment. Wealthier families are more likely to be evaluated.\n\nOther relevant variables are % of population under 18, and in this case the relation is positive. The younger the population, the lower the probability of a positive test. This could be due to severity of influenza in younger population."}}