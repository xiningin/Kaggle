{"cell_type":{"6ffaea1a":"code","5a789f74":"code","f17c5457":"code","a02796c8":"code","492c613f":"code","d4a5ceb5":"code","713fa56f":"code","2715b592":"code","11733ade":"code","b5da2dff":"code","5d5381ef":"code","1caf0586":"code","dfa1ad4f":"code","4388cd62":"code","67a473c6":"code","7a10d479":"code","bca778a9":"code","bf23b54c":"code","0cab4275":"code","9c02742a":"code","2adb0633":"code","2b7826f3":"code","9ecf93f6":"code","530be9f7":"code","795948ae":"code","2c712f1d":"code","6c7adc5b":"code","f4f73a3e":"code","1dc6ac63":"code","2b3b91bf":"code","44607b6d":"markdown","7a1262cb":"markdown","26182c28":"markdown","54fa98c1":"markdown","318cb2cf":"markdown","a2dafab3":"markdown","bed1d756":"markdown","46f77c8b":"markdown","bbde9246":"markdown","1900d70f":"markdown","df5d84f7":"markdown","323ec70d":"markdown","7271d331":"markdown","7b76c2af":"markdown","caff4e99":"markdown","b32f3f5d":"markdown","b54a7da0":"markdown","9fe4711b":"markdown","9d3b4b82":"markdown","6d2d5c76":"markdown","98017f0c":"markdown","8b3e6bd3":"markdown","0f39581c":"markdown","7c21e694":"markdown","363866c3":"markdown","76622251":"markdown","dbfcc86f":"markdown","2d765b48":"markdown","d28ea1f6":"markdown","8d51c033":"markdown","8375aaa0":"markdown"},"source":{"6ffaea1a":"import random\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom imblearn.over_sampling import RandomOverSampler\nfrom imblearn.over_sampling import SMOTE\nfrom imblearn.under_sampling import RandomUnderSampler\nfrom sklearn.ensemble import RandomForestClassifier\nfrom xgboost import XGBClassifier\nfrom sklearn.linear_model import RidgeClassifier\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score\nimport eli5\nfrom eli5.sklearn import PermutationImportance","5a789f74":"pd.set_option('display.max_columns', 60)","f17c5457":"data = pd.read_csv('\/kaggle\/input\/african-country-recession-dataset-2000-to-2017\/africa_recession.csv')\ndata.head(10)","a02796c8":"data.info()","492c613f":"'Dataset contains nulls: {}'.format(data.isnull().any().any())","d4a5ceb5":"sns.distplot(a=data.growthbucket, kde=False)","713fa56f":"plt.figure(figsize=(15, 13))\nsns.heatmap(data=data.corr())","2715b592":"X_usampled, y_usampled = RandomUnderSampler(random_state=0).fit_resample(\n    data.drop(columns=['growthbucket']), \n    data.growthbucket\n)\n\nunder_X = pd.DataFrame(\n    X_usampled, \n    columns=data.drop(columns=['growthbucket']).columns\n)\nunder_y = pd.DataFrame(y_usampled, columns=['growthbucket'])\nunder_data = under_X.join(under_y)","11733ade":"plt.figure(figsize=(15, 13))\n\nplt.subplot(3, 2, 1)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.rdana)\n\nplt.subplot(3, 2, 2)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.emp)\n\nplt.subplot(3, 2, 3)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.csh_g)\n\nplt.subplot(3, 2, 4)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.pl_c)\n\nplt.subplot(3, 2, 5)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.total_change)","b5da2dff":"def test_with_tts(model, data, smpl_strat='rusamp', random_state=0):\n    \n    X_train, X_test, y_train, y_test = train_test_split(\n        data.drop('growthbucket', axis=1), \n        data.growthbucket, \n        random_state=random_state\n    )\n    if smpl_strat == 'rusamp':\n        rus = RandomUnderSampler(random_state=0)\n        X_resampled, y_resampled = rus.fit_resample(X_train, y_train)\n    elif smpl_strat == 'rosamp':\n        ros = RandomOverSampler(random_state=0)\n        X_resampled, y_resampled = ros.fit_resample(X_train, y_train)\n    elif smpl_strat == 'smote':\n        smote = SMOTE(random_state=0)\n        X_resampled, y_resampled = smote.fit_resample(X_train, y_train)        \n    X_resampled = pd.DataFrame(X_resampled, columns=X_test.columns)\n    \n    model.fit(X_resampled, y_resampled)\n    preds = model.predict(X_test)\n    y_test.name = 'expected'\n    results = pd.concat(\n        [y_test, pd.Series(preds, index=y_test.index, name='got')], \n        axis=1\n    )\n\n    recessed = results[results.expected == 1]\n    non_recessed = results[results.expected == 0]\n    acc_rec = accuracy_score(recessed.expected, recessed.got)\n    acc_nrec = accuracy_score(non_recessed.expected, non_recessed.got)\n    \n    return (acc_rec, acc_nrec)\n\ndef test_with_mc(n_it, model, data, smpl_strat='rusamp'):\n    random.seed(0)\n    \n    results_rec = []\n    results_nrec = []\n    for i in range(n_it):\n        r_r, r_n = test_with_tts(\n            model, \n            data, \n            smpl_strat, \n            i*random.randint(0,1e2) # randomises train_test_split\n        )\n        results_rec.append(r_r)\n        results_nrec.append(r_n)\n    acc_rec = sum(results_rec)\/len(results_rec)\n    acc_nrec = sum(results_nrec)\/len(results_nrec)\n    return (acc_rec, acc_nrec)","5d5381ef":"def print_acc_res(a_r):\n    print('Recessed classification accuracy: {}%'.format(round(a_r[0], 2)))\n    print('None-recessed classification accuracy: {}%'.format(round(a_r[1], 2)))","1caf0586":"xgb_us_full = test_with_mc(\n    20, \n    XGBClassifier(n_estimators=500, learning_rate=0.05, random_state=0), \n    data, \n    smpl_strat='rusamp'\n)\n\nprint_acc_res(xgb_us_full)","dfa1ad4f":"xgb_os_full = test_with_mc(\n    20, \n    XGBClassifier(n_estimators=500, learning_rate=0.001, random_state=0), \n    data, \n    smpl_strat='rosamp'\n)\n\nprint_acc_res(xgb_os_full)","4388cd62":"xgb_smote_full = test_with_mc(\n    20, \n    XGBClassifier(n_estimators=500, learning_rate=0.001, random_state=0), \n    data, \n    smpl_strat='smote'\n)\n\nprint_acc_res(xgb_smote_full)","67a473c6":"rf_us_full = test_with_mc(\n    20, \n    RandomForestClassifier(random_state=0), \n    data, \n    smpl_strat='rusamp'\n)\n\nprint_acc_res(rf_us_full)","7a10d479":"rf_os_full = test_with_mc(\n    20, \n    RandomForestClassifier(max_depth=3, random_state=0), \n    data, \n    smpl_strat='rosamp'\n)\n\nprint_acc_res(rf_os_full)","bca778a9":"rf_smote_full = test_with_mc(\n    20, \n    RandomForestClassifier(max_depth=3, random_state=0), \n    data, \n    smpl_strat='smote'\n)\n\nprint_acc_res(rf_smote_full)","bf23b54c":"rid_us_full = test_with_mc(\n    20, \n    RidgeClassifier(alpha=1.0, random_state=0), \n    data, \n    smpl_strat='rusamp'\n)\n\nprint_acc_res(rid_us_full)","0cab4275":"rid_os_full = test_with_mc(\n    20, \n    RidgeClassifier(alpha=1.0, random_state=0), \n    data, \n    smpl_strat='rosamp'\n)\n\nprint_acc_res(rid_os_full)","9c02742a":"rid_smote_full = test_with_mc(\n    20, \n    RidgeClassifier(alpha=10.0, random_state=0), \n    data, \n    smpl_strat='smote'\n)\n\nprint_acc_res(rid_smote_full)","2adb0633":"X = data.drop(columns=['growthbucket'])\ny = data.growthbucket\n\nX_resampled, y_resampled = SMOTE(random_state=0).fit_resample(X, y)\n\nmodel = XGBClassifier(n_estimators=500, learning_rate=0.001, random_state=0)\nmodel.fit(X_resampled,y_resampled)\npermi = PermutationImportance(model, random_state=0).fit(\n    X_resampled,\n    y_resampled\n)\neli5.show_weights(permi, feature_names=X.columns.tolist(), top=100)","2b7826f3":"important_columns = [\n    'rdana',\n    'cwtfp',\n    'pl_x',\n    'pl_c',\n    'pl_n',\n    'rwtfpna',\n    'energy',\n    'csh_r',\n    'metals_minerals_change',\n    'metals_minerals',\n    'agriculture_change',\n    'xr',\n    'cn',\n]\nimportant_columns += ['growthbucket']\n\nimportant_data = data[important_columns]\n\nxgb_smote_imp = test_with_mc(\n    20, \n    XGBClassifier(n_estimators=500, learning_rate=0.001, random_state=0),\n    important_data, \n    smpl_strat='smote'\n)\n\nprint_acc_res(xgb_smote_imp)","9ecf93f6":"sns.swarmplot(x=under_data.growthbucket, y=under_data.rdana)","530be9f7":"plt.figure(figsize=(15, 4))\n\nplt.subplot(1, 2, 1)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.cwtfp)\n\nplt.subplot(1, 2, 2)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.rwtfpna)","795948ae":"plt.figure(figsize=(15, 13))\n\nplt.subplot(3, 2, 1)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.pl_x)\n\nplt.subplot(3, 2, 2)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.pl_c)\n\nplt.subplot(3, 2, 3)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.pl_n)\n\nplt.subplot(3, 2, 4)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.energy)\n\nplt.subplot(3, 2, 5)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.metals_minerals)","2c712f1d":"plt.figure(figsize=(15, 4))\n\nplt.subplot(1, 2, 1)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.metals_minerals_change)\n\nplt.subplot(1, 2, 2)\nsns.swarmplot(x=under_data.growthbucket, y=under_data.agriculture_change)","6c7adc5b":"sns.swarmplot(x=under_data.growthbucket, y=under_data.csh_r)","f4f73a3e":"sns.swarmplot(x=under_data.growthbucket, y=under_data.xr)","1dc6ac63":"sns.swarmplot(x=under_data.growthbucket, y=under_data.cn)","2b3b91bf":"f_data = important_data.copy()\n\nf_data['rdana_to_pl_x'] = f_data['rdana']\/f_data['pl_x']\nf_data['energy_to_rdana'] = f_data['energy']\/f_data['rdana'] \nf_data['xr_to_cwtfp'] = f_data['xr']\/f_data['cwtfp'] \n\nxgb_smote_eng = test_with_mc(\n    20, \n    XGBClassifier(n_estimators=500, learning_rate=0.001, random_state=0),\n    f_data, \n    smpl_strat='smote'\n)\n\nprint_acc_res(xgb_smote_eng)","44607b6d":"From the correlation matrix we could distinguish some feature clusters:\n- [pl_c:fish] - represent price level\n- [total_change:fish_change] - represent price level year-to-year change\n- [ccon: mna] - correlation seem to be strong, but it's origin is unclear\n\nWe can now visualize some meaningful dependencies, using the correlations and what we know about a recession. This will include:\n- rdana (since it represents total demand for all final marketed goods and services)\n- emp \n- csh_g (government consumption)\n- pl_c and total_change from clusters (to check how most of our data behaves)","7a1262cb":"<h2 id=\"eda\">Data analysis<\/h2>","26182c28":"Random Forest is almost as good as XGBoost, but I think XGBoost gives us a better compromise between none-recessed-classification accuracy and recessed-classification accuracy.","54fa98c1":"Let's start with quickly reviewing some summary:","318cb2cf":"Now let's see what we got:\n\nrdana - \"Real domestic absorption at constant 2011 national prices\"\n\nWe knew that was coming, and this is consistent with our understanding of the recession mechanism.","a2dafab3":"<h2 id=\"features\">Extraction and engineering of important features<\/h2>","bed1d756":"Random undersampling is a simple and easy-to-understand strategy. However, in this particular case, it left us with ~80 rows in the dataset, which leads to low none-recessed-classification accuracy. Even if recessed-classification accuracy is good (and it usually is) this does not fit our success criteria.","46f77c8b":"xr - exchange rate. \n\nThis could reflect the impact of other countries' economic influence or international reaction on the recession.","bbde9246":"metals_minerals_change, agriculture_change - these reflect the price level year-to-year change. \n\nBased on this and the previous category, we can conclude that the economies of African countries (at least many of them) are highly dependent on the prices of metals and minerals.","1900d70f":"csh_r - \"Share of residual trade and GDP statistical discrepancy at current PPPs\"\n\nTo be honest, I lack the domain knowledge to understand this parameter. Luckily, it seems not too important concerning other parameters.","df5d84f7":"cn - \"Capital stock at current PPPs\". \n\nThis is another parameter that can serve as a measure of business activity.","323ec70d":"<h2 id=\"results\">Results analysis<\/h2>","7271d331":"So, how useful our model really is? Let's try to estimate how much money we could save.\n\nWe'll take Germany as an example. It's not really in Africa, but we could find some reliable information about its economy that will help us see the big picture. Here is what I managed to find ([Germany's GDP\/time graph](https:\/\/www.google.com\/publicdata\/explore?ds=d5bncppjof8f9_&ctype=l&strail=false&bcs=d&nselm=h&met_y=ny_gdp_mktp_cd&scale_y=lin&ind_y=false&rdim=country&idim=country:DEU&ifdim=country:region:ECS&hl=en&dl=en&ind=false), [Germany's spending on recession](https:\/\/markets.businessinsider.com\/news\/stocks\/germany-bundesbank-flag-recession-50-billion-euros-prepared-2019-8-1028456157))\n\nAccording to the graph, for seven years from 2001 to 2008, Germany\u2019s GDP grew by \\$ 1.8 trillion, with a growth rate of \\$ 0.26 trillion (\\$ 260 billion) per year. From 2008 to 2017, the German economy seems to be in a state of recession (GDP stagnates). In the best-case scenario, if a recession were discovered and averted in 2009, Germany would have produced an additional \\$ 0.26 * 8 = \\$ 2.08 trillion (\\$ 2080 billion). \n\nOn the other hand, according to an article, to fight the ongoing recession the German government plans to spend $ 55 billion. Even though comparing GDP and direct government spending is not entirely correct, we can say that fighting a recession is more profitable than putting up with it.\n\nNow back to our model. We have 27 countries in our dataset, from which ~10% (or 3 countries) is recessed. Let's say we have 27 Germanies. From 25 non-recessed countries ~15% (or 4 countries) will get false-positive recession classification and will spend \\$ 55 billion \\* 4 = \\$ 220 billion for nothing, which is a negative effect of our model. From 3 recessed countries 67% (or 2 countries) will recognize recession and will save \\$ 2080 billion \\* 2 = \\$ 4160 billions of GDP, which is a positive effect of our model. \n\nTo compare these numbers, let's convert GDP to German government direct revenues, and to facilitate the task we use only the income tax. Germany uses a progressive income tax scale, it can vary from 19% to 53%. Again, to facilitate the calculations, we take it equal to the average of these two numbers (i.e. 36%). Thus, the governments of recessed Germanies will save \\$ 4160 billion \\* 36% = \\$ 1498 billions of direct revenues. This gave us \\$ 1498 billions - \\$ 220 billions = \\$ 1278 billions of clear positive effect. We could also say, what average spending for our model is \\$ 8 billion per country, and the average income is \\$ 47 billion per country.\n \nAfter all, it *will* save them billions of dollars. ","7b76c2af":"<h2 id=\"conclusion\">Conclusion<\/h2>","caff4e99":"<h2 id=\"data_libs\">Loading data and libs<\/h2>","b32f3f5d":"<h2 id=\"intro\">Introduction<\/h2>","b54a7da0":"XGBoost (especially with SMOTE) looks appropriate for our model.","9fe4711b":"At this point rdana, csh_g and pl_c looks the most interesting. However, it's still hard to tell which exact features will we need to build a successful model. Instead, we'll try to train a preliminary model to highlight important features.","9d3b4b82":"<h2 id=\"model\">Model training<\/h2>","6d2d5c76":"pl_x, pl_c, pl_n, energy, metals_minerals - these all reflect the price level:","98017f0c":"In order to extract important features we'll use permutation importances:","8b3e6bd3":"As it was mentioned before, our target variable has significant class imbalance. We'll try to handle it later with [undersampling and oversampling techniques](https:\/\/en.wikipedia.org\/wiki\/Oversampling_and_undersampling_in_data_analysis) (realisation provided by [imbalanced-learn library](https:\/\/imbalanced-learn.readthedocs.io\/en\/stable\/index.html#)).","0f39581c":"First, we need to develop a method to correctly measure model accuracy. Since our target variable has a class imbalance, we need something a little bit more complex than simple cross-validation. We'll use the following scheme:\n- Randomly split data on train and test sets.\n- Handle class imbalance in train set with one of three available methods: random undersampling, random oversampling or oversampling with SMOTE algorithm.\n- Train and test the model, separately measuring the accuracy of determining a recession and accuracy of determining the absence of a recession.\n- Repeat this multiple times and average the results.","7c21e694":"cwtfp - \"Welfare-relevant TFP levels at current PPPs\"\n\nrwtfpna - \"Welfare-relevant TFP at constant national prices\"\n\nTFP stands for Total Factor Productivity - economic parameter reflecting long-term technological changes and their impact on output. Its influence on the model can probably be explained by the technological lag of several African countries and its negative impact on economic development.","363866c3":"Next, let's test some models find which is best-performed. We'll check out XGBoost, RandomForest and Ridge.","76622251":"You know what's cool in analyzing macroeconomic data? You can easily say \"it will save them billions of dollars,\" and in many cases, you will be right. The macroeconomic scale allows us to easily feel the usefulness (or harmfulness) of the models we have build. If you also like this sense of importance, join me in my attempt today to discover a recession in African countries.\n\nSo, what's a [recession](https:\/\/en.wikipedia.org\/wiki\/Recession)? Generally, it is a decline in economic activity lasting more than a few months. More precisely, a recession is usually spoken of in the case of prolonged stagnation or fall in GDP, where GDP is an economic parameter that reflects the value of all goods and services produced per year in all sectors of the economy on the territory of the country. The emergence of recessions is usually associated with a general decline in demand for goods and services. Since any economy behaves in cycles, successively going through the stages of growth and decline, this is a fairly common situation.\n\n![image.png](attachment:image.png)\n\nHowever, even if it's common it isn't good. Reducing the demand for goods and services entails a reduction in their production, which leads to the fact that companies lose money and their employees lose their jobs. This, of course, can lead to an even greater decrease in demand, as a result of which the situation will worsen. Therefore, to remove the economy from a state of recession, governments usually take certain measures, in particular, increasing their expenses and reducing taxes.\n\nThus, we can say that if you are from a government, investment fund or an international company, it will be very important for you to know whether the economy of the country you are interested in is in a state of recession.\n\nA few words about the success criteria of the model. When I've started this analysis, I thought I need to build a model as accurate as possible. However, as we soon will see, imbalance in target variable classes and the small size of a dataset leads us to search for a compromise between the accuracy of determining the recession and the accuracy of determining the absence of a recession. The optimal relationship between them will depend on the cost of the mistake in both cases, which is difficult for me to evaluate due to poor knowledge of the domain. Reflecting on how this model can be used, I settled on a conservative strategy: the accuracy of determining the absence of a recession should be quite high (I would say at least 85%), and the accuracy of determining a recession should be as high as possible.\n\nBefore we will jump into analysis, I've wanted to thank Chiri for posting this great dataset and making this project possible.","dbfcc86f":"From the plots above we can find the best-looking criteria for separation recessed from non-recessed. These are rdana, cwtfp, rwtfpna and price levels (pl_\\*). We can slightly improve model performance by adding some dependencies between them to data:","2d765b48":"Great! No missing values or categorical variables, so we don't need to waste any time handling it.\n\nHere is our target variable:","d28ea1f6":"Ridge works fine, but not as good as XGB and RF. So our choice is XGBoost with SMOTE oversampling strategy. Let's use it to highlight important features for us.","8d51c033":"Oversampling strategies tend to improve none-recessed-classification accuracy and slightly worsen recessed-classification accuracy, which is a better fit for our success criteria. SMOTE is generally a little bit better than random oversampling.","8375aaa0":"During this analysis, we managed to build a useful model to detect recession in African countries. However, I'm pretty sure it could be improved, for example with the use of domain knowledge or more complex model tuning. I also think what it's more important to improve non-recessed classification accuracy to increase the model's efficiency. Of course, I will be grateful for any useful comments."}}