{"cell_type":{"c6c89b46":"code","ef864abf":"code","5784e93a":"code","d5e9f71d":"code","749b50d0":"code","c6151571":"code","2827969e":"code","96f2f47e":"code","1e67ea50":"code","292fecc2":"code","ff606737":"code","7354ff4c":"code","dca1dfca":"code","721e0bf6":"code","9ead28f3":"code","e7e4ebdb":"code","fb95a44b":"code","9a50b6a7":"code","0b0c6908":"code","97158865":"code","cf0ee936":"code","c8fddc5f":"code","766e541d":"markdown","80a779b5":"markdown","773b4cf8":"markdown","0f0b661c":"markdown","990d8ce2":"markdown","b609fcba":"markdown","cfb700cd":"markdown","564684dd":"markdown","b7422e0a":"markdown","71b0c0bf":"markdown","0da9ac7a":"markdown","9dd17d85":"markdown","19d1f295":"markdown","e2d51c33":"markdown","5fe6d482":"markdown","e269173e":"markdown","c9415387":"markdown","82693f37":"markdown"},"source":{"c6c89b46":"from IPython.core.display import display, HTML\ndisplay(HTML(\"<style>.container { width:100% !important; }<\/style>\"))","ef864abf":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\nfrom ipywidgets import widgets, interactive, interact\nimport ipywidgets as widgets\nfrom IPython.display import display\n\nimport os","5784e93a":"pd.set_option(\"display.max_column\", 2000)","d5e9f71d":"# for dirname, _, filenames in os.walk(\".\/\"):\n#     for filename in filenames:\n#         print(os.path.join(dirname, filename))","749b50d0":"base_paht = \"\/kaggle\/input\/\"","c6151571":"train_sales = pd.read_csv(base_paht+\"m5-forecasting-accuracy\/sales_train_validation.csv\")","2827969e":"calendar_df = pd.read_csv(base_paht+\"m5-forecasting-accuracy\/calendar.csv\")\ncalendar_slim_df = calendar_df[[\"d\", \"date\", \"weekday\", \"wm_yr_wk\"]]\ncalendar_slim_df.rename(columns={\"d\": \"day_count\"}, inplace=True)\ndel calendar_df\n# calendar_slim_df","96f2f47e":"sell_prices = pd.read_csv(base_paht+\"m5-forecasting-accuracy\/sell_prices.csv\")","1e67ea50":"id_list = [\"id\", \"item_id\", \"dept_id\", \"cat_id\", \"store_id\", \"state_id\"]\ndays_list = list(filter(lambda x: x not in id_list, list(train_sales.columns)))\n# unpivot\ntemp_unpivot_list      = [\"id\"] + days_list\ntemp_unpivot_df        = train_sales[temp_unpivot_list]\ntrain_sales_df         = pd.melt(temp_unpivot_df, id_vars=[\"id\"], value_vars=days_list)\ntrain_sales_df.columns = [\"id\", \"day_count\", \"quantity\"]\ndel days_list, temp_unpivot_list, temp_unpivot_df\neda_base_table = train_sales_df.merge(train_sales[id_list], how=\"left\", on=\"id\")\ndel id_list, train_sales_df, train_sales","292fecc2":"## join calendar\neda_base_table = eda_base_table.merge(calendar_slim_df, how=\"left\", on=\"day_count\")\ndel calendar_slim_df\n## join calendar\neda_base_table = eda_base_table.merge(sell_prices, how=\"left\", on=[\"store_id\", \"item_id\",\"wm_yr_wk\"])\ndel sell_prices","ff606737":"eda_base_table = eda_base_table[[\"date\", \"weekday\", \"wm_yr_wk\", \"quantity\" ,\"item_id\", \"dept_id\", \"cat_id\", \"store_id\", \"state_id\"]]","7354ff4c":"eda_base_table.head()","dca1dfca":"quantity_state_df = eda_base_table.groupby([\"date\", \"state_id\"]).sum()\nquantity_state_df = quantity_state_df[\"quantity\"].reset_index()\nquantity_state_df = pd.pivot_table(quantity_state_df, index=\"date\", columns=\"state_id\", values=\"quantity\")\nplt.figure()\nquantity_state_df.plot(figsize=(36, 6))\ndel quantity_state_df","721e0bf6":"quantity_store_df = eda_base_table.groupby([\"date\", \"store_id\"]).sum()\nquantity_store_df = quantity_store_df[\"quantity\"].reset_index()\nquantity_store_df = pd.pivot_table(quantity_store_df, index=\"date\", columns=\"store_id\", values=\"quantity\")\nplt.figure()\nquantity_store_df[[\"CA_1\", \"CA_2\", \"CA_3\", \"CA_4\"]].plot(figsize=(36, 6))\nquantity_store_df[[\"TX_1\", \"TX_2\", \"TX_3\"]].plot(figsize=(36, 6))\nquantity_store_df[[\"WI_1\", \"WI_2\", \"WI_3\"]].plot(figsize=(36, 6))\ndel quantity_store_df","9ead28f3":"quantity_cat_df = eda_base_table.groupby([\"date\", \"cat_id\"]).sum()\nquantity_cat_df = quantity_cat_df[\"quantity\"].reset_index()\nquantity_cat_df = pd.pivot_table(quantity_cat_df, index=\"date\", columns=\"cat_id\", values=\"quantity\")\nplt.figure()\nquantity_cat_df.plot(figsize=(36, 6))\ndel quantity_cat_df","e7e4ebdb":"quantity_dept_df = eda_base_table.groupby([\"date\", \"dept_id\"]).sum()\nquantity_dept_df = quantity_dept_df[\"quantity\"].reset_index()\nquantity_dept_df = pd.pivot_table(quantity_dept_df, index=\"date\", columns=\"dept_id\", values=\"quantity\")\nplt.figure()\n# quantity_dept_df.plot(figsize=(36, 6))\nquantity_dept_df[[\"FOODS_1\", \"FOODS_2\", \"FOODS_3\"]].plot(figsize=(36, 6))\nquantity_dept_df[[\"HOBBIES_1\", \"HOBBIES_2\"]].plot(figsize=(36, 6))\nquantity_dept_df[[\"HOUSEHOLD_1\", \"HOUSEHOLD_2\"]].plot(figsize=(36, 6))\ndel quantity_dept_df","fb95a44b":"quantity_item_df = eda_base_table.groupby([\"date\", \"dept_id\", \"item_id\"]).sum()\nquantity_item_df = quantity_item_df[\"quantity\"].reset_index()\nquantity_item_df = pd.pivot_table(quantity_item_df, index=\"date\", columns=[\"dept_id\", \"item_id\"], values=\"quantity\")\nplt.figure()\n# quantity_item_df.plot(figsize=(36, 6))\nquantity_item_df[[\"FOODS_1\", \"FOODS_2\", \"FOODS_3\"]].plot(figsize=(36, 6))\nquantity_item_df[[\"HOBBIES_1\", \"HOBBIES_2\"]].plot(figsize=(36, 6))\nquantity_item_df[[\"HOUSEHOLD_1\", \"HOUSEHOLD_2\"]].plot(figsize=(36, 6))\ndel quantity_item_df","9a50b6a7":"quantity_state_weekday_df = eda_base_table.groupby([\"weekday\", \"state_id\"]).sum()\nquantity_state_weekday_df = quantity_state_weekday_df[\"quantity\"].reset_index()\nquantity_state_weekday_df = pd.pivot_table(quantity_state_weekday_df, index=\"weekday\", columns=\"state_id\", values=\"quantity\")\nquantity_state_weekday_df[\"temp_no\"] = [6,2,7,1,5,3,4]\nquantity_state_weekday_df.sort_values(\"temp_no\", inplace=True)\ndel quantity_state_weekday_df[\"temp_no\"]\nplt.figure()\nquantity_state_weekday_df.plot(figsize=(36, 6))\ndel quantity_state_weekday_df","0b0c6908":"quantity_state_store_df = eda_base_table.groupby([\"weekday\", \"store_id\"]).sum()\nquantity_state_store_df = quantity_state_store_df[\"quantity\"].reset_index()\nquantity_state_store_df = pd.pivot_table(quantity_state_store_df, index=\"weekday\", columns=\"store_id\", values=\"quantity\")\nquantity_state_store_df[\"temp_no\"] = [6,2,7,1,5,3,4]\nquantity_state_store_df.sort_values('temp_no', inplace=True)\nquantity_state_store_df.sort_values(\"temp_no\", inplace=True)\ndel quantity_state_store_df[\"temp_no\"]\nplt.figure()\nquantity_state_store_df[[\"CA_1\", \"CA_2\", \"CA_3\", \"CA_4\"]].plot(figsize=(36, 6))\nquantity_state_store_df[[\"TX_1\", \"TX_2\", \"TX_3\"]].plot(figsize=(36, 6))\nquantity_state_store_df[[\"WI_1\", \"WI_2\", \"WI_3\"]].plot(figsize=(36, 6))\ndel quantity_state_store_df","97158865":"quantity_cat_weekday_df = eda_base_table.groupby([\"weekday\", \"cat_id\"]).sum()\nquantity_cat_weekday_df = quantity_cat_weekday_df[\"quantity\"].reset_index()\nquantity_cat_weekday_df = pd.pivot_table(quantity_cat_weekday_df, index=\"weekday\", columns=\"cat_id\", values=\"quantity\")\nquantity_cat_weekday_df[\"temp_no\"] = [6,2,7,1,5,3,4]\nquantity_cat_weekday_df.sort_values('temp_no', inplace=True)\nquantity_cat_weekday_df.sort_values(\"temp_no\", inplace=True)\ndel quantity_cat_weekday_df[\"temp_no\"]\nplt.figure()\nquantity_cat_weekday_df.plot(figsize=(36, 6))\ndel quantity_cat_weekday_df","cf0ee936":"quantity_dept_id_weekday_df = eda_base_table.groupby([\"weekday\", \"dept_id\"]).sum()\nquantity_dept_id_weekday_df = quantity_dept_id_weekday_df[\"quantity\"].reset_index()\nquantity_dept_id_weekday_df = pd.pivot_table(quantity_dept_id_weekday_df, index=\"weekday\", columns=\"dept_id\", values=\"quantity\")\nquantity_dept_id_weekday_df[\"temp_no\"] = [6,2,7,1,5,3,4]\nquantity_dept_id_weekday_df.sort_values('temp_no', inplace=True)\nquantity_dept_id_weekday_df.sort_values(\"temp_no\", inplace=True)\ndel quantity_dept_id_weekday_df[\"temp_no\"]\nplt.figure()\nquantity_dept_id_weekday_df[[\"FOODS_1\", \"FOODS_2\", \"FOODS_3\"]].plot(figsize=(36, 6))\nquantity_dept_id_weekday_df[[\"HOBBIES_1\", \"HOBBIES_2\"]].plot(figsize=(36, 6))\nquantity_dept_id_weekday_df[[\"HOUSEHOLD_1\", \"HOUSEHOLD_2\"]].plot(figsize=(36, 6))\ndel quantity_dept_id_weekday_df","c8fddc5f":"quantity_item_id_weekday_df = eda_base_table.groupby([\"weekday\", \"dept_id\", \"item_id\"]).sum()\nquantity_item_id_weekday_df = quantity_item_id_weekday_df[\"quantity\"].reset_index()\nquantity_item_id_weekday_df = pd.pivot_table(quantity_item_id_weekday_df, index=\"weekday\", columns=[\"dept_id\", \"item_id\"], values=\"quantity\")\nquantity_item_id_weekday_df[\"temp_no\"] = [6,2,7,1,5,3,4]\nquantity_item_id_weekday_df.sort_values('temp_no', inplace=True)\nquantity_item_id_weekday_df.sort_values(\"temp_no\", inplace=True)\ndel quantity_item_id_weekday_df[\"temp_no\"]\nplt.figure()\n# quantity_item_id_weekday_df.plot(figsize=(36, 6))\nquantity_item_id_weekday_df[[\"FOODS_1\", \"FOODS_2\", \"FOODS_3\"]].plot(figsize=(36, 6))\nquantity_item_id_weekday_df[[\"HOBBIES_1\", \"HOBBIES_2\"]].plot(figsize=(36, 6))\nquantity_item_id_weekday_df[[\"HOUSEHOLD_1\", \"HOUSEHOLD_2\"]].plot(figsize=(36, 6))\ndel quantity_item_id_weekday_df","766e541d":"## aggr","80a779b5":"# create table","773b4cf8":"### quantity_state_weekday","0f0b661c":"## merge","990d8ce2":"### quantity_item_id_data","b609fcba":"### quantity_store_data","cfb700cd":"### quantity_cat_weekday","564684dd":"## unpivot","b7422e0a":"## refe\n* [Back to (predict) the future - Interactive M5 EDA](https:\/\/www.kaggle.com\/headsortails\/back-to-predict-the-future-interactive-m5-eda)\n* [EDA and Baseline Model](https:\/\/www.kaggle.com\/rdizzl3\/eda-and-baseline-model)","71b0c0bf":"### quantity_dept_id_data","0da9ac7a":"### quantity_store_weekday","9dd17d85":"# read data","19d1f295":"# EDA","e2d51c33":"## memo\nwm_yr_wk:[\u3059\u3079\u3066\u306e\u5e74\u306e\u4e00\u610f\u306e\u9031\u306e\u5e8f\u6570](https:\/\/www.kaggle.com\/c\/m5-forecasting-accuracy\/discussion\/134392#778249)","5fe6d482":"### quantity_dept_id_weekday","e269173e":"### quantity_item_id_weelday","c9415387":"### quantity_state_data","82693f37":"### quantity_cat_data"}}