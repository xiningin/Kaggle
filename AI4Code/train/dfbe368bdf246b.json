{"cell_type":{"0b4842ba":"code","dacc5961":"code","bb6b562f":"code","2eacde8f":"code","e42e0c01":"code","9466cd15":"code","b1486dd2":"code","f9cf3bf5":"code","755a5469":"code","0f0adb66":"code","6ebfe3b8":"code","6202dd61":"code","da38d84b":"code","a448e76c":"markdown","5e796b24":"markdown","daa043a8":"markdown","c6db25ff":"markdown","c404d72e":"markdown","99386df4":"markdown","82b03806":"markdown"},"source":{"0b4842ba":"import scipy.stats\nimport numpy as np\nimport pandas_datareader.data as reader\nimport datetime as dt\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport pandas as pd","dacc5961":"# VaR_1-a=Position*sigma*Qsnd_1-a\n\ndef VaR(Position,sigma,Quantile):\n  VaR=Position*sigma*scipy.stats.norm.ppf(Quantile)\n  return VaR","bb6b562f":"# Test the VaR\nPosition=1000\nsigma=0.05\nQuantile=0.95\n\nVaR(Position,sigma,Quantile)","2eacde8f":"# Define the start and end date\nduration_in_year=1\nselected_stocks=['AAPL','MSFT','TSLA','BIDU']\n","e42e0c01":"end=dt.datetime.now()\nstart=dt.datetime(end.year-duration_in_year,end.month,end.day)\n\ndf=reader.get_data_yahoo(selected_stocks,start,end)['Adj Close']\nreturns=np.log(1+df.pct_change())\nreturns.dropna(inplace=True)","9466cd15":"def plot_return(figsize):\n  colors=['b', 'g', 'r', 'c', 'm', 'y', 'k']\n  fig, axes = plt.subplots(len(selected_stocks), 1, figsize=figsize)\n  fig.suptitle('Stocks Return Histogram')\n  for i in range (len(selected_stocks)):\n     sns.histplot(ax=axes[i],data=returns.iloc[:,i],color=colors[i])\n\n# plot the selected stocks return histogram\nplot_return(figsize=(7,15))","b1486dd2":"# Correlation Matrix and Visualization\ncorrmatrix=returns.corr()\n\ncorr_plot=corrmatrix.style.background_gradient(cmap='Reds').set_precision(2)\ncorr_plot","f9cf3bf5":"# Assume just by 1 share at Today\nNow_Price = df.iloc[-1]\nNow_Price","755a5469":"hold_size=[1,1,2,3]\nw = [x \/sum(hold_size) for x in hold_size] # the weight w_i for each stock (Sensitivity)\n\nshare_hold=pd.Series(hold_size,index=Now_Price.index)\n\nPosition=Now_Price.multiply(share_hold)\nPosition","0f0adb66":"VaRarray=[]\nfor i in range(len(Position)):\n  VaRarray.append(VaR(Position[i]*w[i],returns.std()[i],0.95)) # VaR(Position[i]*w[i] calculate the weighted Position Value\nVaRarray=np.array(VaRarray)","6ebfe3b8":"# VaR for selected stocks\nprint(Position.index)\nprint(VaRarray)","6202dd61":"# Portfolio_VaR = sqrt(np.dot(VaRarray,corrmatrix) *VaRarray)\n# Equivalent to the RiskMetrics Model\n# The Risk_Metrics Model (1989, JP Morgan) to calculate the portfolio variance (sigma)\n### w_i = sensitivity respect to each stock for the Portfolio , Since we Calculate the VaR for each stock first, therefore the w_i is the ratio that contribute to the total Portfolio VaR\n# Port_Var= (w_1*sigma_1)^2 + (w_2*sigma_2)^2 + 2 *corr(1,2)*w_1*w_2*sigma_1*sigma_2","da38d84b":"Portfolio_VaR=(np.dot(np.dot(VaRarray,corrmatrix),VaRarray))**(0.5)\nprint('The Portfolio VaR = ',Portfolio_VaR)","a448e76c":"## Function for Simple VaR","5e796b24":"## Import the Stock Data","daa043a8":"# Historical VaR Application for Multiple Stocks ","c6db25ff":"## Input the Portfolio Parameters(How much shares holding for each stock)--- For Today's Price","c404d72e":"## Calculate the VaR for the Portfolio (Selected Stocks)","99386df4":"## Calculate the VaR for each stock and store it into the array","82b03806":"## Plot the Histogram of returns and the Correlation Matrix"}}