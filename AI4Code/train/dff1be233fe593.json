{"cell_type":{"a729924e":"code","36bd6c3e":"code","023b9c75":"code","5788b2a3":"code","1d37650d":"code","cfb1efed":"code","c7cfba86":"code","c7854a13":"code","c517602d":"code","db9c7edf":"code","e8d5d30f":"code","1eaa7b14":"code","facb0fb0":"code","799c036c":"code","43df0f36":"code","665472ac":"code","3ec5db72":"code","77208947":"markdown","26bee3a3":"markdown","fb9b809f":"markdown","ec12112d":"markdown"},"source":{"a729924e":"import os\nimport glob\nimport random\nfrom tqdm import tqdm\n\nimport numpy as np\nimport pandas as pd\n\nimport pydicom\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns","36bd6c3e":"train_df = pd.read_csv(\"..\/input\/rsna-miccai-brain-tumor-radiogenomic-classification\/train_labels.csv\")\nprint(\"Overview of data:\\n\")\ndisplay(train_df)\nprint(f\"Total number of train samples: {train_df.shape[0]}\")","023b9c75":"plt.figure(figsize = (8, 5))\nplt.title(\"MGMT_value (Target) Distribution\", fontsize = 16)\n\nax = sns.countplot(data = train_df, x = \"MGMT_value\", order = [0, 1]);\nax.set_xlabel(xlabel = \"MGMT_value\", fontsize = 12)\nax.set_ylabel(ylabel = \"Count\", fontsize = 12)\n\nfor p in ax.patches:\n    x = p.get_bbox().get_points()[:, 0]\n    y = p.get_bbox().get_points()[1, 1]\n    ax.annotate(f\"{int(y):,} ({100*y\/train_df.shape[0]:.1f}%)\", (x.mean(), y),\n                ha = \"center\", va = \"bottom\")","5788b2a3":"def load_dicom(path):\n    \"\"\"\n    Input: path to a dicom file\n    Output: Image in numpy format\n    Image is min-max normalised\n    \"\"\"\n    dicom = pydicom.read_file(path)\n    data = dicom.pixel_array\n    data = data - np.min(data)\n    if np.max(data) != 0:\n        data = data \/ np.max(data)\n    data = (data * 255).astype(np.uint8)\n    return data\n\n\ndef visualize_sample(brats21id, slice_i, mgmt_value, types = (\"FLAIR\", \"T1w\", \"T1wCE\", \"T2w\")):\n    \"\"\"\n    For a given id in train data, plots the\n    first image of each of the four types\n    \"\"\"\n    plt.figure(figsize = (16, 5))\n    patient_path = os.path.join(\n        \"..\/input\/rsna-miccai-brain-tumor-radiogenomic-classification\/train\/\", \n        str(brats21id).zfill(5),\n    )\n    \n    for i, t in enumerate(types, 1):\n        t_paths = sorted(glob.glob(os.path.join(patient_path, t, \"*\")),\n                         key = lambda x: int(x[:-4].split(\"-\")[-1]))\n        data = load_dicom(t_paths[int(len(t_paths) * slice_i)])\n        \n        plt.subplot(1, 4, i)\n        plt.imshow(data, cmap = \"gray\")\n        plt.title(f\"{t}\", fontsize = 16)\n        plt.axis(\"off\")\n    plt.suptitle(f\"id: {_brats21id}  MGMT_value: {mgmt_value}\", fontsize = 16)\n    plt.show()","1d37650d":"for i in random.sample(range(train_df.shape[0]), 2):\n    _brats21id = train_df.iloc[i][\"BraTS21ID\"]\n    _mgmt_value = train_df.iloc[i][\"MGMT_value\"]\n    visualize_sample(brats21id = _brats21id, mgmt_value = _mgmt_value, slice_i = 0.5)","cfb1efed":"FILES = glob.glob(\"..\/input\/rsna-miccai-brain-tumor-radiogenomic-classification\/train\/*\/*\/*\")\nprint(f\"Total number of Image files: {len(FILES):,}\")","c7cfba86":"files_dict = {\"FLAIR\": [], \"T1w\": [], \"T1wCE\": [], \"T2w\": []}\nfor filename in FILES:\n    scan = filename.split(\"\/\")[-2]\n    if scan == \"FLAIR\":\n        files_dict[\"FLAIR\"].append(filename)\n    elif scan == \"T1w\":\n        files_dict[\"T1w\"].append(filename)\n    elif scan == \"T1wCE\":\n        files_dict[\"T1wCE\"].append(filename)\n    else:\n        files_dict[\"T2w\"].append(filename)\n        \nkeys = list(files_dict.keys())\nvals = [len(files_dict[k]) for k in keys]\n\nplt.figure(figsize = (12, 5))\nplt.title(\"Total files vs MRI type\", fontsize = 16)\n\nax = sns.barplot(x = keys, y = vals)\nax.set_xlabel(xlabel = \"Type\", fontsize = 12)\nax.set_ylabel(ylabel = \"Total Count\", fontsize = 12)\n\nfor p in ax.patches:\n    x = p.get_bbox().get_points()[:, 0]\n    y = int(p.get_bbox().get_points()[1, 1])\n    ax.annotate(f\"{y:,} ({100*y\/len(FILES):.1f}%)\", (x.mean(), y),\n                ha = \"center\", va = \"bottom\")","c7854a13":"def plot_dim_freq(type_name):\n    \"\"\"\n    type_name = [\"FLAIR\", \"T1w\", \"T2w\", \"T1wCE\"]\n    Plots frequency distribution of dimensions\n    of images for the given \"type_name\"\n    \"\"\"\n    def image_size(path):\n        dicom = pydicom.read_file(path)\n        data = dicom.pixel_array\n        return data.shape\n    \n    img_size_dict = dict()\n    for fpath in tqdm(files_dict[type_name]):\n        dims = image_size(fpath)\n        key = str(dims[0]) + \"x\" + str(dims[1])\n        if key in img_size_dict:\n            img_size_dict[key] += 1\n        else:\n            img_size_dict[key] = 1\n    img_size_dict = {k: v for k, v in sorted(img_size_dict.items(), key = lambda item: -1*item[1])}\n    \n    keys = list(img_size_dict.keys())\n    vals = [img_size_dict[k] for k in keys]\n    \n    plt.figure(figsize = (24, 5))\n    plt.title(f\"Image dimension Distribution for \\\"{type_name}\\\" (top 10)\", fontsize = 16)\n    \n    ax = sns.barplot(x = keys[:10], y = vals[:10], order = keys[:10])\n    ax.set_xlabel(xlabel = \"Dimensions\", fontsize = 12)\n    ax.set_ylabel(ylabel = \"Count\", fontsize = 12)\n    \n    for p in ax.patches:\n        x = p.get_bbox().get_points()[:, 0]\n        y = int(p.get_bbox().get_points()[1, 1])\n        ax.annotate(f\"{y:,} ({100*y\/len(files_dict[type_name]):.1f}%)\", (x.mean(), y),\n                    ha = \"center\", va = \"bottom\", fontsize = 8)\n    plt.show()","c517602d":"plot_dim_freq(\"FLAIR\")","db9c7edf":"plot_dim_freq(\"T2w\")","e8d5d30f":"plot_dim_freq(\"T1w\")","1eaa7b14":"plot_dim_freq(\"T1wCE\")","facb0fb0":"def plot_num_files(type_name):\n    \"\"\"\n    type_name = [\"FLAIR\", \"T1w\", \"T2w\", \"T1wCE\"]\n    Plots frequency distribution of number of files\n    for a patient for the given \"type_name\"\n    \"\"\"\n    all_freqs = []\n    num_files_dict = dict()\n    for i, data in train_df.iterrows():\n        brats21id = data[0]\n        patient_path = os.path.join(\n            \"..\/input\/rsna-miccai-brain-tumor-radiogenomic-classification\/train\/\", \n            str(brats21id).zfill(5),\n        )\n        \n        key = len(glob.glob(os.path.join(patient_path, type_name, \"*\")))\n        all_freqs.append(key)\n        if key in num_files_dict:\n                num_files_dict[key] += 1\n        else:\n            num_files_dict[key] = 1\n\n    num_files_dict = {k: v for k, v in sorted(num_files_dict.items(), key = lambda item: -1*item[1])}\n    keys = list(num_files_dict.keys())\n    vals = [num_files_dict[k] for k in keys]\n    \n    plt.figure(figsize = (24, 5))\n    plt.title(f\"Number of images for type \\\"{type_name}\\\" per Patient distribution (top 10)\", fontsize = 16)\n    \n    ax = sns.barplot(x = keys[:10], y = vals[:10], order = keys[:10])\n    ax.set_xlabel(xlabel = \"Number of files\", fontsize = 12)\n    ax.set_ylabel(ylabel = \"count\", fontsize = 12)\n    \n    for p in ax.patches:\n        x = p.get_bbox().get_points()[:, 0]\n        y = int(p.get_bbox().get_points()[1, 1])\n        ax.annotate(f\"{y:,} ({100*y\/train_df.shape[0]:.2f}%)\", (x.mean(), y),\n                    ha = \"center\", va = \"bottom\", fontsize = 10)\n    plt.show()\n    \n    print(f\"Total ids in top 10: {sum(vals)} ({1.0*sum(vals[:10])\/train_df.shape[0]:.2f}%)\")\n    print(f\"Minimum and Maximum number of files for a patient is {min(keys)} and {max(keys)}, respectively.\")\n    print(f\"Mean and Median of number of files is: {np.mean(all_freqs):.2f} and {np.median(all_freqs):.0f}, respectively.\")\n    print(f\"Varinace of number of files is {np.sqrt(np.var(all_freqs)):.2f}\")","799c036c":"plot_num_files(\"FLAIR\")","43df0f36":"plot_num_files(\"T2w\")","665472ac":"plot_num_files(\"T1w\")","3ec5db72":"plot_num_files(\"T1wCE\")","77208947":"# **Images**\n---\n* See some smaple images\n* Look at some **key statistics** for out train images\n","26bee3a3":"# **Final Thoughts**\n* **FLAIR and T2w have very similar image data statistics**\n* **T1w and T1wCE have very similar image data statistics**\n* Number of images for a patient per type differ significantly\n* Images have large blank areas on all sides\n\n\n# **.... Work in Progress**","fb9b809f":"#### In this kernel, I perform some basic EDA. The idea is to understand the **statistics of the train** data to help us choose the best hyperparameters for our models.","ec12112d":"# **Getting Started**\n---\n* Load libraries and modules\n* Peak at train data"}}