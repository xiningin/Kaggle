{"cell_type":{"4a52452d":"code","95170ed6":"code","73d388bb":"code","c4832f53":"code","e1a22488":"code","9d3b663f":"code","189f9af9":"code","0996ff41":"markdown","28a9f89c":"markdown","73437c13":"markdown","eb3d331f":"markdown","8ab0cb11":"markdown","71d91704":"markdown"},"source":{"4a52452d":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session\n\nfrom IPython.display import display, HTML\n\nCSS = \"\"\"\n.output {\n    flex-direction: row;\n}\n\"\"\"\n\nHTML('<style>{}<\/style>'.format(CSS))","95170ed6":"##Pfizer first\nTotalP = ['Total',21830,21830, 43660]\n##choose 170 patients to infect with an equal chance of choosing a patient\n##that has been vaccinated (1) or a patient that has not been vaccinated (0).\nsamplingP = np.random.choice([0,1],170)\nNotInfectedP = ['Not Infected', 21830-sum(samplingP), 21830+sum(samplingP)-170, 43490]\nInfectedP = ['Infected', sum(samplingP), 170-sum(samplingP), 170]\n\nPfizer2Way = pd.DataFrame([NotInfectedP,InfectedP,TotalP], columns=['PFIZER', 'Vaccinated', 'Not Vaccinated', 'Total'])\nPfizer2Way.set_index('PFIZER', inplace=True)\n\n##Moderna second\nTotalM = ['Total',15000,15000, 30000]\n##choose 95 patients to infect with an equal chance of choosing a patient \n##that has been vaccinated (1) or a patient that has not been vaccinated (0).\nsamplingM = np.random.choice([0,1],95)\nNotInfectedM = ['Not Infected', 15000-sum(samplingM), 15000+sum(samplingM)-95, 29905]\nInfectedM = ['Infected', sum(samplingM), 95-sum(samplingM), 95]\n\nModerna2Way = pd.DataFrame([NotInfectedM,InfectedM,TotalM], columns=['MODERNA', 'Vaccinated', 'Not Vaccinated', 'Total'])\nModerna2Way.set_index('MODERNA', inplace=True)\n\n##display the two-way table of simulated results\ndisplay(Pfizer2Way)\ndisplay(Moderna2Way)","73d388bb":"def Pfizer(L, title):\n    TrialsP = []\n    for _ in range(10000):\n        samplingP = np.random.choice([0,1],170, p=[L\/(L+1), 1\/(L+1)])\n        TrialsP.append(sum(samplingP))\n    \n    #fig, (ax1, ax2) = plt.subplots(ncols=2, sharey=False)\n    sns.distplot(TrialsP,bins=15, label='Simulated Data')\n    plt.title(title)\n    plt.xlabel('Number of Vaccinated Participants Infected')\n    plt.ylabel('Frequency')\n    plt.xlim([0,120])\n    plt.axvline(x=8, color='r', linestyle='dashed', linewidth=2, label='Pfizer Result')\n    plt.legend(bbox_to_anchor = (1.0, 1), loc='upper left')\n    plt.show()","c4832f53":"Pfizer(1, 'Simulations and observed Pfizer Data on the Same Scale')","e1a22488":"Pfizer(2,'Placebo patients are twice as likely to become infected')","9d3b663f":"my_rate = 5  ## We assume that patients in the placebo group are my_rate times as likely to become infected\nPfizer(my_rate, 'Placebo patients are ' + str(my_rate) + ' times as likely to become infected')","189f9af9":"moderna_rate = 2  ##patients who receive the placebo are moderna_rate times as likely to be infected\n\ndef Moderna(L, title):\n    TrialsM = []\n    for _ in range(10000):\n        samplingM = np.random.choice([0,1],95, p=[L\/(L+1), 1\/(L+1)])\n        TrialsM.append(sum(samplingM))\n    \n    #fig, (ax1, ax2) = plt.subplots(ncols=2, sharey=False)\n    sns.distplot(TrialsM,bins=15, label='Simulated Data')\n    plt.title(title)\n    plt.xlabel('Number of Vaccinated Participants Infected')\n    plt.ylabel('Frequency')\n    plt.xlim([0,80])\n    plt.axvline(x=5, color='r', linestyle='dashed', linewidth=2, label='Moderna Result')\n    plt.legend(bbox_to_anchor = (1.0, 1), loc='upper left')\n    plt.show()\n\nModerna(moderna_rate, 'Placebo patients are ' + str(moderna_rate) + ' times as likely to become infected')","0996ff41":"(Please note that I owe the lion's share of credit to my friend Aaron Montgomery who created a similar explanation\/playground in R using Google Collaborate.  I am really only mimicking his work in Jupyter Notebook form.)\n\n# COVID-19 Vaccine Effectiveness?\nSeveral pharmaceutical companies have recently released potentially exciting information about their ongoing COVID-19 Vaccine Phase 3 trials.  How excited should we be?  For the Pfizer vaccine trial, we have the following data taken from <a href=\"https:\/\/www.statnews.com\/2020\/11\/18\/pfizer-biontech-covid19-vaccine-fda-data\/\">Stat News<\/a>:\n\n<div class=\"alert alert-block alert-info\">\n<i>Of the 170 cases of Covid-19 Pfizer observed in its trial, 162 occurred in the placebo group and just eight among the group that got its two-dose vaccine. Of the 10 cases of severe Covid-19, nine were in the placebo group, an important finding which suggests the vaccine prevents not only mild cases, but the type of serious disease that leads patients to die or be hospitalized.<br\/><br\/> Pfizer said that no serious safety concerns related to the vaccine were reported in its study, which included 43,661 volunteers. <\/i> <\/div>\n\nFor the Moderna vaccine trial, we have similar data taken from <a href=\"https:\/\/www.cnn.com\/2020\/11\/16\/health\/moderna-vaccine-results-coronavirus\/index.html\">CNN<\/a>:\n\n<div class=\"alert alert-block alert-success\">\n<i> In Moderna's trial, 15,000 study participants were given a placebo, which is a shot of saline that has no effect. Over several months, 90 of them developed Covid-19, with 11 developing severe forms of the disease.\n    \nAnother 15,000 participants were given the vaccine, and only five of them developed Covid-19. None of the five became severely ill.\n    <\/i>\n<\/div>","28a9f89c":"Still doesn't look like the Pfizer data is within the realm of possibility even under that assumption!  In other words, we can conclude statistically that the vaccine is even more effective than that.\n\nBy changing the value of my_rate and running the cell below, you can experiment with different possible rates.  For example, if you set my_rate to 5, then you'll be exploring the universe in which patients who receive the vaccine are 5 times more likely to become infected by COVID-19.  See if you can find a reasonable value for my_rate which makes the observed results look more like the simulated ones.  (Hint: This should be where the vertical line marking Pfizer's results starts to merge into the histogram of the simulated data.)","73437c13":"Feel free to run the cell above several times to get different randomized outcomes while keeping an eye on the \"Infected\" row in each table.  Again, you should be observing distributions that are much closer to 85\/85 and 42\/43 than the 8\/162 and 5\/90 splits seen in the Pfizer and Moderna studies.\n\nTo get a feel for how likely the observed splits are to occur as a result of random chance under these assumptions (again, we're assuming that the vaccine has no effect), we could imagine clicking that button many many times to see if we ever get splits like those.  \n<center>OR<\/center>\n(Thankfully), we can instead simulate, say, 10,000 trials and visualize a histogram of the frequency of different outcomes.  For the sake of simplicity, let's focus on the Pfizer data.  We could of course play a similar game for Moderna as well.","eb3d331f":"### So how about Moderna?\nThe cell below will let you play the same game to get a feel for Moderna's results.  Simply set moderna_rate to the value you'd like to consider. (i.e. moderna_rate = 3 means that we will assume placebo recipients are 3 times as likely to be infected as those who receive the vaccine)","8ab0cb11":"## Monte Carlo Simulations\nOne way to get a feel for the data is to make use of Monte Carlo simulations to explore the likelihood of observing the results that were obtained given different assumptions about the effectiveness of each vaccine.  Here are the underlying assumptions that we'll use in each case:\n#### Pfizer\n    - We assume there are 43,660 virtual volunteers.\n    - Half of the volunteers receive the vaccine and half receive the placebo.\n    - Our baseline assumption will be that the vaccine has no effect of any kind.\n    - Since 170 patients in the study were ultimately infected with COVID-19, we will randomly infect 170 of the \n    virtual volunteers and explore the number of vaccinated patients who are infected.\n\n#### Moderna\n    - We assume there are 30,000 virtual volunteers.\n    - Half of the volunteers receive the vaccine and half receive the placebo.\n    - Our baseline assumption will be that the vaccine has no effect of any kind.\n    - Since 95 patients in the study were infected, we will randomly infect 95 of the virtual volunteers.\n\nThe following cell runs a single experiment under these conditions and displays a two-way table of the results.  Since the simulation is randomized each time, the results will vary, however we should nearly always find the number of infected patients in each group (vaccinated vs. not vaccinated) to be pretty similar (even if they are rarely equal).","71d91704":"### So how should I be interpreting that graph?\nEssentially, if we were living in the universe in which the Pfizer vaccine was completely ineffective (i.e. if it literally had no effect), then Pfizer's results would be completely outside the bounds of what we could reasonably expect to occur by random chance alone.  The hypothesis that the vaccine does nothing seems ridiculously unlikely to be true.  <br \/> <br \/> \nSaid another way: <b> The Pfizer vaccine is effective <\/b>\n<br\/> <br\/>\n\n### So how effective is it then?\nOne way to explore the effectiveness is to change our assumptions and re-run the 10,000 Monte Carlo simulations.  Suppose for example that we assume that patients who receive the placebo are <b>twice<\/b> as likely to be infected.  How do the real world results compare in that case?"}}