{"cell_type":{"c6ba6ccf":"code","7921e826":"code","4bffd8c9":"code","718cb22b":"code","2c9bb8c6":"code","c6f02aa1":"code","5f529c66":"code","9ecf936f":"code","676a0399":"code","0f2776bd":"code","ded66502":"code","ed888eee":"code","38f85f3c":"code","2bd196a1":"code","8521a6e7":"code","7d0ecc19":"markdown","64203f40":"markdown","694e9723":"markdown","0a896724":"markdown","d63df6c7":"markdown","1a0739b4":"markdown","7ab80681":"markdown","ab20c61f":"markdown","761d492a":"markdown","3de111bc":"markdown","8254c805":"markdown","a2962ad4":"markdown","23ecc455":"markdown","177f1102":"markdown","9527e714":"markdown","3f085560":"markdown","9c215c68":"markdown","01348930":"markdown","2a5fade4":"markdown","12ff3e2c":"markdown","a7073743":"markdown","14b49d49":"markdown","8573d221":"markdown","032aa330":"markdown","35bbc347":"markdown","ab0e1910":"markdown","643baa7a":"markdown"},"source":{"c6ba6ccf":"import numpy as np # linear algebra\nimport os\nimport pandas as pd # data processing\nimport sqlite3 as sq# enable creation and handling of a local db ","7921e826":"# set-up a connection to a newly named flock.db. \n# the connection will be called \"conn\"\nconn = sq.connect('flock.db')\ncursor = conn.cursor()","4bffd8c9":"for file in os.listdir('..\/input'):     # For all files in our directory\n    df = pd.read_csv('..\/input\/'+file)  # Read each CSV file\n    df.to_sql(file[:-4],conn)           # Create the read file as a table in the database.","718cb22b":"# Create the query string to then feed into the Pandas read_sql function. \nq1 = ('SELECT airc.aircraft_type, COUNT(indv.flight_id) AS number_of_flights '\n      'FROM individual_flights AS indv '\n      'JOIN aircraft AS airc '\n      'ON indv.aircraft_id = airc.aircraft_id '\n      'GROUP BY 1 '\n      'ORDER BY number_of_flights DESC ')\n\n# The function read_sql takes a query string and a database connection, and performs the query. \nr1 = pd.read_sql(q1,conn)\n\n#We only need the first result, so we use iloc[[0]].\nprint(r1.iloc[[0]])","2c9bb8c6":"#Answer form A. \n\nq2 = ('SELECT airc.aircraft_type, CAST((COUNT(indv.flight_id)*airc.capacity) AS FLOAT)\/CAST(airc.cost AS FLOAT) AS passengers_per_cost '\n      'FROM individual_flights AS indv '\n      'JOIN aircraft AS airc '\n      'ON indv.aircraft_id = airc.aircraft_id '\n      'GROUP BY 1 '\n      'ORDER BY passengers_per_cost DESC')\n\n#Answer form B.\nq3 = ('SELECT airc.aircraft_type, CAST(airc.cost AS FLOAT)\/CAST((COUNT(indv.flight_id)*airc.capacity) AS FLOAT) AS cost_per_passenger '\n      'FROM individual_flights AS indv '\n      'JOIN aircraft AS airc '\n      'ON indv.aircraft_id = airc.aircraft_id '\n      'GROUP BY 1 '\n      'ORDER BY cost_per_passenger ASC')\n\nr2 = pd.read_sql(q2,conn)\n\nr3 = pd.read_sql(q3,conn)\n\nprint('Form A, passengers\/GBP: \\n')\nprint(r2.iloc[:3])\n\nprint('\\n')\nprint('Form B, GBP\/passenger: \\n')\nprint(r3.iloc[:3])","c6f02aa1":"# Adding an OR in the JOIN ON clause will account for inbound and outbound flights all alike.\nq4 = (\"\"\"\n    SELECT airport_name\n      , SUM(n_passenger_per_aircraft) AS n_passengers\n      FROM (\n          SELECT indvf.aircraft_id\n          , airp.airport_name \n          , COUNT(DISTINCT flight_id)*aic.capacity AS n_passenger_per_aircraft\n          FROM individual_flights AS indvf\n          JOIN airports AS airp\n              ON airp.airport_code = indvf.destination_airport_code \n                  OR airp.airport_code = indvf.departure_airport_code\n          JOIN aircraft AS aic\n              ON aic.aircraft_id = indvf.aircraft_id    \n          GROUP BY 1, 2)\n      GROUP BY 1\n      ORDER BY 2 DESC\"\"\")\n\nr4 = pd.read_sql(q4,conn)\n\nprint('Number of passengers per airport (inbound and outbound) \\n')\nprint(r4.iloc[:3])","5f529c66":"# Only count if outbound form airport X\nq5 = (\"\"\"SELECT airport_name\n      , SUM(n_outbound_passengers) AS outbound_passengers\n      FROM (\n            SELECT indvf.aircraft_id\n          , airp.airport_name \n          , COUNT(DISTINCT flight_id)*aic.capacity AS n_outbound_passengers\n          FROM individual_flights AS indvf\n          JOIN airports AS airp\n          ON airp.airport_code = indvf.departure_airport_code\n          JOIN aircraft AS aic\n          ON aic.aircraft_id = indvf.aircraft_id\n          GROUP BY 1, 2)\n       GROUP BY 1\n       ORDER BY 2 DESC\"\"\")\n\n# Only count if inbound form airport X\nq6 = (\"\"\"SELECT airport_name\n      , SUM(n_inbound_passengers) AS inbound_passengers\n      FROM (\n          SELECT indvf.aircraft_id\n          , airp.airport_name \n          , COUNT(DISTINCT flight_id)*aic.capacity AS n_inbound_passengers\n          FROM individual_flights AS indvf\n          JOIN airports AS airp\n          ON airp.airport_code = indvf.destination_airport_code\n          JOIN aircraft AS aic\n          ON aic.aircraft_id = indvf.aircraft_id\n          GROUP BY 1, 2)\n      GROUP BY 1\n      ORDER BY 2 DESC\"\"\")\n\nr5 = pd.read_sql(q5,conn)\nprint('Number of passengers per airport (outbound) \\n')\nprint(r5.iloc[:3])\nprint('\\n')\n\nr6 = pd.read_sql(q6,conn)\nprint('Number of passengers per airport (inbound) \\n')\nprint(r6.iloc[:3])","9ecf936f":"q7 = (\"\"\"SELECT airport_name\n      , CAST(SUM(n_passenger_per_aircraft) AS FLOAT)\/CAST(airport_size AS FLOAT) AS passagers_per_m2\n      FROM (\n          SELECT indvf.aircraft_id\n          , airp.airport_name \n          , airp.airport_size\n          , COUNT(DISTINCT flight_id)*aic.capacity AS n_passenger_per_aircraft\n          FROM individual_flights AS indvf\n          JOIN airports AS airp\n              ON airp.airport_code = indvf.destination_airport_code \n                  OR airp.airport_code = indvf.departure_airport_code\n          JOIN aircraft AS aic\n              ON aic.aircraft_id = indvf.aircraft_id    \n          GROUP BY 1, 2, 3)\n      GROUP BY 1\n      ORDER BY 2 DESC\"\"\")\n\nr7 = pd.read_sql(q7,conn)\nprint(r7.iloc[[0]])\n","676a0399":"q8 = (\"\"\"SELECT Airline_Name, Year, MAX(RPM_Domestic)  \n    FROM (\n        SELECT Airline_Code, CAST(substr(Date, -4) AS INT) AS Year\n        , SUM(COALESCE(RPM_Domestic,0)) AS RPM_Domestic\n        FROM flight_summary_data \n        GROUP BY 1, 2) AS subq\n    JOIN\n        airlines \n    ON subq.airline_code = airlines.airline_code\n    GROUP BY 1\"\"\")\n\nr8 = pd.read_sql(q8,conn)\n\nprint(r8)\n\nprint('\\n')\n\nq9 = (\"\"\"SELECT Airline_Name, Year, MAX(RPM_International)   \n    FROM (\n        SELECT Airline_Code, CAST(substr(Date, -4) AS INT) AS Year\n        , SUM(COALESCE(RPM_International,0)) AS RPM_International\n        FROM flight_summary_data \n        GROUP BY 1, 2) AS subq\n    JOIN\n        airlines \n    ON subq.airline_code = airlines.airline_code\n    GROUP BY 1\"\"\")\n\nr9 = pd.read_sql(q9,conn)\n\nprint(r9)","0f2776bd":"q10 = (\"\"\"SELECT Airline_Name, Year, MAX(RPM_Total)   \n    FROM (\n        SELECT Airline_Code, CAST(substr(Date, -4) AS INT) AS Year\n        , SUM((RPM_Domestic + COALESCE(RPM_International,0))) AS RPM_Total\n        FROM flight_summary_data \n        GROUP BY 1, 2) AS subq\n    JOIN\n        airlines \n    ON subq.airline_code = airlines.airline_code\n    GROUP BY 1\"\"\")\n\n\nr10 = pd.read_sql(q10,conn)\n\nprint(r10)","ded66502":"q11 = (\"\"\"SELECT Airline_Name, SUM((RPM_Domestic + COALESCE(RPM_International,0))) AS RPM_Total\n        FROM flight_summary_data \n        JOIN airlines\n        ON flight_summary_data.airline_code = airlines.airline_code\n        GROUP BY 1 ORDER BY RPM_Total\"\"\")\n\nr11 = pd.read_sql(q11,conn)\n\nprint(r11)","ed888eee":"q12 = \"\"\"SELECT SUM(passengers_domestic) AS total_passengers_domestic\n, SUM(passengers_international) AS total_passengers_international\n, CAST(substr(Date, -4) AS INT) AS Year\n, CAST(substr(Date, 4, 2) AS INT) AS Month \nFROM flight_summary_data WHERE Airport_Code = \"FKT\" \nGROUP BY 3, 4\nORDER BY Year ASC, Month ASC\"\"\"\n\nr12 = pd.read_sql(q12,conn)\n\nr12 = r12.set_index(['Year','Month']).diff()\n\nprint(r12.plot(figsize=(18,10)))","38f85f3c":"q15 = \"\"\"SELECT SUM(passengers_domestic) AS total_passengers_domestic\n, CAST(substr(Date, -4) AS INT) AS Year\n, CAST(substr(Date, 4, 2) AS INT) AS Month \nFROM flight_summary_data WHERE Airport_Code = \"FKT\" \nGROUP BY 2, 3\nORDER BY Year ASC, Month ASC\"\"\"\n\nq16 = \"\"\"SELECT SUM(passengers_international) AS total_passengers_international\n, CAST(substr(Date, -4) AS INT) AS Year\n, CAST(substr(Date, 4, 2) AS INT) AS Month \nFROM flight_summary_data WHERE Airport_Code = \"FKT\" \nGROUP BY 2, 3\nORDER BY Year ASC, Month ASC\"\"\"\n\nr15 = pd.read_sql(q15,conn)\nr16 = pd.read_sql(q16,conn)\n\nr15 = r15.set_index(['Year','Month']).diff()\nr16 = r16.set_index(['Year','Month']).diff()\n\nmean_q = r15.mean(axis=0)\n\nprint(mean_q)\nprint(r15.plot(figsize=(18,10),title='Total Domestic Passengers by month'))\nprint(r16.plot(figsize=(18,10),title='Total International Passengers by month'))","2bd196a1":"q13 = (\"\"\"\nSELECT SUM(ASM_Domestic) AS sum_asm_domestic\n, Airline_Code\n, CAST(substr(Date, -4) AS INT) AS Year\nFROM flight_summary_data\nGROUP BY 2, 3\nHAVING CAST(substr(Date, -4) AS INT) <> 2002\n\"\"\")\n\nairportsquery = (\"\"\"\nSELECT * FROM airports\n\"\"\")\n\nairportsdf = pd.read_sql(airportsquery,conn)\n\nr13 = pd.read_sql(q13,conn)\n# We get the difference between each year for each airline so we can see how much they \"grew\" from the past year. We group by Airline_Code first. \nr13['dif'] = r13.groupby(['Airline_Code'])['sum_asm_domestic'].diff()\n\n# Find the indexes of each of the max values for dif. It will have negative values,but since we are talking about growth they will not be included. \n# According to the way we calculate the dif, we need to exclude the year 2002 because it only has a couple of months.  \nidx = r13.groupby(['Airline_Code'], sort=False)['dif'].transform(max) == r13['dif']\n\n# We print the years with the Max dif.\nprint(r13[idx])","8521a6e7":"q14 = (\"\"\"\nSELECT SUM(ASM_Domestic) AS sum_asm_domestic\n, Airline_Code\n, Airport_Code\n, CAST(substr(Date, -4) AS INT) AS Year\nFROM flight_summary_data\nGROUP BY 2, 3, 4\nHAVING (Airline_Code='FA'AND CAST(substr(Date, -4) AS INT)=2016) \nOR (Airline_Code='AA'AND CAST(substr(Date, -4) AS INT)=2012)\nOR (Airline_Code='GA'AND CAST(substr(Date, -4) AS INT)=2010)\n\"\"\")\n# Cherrypicking with very bad practice in the query the specific years in which I obtained the max growth. This should never be made like this. \n\nr14 = pd.read_sql(q14,conn)\nprint(airportsdf)\n\n# Set and index frame to extract the max value'd airport per airline in the desired year. \nindx2 = r14.groupby(['Airline_Code'], sort=True)['sum_asm_domestic'].transform(max) == r14['sum_asm_domestic']\n\n# Before printing, join with the airport table to get the airport names. \nprint(pd.merge(r14[indx2], airportsdf, how='inner', left_on='Airport_Code', right_on='Airport_Code')[['Airline_Code','Airport_Name','sum_asm_domestic']])","7d0ecc19":"We have ASM and RPM, as well the number of flights Domestic and for some flights International, per Airline and Airport. \nTo list some of the possible ways of evaluate growth, we have:\n    Decrease the difference between ASM - RPM, therefore captivating more passengers out of the ones that they had the capacity for. \n    Increase on ASM, therefore increasing the fleet or the size of the planes, or the number of flights. \n    Increase in number of flights alone. \n    \nFor simplicity and because it seems to be the one providing the best answer, we will use ASM as our growth indicator, and the more ASM an airline has over time, the more we will say they grew. \n\nTo calculate the growth we will take the AVG(ASM_Domestic) per Airline per Year.\n\n### Assumption\nAssume that all airlines have ASM_Domestic for each the same number of months, because otherwise might be a little biased due to how average is calculated. \nTo simplify even further for time restrictions I will assume the MAX ASM will be the latest from 2017 and 2002 averages, and the min the other one. Seems logical but something of that sort should not be done lightly.\n\n### Note\nWe would account only for ASM_Domestic, since ARM_International has a lot of null values and will bias the results, but the process would be similar to the one applied before for a prior question involving RPM. \n    ","64203f40":"### Is there a difference when considering outbound and inbound passenger flow?\n\nParting from the previous results, analyse if slicing it by outbound or inbound would yield to different results. ","694e9723":"### Answer\n**Goose Airways** 2010, **Flock Air** 2016 and **Amazon Airlines** 2012","0a896724":"### Note\n\nCalculating the variation (delta) from each month would be a better way to represent this, but due to time constrains I will not do it for this analysis. \n\n### Answer\n\nThe plot serves as an answer. We can tell that seasonality might be playing a huge factor, and once that is removed we could do more in-depth analysis. ","d63df6c7":"### Answer\n\n**Amazon Mothership** is the airport with more potential passenger traffic in relationship to it's size. ","1a0739b4":"### Answer\n\nAircraft has carried the most passengers compared to the cost is **Goose**.","7ab80681":"## What was the best year for Revenue Passenger-Miles for each airline? \n\nThe fields that track international values have frequent null values. We will consider them as zeros for simplicity but that must be accounted for before doing any kind of analysis because that will bias the results. \n\n### Process\nCalculate the SUM of all RPM (Domestic, International or both at the same time, so, Total), and then select the MAX per airline, which will yield us the year as well. \nBy selecting a specific type of RPM or both we will obtain different answers, therefore all three must be provided. ","ab20c61f":"### Answer\n\nAirport that has transported more passengers through it is **Amazon Mothership**.","761d492a":"### Is there a difference when considering the size of the airports?\nParting from the first result, we need to account for the size of the airport and calculate a ratio. \n\n### Process\nThe total number of passengers per aircraft, sum for all aircraft that passed by each airport, and divided by the size of the airport. ","3de111bc":"### How does domestic passenger flow and international passenger flow vary by month of the year for Flocktopia airport?\n#### A single plot summarising this would be useful\n\n### Assumption\nFlow as the number of, because flow it is defined as volume \/ time unit, and in this case, we do not have that kind of specific information. \n\nAssume the question was asked as frame above, because otherwise, it would have required to answer \"if a single plot summarising this would be useful\", and in which case the answer would be no, but for reasons such as number of points and visibility, seasonality and other variants that might be affecting the variation of flow. \n\n### Notes\nSQLite works differently and it is somehow more limited to deal with dates and formats, so the solution presented here is not elegant or best practice. \n","8254c805":"Read the CSV files, create tables in a local DB and connect our notebook to said DB. \n### Note\nThis step is required every new session we want to run the notebook. ","a2962ad4":"### Answer\n\nFor outbound flights, the airport that has transported more passengers through it is **Amazon Mothership**, but for inbound flights, it would be Flocktopia. ","23ecc455":"### Answer\nFor Amazon Airlines, it was Nestland Airport, for Flock Air it was Nestland Airport as well, and for Goose Airways it was Flocktopia. ","177f1102":"Considering RPM Domestic and RPM International all together","9527e714":"## Which aircraft has carried the most passengers compared to the cost.\n\nWe lack specific data on how many passengers flew in each individual trip, therefore for simplicity we will assume it was the max capacity of each aircraft per flight.\n\nThe value we will consider as \"most cost-efficient\" or, \"that has carried the most passengers compared to the cost\" will be the smallest found value for \"cost per passenger\". There are 2 ways to express this answer:\n\n> A: passengers \/ GBP or B: GBPs \/ passenger\n\nBy using A, we need to interpret \"fraction of a passenger\" because the values are likely to be decimals, even when mathematically correct, makes noise for general interpretation and business communications. On the other hand, by using B, will be more aligned with common logic and more naturally sounding. \n\nThis is to say, if expressed as A, we are interested in the biggest value, if expressed as B, we are interested in the smallest one. \n\nWe will provide both forms to illustrate.","3f085560":"### What were the number of passenger miles each airline recorded?\n\n### Assumption\nWhen talking about number of passenger miles, it is refering to RPM, since that is the metric that most closely represents what asked. We will answer the question as if it was made \"What was the total RPM each airline recorded?\". ","9c215c68":"Import all necessary libraries, give them aliases if needed.  We will use numpy for numerical analysis, pandas to treat data as data frames and sqlite3 to query our data provided in the files as an SQLite Database. \n### Note\nThis step is required every new session we want to run the notebook. ","01348930":"### Answer\nThe best years for each airline are the following, for the different types of RPM. \n\n**Domestic RPM:**\n\nAmazon Airlines    2015\n\nFlock Air                 2016\n\nGoose Airways      2016\n\n\n**International RPM:**\n\nAmazon Airlines   2016\n\nFlock Air                2016\n\nGoose Airways      2015\n\n\n**Total RPM:**\n\nAmazon Airlines    2015\n\nFlock Air                 2016\n\nGoose Airways       2016","2a5fade4":"### Which airport contributed the most to this? \n","12ff3e2c":"# Business Intelligence Exercise\n## XYZ Cover\n\n### Goal\n    We aim to provide answers to different questions requested in the Business Intelligence Exercise file provided. Those questions are to be leading each section of the present notebook.\n    \n### Context\n    This is merely an exercise to showcase required skills for a BI analyst to join XYZ Cover, and neither the data nor the procedures here are final or reflect XYZ's intellectual ownership or processes. \n    The data was provided in 5 different files by XYZ's team, via email. \n     This is presented in a Kaggle notebook for 3 main reasons: The first being able to show in a linear fashion the thought process and technical actions are taken, the second is to allow reviewers to run it without installing any dependencies or the likes, and the third to allow me to practice and explore some techniques that I might now use on a daily basis most recently. \n\n### Notes\n    Notes for assumptions and specific comments per sections are to be noted when needed. \n    I will use many poorly name variables, which is not good Python practice, just to make sure every section of the notebook is nuclear and can be ran independently.\n    SQL and Python will be used all along this notebook to try different approaches. This is not by any means the ideal environment to work and produce every kind of report but works well for a proof of concept. \n    Window functions are used differently in SQLite, therefore other ways to treat the data will be used due to time constraints. ","a7073743":"## Which aircraft has flown the most?\n\n### Assumption\nWhen saying \"flown the most\" we refer to the number of flights and not accumulated distance flown. \n\n### Process\nLook at the data in the `individual_flights` table, count how many individual flights there were per aircraft, and then enhance the result with the name of the aircraft instead of the code. We will provide the number of flights as well the name of the aircraft. ","14b49d49":"A more useful way to visualise this data is separating the domestic passengers and international passengers. ","8573d221":"## What was the best year for growth for each airline? \n\n### Process\nDefine what is to be considered as \"Growth\", then split what the factors of Growth would be, compose an index for growth and then compare all growth indexes to see which one did better. \n","032aa330":"Considering RPM Domestic and RPM International separated:","35bbc347":"### Answer\n\nThe aircraft that has flown the most (number of flights) is **Goose**, with 1008 flights. ","ab0e1910":"## Which airport has transported the most passengers through it?\n\n### Assumption\nAssume, again, max capacity per flight. This would be better expressed as \"potentially most passengers transported\"\n\n### Process\nCalculate the number of passengers transported as the number of flights of each aircraft type, times its capacity, all together grouped by airport. \n\nIt is worth mentioning that every individual flight will transport N passengers, but that will double count the number of people because it will be attributed to both airports (departure and destination) per flight, therefore, N would be attributed to airport A and airport B.\n\nWe will leave the number in the answer query.  ","643baa7a":"Load all CSV files as SQL tables in our `flock.db`"}}