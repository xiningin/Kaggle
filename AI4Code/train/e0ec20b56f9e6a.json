{"cell_type":{"4d0fc932":"code","8ecb1888":"code","f4f2f388":"code","e8ad1cc6":"code","16fc2c45":"code","e3cb05ef":"code","29465267":"code","b1c4b70f":"code","f41c0cbf":"code","3fa99f6e":"code","ae092039":"code","697e3a1e":"code","7b395df5":"code","33a1d6ee":"markdown"},"source":{"4d0fc932":"import numpy as np \nimport pandas as pd \nimport os\nfrom fastai import *\nfrom fastai.vision import *\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport torch\nfrom fastai.metrics import KappaScore","8ecb1888":"SIZE = 256\nBS = 64","f4f2f388":"train_df = pd.read_csv('..\/input\/prostate-cancer-grade-assessment\/train.csv')","e8ad1cc6":"train_df.head(1)","16fc2c45":"train = ImageList.from_df(train_df, path='..\/input\/panda-challenge-resized-dataset\/', cols='image_id',suffix='.jpeg')","e3cb05ef":"src = (train\n       .split_by_rand_pct(0.2) #split the dataset such that we have 20% as validation set\n#        .split_from_df()\n       .label_from_df(cols='isup_grade',label_cls=FloatList))","29465267":"tfms = get_transforms(do_flip=True,flip_vert=True,max_rotate=360,max_warp=0,max_zoom=1.1,max_lighting=0.1,p_lighting=0.5)","b1c4b70f":"data= (src.transform(tfms,size=SIZE) #Data augmentation\n       .databunch(bs=BS,num_workers=1) \n       .normalize(imagenet_stats))","f41c0cbf":"data.show_batch(2)","3fa99f6e":"from sklearn.metrics import cohen_kappa_score\ndef quadratic_kappa(y_hat, y):\n    return torch.tensor(cohen_kappa_score(torch.round(y_hat).cpu(), y.cpu(), weights='quadratic'),device='cuda:0')","ae092039":"learn = cnn_learner(data,models.resnet18,metrics=[accuracy, quadratic_kappa], model_dir='..\/working\/models\/')\nlearn.path = Path('')","697e3a1e":"learn.fit_one_cycle(2,2e-3)\nlearn.save('resnet18')","7b395df5":"learn.recorder.plot_losses()\nlearn.recorder.plot_metrics()","33a1d6ee":"# fastai training baseline"}}