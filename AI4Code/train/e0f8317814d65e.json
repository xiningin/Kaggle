{"cell_type":{"2902d2d5":"code","db489e6e":"code","b70510d2":"code","97fcf067":"code","03230a5c":"code","7da94fb4":"code","7714df8a":"code","ee2dbf27":"code","310e8e4b":"code","9aa18dd8":"code","cee29f65":"code","5a501af5":"code","3cb64b3f":"code","0d67f2e2":"code","db081675":"code","38272e1d":"code","701b3e98":"code","eebe94af":"code","a864b9d1":"code","c5f7d465":"code","894d9c9c":"code","e37ef8d6":"code","0091d8b8":"code","9046affe":"code","0e31c8a8":"code","08310425":"code","3e9584fc":"code","b188eac9":"code","3f69129f":"code","687d6221":"code","f3ee2f45":"code","c41a8fdb":"code","a7c80a5a":"code","0463971d":"code","ce66d365":"code","90a0e929":"code","94fac4aa":"code","38e7d703":"code","c4daa34e":"code","32fd4ecb":"code","17a6b43a":"code","964b15e5":"markdown","280966e6":"markdown","5b7beb1a":"markdown","c91ce9a2":"markdown","791cff61":"markdown","98707687":"markdown","93c3c777":"markdown","675acfce":"markdown","06627c7c":"markdown","22f15efb":"markdown","b4a083fa":"markdown","5287fe95":"markdown","5964aecd":"markdown"},"source":{"2902d2d5":"import pandas as pd\nimport seaborn as sns\nimport numpy as np\nimport matplotlib.pyplot\n%matplotlib inline","db489e6e":"\n\ndataset = pd.read_csv('https:\/\/raw.githubusercontent.com\/Sid-darthvader\/DoWhy-The-Causal-Story-Behind-Hotel-Booking-Cancellations\/master\/hotel_bookings.csv')\n","b70510d2":"dataset.head()","97fcf067":"dataset.info()","03230a5c":"dataset.isnull().mean()","7da94fb4":"dataset=dataset.drop('company',axis=1)","7714df8a":"sns.distplot(dataset['agent'],kde=False,bins=50,hist_kws={ \"linewidth\": 3,\"alpha\": 1, \"color\": \"black\"},axlabel='agent fees')","ee2dbf27":"dataset['agent']=dataset['agent'].replace(np.nan,0)","310e8e4b":"sns.distplot(dataset['agent'],kde=False,bins=50,hist_kws={ \"linewidth\": 3,\"alpha\": 1, \"color\": \"black\"},axlabel='agent fees')","9aa18dd8":"dataset.dropna(inplace=True)","cee29f65":"dataset.to_csv(\"data1.csv\",index=False)","5a501af5":"dataset.isnull().sum()","3cb64b3f":"dataset['total_guests']=dataset['adults']+dataset['babies']+dataset['children']","0d67f2e2":"dataset.drop(['adults','babies','children'],axis=1,inplace=True)","db081675":"dataset['total_days']=dataset['stays_in_week_nights']+dataset['stays_in_weekend_nights']\ndataset.drop(['stays_in_week_nights','stays_in_weekend_nights'],axis=1,inplace=True)","38272e1d":"dataset['is_canceled']=np.where(dataset['is_canceled']==0,'Booking not canceled','Booking canceled')\ndataset['is_repeated_guest']=np.where(dataset['is_repeated_guest']==0,\"First time guest\",\"Repeated Guest\")\ndataset['previous_cancellations']=np.where(dataset['previous_cancellations']==0,\"No previous cancellation\",\"Previously Cancelled\")","701b3e98":"dataset[\"different_room_assigned\"]=np.where(dataset[\"reserved_room_type\"]==dataset[\"assigned_room_type\"],0,1)\ndataset.drop(['assigned_room_type',\"reserved_room_type\"],axis=1,inplace=True)","eebe94af":"sns.countplot(dataset['hotel'],hue=dataset['is_canceled'],palette='mako')\nplt.savefig('Type_of_hotel-is_canceled_1.png')","a864b9d1":"dataset.info()","c5f7d465":"sns.countplot(dataset['previous_cancellations'],hue=dataset['is_canceled'],palette=\"Set1\")\nplt.savefig(\"prev_cancellation_is_cancelled_2.png\")","894d9c9c":"dataset.describe()","e37ef8d6":"sns.countplot(dataset['is_repeated_guest'],hue=dataset['is_canceled'],palette='rocket')\nplt.savefig(\"repeated_guest_is_cancelled_3.png\")","0091d8b8":"\nsns.distplot(dataset[dataset['total_guests']<10]['total_guests'],kde=False,bins=7,\n             hist_kws={\"linewidth\": 3,\"alpha\": 1, \"color\": \"black\"})\nplt.savefig(\"histogram_total_guests_4.png\")","9046affe":"sns.countplot(dataset['deposit_type'],hue=dataset['is_canceled'],palette='Set1')\nplt.savefig(\"deposit_type_is_canceled_5.png\")","0e31c8a8":"categorical_features = []\nnumerical_features = []\n\nfor col in dataset.columns:\n    if(dataset[col].dtype!='object'):\n        numerical_features.append(col)\n    else:\n        categorical_features.append(col)\nprint(categorical_features)\nimport seaborn as sns\nplt.figure(figsize=(12,7))\nsns.heatmap(dataset[numerical_features].corr(),linewidths=2,linecolor='black',annot=True)\nplt.savefig(\"heatmap_6.png\")","08310425":"not_canceled=dataset[dataset[\"is_canceled\"]=='Booking not canceled']\nnc_month=not_canceled.groupby('arrival_date_month').count()\n\ncanceled=dataset[dataset[\"is_canceled\"]=='Booking canceled']\nc_month=canceled.groupby('arrival_date_month').count()","3e9584fc":"c_month","b188eac9":"\nf, axes = plt.subplots(1, 2,figsize=(15,8),sharex=True,sharey=True,)\nsns.barplot(c_month.index,c_month['is_canceled'],ax=axes[0],color='darkblue')\nsns.barplot(nc_month.index,nc_month['is_canceled'],ax=axes[1],color='darkblue')\naxes[0].tick_params(axis='x', rotation=45)\naxes[1].tick_params(axis='x', rotation=45)\naxes[0].set_title(\"Booking canceled\")\naxes[1].set_title(\"Booking not canceled\")\nplt.savefig(\"is_cancelled_Acctomonth_7.png\")","3f69129f":"plt.figure(figsize=(10,6))\nsns.countplot(data=dataset,x='arrival_date_year',hue='is_canceled',palette='Set1')\nplt.savefig(\"is_cancelled_year_8.png\")","687d6221":"dataset['is_canceled']=np.where(dataset['is_canceled']=='Booking not canceled',0,1)\ndataset['is_repeated_guest']=np.where(dataset['is_repeated_guest']==\"First time guest\",0,1)\ndataset['previous_cancellations']=np.where(dataset['previous_cancellations']==\"No previous cancellation\",0,1)","f3ee2f45":"dataset['different_room_assigned']= dataset['different_room_assigned'].replace(1,True)\ndataset['different_room_assigned']= dataset['different_room_assigned'].replace(0,False)\ndataset['is_canceled']= dataset['is_canceled'].replace(1,True)\ndataset['is_canceled']= dataset['is_canceled'].replace(0,False)","c41a8fdb":"import dowhy","a7c80a5a":"from graphviz import Source","0463971d":"from IPython.display import Image, display","ce66d365":"from dowhy import CausalModel","90a0e929":"from causalgraphicalmodels import CausalGraphicalModel\ngraph = CausalGraphicalModel(\n    nodes=[ 'is_canceled', 'lead_time', \"unobserved_confounder\",'total_of_special_requests',\n        'meal', 'country', 'market_segment',\n        'is_repeated_guest', \n       'previous_bookings_not_canceled', 'booking_changes', 'previous_cancellation','required_car_parking_spaces',\n        'days_in_waiting_list',\n         'total_guests',\n       'total_days', 'different_room_assigned','agent'],\n    edges=[\n        (\"market_segment\", \"lead_time\"), \n        (\"lead_time\", \"is_canceled\"), \n        (\"country\", \"lead_time\"),\n        (\"different_room_assigned\", \"is_canceled\"), \n        (\"unobserved_confounder\", \"is_canceled\"),(\"unobserved_confounder\",\"lead_time\"),(\"unobserved_confounder\",\"different_room_assigned\"),\n        (\"country\",\"meal\"),\n        (\"lead_time\",'days_in_waiting_list'),\n        ('days_in_waiting_list',\"is_canceled\"),\n        ('previous_bookings_not_canceled','is_canceled'),\n        ('previous_bookings_not_canceled','is_repeated_guest'),\n        ('is_repeated_guest','is_canceled'),\n        ('total_days',\"is_canceled\"),\n        ('total_days',\"agent\"),\n        ('total_guests','is_canceled'),\n        ('previous_cancellation','is_canceled'),\n        ('previous_cancellation','is_repeated_guest'),\n        ('required_car_parking_spaces','is_canceled'),('total_guests','required_car_parking_spaces'),('total_days','required_car_parking_spaces'),\n        ('total_of_special_requests','is_canceled'),\n        ('booking_changes','different_room_assigned'),('booking_changes','is_canceled')\n    ]\n)\nG=graph.draw()\nG","94fac4aa":"G.render('test-output\/causal',format='png') ","38e7d703":"causal_graph = \"\"\"digraph {\ndifferent_room_assigned[label=\"Different Room Assigned\"];\nis_canceled[label=\"Booking Cancelled\"];\nbooking_changes[label=\"Booking Changes\"];\nprevious_bookings_not_canceled[label=\"Previous Booking Retentions\"];\ndays_in_waiting_list[label=\"Days in Waitlist\"];\nlead_time[label=\"Lead Time\"];\nmarket_segment[label=\"Market Segment\"];\ncountry[label=\"Country\"];\nU[label=\"Unobserved Confounders\"];\nis_repeated_guest;\nagent;\ntotal_days;\ntotal_guests;\nmeal;\nhotel;\nU->different_room_assigned; U->is_canceled;U->required_car_parking_spaces;\nmarket_segment -> lead_time;\nlead_time->is_canceled; country -> lead_time;\ndifferent_room_assigned -> is_canceled;\ncountry->meal;\nlead_time -> days_in_waiting_list;\ndays_in_waiting_list ->is_canceled;\nprevious_bookings_not_canceled -> is_canceled;\nprevious_bookings_not_canceled -> is_repeated_guest;\nis_repeated_guest -> is_canceled;\ntotal_days -> is_canceled;\ntotal_days->agent;\ntotal_guests -> is_canceled;\nbooking_changes -> different_room_assigned; booking_changes -> is_canceled; \nhotel -> is_canceled;\nrequired_car_parking_spaces -> is_canceled;\ntotal_of_special_requests -> is_canceled;\ncountry->{hotel, required_car_parking_spaces,total_of_special_requests,is_canceled};\nmarket_segment->{hotel, required_car_parking_spaces,total_of_special_requests,is_canceled};\n}\"\"\"","c4daa34e":"import statsmodels\nmodel= dowhy.CausalModel(\n        data = dataset,\n        graph=causal_graph.replace(\"\\n\", \" \"),\n        treatment=\"different_room_assigned\",\n        outcome='is_canceled')\n#Identify the causal effect\nidentified_estimand = model.identify_effect(proceed_when_unidentifiable=True)\nprint(identified_estimand)","32fd4ecb":"dataset['different_room_assigned'].value_counts()","17a6b43a":"\nestimate = model.estimate_effect(identified_estimand, \n                                     method_name=\"backdoor.propensity_score_stratification\",target_units=\"ate\")\n# ATE = Average Treatment Effect\n# ATT = Average Treatment Effect on Treated (i.e. those who were assigned a different room)\n# ATC = Average Treatment Effect on Control (i.e. those who were not assigned a different room)\nprint(estimate)","964b15e5":"\n## 3)Dropping null values\nHere in the dataset the children and country column have very less missing values so we will drop thos missing values","280966e6":"##### The month of August has the most hotel cancellations andtye month of January has the least","5b7beb1a":"# Model","c91ce9a2":"##### The most number of guests that stay are two","791cff61":"##### We can see that when a person has previously cancelled then there is a high chance that they will cancel again","98707687":"##### we can see that City hotels have high chance of cancelling than resorts\n","93c3c777":"# EDA","675acfce":"# Data Cleaning","06627c7c":"##### It is obvious that when a person is a repeated guest he likes the hotel\/resort and hence there is less chance of him or her cancelling the booking","22f15efb":"##### This visualisation that wesee is pretty interesting since when the deposit type is non refundable then most of the time the booking is cancelled. As a generral thought a person may think if a booking is non refundable then there is less chance for it to be cancelled","b4a083fa":"# 1)Dropping column\nHere in the dataset since almost 95% values of company is missing so we drop that column","5287fe95":"# 2)Random imputation","5964aecd":"##### Shows correlation heat map of all the numerical features"}}