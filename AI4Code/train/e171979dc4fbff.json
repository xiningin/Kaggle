{"cell_type":{"050c736d":"code","235622eb":"markdown"},"source":{"050c736d":"import pandas as pd\nimport numpy as np\nimport os\nimport matplotlib.pyplot as plt\n\n# read input\ntrain = pd.read_csv(os.path.join('..', 'input', 'train.csv'))\ntest = pd.read_csv(os.path.join('..', 'input', 'test.csv'))\nall_data = pd.concat([train, test], axis=0, sort=False)\n\n\nfor i in range(10):\n    col = 'var_' + str(i)\n\n    size = all_data.groupby(col)['target'].size().to_frame('size' + col)\n    train.drop('size' + col, axis=1, inplace=True, errors='ignore')\n    train = pd.merge(train, size, 'left', left_on=col, right_index=True)\n\n    fig, (ax1, ax2) = plt.subplots(1, 2, sharey=True)\n    for s in [1, 2, 3]:\n        col_copy = train.loc[train['size' + col] == s, [col, 'target']].copy()\n        col_copy.sort_values(col, inplace=True)\n        rm = col_copy['target'].rolling(window=5000, min_periods=1, center=True).mean()\n        ax1.plot(col_copy[col].values, rm.values)\n        ax1.set_title('Rolling window for each freq')\n    col_min = train[col].min()\n    col_max = train[col].max()\n    bins = np.arange(col_min, col_max, (col_max - col_min)\/10)\n    bin_mid = [(bins[i] + bins[i + 1]) \/ 2 for i in range(len(bins) - 1)]\n\n    for s in [1, 2, 3]:\n        col_copy = train[[col, 'size' + col, 'target']].copy()\n        col_copy.loc[col_copy['size' + col] != s, 'target'] = np.nan\n        col_copy.sort_values(col, inplace=True)\n        rm = col_copy['target'].rolling(window=5000, min_periods=1, center=True).mean()\n        ax2.plot(col_copy[col].values, rm.values)\n        ax2.set_title('Same windows for all freq')\n    fig.suptitle(col)\n    plt.legend([1, 2, 3])\n    plt.show()\n","235622eb":"This shows the way the target changes over the column values for different frequecies. In the graphs on the left we use a rolling window for each frequency. But this is misleading, because the range (of column values) represented by the 5000 points in the windows is different for each frequency. For frequencies where the data is sparse it will be much wider. We can get a more accurate picture by using the same rolling window for all frequencies as in the graphs on the right."}}