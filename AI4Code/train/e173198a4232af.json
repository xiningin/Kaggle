{"cell_type":{"dd018dd7":"code","b748aeba":"code","95fc6631":"code","56bcad55":"code","8e82861e":"code","ecc1fae2":"code","06b70e1a":"code","8ef02c63":"code","43df31a4":"code","c08d3bab":"code","b061be6b":"code","819a6ff9":"code","b1409611":"code","92119572":"code","62ebe311":"code","cc9422d8":"code","d329ad21":"code","3fa90b5c":"markdown","850c3771":"markdown","379185d8":"markdown","2e54d77d":"markdown","66566e42":"markdown","2b9da4c8":"markdown","e7353bcc":"markdown","1d62d509":"markdown","b862b687":"markdown","7f0da221":"markdown","ecbd3388":"markdown","3b1dc25a":"markdown","3c56eff8":"markdown","153378f0":"markdown","d08f3a2b":"markdown","4b8d7937":"markdown","f8318bfe":"markdown","233552fa":"markdown"},"source":{"dd018dd7":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport geopandas as gpd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom mpl_toolkits.axes_grid1 import make_axes_locatable\nsns.set_style(\"darkgrid\")\n\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)\n#warnings.simplefilter(action='ignore', category=SettingWithCopyWarning)\n# Any results you write to the current directory are saved as output.","b748aeba":"def fill_and_filter(df, nas=-999):\n    df.fillna(nas, inplace=True)\n    df = df[df['suicides_no']>=0]\n    df = df[df['population']>=0]\n    return df\n\ndef filter_year(df, year=2015):\n    return df[df['year']==year]\n\ndef filter_country(df, country='Brazil'):\n    return df[df['country']==country]\n\ndef filter_continent(df, continent='Europe'):\n    return df[df['continent']==continent]\n\ndef groupings(df):\n    \"\"\"\n    Calculates Percentage Statistics based on the country's sex and age demographics\n    \"\"\"\n    tmp = pd.DataFrame({'total_population_country' : df.groupby(['country'])['population'].sum()}).reset_index()\n    df = df.merge(tmp, on = 'country')\n    tmp = pd.DataFrame({'total_suicides_country' : df.groupby(['country'])['suicides_no'].sum()}).reset_index()\n    df = df.merge(tmp, on = 'country')\n    tmp = pd.DataFrame({'total_suicides_sex_country' : df.groupby(['country', 'sex'])['suicides_no'].sum()}).reset_index()\n    df = df.merge(tmp, on = ['country', 'sex'])\n    tmp = pd.DataFrame({'total_suicides_age_country' : df.groupby(['country', 'age'])['suicides_no'].sum()}).reset_index()\n    df = df.merge(tmp, on = ['country', 'age'])\n\n    df['suicide_percentage_country'] = df['total_suicides_country']*100 \/ (df['total_population_country'])\n    \n    df['suicide_percentage_sex_country'] = df['total_suicides_sex_country']*100 \/ (df['total_suicides_country']+1)\n    df['suicide_percentage_age_country'] = df['total_suicides_age_country']*100 \/ (df['total_suicides_country']+1) \n    return df\n\ndef world_statistics(df):\n    \"\"\"\n    Calculates more statistics based on the continent of the country\n    \"\"\"\n    tmp = pd.DataFrame({'total_population_continent' : df.groupby(['continent'])['population'].sum()}).reset_index()\n    df = df.merge(tmp, on = 'continent')\n    tmp = pd.DataFrame({'total_suicides_continent' : df.groupby(['continent'])['suicides_no'].sum()}).reset_index()\n    df = df.merge(tmp, on = 'continent')\n    tmp = pd.DataFrame({'total_suicides_sex_continent' : df.groupby(['continent', 'sex'])['suicides_no'].sum()}).reset_index()\n    df = df.merge(tmp, on = ['continent', 'sex'])\n    tmp = pd.DataFrame({'total_suicides_age_continent' : df.groupby(['continent', 'age'])['suicides_no'].sum()}).reset_index()\n    df = df.merge(tmp, on = ['continent', 'age'])\n    \n    df['suicide_percentage_country_continent'] = df['total_suicides_country']*100 \/ (df['total_population_continent'])\n    \n    df['percentage_suicide_per_continent'] = df['total_suicides_continent'] *100\/ df['total_population_continent']\n    df['suicide_percentage_sex_continent'] = df['total_suicides_sex_continent']*100 \/ (df['total_suicides_continent']+1)\n    df['suicide_percentage_age_continent'] = df['total_suicides_age_continent']*100 \/ (df['total_suicides_continent']+1) \n    return df","95fc6631":"df = pd.read_csv('..\/input\/who_suicide_statistics.csv')\ndf = fill_and_filter(df, nas=-999)\nworld = gpd.read_file(gpd.datasets.get_path('naturalearth_lowres'))\nworld = world[(world.pop_est>0) & (world.name!=\"Antarctica\")]\nworld = world.merge(df, left_on = 'name', right_on = 'country')\n\n\n#world = filter_continent(world,continent= 'Europe')","56bcad55":"def filter_and_plot(df, year=None,country=None, continent=None, column = 'total_suicides_country'):\n    \"\"\"\n    Filters for the relevant year and country\/continent, using geopandas to plot the column\n    \"\"\"\n    if year!=None:\n        df = filter_year(df, year=year)\n    if country!=None:\n        df = filter_country(df, country=country)\n    elif continent!=None:\n        df = filter_continent(df, continent=continent)\n    df = groupings(df)\n    df = world_statistics(df)\n    fig, ax = plt.subplots(1, figsize=(15,15))\n    df.plot(column = column, ax=ax)\n    ax.axis('off')\n    # Create colorbar as a legend\n    sm = plt.cm.ScalarMappable(norm=plt.Normalize(vmin=0, vmax=np.max(df[column])))\n    # empty array for the data range\n    sm._A = []\n    # add the colorbar to the figure\n    divider = make_axes_locatable(ax)\n    cax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\n    cbar = fig.colorbar(sm, cax=cax)\n    cbar.ax.set_ylabel('%s' % (column))\n    \ndef plot_bar(df, year=2014, col = 'suicide_percentage_country', title = ''):\n    sns.set_style(\"white\")\n    sns.set_context({\"figure.figsize\": (24, 10)})\n    plt.xticks(rotation=90)\n    \n    df.fillna(0, inplace=True)\n    df = filter_year(df, year=year)\n    df = groupings(df)\n    df = world_statistics(df)\n\n#Plot 2 - overlay - \"bottom\" series\n    bottom_plot=sns.barplot(x = df.country, y = df[col], color = \"orange\")\n    \n\n    #topbar = plt.Rectangle((0,0),1,1,fc=\"blue\", edgecolor = 'none')\n    bottombar = plt.Rectangle((0,0),1,1,fc='orange',  edgecolor = 'none')\n   \n\n#Optional code - Make plot look nicer\n    sns.despine(left=True)\n    bottom_plot.set_ylabel(\"%s\" % (col))\n    bottom_plot.set_xlabel(\"Country\")\n    bottom_plot.set_title(\"%s\" % (title),fontsize=40 )\n\n#Set fonts to consistent 16pt size\n    for item in ([bottom_plot.xaxis.label, bottom_plot.yaxis.label] +\n                 bottom_plot.get_xticklabels() + bottom_plot.get_yticklabels()):\n        item.set_fontsize(24)   \ndef plot_sex(df, year=2014, col = 'suicide_percentage_sex_country', title = ''):\n    sns.set_style(\"white\")\n    sns.set_context({\"figure.figsize\": (24, 10)})\n    plt.xticks(rotation=90)\n    \n    df.fillna(0, inplace=True)\n    df = filter_year(df, year=year)\n    df = groupings(df)\n    df = world_statistics(df)\n    #Set general plot properties\n    \n    male = df[df['sex']=='male']\n    female = df[df['sex']=='female']\n    male.sort_values('country')\n    female.sort_values('country')\n#Plot 1 - background - \"total\" (top) series\n    top_plot = sns.barplot(x = male.country, y = male[col],color = \"blue\")\n    \n\n#Plot 2 - overlay - \"bottom\" series\n    bottom_plot=sns.barplot(x = female.country, y = female[col], color = \"pink\")\n    \n\n    topbar = plt.Rectangle((0,0),1,1,fc=\"blue\", edgecolor = 'none')\n    bottombar = plt.Rectangle((0,0),1,1,fc='pink',  edgecolor = 'none')\n    l = plt.legend([bottombar, topbar], ['Female', 'Male'], loc=1, ncol = 2, prop={'size':18})\n    l.draw_frame(False)\n\n#Optional code - Make plot look nicer\n    sns.despine(left=True)\n    bottom_plot.set_ylabel(\"%s\" % (col))\n    bottom_plot.set_xlabel(\"Country\")\n    bottom_plot.set_title(\"%s\" % (title),fontsize=40 )\n\n#Set fonts to consistent 16pt size\n    for item in ([bottom_plot.xaxis.label, bottom_plot.yaxis.label] +\n                 bottom_plot.get_xticklabels() + bottom_plot.get_yticklabels()):\n        item.set_fontsize(24)\n\ndef plot_sex_time(df, country,col = 'suicide_percentage_sex_country', title = ''):\n    sns.set_style(\"white\")\n    sns.set_context({\"figure.figsize\": (24, 10)})\n    plt.xticks(rotation=90)\n    \n    males = []\n    females = []\n    years = []\n    df.fillna(0, inplace=True)\n    df = filter_country(df, country=country)\n    for year in sorted(df['year'].unique()):\n        tmp = filter_year(df, year)\n        tmp = groupings(tmp)\n        tmp = world_statistics(tmp)\n\n        male = tmp[tmp['sex']=='male']\n        female = tmp[tmp['sex']=='female']\n        males.append(male[col].max())\n        females.append(female[col].max())\n        years.append(year)\n        \n        \n#Plot 1 - background - \"total\" (top) series\n    top_plot = sns.barplot(x = years, y = males,color = \"blue\")\n    \n\n#Plot 2 - overlay - \"bottom\" series\n    bottom_plot=sns.barplot(x = years, y = females, color = \"pink\")\n    \n\n    topbar = plt.Rectangle((0,0),1,1,fc=\"blue\", edgecolor = 'none')\n    bottombar = plt.Rectangle((0,0),1,1,fc='pink',  edgecolor = 'none')\n    l = plt.legend([bottombar, topbar], ['Female', 'Male'], loc=1, ncol = 2, prop={'size':18})\n    l.draw_frame(False)\n\n#Optional code - Make plot look nicer\n    sns.despine(left=True)\n    bottom_plot.set_ylabel(\"%s\" % (col))\n    bottom_plot.set_xlabel(\"%s\" % (country))\n    bottom_plot.set_title(\"%s\" % (title),fontsize=40 )\n\n#Set fonts to consistent 16pt size\n    for item in ([bottom_plot.xaxis.label, bottom_plot.yaxis.label] +\n                 bottom_plot.get_xticklabels() + bottom_plot.get_yticklabels()):\n        item.set_fontsize(24)\n        \ndef plot_sex_diff_time(df, years = [2004, 2014],sex='female', col = 'total_suicides_sex_country', title = ''):\n    sns.set_style(\"white\")\n    sns.set_context({\"figure.figsize\": (24, 10)})\n    plt.xticks(rotation=90)\n    if sex=='female':\n        color_ = 'pink'\n    else:\n        color_ = 'blue'\n    \n    tmp0 = filter_year(df, years[0])\n    tmp0 = groupings(tmp0)\n    tmp0 = world_statistics(tmp0)\n    tmp1 = filter_year(df, years[1])\n    tmp1 = groupings(tmp1)\n    tmp1 = world_statistics(tmp1)\n    \n    f_tmp1 = pd.DataFrame(tmp1[tmp1['sex']==sex].groupby('country')[col].max().reset_index())\n    f_tmp0 = pd.DataFrame(tmp0[tmp0['sex']==sex].groupby('country')[col].max().reset_index())\n    f_tmp0.columns = ['country', 'new_column']\n    f_tmp1 = f_tmp1.merge(f_tmp0, on='country')\n    f_tmp1['diff'] = (f_tmp1[col] - f_tmp1['new_column']) \/ f_tmp1['new_column']\n   \n    #m_tmp1 = pd.DataFrame(tmp1[tmp1['sex']=='male'].groupby('country')[col].max().reset_index())\n    #m_tmp0 = pd.DataFrame(tmp0[tmp0['sex']=='male'].groupby('country')[col].max().reset_index())\n    #m_tmp0.columns = ['country', 'new_column']\n    #m_tmp1 = m_tmp1.merge(m_tmp0, on='country')\n    #m_tmp1['diff'] = (m_tmp1[col] -m_tmp1['new_column']) \/ m_tmp1['new_column']\n  \n\n    #top_plot = sns.barplot(x = m_tmp1.country, y = m_tmp1['diff'],color = \"blue\")\n#Plot 2 - overlay - \"bottom\" series\n    bottom_plot=sns.barplot(x = f_tmp1.country, y = f_tmp1['diff'], color = color_)\n    \n\n    #topbar = plt.Rectangle((0,0),1,1,fc=\"blue\", edgecolor = 'none')\n    bottombar = plt.Rectangle((0,0),1,1,fc=color_,  edgecolor = 'none')\n   # l = plt.legend([bottombar, topbar], ['Female', 'Male'], loc=1, ncol = 2, prop={'size':18})\n   # l.draw_frame(False)\n\n#Optional code - Make plot look nicer\n    sns.despine(left=True)\n    bottom_plot.set_ylabel(\"%s\" % (col))\n    bottom_plot.set_xlabel(\"Country\")\n    bottom_plot.set_title(\"%s\" % (title),fontsize=40 )\n\n#Set fonts to consistent 16pt size\n    for item in ([bottom_plot.xaxis.label, bottom_plot.yaxis.label] +\n                 bottom_plot.get_xticklabels() + bottom_plot.get_yticklabels()):\n        item.set_fontsize(24)\n","8e82861e":"plot_bar(world[world['continent']=='Europe'], col = 'suicide_percentage_country', title = 'Suicide Percentage by Country')","ecc1fae2":"plot_sex(world[world['continent']=='Europe'])","06b70e1a":"plot_sex(world[world['continent']=='Europe'], col = 'total_suicides_sex_country', title = 'Total Suicides per country')","8ef02c63":"plot_sex_time(world[world['continent']=='Europe'], country='Netherlands',col = 'suicide_percentage_sex_country', title = 'Suicides in The Netherlands')","43df31a4":"plot_sex_time(world[world['continent']=='Europe'], country='Netherlands',col = 'total_suicides_sex_country', title = 'Total Suicides in The Netherlands')","c08d3bab":"plot_sex_time(world[world['continent']=='Europe'], country='Lithuania',col = 'suicide_percentage_sex_country', title = 'Suicides in Lithuania')","b061be6b":"plot_sex_time(world[world['continent']=='Europe'], country='Lithuania',col = 'total_suicides_sex_country', title = 'Total Suicides in Lithuania')","819a6ff9":"plot_sex_diff_time(world[world['continent']=='Europe'], years = [2004, 2014], sex='female',\n                   col = 'total_suicides_sex_country', title = 'Percentage Change in Female European Suicide from 2004-2014')","b1409611":"plot_sex_diff_time(world[world['continent']=='Europe'], years = [2004, 2014], sex='male',\n                   col = 'total_suicides_sex_country', title = 'Percentage Change in Male European Suicide from 2004-2014')","92119572":"def violin(df, year=2014, column='suicides_no', log=False):\n    #column='total_suicides_age_country'\n    sns.set(style=\"whitegrid\", palette=\"pastel\", color_codes=True)\n    sns.set_context(\"notebook\", font_scale=2)\n    tmp = filter_year(df, year=year)\n    tmp = groupings(tmp)\n    tmp = world_statistics(tmp)\n    if log==True:\n        tmp[column] = np.log(tmp[column]+1)\n    vio = sns.violinplot(x=\"age\", y=column, hue=\"sex\",\n               split=True, inner=\"quart\",\n               palette={\"female\": \"y\", \"male\": \"b\"},\n               data=tmp)\n    vio.set_title(\"Number of Suicides Across Europe based on Age (Logarithm)\",fontsize=40 )\nsns.despine(left=True)\nviolin(world[world['continent']=='Europe'], year=2014, log=True)","62ebe311":"for i in sorted(df['year'].unique()):\n    tmp = filter_year(world, year=i)\n    tmp = groupings(tmp)\n    tmp = world_statistics(tmp)\n\n    max_ = np.max(tmp['total_suicides_continent'])\n    continent = tmp[tmp['total_suicides_continent']==max_]['continent'].unique()\n    print('The continent in year %s with the largest number of suicides is %s with %s' % (i, continent, max_))","cc9422d8":"filter_and_plot(world, year=2014,country=None, continent='South America', column = 'total_suicides_country')","d329ad21":"filter_and_plot(world, year=2014,country=None, continent='Europe', column = 'total_suicides_country')","3fa90b5c":"### It appears Belarus, Poland, Romania and Slovakia have the worst suicide rates for men in Europe. The Netherlands and Sweden have the worst suicide rates for women in Europe, which is personally very surprising considering their renowned quality of life.","850c3771":"## This is a worrying trend for the Netherlands - Suicides have risen over the past decade. \n\n### What about Lithuania? As we saw earlier, this country is #1 in Europe - is it getting better or worse?","379185d8":"### Let us now observe how a country's suicide based on sex changes throughout time. I will pick my country - The Netherlands.","2e54d77d":"# **Introduction**\n### We will be looking at the European segment of the WHO statistics for suicide. There are 3 main segments that we will take a look at:\n## 1. The role of sex on suicide \n### Here we observe the difference in suicide statisics of each European country based on sex. How this difference occurs through time is also analysed.\n## 2. The effect of age\n### The contribution of age towards a country's suicide statistic is displayed with a violin plot, which also further highlights the difference in sex.\n## 3. The geopandas package\n### We take a little look at the geopandas package, which enables some nice plots of the world to be quickly drawn.","66566e42":"# Geopandas!\n\n### Geopandas is a lovely piece of kit that enables you to visualise maps easily. It's a shame the dataset doesn't come with data on cities.","2b9da4c8":"### Over the last 10 years, most European countries are showing a decrease in suicide for women. There are clearly a few noteiceable exceptions, however","e7353bcc":"### Suicide in Greece has also increased for men. This is unfortunately true for my homeland (UK) and current residence - The Netherlands.\n\n### It seems that in general, suicides in Eastern Europe are rapidly dropping for both sexes.","1d62d509":"### We see that most suicides come from the age group 35-54 years, for both sexes. Thankfully, the number of young suicides in Europe is quite low. \n\n### The asymmetry that we saw before between sexes can also be seen again; more males kill themselves than females. ","b862b687":"### I am mostly going to be looking at European statistics here, as they are the most well-covered compared with the other continents. ","7f0da221":"### Unfortunately, the WHO statistics are only primarily reliable for the continent of Europe. As we can see below, the number of reported suicides elsewhere is very lacking","ecbd3388":"### Let us first look at the distribution of suicide percentages per country","3b1dc25a":"# The Role of Age on Suicide","3c56eff8":"# **Role of Sex on Suicide in Europe**\n### The first statistic that I'm interested in is the role of sex in suicide. Let us first pick a year - 2014 - to compare the countries of Europe","153378f0":"### Initially it seems European suicides are through the roof compared to other continents. I am assuming, however, this is due to the fact that European suicides are much more likely to be recorded. Let's compare the supposed populations","d08f3a2b":"### Lithuania's suicide rate is clearly very worrying","4b8d7937":"### Germany and Ukraine have the most male suicides in 2014 in Europe\n### Germany and France have the most female suicides.","f8318bfe":"### This is good news for Lithuania - the suicide rate is dropping!\n\n### Let us now turn to percentage change","233552fa":"### Yes, the recorded population is much bigger in Europe. A more important \/ accurate measure, therefore, would be percentages"}}