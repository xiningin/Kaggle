{"cell_type":{"57e40ecb":"code","d68bd2f8":"code","8225dedc":"code","02357737":"code","c3d71876":"code","b6a32d6c":"code","42a1ddb0":"code","aba68ef5":"code","24074e76":"code","9172e835":"code","d3cd37ee":"code","28483332":"code","4da40de8":"code","119253ae":"code","b266fb59":"markdown","450aff32":"markdown","adf08fd6":"markdown","5bc3692d":"markdown","97eeddeb":"markdown","4037f5c6":"markdown","000f50cd":"markdown","1c566c3a":"markdown","6217586a":"markdown","08b6b03b":"markdown","8396c42c":"markdown"},"source":{"57e40ecb":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","d68bd2f8":"pip install openpyxl","8225dedc":"\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","02357737":"NBA19 = pd.read_excel(\"..\/input\/nba2019odds\/NBA2019odds.xlsx\")\nNBA19","c3d71876":"NBA19['winprob']= 1\/(NBA19['winodds'])\/(1\/(NBA19['winodds'])+ 1\/(NBA19['loseodds']))\nNBA19","b6a32d6c":"# Create a dummy variable equal to one when the odds probability is above 50% and zero otherwise.\n\nNBA19['winpred'] = np.where(NBA19['winprob'] >= .5,1,0)","42a1ddb0":"# Identify cases of success based on our criterion, and calculate the average success rate.\n\nNBA19['oddscorrect']= np.where(NBA19['winpred'] == NBA19['win'] ,1,0)\nNBA19['oddscorrect'].mean()","aba68ef5":"# Cases where a win or a loss is predicted to have a probability in excess of 60%.\n\nNBA19['highprob'] = np.where(NBA19['winprob'] >= .6,1,np.where(NBA19['winprob'] <= .4,1,0))\nNBA19rest = NBA19[NBA19['highprob'] == 1].copy()\nNBA19rest","24074e76":"# Success rate.\n\nNBA19rest['oddscorrect']= np.where(NBA19rest['winpred'] == NBA19rest['win'] ,1,0)\nNBA19rest['oddscorrect'].mean()","9172e835":"NBA19['Brier']= (NBA19['win']-NBA19['winprob'])**2 + ((1-NBA19['win'])-(1-NBA19['winprob']))**2\nNBA19['Brier'].mean()                 ","d3cd37ee":"IPL18 = pd.read_excel(\"..\/input\/ipl2018odds\/IPL2018odds.xlsx\")\nIPL18['winprobX']= np.where(IPL18['teamwinodds']>0, 100\/(100+IPL18['teamwinodds']),\\\n                           -IPL18['teamwinodds']\/(100-IPL18['teamwinodds']))\nIPL18['loseprobX']= np.where(IPL18['oppowinodds']>0, 100\/(100+IPL18['oppowinodds']),\\\n                           -IPL18['oppowinodds']\/(100-IPL18['oppowinodds']))\nIPL18['winprob']=IPL18['winprobX']\/(IPL18['winprobX']+IPL18['loseprobX'])\nIPL18['Brier']= (IPL18['teamwin']-IPL18['winprob'])**2 + ((1-IPL18['teamwin'])-(1-IPL18['winprob']))**2\nIPL18['Brier'].mean()","28483332":"NHL19 = pd.read_excel(\"..\/input\/nhl201819odds\/NHL2018-19odds.xlsx\")\nNHL19","4da40de8":"NHL19['winprob']= 1\/(NHL19['winodds'])\/(1\/(NHL19['winodds'])+ 1\/(NHL19['tieodds'])+ 1\/(NHL19['loseodds']))\nNHL19['tieprob']= 1\/(NHL19['tieodds'])\/(1\/(NHL19['winodds'])+ 1\/(NHL19['tieodds'])+ 1\/(NHL19['loseodds']))\nNHL19","119253ae":"NHL19['Brier']= (NHL19['win']-NHL19['winprob'])**2 + ((NHL19['OTL'])-(NHL19['tieprob']))**2 \\\n+((NHL19['loss'])-(1 -NHL19['winprob']- NHL19['tieprob']))**2\nNHL19['Brier'].mean() ","b266fb59":"**Brier Scores**","450aff32":"# Calculate the implied win probability from the decimal odds","adf08fd6":"Brier Scores\nCalculating the success of a forecast, such as the probabilities implied by betting odds, by counting how often the actual outcome was predicted using some threshold probability (e.g. over 50%, over 60%, over 70%) provides a reasonable impression of accuracy, but is obviously sensitive to the threshold selected, while there is no self-evident \"correct\" threshold. Moreover, each prediction is given a score of one or zero, which is a very crude measure of the closeness of the prediction to the outcome.\n\nThe Brier Score, first proposed in the context of weather forecasting by the statistician Glenn Brier in 1950, gives us a precise measure of the degree of accuracy of the predictions. For each possible outcome and forecast, the Brier Score calculates the squared value of the difference, which lies between 0 (100% accurate) and 1 (100% inaccurate). Thus we have a score for each outcome (row) in our data. The Brier Score for the forecasts is the average of the rows.\n\nIn the NBA, MLB, and IPL data we have two possible outcomes for each team in each game - win or lose. In the NHL and EPL data we have three possible outcomes for each team in each game - win, lose, or tie\/draw.\n\nWith two possible outcome the Brier Score for each row is:\n(\ud835\udc5c1\u2212\ud835\udc5d1)2+(\ud835\udc5c2\u2212\ud835\udc5d2)2\n \nWhere o refers to the outcome, outcome 1 is that the team wins ( \ud835\udc5c1=1 ) and outcome 2 is that the team loses ( \ud835\udc5c2=0 ), and  \ud835\udc5d\ud835\udc56  (i = 1,2) refers to the forecast probability of each outcome, and  \ud835\udc5d2  = 1 -  \ud835\udc5d1 .\n\nWith three outcomes the Brier Score for each row is:\n(\ud835\udc5c1\u2212\ud835\udc5d1)2+(\ud835\udc5c2\u2212\ud835\udc5d2)2+(\ud835\udc5c3\u2212\ud835\udc5d3)2\n \nThe Brier Score for the forecast model is then just the mean (1\/N) of all the rows.\n\nLower Brier Scores imply a more accurate forecast.\n\nA Brier Score equal to zero implies 100% accuracy. For the two outcome version, a Brier Score equal to 1 implies perfect inaccuracy, while for the three outcome version a Brier Score of 2 implies perfect inaccuracy.\n\nIf each outcome were equally likely, and predictions were random, then the Brier Score in the tow outcome case would be 0.5 ( =  (1\u22120.5)2+(0\u22120.5)2 ) and in the three outcome case would be 0.666 ( =  (1\u2212.333)2+2(0\u22120.333)2 )\n\n\n[N.B. with two outcomes you will often see the Brier score defined as simply:\n(\ud835\udc5c1\u2212\ud835\udc5d1)2\n \nHowever, given that  \ud835\udc5d2  = 1 -  \ud835\udc5d1  it is easy to show that:\n(\ud835\udc5c1\u2212\ud835\udc5d1)2+(\ud835\udc5c2\u2212\ud835\udc5d2)2=2(\ud835\udc5c1\u2212\ud835\udc5d1)2\n \nand therefore this is simply a matter of scaling. For the purposes of comparison, we will use the longer version.]","5bc3692d":"Given that even choosing at random would obtain a Brier Score of 0.5 (the best possible result is zero), this result may not seem particularly impressive. However, recall that when we aggregated the probabilities for each team over the season, the expected win percentage was highly correlated with the actual win percentage. Even if the betting odds for an individual provide only a limited insight into the outcome of an individual game, if these insights are aggregated over a season of 82, they provide a much more reliable picture. This is an example of the law of large numbers, which states that the greater the number of trials, the closer the actual result will be to the expected (predicted) outcome","97eeddeb":"In the three outcome case, the Brier Score if each probability is chosen randomly equals 0.666, while the perfect forecast (as in the two outcome case) is zero. Thus, as with the NBA and MLB it might appear that the Brier Score is not especially good, also recall that the correlation between actual points and expected points for each team across the season was very high.","4037f5c6":"On this basis the betting odds were \"correct\" two thirds of the time. This test implies that if the betting odds implied a 49.999% chance that the team would win, but the team lost, then the odds were \"incorrect\", whereas it might be more reasonable to think that the odds were indicating that the outcome was just highly uncertain. It's therefore interesting to consider cases where the odds are more decisive. For example, suppose we only consider cases where the outcome (win or lose) is predicted to have a probability of at least 60%? We now define the subset of these cases and derive the success rate.","000f50cd":"A simple way to evaluate the accuracy of the betting odds is to set some criterion for success and see how often the betting odds satisfy it. A natural criterion when there are two outcomes is to define the betting odds as \"correct\" if the odds implied the actual outcome and had a probability greater than 50%","1c566c3a":"## Brier Scores in Three Outcome Leagues\n\nIn the NHL teams are awared two points for a win, one for an overtime loss, and zero points for a loss in regular time. In the EPL teams are awarded three points for a win, one point for a draw and zero points for a loss. We looked already at the relationship between points won and expected points (based on the bookmaker probabilities) in these leagues, so now we look at the Brier Scores in these three outcome leagues.\n\nNHL:","6217586a":"Let's now calculate the Brier Score for the Indian Premier League. I found a poor fit between expected wins and actual wins before, we might expect that the Brier Score will be low too. It is worse than the Brier Score for the other two leagues, and in fact is slightly larger than the expected Brier score if predictions were random. Unlike the other two leagues, the bookmakers seems totally unable to predict outcomes in the IPL:","08b6b03b":"Bookmaker odds are not always very accurate when it comes individual games, but they seem to be fairly reliable in most sports when aggregated over a large number of games. The exception in our data was the Indian Premier League, where the odds seem to provide very little insight into outcomes. we also found that wage data was a very reliable indicator of success in all of our leagues apart from the Indian Premier League. ","8396c42c":"As one might expect, the success rate is considerably higher for this subset, which accounts for about 70% of all observations."}}