{"cell_type":{"5fbf8b31":"code","b68c0a97":"code","45700dd3":"code","0ea2e4a3":"code","a390f451":"code","5a779c4c":"code","caf29365":"code","35711954":"code","3b1c25de":"code","28f3df6f":"code","678037a6":"code","bca1f206":"code","5c623fe8":"code","c19a7bde":"code","3bb0beb0":"code","3fc66f49":"code","c668a816":"code","204c6aea":"code","15f1b322":"code","53ac581e":"code","6fb9164e":"code","a873edc8":"code","b0cb701c":"code","fd433d0e":"code","573269e1":"code","bef045eb":"code","c0192a6e":"code","c74bb8a7":"code","fac16c4d":"code","7f88d045":"code","167ddbd6":"code","5cfc5df5":"code","755ba422":"code","7c6e64da":"code","50372fbf":"code","6487aa26":"code","daa8238e":"code","ad0bee98":"code","1ca8efdd":"code","eac8269d":"code","72f9863b":"code","a5722efd":"code","c2d91349":"code","ce3cbb7e":"code","2ad50853":"markdown","7c44a681":"markdown","81d7515b":"markdown","329d9afe":"markdown","4df26450":"markdown","156c6850":"markdown","fbcdfe70":"markdown","15f7f59d":"markdown","21c18caf":"markdown","e49c2147":"markdown","51fac576":"markdown","f1525c38":"markdown","1a0d0c27":"markdown","04ecd273":"markdown","6c315698":"markdown","d90a0c2f":"markdown","e6afcfdf":"markdown","e959931c":"markdown","74c4e737":"markdown","0ad68dc5":"markdown","3fc8323b":"markdown","957738f5":"markdown","441ac26b":"markdown","0259ca9a":"markdown","c4e12919":"markdown"},"source":{"5fbf8b31":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport warnings\nwarnings.filterwarnings('ignore')\nimport seaborn as sns\nimport matplotlib\nmatplotlib.rcParams['axes.unicode_minus']=False\nplt.style.use('ggplot')\nfrom sklearn.preprocessing import scale,minmax_scale\nimport os\nimport lightgbm as lgb\nimport xgboost as xgb","b68c0a97":"train_pay = pd.read_csv('..\/input\/bigcontest2019\/train_payment.csv')\nprint('train_pay.shape :',train_pay.shape)\ntrain_pay.head()","45700dd3":"train_pay.isna().sum()","0ea2e4a3":"train_lab = pd.read_csv('..\/input\/bigcontest2019\/train_label.csv')\nprint('train_lab.shape :',train_lab.shape)\ntrain_lab.head()","a390f451":"train_lab.isna().sum()","5a779c4c":"train_lab['is_survival'] = train_lab['survival_time'].map(lambda x: 1 if x==64 else 0)\ntrain_lab.head()","caf29365":"dp = train_pay.groupby('day')['amount_spent'].sum()\ndp2 = train_pay.groupby('day')['amount_spent'].mean()","35711954":"fig, ax = plt.subplots(2, 1, figsize=(15,12))\ndp.plot(ax=ax[0])\nax[0].set(title='spent_sum by day', ylabel='spent_sum')\ndp2.plot(ax=ax[1])\nax[1].set(title='spent_mean by day', ylabel='spent_mean')","3b1c25de":"tp = train_pay.groupby('acc_id')['day'].nunique().reset_index(name='day_count')\nprint(tp.shape)\ntp.head()","28f3df6f":"print('28\uc77c\uac04 \uac00\uc7a5 \ub9ce\uc774 \uacb0\uc81c\ud55c \uc0ac\ub78c\uc758 \uacb0\uc81c \uc77c \uc218 :', tp['day_count'].max())","678037a6":"print('20\uc77c \uacb0\uc81c\ud55c \uc0ac\ub78c \uc218 :', tp[tp['day_count']==20].shape[0])","bca1f206":"print('28\uc77c \ub3d9\uc548 \ud558\ub8e8\ub9cc \uacb0\uc81c\ud55c \uc0ac\ub78c \uc218 :', tp[tp['day_count']==1].shape[0])","5c623fe8":"plt.figure(figsize=(15,7))\ns = sns.countplot(tp['day_count'])\ns.set(ylabel='count')\ns.set(title='day_count dist.')\nfor p in s.patches:\n    height = p.get_height()\n    s.text(p.get_x() + p.get_width()\/2.,\n           height + 3,\n           '{}'.format(int(height)),\n           ha = 'center')","c19a7bde":"lab = pd.merge(train_lab, tp, on='acc_id', how='left')\nlab.head()","3bb0beb0":"lab.isna().sum()","3fc66f49":"lab = lab.fillna(0)\nlab.isna().sum()","c668a816":"fig, ax = plt.subplots(1, 2, figsize=(15,7))\nsns.scatterplot(x='day_count', y='amount_spent', data=lab, ax=ax[0])\nax[0].set(title='amount_spent by day_count')\nsns.scatterplot(x='day_count', y='survival_time', data=lab, ax=ax[1])\nax[1].set(title='survival_time by day_count')","204c6aea":"sns.heatmap(data=lab.drop('acc_id',axis=1).corr(), annot=True, fmt='.2f')","15f1b322":"pay = train_pay.groupby('acc_id')['amount_spent'].mean().reset_index(name='daily_spent')\nprint('pay.shape :', pay.shape)\npay.head()","53ac581e":"plt.figure(figsize=(15,7))\nss = sns.distplot(pay['daily_spent'])\nss.set(title='daily_spent dist.')\nss.set(ylabel='density')","6fb9164e":"label = pd.merge(lab, pay, on='acc_id', how='left')\nlabel.head()","a873edc8":"label.isna().sum()","b0cb701c":"label = label.fillna(0)\nlabel.isna().sum()","fd433d0e":"print('\uad00\uce21\uae30\uac04(70\uc77c)\ub3d9\uc548 \uacb0\uc81c\ud55c \uc801 \uc5c6\ub294 \uc0ac\ub78c \uc218 :', label[label['amount_spent']==0].shape[0])\nprint('\ud65c\ub3d9\ub370\uc774\ud130 \uc218\uc9d1\uae30\uac04(28\uc77c)\ub3d9\uc548 \uacb0\uc81c\ud55c \uc801 \uc5c6\ub294 \uc0ac\ub78c \uc218 :', label[label['daily_spent']==0].shape[0])\nprint('\ud65c\ub3d9 & \uad00\uce21 \ub458 \ub2e4 \uacb0\uc81c\ud55c \uc801 \uc5c6\ub294 \uc0ac\ub78c \uc218 :', label[(label['daily_spent']==0) & (label['amount_spent']==0)].shape[0])","573269e1":"sns.heatmap(data=label.drop('acc_id',axis=1).corr(), annot=True, fmt='.2f')","bef045eb":"fig, ax = plt.subplots(1, 2, figsize=(15,7))\nsns.regplot(x='amount_spent', y='daily_spent', data=label, ax=ax[0])\nax[0].set(title='regplot by label_spent and payment_spent')\nsns.regplot(x='day_count', y='daily_spent', data=label, ax=ax[1])\nax[1].set(title='regplot by day_count and payment_spent')","c0192a6e":"fig, ax = plt.subplots(1, 2, figsize=(15,7))\nsns.kdeplot(label[label['is_survival']==1]['amount_spent'], label='survive', ax=ax[0])\nsns.kdeplot(label[label['is_survival']==0]['amount_spent'], label='leave', ax=ax[0])\nax[0].set(xlabel='amount_spent',\n          ylabel='density',\n          title='amount_spent by is_survival')\nsns.kdeplot(label[label['is_survival']==1]['daily_spent'], label='survive', ax=ax[1])\nsns.kdeplot(label[label['is_survival']==0]['daily_spent'], label='leave', ax=ax[1])\nax[1].set(xlabel='daily_spent',\n          ylabel='density',\n          title='daily_spent by is_survival')","c74bb8a7":"plt.figure(figsize=(15,7))\ns = sns.scatterplot(x='survival_time', y='daily_spent', data=label)\ns.set(title='daily_spent by survival_time')","fac16c4d":"fig, ax = plt.subplots(2, 2, figsize=(15,12))\nsns.countplot(label[label['amount_spent']==0]['is_survival'], ax=ax[0,0])\nax[0,0].set(title='is_survival by (amount_spent = 0)')\nsns.countplot(label[label['daily_spent']==0]['is_survival'], ax=ax[0,1])\nax[0,1].set(title='is_survival by (daily_spent = 0)')\nsns.distplot(label[label['amount_spent']==0]['survival_time'], ax=ax[1,0])\nax[1,0].set(ylabel='density', title='survival_time by (amount_spent = 0)')\nsns.distplot(label[label['daily_spent']==0]['survival_time'], ax=ax[1,1])\nax[1,1].set(ylabel='density', title='survival_time by (daily_spent = 0)')","7f88d045":"pay2 = train_pay.groupby('acc_id')['amount_spent'].sum().reset_index(name='sum_spent')\npay2.head()","167ddbd6":"label = pd.merge(label, pay2, on='acc_id', how='left')\nlabel.head()","5cfc5df5":"label.isna().sum()","755ba422":"label = label.fillna(0)\nlabel.isna().sum()","7c6e64da":"plt.figure(figsize=(15,7))\ns = sns.distplot(label['sum_spent'])\ns.set(title='sum_spent dist.', ylabel='density')","50372fbf":"sns.heatmap(data=label.drop('acc_id',axis=1).corr(), annot=True, fmt='.2f')","6487aa26":"fig, ax = plt.subplots(1, 2, figsize=(15,7))\nsns.kdeplot(label[label['is_survival']==1]['daily_spent'], label='survive', ax=ax[0])\nsns.kdeplot(label[label['is_survival']==0]['daily_spent'], label='leave', ax=ax[0])\nax[0].set(xlabel='daily_spent',\n          ylabel='density',\n          title='daily_spent by is_survival')\nsns.kdeplot(label[label['is_survival']==1]['sum_spent'], label='survive', ax=ax[1])\nsns.kdeplot(label[label['is_survival']==0]['sum_spent'], label='leave', ax=ax[1])\nax[1].set(xlabel='sum_spent',\n          ylabel='density',\n          title='sum_spent by is_survival')","daa8238e":"plt.figure(figsize=(15,7))\ns = sns.scatterplot(x='survival_time', y='sum_spent', data=label)\ns.set(title='sum_spent by survival_time')","ad0bee98":"plt.figure(figsize=(15,7))\ns = sns.regplot(x='amount_spent', y='sum_spent', data=label)\ns.set(title='regplot by amount_spent and sum_spent')","1ca8efdd":"label.head()","eac8269d":"label['sum_amount'] = label['survival_time'] * label['amount_spent']\nlabel.head()","72f9863b":"plt.figure(figsize=(15,7))\nsns.distplot(label['sum_amount'])","a5722efd":"plt.figure(figsize=(15,7))\nsns.scatterplot(x='survival_time', y='sum_amount', data=label)","c2d91349":"sns.heatmap(data=label.drop('acc_id',axis=1).corr(), annot=True, fmt='.2f')","ce3cbb7e":"plt.figure(figsize=(15,7))\ns = sns.regplot(x='sum_amount', y='sum_spent', data=label)\ns.set(title='regplot by sum_amount and sum_spent')","2ad50853":"28\uc77c\uac04 \uacb0\uc81c\ud55c \uc801 \uc5c6\ub294 \uc0ac\ub78c\ub4e4\uc758 \ub300\ubd80\ubd84(\uc57d 77%)\uc774 \uadf8 \ud6c4 70\ub3d9\uc548\uc5d0\ub3c4 \uacb0\uc81c\ub97c \ud558\uc9c0 \uc54a\uc558\ub2e4.","7c44a681":"# survival_time\uacfc [amount_spent, daily_spent]\uc640\uc758 \uad00\uacc4?","81d7515b":"\uc704\uc5d0\uc11c\uc640 \ub611\uac19\uc774 \uacb0\uce21\uac12\uc740 0\uc73c\ub85c \ub300\uce58\ud55c\ub2e4.","329d9afe":"# Data Field\n\n## payment\n- day : \ub0a0\uc9dc\n- acc_id : \uc720\uc800 \uc544\uc774\ub514\n- amount_spent : \uacb0\uc81c \uae08\uc561\n\n## label (target)\n- acc_id : \uc720\uc800 \uc544\uc774\ub514\n- survival_time : \uc0dd\uc874 \uae30\uac04(\uc77c)\n- amount_spent : \uc77c\ubcc4 \ud3c9\uade0 \uacb0\uc81c \uae08\uc561","4df26450":"# daily_spent","156c6850":"28\uc77c\uac04 \ucd1d \uacb0\uc81c\uc561\uacfc \uadf8 \ud6c4 70\uc77c\uac04 \ucd1d \uacb0\uc81c\uc561\uc740 \uc0c1\uad00\uad00\uacc4\uac00 \uadf8\ub098\ub9c8 \uc870\uae08 \uc788\ub294 \uac83\uc73c\ub85c \ubcf4\uc778\ub2e4.","fbcdfe70":"\uc5ec\uae30\uc11c \uad81\uae08\ud588\ub358 \uc810\uc740 28\uc77c\uac04 \uc77c\ubcc4 \uacb0\uc81c\uae08\uc561\uacfc \uadf8 \ud6c4 70\uc77c\uac04 \uc77c\ubcc4 \uacb0\uc81c\uae08\uc561\uc758 \uc0c1\uad00\uad00\uacc4\uac00 \ub192\ub0d0\ub294 \uac83\uc774\ub2e4.","15f7f59d":"# 28\uc77c\uac04 day\ubcc4 \uc720\uc800\ub4e4\uc758 \uacb0\uc81c\uc561","21c18caf":"28\uc77c\uac04 day\ubcc4 amount_spent\uc758 sum\uacfc mean\uc740 \ucc28\uc774\uac00 \ubcc4\ub85c \uc5c6\ub2e4.  \n\uadf8 \ub9d0\uc740 \uae09\uaca9\ud558\uac8c \uacb0\uc81c\uc561\uc774 \ub9ce\uc544\uc9c0\ub294 \ub0a0\uc774 \uc788\ub2e4\ub294 \uac83\uc774\ub2e4.  \n\uc774\ub7f0 \uacbd\uc6b0\ub294 \uc774\ubca4\ud2b8\ub97c \ud558\uac70\ub098 \uc815\uae30\uc801\uc73c\ub85c \uacb0\uc81c\ud558\ub294 \ub0a0\uc774 \uc815\ud574\uc838 \uc788\ub2e4\ub294 \uac83\uc778\uac00,,  \n\uadf8\ub7f0\ub370 \uae09\uaca9\ud558\uac8c \uacb0\uc81c\uc561\uc774 \ub9ce\uc544\uc9c0\ub294 \ub0a0 \ubc14\ub85c \ub2e4\uc74c\ub0a0\uc5d0\ub3c4 \ub2e4\ub978 \ub0a0\ub4e4\ubcf4\ub2e4 \uacb0\uc81c\uc561\uc774 \ub9ce\ub2e4\ub294 \uac83\uc744 \ubcf4\uba74 \uc774\ubca4\ud2b8\ub97c \ud558\ub294 \uac83 \uac19\ub2e4.","e49c2147":"- 40000\uc774 \uc544\ub2cc \uc774\uc720\ub294 28\uc77c\uac04 \uacb0\uc81c\ud55c \uc801\uc774 \uc5c6\ub294 \uc0ac\ub78c\uc740 \uae30\ub85d\uc774 \ub418\uc9c0 \uc54a\uc558\uae30 \ub54c\ubb38\uc774\ub77c \uc0dd\uac01\ub428.","51fac576":"\uc794\uc874\ud55c \uc720\uc800\uc640 \uc774\ud0c8\ud55c \uc720\uc800\uc758 28\uc77c\uac04 sum_spent\ub294 \ubcc4 \ucc28\uc774 \uc5c6\uc5b4\ubcf4\uc778\ub2e4.","f1525c38":"\uacb0\uc81c\ud55c \uc801 \uc788\ub294 23726\uba85\uc758 \ubd84\ud3ec\uc774\uace0, \ub098\uba38\uc9c0 16274\uba85\uc740 0\uc5d0 \uce74\uc6b4\ud2b8 \ub420 \uac83\uc774\ub2e4.","1a0d0c27":"# payment -> \uc720\uc800\ubcc4 \uacb0\uc81c day_count\uc640 daily_spent","04ecd273":"- \uacb0\uc81c\uc758 \uacbd\uc6b0 \uc774\ubca4\ud2b8\uac19\uc740 \uc774\ud399\ud2b8\uc5d0 \ubbfc\uac10\ud558\ubbc0\ub85c \uc2dc\uac04\uc5d0 \ub85c\ubc84\uc2a4\ud2b8\ud558\uac8c \ud558\uae30 \uc704\ud574 \uc0dd\uac01\ud574\uc57c\ud560 \ubd80\ubd84\uc774 \ub9ce\ub2e4\uace0 \uc0dd\uac01\ub41c\ub2e4.  \n\ub294 \uadf8\ub0e5 \ub0b4 \uc0dd\uac01....\n\n\uc720\uc800\ubcc4 \uacb0\uc81c\uc561 \ud45c\uc900\ud3b8\ucc28\ub294 \uc548\ubd24\uc9c0\ub9cc \uc4f8\ubaa8\uc788\uc73c\ub824\ub098?","6c315698":"?","d90a0c2f":"\uc704\uc5d0\uc11c \ub9d0\ud588\ub4ef\uc774, \ubcd1\ud569 \ud6c4 \ub098\uc624\ub294 \uacb0\uce21\uac12\uc740 \uacb0\uc81c\ud55c \uc801\uc774 \uc5c6\uc5b4\uc11c \ub098\uc624\ub294 \uac83 \uac19\ub2e4.  \n\uadf8\ub7ec\ubbc0\ub85c 0\uc73c\ub85c \ub300\uce58\ud55c\ub2e4.","e6afcfdf":"# \uadf8\ub807\ub2e4\uba74 \uc720\uc800\ubcc4 sum_spent","e959931c":"\ud750\uc74c.......","74c4e737":"\uc810\ub4e4\uc758 \ubd84\ud3ec\ub9cc \ubd10\ub3c4 \uc0c1\uad00\uad00\uacc4\uac00 \uc5c6\uc5b4\ubcf4\uc778\ub2e4.\n\n- \uc815\ub9d0 28\uc77c\uac04\uc758 \uacb0\uc81c\uc640 \uadf8 \ud6c4 70\uac04\uc758 \uacb0\uc81c\uc640\ub294 \uc0c1\uad00\uc774 \uc5c6\ub294\uac78\uae4c?","0ad68dc5":"\ubcd1\ud569 \ud6c4 \ub098\uc624\ub294 \uacb0\uce21\uac12\uc740 \uacb0\uc81c\ud55c \uc801\uc774 \uc5c6\uc5b4\uc11c \ub098\uc624\ub294 \uac83 \uac19\ub2e4. Na -> 0\uc73c\ub85c \ub300\uce58\ud55c\ub2e4.","3fc8323b":"?","957738f5":"?","441ac26b":"28\uc77c\ub3d9\uc548 \uba87 \uc77c \uacb0\uc81c \ud588\ub294\uc9c0\ub791 \uadf8 \ud6c4 70\uc77c\ub3d9\uc548\uc758 \uc77c\ubcc4 \uacb0\uc81c\uae08\uc561\uacfc \uc0c1\uad00\uad00\uacc4\ub294 \uac70\uc758 \uc5c6\ub2e4.","0259ca9a":"28\uc77c\uac04 \uc77c\ubcc4 \uacb0\uc81c\uae08\uc561\uacfc \uadf8 \ud6c4 70\uac04\uc758 \uc77c\ubcc4 \uacb0\uc81c\uae08\uc561\uc758 \uc0c1\uad00\uad00\uacc4\ub294 \uac70\uc758 \uc5c6\uc5c8\ub2e4,,  \n\uadf8\ub9ac\uace0 28\uc77c\uac04 \uc77c\ubcc4 \uacb0\uc81c\uae08\uc561\uacfc \uacb0\uc81c\uc77c\uc218\uc758 regplot\uc740 label\ub370\uc774\ud130\uc5d0\uc11c amount_spent\uc640 survival_time\uacfc\uc758 scatterplot\uacfc \ube44\uc2b7\ud55c \uadf8\ub9bc\uc774 \ub098\uc654\ub2e4.\n\n\uadf8\ub7f0\ub370 28\uc77c\uac04 \uc77c\ubcc4 \uacb0\uc81c\uae08\uc561\uacfc \uacb0\uc81c\uc77c\uc218\uc758 \uc0c1\uad00\uad00\uacc4\uac00 0.3\uc774\ub098 \ub098\uc654\ub294\ub370 \ubb54\uc9c0 \ubaa8\ub974\uaca0\ub2e4...\n\n\uadf8\ub9ac\uace0 \uc5ec\uae30\uc11c day_count\ub294 \uacb0\uc81c\uc77c\uc218\uc774\uae30 \ub54c\ubb38\uc5d0 \uc790\uc8fc \uacb0\uc81c\ud558\ub294 \uc0ac\ub78c\uc774\ub77c\ub294 \uac83 \ubc16\uc5d0\ub294 \uc54c \uc218 \uc788\ub294 \uc815\ubcf4\uac00 \uc5c6\ub2e4.","c4e12919":"\uba87 \uac1c \ubd24\uc9c0\ub9cc \uc778\uc0ac\uc774\ud2b8\uac00 \uc5c6\ub2e4\u3160\n\n\uadf8\ub098\ub9c8 \ubcf4\uc774\ub294 \uac83\uc740 \ubb34\uc790\ubcf8 \uc720\uc800\ub4e4\uc740 \uc794\uc874\uc5d0 \uadf8\ub798\ub3c4 \ubc18\ud0c0\uc791\uc740 \ud55c\ub2e4?  \n\ud2b9\ud788 \ud559\uc2b5\ub370\uc774\ud130\uc5d0\uc11c \ubb34\uc790\ubcf8\uc778 \uc720\uc800\ub4e4\uc740 \uc794\uc874\ud55c \uc720\uc800\ub4e4\uc774 \uc870\uae08 \ub354 \ub9ce\ub2e4.\n\n28\uc77c \ub3d9\uc548\uc758 \uc77c\ubcc4\uacb0\uc81c\uae08\uc561\uacfc \uadf8 \ud6c4 70\uc77c \ub3d9\uc548\uc758 \uc77c\ubcc4\uacb0\uc81c\uae08\uc561\uc774 \uc0c1\uad00\uad00\uacc4\uac00 \ub192\uc744 \uc904 \uc54c\uc558\ub294\ub370 \uc544\ub2c8\ub77c\uc11c \uc2e4\ub9dd\ud588\ub2e4\u3160\n\n- \uadf8\ub9ac\uace0 \ud45c\uc900\ud654 \ub41c \ub370\uc774\ud130 \uc774\ubbc0\ub85c amount_spent\uc640 daily_spent\uc758 \ub300\uc18c\ub97c \ube44\uad50\ud560 \uc218 \uc5c6\ub2e4."}}