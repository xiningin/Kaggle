{"cell_type":{"436dc098":"code","f02664d0":"code","118710cd":"code","3bfd6aeb":"code","75a92cdf":"code","95d0a0e5":"code","2835092a":"code","75673d1a":"code","f1251c34":"code","db76e307":"code","ba8938bc":"code","86fc2795":"code","9a2c9a39":"code","51578cad":"code","76381a1a":"code","48c82d72":"code","45a15562":"code","8a8ea354":"code","717fac9d":"code","6d97ba5c":"code","e07afecd":"code","d20f19f1":"code","ad7a2246":"code","b75a0d61":"code","0f0e6f0b":"code","3973e802":"code","de3fce94":"markdown","c03b9154":"markdown","ca787c20":"markdown"},"source":{"436dc098":"import numpy as np \nimport pandas as pd \nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n","f02664d0":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport cv2\nimport os\n\nDATADIR = r\"\/kaggle\/input\/brain-tumor-classification-mri\/Training\/\"\nCATEGORIES = [\"glioma_tumor\",\"meningioma_tumor\",\"no_tumor\",\"pituitary_tumor\"]\nfor category in CATEGORIES:\n    path = os.path.join(DATADIR,category)\n    for img in os.listdir(path):\n        img_array = cv2.imread(os.path.join(path,img))\n        plt.imshow(img_array)\n        plt.show()\n        plt.axis(\"off\")\n        break\n    break","118710cd":"IMG_SIZE = 150\nnew_array = cv2.resize(img_array,(IMG_SIZE,IMG_SIZE))    \nplt.imshow(new_array,cmap = \"gray\")\nplt.axis(\"off\")\n","3bfd6aeb":"training_data = []\n\ndef create_training_data():\n    for category in CATEGORIES:\n        path = os.path.join(DATADIR,category)\n        class_num = CATEGORIES.index(category)\n        for img in os.listdir(path):\n            try:\n                img_array = cv2.imread(os.path.join(path,img),cv2.IMREAD_GRAYSCALE)\n                new_array = cv2.resize(img_array,(IMG_SIZE,IMG_SIZE)) \n                training_data.append([new_array,class_num])\n            except Exception as e:\n                pass\ncreate_training_data()","75a92cdf":"X = []\ny = []\nfor features,label in training_data:\n    X.append(features)\n    y.append(label)\nX = np.array(X).reshape(-1,IMG_SIZE,IMG_SIZE)\nprint(X.shape)\nX = X\/255.0  \nX = X.reshape(-1,150,150,1)","95d0a0e5":"from keras.utils.np_utils import to_categorical # convert to one-hot-encoding\ny = to_categorical(y, num_classes = 4)","2835092a":"from sklearn.model_selection import train_test_split\nX_train, X_val, Y_train, Y_val = train_test_split(X, y, test_size = 0.2, random_state=42)\nprint(\"x_train shape\",X_train.shape)\nprint(\"x_test shape\",X_val.shape)\nprint(\"y_train shape\",Y_train.shape)\nprint(\"y_test shape\",Y_val.shape)","75673d1a":"from sklearn.metrics import confusion_matrix\nimport itertools\n\nfrom keras.utils.np_utils import to_categorical \nfrom keras.models import Sequential\nfrom keras.layers import Dense, Dropout, Flatten, Conv2D, MaxPool2D\nfrom keras.optimizers import RMSprop,Adam\nfrom keras.preprocessing.image import ImageDataGenerator\nfrom keras.callbacks import ReduceLROnPlateau\n\n\nmodel = Sequential()\n#\nmodel.add(Conv2D(filters = 64, kernel_size = (5,5),padding = 'Same', \n                 activation ='relu', input_shape = (150,150,1)))\nmodel.add(MaxPool2D(pool_size=(2,2)))\nmodel.add(Dropout(0.25))\n#\nmodel.add(Conv2D(filters = 128, kernel_size = (3,3),padding = 'Same', \n                 activation ='relu'))\nmodel.add(MaxPool2D(pool_size=(2,2), strides=(2,2)))\nmodel.add(Dropout(0.25))\n#\nmodel.add(Conv2D(filters = 128, kernel_size = (3,3),padding = 'Same', \n                 activation ='relu'))\nmodel.add(MaxPool2D(pool_size=(2,2), strides=(2,2)))\nmodel.add(Dropout(0.3))\n#\nmodel.add(Conv2D(filters = 128, kernel_size = (2,2),padding = 'Same', \n                 activation ='relu'))\nmodel.add(MaxPool2D(pool_size=(2,2), strides=(2,2)))\nmodel.add(Dropout(0.3))\n\n#\nmodel.add(Conv2D(filters = 256, kernel_size = (2,2),padding = 'Same', \n                 activation ='relu'))\nmodel.add(MaxPool2D(pool_size=(2,2), strides=(2,2)))\nmodel.add(Dropout(0.3))\n\n# \nmodel.add(Flatten())\nmodel.add(Dense(1024, activation = \"relu\"))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(4, activation = \"softmax\"))\noptimizer = Adam(lr=0.001, beta_1=0.9, beta_2=0.999)\nmodel.compile(optimizer = optimizer , loss = \"categorical_crossentropy\", metrics=[\"accuracy\"])\nepochs = 50  \nbatch_size = 40\ndatagen = ImageDataGenerator(\n        featurewise_center=False,  \n        samplewise_center=False, \n        featurewise_std_normalization=False,  \n        samplewise_std_normalization=False,  \n        zca_whitening=False,  \n        rotation_range=0,\n        zoom_range = 0,\n        width_shift_range=0,  \n        height_shift_range=0,  \n        horizontal_flip=True,  \n        vertical_flip=False)  \n","f1251c34":"datagen.fit(X_train)\nhistory = model.fit_generator(datagen.flow(X_train,Y_train, batch_size=batch_size),\n                              epochs = epochs, validation_data = (X_val,Y_val),\n                              steps_per_epoch = X_train.shape[0] \/\/ batch_size)    ","db76e307":"plt.plot(history.history[\"loss\"],c = \"purple\")\nplt.plot(history.history[\"val_loss\"],c = \"orange\")\nplt.title(\"Loss\")\nplt.ylabel(\"Loss\")\nplt.xlabel(\"Epochs\")\nplt.legend([\"train\", \"test\"])\nplt.show()","ba8938bc":"plt.plot(history.history[\"accuracy\"],c = \"purple\")\nplt.plot(history.history[\"val_accuracy\"],c = \"orange\")\nplt.title(\"Accuracy\")\nplt.ylabel(\"Accuracy\")\nplt.xlabel(\"Epochs\")\nplt.legend([\"train\", \"test\"])\nplt.show()","86fc2795":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport cv2\nimport os\n\nDATADIR = r\"\/kaggle\/input\/brain-tumor-classification-mri\/Testing\/\"\nCATEGORIES = [\"glioma_tumor\",\"meningioma_tumor\",\"no_tumor\",\"pituitary_tumor\"]\nfor category in CATEGORIES:\n    path = os.path.join(DATADIR,category)\n    for img in os.listdir(path):\n        img_array = cv2.imread(os.path.join(path,img))\n        plt.imshow(img_array)\n        plt.show()\n        plt.axis(\"off\")\n        break\n    break","9a2c9a39":"IMG_SIZE = 150\nnew_array = cv2.resize(img_array,(IMG_SIZE,IMG_SIZE))    \nplt.imshow(new_array,cmap = \"gray\")\nplt.axis(\"off\")","51578cad":"testing_data = []\n\ndef create_training_data():\n    for category in CATEGORIES:\n        path = os.path.join(DATADIR,category)\n        class_num = CATEGORIES.index(category)\n        for img in os.listdir(path):\n            try:\n                img_array = cv2.imread(os.path.join(path,img),cv2.IMREAD_GRAYSCALE)\n                new_array = cv2.resize(img_array,(IMG_SIZE,IMG_SIZE)) \n                testing_data.append([new_array,class_num])\n            except Exception as e:\n                pass\ncreate_training_data()","76381a1a":"X = []\ny = []\nfor features,label in testing_data:\n    X.append(features)\n    y.append(label)\nX = np.array(X).reshape(-1,IMG_SIZE,IMG_SIZE)\nprint(X.shape)\nX = X\/255.0  \nX = X.reshape(-1,150,150,1)\nyleb=y","48c82d72":"from keras.utils.np_utils import to_categorical # convert to one-hot-encoding\ny = to_categorical(y, num_classes = 4)","45a15562":"predicted=model.predict(X)\nroundpred=np.argmax(predicted,axis=-1)\n\nprint(roundpred)\n\nprint(confusion_matrix(yleb, roundpred))\n","8a8ea354":"#single image loading","717fac9d":"pathx=\"\/kaggle\/input\/brain-tumor-classification-mri\/Testing\/glioma_tumor\"\nlst=os.listdir(pathx)\nprint(lst)","6d97ba5c":"img_array = cv2.imread(os.path.join(pathx,lst[14]),cv2.IMREAD_GRAYSCALE)\nnew_array = cv2.resize(img_array,(IMG_SIZE,IMG_SIZE)) \nplt.imshow(new_array,cmap = \"gray\")\nX = np.array(new_array).reshape(-1,IMG_SIZE,IMG_SIZE)\nX = X.reshape(-1,150,150,1)\npredicted=model.predict(X)\nroundpred=np.argmax(predicted,axis=-1)\nprint(roundpred)\n","e07afecd":"!mkdir prediction","d20f19f1":"from PIL import Image\nimport PIL\n\n\nim1 = Image.open(r\"\/kaggle\/input\/brain-tumor-classification-mri\/Testing\/glioma_tumor\/image(62).jpg\")\n\n\nim1 = im1.save(\"\/kaggle\/working\/prdeiction\/image(62).jpg\")","ad7a2246":"from keras.models import load_model\nmodel.save('my_model.h5')","b75a0d61":"!ls","0f0e6f0b":"model = load_model('my_model.h5')","3973e802":"!pwd","de3fce94":"### PREDICTION USING CNN","c03b9154":"<font color ='brown'>\n    \n\n    \n### Load and Check Data ","ca787c20":"### MANIPULATING DATA"}}