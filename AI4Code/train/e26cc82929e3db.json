{"cell_type":{"133c5fe7":"code","31304f3e":"code","cc886ee3":"code","54755fcc":"code","c3df1fb0":"code","ef2b9ac1":"code","62cfd611":"code","ea34b5b9":"code","699fc9c7":"code","2fdea893":"code","03a63d83":"code","5fa8cdf9":"code","a521b246":"code","8b1a08d5":"code","83d2b309":"code","fe6ea590":"code","b529c5f8":"code","b061f410":"code","07440441":"markdown","01fd91bc":"markdown","f2663cc8":"markdown","149c8171":"markdown","abead856":"markdown","e6ea7018":"markdown","ab2c7ef7":"markdown","207f4eb5":"markdown","6b431a4d":"markdown","92ed71e2":"markdown","b28c2145":"markdown","3c47c6ec":"markdown","dec22f9a":"markdown"},"source":{"133c5fe7":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom pathlib import Path\nimport shap\nimport random\n\nimport lightgbm as lgb\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.model_selection import KFold\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","31304f3e":"df = pd.read_csv('..\/input\/widsdatathon2021\/TrainingWiDS2021.csv')\ndisplay(df.head())","cc886ee3":"df.isnull().sum()","54755fcc":"plt.style.use('dark_background')\nsns.countplot(x=\"diabetes_mellitus\",data=df,palette=\"GnBu_d\", edgecolor=\"black\")\nplt.xticks(rotation=45)\nplt.yticks(rotation=45)\n# changing the font size\nsns.set(font_scale=1)","c3df1fb0":"SEED = 99\nrandom.seed(SEED)\nnp.random.seed(SEED)","ef2b9ac1":"corrmat = round(df.corr(method='pearson'),2)","62cfd611":"plt.figure(figsize=(12,6))\nsns.heatmap(corrmat.iloc[1:2,:25], vmax=1.0, vmin=-1.0, square=True, annot=True, cmap='summer')\nplt.show()","ea34b5b9":"dfmodel = df.copy()\n\n# read the \"object\" columns and use labelEncoder to transform to numeric\nfor col in dfmodel.columns[dfmodel.dtypes == 'object']:\n    le = LabelEncoder()\n    dfmodel[col] = dfmodel[col].astype(str)\n    le.fit(dfmodel[col])\n    dfmodel[col] = le.transform(dfmodel[col])","699fc9c7":"#change columns names to alphanumeric\ndfmodel.columns = [\"\".join (c if c.isalnum() else \"_\" for c in str(x)) for x in dfmodel.columns]","2fdea893":"X = dfmodel.drop(['diabetes_mellitus','encounter_id'], axis = 1)\ny = dfmodel['diabetes_mellitus']","03a63d83":"lgb_params = {\n                    'objective':'binary',\n                    'metric':'auc',\n                    'n_jobs':-1,\n                    'learning_rate':0.005,\n                    'num_leaves': 20,\n                    'max_depth':-1,\n                    'subsample':0.9,\n                    'n_estimators':2500,\n                    'seed': SEED,\n                    'early_stopping_rounds':100, \n                }","5fa8cdf9":"# choose the number of folds, and create a variable to store the auc values and the iteration values.\nK = 5\nfolds = KFold(K, shuffle = True, random_state = SEED)\nbest_scorecv= 0\nbest_iteration=0\n\n# Separate data in folds, create train and validation dataframes, train the model and cauculate the mean AUC.\nfor fold , (train_index,test_index) in enumerate(folds.split(X, y)):\n    print('Fold:',fold+1)\n          \n    X_traincv, X_testcv = X.iloc[train_index], X.iloc[test_index]\n    y_traincv, y_testcv = y.iloc[train_index], y.iloc[test_index]\n    \n    train_data = lgb.Dataset(X_traincv, y_traincv)\n    val_data   = lgb.Dataset(X_testcv, y_testcv)\n    \n    LGBM = lgb.train(lgb_params, train_data, valid_sets=[train_data,val_data], verbose_eval=250)\n    best_scorecv += LGBM.best_score['valid_1']['auc']\n    best_iteration += LGBM.best_iteration\n\nbest_scorecv \/= K\nbest_iteration \/= K\nprint('\\n Mean AUC score:', best_scorecv)\nprint('\\n Mean best iteration:', best_iteration)","a521b246":"lgb_params = {\n                    'objective':'binary',\n                    'metric':'auc',\n                    'n_jobs':-1,\n                    'learning_rate':0.05,\n                    'num_leaves': 20,\n                    'max_depth':-1,\n                    'subsample':0.9,\n                    'n_estimators':round(best_iteration),\n                    'seed': SEED,\n                    'early_stopping_rounds':None, \n                }\n\ntrain_data_final = lgb.Dataset(X, y)\nLGBM = lgb.train(lgb_params, train_data)","8b1a08d5":"print(LGBM)","83d2b309":"# telling wich model to use\nexplainer = shap.TreeExplainer(LGBM)\n# Calculating the Shap values of X features\nshap_values = explainer.shap_values(X)","fe6ea590":"shap.summary_plot(shap_values[1], X, plot_type=\"bar\")","b529c5f8":"shap.summary_plot(shap_values[1], X)","b061f410":"#Code by Olga Belitskaya https:\/\/www.kaggle.com\/olgabelitskaya\/sequential-data\/comments\nfrom IPython.display import display,HTML\nc1,c2,f1,f2,fs1,fs2=\\\n'#eb3434','#eb3446','Akronim','Smokum',30,15\ndef dhtml(string,fontcolor=c1,font=f1,fontsize=fs1):\n    display(HTML(\"\"\"<style>\n    @import 'https:\/\/fonts.googleapis.com\/css?family=\"\"\"\\\n    +font+\"\"\"&effect=3d-float';<\/style>\n    <h1 class='font-effect-3d-float' style='font-family:\"\"\"+\\\n    font+\"\"\"; color:\"\"\"+fontcolor+\"\"\"; font-size:\"\"\"+\\\n    str(fontsize)+\"\"\"px;'>%s<\/h1>\"\"\"%string))\n    \n    \ndhtml('Be patient. Mar\u00edlia Prata, not a DS, @mpwolke was Here' )","07440441":"#Codes by rossinEndrew https:\/\/www.kaggle.com\/endrewrossin\/fast-lightgbm-model-to-detect-exam-result-w-shap\/notebook","01fd91bc":"![](https:\/\/view.vzaar.com\/15666669\/image)futurelearn.com","f2663cc8":"Risk of fatal or critical care unit-treated COVID-19 in the national population of Scotland with and without diabetes by age band and sex by July 31, 2020\n\nThe increase in risk of fatal or critical care unit-treated COVID-19 that was associated with diabetes was apparent in both sexes and at all age bands.\n\n![](https:\/\/els-jbs-prod-cdn.jbs.elsevierhealth.com\/cms\/attachment\/ec22b43c-e666-4f05-a427-0ef1847698f5\/gr1.jpg)https:\/\/www.thelancet.com\/journals\/landia\/article\/PIIS2213-8587(20)30405-8\/fulltext","149c8171":"<font color=\"#EC7063\">Statistical analysis<\/font>\n\nFor calculating cumulative incidence (risk), they used the age-specific and sex-specific counts of people with fatal or critical care unit-treated COVID-19 in those with and without diabetes across the study period. \n\nThe age and sex distribution of people with diabetes as of 3 weeks before the first observed positive test nationally was available from SCI-Diabetes.\n\nTo obtain the at-risk population for those without diabetes, they used the most recent publicly available 1-year age and sex band counts of the total Scottish population available from National Records of Scotland, the authors assumed these counts pertained at the start of the pandemic. From this number, they subtracted the number of people who were alive in the diabetes register in each sex-specific age band, to give the population without diabetes.\n\nThey summarised the relative difference in cumulative incidence of fatal or critical care unit-treated COVID-19 up to July 31, 2020, in people with and without diabetes by sex as the odds ratio from a logistic regression model using 1-year age band and sex-specific counts of cases and denominators. \nhttps:\/\/www.thelancet.com\/journals\/landia\/article\/PIIS2213-8587(20)30405-8\/fulltext","abead856":"#ML explainability","e6ea7018":"### <b><mark style=\"background-color: #9B59B6\"><font color=\"white\">Diabetes TYPE 2<\/font><\/mark><\/b>\n\nIf you have this kind, your body can't use the insulin it makes. This is called insulin resistance. Type 2 usually affects adults, but it can begin at any time in your life. The main things that lead to it are:\n\nOBESITY OR BEING OVERWEIGHT. \n\nResearch shows this is a top reason for type 2 diabetes. Because of the rise in obesity among U.S. children, this type is affecting more teenagers.\n\nIMPAIRED GLUCOSE TOLERANCE.\n\nPrediabetes is a milder form of this condition. It can be diagnosed with a simple blood test. If you have it, there\u2019s a strong chance you\u2019ll get type 2 diabetes.\n\nINSULIN RESISTANCE. \n\nType 2 diabetes often starts with cells that are resistant to insulin. That means your pancreas has to work extra hard to make enough insulin to meet your body's needs.\n\nETHNIC BACKGROUND. \n\nDiabetes happens more often in Hispanic\/Latino Americans, African-Americans, Native Americans, Asian-Americans, Pacific Islanders, and Alaska natives.\n\nGESTACIONAL DIABETES.\n\nIf you had diabetes while you were pregnant, you had gestational diabetes. This raises your chances of getting type 2 diabetes later in life.\n\nSEDENTARY LIFESTYLE.\n\nYou exercise less than three times a week.\n\nFAMILY HISTORY.\n\nYou have a parent or sibling who has diabetes.\n\nPOLYCYSTIC OVARY SYNDROME.\n\nWomen with polycystic ovary syndrome (PCOS) have a higher risk.\n\nAGE. \n\nIf you're over 45 and overweight or if you have symptoms of diabetes, talk to your doctor about a simple screening test.\nhttps:\/\/www.webmd.com\/diabetes\/guide\/risk-factors-for-diabetes","ab2c7ef7":"Associations of age, sex, diabetes duration, socioeconomic status, prior cardiovascular disease, renal status, blood pressure, and glycaemic control with death from COVID-19 were found in the English National Audit study.\n\nIn that study, non-White ethnicity was found to be associated with COVID-19 death, whereas in Scotland the prevalence of non-White ethnic groups is too low to allow detection of any ethnicity-related differences in COVID-19; only 2\u00b79% of those with diabetes are known to be of south Asian origin and 0\u00b75% of Black origin.\n\nThe authors found that being on antihypertensive drugs was associated with a lower risk, but the English National Audit study found an increased risk. However, that higher risk was driven by a large effect in south Asian and mixed ethnicity groups and was not seen in White people or other ethnic groups. \n\nThe U-shaped association with BMI in the English National Audit study was stronger than the J-shaped relationship that they found. This difference is probably also driven by the different ethnic mix in the studies, because the relationship of higher BMI to higher risk was most apparent in those of non-White ethnicity in the English National Audit study.\n\nThe increased risk at lower BMI, including underweight, in both studies probably reflects comorbid effects related to fatal or critical care unit-treated COVID-19 that are associated with weight loss. Given the elevation in BMI among people with type 2 diabetes, it would not be surprising to see such comorbid effects resulting in the nadir of the curve being around the average BMI of 30 kg\/m2, as was found here. \n\nIn the English National Audit study, as in ours, ex-smokers were at increased risk, but that study reported that current smokers were at reduced risk, which they did not find. This difference might reflect that in that study, smoking effects were reported adjusted for all other variables, including possible mediators such as cardiovascular disease. The extensive data on other factors that we examined were not evaluated in the English National Audit study. The extensive factors include previous admissions for diabetic ketoacidosis, hypoglycaemia, and other reasons, and comorbidities and drug exposures.https:\/\/www.thelancet.com\/journals\/landia\/article\/PIIS2213-8587(20)30405-8\/fulltext","207f4eb5":"### <b><mark style=\"background-color: #9B59B6\"><font color=\"white\">Steps to Take<\/font><\/mark><\/b>\n\nWhatever your risks are, there's a lot you can do to delay or prevent diabetes.\n\nManage your blood pressure.\n\nKeep your weight within or near a healthy range.\n\nGet 30 minutes of exercise on most days.\n\nEat a balanced diet.\nhttps:\/\/www.webmd.com\/diabetes\/guide\/risk-factors-for-diabetes","6b431a4d":"### <b><mark style=\"background-color: #9B59B6\"><font color=\"white\">Gestational Diabetes<\/font><\/mark><\/b>\n\nDiabetes when you\u2019re expecting affects about 4% of all U.S. pregnancies. It's caused by hormones the placenta makes or by too little insulin. High blood sugar from the mother causes high blood sugar in the baby. That can lead to growth and development problems if left untreated. Things that can lead to gestational diabetes include:\n\nOBESITY OR BEING OVERWEIGHT.\n\nExtra pounds can lead to gestational diabetes.\n\nGLUCOSE INTOLERANCE.\n\nHaving glucose intolerance or gestational diabetes in the past makes you more likely to get it again.\n\nFAMILY HISTORY.\n\nIf a parent or sibling has had gestational diabetes, you're more likely to get it.\n\nAGE.\n\nThe older you are when you get pregnant, the higher your chances are.\nEthnic background. Nonwhite women have a greater chance of developing it.\nhttps:\/\/www.webmd.com\/diabetes\/guide\/risk-factors-for-diabetes","92ed71e2":"<a id=\"1.1\"><\/a>\n<h3 style=\"background-color:coral;font-family:newtimeroman;font-size:200%;text-align:center\">Risk factors for COVID-19 disease in people with diabetes<\/h3>\n\nRisks of and risk factors for COVID-19 disease in people with diabetes: a cohort study of the total population of Scotland\n\nAuthors: Stuart J McGurnaghan, Amanda Weir,Jen Bishop, Sharon Kennedy, Luke A K Blackbourn, David A McAllister,et al.\n\nPublished:December 23, 2020DOI:https:\/\/doi.org\/10.1016\/S2213-8587(20)30405-8\n\nThe authors aimed to ascertain the cumulative risk of fatal or critical care unit-treated COVID-19 in people with diabetes and compare it with that of people without diabetes, and to investigate risk factors for and build a cross-validated predictive model of fatal or critical care unit-treated COVID-19 among people with diabetes.\n\nIn this cohort study, they captured the data encompassing the first wave of the pandemic in Scotland, till the infection rates had dropped sufficiently that shielding measures were officially terminated.\n\nThe participants were the total population of Scotland, including all people with diabetes who were alive 3 weeks before the start of the pandemic in Scotland. The authors ascertained how many people developed fatal or critical care unit-treated COVID-19 in this period from the Electronic Communication of Surveillance in Scotland database (on virology), the RAPID database of daily hospitalisations, the Scottish Morbidity Records-01 of hospital discharges, the National Records of Scotland death registrations data, and the Scottish Intensive Care Society and Audit Group database (on critical care). \n\nAmong people with fatal or critical care unit-treated COVID-19, diabetes status was ascertained by linkage to the national diabetes register, Scottish Care Information Diabetes. They compared the cumulative incidence of fatal or critical care unit-treated COVID-19 in people with and without diabetes using logistic regression. For people with diabetes, they obtained data on potential risk factors for fatal or critical care unit-treated COVID-19 from the national diabetes register and other linked health administrative databases. \n\nThey tested the association of these factors with fatal or critical care unit-treated COVID-19 in people with diabetes, and constructed a prediction model using stepwise regression and 20-fold cross-validation.\nhttps:\/\/www.thelancet.com\/journals\/landia\/article\/PIIS2213-8587(20)30405-8\/fulltext","b28c2145":"#Modeling","3c47c6ec":"<a id=\"1.1\"><\/a>\n<h3 style=\"background-color:skyblue;font-family:newtimeroman;font-size:200%;text-align:center\">What Increases Risk of Diabetes?<\/h3>\n\n<font color=\"#EC7063\">Three major types of the disease: type 1, type 2, and gestational diabetes.<\/font>\n\nWith all three, your body can't make or use insulin. One of every four people with diabetes doesn't know they have it. \n\nTYPE 1\n\nThis type usually starts in childhood. Your pancreas stops making insulin. You have type 1 diabetes for life. The main things that lead to it are:\n\nFamily history. If you have relatives with diabetes, chances are higher that you\u2019ll get it, too. Anyone who has a mother, father, sister, or brother with type 1 diabetes should get checked. A simple blood test can diagnose it. Diseases of the pancreas. They can slow its ability to make insulin.\nInfection or illness. Some infections and illnesses, mostly rare ones, can damage your pancreas.\nhttps:\/\/www.webmd.com\/diabetes\/guide\/risk-factors-for-diabetes","dec22f9a":"#Final Model\n\nModify the hyperparameters to use the best iteration value and train the final model"}}