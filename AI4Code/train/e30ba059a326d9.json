{"cell_type":{"b5f6f760":"code","74aae027":"code","ba0d6b83":"code","0a0f18b8":"code","b8034dab":"code","c0eac51e":"markdown","70a86cab":"markdown","0382591b":"markdown","05af896c":"markdown","e1473bb2":"markdown"},"source":{"b5f6f760":"import pandas as pd\nimport os\nimport matplotlib.pyplot as plt\nfrom datetime import datetime as dt\n\nPFFScoutingData = pd.read_csv('..\/input\/nfl-big-data-bowl-2022\/PFFScoutingData.csv')\nplays = pd.read_csv('..\/input\/nfl-big-data-bowl-2022\/plays.csv')\ngames = pd.read_csv('..\/input\/nfl-big-data-bowl-2022\/games.csv')","74aae027":"Year = '2018'\nStartDate = '2018-10-01' #YYYY-MM-DD\nEndDate = '2018-10-30' #YYYY-MM-DD\ntargetPlayerID = 39975\n\ntStartDate = dt.strptime(StartDate, '%Y-%m-%d')\ntEndDate = dt.strptime(EndDate, '%Y-%m-%d')","ba0d6b83":"plays = pd.read_csv('..\/input\/nfl-big-data-bowl-2022\/plays.csv')\nKickoff = plays[plays['specialTeamsPlayType']=='Kickoff']\nKickoffReturn = Kickoff[Kickoff['specialTeamsResult']=='Return']\nKickoffReturn['Date'] = pd.to_datetime(KickoffReturn['gameId'], format='%Y%m%d%M')\nKickoffReturn = KickoffReturn.query('Date > @tStartDate').query('Date < @tEndDate')\n# KickoffReturn.to_csv('KickoffReturn.csv')\nReturnerId = KickoffReturn.groupby('returnerId')\n\ntracking = pd.read_csv('..\/input\/nfl-big-data-bowl-2022\/tracking%s.csv'%Year).dropna(subset=['time'])\ntracking[['Date','Time']] = tracking['time'].str.split('T', expand=True)\ntracking['Date'] = pd.to_datetime(tracking['Date'], format='%Y-%m-%d')\ntracking = tracking.query('Date > @tStartDate').query('Date < @tEndDate')\n\nplayers = pd.read_csv('..\/input\/nfl-big-data-bowl-2022\/players.csv')\n\n#merge\ntracking = pd.merge(tracking, KickoffReturn[['gameId', 'playId','absoluteYardlineNumber']], on=['gameId', 'playId'], how='left')","0a0f18b8":"tracking['index'] = tracking.index\ndfs = dict()\ngroupbyReturnerID = KickoffReturn.groupby('returnerId')\n\ndf_otherStats = pd.DataFrame(columns=['name','nflId','StartDate','EndDate','count','totalgain','gainAve','afterFirtsContactTotal'])\n\n\nfor nflIdstr, group in ReturnerId:\n    if len(nflIdstr) != 5:\n        continue\n    nflId = int(nflIdstr)\n\n    returnerInfo = tracking.query('nflId == @nflId').groupby(['gameId','playId'])\n    dfs[nflId] = pd.DataFrame()\n    \n    #other Stats\n    name = players.query('nflId == @nflId')['displayName'].values[0]\n    count = groupbyReturnerID.get_group(nflIdstr).count()['playId']\n    totalgain = groupbyReturnerID.get_group(nflIdstr).sum()['kickReturnYardage']\n    gainAve = groupbyReturnerID.get_group(nflIdstr).mean()['kickReturnYardage']\n\n\n    for gameIDandPlayID, info in returnerInfo:\n        recieveIndex = info[info['event'] == 'kick_received']['index']\n        firstContactIndex = info[info['event'] == 'first_contact']['index']\n        tackleIndex = info[info['event'] == 'tackle']['index']\n        afterFirtsContactTotal = 0\n\n        #\u30b0\u30e9\u30d5\u63cf\u753b\u306e\u305f\u3081\u5ea7\u6a19\u3092\u3044\u3058\u308b\n        info.loc[info['absoluteYardlineNumber'] <= 50, 'x'] = -(info['x'] - 120)\n        info.loc[info['absoluteYardlineNumber'] <= 50, 'y'] = -(info['y'] - 53.33)\n\n        if recieveIndex.empty:\n            continue\n        elif dfs[nflId].empty:\n            dfs[nflId] = pd.DataFrame(info.query('index >= @recieveIndex.iloc[-1]'))  \n        else:\n            dfs[nflId] = dfs[nflId].append(info.query('index >= @recieveIndex.iloc[-1]'))\n\n        if firstContactIndex.empty or tackleIndex.empty:\n            continue\n        else:\n            afterFirtsContactTotal += info.query('index == @tackleIndex.iloc[-1]')['x'].iloc[-1] - info.query('index == @firstContactIndex.iloc[-1]')['x'].iloc[-1]\n            \n    statsSeries = pd.Series([name, nflId, StartDate, EndDate, count, totalgain, gainAve, afterFirtsContactTotal], index=df_otherStats.columns)\n    df_otherStats = df_otherStats.append(statsSeries, ignore_index=True)\n\ndf_otherStats['totalgainRanking'] = df_otherStats['totalgain'].rank(method='min', ascending=False)\ndf_otherStats['gainAveRanking'] = df_otherStats['gainAve'].rank(method='min', ascending=False)\ndf_otherStats['returnerNum'] =len(df_otherStats)","b8034dab":"fig, ax = plt.subplots(1,1,figsize=(10, 12))\n# Exclude Touchback\ndfs[targetPlayerID] = dfs[targetPlayerID].dropna(subset=['absoluteYardlineNumber'])\n\ngroups = dfs[targetPlayerID].groupby('event')\n\nf = groups.get_group('None').plot(x='y', y='x', ax=ax, style='.', label='Run', markersize=7)\nf = groups.get_group('first_contact').plot(x='y', y='x', ax=ax, style='o', label='first_contact', markersize=12)\nf = groups.get_group('kick_received').plot(x='y', y='x', ax=ax, style='^', label='kick_received', markersize=12)\nf = groups.get_group('out_of_bounds').plot(x='y', y='x', ax=ax, style='X', label='out_of_bounds', markersize=12)\nf = groups.get_group('tackle').plot(x='y', y='x', ax=ax, style='v', label='tackle', markersize=12)\nf = groups.get_group('touchdown').plot(x='y', y='x', ax=ax, style='*', color='red', label='touchdown', markersize=12)\nf = groups.get_group('fumble').plot(x='y', y='x', ax=ax, style='*', label='fumble', markersize=12)\n\nxmin = 0\nxmax = 53.33\nax.set_xlabel('')\nax.set_xticks([])\nax.set_yticks([])\nax.set_ylim([0,120])\nax.legend()\nax.set_xlim([xmin,xmax])\nax.set_facecolor('green')\nax.patch.set_alpha(0.3)\n\nx = 0.5\nax.text(x,  0,  \"0\", fontsize=50, color=\"#ffffff\")\nax.text(x, 20, \"20\", fontsize=50, color=\"#ffffff\")\nax.text(x, 40, \"40\", fontsize=50, color=\"#ffffff\")\nax.text(x, 60, \"60\", fontsize=50, color=\"#ffffff\")\nax.text(x, 80, \"80\", fontsize=50, color=\"#ffffff\")\nax.text(x, 100, \"100\", fontsize=50, color=\"#ffffff\")\nax.hlines([20,40,60,80,100], xmin, xmax, \"white\", linestyles='dashed') ","c0eac51e":"# 4. Arrange Data","70a86cab":"# 3. Read Tracking Data","0382591b":"# 1. Import","05af896c":"# 2. Setting","e1473bb2":"# 5. Plot Returner's Locus"}}