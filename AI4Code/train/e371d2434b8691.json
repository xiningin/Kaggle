{"cell_type":{"67909776":"code","074b1528":"code","9b15d181":"code","6f9ab845":"code","b3adf30b":"code","b03f143c":"code","d3a17319":"code","739d5bd4":"code","b45ce626":"code","3ad3f24f":"code","0ca0e967":"code","bf837d36":"code","486dc2da":"code","2e04ecb4":"code","cbc246b3":"code","1c529ed5":"code","1a8c0240":"code","229651a5":"code","39888d24":"code","8784795b":"code","5d79bc1c":"code","842c3af8":"code","035e2cd2":"code","ba8ce9aa":"code","370493ca":"code","e0852a8d":"code","b9f74bcd":"code","c974c51d":"code","4829538b":"code","3e15ff23":"code","a829d5ec":"code","5a36104b":"code","b7db03e2":"code","bc61a08a":"code","50ea6b72":"code","310de49f":"code","ab6066e5":"code","2c4bcd28":"code","9dda0d73":"code","f6c3b527":"code","44578c5d":"code","bc8476da":"markdown","daf94b16":"markdown","e6e0e625":"markdown","5843d596":"markdown","ae81dd00":"markdown","2da119b6":"markdown","d663bc9a":"markdown","745ae0e9":"markdown","f8816791":"markdown","00f6c770":"markdown","9d158853":"markdown","48ea3d37":"markdown","28c9c368":"markdown","7a70d761":"markdown","ef5be37d":"markdown","2b52d330":"markdown","d8a712c6":"markdown","06fb084e":"markdown","c02ec4fb":"markdown","1807633c":"markdown"},"source":{"67909776":"import pandas as pd, numpy as np\nimport sklearn\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.preprocessing import LabelEncoder\nimport warnings\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.ensemble import ExtraTreesClassifier\nwarnings.filterwarnings('ignore')","074b1528":"fifa_inp=pd.read_excel('..\/input\/fifa-19-complete-player-dataset\/data.xls',index_col=[1,2])\nfifa_inp.head()","9b15d181":"fifa_inp['Weight']=fifa_inp['Weight'].str.replace('lbs','')\nfifa_inp.loc[:, 'Value':'Wage'] = fifa_inp.loc[:, 'Value':'Wage'].replace({np.nan: 0})\n\nfor column in fifa_inp.loc[:, 'LS':'RB'].columns: \n    fifa_inp[column] = fifa_inp[column].str.split('+').str[0]\n\nfor col in  ['Release Clause','Value',\"Wage\"]:\n    fifa_inp[col]=fifa_inp[col].str.replace('K','000')\n    fifa_inp[col]=fifa_inp[col].str.replace('M','000000')\n    fifa_inp[col]=fifa_inp[col].str.replace('\u20ac','')\n    fifa_inp[col]=fifa_inp[col].str.replace('.','')","6f9ab845":"fifa_inp['Value']=fifa_inp['Value'].astype('float')\nfifa_inp['Wage']=fifa_inp['Wage'].astype('float')\nval_min=np.nanmin(fifa_inp['Value'].values)\nwage_min=np.nanmin(fifa_inp['Wage'].values)\nfifa_inp['Value'].fillna(val_min, inplace = True)\nfifa_inp['Wage'].fillna(wage_min, inplace = True)","b3adf30b":"fifa_inp['Body Type']=fifa_inp['Body Type'].str.replace('Akinfenwa','Stocky')\nfifa_inp['Body Type']=fifa_inp['Body Type'].str.replace('Courtois','Lean')\nfifa_inp['Body Type']=fifa_inp['Body Type'].str.replace('Messi|C. Ronaldo|Neymar|PLAYER_BODY_TYPE_25|Shaqiri','Normal', regex=True)\nfifa_inp['Body Type'].head()","b03f143c":"fifa_inp=fifa_inp.drop(columns=['Photo','Flag', 'Nationality','Club Logo','Real Face','Special','Loaned From','Unnamed: 0'])","d3a17319":"#Drop these rows - 90% column values are Nan\nlen_bef=len(fifa_inp)\nfifa_inp = fifa_inp.dropna(subset=['International Reputation'])","739d5bd4":"print(\"Rows droped= \")\nprint(len_bef-len(fifa_inp))","b45ce626":"fifa_inp.head()","3ad3f24f":"fifa_inp.loc[:, 'LS':'RB'] = fifa_inp.loc[:, 'LS':'RB'].replace({np.nan: 0})\n\nfifa_inp['Jersey Number'].fillna(8, inplace = True)\nfifa_inp['Position'].fillna('ST', inplace = True)\nfifa_inp['Club'].fillna('No Club', inplace = True)\nfifa_inp['Release Clause'].fillna(0, inplace = True)","0ca0e967":"fifa_inp['Height']=fifa_inp['Height'].str.split(\"'\").str[0].astype('int64')*12+fifa_inp['Height'].str.split(\"'\").str[1].astype('int64')","bf837d36":"fifa_inp['Contract Valid Until'].fillna(2019, inplace = True)\nfifa_inp.loc[:, 'Joined'] = fifa_inp.loc[:, 'Joined'].replace({np.nan: fifa_inp['Joined'].max()})\nfifa_inp['Contract Valid Until']=fifa_inp['Contract Valid Until'].astype('str')\nfifa_inp['Contract Valid Until'] = fifa_inp['Contract Valid Until'].str.split('-').str[0]\nfifa_inp['Joined'] = pd.DatetimeIndex(fifa_inp['Joined']).year\nfifa_inp['Joined'].head()","486dc2da":"fifa_inp.loc[:, 'Age':'Potential']=fifa_inp.loc[:, 'Age':'Potential'].astype('int64')\nfifa_inp.loc[:, 'Value':'Wage']=fifa_inp.loc[:,  'Value':'Wage'].astype('int64')\nfifa_inp.loc[:, 'International Reputation':'Skill Moves']=fifa_inp.loc[:,'International Reputation':'Skill Moves'].astype('int64')\nfifa_inp.loc[:, 'Jersey Number']=fifa_inp.loc[:,'Jersey Number'].astype('int64')\nfifa_inp.loc[:, 'Joined':'Release Clause']=fifa_inp.loc[:, 'Joined':'Release Clause'].astype('int64')","2e04ecb4":"print(\"Nan in each columns\" , fifa_inp.isna().sum(), sep='\\n')","cbc246b3":"#fifa_inp.to_excel(r'Fifa\\Fifa_clean.xls')","1c529ed5":"#fifa_inp['Name'].value_counts()\n#Players with same first and last name","1a8c0240":"dataTypeSeries = fifa_inp.dtypes \nprint('Data type of each column of Dataframe :')\nprint(dataTypeSeries)\n#fifa_inp.nunique()","229651a5":"club_encode=LabelEncoder()\nfoot_encode=LabelEncoder()\nworkrate_encode=LabelEncoder()\nbody_encode=LabelEncoder()\nposition_encode=LabelEncoder()","39888d24":"# Encoding the variable\nfifa_inp['Club']=club_encode.fit_transform(fifa_inp['Club'])\nfifa_inp['Preferred Foot']=foot_encode.fit_transform(fifa_inp['Preferred Foot'])\nfifa_inp['Work Rate']=workrate_encode.fit_transform(fifa_inp['Work Rate'])\nfifa_inp['Body Type']=body_encode.fit_transform(fifa_inp['Body Type'])\nfifa_inp['Position']=position_encode.fit_transform(fifa_inp['Position'])","8784795b":"#foot_encode.inverse_transform(fifa_inp['Preferred Foot'])\nclub = dict(zip(club_encode.classes_, club_encode.transform(club_encode.classes_)))\nfoot = dict(zip(foot_encode.classes_, foot_encode.transform(foot_encode.classes_)))\nworkrate = dict(zip(workrate_encode.classes_, workrate_encode.transform(workrate_encode.classes_)))\nbody = dict(zip(body_encode.classes_, body_encode.transform(body_encode.classes_)))\nposition = dict(zip(position_encode.classes_, position_encode.transform(position_encode.classes_)))\nprint(position)","5d79bc1c":"#fifa_inp.to_excel(r'C:\\Users\\anand\\Downloads\\Data sets\\Fifa\\Fifa_clean.xls')","842c3af8":"#club","035e2cd2":"foot","ba8ce9aa":"workrate","370493ca":"body","e0852a8d":"'''Function to distribution plot'''\nplt.rcParams['figure.figsize'] = (10, 6)\nfont_size = 16\ntitle_size = 20\nsns.distplot(fifa_inp['Age'], color = 'teal')\nplt.xlabel('Age', fontsize = 16)\nplt.ylabel('Precentage of the Players', fontsize = 16)\nplt.xticks(fontsize = 16)\nplt.yticks(fontsize = 16)\nplt.title('Age Distribution of Players', fontsize = 20)\nplt.show()","b9f74bcd":"sns.violinplot(x=\"International Reputation\", y=\"Overall\",data=fifa_inp, palette=\"Set3\")\nplt.rcParams['figure.figsize'] = (10, 6)\n_=plt.title('Overall score among players of different Reputation', fontsize = 20)\n#sns.boxplot(x=\"International Reputation\", y=\"Overall\",data=fifa_inp, palette=\"Set3\")","c974c51d":"club_reputation=fifa_inp.groupby('Club')['International Reputation'].apply(lambda x: ((x==5)|(x==4)).sum()).sort_values(ascending=False).reset_index(name='count')\ntop_club=list(club_reputation.head(5).Club)\ndata_club = fifa_inp.loc[fifa_inp['Club'].isin(top_club)]\n#club_reputation.head(5)","4829538b":"x='Club'\ny='proportion'\nhue='International Reputation'\ntop_club=list(club_reputation.head(5).Club)\ndata_club = fifa_inp.loc[fifa_inp['Club'].isin(top_club)]\ndata_club['Club']=club_encode.inverse_transform(data_club['Club'])\nplt.rcParams['figure.figsize'] = (12, 8)\nax=data_club[hue].groupby(data_club[x]).value_counts(normalize=True).rename(y).reset_index().pipe((sns.barplot, \"data\"), x=x, y=y, hue=hue)\nax.set_title(label = 'Players of Reputation in some top Clubs', fontsize = 20)\nax=plt.xticks(rotation = 45)","3e15ff23":"#data_club[hue].groupby(data_club[x]).value_counts(normalize=True).rename(y).reset_index()\ndata_club.head(2)","a829d5ec":"# Separating out the features\nX = fifa_inp.copy()\nX=X.drop(columns=['International Reputation'])\n# Separating out the target\nY = fifa_inp.loc[:,['International Reputation']]\n# Standardizing the features\nX = StandardScaler().fit_transform(X)\nX","5a36104b":"from sklearn.decomposition import PCA\ncomp=50\ncolumns = []\nfor i in range(1,comp+1):\n    columns.append('PC '+str(i))\npca = PCA()\nprincipalComponents = pca.fit_transform(X)\nprincipalDf = pd.DataFrame(data = principalComponents)","b7db03e2":"var=pca.explained_variance_ratio_\n#pca.explained_variance_","bc61a08a":"plt.rcParams['figure.figsize'] = (8,5)\nax=plt.plot(range(1,len(pca.explained_variance_)+1),np.cumsum(pca.explained_variance_ratio_))\n#ax=plt.bar(range(1,len(pca.explained_variance_)+1),pca.explained_variance_)\n#ax.set_title(label = 'Distribution of International Reputation in some Popular Clubs', fontsize = 20)\nplt.title('PCA Components vs variance', fontsize = 16)\nplt.xlabel('number of components')\n_=plt.ylabel('cumulative explained variance')","50ea6b72":"# feature extraction\n# Separating out the features\nX = fifa_inp.copy()\nX=X.drop(columns=['International Reputation','Wage','Value','Release Clause'])\nX_columns=X.columns\n# Separating out the target\nY = fifa_inp.loc[:,['International Reputation']]\nmodel = ExtraTreesClassifier(n_estimators=10)\nmodel.fit(X, Y)\nFeature_importance=pd.Series(model.feature_importances_,index=X_columns)\nFeature_importance=Feature_importance.sort_values(ascending=False)\nFeature_importance=Feature_importance[Feature_importance>0.015]\nFeature_importance","310de49f":"Correlation_DF = fifa_inp[list(Feature_importance.index)+['International Reputation']]\n#list(Feature_importance.index)","ab6066e5":"colormap = plt.cm.inferno\nplt.figure(figsize=(16,12))\nplt.title('Correlation between Features related to international reputation', y=1.05, size=15)\n_=sns.heatmap(Correlation_DF.corr(),linewidths=0.1,vmax=1.0, \n            square=True, cmap=colormap, linecolor='white', annot=True)","2c4bcd28":"from sklearn.linear_model import Ridge\nridge = Ridge(alpha=1.0)\nridge.fit(X,Y)","9dda0d73":"\nridge_coeff=pd.Series(ridge.coef_[0],index=X_columns)\n#pd.DataFrame(data={'Features':X_columns,'Coefficients':ridge.coef_})\nridge_imp=ridge_coeff[(ridge_coeff<-0.008) | (ridge_coeff>0.008)]\nridge_imp","f6c3b527":"ridge_Correlation_DF = fifa_inp[list(ridge_imp.index)+['International Reputation']]\n#list(Feature_importance.index)","44578c5d":"colormap = plt.cm.inferno\nplt.figure(figsize=(16,12))\nplt.title('Correlation between Features related to international reputation', y=1.05, size=15)\n_=sns.heatmap(ridge_Correlation_DF.corr(),linewidths=0.1,vmax=1.0, \n            square=True, cmap=colormap, linecolor='white', annot=True)","bc8476da":"## Ridge for feature selection","daf94b16":"### Reading the input data","e6e0e625":"### PCA to explain variance in Data","5843d596":"From the correlation heatmap above, we can conclude that Overall, reaction and potential are most positively related to International reputation. The joined feature has a slight negative correlation wrt International reputation.","ae81dd00":"### Converting to int data types","2da119b6":"From the correlation heatmap above, we can conclude that Overall, reaction, potential and composure are most positively related to International reputation. All the selected features important and are more than the expected threshold related to International reputation.","d663bc9a":"### Encoding all the categorical fields","745ae0e9":"### Feature importance using ExtraTrees","f8816791":"Around 30 components are required to explain 98% of variance and around 20 components are required to explain 95% variance.\n\nAre you comfortable making your independent variables less interpretable?\n\n-No. So PCA not ideal here.","00f6c770":"### Imputation of Value and Wage","9d158853":"### Plotting Age distribution of players","48ea3d37":"### Imputation\/ Handling missing data","28c9c368":"### Reputed players in each club","7a70d761":"### Clubs with Most reputed players","ef5be37d":"### Imputation of date Fields","2b52d330":"### Finding correlation among the top features","d8a712c6":" ## 1.2 Feature Selection","06fb084e":"# FIFA - Player Analysis and Club Standing Predictions","c02ec4fb":"### Data Standandization","1807633c":"### International Reputation vs Overall score"}}