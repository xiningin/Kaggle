{"cell_type":{"de06da2f":"code","adc1402d":"code","76aa6e28":"code","b2c0fec1":"code","7fa69aae":"code","6487b539":"code","62acb2fa":"code","7783e35d":"code","7f5c2017":"code","508b75e7":"code","fddcfdea":"code","e7043983":"code","beaa6921":"code","02528ce3":"code","45a2e201":"code","b90518da":"code","a5e4ac76":"code","6aaa5469":"code","616e0210":"code","f5600809":"code","e5b1188c":"code","18c977d8":"code","573f80af":"code","fc9ca0c1":"code","47971394":"code","7fd7d61b":"code","6e6fc201":"code","3c797bcd":"code","50179b17":"code","22a4fc02":"code","c0879dcd":"code","411ce165":"code","51143cbd":"code","105da79d":"code","ccd09e63":"code","ab80ee09":"code","d008c4aa":"code","5a8fe62c":"code","e75b3ed7":"code","8bd218a8":"code","be7a74d4":"code","1b2b516c":"code","fda9d7cc":"code","fb8e3ce2":"code","f5db2837":"code","260060f1":"code","52a1994d":"code","d772060a":"code","a19db915":"code","35969aa4":"code","c690b1ee":"code","47b9f31d":"code","0e11d778":"code","04a32aeb":"code","e6cee196":"code","eba23d00":"code","b1ef04de":"code","6fa7f91b":"code","ae76c071":"code","f2e31cac":"code","e7fd82dd":"code","04e865d2":"code","17600532":"code","ebf13c8f":"code","6e3b7a52":"code","d4b7a6b3":"code","b15f7640":"code","533b73b2":"code","bdd88b6f":"code","e95c4291":"code","ba11733e":"code","4d236c10":"code","55d6076e":"code","bb199c42":"code","d7971ec3":"code","13a3cef3":"code","fb29ce3f":"code","9d13ef7a":"code","d0410f9d":"code","f8b4115c":"code","2bd5ea9d":"code","7db03899":"code","8774c9c0":"code","d86368e9":"code","8d39db0c":"code","34e7ed68":"code","bb339a2c":"code","f7e681c4":"code","725f77b7":"code","0722ec5a":"code","3a2aea7e":"code","bb0c10df":"code","4faac247":"code","f0a2e4c6":"code","7353044f":"code","a7829e91":"code","4a8f739d":"code","88424970":"code","84e7d448":"code","470bcc64":"code","68f82baa":"code","290ce55a":"code","19c7d41e":"code","16ccd806":"code","24b2a1fb":"code","8d9ca8da":"code","4827c40f":"code","76a9f97a":"code","ab1801d1":"code","9f60e944":"code","a8dabf23":"code","69a3e3bc":"code","0253621b":"code","7b6f0c7e":"code","1e00d9db":"code","ff603f92":"code","9949c100":"code","64cd5175":"code","07dd0e07":"code","e1737f73":"code","ccef6ef8":"code","f9cfcadb":"code","c783f5c4":"code","057091da":"code","7c611ca0":"code","83cfae06":"code","15f016cd":"code","87d3bfb3":"code","a3aa253f":"code","4d653d09":"code","b15a8023":"code","0698e2c3":"code","7d07b64c":"code","d7a9366f":"code","8ed04970":"code","15f4c056":"code","a600b113":"code","c734ad7d":"code","62883017":"code","c523a1eb":"code","6c3fab0a":"code","92e37ba8":"code","304689c3":"code","5b28b3a4":"code","710da2c6":"code","1811619f":"code","55ed6074":"code","86897a78":"code","a55faf63":"code","a060d91c":"code","aebdfbeb":"code","862f963c":"code","64004d3d":"code","d03f49ed":"code","6c3846b7":"code","4c2bf70a":"code","2984a6e4":"code","c05a200b":"code","63e59147":"code","9a3565cc":"code","a65a40dd":"code","20d5b312":"code","de50aafc":"code","74fcc661":"code","a6c74192":"code","1d2584a7":"code","795442c9":"code","cd410619":"code","8eb2e435":"code","24f21ac3":"code","2997958e":"code","85d4c287":"code","add22a16":"code","500c05de":"code","4720209c":"code","2f01a7a0":"code","2b1e8bcd":"code","11d30ab3":"code","c71ff53f":"code","8443f664":"code","b8994524":"code","b3a7f773":"code","8bcbf959":"code","f60d47a5":"code","2ba8ac80":"code","fe79b3b6":"markdown","1caccb5d":"markdown","23b6b904":"markdown","17678974":"markdown","b109d4b3":"markdown","19f5182e":"markdown","cfb43e72":"markdown","253a6ab3":"markdown","483de327":"markdown","8962acf7":"markdown","98d983b7":"markdown","6283254f":"markdown","02e4e62a":"markdown","8bd85912":"markdown","9694fe3e":"markdown","07fe4baf":"markdown","fab40149":"markdown","eeca4d99":"markdown","22126e96":"markdown","96230617":"markdown","61860731":"markdown","3f07960a":"markdown","b32fd825":"markdown","40f0799d":"markdown","4ad69daa":"markdown","fefd535e":"markdown","4d0e8914":"markdown","13b8996c":"markdown","2d41dd6c":"markdown","4fb44253":"markdown","4a355ce9":"markdown","1cb14a95":"markdown","fd0b7953":"markdown","a1c93ef8":"markdown","49fbe31a":"markdown","2fb555d8":"markdown"},"source":{"de06da2f":"#En el caso de usar google colab\n#from google.colab import drive\n#drive.mount('\/content\/drive')","adc1402d":"#cd \"\/content\/drive\/My Drive\/Competencias\/Datathon\/Belcorp\/Fase_Online\"","76aa6e28":"ls","b2c0fec1":"#!unzip -q \"\/content\/drive\/My Drive\/Competencias\/Datathon\/Belcorp\/Fase_Online\/datathon-belcorp-prueba.zip\"","7fa69aae":"# Basic\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# Common Tools\nfrom sklearn.preprocessing import LabelEncoder\nfrom collections import Counter\n\n#Algorithms\nfrom sklearn import ensemble, tree, svm, naive_bayes, neighbors, linear_model, gaussian_process, neural_network\nimport xgboost as xgb\nfrom xgboost.sklearn import XGBClassifier\nfrom sklearn import metrics\n\n# Model\nfrom sklearn.metrics import accuracy_score, f1_score, auc, roc_curve, roc_auc_score\nfrom sklearn.model_selection import train_test_split, StratifiedKFold, GridSearchCV, cross_val_score\n#from sklearn.ensemble import VotingClassifier\n\n#Configure Defaults\nimport warnings\nwarnings.filterwarnings('ignore')\n%matplotlib inline","6487b539":"def Columnas_con_missing(df):\n        mis_val = df.isnull().sum()\n        mis_val_percent = 100 * df.isnull().sum() \/ len(df)\n        mis_val_table = pd.concat([mis_val, mis_val_percent], axis=1)\n        mis_val_table_ren_columns = mis_val_table.rename(\n        columns = {0 : 'Missing Values', 1 : '% of Total Values'})\n        mis_val_table_ren_columns = mis_val_table_ren_columns[\n            mis_val_table_ren_columns.iloc[:,1] != 0].sort_values(\n        '% of Total Values', ascending=False).round(1)\n        print (\"La tabla seleccionada con \" + str(df.shape[1]) + \" columnas.\\n\"      \n            \"Tiene \" + str(mis_val_table_ren_columns.shape[0]) +\n              \" columnas con valores nulos.\")\n        return mis_val_percent.sort_values(ascending=False).head(mis_val_table_ren_columns.shape[0])","62acb2fa":"predecir = pd.read_csv(\"..\/input\/datathon-belcorp-prueba\/predict_submission.csv\")\npredecir['campana']=201907\npredecir = predecir[['campana','idconsultora']]","7783e35d":"predecir.head()","7f5c2017":"predecir.shape","508b75e7":"maestro_consultora = pd.read_csv(\"..\/input\/datathon-belcorp-prueba\/maestro_consultora.csv\")\nmaestro_consultora = maestro_consultora.drop('Unnamed: 0',axis=1)\nmaestro_consultora = maestro_consultora.rename({'IdConsultora': 'idconsultora'}, axis=1)\nmaestro_consultora.head()","fddcfdea":"maestro_consultora.shape","e7043983":"campana_consultora=pd.read_csv(\"..\/input\/datathon-belcorp-prueba\/campana_consultora.csv\")","beaa6921":"campana_consultora = campana_consultora.drop('Unnamed: 0',axis=1)\n#campana_consultora = campana_consultora.sort_values(['campana', 'IdConsultora'], ascending=[True, True]).reset_index(drop=True)\n#campana_consultora[\"llave\"] = campana_consultora[['campana', 'IdConsultora']].apply(lambda x : '{}_{}'.format(x[0],x[1]), axis=1)\ncampana_consultora = campana_consultora.rename({'IdConsultora': 'idconsultora','Flagpasopedido': 'flagpasopedido'}, axis=1)\ncampana_consultora.head(3)","02528ce3":"campana_consultora.shape","45a2e201":"campana_consultora.groupby(['campana']).size()","b90518da":"#campana_consultora.dtypes #train.info()","a5e4ac76":"Columnas_con_missing(campana_consultora)","6aaa5469":"campana_consultora = campana_consultora.drop(\"codigocanalorigen\",axis=1)","616e0210":"#campana_consultora['FLG_codigofactura']=1\n#campana_consultora.loc[pd.isna(campana_consultora['codigofactura'])==True, 'FLG_codigofactura']=0\n\n#campana_consultora['FLG_cantidadlogueos']=1\n#campana_consultora.loc[pd.isna(campana_consultora['cantidadlogueos'])==True, 'FLG_cantidadlogueos']=0","f5600809":"campana_consultora.campana.min(),campana_consultora.campana.max()","e5b1188c":"pd.value_counts(campana_consultora.flagpasopedido)\/campana_consultora.shape[0]","18c977d8":"#pd.value_counts(campana_consultora.idconsultora).describe()","573f80af":"#Columnas_con_missing(campana_consultora)","fc9ca0c1":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagpasopedido\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())","47971394":"historico_consultora=historico_consultora.fillna(0)\nhistorico_consultora.head(3)","7fd7d61b":"historico_consultora.shape","6e6fc201":"historico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\nhistorico_predecir.shape","3c797bcd":"historico_predecir.head(3)","50179b17":"train = historico_consultora[[\"idconsultora\",\"201906\"]]\ntrain[\"campana\"]=201906\ntrain.columns=[\"idconsultora\",\"flagpasopedido\",\"campana\"]\ntrain = train[[\"campana\",\"idconsultora\",\"flagpasopedido\"]]","22a4fc02":"train.head(3)","c0879dcd":"train.shape","411ce165":"test = predecir","51143cbd":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"pasopedido\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","105da79d":"for i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"pasopedido\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","ccd09e63":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagactiva\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())","ab80ee09":"historico_consultora=historico_consultora.fillna(0)\nhistorico_consultora.head(5)","d008c4aa":"predecir = pd.read_csv(\"..\/input\/datathon-belcorp-prueba\/predict_submission.csv\")\npredecir['campana']=201907\npredecir = predecir[['campana','idconsultora']]","5a8fe62c":"historico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\nhistorico_predecir.shape","e75b3ed7":"historico_predecir.head(3)","8bd218a8":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-1):(n)])\n  train[\"activa\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","be7a74d4":"for i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"activa\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","1b2b516c":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagpasopedidocuidadopersonal\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())","fda9d7cc":"historico_consultora=historico_consultora.fillna(0)\nhistorico_consultora.head(3)","fb8e3ce2":"predecir = pd.read_csv(\"..\/input\/datathon-belcorp-prueba\/predict_submission.csv\")\npredecir['campana']=201907\npredecir = predecir[['campana','idconsultora']]","f5db2837":"historico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\nhistorico_predecir.shape","260060f1":"historico_predecir.head(3)","52a1994d":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"cuidadopersonal\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","d772060a":"for i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"cuidadopersonal\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","a19db915":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagpasopedidomaquillaje\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())","35969aa4":"historico_consultora=historico_consultora.fillna(0)\nhistorico_consultora.head(3)","c690b1ee":"historico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\nhistorico_predecir.shape","47b9f31d":"historico_predecir.head(3)","0e11d778":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"maquillaje\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","04a32aeb":"for i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"maquillaje\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","e6cee196":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagpasopedidotratamientocorporal\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())","eba23d00":"historico_consultora=historico_consultora.fillna(0)\nhistorico_consultora.head(3)","b1ef04de":"historico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\nhistorico_predecir.shape","6fa7f91b":"historico_predecir.head(3)","ae76c071":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"tratamientocorporal\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"tratamientocorporal\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n","f2e31cac":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagpasopedidotratamientofacial\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)","e7fd82dd":"historico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\nhistorico_predecir.shape","04e865d2":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"tratamientofacial\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"tratamientofacial\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","17600532":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagpedidoanulado\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)\nhistorico_consultora.head(3)","ebf13c8f":"historico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\nhistorico_predecir.head(3)","6e3b7a52":"train[\"anuladoUM\"] = historico_consultora[\"201905\"]\ntrain[\"anulado3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"anulado6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"anulado9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"anulado12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"anuladoUM\"] = historico_predecir[\"201906\"]\ntest[\"anulado3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"anulado6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"anulado9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"anulado12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","d4b7a6b3":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagpasopedidofragancias\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)","b15f7640":"historico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","533b73b2":"historico_consultora.shape[1],historico_predecir.shape[1]","bdd88b6f":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"fragancias\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"fragancias\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","e95c4291":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagpasopedidoweb\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","ba11733e":"historico_consultora.shape, historico_predecir.shape","4d236c10":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"pedidoweb\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"pedidoweb\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","55d6076e":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"cantidadlogueos\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","bb199c42":"historico_consultora.shape, historico_predecir.shape","d7971ec3":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"logueos\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"logueos\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","13a3cef3":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagdispositivo\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","fb29ce3f":"train[\"flgdispositivoUM\"] = historico_consultora[\"201905\"]\ntrain[\"flgdispositivo2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"flgdispositivo3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"flgdispositivo6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"flgdispositivo9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"flgdispositivo12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"flgdispositivoUM\"] = historico_predecir[\"201906\"]\ntest[\"flgdispositivo2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"flgdispositivo3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"flgdispositivo6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"flgdispositivo9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"flgdispositivo12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","9d13ef7a":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagdigital\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","d0410f9d":"train[\"flgdigitalUM\"] = historico_consultora[\"201905\"]\ntrain[\"flgdigital2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"flgdigital3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"flgdigital6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"flgdigital9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"flgdigital12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"flgdigitalUM\"] = historico_predecir[\"201906\"]\ntest[\"flgdigital2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"flgdigital3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"flgdigital6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"flgdigital9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"flgdigital12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","f8b4115c":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagofertadigital\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","2bd5ea9d":"historico_consultora.shape[1],historico_predecir.shape[1]","7db03899":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"flgofertadigital\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"flgofertadigital\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","8774c9c0":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"flagsuscripcion\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora = historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","d86368e9":"historico_consultora.shape[1],historico_predecir.shape[1]","8d39db0c":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"suscripcion\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"suscripcion\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","34e7ed68":"train.shape,test.shape","bb339a2c":"sns.catplot(y=\"codigofactura\", kind=\"count\",palette=\"pastel\", edgecolor=\".6\",data=campana_consultora,)","f7e681c4":"campana_consultora[\"codigofactura_web\"]=0\ncampana_consultora[\"codigofactura_web\"].loc[campana_consultora[\"codigofactura\"]==\"WEB\"]=1\n\ncampana_consultora[\"codigofactura_app\"]=0\ncampana_consultora[\"codigofactura_app\"].loc[campana_consultora[\"codigofactura\"]==\"APP\"]=1\n\ncampana_consultora[\"codigofactura_apw\"]=0\ncampana_consultora[\"codigofactura_apw\"].loc[campana_consultora[\"codigofactura\"]==\"APW\"]=1\n\ncampana_consultora[\"codigofactura_otros\"]=0\ncampana_consultora[\"codigofactura_otros\"].loc[~campana_consultora[\"codigofactura\"].isin([\"WEB\",\"APP\",\"APW\"])]=1","725f77b7":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"codigofactura_web\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","0722ec5a":"historico_consultora.shape[1],historico_predecir.shape[1]","3a2aea7e":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"factura_web\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"factura_web\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","bb0c10df":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"codigofactura_app\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","4faac247":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"factura_app\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"factura_app\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","f0a2e4c6":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"codigofactura_apw\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","7353044f":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"factura_apw\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"factura_apw\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","a7829e91":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"codigofactura_otros\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","4a8f739d":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"factura_otros\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"factura_otros\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","88424970":"sns.catplot(y=\"evaluacion_nuevas\", kind=\"count\",palette=\"pastel\", edgecolor=\".6\",data=campana_consultora,)","84e7d448":"campana_consultora[\"evaluacion_nuevas_EST\"]=0\ncampana_consultora[\"evaluacion_nuevas_EST\"].loc[campana_consultora[\"evaluacion_nuevas\"]==\"Est\"]=1\n\ncampana_consultora[\"evaluacion_nuevas_C_1d1\"]=0\ncampana_consultora[\"evaluacion_nuevas_C_1d1\"].loc[campana_consultora[\"evaluacion_nuevas\"]==\"C_1d1\"]=1\n\ncampana_consultora[\"evaluacion_nuevas_C_2d2\"]=0\ncampana_consultora[\"evaluacion_nuevas_C_2d2\"].loc[campana_consultora[\"evaluacion_nuevas\"]==\"C_2d2\"]=1\n\ncampana_consultora[\"evaluacion_nuevas_C_3d3\"]=0\ncampana_consultora[\"evaluacion_nuevas_C_3d3\"].loc[campana_consultora[\"evaluacion_nuevas\"]==\"C_3d3\"]=1\n\ncampana_consultora[\"evaluacion_nuevas_otros\"]=0\ncampana_consultora[\"evaluacion_nuevas_otros\"].loc[~campana_consultora[\"evaluacion_nuevas\"].isin([\"Est\",\"C_1d1\",\"C_2d2\",\"C_3d3\"])]=1","470bcc64":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"evaluacion_nuevas_EST\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","68f82baa":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"evaluacion_nuevas_EST\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"evaluacion_nuevas_EST\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","290ce55a":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"evaluacion_nuevas_C_1d1\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","19c7d41e":"for i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"evaluacion_nuevas_C_1d1\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"evaluacion_nuevas_C_1d1\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","16ccd806":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"evaluacion_nuevas_C_2d2\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\nfor i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"evaluacion_nuevas_C_2d2\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"evaluacion_nuevas_C_2d2\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","24b2a1fb":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"evaluacion_nuevas_C_3d3\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\nfor i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"evaluacion_nuevas_C_3d3\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"evaluacion_nuevas_C_3d3\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","8d9ca8da":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"evaluacion_nuevas_otros\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\nfor i in range(15):\n  n=historico_consultora.shape[1]\n  auxi = pd.DataFrame(historico_consultora.iloc[:,(n-i-2):(n-1)])\n  train[\"evaluacion_nuevas_otros\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)\n\nfor i in range(15):\n  n=historico_predecir.shape[1]\n  auxi = pd.DataFrame(historico_predecir.iloc[:,(n-i-1):(n)])\n  test[\"evaluacion_nuevas_otros\"+ str(i+1)+\"UM\"] = auxi.sum(axis=1)","4827c40f":"sns.catplot(y=\"segmentacion\", kind=\"count\",palette=\"pastel\", edgecolor=\".6\",data=campana_consultora,)","76a9f97a":"campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"segmentacion\").head(3)","ab1801d1":"mapping = {\"Nuevas\": 0, \"Nivel7\": 1, \"Nivel6\": 2, \"Nivel5\": 3, \"Nivel4\": 4, \"Nivel3\": 5, \"Nivel2\": 6, \"Nivel1\": 7, \"Tops\": 8}\ncampana_consultora[\"segmentacion\"] = campana_consultora[\"segmentacion\"].map(mapping)","9f60e944":"campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"segmentacion\").head(3)","a8dabf23":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"segmentacion\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","69a3e3bc":"train[\"segmentacionUM\"] = historico_consultora[\"201905\"]\ntrain[\"segmentacion2UM\"] = np.max(historico_consultora[[\"201905\",\"201904\"]],axis=1)\ntrain[\"segmentacion3UM\"] = np.max(historico_consultora[[\"201905\",\"201904\",\"201903\"]],axis=1)\ntrain[\"segmentacion6UM\"] = np.max(historico_consultora[[\"201905\",\"201904\",\"201903\",\"201902\",\"201901\",\"201818\"]],axis=1)\ntrain[\"segmentacion9UM\"] = np.max(historico_consultora[[\"201905\",\"201904\",\"201903\",\"201902\",\"201901\",\"201818\",\"201817\",\"201816\",\"201815\"]],axis=1)\ntrain[\"segmentacion12UM\"] = np.max(historico_consultora[[\"201905\",\"201904\",\"201903\",\"201902\",\"201901\",\"201818\",\"201817\",\"201816\",\"201815\",\"201814\",\"201814\",\"201813\"]],axis=1)\n\ntest[\"segmentacionUM\"] = historico_predecir[\"201905\"]\ntest[\"segmentacion2UM\"] = np.max(historico_predecir[[\"201905\",\"201904\"]],axis=1)\ntest[\"segmentacion3UM\"] = np.max(historico_predecir[[\"201905\",\"201904\",\"201903\"]],axis=1)\ntest[\"segmentacion6UM\"] = np.max(historico_predecir[[\"201905\",\"201904\",\"201903\",\"201902\",\"201901\",\"201818\"]],axis=1)\ntest[\"segmentacion9UM\"] = np.max(historico_predecir[[\"201905\",\"201904\",\"201903\",\"201902\",\"201901\",\"201818\",\"201817\",\"201816\",\"201815\"]],axis=1)\ntest[\"segmentacion12UM\"] = np.max(historico_predecir[[\"201905\",\"201904\",\"201903\",\"201902\",\"201901\",\"201818\",\"201817\",\"201816\",\"201815\",\"201814\",\"201814\",\"201813\"]],axis=1)","0253621b":"campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"geografia\").head(3)","7b6f0c7e":"sns.catplot(y=\"geografia\", kind=\"count\",palette=\"pastel\", edgecolor=\".6\",data=campana_consultora,)","1e00d9db":"historico_consultora = campana_consultora.pivot(index=\"idconsultora\",columns=\"campana\",values=\"geografia\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","ff603f92":"train[\"geografiaUM\"] = historico_consultora[\"201818\"]\ntest[\"geografiaUM\"] = historico_predecir[\"201818\"]","9949c100":"train = pd.merge(train,maestro_consultora,on='idconsultora',how='left')","64cd5175":"train.shape","07dd0e07":"test = pd.merge(test,maestro_consultora,on='idconsultora',how='left')","e1737f73":"test.shape","ccef6ef8":"train[\"ncapanaingreso\"] = train[\"campana\"]-train[\"campanaingreso\"]\ntest[\"ncapanaingreso\"] = test[\"campana\"]-test[\"campanaingreso\"]","f9cfcadb":"train[\"ncapanaingreso2\"] = train[\"campanaultimopedido\"]-train[\"campanaingreso\"]\ntest[\"ncapanaingreso2\"] = test[\"campanaultimopedido\"]-test[\"campanaingreso\"]","c783f5c4":"train[\"isnueva\"]=0\ntrain[\"isnueva\"].loc[train[\"campanaprimerpedido\"]==201906]=1\n\ntest[\"isnueva\"]=0\ntest[\"isnueva\"].loc[test[\"campanaprimerpedido\"]==201907]=1","057091da":"train[\"numcampanaultimopedido\"] = train[\"campana\"]-train[\"campanaultimopedido\"]\ntest[\"numcampanaultimopedido\"] = test[\"campana\"]-test[\"campanaultimopedido\"]\n\ntrain[\"isultpedido\"]=0\ntrain[\"isultpedido\"].loc[train[\"campanaultimopedido\"]==201906]=1\n\ntest[\"isultpedido\"]=0\ntest[\"isultpedido\"].loc[test[\"campanaultimopedido\"]==201907]=1","7c611ca0":"train[\"correovalidad\"]=1\ntrain[\"correovalidad\"].loc[pd.isna(train[\"flagcorreovalidad\"])==True]=0\n\ntest[\"correovalidad\"]=1\ntest[\"correovalidad\"].loc[pd.isna(test[\"flagcorreovalidad\"])==True]=0","83cfae06":"train = train.drop([\"campanaingreso\",\"campanaprimerpedido\",\"campanaultimopedido\",\"flagcorreovalidad\"],axis=1)\ntest = test.drop([\"campanaingreso\",\"campanaprimerpedido\",\"campanaultimopedido\",\"flagcorreovalidad\"],axis=1)","15f016cd":"venta = pd.read_csv(\"..\/input\/datathon-belcorp-prueba\/dtt_fvta_cl.csv\")","87d3bfb3":"venta.shape","a3aa253f":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"descuento\", aggfunc=\"mean\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","4d653d09":"historico_consultora.shape,historico_predecir.shape","b15a8023":"train[\"descuentomeanUM\"] = historico_consultora[\"201905\"]\ntrain[\"descuentomean2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"descuentomean3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"descuentomean4UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])\ntrain[\"descuentomean6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"descuentomean9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"descuentomean12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"descuentomeanUM\"] = historico_predecir[\"201906\"]\ntest[\"descuentomean2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"descuentomean3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"descuentomean4UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])\ntest[\"descuentomean6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"descuentomean9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"descuentomean12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","0698e2c3":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"descuento\", aggfunc=\"min\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')","7d07b64c":"train[\"descuentominUM\"] = historico_consultora[\"201905\"]\ntrain[\"descuentomin3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"descuentomin6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"descuentomin9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"descuentomin12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"descuentominUM\"] = historico_predecir[\"201906\"]\ntest[\"descuentomin3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"descuentomin6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"descuentomin9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"descuentomin12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","d7a9366f":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"descuento\", aggfunc=\"max\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"descuentomaxUM\"] = historico_consultora[\"201905\"]\ntrain[\"descuentomax3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"descuentomax6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"descuentomax9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"descuentomax12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"descuentomaxUM\"] = historico_predecir[\"201906\"]\ntest[\"descuentomax3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"descuentomax6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"descuentomax9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"descuentomax12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","8ed04970":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"ahorro\", aggfunc=\"mean\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"ahorromeanUM\"] = historico_consultora[\"201905\"]\ntrain[\"ahorromean2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"ahorromean3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"ahorromean6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"ahorromean9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"ahorromean12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"ahorromeanUM\"] = historico_predecir[\"201906\"]\ntest[\"ahorromean2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"ahorromean3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"ahorromean6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"ahorromean9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"ahorromean12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","15f4c056":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"ahorro\", aggfunc=\"min\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"ahorrominUM\"] = historico_consultora[\"201905\"]\ntrain[\"ahorromin3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"ahorromin6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"ahorromin9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"ahorromin12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"ahorrominUM\"] = historico_predecir[\"201906\"]\ntest[\"ahorromin3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"ahorromin6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"ahorromin9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"ahorromin12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","a600b113":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"ahorro\", aggfunc=\"max\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"ahorromaxUM\"] = historico_consultora[\"201905\"]\ntrain[\"ahorromax3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"ahorromax6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"ahorromax9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"ahorromax12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"ahorromaxUM\"] = historico_predecir[\"201906\"]\ntest[\"ahorromax3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"ahorromax6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"ahorromax9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"ahorromax12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","c734ad7d":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"preciocatalogo\", aggfunc=\"mean\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"preciocatalogomeanUM\"] = historico_consultora[\"201905\"]\ntrain[\"preciocatalogomean2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"preciocatalogomean3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"preciocatalogomean6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"preciocatalogomean9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"preciocatalogomean12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"preciocatalogomeanUM\"] = historico_predecir[\"201906\"]\ntest[\"preciocatalogomean2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"preciocatalogomean3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"preciocatalogomean6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"preciocatalogomean9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"preciocatalogomean12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","62883017":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"preciocatalogo\", aggfunc=\"min\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"preciocatalogominUM\"] = historico_consultora[\"201905\"]\ntrain[\"preciocatalogomin3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"preciocatalogomin6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"preciocatalogomin9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"preciocatalogomin12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"preciocatalogominUM\"] = historico_predecir[\"201906\"]\ntest[\"preciocatalogomin3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"preciocatalogomin6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"preciocatalogomin9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"preciocatalogomin12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","c523a1eb":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"preciocatalogo\", aggfunc=\"max\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"preciocatalogomaxUM\"] = historico_consultora[\"201905\"]\ntrain[\"preciocatalogomax3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"preciocatalogomax6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"preciocatalogomax9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"preciocatalogomax12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"preciocatalogomaxUM\"] = historico_predecir[\"201906\"]\ntest[\"preciocatalogomax3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"preciocatalogomax6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"preciocatalogomax9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"preciocatalogomax12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","6c3fab0a":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realvtamnneto\", aggfunc=\"mean\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realvtamnnetomeanUM\"] = historico_consultora[\"201905\"]\ntrain[\"realvtamnnetomean2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"realvtamnnetomean3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realvtamnnetomean6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realvtamnnetomean9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realvtamnnetomean12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realvtamnnetomeanUM\"] = historico_predecir[\"201906\"]\ntest[\"realvtamnnetomean2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"realvtamnnetomean3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realvtamnnetomean6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realvtamnnetomean9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realvtamnnetomean12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","92e37ba8":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realvtamnneto\", aggfunc=\"min\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realvtamnnetominUM\"] = historico_consultora[\"201905\"]\ntrain[\"realvtamnnetomin3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realvtamnnetomin6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realvtamnnetomin9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realvtamnnetomin12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realvtamnnetominUM\"] = historico_predecir[\"201906\"]\ntest[\"realvtamnnetomin3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realvtamnnetomin6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realvtamnnetomin9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realvtamnnetomin12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","304689c3":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realvtamnneto\", aggfunc=\"max\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realvtamnnetomaxUM\"] = historico_consultora[\"201905\"]\ntrain[\"realvtamnnetomax3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realvtamnnetomax6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realvtamnnetomax9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realvtamnnetomax12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realvtamnnetomaxUM\"] = historico_predecir[\"201906\"]\ntest[\"realvtamnnetomax3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realvtamnnetomax6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realvtamnnetomax9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realvtamnnetomax12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","5b28b3a4":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realuuvendidas\", aggfunc=\"sum\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realuuvendidassumUM\"] = historico_consultora[\"201905\"]\ntrain[\"realuuvendidassum2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"realuuvendidassum3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realuuvendidassum6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realuuvendidassum9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realuuvendidassum12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realuuvendidassumUM\"] = historico_predecir[\"201906\"]\ntest[\"realuuvendidassum2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"realuuvendidassum3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realuuvendidassum6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realuuvendidassum9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realuuvendidassum12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","710da2c6":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realuufaltantes\", aggfunc=\"sum\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realuufaltantessumUM\"] = historico_consultora[\"201905\"]\ntrain[\"realuufaltantessum2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"realuufaltantessum3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realuufaltantessum6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realuufaltantessum9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realuufaltantessum12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realuufaltantessumUM\"] = historico_predecir[\"201906\"]\ntest[\"realuufaltantessum2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"realuufaltantessum3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realuufaltantessum6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realuufaltantessum9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realuufaltantessum12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","1811619f":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realuudevueltas\", aggfunc=\"sum\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realuudevueltassumUM\"] = historico_consultora[\"201905\"]\ntrain[\"realuudevueltassum2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"realuudevueltassum3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realuudevueltassum6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realuudevueltassum9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realuudevueltassum12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realuudevueltassumUM\"] = historico_predecir[\"201906\"]\ntest[\"realuudevueltassum2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"realuudevueltassum3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realuudevueltassum6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realuudevueltassum9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realuudevueltassum12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","55ed6074":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realuuanuladas\", aggfunc=\"sum\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realuuanuladassumUM\"] = historico_consultora[\"201905\"]\ntrain[\"realuuanuladassum2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"realuuanuladassum3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realuuanuladassum6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realuuanuladassum9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realuuanuladassum12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realuuanuladassumUM\"] = historico_predecir[\"201906\"]\ntest[\"realuuanuladassum2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"realuuanuladassum3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realuuanuladassum6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realuuanuladassum9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realuuanuladassum12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","86897a78":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realdevmnneto\", aggfunc=\"mean\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realdevmnnetomeanUM\"] = historico_consultora[\"201905\"]\ntrain[\"realdevmnnetomean2UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])\ntrain[\"realdevmnnetomean3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realdevmnnetomean6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realdevmnnetomean9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realdevmnnetomean12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realdevmnnetomeanUM\"] = historico_predecir[\"201906\"]\ntest[\"realdevmnnetomean2UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])\ntest[\"realdevmnnetomean3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realdevmnnetomean6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realdevmnnetomean9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realdevmnnetomean12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","a55faf63":"historico_consultora = venta.pivot_table(index=\"idconsultora\",columns=\"campana\",values=\"realanulmnneto\", aggfunc=\"mean\")\nhistorico_consultora = pd.DataFrame(historico_consultora.to_records())\nhistorico_consultora=historico_consultora.fillna(0)\n\nhistorico_predecir = pd.merge(predecir,historico_consultora,on='idconsultora',how='left')\n\ntrain[\"realanulmnnetomeanUM\"] = historico_consultora[\"201905\"]\ntrain[\"realanulmnnetomean3UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])\ntrain[\"realanulmnnetomean6UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])\ntrain[\"realanulmnnetomean9UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])\ntrain[\"realanulmnnetomean12UM\"] = pd.to_numeric(historico_consultora[\"201905\"])+ pd.to_numeric(historico_consultora[\"201904\"])+pd.to_numeric(historico_consultora[\"201903\"])+pd.to_numeric(historico_consultora[\"201902\"])+pd.to_numeric(historico_consultora[\"201901\"])+pd.to_numeric(historico_consultora[\"201818\"])+pd.to_numeric(historico_consultora[\"201817\"])+pd.to_numeric(historico_consultora[\"201816\"])+pd.to_numeric(historico_consultora[\"201815\"])+pd.to_numeric(historico_consultora[\"201814\"])+pd.to_numeric(historico_consultora[\"201813\"])+pd.to_numeric(historico_consultora[\"201812\"])\n\ntest[\"realanulmnnetomeanUM\"] = historico_predecir[\"201906\"]\ntest[\"realanulmnnetomean3UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])\ntest[\"realanulmnnetomean6UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])\ntest[\"realanulmnnetomean9UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])\ntest[\"realanulmnnetomean12UM\"] = pd.to_numeric(historico_predecir[\"201906\"])+ pd.to_numeric(historico_predecir[\"201905\"])+pd.to_numeric(historico_predecir[\"201904\"])+pd.to_numeric(historico_predecir[\"201903\"])+pd.to_numeric(historico_predecir[\"201902\"])+pd.to_numeric(historico_predecir[\"201901\"])+pd.to_numeric(historico_predecir[\"201818\"])+pd.to_numeric(historico_predecir[\"201817\"])+pd.to_numeric(historico_predecir[\"201816\"])+pd.to_numeric(historico_predecir[\"201815\"])+pd.to_numeric(historico_predecir[\"201814\"])+pd.to_numeric(historico_predecir[\"201813\"])","a060d91c":"train.shape,test.shape","aebdfbeb":"#detalle_venta = pd.read_csv(\"Matriz_road_cruce.csv\")","862f963c":"#detalle_venta_train=detalle_venta[detalle_venta['campana']==201906]\n#detalle_venta_train=detalle_venta_train.drop(['campana'],axis=1)\n#detalle_venta_test=detalle_venta[detalle_venta['campana']==201907]\n#detalle_venta_test=detalle_venta_test.drop(['campana'],axis=1)\n#detalle_venta_train.head(5)","64004d3d":"#detalle_venta_train.shape,detalle_venta_test.shape","d03f49ed":"#train=pd.merge(train,detalle_venta_train,on='idconsultora',how='left')\n#test=pd.merge(test,detalle_venta_test,on='idconsultora',how='left')","6c3846b7":"#Columnas_con_missing(train)","4c2bf70a":"#train.factura_app12UM.unique","2984a6e4":"import lightgbm as lgb\nfrom sklearn import preprocessing\nimport gc\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.model_selection import KFold\nfrom sklearn.metrics import roc_auc_score","c05a200b":"features=[ x for x in train.columns if x not in ['campana','idconsultora','flagpasopedido']]\n\ncategorical=['estadocivil','geografiaUM']\n\ncat_ind=[features.index(x) for x in categorical if x in features]\n\ntarget='flagpasopedido'","63e59147":"for l in categorical:\n    le = preprocessing.LabelEncoder()\n    le.fit(list(train[l].dropna())+list(test[l].dropna()))\n    train.loc[~train[l].isnull(),l]=le.transform(train.loc[~train[l].isnull(),l])\n    test.loc[~test[l].isnull(),l]=le.transform(test.loc[~test[l].isnull(),l])","9a3565cc":"kf_previo=StratifiedKFold(n_splits=15,random_state=256,shuffle=True)\n\ni=1\n\nr=[]\n\nimportancias=pd.DataFrame()\n\nimportancias['variable']=features\n\nfor train_index,test_index in kf_previo.split(train,train[target]):\n\n    lgb_train = lgb.Dataset(train.loc[train_index,features].values,train.loc[train_index,target].values.ravel())\n    lgb_eval = lgb.Dataset(train.loc[test_index,features].values,train.loc[test_index,target].values.ravel(), reference=lgb_train)\n\n    params = {\n        'task': 'train',\n        'boosting_type': 'gbdt',\n        'objective': 'binary',\n        'metric': { 'auc'},\n        \"max_depth\":6,\n        \"num_leaves\":10,\n        'learning_rate': 0.1,\n    \"min_child_samples\": 100,\n        'feature_fraction': 0.5,\n     \"bagging_freq\":1,\n        'bagging_fraction': 0.9,\n        \"lambda_l1\":1,\n        \"lambda_l2\":1,\n       #\"scale_pos_weight\":30,\n\n        'verbose': 1    \n    }\n\n    lgbm3 = lgb.train(params,lgb_train,num_boost_round=13100,valid_sets=lgb_eval,early_stopping_rounds=50,verbose_eval=25,categorical_feature=cat_ind)\n    test[\"TARGET_FOLD\"+str(i)]=lgbm3.predict(test[features].values, num_iteration=lgbm3.best_iteration)\n \n    importancias['gain_'+str(i)]=lgbm3.feature_importance(importance_type=\"gain\")\n\n    \n    print (\"Fold_\"+str(i))\n    a= (roc_auc_score(train.loc[test_index,target],lgbm3.predict(train.loc[test_index,features].values, num_iteration=lgbm3.best_iteration)))\n    r.append(a)\n    print (a)\n    print (\"\")\n    \n    i=i+1\n\nprint (\"mean: \"+str(np.mean(np.array(r))))\nprint (\"std: \"+str(np.std(np.array(r))))","a65a40dd":"w=[x for x in importancias.columns if 'gain_' in x]\nimportancias['gain-avg']=importancias[w].mean(axis=1)\nimportancias=importancias.sort_values('gain-avg',ascending=False).reset_index(drop=True)","20d5b312":"importancias.head(10)","de50aafc":"(importancias['gain-avg']==0).value_counts()","74fcc661":"importancias['gain-avg'].describe()","a6c74192":"features_selected=importancias.loc[(importancias[\"gain-avg\"]>100),\"variable\"].to_list()\ncat_ind_selected=[features_selected.index(x) for x in categorical if x in features_selected]","1d2584a7":"len(features_selected)","795442c9":"train[target].value_counts()","cd410619":"kf_previo=StratifiedKFold(n_splits=15,random_state=256,shuffle=True)\n\ni=1\n\nr=[]\n\nimportancias_2=pd.DataFrame()\n\nimportancias_2['variable']=features_selected\n\n\nfor train_index,test_index in kf_previo.split(train,train[target]):\n\n    lgb_train = lgb.Dataset(train.loc[train_index,features_selected].values,train.loc[train_index,target].values.ravel())\n    lgb_eval = lgb.Dataset(train.loc[test_index,features_selected].values,train.loc[test_index,target].values.ravel(), reference=lgb_train)\n\n    params = {\n        'task': 'train',\n        'boosting_type': 'gbdt',\n        'objective': 'binary',\n        'metric': { 'auc'},\n        \"max_depth\":6,\n        \"num_leaves\":32,\n        'learning_rate': 0.05,\n    \"min_child_samples\": 150,\n        'feature_fraction': 0.5,\n     \"bagging_freq\":1,\n        'bagging_fraction': 0.95,\n        \"lambda_l1\":1,\n        \"lambda_l2\":1,\n       #\"scale_pos_weight\":30,\n\n        'verbose': 1    \n    }\n\n\n\n\n    lgbm3 = lgb.train(params,lgb_train,num_boost_round=13100,valid_sets=lgb_eval,early_stopping_rounds=50,verbose_eval=25,categorical_feature=cat_ind_selected)\n    test[\"TARGET_FOLD\"+str(i)]=lgbm3.predict(test[features_selected].values, num_iteration=lgbm3.best_iteration)\n    \n    importancias_2['gain_'+str(i)]=lgbm3.feature_importance(importance_type=\"gain\")\n\n    \n    print (\"Fold_\"+str(i))\n    a= (roc_auc_score(train.loc[test_index,target],lgbm3.predict(train.loc[test_index,features_selected].values, num_iteration=lgbm3.best_iteration)))\n    r.append(a)\n    print (a)\n    print (\"\")\n    \n    i=i+1\n\nprint (\"mean: \"+str(np.mean(np.array(r))))\nprint (\"std: \"+str(np.std(np.array(r))))","8eb2e435":"w=[x for x in importancias_2.columns if 'gain_' in x]\nimportancias_2['gain-avg']=importancias_2[w].mean(axis=1)\nimportancias_2=importancias_2.sort_values('gain-avg',ascending=False).reset_index(drop=True)","24f21ac3":"importancias_2.head(10)","2997958e":"w=[x for x in test.columns if 'FOLD' in x]\n\ntest['flagpasopedido']=test[w].max(axis=1)","85d4c287":"test[['idconsultora','flagpasopedido']].to_csv('mean2.csv',index=False)","add22a16":"#features=[ x for x in train.columns if x not in ['campana','idconsultora','flagpasopedido']]\n\n#categorical=['estadocivil','geografiaUM']\n\n#cat_ind=[features.index(x) for x in categorical if x in features]\n\n#target='flagpasopedido'","500c05de":"#for l in categorical:\n #   le = preprocessing.LabelEncoder()\n #   le.fit(list(train[l].dropna())+list(test[l].dropna()))\n\n    #train.loc[~train[l].isnull(),l]=le.transform(train.loc[~train[l].isnull(),l])\n\n    #test.loc[~test[l].isnull(),l]=le.transform(test.loc[~test[l].isnull(),l])","4720209c":"#train_df=train\n#test_df=test\n#full_vars = features\n#cat_vars = categorical\n\n#full_vars = features\n#target_var =\"flagpasopedido\"\n#train_x = train_df[full_vars].values\n#train_y = train_df[target_var].values\n#test_x = test_df[full_vars].values#\n\n#import copy\n#default_lgb_params = {}\n#default_lgb_params[\"learning_rate\"] = 0.1 \n#default_lgb_params[\"metric\"] = 'auc'\n#default_lgb_params[\"bagging_freq\"] = 1\n#default_lgb_params[\"seed\"] = 42\n#default_lgb_params[\"objective\"] = \"binary\"\n#default_lgb_params[\"boost_from_average\"] = \"false\"#\n\n#params_lgb_space = {}\n#params_lgb_space['feature_fraction'] = np.arange(0.1, 1, 0.1)\n#params_lgb_space['num_leaves'] = [2, 4, 8, 16, 32,64]  \n#params_lgb_space['max_depth'] = [3 ,4 ,5 ,6, -1,8]\n#params_lgb_space['min_gain_to_split'] = [0, 0.1, 0.3, 1, 1.5, 2, 3]\n#params_lgb_space['bagging_fraction'] = np.arange(0.1, 1, 0.1)\n#params_lgb_space['min_sum_hessian_in_leaf'] = [1, 5, 10, 30, 100]\n#params_lgb_space['lambda_l1'] = [0, 0.01, 0.1, 1, 5,10, 100, 300]\n#params_lgb_space['lambda_l2'] = [0, 0.01, 0.1, 1, 5,10, 100, 300]#\n\n#greater_is_better = True#\n\n#best_lgb_params = copy.copy(default_lgb_params)#\n#\n\n#for p in params_lgb_space: \n#    print (\"\\n Tuning parameter %s in %s\" % (p, params_lgb_space[p]))\n#    params = best_lgb_params\n#    scores = []    \n#    for v in params_lgb_space[p]: \n#        gc.collect()\n#        print ('\\n    %s: %s' % (p, v), end=\"\\n\")\n#        params[p] = v\n#        \n#        cv_results = lgb.cv(params, \n#                        lgb.Dataset(train_x, label=train_y), \n#                        stratified=True,\n#                        shuffle=True,\n#                        nfold=5,\n#                        num_boost_round=100000,\n#                        early_stopping_rounds=100,\n#                        verbose_eval=0)\n#        \n#        best_lgb_score = max(cv_results['auc-mean'])\n#        print ('Score: %f ' % (best_lgb_score))\n#        scores.append([v, best_lgb_score])#\n\n#    # best param value in the space\n#    best_param_value = sorted(scores, key=lambda x:x[1],reverse=greater_is_better)[0][0]\n#    best_param_score = sorted(scores, key=lambda x:x[1],reverse=greater_is_better)[0][1]\n#    best_lgb_params[p] = best_param_value\n#    print (\"Best %s is %s with a score of %f\" %(p, best_param_value, best_param_score))#\n\n#    \n#best_param_value = sorted(scores, key=lambda x:x[1],reverse=greater_is_better)[0][0]\n#best_param_score = sorted(scores, key=lambda x:x[1],reverse=greater_is_better)[0][1]\n#best_lgb_params[p] = best_param_value\n#print (\"Best %s is %s with a score of %f\" %(p, best_param_value, best_param_score))\n#print ('\\n Best manually tuned parameters:', best_lgb_params)   ","2f01a7a0":"#kf_previo=StratifiedKFold(n_splits=10,random_state=256,shuffle=True)#\n\n#i=1#\n\n#r=[]#\n\n#importancias=pd.DataFrame()#\n\n#importancias['variable']=features#\n\n#for train_index,test_index in kf_previo.split(train,train[target]):#\n\n#    lgb_train = lgb.Dataset(train.loc[train_index,features].values,train.loc[train_index,target].values.ravel())\n#    lgb_eval = lgb.Dataset(train.loc[test_index,features].values,train.loc[test_index,target].values.ravel(), reference=lgb_train)#\n\n#    params = {\n#        'task': 'train',\n#        'boosting_type': 'gbdt',\n#        'objective': 'binary',\n#        'metric': { 'auc'},\n#        \"max_depth\":3,\n#        \"num_leaves\":4,\n#        \"min_gain_to_split\":1,\n#        'learning_rate': 0.1,\n#        \"min_child_samples\": 100,\n#        'feature_fraction': 0.6,\n#        'min_sum_hessian_in_leaf':5,\n#        \"bagging_freq\":1,\n#        'bagging_fraction': 0.8,\n#        \"lambda_l1\":1,\n#        \"lambda_l2\":0.1,\n#       # \"scale_pos_weight\":30,#\n\n#        'verbose': 1    \n#    }#\n\n#    lgbm3 = lgb.train(params,lgb_train,num_boost_round=13100,valid_sets=lgb_eval,early_stopping_rounds=50,verbose_eval=25,categorical_feature=cat_ind)\n#    test[\"TARGET_FOLD\"+str(i)]=lgbm3.predict(test[features].values, num_iteration=lgbm3.best_iteration)\n# \n#    importancias['gain_'+str(i)]=lgbm3.feature_importance(importance_type=\"gain\")#\n\n#    \n#    print (\"Fold_\"+str(i))\n#    a= (roc_auc_score(train.loc[test_index,target],lgbm3.predict(train.loc[test_index,features].values, num_iteration=lgbm3.best_iteration)))\n#    r.append(a)\n#    print (a)\n#    print (\"\")\n#    \n#    i=i+1#\n\n#print (\"mean: \"+str(np.mean(np.array(r))))\n#print (\"std: \"+str(np.std(np.array(r))))","2b1e8bcd":"#w=[x for x in importancias.columns if 'gain_' in x]\n#importancias['gain-avg']=importancias[w].mean(axis=1)\n#importancias=importancias.sort_values('gain-avg',ascending=False).reset_index(drop=True)\n#importancias","11d30ab3":"#(importancias['gain-avg']==0).value_counts()","c71ff53f":"#importancias['gain-avg'].describe()","8443f664":"#features_selected=importancias.loc[(importancias[\"gain-avg\"]>100),\"variable\"].to_list()\n#cat_ind_selected=[features_selected.index(x) for x in categorical if x in features_selected]","b8994524":"#len(features_selected)","b3a7f773":"#kf_previo=StratifiedKFold(n_splits=30,random_state=256,shuffle=True)#\n\n#i=1#\n\n#r=[]#\n\n#importancias_2=pd.DataFrame()#\n\n#importancias_2['variable']=features_selected#\n#\n\n#for train_index,test_index in kf_previo.split(train,train[target]):#\n\n#    lgb_train = lgb.Dataset(train.loc[train_index,features_selected].values,train.loc[train_index,target].values.ravel())\n#    lgb_eval = lgb.Dataset(train.loc[test_index,features_selected].values,train.loc[test_index,target].values.ravel(), reference=lgb_train)#\n\n#    params = {\n#        'task': 'train',\n#        'boosting_type': 'gbdt',\n#        'objective': 'binary',\n#        'metric': { 'auc'},\n#        \"max_depth\":3,\n#        \"num_leaves\":4,\n#        \"min_gain_to_split\":1,\n#        'learning_rate': 0.1,\n#        \"min_child_samples\": 100,\n#        'feature_fraction': 0.6,\n#        'min_sum_hessian_in_leaf':5,\n#        \"bagging_freq\":1,\n#        'bagging_fraction': 0.8,\n#        \"lambda_l1\":1,\n#        \"lambda_l2\":0.1,\n#       # \"scale_pos_weight\":30,#\n\n#        'verbose': 1    \n#    }#\n#\n#\n#\n\n#    lgbm3 = lgb.train(params,lgb_train,num_boost_round=13100,valid_sets=lgb_eval,early_stopping_rounds=50,verbose_eval=25,categorical_feature=cat_ind_selected)\n#    test[\"TARGET_FOLD\"+str(i)]=lgbm3.predict(test[features_selected].values, num_iteration=lgbm3.best_iteration)\n#    \n#    importancias_2['gain_'+str(i)]=lgbm3.feature_importance(importance_type=\"gain\")#\n\n#    \n#    print (\"Fold_\"+str(i))\n#    a= (roc_auc_score(train.loc[test_index,target],lgbm3.predict(train.loc[test_index,features_selected].values, num_iteration=lgbm3.best_iteration)))\n#    r.append(a)\n#    print (a)\n#    print (\"\")\n#    \n#    i=i+1#\n\n#print (\"mean: \"+str(np.mean(np.array(r))))\n#print (\"std: \"+str(np.std(np.array(r))))","8bcbf959":"#w=[x for x in importancias_2.columns if 'gain_' in x]\n#importancias_2['gain-avg']=importancias_2[w].mean(axis=1)\n#importancias_2=importancias_2.sort_values('gain-avg',ascending=False).reset_index(drop=True)\n#importancias_2","f60d47a5":"#w=[x for x in test.columns if 'FOLD' in x]\n\n#test['flagpasopedido']=test[w].mean(axis=1)","2ba8ac80":"#test[['idconsultora','flagpasopedido']].to_csv('mean_tune.csv',index=False)","fe79b3b6":"Construyamos variables UM hasta U15M tanto para train y test (**OFERTADIGITAL**)","1caccb5d":"Construyamos variables UM U3M U6M U9M U12M tanto para train y test (**FLAGPEDIDOMAQUILLAJE**)","23b6b904":"Cruzemos esta nueva base con los clientes a predecir","17678974":"## **Formacion base TRAIN y TEST**","b109d4b3":"# **Modelamiento**","19f5182e":"### TUNEO LGBM","cfb43e72":"Construyamos variables UM U3M U6M U9M U12M tanto para train y test (**EVALUACIONES NUEVAS**)","253a6ab3":"### Base ***submission***","483de327":"Construyamos variables UM hasta U15M tanto para train y test (**CODIGO FACTURA**)","8962acf7":"Construyamos variables UM hasta U15M tanto para train y test (**FLAGPEDIDOTRATAMIENTOFACIAL**)","98d983b7":"Construyamos variables UM hasta U12M tanto para train y test (**FLAGPEDIDOPERSONAL**)","6283254f":"Construyamos variables UM hasta U15M tanto para train y test (**FLAGPEDIDOTRATAMIENTOCORPORAL**)","02e4e62a":"### **Union Detalle_Venta a TRAIN y TEST**","8bd85912":"Construyamos variables UM hasta U12M tanto para train y test (**FLAGPASOPEDIDO**)","9694fe3e":"Creando las agregaciones con estas nuevas variables","07fe4baf":"Construyamos variables UM U3M U6M U9M U12M tanto para train y test (**FLGSUSCRIPCION**)","fab40149":"Construyamos variables UM U3M U6M U9M U12M tanto para train y test (**GEOGRAFIA**)","eeca4d99":"# **Configuraci\u00f3n de entorno**","22126e96":"### Base ***maestro_consultora***","96230617":"Construyamos variables UM U3M U6M U9M U12M tanto para train y test (**SEGMENTACION**)","61860731":"Creando las agregaciones con estas nuevas variables","3f07960a":"Construyamos variables UM U3M U6M U9M U12M tanto para train y test (**FLAGDISPOSITIVO**)","b32fd825":"# **Carga de librer\u00edas**","40f0799d":"variable para train y test (**CAMPANA DE INGRESO**)","4ad69daa":"Construyamos variables UM hasta U12M tanto para train y test (**FLAGACTIVA**)","fefd535e":"Veamos el historico de los pedidos para los clientes en campana_consultora y los que tenemos que predecir","4d0e8914":"Tenemos 123771 consultoras donde hay algunas que piden cada campa\u00f1a por ello hay un max de 18.\nEn el siguiente codigo vemos que enfecto, solo una vez piden por campa\u00f1a","13b8996c":"Construyamos variables UM hasta U15M tanto para train y test (**CANTIDADLOGUEOS**)","2d41dd6c":"Construyamos variables UM hasta U15M tanto para train y test (**FLAGPEDIDOWEB**)","4fb44253":"### **Union Maestro_consultora a TRAIN y TEST**","4a355ce9":"En esta base campana_consultora se tiene data desde Julio2018 (201807) hasta Junio2019 (201906)","1cb14a95":"Construyamos variables UM U3M U6M U9M U12M tanto para train y test (**FLADIGITAL**)","fd0b7953":"Construyamos variables UM hasta U15M tanto para train y test (**FLAGFRAGANCIAS**)","a1c93ef8":"Construyamos variables UM U3M U6M U9M U12M tanto para train y test (**FLAGPEDIDOANULADO**)","49fbe31a":"# **Carga de datos**","2fb555d8":"### Base ***campana_consultora***"}}