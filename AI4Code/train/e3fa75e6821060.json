{"cell_type":{"d0192691":"code","4c7f924d":"code","b10c2cf3":"code","72406856":"code","004fe0e5":"code","02d670c7":"code","071e6721":"code","e60e4e3b":"code","0df49db1":"code","4a1ab9e0":"code","85b8cb04":"code","616fdaf9":"code","c14bdd56":"code","b9989629":"code","f4b8646b":"code","b850ff31":"code","a8729c23":"code","a67a80cc":"code","5c3de917":"code","6c58f6f3":"code","50eb80d4":"code","d64065f8":"code","c1787d6f":"code","dfd5c80c":"code","12135460":"code","da0e05e5":"code","3c40b966":"code","beb8cf4c":"code","24e27769":"code","874fb806":"code","2c393c3f":"code","c6a7c335":"code","055d21b0":"code","bdbbed70":"code","e9f262b6":"code","3c757784":"code","d7907c93":"code","df5fbce3":"code","a1e410a2":"code","d9626318":"code","30801b0a":"code","fa7eccd6":"code","186e5a45":"code","1a35a403":"code","10b6bed8":"code","9f5dabec":"code","360e066b":"code","02ff72d4":"code","2fe4cbd7":"code","1b683933":"code","a4eaefdf":"code","e4721740":"code","d36c0e2f":"code","babd5c62":"code","83edce62":"code","eb2363e0":"code","c18599ec":"code","13a0ad03":"code","35b81d8e":"code","6540874e":"code","c83a422f":"code","14ea2277":"code","08c7d74f":"code","2c2fce36":"code","759d869f":"code","a7afcf68":"code","84e13257":"code","cd0a7b58":"code","2187323e":"code","fd0b7a0f":"code","a32042f3":"code","bd36dc9f":"code","c588c99b":"code","b4b70503":"markdown","2bb839c2":"markdown","e666c421":"markdown","3e2a72ec":"markdown","d4f5b5d3":"markdown","05ab2730":"markdown","75232c15":"markdown","5ee333d8":"markdown","5f42b449":"markdown","17d9cbb6":"markdown","1651439d":"markdown","e39b9e3d":"markdown","c80f2b8c":"markdown","d1d02303":"markdown","d7a865a2":"markdown","fb5e1a44":"markdown","d21d270b":"markdown","9bf3833e":"markdown","ffa9120c":"markdown","1379655a":"markdown","528882eb":"markdown","8c2a83a1":"markdown","ce472d08":"markdown","70154399":"markdown","f9c3232f":"markdown","afa743e7":"markdown","8bea0065":"markdown","d2b95394":"markdown","c9d86087":"markdown","37850ad7":"markdown","50924a1c":"markdown","6661afd7":"markdown","b6c2e320":"markdown","9c17fd5d":"markdown","0de6e2b4":"markdown","ec7067ac":"markdown","1177b370":"markdown","32b95618":"markdown","1aa18c7b":"markdown","65a4f038":"markdown","452d1308":"markdown","43b4436d":"markdown","55a9e597":"markdown","f4844d03":"markdown","e0842571":"markdown","049fab5e":"markdown","fcad9e9d":"markdown","dbccf27c":"markdown","a8dcd967":"markdown","cacbec24":"markdown","23c10e96":"markdown","5af5fae5":"markdown","db3e0c63":"markdown","ac4fe1f5":"markdown","c8c3d06e":"markdown","cd891426":"markdown","3786f0d9":"markdown","5a98f369":"markdown","5b249082":"markdown","5e141d63":"markdown","e0ab238f":"markdown","42d37f5c":"markdown","de48f133":"markdown"},"source":{"d0192691":"# importing required modules\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n!pip install lifelines\nfrom lifelines import KaplanMeierFitter","4c7f924d":"df = pd.read_csv('..\/input\/ncctg-lung-cancer-data\/cancer.csv')\ndf.head()","b10c2cf3":"df.shape","72406856":"df.info()","004fe0e5":"## checking null values\ndf.isnull().sum()","02d670c7":"# Looking at the rows with null values\ndf[df.isnull().any(axis=1)]","071e6721":"df.drop(['Unnamed: 0', 'inst'], axis=1, inplace=True)","e60e4e3b":"# dataframe after dropping the above two attributes:\ndf.head()","0df49db1":"df.loc[df['status'] == 1, 'dead'] = 0\ndf.loc[df['status'] == 2, 'dead'] = 1","4a1ab9e0":"df.head()","85b8cb04":"durations = df['time']\nevent_obs = df['dead']\n\nkmf = KaplanMeierFitter()\nkmf.fit(durations, event_obs)","616fdaf9":"# looking at the event table\nevent_tab = kmf.event_table\nprint(\"Event Table:\")\nevent_tab.head(5)","c14bdd56":"# survival probability at time t=0:\n\n# theoretical checking of random t values (t = 0, t = 11, t = 13)\n\n# for t = 0 i.e., first row in event table\nfirst_row = event_tab.iloc[0,:]\nsurvival_at_0 = (first_row.at_risk - first_row.observed) \/ first_row.at_risk\nprint(\"Survival at time t = 0 :\", survival_at_0)\n\n# for t = 11 i.e., third row in even table\nthird_row = event_tab.iloc[2,:]\nsurvival_at_11 = (third_row.at_risk - third_row.observed) \/ third_row.at_risk\nprint(\"Survival at time t = 11:\", round(survival_at_11, 3))\n\n# for t = 13 i.e., fifth row in even table\nfifth_row = event_tab.iloc[4,:]\nsurvival_at_13 = (fifth_row.at_risk - fifth_row.observed) \/ fifth_row.at_risk\nprint(\"Survival at time t = 13:\", round(survival_at_13, 3))","b9989629":"# Using kmf's predict function to call out the survival probabilities \nkmf.predict(11)","f4b8646b":"# looking at all the KM estimates\nsurvival_ls = kmf.survival_function_\nsurvival_ls.head()","b850ff31":"# Plotting the event observed against the timeframe of reference\nkmf.plot(ci_show=False)\nplt.title(\"Kaplan-Meier Estimation\")\nplt.xlabel(\"Number of days\")\nplt.ylabel(\"Probability of survival\");","a8729c23":"# looking at the median number of survival days i.e., the number of days, on an average, 50% of the patients survived.\nprint(\"The median survival time:\", kmf.median_survival_time_, \"days.\")","a67a80cc":"kmf.confidence_interval_survival_function_","5c3de917":"confidence_surv_func = kmf.confidence_interval_survival_function_\n\nplt.plot(confidence_surv_func[\"KM_estimate_lower_0.95\"], label = \"Lower 95%\")\nplt.plot(confidence_surv_func[\"KM_estimate_upper_0.95\"], label = \"Upper 95%\")\nplt.title(\"Survival Function with Confidence Interval\")\nplt.xlabel(\"Number of days\")\nplt.ylabel(\"Survival Probability\")\nplt.legend();","6c58f6f3":"event_tab","50eb80d4":"# finally the cumulative density:\nkmf.cumulative_density_","d64065f8":"# plotting the graph for the cumulative density:\nkmf.plot_cumulative_density(ci_show=False)\nplt.title(\"Graph showing cumulative density\")\nplt.xlabel(\"Number of days\")\nplt.ylabel(\"Probability of a person's death\");","c1787d6f":"confidence_cumulative_density = kmf.confidence_interval_cumulative_density_\nconfidence_cumulative_density","dfd5c80c":"plt.plot(confidence_cumulative_density[\"KM_estimate_lower_0.95\"], label = \"Lower 95%\")\nplt.plot(confidence_cumulative_density[\"KM_estimate_upper_0.95\"], label = \"Upper 95%\");","12135460":"# Calculating the conditional median time to the event\n\nkmf.conditional_time_to_event_","da0e05e5":"# Conditional median time left for event:\n\nmedian_time_to_event = kmf.conditional_time_to_event_\n\nplt.plot(median_time_to_event, label = \"Median Time Remaining to Event\")\nplt.title(\"Median Time Remaining to Event\")\nplt.xlabel(\"Total Days\")\nplt.ylabel(\"Conditional Median time to Event\")\nplt.legend();","3c40b966":"# import the Nelson Aalen hazard model\nfrom lifelines import NelsonAalenFitter","beb8cf4c":"# object for NelsonAalenFitter\n\nnaf = NelsonAalenFitter()","24e27769":"# Fitting the data\n\nnaf.fit(df['time'], event_observed=df['dead'])","874fb806":"# finding the cumulative hazard:\n\nnaf.cumulative_hazard_","2c393c3f":"# plotting the cumulative hazard graph\n\nnaf.plot_cumulative_hazard(ci_show=False)\nplt.title(\"Cumulative Probability for Event of Interest (Death)\")\nplt.xlabel(\"Number of Days\")\nplt.ylabel(\"Cumulative Probability of subject's death\");","c6a7c335":"# creating a separate of the actual dataframe for this phase of analysis\ndf2 = df.copy()","055d21b0":"# renaming columns for simplicity\n\ndf2 = df2.rename(columns={'meal.cal': 'meal_cal', 'wt.loss': 'wt_loss', 'ph.karno': 'ph_karno', 'ph.ecog': 'ph_ecog', 'pat.karno': 'pat_karno'})","bdbbed70":"# creating 2 objects for the two groups:\n\nkmf_males = KaplanMeierFitter()\nkmf_females = KaplanMeierFitter()","e9f262b6":"# dividing the data into groups:\n\nmales = df2.query(\"sex == 1\")\nfemales = df2.query(\"sex == 2\")","3c757784":"# fitting the data into the models. \n\nkmf_males.fit(durations= males['time'], event_observed= males['dead'], label= \"Males\")\nkmf_females.fit(durations= females['time'], event_observed= females['dead'], label= \"Females\")","d7907c93":"# plotting the graph for the two groups:\n\nkmf_males.plot(ci_show = False)\nkmf_females.plot(ci_show = False)\n\nplt.xlabel(\"Days passed\")\nplt.ylabel(\"Survival Probability\")\nplt.title(\"Survival Probability of Males and Females\");","df5fbce3":"# dividing the age into different categories : 1 -> greater than 70 and 0 -> lesser than 70\ndf_age_cats = df2.copy()\n\ndf_age_cats.loc[df_age_cats['age'] >= 70, 'age_cat'] = 1\ndf_age_cats.loc[df_age_cats['age'] < 70, 'age_cat'] = 0","a1e410a2":"df_age_cats.head(2)","d9626318":"# dividing the data into groups:\n\nold = df_age_cats.query(\"age_cat == 1\")\nyoung = df_age_cats.query(\"age_cat == 0\")","30801b0a":"# creating kmf objects for the two groups and fitting the categorized data\n\nkmf_old = KaplanMeierFitter()\nkmf_young = KaplanMeierFitter()\n\nkmf_old.fit(durations= old['time'], event_observed= old['dead'], label= \"More than 70 years\")\nkmf_young.fit(durations= young['time'], event_observed= young['dead'], label= \"Less than 70 years\")","fa7eccd6":"# plotting the graph for the two groups:\n\nkmf_old.plot(ci_show = False)\nkmf_young.plot(ci_show = False)\n\nplt.xlabel(\"Days passed\")\nplt.ylabel(\"Survival Probability\")\nplt.title(\"Survival Probability of the different age groups\");","186e5a45":"# finding the average meal calories and plotting a historgram for reference\ndf_wt_loss = df2.copy()\n\ndf_wt_loss['wt_loss'].hist()\nplt.title(\"Distribution of the different weight loss\");","1a35a403":"print(\"The mean weight loss: \", df_wt_loss['wt_loss'].mean())","10b6bed8":"# dividing the age into 2 categories : \n# 1 -> people who were having a weight loss more than the average weight loss\n# 0 -> people who were having a below average weight loss.\n\ndf_wt_loss.loc[df_wt_loss['wt_loss'] > 9.83177570093458, 'wt_loss_cat'] = 1\ndf_wt_loss.loc[df_wt_loss['wt_loss'] <= 9.83177570093458, 'wt_loss_cat'] = 0","9f5dabec":"# dividing the data into groups:\n\nabove_avg_wt_loss = df_wt_loss.query(\"wt_loss_cat == 1\")\nbelow_avg_wt_loss = df_wt_loss.query(\"wt_loss_cat == 0\")","360e066b":"# creating kmf objects for the two groups and fitting the categorized data\n\nkmf_above_avg_wt_loss = KaplanMeierFitter()\nkmf_below_avg_wt_loss = KaplanMeierFitter()\n\nkmf_above_avg_wt_loss.fit(durations = above_avg_wt_loss['time'], event_observed = above_avg_wt_loss['dead'], label= \"Above average weight loss\")\nkmf_below_avg_wt_loss.fit(durations = below_avg_wt_loss['time'], event_observed = below_avg_wt_loss['dead'], label= \"Below average weight loss\")","02ff72d4":"# plotting the graph for the two groups:\n\nkmf_above_avg_wt_loss.plot(ci_show = False)\nkmf_below_avg_wt_loss.plot(ci_show = False)\n\nplt.xlabel(\"Days passed\")\nplt.ylabel(\"Survival Probability\")\nplt.title(\"Survival Probability according to the weights lost\");","2fe4cbd7":"df2['ph_karno'].hist();\nplt.title(\"Distribution of Physician Karnofsky Scores\");","1b683933":"# dividing the age into 2 categories : \n# 1 -> people who have a ph.karno >= 80 -- healthy\n# 0 -> people who have a ph.karno < 80 -- sick\ndf_pat_karno = df2.copy()\n\ndf_pat_karno.loc[df_pat_karno['pat_karno'] >= 80, 'pat_karno_cat'] = 1\ndf_pat_karno.loc[df_pat_karno['pat_karno'] < 80, 'pat_karno_cat'] = 0","a4eaefdf":"# dividing the data into groups:\n\npat_karno_healthy = df_pat_karno.query(\"pat_karno_cat == 1\")\npat_karno_sick = df_pat_karno.query(\"pat_karno_cat == 0\")","e4721740":"# creating kmf objects for the two groups and fitting the categorized data\n\nkmf_pat_karno_healthy = KaplanMeierFitter()\nkmf_pat_karno_sick = KaplanMeierFitter()\n\n\nkmf_pat_karno_healthy.fit(durations = pat_karno_healthy['time'], event_observed = pat_karno_healthy['dead'], label= \"Pat-Karno greater than 80 (Healthy)\")\nkmf_pat_karno_sick.fit(durations = pat_karno_sick['time'], event_observed = pat_karno_sick['dead'], label= \"Pat-Karno less than 80 (Sick)\")","d36c0e2f":"# plotting the graph for the two groups:\n\nkmf_pat_karno_healthy.plot(ci_show = False)\nkmf_pat_karno_sick.plot(ci_show = False)\n\nplt.xlabel(\"Days passed\")\nplt.ylabel(\"Survival Probability\")\nplt.title(\"Survival Probability according to the Patient Karnofsky scores\");","babd5c62":"df2['ph_karno'].hist();\nplt.title(\"Distribution of Physician Karnofsky Scores\");","83edce62":"# dividing the age into 2 categories : \n# 1 -> people who have a ph.karno >= 80 -- healthy\n# 0 -> people who have a ph.karno < 80 -- sick\ndf_ph_karno = df2.copy()\n\ndf_ph_karno.loc[df_ph_karno['ph_karno'] >= 80, 'ph_karno_cat'] = 1\ndf_ph_karno.loc[df_ph_karno['ph_karno'] < 80, 'ph_karno_cat'] = 0","eb2363e0":"# dividing the data into groups:\n\nph_karno_healthy = df_ph_karno.query(\"ph_karno_cat == 1\")\nph_karno_sick = df_ph_karno.query(\"ph_karno_cat == 0\")","c18599ec":"# creating kmf objects for the two groups and fitting the categorized data\n\nkmf_ph_karno_healthy = KaplanMeierFitter()\nkmf_ph_karno_sick = KaplanMeierFitter()\n\nkmf_ph_karno_healthy.fit(durations = ph_karno_healthy['time'], event_observed = ph_karno_healthy['dead'], label= \"Ph-Karno greater than 80 (Healthy)\")\nkmf_ph_karno_sick.fit(durations = ph_karno_sick['time'], event_observed = ph_karno_sick['dead'], label= \"Ph-Karno less than 80 (Sick)\")","13a0ad03":"# plotting the graph for the two groups:\n\nkmf_ph_karno_healthy.plot(ci_show = False)\nkmf_ph_karno_sick.plot(ci_show = False)\n\nplt.xlabel(\"Days passed\")\nplt.ylabel(\"Survival Probability\")\nplt.title(\"Survival Probability according to the Physician Karnofsky scores\");","35b81d8e":"df2['ph_ecog'].hist()\nplt.title(\"Distribution of Physician Ecog Scores\");","6540874e":"# dividing the age into 2 categories : \n# 1 -> people who have a ph.ecog <= 1 -- healthy\n# 0 -> people who have a ph.karno > 1 -- sick\ndf_ph_ecog = df2.copy()\n\ndf_ph_ecog.loc[df_ph_ecog['ph_ecog'] <= 1, 'ph_ecog_cat'] = 1\ndf_ph_ecog.loc[df_ph_ecog['ph_ecog'] > 1, 'ph_ecog_cat'] = 0","c83a422f":"# dividing the data into groups:\n\nph_ecog_health = df_ph_ecog.query(\"ph_ecog_cat == 1\")\nph_ecog_sick = df_ph_ecog.query(\"ph_ecog_cat == 0\")","14ea2277":"# creating kmf objects for the two groups and fitting the categorized data\n\nkmf_ph_ecog_healthy = KaplanMeierFitter()\nkmf_ph_ecog_sick = KaplanMeierFitter()\n\nkmf_ph_ecog_healthy.fit(durations = ph_ecog_health['time'], event_observed = ph_ecog_health['dead'], label= \"Ph-Ecog lesser than 1 (Healthy)\")\nkmf_ph_ecog_sick.fit(durations = ph_ecog_sick['time'], event_observed = ph_ecog_sick['dead'], label= \"Ph-Ecog greater than 1 (Sick)\")","08c7d74f":"# plotting the graph for the two groups:\n\nkmf_ph_ecog_healthy.plot(ci_show = False)\nkmf_ph_ecog_sick.plot(ci_show = False)\n\nplt.xlabel(\"Days passed\")\nplt.ylabel(\"Survival Probability\")\nplt.title(\"Survival Probability according to the Physician Ecog scores\");","2c2fce36":"# looking at the null values:\ndf.isnull().sum()","759d869f":"# running a base analysis first by removing all the null values without any imputation\n\n# temporary copy of the original dataframe\ndf_cph = df.copy()\n\n\ndropper_subset = list(df_cph.columns)\ndf_cph.dropna(subset=dropper_subset, inplace=True)\ndf_cph.drop(['status'], axis=1, inplace=True) # dropping the status column also as the dead column is sufficient","a7afcf68":"# sanity check on whether all null values were dropped\ndf_cph.isnull().sum()","84e13257":"# creating a cox-ph object and fitting the data to observe the summary\nfrom lifelines import CoxPHFitter","cd0a7b58":"cph = CoxPHFitter()\ncph.fit(df_cph, 'time', event_col = 'dead')","2187323e":"# Checking whether the assumptions for the cox-ph model is alright.\ncph.check_assumptions(df_cph)","fd0b7a0f":"# getting the summary from the CoxPHFitter\ncph.print_summary()","a32042f3":"df_cph.tail(50)","bd36dc9f":"# selecting 3 values from the actual observations\n\ndf_checker = df_cph.iloc[17:20, :]\ndf_checker","c588c99b":"cph.predict_survival_function(df_checker).plot()\nplt.title(\"Survival Probability of Subjects\");","b4b70503":"### Plotting the graph for survival probability with confidence interval","2bb839c2":"### Inference\n\n> From the graph above, it can be inferred that subjects with Patient Karnofsky score less than 80 have lower chances or survival.","e666c421":"### Median Survival Period (in days)","3e2a72ec":"### Basics of Cox-proportional Hazard Model\n\n\\begin{align}\nh(t) = h_0(t)  * e^{(b_1x_1 + b_2x_2 + ... + b_nx_n)}\n\\end{align}\n\nTaking natural logarithm of both sides:\n\\begin{align}\nln(h(t)) = ln(h_0(t))  * b_1x_1 + b_2x_2 + ... + b_nx_n\n\\end{align}\n\n$\nWhere,\\\\\nt                   = survival\\ time\\\\\nh(t)                = hazard\\ function\\\\\nx_1, x_2, ..., x_n  = covariates\\\\\nb_1, b_2, ..., b_n  = measures\\ of\\ impact\\ of\\ covariates\\ or\\ biases\\ for\\ each\\ covariates\\\\\n$\n","d4f5b5d3":"### 1. Dividing the population into two groups by the sex of the subject to check if the sex of a subject has any affect on the survival.","05ab2730":"### 5. Dividing the population into two groups the ph.karno scores","75232c15":"#### Cases when a person dies:\n\nThe probability that a person dies at time t = 0: \n\\begin{align}\n\\frac{observed}{at\\_risk}\n\\end{align}\n\nAt t = 0:\n\\begin{align}\nP_{die(0)} = \\frac{0}{228} = 0\n\\end{align}\n\nAt t = 5:\n\\begin{align}\nP_{die(5)} = \\frac{1}{228} = 0 = 0.004385\n\\end{align}\n\nAt t = 11:\n\\begin{align}\nP_{die(11)} = \\frac{3}{228} = 0 = 0.013157\n\\end{align}","5ee333d8":"## Overview of the Kaplan-Meier Estimation\n\nThe Kaplan-Meier estimator is a non-parametric statistical model used to estimate the survival function (probability of a person surviving) from the lifetime data. Here the KM model is being used to measure the fraction of patients living for a specific time after treatment or diagnosis of the cancer.\n\n\n#### Kaplan-Meier Equation\n\n\\begin{align}\nS(t_i) = S(t_{i-1}) * (1-\\frac{d_i}{n_i})\n\\end{align}\n\n\n### Example:\n> #### 1. Survival probability at t=1:\n\\begin{align}\nS(1) & = S(0) * (1-\\frac{d_1}{n_1}) = (1-\\frac{d_1}{n_1})\\\\\n\\end{align}\n\n> #### 2. Survival probability at t=2:\n\\begin{align}\nS(2) & = S(1) * (1-\\frac{d_2}{n_2})\\\\\n\\end{align}\n\n> #### 3. Survival probability at t=3:\n\\begin{align}\nS(3) & = S(2) * (1-\\frac{d_3}{n_3})\\\\\n\\end{align}","5f42b449":"#### Types of Models used in Survival Analysis\n\nThere are different types of ways in which we can perfrom survival analysis. Some of them might include: \n- Exponential Models (parametric model)\n- Kaplan Meier Models (non parametric model)\n- Cox Regression Models (semi parametric model)\n\n> In general terms, we tend to go for a parametric model whenever we have a distribution of data which follows a Gaussian distribution (normally distributed). On the other hand we tend to go for non-parametric models whenever we have data which does not assume any prior distribution pattern. \n\n> When the Survival Analysis is done to take a look at the survival curves of the subjects, the most common approach is to go for a Kaplan Meier Model. One of the disadvantages of the Kaplan Meier model though is that we cannot estimate hazards from the Kaplan Meier Curves. For that we need to apply any other model like the Nelson-Aalen model (for estimating the hazard rates) or the Cox-proportional model (for estimating the hazard ratios). In case, we are interested in understanding which features of a subject are playing significant roles in determining the survivability, then a cox-proportional model is a fairly popular choice.","17d9cbb6":"### Graph for the median time to an event","1651439d":"### Plotting the graph for cumulative density with a confidence interval","e39b9e3d":"#### Final inference from the above constructs:\nA doctor should try to reduct the value of ph.ecog in patients by providing more relevant medicines. ","c80f2b8c":"## Survival Analysis:\n\nSurvival analysis is a branch of statistics which is mainly used for understanding the expected duration or time till an event (which might include death, failure of a product etc.) will occur. \n\nExample:\n- *medical situation:* We are interested on knowing how long a subject suffering from a particular disease is meant to survive\n- *in case of mechanical systems:* We might be interested in knowing how long we have till a certain machine fails.","d1d02303":"### Investigation on a person dying:\n\n\\begin{align}\nS_t = \\frac{Number\\ of\\ subjects\\ who\\ died\\ at\\ time\\ t} {Number\\ of\\ subjects\\ at\\ risk\\ just\\ before\\ time\\ t}\n\\end{align}\n\nHere the denominator value is subjected at risk in the previous row.","d7a865a2":"### Cumulative Hazard Function:\n\\begin{align}\n\\hat{H}(t) = \\sum \\limits _{t_i <= t} \\frac{d_i}{n_i}\n\\end{align}\n\nWhere,\n\\begin{align}\n\\hat{H}(t) = Cumulative\\ hazard\\ probability\\\\\nd_i = The\\ number\\ of\\ events\\ at\\ time\\ t_i\\\\\nn_i = The\\ number\\ of\\ subjects\\ alive\\ at\\ time\\ t_i\\\\\n\\end{align}","fb5e1a44":"Here, we can see that the $p$-value for \"sex\" is 0.01 and the HR = 0.58\n> This indicates, a strong relationship between the patients' sex and the decreased risk of death. In general terms, considering the other covariates to be constat, a female (sex=2) patient has a higher chance of survival compared to a male patient.\n\nAgain, for the attribute \"ph.ecog\", the $p$-value is <0.005 and the HR is 2.08. \n> This indicates a strong relationship between the ph.ecog value and the increased risk of death in a patient. In generl terms, considering the other covariates to be constant, a higher value of \"ph.ecog\" is associated with more risk in survival. In this case, a patient with higher ph.ecog value has about 109% higher risk of death. ","d21d270b":"### Inference\n\n> From the graph above, it can be inferred that subjects having above average weight loss have lower chances of survival.","9bf3833e":"### Inference\n\n> From the above graph here, it can be inferred that the subjects having Physician Ecog scores less than 1 have lower chances of survival.","ffa9120c":"### The median time to an event:\n\nThe median survival time can help us get the *the amount of time remaining to an event*","1379655a":"### Significance of Cox-Ph model over the others:\n\n1. Here, the interest is mostly to find which covariate has more significance effect on the survivability of a subject. Hence, the more important point of interest is the hazard ration $e^{b_i}$. Hence, the application of the cox-proportional model seems like a better fit. Any other models could have been chosen if main point of interest was on the prediction of an individual surviving beyond a particular time.\n2. The Cox-Ph model allows the $HAZ$ to fluctuate along with time (it is a function of time). On the other hand, the Weibull model has the $HAZ$ which is proportional to time i.e., the $HAZ$ either increases or decreases with proportion to time.\n2. While other models are used for comparing only one variable at a time and operating on categorical variables like gender, status etc., the Cox-Ph model can be used for non-categorical variables like age, weight, height etc.","528882eb":"### Interpretation of the summary table:\n1. There are 168 observations\n2. There were 121 deaths which occured (events observed)\n3. coef -> gives the result of the model coefficients i.e., $b1, b2, b3, ...$ <br> \n    > In case of Cox-ph models, the model coefficients can be measures without measuring the baseline hazard function i.e., $h(t_0)$. In general terms, the baseline $HAZ$ is unspecified.\n4. exp(coef) -> The hazard ratio\n    > As a con of the Cox-Ph model, we cannot estimate the survival. If we are not getting an estimate of the intercept, then we cannot in turn measure the hazard, which again means we cannot measure the survival function. But we can measure the HR.<br>\n    > **Interpretation of the HR:** Considering the sex column, at a given instance of time, someone who has a sex is male, is 0.58 times times as likely to die as someone who is not male, adjusting for mismatch level. In terms of %, it can be interpreted as (1 - HR)% ie here it would be (1-0.58)% = 42%\n5. se(coef) -> The Standard Error in the observation of the coefficients\n6. coef lower 95% and coef upper 95% -> The 95% confidence interval, which suggests that we are 95% confident that the true value of model coefficients is within this interval.\n7. exp(coef) lower 95% and exp(coef) upper 95% -> The 95% confidence interval, which suggests that we are 95% confident that the true value of HR is within this interval.\n8. z-score -> value of wald test obtained as $\\frac{coef}{se(coef)}$\n9. Concordance -> Goodness of fit for survival analysis, which is the fraction or percentage of the pairs of observations which are concordant. (basically how well the model is performing wrt actual scenario). Higher the value of Concordance, better is the fit.\n10. AIC -> The *Akaike information criterion (AIC)* is an estimator of out-of-sample prediction error and thereby relative quality of statistical models for a given set of data. AIC estimates the relative amount of information lost by a given model: the less information a model loses, the higher the quality of that model.","8c2a83a1":"### Group Division:\n\nA ph.karno score of >= 80 will consider all patiens who are able to carry on normaly activity without special care. People with less than 80 are considered actually ill with people having >  40 scores as really sick.\n\nConsidering this, the two groups are made as:\n1. People with <= 80 pat.karno score\n2. People with > 80 pat.karno score","ce472d08":"### Survival Probability with confidence intervals","70154399":"# Comparison of the different groups of the attributes using the Kaplan Meier Curve","f9c3232f":"### Overview of the dataset\n#### Looking at the shape, features, data types","afa743e7":"### Finding the number of days a person was alive before they died.","8bea0065":"### Conclusion:\n\nFrom the above graph, it can be seen that the subject 28 has the highest chances of survival and subject 27 has the lowest chances of survival. Looking into the ph.ecog values in the table above, it can be seen that subject 28 has a low ph.ecog value (1.0) compared to subject 27 (3.0).\n> This concords with the fact that *higher the ph.ecog value lesser are the chances of survival*.","d2b95394":"### Group Division:\n\nA ph.karno score of >= 80 will consider all patiens who are able to carry on normaly activity without special care. People with less than 80 are considered actually ill with people having >  40 scores as really sick.\n\nConsidering this, the two groups are made as:\n1. People with <= 80 ph.karno score\n2. People with > 80 ph.karno score","c9d86087":"From the above event table the survival probability which was given as:\n\\begin{align}\nS_t = \\frac{Number\\ of\\ subjects\\ at\\ risk\\ at\\ the\\ start - Number\\ of\\ subjects\\ that\\ died} {Number\\ of\\ subjects\\ at\\ risk\\ at\\ the\\ start}\n\\end{align}\n\nCan be interpreted as (at time t = n):\n\\begin{align}\nS_{(t=n)} = \\frac{at\\_risk_n - observed_n}{at\\_risk_n}\n\\end{align}\n\nTo be clear, \nfor t = 0:\n\\begin{align}\nS_0 = \\frac{228-0}{228}\n\\end{align}\n\nfor t = 11, from the event table we look at event_at t = 11 row i.e.,:\n\\begin{align}\nS_{11} = \\frac{227-3}{227}\n\\end{align}","37850ad7":"In a more generalized way, the probability of survival for a particular time can be given as:\n\n\\begin{align}\nS_t = \\frac{Number\\ of\\ subjects\\ at\\ risk\\ at\\ the\\ start - Number\\ of\\ subjects\\ that\\ died} {Number\\ of\\ subjects\\ at\\ risk\\ at\\ the\\ start}\n\\end{align}\n\nSurvival probability follows the concept of *conditional probability*, where for a person to be alive on the *nth* day, he should have been alive for the last *n-1* days. Hence we are looking at the past values also, and the probability of the *nth* day depends on the probability of the previous days. \n\nSo to summarize, from the above equation we get:\n\n\\begin{equation*}\nS(n)   = S(1) * S(2) * S(3) * ... * S(n-1) * S(n)\n\\end{equation*}","50924a1c":"### Group Division:\n\nA ph.karno score of less than equal to 1 will consider all patiens who are able to carry on normaly activity without special care. People with greater than 1 are considered actually ill.\n\nConsidering this, the two groups are made as:\n1. People with >= 1 ph.karno score\n2. People with < 1 ph.karno score","6661afd7":"> As the number of survival days increase, the probability of a person dying decreases.","b6c2e320":"### Inference\n\n> From the graph above, it can be inferred that subjects having Physician Karnofsky score less than 80 have lower chances or survival.","9c17fd5d":"#### The formula for cumulative density can be given as:\n\n\\begin{align}\nP_{(die(t_i))} = \\sum \\limits _{t_i <= t} P_{die(t_i)}\n\\end{align}","0de6e2b4":"#### The cumulative density at t = 0:\n\\begin{align}\nP_{(die(0))} = P_{die(t_0)} = 0\n\\end{align}\n\n#### The cumulative density at t = 5:\n\\begin{align}\nP_{(die(5))} = P_{die(t_0)} + P_{die(t_5)} = 0 + 0.004385 = 0.004385\n\\end{align}\n\n#### The cumulative density at t = 11:\n\\begin{align}\nP_{(die(11))} = P_{die(t_0)} + P_{die(t_5)} + P_{die(t_{11})} = 0 + 0.004385 + 0.01315= 0.01754\n\\end{align}\n\n#### The cumulative density at t = n:\n\\begin{align}\nP_{(die(n))} = P_{die(t_0)} + P_{die(t_1)} + ... + P_{die(t_n)}\n\\end{align}","ec7067ac":"| Attribute  |                         Description                               |\n|:---------- |:------------------------------------------------------------------|\n| inst       | Institute Code                                                    |\n| time       | Survival time in days                                             |\n| status     | Censoring status; 1= censored; 2 = dead                           |\n| age        | Age of the subject in years                                       |\n| ph.ecog    | Ecog performance score; 0: good, 5: dead                          |\n| ph.karno   | Karnofsky performance score; 0: bad; 100: good rated by physician |\n| pat.karno  | Karnofsky performance score as rated by patient                   |\n| meal.cal   | Calories consumed at meals                                        |\n| wt.loss    | Weight loss in last six months                                    |","1177b370":"### Event Table Overview from KM Estimator\n\nThe Event table consists of the following attributes which will be consulted to in future:\n\n> 1. **event_at**: It stores the value of the timeline for the dataset concerned. i.e., when was the patient observed in the observation. In this case, it is in days. It stores the number of survival days for each subject.\n\n> 2. **observed**: These are the number of people that died during the time frame of the experiment. To generalize these are basically the people who met out *event of interest*.\n\n> 3. **entrance**: It contains the number of new people encountered in a given timeline. There might be cases, where new groups of patients are diagnosed with the disease. The entrance column, basically, accounts for that. \n\n> 4. **censored**: Since we are mainly concerned in finding the survival probability of a patient. At the end of the experiment, if the person is still alive, then they will be added to the censored category. \n\n> 5. **removed**: It stores the value of patients who are no longer a part of our experiment. A patient will fall in this category if they either die or are censored.\n\\begin{align}\nremoved = observed + censored\n\\end{align}\n\n> 6. **at_risk**: It stored the value of the number of current patients who are under the observation. At the beginning, it will be nothing but the total number of patients we are concerned during the experiment. But later on, the value will increase with the addition of any newly diagnosed patient during that particular timeframe.\n\\begin{align}\nat\\_risk = current\\ patients\\ at\\_risk + entrance - removed\n\\end{align}","32b95618":"# Estimating Hazard Rates using Nelson-Aalen","1aa18c7b":"### Dealing with Null values:\n\nIn this case, there are a total of 228 data points. Out of these there 6 attributes which have missing values in the dataset which are as follows: \n1. `Unnamed: 0` is being dropped from the dataset as it is basically the row numbers\n2. `inst` (this attribute will eventually be ignored and dropped from the dataset as it does not have considerable contribution)\n3. From the rest of the attributes with missing values, the missing rows will be dropped only while doing any analysis which are dependent on only that particular attribute.","65a4f038":"### The Karnofsky Performance Scale Index\n\nThe Karnofsky Performance Scale Index allows patients to be classified as to their functional impairment. This can be used to compare effectiveness of different therapies and to assess the prognosis in individual patients. The lower the Karnofsky score, the worse the survival for most serious illnesses.\n![image.png](attachment:image.png)","452d1308":"### Inference\n> From the graph it can be inferred that males have a comparatively lower chnaces of survival compared to females. ","43b4436d":"## Survival Probability and Survival Function\n\n### Survivability:\n\nSurvival Function $S(t) = P(T > t)$, Probability of survival beyond time 't'\n\n### Hazard and Hazard Ratio\n\nHazard: <br>\n$HAZ = P(T < t+ \\delta | T > t)$, Probability of dying in the next few second ($\\delta$ seconds), considering the subject is alive at the moment.\n\nHazard Ratio $(HR) = \\frac{HAZ,\\ x\\ =\\ 1}{HAZ,\\ x\\ =\\ 0}$\n\nHere, Hazard ration basically, gives an idea about the relative hazards i.e., the hazard of a group who are exposed to some event $x = 1$ to the group who are not exposed i.e., $x = 0$\n\nExample: if $HR = 2$, in this case, we can say, that, at an instance of time, a group of individuals who were *exposed to a risk factor* have **twice the chances of dying** than the group of individuals who were *not exposed*.","55a9e597":"### Inference\n\n> From the graph above, it can be inferred that subjects who are older than 70 years have a comparatively lower chances of survival compared to subjects younger than 70 years.","f4844d03":"### Checking for missing values within the dataset","e0842571":"#### Inference:\n> From the value of the median survival days, we can say, that after the diagnosis of lung cancer, a patient, on an average is alive for **310 days**","049fab5e":"### 3. Dividing the population into two groups by the average weight loss of the subjects to check if the weight loss has any affect on the survival.","fcad9e9d":"### Role of Survival Analysis in Cancer Studies:\n\nIn this case, the main motivation is to find out the clinical characteristics (age, gender, etc.) of a patient (with lung cancer) on which his\/her survival depends. ","dbccf27c":"### Sanity check with actual data","a8dcd967":"### 6. Dividing the population into two groups by the ph.ecog scores","cacbec24":"### Dataset Attributes Overview:","23c10e96":"### Hazard Function $H(t)$\nUsing the Kaplan-Meier survival function, we can get the probability of an event of interest (death in this case) which is not occurring by that time. Although the survival functions are a great way to summarize and visualize the survival dataset; we can also visualize the aggregate information on survival using the Nelson-Aalen hazard function $h(t)$. The hazard function $h(t)$ gives us the probability that a subject under observation at time $t$ has an event of interest (death) at that time. \n>To get the information about the hazard function, we cannot transform the Kaplan-Meier estimator. For that, there is a proper *nonparametric* estimator of the *cumulative hazard function*:","5af5fae5":"# Application of the Cox-proportional Hazard model\n\n### Introduction on the model:\nThe cox-proportional hazard model is a regression model generally used in medical research to determine the relationship between the survival time of a subject and one or more predictor variables. In generic terms, it can be explained to be used for finding how the different attributes like age, gender, height, weight etc. affect the survival time of a subject.","db3e0c63":"### Data Censoring\n\nIn general survival analysis deals with the occurrence of an event of interest. The event of interest in this case is the death of a patient suffering from lung cancer. However, there might be possibilities that the event we are interest in does not occur.\n> *Such observations, where we are not sure on whether an event of interest has already occurred are known as censored observations*. \n\n*Left Censoring*: In this type of censoring, the event cannot be observed due to some reason. There might be chances that the event had already occurred before the experiment started, such as the person might have already died before the experiment begins. \n\n*Right Censoring*: In this case, the event of interest has not yet occurred for the individual under consideration. Basically, the person is still alive before the ending period of the analysis and the event of interest i.e., death (in this case) might or might not occur after the period under consideration.\n\n*Interval Censoring*: In this type of censoring, we only have data for a specific interval of time. Hence it is possible that the event of interest for the person responsible does not occur during that time interval.\n\n> In this scenario, all censored data are considered to be *non-informative* i.e., being censored is not related to the probability of the event (death, in this case) occurring.","ac4fe1f5":"### 2. Dividing the population into two groups by the ages of the subjects to check if the age of a subject has any affect on the survival.","c8c3d06e":"### Checking the Proportional Hazard Assumptions Using Lifelines Inbuilt `check_assumptions()`","cd891426":"Ecog Performance Score:\n\n|    Grade   |                  Ecog Performance Status                                       |\n|:---------- |:-------------------------------------------------------------------------------|\n|      0     | Fully active able to carry on all pre-disease performance without restriction. |\n|      1     | Restricted in physically strenuous activity but ambulatory and able to carry out work of a light or sedentary nature, e.g., light house work, office work                                             |\n|      2     | Ambulatory and capable of all selfcare but unable to carry out any work activities; up and about more than 50% of waking hours  |\n|      3     | Capable of only limited selfcare; confined to bed or chair more than 50% of waking hours                                        |\n|      4     | Capable of only limited selfcare; confined to bed or chair more than 50% of waking hours                                        |\n|      5     | Karnofsky performance score; 0: bad; 100: good rated by physician |","3786f0d9":"#### Hazard Ratio - $exp(b_i)$ or $e^{b_i}$\n\nThe value of $exp(b_i)$ is called the Hazard Ratio (HR) and it has the following significance.\n\nIf,<br>\nHR = 1 : No effect<br>\nHR < 1 : Reduction in Hazard<br>\nHR > 1 : Increase in Hazard<br>","5a98f369":"In our case, we are required to find the conditional probability till a particular t value, to obtain the actual survival probability.\n\nSo basically, at t = 0\n\\begin{align}\nS(0) = S_0 = 1\n\\end{align}\n\nGeneralized version, at t = n:\n\\begin{align}\nS_n = S_0 * S_1 * S_2 * ... * S(n)\n\\end{align}\n\nSo, for t = 11:\n\\begin{align}\nS_{11} = S_0 * S_5 * S_{11}\n\\end{align}","5b249082":"### Statistically significant values:\n\nFrom the summary table above, we can see the $p$ values for the different attributes.\n\n*Statistically Significant:*<br>\nA column will be regarded as statistically significant when the $p$-value is < 0.05.\n\n> In this case, we can see the attributes, **\"sex\"** and **\"ph.ecog\"** have $p$-values less than 0.05. We can also see attributes like age having a HR of 1.01, which suggests there is only 1% increase in risk factor for a higher age group. In general terms, it can be said, that there is no significant difference between different age groups.\n\n  > **Inference**:\n    From this it can be understood while grouping the data during analysis, \"sex\" and \"ph.ecog\" should be the attributes on which we focus more. ","5e141d63":"### Creating Seperate column for \"Event of Interest - Death\" from the status column\n\nPerson is *dead* when `status = 1`\n\nPerson is *alive* when `status = 2`","e0ab238f":"### 4. Dividing the population into two groups the ph.karno scores","42d37f5c":"*Disclaimer:* This is just a notebook where I have tried to put forward some of my basic understanding on survival analysis. I am faily new at this, so do point out any mistakes or misconceptions if you come across any. Hope to learn more in the course of time.","de48f133":"#### Types of Models used in Survival Analysis\n\nThere are different types of ways in which we can perfrom survival analysis. It is perfomed in several ways like when we define a group. Some of them are Kaplan Meier Curves, Cox Regression Models, Hazard Function, Survival Function etc.\n\n> When the survival Analysis is done to compare the survival analysis of 2 different groups, we typically tend to use a Log-Rank test.\n\n> When the Survival Analysis is done to describe the categorical and quantitative variables on survival we tend to use a Cox proportional hazards regression, Parametric Survival Models etc."}}