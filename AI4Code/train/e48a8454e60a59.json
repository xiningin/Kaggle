{"cell_type":{"1baefadf":"code","8017c674":"code","c77eab74":"code","e5eb37ff":"code","60ff74e5":"code","898fa278":"code","7c78c961":"code","f1bb506d":"code","505d4b43":"code","e6529c13":"code","4229a687":"code","dc024afb":"code","fdbd89cc":"code","fb26182f":"code","8b08800c":"code","dff5b8ca":"code","d70d1ef2":"code","50340098":"code","2e14882a":"code","6167b4f8":"code","32d3a944":"code","168bd706":"code","79627984":"code","698b0ce0":"code","6af09936":"markdown","041ba327":"markdown","3a54334f":"markdown","9765508e":"markdown","0fef223f":"markdown","24ca8faa":"markdown","a1026e23":"markdown","32079b13":"markdown","26d696b3":"markdown","45f53b6c":"markdown","bbc484f9":"markdown","b146cf14":"markdown","46b1c63a":"markdown","692a273f":"markdown","5e1ef452":"markdown","5872b950":"markdown","0e441999":"markdown","518450b2":"markdown","55b13b0d":"markdown","43b96fc4":"markdown","f8e06ce3":"markdown","de815482":"markdown","1b431302":"markdown","dd883e2e":"markdown","b7de2632":"markdown","6e1166b4":"markdown"},"source":{"1baefadf":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt","8017c674":"# sample_submission.csv\nsample = pd.read_csv(\"..\/input\/optiver-realized-volatility-prediction\/sample_submission.csv\")\nsample","c77eab74":"# test.csv\ntest = pd.read_csv(\"..\/input\/optiver-realized-volatility-prediction\/test.csv\")\ntest","e5eb37ff":"# book_test.parquet\nbook_test_parquet = pd.read_parquet(\"..\/input\/optiver-realized-volatility-prediction\/book_test.parquet\/stock_id=0\")\nbook_test_parquet","60ff74e5":"# trade_test.parquet\ntrade_test_parquet = pd.read_parquet(\"..\/input\/optiver-realized-volatility-prediction\/trade_test.parquet\/stock_id=0\")\ntrade_test_parquet","898fa278":"# train.csv\ntrain = pd.read_csv(\"..\/input\/optiver-realized-volatility-prediction\/train.csv\")\ntrain","7c78c961":"#book_train.parquet\nbook_example = pd.read_parquet(\"..\/input\/optiver-realized-volatility-prediction\/book_train.parquet\/stock_id=0\")\nbook_example ","f1bb506d":"# trade_train.parquet\ntrade_example = pd.read_parquet(\"..\/input\/optiver-realized-volatility-prediction\/trade_train.parquet\/stock_id=0\")\ntrade_example","505d4b43":"train","e6529c13":"for col in train.columns:\n    print(col, \":\", len(train[col].unique()))","4229a687":"stock = train.groupby(\"stock_id\")[\"target\"].agg([\"mean\", \"median\", \"std\", \"count\", \"sum\"]).reset_index()\nstock","dc024afb":"print(\"mean value=\" ,stock[\"mean\"].mean())\nplt.hist(stock[\"mean\"])","fdbd89cc":"print(\"sum value=\" ,stock[\"sum\"].mean())\nplt.hist(stock[\"sum\"])","fb26182f":"book_example","8b08800c":"book_test = book_example[book_example[\"time_id\"] == 5]\nbook_test","dff5b8ca":"samples = [\"bid_price1\", \"bid_price2\", \"ask_price1\", \"ask_price2\"]\n\nfor num, a in enumerate(samples):\n    plt.figure(figsize=(20,5))\n    plt.subplot(4,1,num+1)\n    plt.plot(book_test[\"seconds_in_bucket\"], book_test[a])\n    plt.title(a)\nplt.show()\nplt.figure(figsize=(20,5))\n\nfor num,a in enumerate(samples):\n    plt.plot(book_test[\"seconds_in_bucket\"],book_test[a],label=a)\nplt.legend(fontsize=12)","d70d1ef2":"trade_example","50340098":"trade_test = trade_example[trade_example[\"time_id\"]==5]\ntrade_test.head(5)","2e14882a":"plt.figure(figsize=(20,5))\n\nfor num,a in enumerate(samples):\n    plt.plot(book_test[\"seconds_in_bucket\"],book_test[a],label=a)\n    \nplt.scatter(trade_test[\"seconds_in_bucket\"],trade_test[\"price\"],label=\"trade_parquet\",lw=7)\nplt.legend(fontsize=12)","6167b4f8":"# min volatility time\nstock0 = train[train[\"stock_id\"]==0]\nmin_index = stock0[\"target\"].idxmin()\nmin_time_id = stock0.iloc[min_index][\"time_id\"]\nprint(\"min index is\",min_time_id,\"and min target is\",stock0.iloc[min_index][\"target\"])","32d3a944":"book_test_min = book_example[book_example[\"time_id\"]==min_time_id]\ntrade_test_min = trade_example[trade_example[\"time_id\"]==min_time_id]\n\n\nplt.figure(figsize=(20,5))\n\nfor num,a in enumerate(samples): \n    plt.plot(book_test_min[\"seconds_in_bucket\"],book_test_min[a],label=a)\n    \nplt.scatter(trade_test_min[\"seconds_in_bucket\"],trade_test_min[\"price\"],label=\"trade_parquet\",lw=7)\nplt.legend(fontsize=12)","168bd706":"# max volatility time\nstock0 = train[train[\"stock_id\"]==0]\nmax_index = stock0[\"target\"].idxmax()\nmax_time_id = stock0.iloc[max_index][\"time_id\"]\nprint(\"max index is\",max_time_id,\"and max target is\",stock0.iloc[max_index][\"target\"])","79627984":"book_test_max = book_example[book_example[\"time_id\"]==max_time_id]\ntrade_test_max = trade_example[trade_example[\"time_id\"]==max_time_id]\n\n\nplt.figure(figsize=(20,5))\n\nfor num,a in enumerate(samples):\n    plt.plot(book_test_max[\"seconds_in_bucket\"],book_test_max[a],label=a)\n    \nplt.scatter(trade_test_max[\"seconds_in_bucket\"],trade_test_max[\"price\"],label=\"trade_parquet\",lw=7)\nplt.legend(fontsize=12)","698b0ce0":"plt.figure(figsize=(20,5))\nplt.scatter(trade_test_min[\"seconds_in_bucket\"],trade_test_min[\"price\"],lw=10,label=\"min_vol_time\")\nplt.scatter(trade_test_max[\"seconds_in_bucket\"],trade_test_max[\"price\"],lw=10,label = \"max_vol_time\")\nplt.legend(fontsize=15)","6af09936":"\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3\u6ce2\u52a8\u7387\uff0c\u6211\u4eec\u5206\u522b\u627e\u5230\u6ce2\u52a8\u7387\u6700\u5c0f\u548c\u6700\u5927\u7684\u65f6\u95f4\u7247\u3002","041ba327":"\u63d0\u4ea4\u6837\u4f8b\u4e2d\u7684row_id\u662fstock_id\u548ctime_id\u7528\u201c-\u201d\u8fde\u63a5\u5f97\u5230\u7684\u3002","3a54334f":"1. \u6309\u80a1\u7968\u5206\u6790","9765508e":"\u76ee\u6807\u4e3a\u9884\u6d4b\u6bcf\u652f\u80a1\u7968\u7684\u6ce2\u52a8\u7387\u3002","0fef223f":"# \u6570\u636e\u4ecb\u7ecd\n\u52a0\u8f7d\u6bd4\u8d5b\u6570\u636e\uff0c\u89c2\u5bdf\u5206\u6790\u3002","24ca8faa":"# \u4e00\u4e9b\u6982\u5ff5","a1026e23":"\u53ef\u4ee5\u53d1\u73b0\uff0c\u653e\u5728\u540c\u4e00\u5c3a\u5ea6\u4e0b\u6bd4\u8f83\u7684\u8bdd\uff0c\u53ef\u4ee5\u5f88\u660e\u663e\u7684\u5206\u8fa8\u6ce2\u52a8\u7387\u5927\u5c0f\u3002","32079b13":"## 2. \u9884\u6d4b\u6570\u636e\u6765\u6e90","26d696b3":"book\u6587\u4ef6\u5185\u5bb9\u7c7b\u4f3c\u4e8e\u4e70\u65b9\u548c\u5356\u65b9\u7684\u610f\u5411\uff0c\u4f46\u662f\u7531\u4e8e\u53cc\u65b9\u610f\u5411\u7684\u5dee\u8ddd\uff0c\u5e76\u6ca1\u6709\u6210\u4ea4\u3002\nBid\u662f\u4e70\u65b9\u8d2d\u4e70\u80a1\u7968\u7684\u610f\u5411\u4ef7\u683c\uff0cAsk\u662f\u5356\u65b9\u51fa\u552e\u80a1\u7968\u7684\u610f\u5411\u4ef7\u683c\u3002\uff08Ask > Bid\uff09\n- stock_id : \u76ee\u524d\u6b63\u5728\u4f5c\u4e3a\u8def\u5f84\uff0c\u4e4b\u540e\u53ef\u4ee5\u8003\u8651\u4f5c\u4e3aint\u7c7b\u578b\u7684feature\u3002\n- time_id : \u5bf9\u5e94submission\u4e2d\u7684time_id\n- seconds in bucket : \u4ece0\u65f6\u523b\u5f00\u59cb\u4e4b\u540e\u7684\u7b2c\u591a\u5c11\u79d2\uff1f\n- bid_price1,2: \u6700\u6709\u5438\u5f15\u529b\u7684\u7684bid\u7684\u524d\u4e24\u4f4d\n- ask_price1,2: \u540c\u4e0a","45f53b6c":"## Order book\u7684\u6570\u636e\u7279\u5f81\n**bid\/ask spread**\n\n\u6700\u597d\u7684bid\u548c\u6700\u597d\u7684ask\u4e4b\u95f4\u7684\u5dee\u8ddd\u3002\n$$BidAskSpread = BestOffer\/BestBid -1$$\n\n**WAP, Weighted averaged price**\n\nWAP\uff0c\u52a0\u6743\u5e73\u5747\u4ef7\u683c\u3002\n\n\u7efc\u5408\u4e86Bid\/Ask Price\u548cBid\/Ask Size\u7684\u4ef7\u683c\u3002\u5373\u7efc\u5408\u4e86\u4f9b\u6c42\u548c\u5b9e\u9645\u4ef7\u683c\u7684\u52a0\u6743\u4ef7\u683c\u3002\n$$ WAP = \\frac{BidPrice_{1}*AskSize_{1} + AskPrice_{1}*BidSize_{1}}{BidSize_{1} + AskSize_{1}} $$\n\u6ce8\u610f\uff0cAskPrice > BidPrice\u3002\u6240\u4ee5\uff0c\u5f53AskSize\uff08\u4f9b\u7ed9\u91cf\uff09\u589e\u52a0\u65f6\uff0cWAP\u4f1a\u589e\u52a0\uff1b\u5f53BidSize\uff08\u9700\u6c42\u91cf\uff09\u589e\u52a0\u65f6\uff0cWAP\u964d\u4f4e\u3002\n\n**Log returns**\n\n\u533a\u522b\u4e8e\u767e\u5206\u6bd4\u56de\u62a5\u7387\u7684\u5bf9\u6570\u56de\u62a5\u7387\u3002\n$$\nr_{t_1, t_2} = \\log \\left( \\frac{S_{t_2}}{S_{t_1}} \\right)\n$$\n\u6027\u8d28\uff1a\n\n- \u53ef\u52a0\u6027 \u4f8b\uff1a$r_{t_1, t_2} + r_{t_2, t_3} = r_{t_1, t_3}$\n\n- \u65e0\u754c\u6027 \u767e\u5206\u6bd4\u56de\u62a5\u7387\u4e0d\u4f1a\u5c0f\u4e8e-100%\uff0c\u5bf9\u6570\u56de\u62a5\u7387\u65e0\u4e0b\u754c\u3002\n\n## Realized volatility\n\u9884\u6d4b\u76ee\u6807\uff0c\u5b9e\u9645\u6ce2\u52a8\u7387\uff0c\u662f\u5b9e\u9645\u4ef7\u503c\uff08\u52a0\u6743\u5e73\u5747\u4ef7\u683c\uff09\u7684\u6ce2\u52a8\u3002\n\n\u4ee5WAP\u4f5c\u4e3a\u4ef7\u683c\uff0c\u6c42\u5404\u4e2a\u65f6\u95f4\u7247\u7684\u5bf9\u6570\u56de\u62a5\u7387\uff08Log returns\uff09$r_{t-1, t}$\uff0c\u7136\u540e\u6c42\u65b9\u5dee\u3002\n\n\u5b9e\u9645\u6ce2\u52a8\u7387\u4e3a$\\sigma$\uff1a\n$$\n\\sigma = \\sqrt{\\sum_{t}r_{t-1, t}^2}\n$$\n\u65b9\u4fbf\u8d77\u89c1\uff0c\u5b98\u65b9\u8bf4\u660e\uff1a\u5e76\u6ca1\u6709\u5e74\u5316\u6ce2\u52a8\u7387\uff1b\u5047\u8bbe\u5bf9\u6570\u56de\u62a5\u7387\u5747\u503c\u4e3a0\u3002","bbc484f9":"target\u7edf\u8ba1\u6570\u636e","b146cf14":"- price_spread : ask\u548cbid\u7684\u5dee\u8ddd\n- volumn: ask\/bid\u7684\u4efd\u6570\u7684\u591a\u5c11\n- volumn_imbalance : ask\u548cbid\u4e4b\u95f4\u7684\u4e0d\u5e73\u8861\n- wap : \u52a0\u6743\u5e73\u5747\u4ef7\u683c\u3002\u5373\u8003\u8651\u4f9b\u6c42\u5173\u7cfb\u540e\u7684\u4ef7\u683c\u3002","46b1c63a":"\n\u4ef7\u683c\u6ce2\u52a8","692a273f":"trade\u6587\u4ef6\u4e2d\u4e3a\u5b9e\u9645\u6210\u4ea4\u7684\u72b6\u51b5\uff0c\u6570\u636e\u91cf\u4f1a\u6bd4book\u6587\u4ef6\u4e2d\u7a00\u758f\u3002\uff08\u5b9e\u9645\u6210\u4ea4\u7684\u6bd4\u6539\u53d8\u610f\u5411\u7684\u5c11\u5f88\u591a\uff09\n- stock_id : \u540c\u4e0a \n- time_id : \u540c\u4e0a\n- seconds_in_buckets : \u540c\u4e0a\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8etrade\u6570\u636e\u7684\u7a00\u758f\u6027\uff0c\u6b64\u5904\u7b2c\u4e00\u884c\u7684\u65f6\u95f4\u4e0d\u4e00\u5b9a\u662f0.\n- price \uff1a \u5b9e\u9645\u53d1\u751f\u7684\u6210\u4ea4\u5728\u4e00\u79d2\u5185\u7684\u5e73\u5747\u4ef7\u683c\u3002\n- size \uff1a \u6210\u4ea4\u7684\u80a1\u7968\u4efd\u6570\u3002\n- order_count : \u53d1\u751f\u4e0d\u540c\u7684\u6210\u4ea4\u7684\u4e2a\u6570\u3002","5e1ef452":"\u8d5b\u9898\u63d0\u4f9b\u4e86Order book\u548cTrade\u7684\u6570\u636e\u3002\n## Order Book\nOrder Book\u662f\u5448\u73b0\u67d0\u79cd\u91d1\u878d\u4ea7\u54c1\u7684\u4e70\u65b9\uff08bid\uff09\u548c\u5356\u65b9\uff08ask\uff09\u610f\u5411\u4ef7\u683c\u7684\u5217\u8868\u3002\u5982\u4e0b\u56fe\uff1a\n\n\n![order_book_1](https:\/\/www.optiver.com\/wp-content\/uploads\/2021\/05\/OrderBook3.png)\n\n## Trade\n\u5f53\u4e70\u5356\u65b9\u4ef7\u683c\u4e00\u81f4\u65f6\u53d1\u751f\u6210\u4ea4\uff08Trade\uff09\u3002\u4f8b\u5982\uff1a\u5728\u4e0a\u56fe\u7684\u5e02\u573a\u4e0b\uff0c\u51fa\u73b0\u4e70\u65b9\u60f3\u8981\u4e70\u4e0b20\u4efd\u80a1\u4efd\uff0c\u90a3\u4e48\u4ed6\u4f1a\u4ee5148\u7684\u4ef7\u683c\u6210\u4ea4\uff0c\u5e02\u573a\u4e0a\u6807\u4ef7148\u51fa\u552e\u7684\u80a1\u4efd\u76f8\u5e94\u4f1a\u51cf\u5c1120\u4efd\u3002\n\n\n![order_book2](https:\/\/www.optiver.com\/wp-content\/uploads\/2021\/05\/OrderBook4.png)\n\n## \u505a\u5e02\uff08Market making\uff09\u548c\u5e02\u573a\u6709\u6548\u6027\uff08market efficiency\uff09*\n\u5f53A\u80a1\u7968\u7684Order book\u5982\u4e0b\u65f6\uff0c\u5373ask\u548cbid\u90fd\u6bd4\u8f83\u7a00\u758f\u65f6\uff0c\u53ef\u4ee5\u8bf4\u5b83\u7684\u6d41\u901a\u6027\u6bd4\u8f83\u4f4e\u3002\n![order_book_3](https:\/\/www.optiver.com\/wp-content\/uploads\/2021\/05\/OrderBook5.png)\n\n\u8fd9\u6837\u7684\u5e02\u573a\u73af\u5883\u4f1a\u6bd4\u8f83\u5dee\uff0c\u4e3e\u4f8b\uff1a\n\n''\nYou could insert an order to buy at 148. However, there is nobody currently willing to sell to you at 148, so your order will be sitting in the book, waiting for someone to trade against it. If you get unlucky, the price goes up, and others start bidding at 149, and you never get to buy at all. Alternatively, you could insert an order to buy at 155. The exchange would match this order against the outstanding sell order of one share at 149, so you buy 1 lot at 149. Similarly, you'd buy 12 shares at a price of 150, and 7 shares at 151. Compared to trying to buy at 148, there is no risk of not getting the trade that you wanted, but you do end up buying at a higher price.\n''\n\nOptiver\u7684\u76ee\u7684\u662f\u7ef4\u6301\u5e02\u573a\u7684\u6d41\u901a\u6027\uff0c\u6ee1\u8db3\u516c\u4f17\u6295\u8d44\u8005\u7684\u9700\u6c42\u3002\u5373\u505a\u5e02\u5546\uff08market maker\uff09\u3002\n\u505a\u5e02\u5546\u662f\u6307\u5728\u8bc1\u5238\u5e02\u573a\u4e0a\uff0c\u6709\u5177\u5907\u4e00\u5b9a\u5b9e\u529b\u548c\u4fe1\u8a89\u7684\u8bc1\u5238\u7ecf\u8425\u6cd5\u4eba\u4f5c\u4e3a\u7279\u8bb8\u4ea4\u6613\u5546\uff0c\u4e0d\u65ad\u60f3\u516c\u4f17\u6295\u8d44\u8005\u62a5\u51fa\u67d0\u4e9b\u8bc1\u5238\u7684\u4e70\u5356\u4ef7\u683c\uff0c\u5e76\u5728\u8be5\u4ef7\u4f4d\u4e0a\u63a5\u53d7\u516c\u4f17\u6295\u8d44\u8005\u7684\u4e70\u5356\u8981\u6c42\uff0c\u4ee5\u5176\u81ea\u6709\u8d44\u91d1\u548c\u8bc1\u5238\u4e0e\u6295\u8d44\u8005\u8fdb\u884c\u8bc1\u5238\u4ea4\u6613\u3002","5872b950":"## 1. \u9884\u6d4b\u76ee\u6807","0e441999":"- \u84dd\u8272\u7684\u70b9\u5bf9\u5e94\u5b9e\u9645\u6210\u4ea4\u7684\u65f6\u95f4\u4ee5\u53ca\u4ef7\u683c\u3002\u53ef\u4ee5\u770b\u5230\u5b83\u5728bid\u6216\u8005ask\u9644\u8fd1\uff0c\u5076\u5c14\u4f1a\u5728\u7ebf\u7684\u4e2d\u95f4\u3002\n- bid\u548cask\u5728time_id=5\u7684\u65f6\u95f4\u7247\uff08\u4e00\u517110min\uff09\u4e5f\u6709\u5f88\u9891\u7e41\u7684\u6ce2\u52a8\u3002\n----","518450b2":"# \u6570\u636e\u5206\u6790","55b13b0d":"\u5e73\u5747\u6570\u4e3a0.004\uff0c\u4e0e0\u63a5\u8fd1\u3002","43b96fc4":"# Optiver\u6570\u636e\u7ade\u8d5b EDA\n\n\u5148\u9605\u8bfb\u4e86\u5b98\u65b9\u7684\u6307\u5357\uff1ahttps:\/\/www.kaggle.com\/jiashenliu\/introduction-to-financial-concepts-and-data\n\n\n\u4e4b\u540e\u4e3b\u8981\u53c2\u8003\u4e86\u5206\u4eab\u7684EDA\uff1ahttps:\/\/www.kaggle.com\/chumajin\/optiver-realized-eda-for-starter-english-version","f8e06ce3":"3. \u7279\u5f81\u5de5\u7a0b","de815482":"\u5171\u6709112\u652f\u80a1\u7968\uff0c3830\u4e2a\u4e0d\u540c\u7684\u65f6\u95f4\u7247.","1b431302":"target\u662f\u80a1\u7968\u572810\u5206\u949f\u5185\u7684\u603b\u6ce2\u52a8\u7387\u3002","dd883e2e":"\u8fd9\u6bb5\u65f6\u95f4\u6ce2\u52a8\u7387\u7684\u53e0\u52a0\u5e73\u5747\u4e3a14.8\uff0c\u6709\u7684\u8d85\u8fc7\u4e8630.\uff08\u6ce2\u52a8\u7387\u662f\u53ef\u52a0\u7684\uff09","b7de2632":"## 3. \u8bad\u7ec3\u6570\u636e","6e1166b4":"2. \u540c\u65f6\u95f4\u7247\u4e0bBid\uff0c Ask\u4ee5\u53ca\u5b9e\u9645\u4ea7\u751f\u7684trade\u4e4b\u95f4\u7684\u5173\u7cfb"}}