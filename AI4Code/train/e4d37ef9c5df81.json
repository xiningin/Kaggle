{"cell_type":{"fa98bc1d":"code","530cd2d3":"code","45d4c987":"code","a56704e5":"code","3836522a":"code","d8af9bcb":"code","bb82843d":"code","87f7c5c5":"code","f70f91b0":"code","a37bf4d6":"code","1f827d29":"code","e55ca8fb":"markdown","7850be36":"markdown","9d358a71":"markdown","1f634376":"markdown","9ca1e5ae":"markdown","e108cc30":"markdown","12d958d9":"markdown","aaff014c":"markdown","fadac125":"markdown","3035e1b2":"markdown","1e385029":"markdown"},"source":{"fa98bc1d":"#import dependencies\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\nfrom keras_preprocessing.image import ImageDataGenerator\nfrom keras.layers import Dense, Activation, Flatten, Dropout, BatchNormalization\nfrom keras.layers import Conv2D, MaxPooling2D\nfrom keras import regularizers, optimizers\nfrom tensorflow.keras import layers\nfrom tensorflow.keras import Model\nfrom tensorflow.keras.applications.inception_v3 import InceptionV3\nfrom tensorflow.keras.optimizers import RMSprop","530cd2d3":"df=pd.read_csv('..\/input\/plant-pathology-2020-fgvc7\/train.csv') #training set list\ncolumns=[\"healthy\", \"multiple_diseases\", \"rust\", \"scab\"]\ndf_test=pd.read_csv('..\/input\/plant-pathology-2020-fgvc7\/test.csv') #testing set list\n\n#appending .jpg so that we can dirctly read the images from \"image_id\" column\ndf['image_id'] = df['image_id'].astype(str)+\".jpg\"\ndf_test['image_id'] = df_test['image_id'].astype(str)+\".jpg\"","45d4c987":"#ImageGenerator\n\n#data augmentation\ndatagen = ImageDataGenerator(\n      rescale=1.\/255,\n      rotation_range=40,\n      width_shift_range=0.2,\n      height_shift_range=0.2,\n      shear_range=0.2,\n      zoom_range=0.2,\n      horizontal_flip=True,\n      fill_mode='nearest')\n\ntest_datagen=ImageDataGenerator(rescale=1.\/255.)\n\n#training data \ntrain_generator=datagen.flow_from_dataframe(\n    dataframe=df[:1460],\n    directory='..\/input\/plant-pathology-2020-fgvc7\/images',\n    x_col=\"image_id\",\n    y_col=columns,\n    batch_size=32,\n    seed=42,\n    shuffle=True,\n    class_mode=\"raw\",\n    target_size=(300,300))\n\n#validation data\nvalid_generator=test_datagen.flow_from_dataframe(\n    dataframe=df[1460:],\n    directory='..\/input\/plant-pathology-2020-fgvc7\/images',\n    x_col=\"image_id\",\n    y_col=columns,\n    batch_size=32,\n    seed=42,\n    shuffle=True,\n    class_mode=\"raw\",\n    target_size=(300,300))\n\n#test data\ntest_generator=test_datagen.flow_from_dataframe(\n    dataframe=df[:],\n    directory='..\/input\/plant-pathology-2020-fgvc7\/images',\n    x_col=\"image_id\",\n    batch_size=1,\n    seed=42,\n    shuffle=False,\n    class_mode=None,\n    target_size=(300,300))","a56704e5":"#download model\n!wget --no-check-certificate \\\n    https:\/\/storage.googleapis.com\/mledu-datasets\/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5 \\\n    -O \/tmp\/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5\n  \nlocal_weights_file = '\/tmp\/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5'\n\npre_trained_model = InceptionV3(input_shape = (300, 300, 3), \n                                include_top = False, \n                                weights = None)\n\npre_trained_model.load_weights(local_weights_file)\n  \n#pre_trained_model.summary()","3836522a":"for layer in pre_trained_model.layers:\n    layer.trainable = False\n\nlast_layer = pre_trained_model.get_layer('mixed10')\nlast_output = last_layer.output\n\n# Flatten the output layer to 1 dimension\nx = layers.Flatten()(last_output)\n# Add a fully connected layer with 64 hidden units and ReLU activation\nx = layers.Dense(64, activation='relu')(x)\n# Add a dropout rate of 0.5\nx = layers.Dropout(0.5)(x) \n\n# Add a final sigmoid layer for classification\nx = layers.Dense  (4, activation='softmax')(x)           \n\n\nmodel = Model( pre_trained_model.input, x) \n\nmodel.compile(optimizer = RMSprop(lr=0.0001), \n              loss = 'categorical_crossentropy', \n              metrics = ['accuracy'])\n\n#model.summary()","d8af9bcb":"STEP_SIZE_TRAIN=train_generator.n\/\/train_generator.batch_size\nSTEP_SIZE_VALID=valid_generator.n\/\/valid_generator.batch_size\nSTEP_SIZE_TEST=test_generator.n\/\/test_generator.batch_size\n\nhistory=model.fit_generator(generator=train_generator,\n                    steps_per_epoch=STEP_SIZE_TRAIN,\n                    validation_data=valid_generator,\n                    validation_steps=STEP_SIZE_VALID,\n                    epochs=5)","bb82843d":"%matplotlib inline \n\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\n\n\nprint ('Matplotlib version: ', mpl.__version__) # >= 2.0.0\n\nacc = history.history['accuracy']\nval_acc = history.history['val_accuracy']\nloss = history.history['loss']\nval_loss = history.history['val_loss']\nepochs = range(len(acc))\n","87f7c5c5":"f, ax = plt.subplots(figsize=(12,4)) # set the size that you'd like (width, height)\n\nplt.title('Traing Loss')\nplt.ylabel('Loss')\nplt.xlabel('Epochs')\n\nplt.plot(epochs,loss,label='Training Loss')\nplt.plot(epochs, val_loss,label='Validation Loss')\n\nplt.legend()\nplt.show()","f70f91b0":"f, ax = plt.subplots(figsize=(12,4)) # set the size that you'd like (width, height)\n\nplt.title('Accuracy')\nplt.ylabel('Accuracy')\nplt.xlabel('Epochs')\n\nplt.plot(epochs,acc,label='Training Accuracy')\nplt.plot(epochs, val_acc,label='Validation Accuracy')\n\nplt.legend()\nplt.show()","a37bf4d6":"SUB_PATH = \"..\/input\/plant-pathology-2020-fgvc7\/sample_submission.csv\"\nsub = pd.read_csv(SUB_PATH)","1f827d29":"test_generator.reset()\npred=model.predict_generator(test_generator,steps=STEP_SIZE_TEST,verbose=1)\n\nsub.loc[:, 'healthy':] = pred\nsub.to_csv('submission.csv', index=False) #submit this file\nsub.head()","e55ca8fb":"Use the Trained Model to predict Test set and generate the Submission.csv file! ","7850be36":"Build Model","9d358a71":"Load Data using ImageGenerator (Data Augmentation)   \n80:20 split between Training and Validation Data","1f634376":"Train the Model","9ca1e5ae":"Create Dataframes for reading csv files","e108cc30":"Import Dependencies","12d958d9":"Congratulation! You have come to the end of this notebook.","aaff014c":"Analyze Training","fadac125":"Please do give suggestions and improvements regarding this Notebook! Thank You.","3035e1b2":"Transfer Learning (InceptionNet V3)","1e385029":"This Notebook contains begginer's code to get started with this Kaggle Competition using Keras.  \nContents of Notebook:  \n1. Load Data using ImageGenerator (Data Augmentation)  \n2. Transfer Learning  \n3. Build Model  \n4. Train the Model  \n5. Analyze Training  \n6. Use the Trained Model to predict Test set and generate the Submission.csv file  "}}