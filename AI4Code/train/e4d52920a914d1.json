{"cell_type":{"cb65e04b":"code","b1c4d15b":"code","b29e60e4":"code","29540967":"code","6710c3fd":"code","b2f616ab":"code","3c937c57":"code","ec988505":"code","dbd80694":"code","c0f4bcba":"code","b94e928a":"code","1ae7f98a":"code","0e62ac1b":"code","1f30b49f":"code","787050d6":"code","cdf2bf0a":"code","c806ce1c":"code","103205a2":"code","ddc2d837":"code","24f5e597":"code","e03fac53":"code","cdf440b6":"code","663ee250":"code","aa047b1a":"code","7be2ac37":"code","387a21b0":"code","712b2156":"code","dc8fe6aa":"code","e355dede":"markdown","74666044":"markdown","e4ef4a0f":"markdown","1192d288":"markdown","066c8abd":"markdown","2ef8f06e":"markdown","e6a692d2":"markdown","e41dfd89":"markdown","3ec08ce1":"markdown","f3f12f29":"markdown","35c912a7":"markdown"},"source":{"cb65e04b":"\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nfrom sklearn.model_selection import train_test_split, StratifiedShuffleSplit\n\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nplt.rcParams[\"figure.figsize\"] = (12, 8)\nplt.rcParams['axes.titlesize'] = 16\nplt.style.use('seaborn-whitegrid')\nsns.set_palette('Set3')\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\nfrom time import time, strftime, gmtime\nstart = time()\nimport datetime\nprint(str(datetime.datetime.now()))","b1c4d15b":"train = pd.read_csv('\/kaggle\/input\/tabular-playground-series-jun-2021\/train.csv')\nprint(train.shape)\ntrain.head()","b29e60e4":"test = pd.read_csv('\/kaggle\/input\/tabular-playground-series-jun-2021\/test.csv')\nprint(test.shape)\ntest.head()","29540967":"sub = pd.read_csv('\/kaggle\/input\/tabular-playground-series-jun-2021\/sample_submission.csv')\nprint(sub.shape)\nsub.head()","6710c3fd":"ax = sns.countplot(data = train, x = 'target')\nfor p in ax.patches:\n    ax.annotate(str(p.get_height()), (p.get_x() * 1.005, p.get_height() * 1.005))","b2f616ab":"train.info(), test.info()","3c937c57":"train.describe().T","ec988505":"test.describe().T","dbd80694":"!pip install tensorflow_decision_forests -q","c0f4bcba":"train = train.sample(frac = 0.1).reset_index(drop = True)\ntrain.shape","b94e928a":"train_df, valid_df = train_test_split(train, test_size = 0.2, shuffle = True, stratify = train['target'].values, \n                                      random_state = 42)\ntrain_df.shape, valid_df.shape","1ae7f98a":"import tensorflow_decision_forests as tfd\n\ntfd.keras.get_all_models()","0e62ac1b":"train_tf = tfd.keras.pd_dataframe_to_tf_dataset(train_df, label = 'target')","1f30b49f":"model = tfd.keras.GradientBoostedTreesModel(\n    num_trees = 500,\n    growing_strategy = \"BEST_FIRST_GLOBAL\",\n    max_depth = 8,\n    split_axis = \"SPARSE_OBLIQUE\",\n    categorical_algorithm = \"RANDOM\",\n    )","787050d6":"?tfd.keras.GradientBoostedTreesModel","cdf2bf0a":"%%time\n#Train the model\nmodel.fit(x = train_tf)","c806ce1c":"model.summary()","103205a2":"valid_tf = tfd.keras.pd_dataframe_to_tf_dataset(valid_df, label = 'target')\n\nmodel.compile(metrics = [\"accuracy\"])\nev = model.evaluate(valid_tf)","ddc2d837":"print(f\"BinaryCross Entropy Loss: {ev[0]}\")\nprint(f\"Accuracy: {ev[1]}\")\n\n#Save model\nmodel.save('.\/tps_model')","24f5e597":"inspector = model.make_inspector()","e03fac53":"print('Model Meta-data:\\n')\nprint(f\"Model type: {inspector.model_type()}\")\nprint(f\"Number of Trees: {inspector.num_trees()}\")\nprint(f\"Input features: {inspector.features()}\")","cdf440b6":"train_logs = inspector.training_logs()\n\nplt.plot([log.num_trees for log in train_logs], [log.evaluation.accuracy for log in train_logs])\nplt.xlabel(\"Number of Trees\")\nplt.ylabel(\"Valid Accuracy\")\nplt.show()\n\nplt.plot([log.num_trees for log in train_logs], [log.evaluation.loss for log in train_logs])\nplt.xlabel(\"Number of Trees\")\nplt.ylabel(\"Valid Logloss)\")\nplt.show()","663ee250":"print(f\"Available variable importances:\")\nfor importance in inspector.variable_importances().keys():\n    print(importance)","aa047b1a":"with open('plot_model.html', 'w') as f: \n    f.write(tfd.model_plotter.plot_model(model))","7be2ac37":"from IPython.display import IFrame\n\nIFrame(src = '.\/plot_model.html', width = 800, height = 500)","387a21b0":"test_tf = tfd.keras.pd_dataframe_to_tf_dataset(test)\npreds = model.predict(test_tf)\npreds","712b2156":"sub.loc[:, 1:] = preds\nsub.to_csv('.\/submission.csv', index = False)\nsub.head()","dc8fe6aa":"finish = time()\nprint(strftime(\"%H:%M:%S\", gmtime(finish - start)))","e355dede":"### Feature Importance","74666044":"## Tensorfow Decision Forests\n\nTensorflow Decision Forests are the newest API from TF family to work with tabular data, this makes it easier to integrate with other NNs.\n\nTensorflow Decision forests are a family of machine learning algorithms with quality and speed competitive with (and often favorable to) neural networks, especially when you\u2019re working with tabular data. They\u2019re built from many decision trees, which makes them easy to use and understand - and you can take advantage of a plethora of interpretability tools and techniques that already exist.\n\n- It provides a slew of state-of-the-art Decision Forest training and serving algorithms such as random forests, gradient-boosted trees, CART, (Lambda)MART, DART, Extra Trees, greedy global growth, oblique trees, one-side-sampling, categorical-set learning, random categorical learning, out-of-bag evaluation and feature importance, and structural feature importance.\n\n- This library can serve as a bridge to the rich TensorFlow ecosystem by making it easier for you to integrate tree-based models with various TensorFlow tools, libraries, and platforms such as TFX.\n\nFor more info please check -> https:\/\/blog.tensorflow.org\/2021\/05\/introducing-tensorflow-decision-forests.html","e4ef4a0f":"### Prediction","1192d288":"### Training Logs Plot","066c8abd":"__Below are the available models in Tensorflow Decision Forest__","2ef8f06e":"- The first entry that model.evaluate returns is the BinaryCrossEntropyLoss\n- The second entry is the eval metric we supplied while compiling the model (accuracy)","e6a692d2":"__Evaluation__","e41dfd89":"__Convert pandas dataframe to TF format__","3ec08ce1":"__Install Tensorflow Decision Forest API__","f3f12f29":"List of hyperparameters can be accessed using below command","35c912a7":"### Plot Model"}}