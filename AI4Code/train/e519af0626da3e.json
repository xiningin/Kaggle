{"cell_type":{"f1686b17":"code","89a3a75c":"code","83017d0e":"code","80528d1e":"code","fa3f1dd2":"code","e0308f72":"code","d0a32603":"code","0f1945dd":"code","a4ea9eed":"code","927cab91":"code","0728a235":"code","b9d5ce02":"code","db30563d":"code","c49e1891":"code","1d1c5806":"code","d021e2c6":"code","f4aa384d":"code","2c08fa5a":"code","de240ae7":"code","1d887aa7":"code","751ed605":"code","65118e5f":"code","f476714c":"code","9ad9f246":"code","2009ceac":"code","2875f6b2":"code","7183cd5d":"code","4e4d012d":"markdown","1cf5d655":"markdown","737592a3":"markdown","fb0d61f3":"markdown","5d043d84":"markdown","551e2663":"markdown","cb3c2a97":"markdown","5b417d52":"markdown","82150227":"markdown","1646d996":"markdown","ee600070":"markdown","acabef54":"markdown","b1a5749e":"markdown","d5f9819f":"markdown","1ea1c5e7":"markdown","7c9f9bbe":"markdown","641e3857":"markdown","d681bce8":"markdown","9a305641":"markdown","9ed59ca8":"markdown","b84248b2":"markdown","9d8107d7":"markdown","a2961370":"markdown","a3f979b2":"markdown","20ba5331":"markdown","a19eb073":"markdown","b187bc8e":"markdown","2a1795d1":"markdown","4bfedde4":"markdown","90232d71":"markdown","d0f21e07":"markdown","a1976043":"markdown","6ced2b7e":"markdown","59e5435d":"markdown"},"source":{"f1686b17":"import numpy as np\nimport pandas as pd\n\n# List all files under the current input directory\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","89a3a75c":"# Import libraries\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","83017d0e":"# Load the data for 2020, leaving some unwanted columns out\nwh_2020 = pd.read_csv('\/kaggle\/input\/world-happiness-report\/2020.csv', usecols = range(12))","80528d1e":"# Preview the data\nwh_2020.head()","fa3f1dd2":"print(\"Our data has {} rows (observations\/countries) and {} columns.\".format(wh_2020.shape[0], wh_2020.shape[1]))","e0308f72":"col_names_dict = {'Country name':'Country', 'Regional indicator':'Region', 'Ladder score': 'Ladder',\n                  'Standard error of ladder score':'Standard Error', 'Logged GDP per capita':'Logged GDPPC',\n                  'Social support':'Social Support', 'Healthy life expectancy':'Life Expectancy',\n                  'Freedom to make life choices':'Freedom', 'Perceptions of corruption': 'Corruption'}\n\nwh_2020.rename(columns = col_names_dict, inplace = True)","d0a32603":"# Check for any missing values in the data\nwh_2020.isnull().sum()","0f1945dd":"# Add a 'Rank' column to our data (luckily for us, the rows are already ordered from happiest to unhappiest)\nwh_2020['Rank'] = range(1, 154)","a4ea9eed":"quartile_index = np.percentile(wh_2020['Rank'], [25, 50, 75])\nquartiles = pd.Series(wh_2020['Rank'].map(lambda x:(np.searchsorted(quartile_index, x) + 1)), name = 'Quartile')\nwh_2020 = pd.concat([wh_2020, quartiles], axis = 1)    ","927cab91":"# Check our updated data with the new 'Rank' and 'Quartile' columns\nwh_2020.head()","0728a235":"# Set font sizes for all of our plots\nplt.rc('font', size = 14)\nplt.rc('axes', labelsize = 16)\nplt.rc('legend', fontsize = 18)\nplt.rc('axes', titlesize = 24)\nplt.rc('figure', titlesize = 24)","b9d5ce02":"# Set style\nplt.style.use('seaborn-whitegrid')","db30563d":"fig = plt.figure(figsize = (18, 14))\nax = plt.axes()\n\ncountplot = sns.countplot('Region', data = wh_2020, saturation = 0.8, palette = 'tab10')\ncountplot.set_xticklabels(countplot.get_xticklabels(), rotation = 90)\ncountplot.set_title(\"Countplot by Region\", y = 1.05);","c49e1891":"fig = plt.figure(figsize = (18, 14))\nax = plt.axes()\n\nstacked_countplot = sns.countplot('Region', data = wh_2020, hue = 'Quartile')\nstacked_countplot.set_xticklabels(countplot.get_xticklabels(), rotation = 90)\nstacked_countplot.set_title(\"Countplot of Quartiles for Each Region\", y = 1.05);\nax.legend(loc = \"upper left\", title = 'Quartile', title_fontsize = 18);","1d1c5806":"print(\"Table of Average Rank for Each Region:\\n\")\nprint(wh_2020.groupby('Region')['Rank'].agg('mean'))","d021e2c6":"# Gather columns corresponding to the six measured values (Logged GDP per capita, social support, etc.)\nfeature_cols = ['Logged GDPPC', 'Social Support', 'Life Expectancy', 'Freedom', 'Generosity', 'Corruption']","f4aa384d":"df = pd.concat([wh_2020['Ladder'], wh_2020[feature_cols]], axis = 1)\n\nfig = plt.figure(figsize = (13, 10))\nplt.style.use('seaborn-white')\n\nplt.matshow(df.corr(), fignum = fig.number, cmap = 'viridis')\nplt.xticks(range(df.shape[1]), df.columns, fontsize=14, rotation=45)\nplt.yticks(range(df.shape[1]), df.columns, fontsize=14)\n\ncb = plt.colorbar()\ncb.ax.tick_params(labelsize=14)\n\nplt.title('Correlation Matrix', fontsize = 24, y = 1.2);","2c08fa5a":"pairplot = sns.pairplot(wh_2020, hue = 'Quartile', vars = feature_cols, corner = False)\npairplot.fig.suptitle(\"Pairplot of the 6 Happiness Metrics\", fontsize = 24, y = 1.05);","de240ae7":"fig, axes = plt.subplots(2, 3, figsize = (20, 12))\n\nfor i, ax in enumerate(axes.flat):\n    ax.plot(wh_2020['Rank'], wh_2020[feature_cols[i]], color = 'red')\n    ax.set_title(feature_cols[i] + ' by Rank', fontsize = 18)\n    ax.set_xlim(153, 1)\n    ax.axis('tight')","1d887aa7":"fig = plt.figure(figsize = (15, 12))\nax = plt.axes()\n\nscatter = ax.scatter(wh_2020['Logged GDPPC'], wh_2020['Social Support'], alpha = 0.4, s = wh_2020['Life Expectancy']**1.5, c = wh_2020['Quartile'], cmap = 'viridis')\nax.set(xlabel = 'Logged GDPPC', ylabel = 'Social Support')\nlegend = ax.legend(*scatter.legend_elements(prop = 'colors', size = 16),\n                    loc = \"lower right\", title = \"Quartile\", title_fontsize = 18)\nax.add_artist(legend);","751ed605":"from sklearn.metrics import mean_squared_error\nfrom sklearn.metrics import mean_absolute_error\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression","65118e5f":"# Designate features and target variable\ny = wh_2020['Ladder']\nX = wh_2020[feature_cols]","f476714c":"# Split data into training and validation sets\nX_train, X_test, y_train, y_test = train_test_split(X, y, random_state = 0, test_size = 0.25)","9ad9f246":"# Fit a linear regression model to the data\nlin_reg_model = LinearRegression()\n\nlin_reg_model.fit(X_train, y_train)","2009ceac":"# Use the fitted model to make predictions\npreds = lin_reg_model.predict(X_test)","2875f6b2":"# Find the average error of our predictions for the validation data\nmean_squared_error(preds, y_test)    ","7183cd5d":"# Another metric for evaluating error\nmean_absolute_error(preds, y_test)    ","4e4d012d":"This notebook will explore an assortment of exploratory data analysis techniques using the World Happiness Report data. This data is mostly clean and ready to use already, so this notebook will focus mainly on EDA and perhaps skip some typical steps in the data science workflow in regards to data cleaning. Afterwards, we will also explore a basic regression model to try to predict the happiness of a country based on various factors such as economic status of citizens, amount of social support, perceptions of corruption, etc., and explore some ways in which we can use our insights gathered from EDA to add to and improve our model.","1cf5d655":"What about the relationship between the overall score\/rank and each of the factors? For instance, does the Life Expectancy generally increase as we progress up the rankings toward happier countries?","737592a3":"Later on, we may find it useful to have the countries split up into percentiles. Let's create a 'Quartile' column that denotes the quartile each country belongs to according to its overall happiness score\/rank.","fb0d61f3":"Let's first quickly see how countries are distributed by region and how happiness differs among the different regions to see if there are any region-specific trends we can pick up on:","5d043d84":"## Barplot\/Countplot","551e2663":"In this notebook, for simplicity, we will focus only on using the data from one particular year, 2020, in our data visualization.","cb3c2a97":"There a couple of pretty clear patterns we can see here. For example, Western Europe, North America, and Latin America all seem to be places where happiness is quite high, whereas places like South Asia and Sub-Saharan Africa appear to be quite unhappy.","5b417d52":"# Loading the Data","82150227":"Some initial ideas that come to mind:\n* Use some type of encoding for the categorical 'Region' variable and turn it into an additional feature; since the regions differ pretty vastly in happiness scores, this extra feature could help our model\n* Get rid of features that aren't very relevant\/use some additional features\n* Use a more complex model","1646d996":"In the above plot, we have Logged GDPPC on the x-axis, Social Support on the y-axis, and the size of the dots corresponding to Life Expectancy. It is clear from the plot that the higher quartiles tend to have higher measurements in all three of these features.","ee600070":"# Cleaning\/Modifying the Data","acabef54":"It looks like the Logged GDPPC, Social Support, and Life Expectancy metrics all have a relatively high correlation with the overall score a country received. Also, these factors each seem to have a pretty high correlation with each other (e.g., Social Support is well correlated with Life Expectancy, and so on). On the other end of the spectrum, Generosity does not seem to have a sizeable correlation with any other measurement, including the Ladder score.","b1a5749e":"## Renaming Columns","d5f9819f":"# Introduction","1ea1c5e7":"# Setup","7c9f9bbe":"# Model Building","641e3857":"Now, let's try to build a simple model to predict the happiness score for each country given the 6 measured values: \n* Logged GDPPC\n* Social Support\n* Life Expectancy\n* Freedom\n* Generosity\n* Corruption","d681bce8":"Let's take our three most indicative\/\"valuable\" variables and create a multidimensional analysis of a country's score in these 3 measurements and quartile.","9a305641":"We can illustrate these differences by region more succinctly with the following:","9ed59ca8":"## Adding Columns to the Data","b84248b2":"Thanks for checking out my notebook (my first Kaggle notebook, actually!), and I would love any feedback\/tips on improving since I am pretty new at this and still have a lot to learn. If you happened to like this notebook, an upvote is greatly appreciated :)","9d8107d7":"As we may have expected, the plots involving variables with a higher correlation with overall score\/ranking display a linear trend as we go from lower to higher ranked countries. The last two plots (which portray variables with low correlation), on the other hand, are fairly \"noisy\" and don't display a very clear linear relationship.","a2961370":"## Scatter Plots","a3f979b2":"## A More Complex Scatterplot","20ba5331":"In some metrics, we can see a stark difference between countries in the first quartile versus countries in the other quartiles (especially 'Corruption'). On the other hand, other measurements seem to be much less relevant in distinguishing happier countries from the rest (look at 'Generosity')","a19eb073":"## Stacked Barplot\/Countplot","b187bc8e":"## Correlation Matrix","2a1795d1":"## Linear Regression","4bfedde4":"## Missing Values","90232d71":"## Line Plots","d0f21e07":"Let's now take a look at the relationship between some of these factors. Scatterplots are great because they let us see at a glance the relative amount of correlation between two particular variables in our data.","a1976043":"The big question: how can we use the insights gathered from the exploratory data analysis above (such as certain regions being a *lot* happier on average, some features being highly correlated with happiness score while others are not, etc.) to improve upon this most basic of models? Additionally, what other things can we implement in our EDA to discover additional trends in the data? This is what I'll continue to explore in the future, and hopefully I can create a much more robust model in the future.","6ced2b7e":"# Data Visualization","59e5435d":"Let's now look at the relationships between each of the six measured values (Logged GDP per capita, social support, etc.) and the overall ladder score to perhaps highlight which features may be more\/less important."}}