{"cell_type":{"78cdfdf6":"code","85761e40":"code","c6166658":"code","11372d14":"code","4d683a63":"code","a02d9190":"code","b89b6727":"code","83d121e7":"code","2b5e3393":"code","965d125f":"code","7d337388":"code","0d5da877":"code","b206bbd9":"code","56cc766f":"code","6a725402":"code","3858c00c":"code","7cd41969":"code","86f95ff7":"code","bbf4229c":"code","2252d831":"code","8160c4f7":"code","687ab822":"code","1ed4e50b":"code","45ca57cb":"code","d71e0b7b":"code","2ff4c3e7":"code","ea50ff0e":"code","281c9f27":"code","a71c863e":"code","7037896c":"code","d45a02f8":"code","fdd90c89":"code","16b217ae":"code","3d784a5f":"code","fed36c00":"code","449c586d":"code","eda850a9":"code","1d1f7ea2":"code","f40057bc":"code","aa5d82d0":"code","220afea4":"code","85f28e48":"code","34696937":"code","71555086":"code","ed38e630":"code","b217c1cf":"code","1c2ad0fb":"markdown","109422de":"markdown","25f35c7f":"markdown","5a958f95":"markdown","bb0441f6":"markdown","36c0bde9":"markdown","594c7183":"markdown","d103e7f7":"markdown","6c9869f5":"markdown","33d91c46":"markdown","5bc8f562":"markdown","0986bf5f":"markdown","1eb41d72":"markdown","6f1e04db":"markdown","84ec753c":"markdown","d7a7cea1":"markdown","f24d2f59":"markdown","51f37d7c":"markdown","b3b81081":"markdown","eb3c5e64":"markdown"},"source":{"78cdfdf6":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import roc_auc_score\npd.set_option('display.max_columns', 60) #Display 60 columns for better visualitation. \nfrom pandas.api.types import CategoricalDtype\nimport warnings\nwarnings.simplefilter(\"ignore\")","85761e40":"df = pd.read_csv('..\/input\/compas-scores\/compas-scores.csv')\ndf = pd.DataFrame(df)","c6166658":"df.head(4)","11372d14":"df.info()","4d683a63":"#'num_vr_cases', 'num_r_cases', son columnas completamente vacias que se deben eliminar\n#Empty columns\ndf = df.drop(['num_vr_cases', 'num_r_cases'], axis =1)","a02d9190":"#Selection of Columns that will be useful to find the desired insights \n#Seleccion de Columnas que seran de utilidad para encontrar los insights buscados\n\ndf1 = df[['id', 'name', 'sex', 'age', 'age_cat', 'is_recid', 'is_violent_recid','decile_score', 'v_decile_score', 'vr_offense_date', \n'r_offense_date', 'race', 'score_text', 'v_score_text', 'priors_count', 'compas_screening_date']].copy()","b89b6727":"df1.head(3)","83d121e7":"def describe_columna(df, col):\n    print(f'Columna: {col}  -  Tipo de datos: {df[col].dtype}')\n    print(f'N\u00famero de valores nulos: {df[col].isnull().sum()}  -  N\u00famero de valores distintos: {df[col].nunique()}')\n    print('Valores m\u00e1s frecuentes:')\n    for i, v in df[col].value_counts().iloc[:10].items() :\n        print(i, '\\t', v)","2b5e3393":"describe_columna(df1, 'id')\n#Columna se encuentra completa, con solo valores unicos, utilizables como indices e identificadores.","965d125f":"describe_columna(df1, 'name')","7d337388":"df1[df1.name.duplicated(keep = False)].sort_values(by = 'name')","0d5da877":"describe_columna(df1, 'sex')\n# Columna integra, valida y sin nulos.","b206bbd9":"print(describe_columna(df1, 'age'))\nprint(df1.age.min() )\nprint(df1.age.max()) ","56cc766f":"print(describe_columna(df1, 'age_cat'))\n# Columna sin valores nulos, integra y valida.","6a725402":"print(describe_columna(df1, 'is_recid'))","3858c00c":"#Esos 719 valores sin antecedentes de reincidencia se deben eliminar\ndf1 = df1.drop(df1[df1['is_recid']==-1].index)","7cd41969":"print(describe_columna(df1, 'is_recid')) ","86f95ff7":"# Transform the columns that should be categorical\n# Transformar a categoricos las columnas que deberian serlo\n\nfor col in ['sex', 'age_cat']:\n    df1[col] = df1[col].astype('category')\n   # 'decile_score', 'v_decile_score''is_recid', 'is_violent_recid',","bbf4229c":"print(describe_columna(df1, 'is_violent_recid'))\n#COlumna integra y valida","2252d831":"print(describe_columna(df1, 'decile_score'))\n#Columna integra y valida sin valores nulos","8160c4f7":"print(describe_columna(df1, 'v_decile_score'))\n#Columna integra y valida sin valores nulos","687ab822":"print(describe_columna(df1, 'r_offense_date'))\n# 3703 filas con informacion las cuales cuadran perfectamente con la cantidad de casos reincidentes\n#que son 3703","1ed4e50b":"#Tranformar to Date Time r_offense_date y vr_offense_date\ndf1.r_offense_date = pd.to_datetime(df1.r_offense_date, format=\"%Y-%m-%d\")\ndf1.vr_offense_date = pd.to_datetime(df1.vr_offense_date, format=\"%Y-%m-%d\")","45ca57cb":"print(describe_columna(df1, 'vr_offense_date'))","d71e0b7b":"#Column complete, complete and valid. It transforms to Date Time\n#Columna completa, integta y valida. Se tranforma a Date Time\n\ndf1.compas_screening_date = pd.to_datetime(df1.compas_screening_date, format=\"%Y-%m-%d\")\n\nprint(describe_columna(df1, 'compas_screening_date'))","2ff4c3e7":"# Min and max dates of our dataframe to determine how to use them\n#Fechas min y max de nuestro dataframe para determinar como utilizarlas\n\nrod = df1.r_offense_date.min(), df1.r_offense_date.max()\nvrod = df1.vr_offense_date.min(), df1.vr_offense_date.max()\ncsd = df1.compas_screening_date.min(), df1.compas_screening_date.max()\nprint('r_offense_date \\n', {rod})\nprint('vr_offense_date \\n', {vrod})\nprint('compas_screening_date \\n', {csd})","ea50ff0e":"#Distribuci\u00f3n de decile score segun puntaje.\ntest = df1.groupby('decile_score')['id'].count()\nprint(test)","281c9f27":"violent = df1[df1.is_violent_recid == 1]","a71c863e":"violent.groupby('decile_score')['id'].count()","7037896c":"#Pearson correlation between numerical variables.\n#Correlacion Pearson entre variables numericas.\n\ncorrelation = df1.corr()\nf, ax = plt.subplots(figsize=(4,4))\nplt.title('Correlation of numerical attributes', size=10)\nsns.heatmap(correlation)\nplt.show()","d45a02f8":"correlation['v_decile_score'].sort_values(ascending=False).head(10)","fdd90c89":"correlation['decile_score'].sort_values(ascending=False).head(10)","16b217ae":"df1.shape","3d784a5f":"#A variable is created with the date that will be filtered in the DF\n#Se crea variable con la fecha que se filtrara en el DF\nfrom datetime import datetime\nfecha = '2014:01:01'\nfecha_limite = datetime.strptime(fecha, '%Y:%M:%S')","fed36c00":"def modelo1(caso):\n    if  caso['is_violent_recid'] == 1 and caso['race'] == ('African-American') and caso['vr_offense_date'] > fecha_limite and caso['age_cat'=='Less than 25']:\n        return 1\n    else:\n        return 0","449c586d":"score1 = df1.apply(lambda x: modelo1(x), axis = 1)","eda850a9":"roc_auc_score((df1['v_score_text'] == 'High'), score1)","1d1f7ea2":"tc = pd.crosstab(score1, (df1['v_decile_score'] >= 7))\ntc","f40057bc":"#Calcular prediccion de la feature para IS_RECID\n#Predictions for IS_recid\ndef modelo2(caso):\n    if  caso['is_recid'] == 1 or caso['is_violent_recid'] == 1 and caso['r_offense_date'] > fecha_limite and caso['age_cat'=='Less than 25'] and caso['sex'] == 'Male':\n        return 1\n    else:\n        return 0","aa5d82d0":"score2 = df1.apply(lambda x: modelo2(x), axis = 1).rename('Predicci\u00f3n')","220afea4":"roc_auc_score((df1['decile_score'] >= 7), score2)\n\n#Feature que nos entrega un valor de aciertos cercano al 61%. ","85f28e48":"tc1 = pd.crosstab(score2, (df1['decile_score'] >= 7))\ntc1","34696937":"#Decile_score and v_decile_score -1 values are removed to plot\n#Se eliminan valores -1 de decile_score y v_decile_score para graficar\ndf1 = df1.drop(df1[df1['v_decile_score']==-1].index)\ndf1 = df1.drop(df1[df1['decile_score']==-1].index)\n","71555086":"\n#RACE\ndfgb = df1.groupby(\"race\")\nrace_count = df1.groupby(\"race\")[\"name\"].count()\n\nfig, ax = plt.subplots(3, figsize=(14, 8))\n\nfor (i, race) in enumerate([\"African-American\", \"Caucasian\", \"Hispanic\"]):\n    (\n        (dfgb\n            .get_group(race)\n            .groupby(\"decile_score\")[\"name\"].count() \/ race_count[race]\n        )\n        .plot(kind=\"bar\", ax=ax[i], color=\"#353535\")\n    )\n    ax[i].set_ylabel(race)\n    ax[i].set_xlabel(\"\")\n   \n    ax[i].set_ylim(0, 0.32)\n\nfig.suptitle(\"Score Frequency by Race\")\nplt.show()","ed38e630":"#Sex\ndfgb = df1.groupby(\"sex\")\nrace_count = df1.groupby(\"sex\")[\"name\"].count()\n\nfig, ax = plt.subplots(2, figsize=(14, 8))\n\nfor (i, sex) in enumerate([\"Male\", \"Female\"]):\n    (\n        (dfgb\n            .get_group(sex)\n            .groupby(\"decile_score\")[\"name\"].count() \n         #\/ race_count[race]\n        )\n        .plot(kind=\"bar\", ax=ax[i], color=\"#353535\")\n    )\n    ax[i].set_ylabel(sex)\n    ax[i].set_xlabel(\"\")\n   \n #   ax[i].set_ylim(0, 0.)\n\nfig.suptitle(\"Score Frequency by Race\")\nplt.show()","b217c1cf":"#Age\ndfgb = df1.groupby(\"age_cat\")\nrace_count = df1.groupby(\"age_cat\")[\"name\"].count()\n\nfig, ax = plt.subplots(3, figsize=(14, 8))\n\nfor (i, age_cat) in enumerate([\"Less than 25\", \"25 - 45\", \"Greater than 45\"]):\n    (\n        (dfgb\n            .get_group(age_cat)\n            .groupby(\"decile_score\")[\"name\"].count() \n        )\n        .plot(kind=\"bar\", ax=ax[i], color=\"#353535\")\n    )\n    ax[i].set_ylabel(age_cat)\n    ax[i].set_xlabel(\"\")\n   \n #   ax[i].set_ylim(0, 0.)\n\nfig.suptitle(\"Score Frequency by age category\")\nplt.show()","1c2ad0fb":"There are a series of possibly duplicate values so I must check if it is just a coincidence\nnames or it could mean a problem.\nAccording to what was observed, there would be no duplication in the names. It is important to mention the case of Alejandro Cabrebra, who could be a repeated case, but it is a second evaluation of COMPAS According to the date\n\nExisten una serie de valores posiblemente duplicados por lo que debo revisar si es solo coincidencia \nde nombres o podria significar un problema.\nDe acuerdo a lo observado no existir\u00eda duplicidad en los nombres. Importante mencionar el caso de Alejandro Cabrebra quien si podria resultar un caso repetido, pero se trata de una segunda evaluacion de COMPAS Segun la fecha","109422de":"5.- \u00bfPara qu\u00e9 tipo de riesgos, el de delitos generales o el de delitos violentos, tiene el sistema m\u00e1s capacidad predictiva?\n5.- For what types of risks, general crimes or violent crimes, does the system have the most predictive capacity?","25f35c7f":"### \u00bfWhat we will do in this notbook? \n### \u00bfQue se realizar\u00e1 en este notbook? \n1.-Load the data and carry out an exploratory analysis and an evaluation of the quality of the data necessary for the rest of the case. Specifically, evaluate the integrity, validity and timeliness of the data and propose mitigation strategies for the possible problems encountered.\n\n1.-Cargar los datos y realizar un an\u00e1lisis exploratorio y una evaluaci\u00f3n de la calidad de los datos necesarios para el resto del caso. Espec\u00edficamente, evaluar la integridad, validez y actualidad de los datos y proponer estrategias de mitigaci\u00f3n de los posibles problemas encontrados.","5a958f95":"### I will analyze column by column integrity, validity and timeliness\n### Analizar\u00e9 columna por columna integridad, validez y actualidad","bb0441f6":"According to the Feature created, both for is_recid and for is_violent recid the results are close to 54% correct. However, when using both columns of information (is_recid == 1 and is_violent_recid == 1) it is possible to obtain a value close to 60%, so it could be assumed that both data have a similar predictive power \/\/\/\n\n\nDe acuerdo a la Feature creada, tanto para is_recid, como para is_violent recid los resultados son cercanos al 54% de acierto. Sin embargo al utilizar ambas columans de informacion (is_recid == 1 and is_violent_recid == 1) se logta obtener un valor cercano al 60% por lo que podria asumir que ambas datas poseen un poder predictivo similar\/\/\/","36c0bde9":"In the case of the differences for men and women, a tendency can be observed in the graph that fewer women are at the top of the decile_score than men.\n\nPara el caso de las diferencias para hombres y mujeres se puede observar en la gr\u00e1fica una tendencia a que menos mujeres estan en lo mas alto del decile_score a diferencia de los hombres. ","594c7183":"## Exploratory analisis","d103e7f7":"### Analisis de las fechas de nuestro DF","6c9869f5":"#### values between the ranges of 18 and 96 years, without null values \u200b\u200bso it is also an integral and valid column.\n#### valores entre los rangos de 18 y 96 a\u00f1os, sin valores nulos por lo que tambien es una columna integra y valida.","33d91c46":"#### As can be seen in the graph, the distribution in the decile score of black people is uniformly distributed from 1 to 10, while for the other races, the vast majority of cases are in the lower values of the decile_score.\n\n#### Como se puede ver en el gr\u00e1fico, la distribucion en el decile score de las personas de raza negra se encuentra uniformemente distribuida del 1 al 10, Mientras que para las demas razas, la gran mayor\u00eda de los casos se encuentran en los valores mas bajos del decile_score.","5bc8f562":"### 3.- The threshold to establish preventive measures for recidivism is 7 or more.\nGiven this threshold, generate a contingency table, explaining which case is considered \"positive\" (and, therefore, what are the type I errors and the type II errors).\n\n### 3.- El umbral para establecer medidas preventivas de la reincidencia es de 7 en adelante.\nDado este umbral, generar una tabla de contingencia, explicando qu\u00e9 caso se considera como \u201cpositivo\u201d (y, por lo tanto, cu\u00e1les son los errores de tipo I y los errores de tipo II).","0986bf5f":"Finally, when analyzing the graphs for age, large differences can be seen between the 3 age groups plotted, where those under 25 years of age have a distribution that is highly oriented towards the highest indices, rather than differences from the older age group.\n\nFinalmente al analisis de los graficos para edad, se pueden ver grandes diferencias entre los 3 grupos etarios graficados en donde los menores de 25 a\u00f1os tienen una distribuci\u00f3n muy orientada hacia los indices mas alto a diferencias del grupo de mayor edad. ","1eb41d72":"882 cases also coincide with the number of people marked as violent repeat offenders in\ncolumn \"is_violent_recid, but must be formatted as date.\n\n882 casos tambien coincidentes con el numero de personas marcadas como reincidentes violentos en \nla columna \" is_violent_recid, pero se debe dar formato de fecha.","6f1e04db":"As can be seen in the upper contingency table, type I errors correspond to false positives in the upper right corner.\nwhere 1458 people are considered according to the prediction as not possible\nRepeat offenders do but actually have a Decile_Score> = 7.\nType II errors correspond to the lower left corner (2200 cases) where our prediction gives results of possible repeat offenders (> = 7) but in reality they are with a decile_score <7. False negatives.\n\nComo se puede apreciar en la tabla de contigencia superior los errores de tipo I corresponden a los falsos positivos de la esquina superior derecha\nen donde 1458 personas se consideran segun la predicci\u00f3n como no posibles \nreincidentes te pero en realidad tienen un Decile_Score >= 7.\nLos errores de tipo II corresponden a la esquina inferior izquierda (2200 casos) en donde nuestra predicci\u00f3n entrega resultados de posibles reincidentes (>=7) pero en realidad estan con un decile_score <7. Falsos negativos.","84ec753c":"From this pearson correlation we can see that is_recid, is_violent_recid together provide an approximation of 40% correlation with the 'Target' But it is not enough, so a two-year date range conditional will be added to calculate the recurrences\n__________________\nDe esta correlacion de pearson podemos ver que is_recid, is_violent_recid en conjunto proveen una aproximacion del 40% de correlacion con el 'Target' Pero no es suficiente, por lo que se agregara un condicional de rango de fecha de dos a\u00f1os para calcular las reincidencias","d7a7cea1":"## 2.- Are the \u201cis_recid\u201d and \u201cis_violent_recid\u201d fields in this data set adequate to evaluate the precision of the risk estimates generated by the COMPAS system? If not, define and calculate a feature that is.\n\n## 2.- \u00bfSon los campos \u201cis_recid\u201d e \u201cis_violent_recid\u201d en este conjunto de datos adecuados para evaluar la precisi\u00f3n de las estimaciones de riesgo generadas por el sistema COMPAS? Si no es as\u00ed, definir y calcular una feature que s\u00ed lo sea.","f24d2f59":"## 4.- Graph the differences according to factors of race, sex and age\n## 4.- Graficar las diferencias de acuerdos a factores de raza, sexo y edad ","51f37d7c":"Creation of the manual model with which we will seek to answer the questions. It is important to mention that this is what was used some years ago before Machine Learning, creating artificial features. Today, thanks to ML models, significantly higher results can be obtained. The importance of this is to explain and understand the workings behind a ML model.\n\nCreaci\u00f3n del modelo manual con el cual se buscar\u00e1 dar respuesta a las preguntas. Importante mencionar que esto es lo que hace alguno a\u00f1os se utilizaba antes del Machine Learning, creando features artificales. Actualmente gracias a los modelos de ML se pueden obtener resultados significativamente mayores. La importancia de esto es explicar y entender el funcionamiento detras de un modelo de ML.","b3b81081":"Verification of the effectiveness of our model. Quite low as expected.\nVerificacion de la efectividad de nuestro modelo. Bastante bajo como era de esperarse. ","eb3c5e64":"Version English Spanish International Master's work in Data Science, (Europe). Pre Machine Learning Module\n\nVersion ingles espa\u00f1ol trabajo de Master internacional en Data Science, Europa. Modulo Pre Machine Learning.\n\n**# Correctional offender management profiling for alternative sanctions\n\nThe introduction of data science into the field of law and justice is becoming more and more frequent, a well-known example of this is the COMPAS (Correctional offender management profiling for alternative sanctions) system that is used in several states of the United States. to make an assessment of the risk of recidivism of detained persons\n__________________________________________\n\nCada d\u00eda es m\u00e1s frecuente la introducci\u00f3n de la ciencia de datos en el \u00e1mbito del derecho y la justicia.Un ejemplo bien conocido de ello es el sistema COMPAS (Correctional offender management profiling for alternative sanctions) que se usa en varios estados de los Estados Unidos para hacer una evaluaci\u00f3n del riesgo de reincidencia de las personas detenidas\n\n\n"}}