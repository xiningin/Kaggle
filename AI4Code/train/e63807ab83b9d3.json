{"cell_type":{"2d8e72ea":"code","d544e6d8":"code","106c3fc6":"code","37b59c95":"code","f9997229":"code","42639c9f":"code","850ae4a6":"code","627a5475":"code","c17e1f77":"code","eb3333d4":"code","e61d6568":"code","29d4a9dd":"code","2c399edc":"code","fcba9744":"code","5eede3dd":"code","be4ec44e":"code","0581b6fe":"code","3e53f0ee":"code","bdc6943c":"code","eb6156ac":"code","77c2c328":"code","b5aaa093":"code","6bfb5e31":"code","3613c513":"code","83a7de33":"code","63c58e88":"code","4505726b":"code","acf05c6e":"code","20fb820c":"code","a76bed15":"code","346b00e5":"markdown"},"source":{"2d8e72ea":"import numpy as np\nimport pandas as pd\nimport os\nimport matplotlib.pyplot as plt\n\nimport tensorflow as tf\nfrom tensorflow.keras.utils import to_categorical\nfrom tensorflow.keras.preprocessing.image import load_img, img_to_array\nfrom tensorflow.python.keras.preprocessing.image import ImageDataGenerator\n\nfrom sklearn.metrics import classification_report, log_loss, accuracy_score\nfrom sklearn.model_selection import train_test_split","d544e6d8":"File=[]\nfor dirname, _, filenames in os.walk('..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TRAIN'):\n    for filename in filenames:\n        File+=[os.path.join(dirname, filename)]\n        \nFile2=[]\nfor file in File:\n    if file[-5:]=='.jpeg':\n        File2+=[file]\n        \nTrain_img=File2","106c3fc6":"File=[]\nfor dirname, _, filenames in os.walk('..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TEST'):\n    for filename in filenames:\n        File+=[os.path.join(dirname, filename)]\n        \nFile2=[]\nfor file in File:\n    if file[-5:]=='.jpeg':\n        File2+=[file]\n        \nTest_img=File2","37b59c95":"Name0=[]\nfor dirname, _, filenames in os.walk('..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images'):\n    Name0+=[dirname]\n\nName1=[]\nfor item in Name0:\n    Name1+=[item[60:]]\n\nName2=[]\nfor item in Name1:\n    for i in range(len(item)):\n        if (item[i]=='\/'):\n            name=item[i+1:]\n            if name not in Name2:\n                Name2+=[name]\n                \nName3=sorted(Name2)\n\nprint(Name3)","f9997229":"dir0='..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TRAIN\/EOSINOPHIL'\ndir1='..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TRAIN\/LYMPHOCYTE'\ndir2='..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TRAIN\/MONOCYTE'\ndir3='..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TRAIN\/NEUTROPHIL'\n\ndir4='..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TEST\/EOSINOPHIL'\ndir5='..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TEST\/LYMPHOCYTE'\ndir6='..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TEST\/MONOCYTE'\ndir7='..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TEST\/NEUTROPHIL'","42639c9f":"Dirs=[dir0,dir1,dir2,dir3]\nDirs2=[dir4,dir5,dir6,dir7]\nmapping={ Name3[0]:0,Name3[1]:1,Name3[2]:2,Name3[3]:3 }","850ae4a6":"dataset=[]\ncount=0\nfor dirs in Dirs:\n    for file in Train_img:\n        if dirs in file:\n            image=load_img(file, grayscale=False, color_mode='rgb', target_size=(120,120))\n            image=img_to_array(image)\n            image=image\/255\n            dataset.append([image,count])\n    count=count+1","627a5475":"data0,labels0=zip(*dataset)","c17e1f77":"labels1=to_categorical(labels0)\n\ndata=np.array(data0)\nlabels=np.array(labels1)\n\nprint(data.shape)\nprint(labels.shape)","eb3333d4":"dataset2=[]\ncount=0\nfor dirs in Dirs2:\n    for file in Test_img:\n        if dirs in file:\n            image=load_img(file, grayscale=False, color_mode='rgb', target_size=(120,120))\n            image=img_to_array(image)\n            image=image\/255\n            dataset2.append([image,count])\n    count=count+1","e61d6568":"tdata0,tlabels0=zip(*dataset2)","29d4a9dd":"tlabels1=to_categorical(tlabels0)\n\ntdata=np.array(tdata0)\ntlabels=np.array(tlabels1)\n\nprint(tdata.shape)\nprint(tlabels.shape)","2c399edc":"trainx,testx,trainy,testy=train_test_split(data,labels,test_size=0.2,random_state=44)","fcba9744":"print(trainx.shape)\nprint(testx.shape)\nprint(trainy.shape)\nprint(testy.shape)","5eede3dd":"datagen = ImageDataGenerator(horizontal_flip=True,vertical_flip=True,rotation_range=20,zoom_range=0.2,\n                        width_shift_range=0.2,height_shift_range=0.2,shear_range=0.1,fill_mode=\"nearest\")","be4ec44e":"pretrained_model0 = tf.keras.applications.MobileNetV2(input_shape=(120,120,3),include_top=False,weights='imagenet',pooling='avg')\npretrained_model1 = tf.keras.applications.ResNet50(input_shape=(120,120,3),include_top=False,weights='imagenet',pooling='avg')\npretrained_model2 = tf.keras.applications.VGG16(input_shape=(120,120,3),include_top=False,weights='imagenet',pooling='avg')\npretrained_model3 = tf.keras.applications.DenseNet121(input_shape=(120,120,3),include_top=False,weights='imagenet',pooling='avg')\npretrained_model4 = tf.keras.applications.Xception(input_shape=(120,120,3),include_top=False,weights='imagenet',pooling='avg')\npretrained_model5 = tf.keras.applications.InceptionV3(input_shape=(120,120,3),include_top=False,weights='imagenet',pooling='avg')\n\npretrained_model0.trainable = False\npretrained_model1.trainable = False\npretrained_model2.trainable = False\npretrained_model3.trainable = False\npretrained_model4.trainable = False\npretrained_model5.trainable = False","0581b6fe":"inputs0 = pretrained_model0.input\ninputs1 = pretrained_model1.input\ninputs2 = pretrained_model2.input\ninputs3 = pretrained_model3.input\ninputs4 = pretrained_model4.input\ninputs5 = pretrained_model5.input\n\nx0 = tf.keras.layers.Dense(128, activation='relu')(pretrained_model0.output)\noutputs0 = tf.keras.layers.Dense(4, activation='softmax')(x0)\nx1 = tf.keras.layers.Dense(128, activation='relu')(pretrained_model1.output)\noutputs1 = tf.keras.layers.Dense(4, activation='softmax')(x1)\nx2 = tf.keras.layers.Dense(128, activation='relu')(pretrained_model2.output)\noutputs2 = tf.keras.layers.Dense(4, activation='softmax')(x2)\nx3 = tf.keras.layers.Dense(128, activation='relu')(pretrained_model3.output)\noutputs3 = tf.keras.layers.Dense(4, activation='softmax')(x3)\nx4 = tf.keras.layers.Dense(128, activation='relu')(pretrained_model4.output)\noutputs4 = tf.keras.layers.Dense(4, activation='softmax')(x4)\nx5 = tf.keras.layers.Dense(128, activation='relu')(pretrained_model5.output)\noutputs5 = tf.keras.layers.Dense(4, activation='softmax')(x5)\n\nmodel0 = tf.keras.Model(inputs=inputs0, outputs=outputs0)\nmodel1 = tf.keras.Model(inputs=inputs1, outputs=outputs1)\nmodel2 = tf.keras.Model(inputs=inputs2, outputs=outputs2)\nmodel3 = tf.keras.Model(inputs=inputs3, outputs=outputs3)\nmodel4 = tf.keras.Model(inputs=inputs4, outputs=outputs4)\nmodel5 = tf.keras.Model(inputs=inputs5, outputs=outputs5)","3e53f0ee":"#model0.summary()\n#model1.summary()\n#model2.summary()\n#model3.summary()\n#model4.summary()\n#model5.summary()","bdc6943c":"model0.compile(loss = 'categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\nmodel1.compile(loss = 'categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\nmodel2.compile(loss = 'categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\nmodel3.compile(loss = 'categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\nmodel4.compile(loss = 'categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\nmodel5.compile(loss = 'categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\n\nhis0=model0.fit(datagen.flow(trainx,trainy,batch_size=32),validation_data=(testx,testy),epochs=10)\nhis1=model1.fit(datagen.flow(trainx,trainy,batch_size=32),validation_data=(testx,testy),epochs=10)\nhis2=model2.fit(datagen.flow(trainx,trainy,batch_size=32),validation_data=(testx,testy),epochs=10)\nhis3=model3.fit(datagen.flow(trainx,trainy,batch_size=32),validation_data=(testx,testy),epochs=10)\nhis4=model4.fit(datagen.flow(trainx,trainy,batch_size=32),validation_data=(testx,testy),epochs=10)\nhis5=model5.fit(datagen.flow(trainx,trainy,batch_size=32),validation_data=(testx,testy),epochs=10)","eb6156ac":"y_pred0=model0.predict(testx)\ny_pred1=model1.predict(testx)\ny_pred2=model2.predict(testx)\ny_pred3=model3.predict(testx)\ny_pred4=model4.predict(testx)\ny_pred5=model5.predict(testx)\n\npred0=np.argmax(y_pred0,axis=1)\npred1=np.argmax(y_pred1,axis=1)\npred2=np.argmax(y_pred2,axis=1)\npred3=np.argmax(y_pred3,axis=1)\npred4=np.argmax(y_pred4,axis=1)\npred5=np.argmax(y_pred5,axis=1)\n\nground = np.argmax(testy,axis=1)\nfrom sklearn.metrics import classification_report\n\nprint(classification_report(ground,pred0))\nprint(classification_report(ground,pred1))\nprint(classification_report(ground,pred2))\nprint(classification_report(ground,pred3))\nprint(classification_report(ground,pred4))\nprint(classification_report(ground,pred5))","77c2c328":"get_acc0 = his0.history['accuracy']\nget_acc1 = his1.history['accuracy']\nget_acc2 = his2.history['accuracy']\nget_acc3 = his3.history['accuracy']\nget_acc4 = his4.history['accuracy']\nget_acc5 = his5.history['accuracy']\n\nepochs = range(len(get_acc0))\n\nplt.plot(epochs, get_acc0, 'r', label='MobileNetV2')\nplt.plot(epochs, get_acc1, 'b', label='ResNet50')\nplt.plot(epochs, get_acc2, 'g', label='VGG16')\nplt.plot(epochs, get_acc3, 'y', label='DenseNet121')\nplt.plot(epochs, get_acc4, 'm', label='Xception')\nplt.plot(epochs, get_acc5, 'c', label='InceptionV3')\n\nplt.title('Accuracy comparison')\nplt.legend(loc=0)\nplt.figure()\n\nplt.show()","b5aaa093":"get_loss0 = his0.history['loss']\nget_loss1 = his1.history['loss']\nget_loss2 = his2.history['loss']\nget_loss3 = his3.history['loss']\nget_loss4 = his4.history['loss']\nget_loss5 = his5.history['loss']\n\nepochs = range(len(get_loss0))\n\nplt.plot(epochs, get_loss0, 'r', label='MobileNetV2')\nplt.plot(epochs, get_loss1, 'b', label='ResNet50')\nplt.plot(epochs, get_loss2, 'g', label='VGG16')\nplt.plot(epochs, get_loss3, 'y', label='DenseNet121')\nplt.plot(epochs, get_loss4, 'm', label='Xception')\nplt.plot(epochs, get_loss5, 'c', label='InceptionV3')\n\nplt.title('Loss comparison')\nplt.legend(loc=0)\nplt.figure()\n\nplt.show()","6bfb5e31":"value_acc0 = his0.history['val_accuracy']\nvalue_acc1 = his1.history['val_accuracy']\nvalue_acc2 = his2.history['val_accuracy']\nvalue_acc3 = his3.history['val_accuracy']\nvalue_acc4 = his4.history['val_accuracy']\nvalue_acc5 = his5.history['val_accuracy']\n\nepochs = range(len(get_acc0))\n\nplt.plot(epochs, value_acc0, 'r', label='MobileNetV2')\nplt.plot(epochs, value_acc1, 'b', label='ResNet50')\nplt.plot(epochs, value_acc2, 'g', label='VGG16')\nplt.plot(epochs, value_acc3, 'y', label='DenseNet121')\nplt.plot(epochs, value_acc4, 'm', label='Xception')\nplt.plot(epochs, value_acc5, 'c', label='InceptionV3')\n\nplt.title('Validation accuracy comparison')\nplt.legend(loc=0)\nplt.figure()\n\nplt.show()","3613c513":"val_loss0 = his0.history['val_loss']\nval_loss1 = his1.history['val_loss']\nval_loss2 = his2.history['val_loss']\nval_loss3 = his3.history['val_loss']\nval_loss4 = his4.history['val_loss']\nval_loss5 = his5.history['val_loss']\n\nepochs = range(len(val_loss0))\n\nplt.plot(epochs, val_loss0, 'r', label='MobileNetV2')\nplt.plot(epochs, val_loss1, 'b', label='ResNet50')\nplt.plot(epochs, val_loss2, 'g', label='VGG16')\nplt.plot(epochs, val_loss3, 'y', label='DenseNet121')\nplt.plot(epochs, val_loss4, 'm', label='Xception')\nplt.plot(epochs, val_loss5, 'c', label='InceptionV3')\n\nplt.title('Validation loss comparison')\nplt.legend(loc=0)\nplt.figure()\n\nplt.show()","83a7de33":"load_img(\"..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TEST\/LYMPHOCYTE\/_0_1022.jpeg\",target_size=(120,120))","63c58e88":"image=load_img(\"..\/input\/blood-cells\/dataset2-master\/dataset2-master\/images\/TEST\/LYMPHOCYTE\/_0_1022.jpeg\",target_size=(120,120))\n\nimage=img_to_array(image) \nimage=image\/255\nprediction_image=np.array(image)\nprediction_image=np.expand_dims(image, axis=0)","4505726b":"reverse_mapping={ 0:Name3[0],1:Name3[1],2:Name3[2],3:Name3[3] }\n\ndef mapper(value):\n    return reverse_mapping[value]\n\npred0=model0.predict(prediction_image)\nvalue0=np.argmax(pred0)\nmove_name=mapper(value0)\n\nprint(\"Prediction is {}.\".format(move_name))","acf05c6e":"print(tdata.shape)\npred20=model0.predict(tdata)\npred21=model1.predict(tdata)\npred22=model2.predict(tdata)\npred23=model3.predict(tdata)\npred24=model4.predict(tdata)\npred25=model5.predict(tdata)\nprint(pred20.shape)\n\nPRED0=[]\nfor item in pred20:\n    value2=np.argmax(item)      \n    PRED0+=[value2]\n\nPRED1=[]\nfor item in pred21:\n    value2=np.argmax(item)      \n    PRED1+=[value2]\n    \nPRED2=[]\nfor item in pred22:\n    value2=np.argmax(item)      \n    PRED2+=[value2]\n    \nPRED3=[]\nfor item in pred23:\n    value2=np.argmax(item)      \n    PRED3+=[value2]\n\nPRED4=[]\nfor item in pred24:\n    value2=np.argmax(item)      \n    PRED4+=[value2]\n    \nPRED5=[]\nfor item in pred25:\n    value2=np.argmax(item)      \n    PRED5+=[value2]","20fb820c":"ANS=tlabels0","a76bed15":"accuracy0=accuracy_score(ANS,PRED0)\naccuracy1=accuracy_score(ANS,PRED1)\naccuracy2=accuracy_score(ANS,PRED2)\naccuracy3=accuracy_score(ANS,PRED3)\naccuracy4=accuracy_score(ANS,PRED4)\naccuracy5=accuracy_score(ANS,PRED5)\n\nprint(accuracy0)\nprint(accuracy1)\nprint(accuracy2)\nprint(accuracy3)\nprint(accuracy4)\nprint(accuracy5)","346b00e5":"# Blood Cell Keras Applications Comparison\n### among MobileNetV2, ResNet50, VGG16, DenseNet121, Xception and InceptionV3"}}