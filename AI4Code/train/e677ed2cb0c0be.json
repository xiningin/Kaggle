{"cell_type":{"c44ddb51":"code","bbae8d2b":"code","c28604a1":"code","bbd24730":"code","3187ff59":"code","7bdd346a":"code","7175a3e0":"code","48f31ab7":"code","e2b412f4":"code","87214374":"code","538aeccb":"code","9b649d10":"code","cfd2a7cc":"code","713ff993":"markdown","2bbebd42":"markdown","5c4da0de":"markdown","80a7402d":"markdown","798beab7":"markdown"},"source":{"c44ddb51":"import math, time, datetime\nfrom datetime import date, datetime, timedelta\nimport numpy as np, pandas as pd\n\nimport folium \nimport webbrowser\n\nfrom fbprophet import Prophet\nfrom sklearn.metrics import mean_absolute_error\n\nfrom fbprophet.plot import plot_plotly, plot_components_plotly\nimport matplotlib.pyplot as plt \nimport seaborn as sns\nimport plotly.graph_objects as go\nimport plotly.express as px","bbae8d2b":"data = pd.read_csv('..\/input\/covid19-morocco\/covid19-morocco.csv')\ndregions = pd.read_csv('..\/input\/covid19-morocco\/covid19-morocco-regions.csv')\nregional_data = pd.read_csv('..\/input\/covid19-morocco\/regions-morocco.csv')\ndata[\"date\"] = pd.to_datetime(data['date'], dayfirst=True)\ndata = data[data[\"date\"] <= pd.Timestamp(date.today())]","c28604a1":"cnf, dth, rec, act = '#393e46', '#ff2e63', '#21bf73', '#fe9801' \ntemp = data[['date','total_deaths', 'recovered', 'active_cases']].tail(1)\ntemp = temp.melt(id_vars = \"date\", value_vars = ['active_cases', 'total_deaths', 'recovered'])\nfig = px.treemap(temp, path = [\"variable\"], values = \"value\", height = 225, \n                 color_discrete_sequence = [rec, act, dth])\nfig.data[0].textinfo = 'label+text+value'\nfig.show()","bbd24730":"line_data = data.groupby('date').sum().reset_index()\n\nline_data = line_data.melt(id_vars='date', \n                 value_vars=['total_cases', 'recovered', 'total_deaths'], \n                 var_name='Ratio', \n                 value_name='Value')\n\nfig = px.line(line_data, x=\"date\", y=\"Value\", color='Ratio', \n              title='Total Cumulative COVID-19 Cases in Morocco')\nfig.show()","3187ff59":"line_data = data.groupby('date').sum().reset_index()\n\nline_data = line_data.melt(id_vars='date', \n                 value_vars=['active_cases'], \n                 var_name='Ratio', \n                 value_name='Value')\n\nfig = px.line(line_data, x=\"date\", y=\"Value\", color='Ratio', \n              title='Total Evolution of COVID-19 Active Cases')\nfig.show()","7bdd346a":"dictionary_labels = {\n       'TTH': 'Tanger-T\u00e9touane-Al Hoceima',\n       'OR': 'Oriental',\n       'FM': 'F\u00e8s-Mekn\u00e8s',\n       'RSK': 'Rabat-Sal\u00e9-K\u00e9nitra',\n       'BK': 'B\u00e9ni Mellal-Kh\u00e9nifra',\n       'CS': 'Casablanca-Settat',\n       'MS': 'Marrakech-Safi',\n       'DT': 'Dr\u00e2a-Tafilalet',\n       'SM': 'Souss-Massa',\n       'GO': 'Guelmim-Oued Noun',\n       'LS': 'La\u00e2youne-Sakia El Hamra',\n       'DO': 'Dakhla-Oued Ed-Dahab'\n}\n\ndregions = dregions.set_index('Date')\nregions = []\nfor x in dictionary_labels:\n    regions.append(dregions[x][-1])\n\nlabels = []\nfor x in dictionary_labels.values():\n    labels.append(x)","7175a3e0":"plt.figure(figsize=(25,10))\nplt.pie(regions, labels = labels)\nplt.title('Pie Chart of Total COVID-19 Cases per Region')","48f31ab7":"line_data = dregions.groupby('Date').sum().reset_index()\nline_data = line_data.melt(id_vars='Date', \n                 value_vars=['TTH', 'OR', 'FM', 'RSK', 'BK', 'CS', 'MS', 'DT', 'SM', 'GO', 'LS', 'DO' ], \n                 var_name='Ratio', \n                 value_name='Value')\n\nfig = px.line(line_data, x=\"Date\", y=\"Value\", color='Ratio', \n              title='Total Evolution of COVID-19 Cases per Region')\nfig.show()","e2b412f4":"labels = list(dictionary_labels.keys())\nregions = list(dictionary_labels.values())\nplt.figure(figsize=(25,10))\nfor i in range (12):\n    ax1 = plt.subplot(4, 3, i+1)\n    sns.lineplot(data = dregions[labels[i]],label=regions[i])","87214374":"dregions = pd.read_csv('..\/input\/covid19-morocco\/covid19-morocco-regions.csv')\nrlong = list(regional_data.Longitude[:-1])\nrlat = list(regional_data.Latitude[:-1])\n\ndef CovidMap(DATE):\n\n    row = dregions[dregions.Date == DATE]\n    row = row[list(dictionary_labels.keys())].iloc[row.shape[0]-1,:]\n    \n    df = {\n        'latitude': rlat,\n        'longitude': rlong,\n        'region': row.index.to_list(),\n        'Ncases': list(row.values)\n    }\n    df = pd.DataFrame.from_dict(df)\n\n    fig = folium.Figure(width=900, height=600)\n    latitude, longitude = 29.852972, -12.763558\n    CovidMap = folium.Map(location=[latitude, longitude], zoom_start=5)\n    \n    title_html = f' <h3 align=\"center\" style=\"font-size:20px\"><b>Map of COVID-19 Cases in Morocco by {DATE}<\/b><\/h3>'\n    CovidMap.get_root().html.add_child(folium.Element(title_html))\n    \n    for lat, lon, Region, Ncases in zip(df['latitude'], df['longitude'], df['region'], df['Ncases']):\n        folium.CircleMarker(\n            [lat, lon],\n            radius=.1 * Ncases\/\/150,\n            popup = ('Region: ' + str(Region).capitalize() + '<br>'\n                     'Cases: ' + str(Ncases) + '<br>'),\n            color='red',\n            fill_color = \"red\",\n            fill=True,\n            fill_opacity=0.7\n            ).add_to(CovidMap)\n        \n    fig.add_child(CovidMap)\n    return fig\n    \nDATE = '2020-10-02'\nCovidMap(DATE)","538aeccb":"new_cases = []\ntotal_Confirmed = data.total_cases\ndata = data.set_index('date')\n\nfor i in range(data.shape[0]):\n    if i == 0:\n        new_cases.append(0)\n    elif total_Confirmed[i] < total_Confirmed[i-1]:\n        new_cases.append(0)\n    else:\n        temp = int(total_Confirmed[i] - total_Confirmed[i-1])\n        new_cases.append(temp)\n    \nnew_cases = np.array(new_cases)\ndata['New cases'] = new_cases\nnew_cases = data.groupby('date').sum()['New cases'].reset_index()\nnew_cases.columns = ['ds','y']\n\nmodel = Prophet(interval_width = 0.95)\nmodel.fit(new_cases)\n\nfuture = model.make_future_dataframe(periods = 5)\nfuture.tail()\n\nforecast = model.predict(future)\nforecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()","9b649d10":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=forecast.ds, y = abs(forecast['yhat'].round()),\n                         mode= 'lines+markers',name='Forecasting of Daily Cases'))\nfig.add_trace(go.Scatter(x=data.index, y = data['New cases'],\n                         mode= 'lines+markers',name='Daily cases'))\nfig.update_layout(title=\"Forecasting of COVID-19 Daily Cases\",\n                 xaxis_title=\"Date\",yaxis_title=\"Number of Cases\",legend=dict(x=0,y=1,traceorder=\"normal\"))\nfig.show()","cfd2a7cc":"plot_plotly(model, forecast)","713ff993":"<h1> Stay Safe & Follow the WHO Guidance!","2bbebd42":"# Regional Analysis","5c4da0de":"# Forecasting of Daily Cases\nWe'll use Facebook developed an open sourcing Prophet as forecasting tool. In fact, Prophet is a procedure for forecasting time series data based on an additive model where non-linear trends are fit with yearly, weekly, and daily seasonality, plus holiday effects. It works best with time series that have strong seasonal effects and several seasons of historical data. Prophet is robust to missing data and shifts in the trend, and typically handles outliers well.","80a7402d":"# Total Cumulative COVID-19 Cases in Morocco","798beab7":"<h1> COVID19 - Morocco<\/h1>\nThe COVID-19 pandemic in Morocco is part of the worldwide pandemic of coronavirus disease 2019 (COVID-19) caused by severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2). The virus was confirmed to have spread to Morocco on 2 March 2020, when the first case COVID-19 case was confirmed in Casablanca. This notebook aims to analyze and explore COVID-19 pandemic in Morocco through data analysis and projections.\n\nThis is a work **in progress**. Please **upvote** the kernel to encourage this work. \n\n**<h3>Visualization:**\n- Total Cumulative COVID-19 Cases in Morocco\n- Total Evolution of COVID-19 Active Cases\n- Pie Chart of COVID-19 Cases per Region\n- Total Evolution of COVID-19 Cases per Region\n- Plots of Evolution of COVID-19 Cases per Region\n- Map of COVID-19 Cases in Morocco\n- Forecasting of COVID-19 Daily Cases\n\n**<h3>Resources:**\n- [Moroccan Ministry of Health](http:\/\/www.covidmaroc.ma\/pages\/Accueil.aspx)\n- [COVID-19 in Morocco - Kaggle Dataset](https:\/\/www.kaggle.com\/abdelghanibelgaid\/covid19-morocco)\n\n\nContact us if you have a contribution or a suggestion. Your feedback is much appreciated!"}}