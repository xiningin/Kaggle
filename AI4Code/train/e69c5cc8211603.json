{"cell_type":{"72bc2425":"code","93bdb12b":"code","3539a704":"code","f7071c3a":"code","c8ecbc40":"code","63fccd04":"code","4cdb9d66":"code","ecdfa795":"code","d5ed65d7":"code","0b3cefb3":"code","58cd778a":"code","c5e48f46":"code","d8c354d5":"code","5ba27b7d":"code","d2edfa5c":"code","9894ec5e":"code","43ad2e57":"code","e30c04b3":"code","4c681e20":"code","eb9a531c":"code","4392bbfc":"code","740451a5":"code","d6258371":"code","a49f68bb":"code","51c0f6fa":"code","767122f6":"code","e6944080":"code","8394fc01":"code","8fa5489d":"code","9268b273":"code","d57152ba":"code","b34eb3c8":"code","3d152943":"code","1408f242":"code","242e2cd7":"code","ffe44ae4":"code","c2b75466":"code","a23a4791":"code","bf5e651d":"code","dc2e1ddf":"code","5c5e6cca":"code","8a62a1e9":"code","8831fcf3":"code","644a974c":"code","c789a98a":"code","86181757":"code","d2a441f6":"code","11f17141":"code","0db07ca7":"code","b8211dfd":"code","19ffcf02":"code","415003c2":"code","d2edec29":"code","a46fe00f":"code","b7e1ccb2":"code","71c19190":"code","3be499ec":"code","112e3ded":"code","fe971886":"code","f9538d6b":"code","17d97465":"code","da7c45c4":"code","2fb5677a":"code","613d0a94":"code","c0d2a2b0":"code","5f34f1b7":"code","2a32495f":"code","9baff7c9":"code","2ac3c52d":"code","e8682192":"code","503d55be":"code","db2b87ba":"code","4119e3c4":"code","90191a8d":"code","69188d08":"code","5c42ec8d":"code","ef17db1b":"code","7a1ebf5f":"markdown","d59e2cc6":"markdown","f11a92d4":"markdown","dbb94e66":"markdown","4776c701":"markdown","7580e949":"markdown","b0cd4786":"markdown","109460dd":"markdown","a6db1c65":"markdown","baab58b1":"markdown","dc9a1c8b":"markdown","1ca9638b":"markdown","e7ef5273":"markdown","4f4a959b":"markdown","3a2e8c81":"markdown","fc875322":"markdown","4fd2d7d6":"markdown","ac376ae2":"markdown","e62968dd":"markdown","79cf1c8e":"markdown","5e8b561f":"markdown","34dc49f1":"markdown","f0a481fb":"markdown","94f6f195":"markdown","806f0f82":"markdown","8f3cdb7e":"markdown","fa51f056":"markdown","efbeec18":"markdown","9bf96c74":"markdown","869498ef":"markdown","b1f16ece":"markdown","3349aabf":"markdown","17267e93":"markdown","cbe85503":"markdown","89410b93":"markdown","11e4ab42":"markdown","ac678f93":"markdown","d0c8e500":"markdown","0609eeb9":"markdown","4857d0af":"markdown","58a1e859":"markdown","b511740a":"markdown","9cc9ac1e":"markdown","9c3148a8":"markdown","3b3f4fc7":"markdown","9a382600":"markdown","4cf800b4":"markdown","903ef7e9":"markdown","3e8cf0a4":"markdown","bfe74447":"markdown","d4dec9e0":"markdown","e4d707c1":"markdown","e131b3dc":"markdown","13b9af0d":"markdown","68692283":"markdown","6daa987e":"markdown","4445a9ce":"markdown","7549aa4b":"markdown","04bc3705":"markdown","57be2f8f":"markdown","af5501a6":"markdown","70864c06":"markdown","6d77a70d":"markdown","b53fa09d":"markdown","f8561e98":"markdown","a95010f8":"markdown","0f345a99":"markdown","f106fbd5":"markdown","d52881ac":"markdown","4f5890f6":"markdown","f260c409":"markdown","208f827f":"markdown","43ae53ba":"markdown","12ce2cc4":"markdown","40c62c77":"markdown","40dff9bc":"markdown","166a71fe":"markdown","d09035a6":"markdown","428a987e":"markdown","9680b900":"markdown","6662ccd5":"markdown","47e5c963":"markdown","79988180":"markdown","16918fc4":"markdown","c0f91c69":"markdown","176d9b96":"markdown","0c5f6cc0":"markdown","cc8a0ade":"markdown","e9ad0525":"markdown","22251646":"markdown","6d67345c":"markdown","5c2ff417":"markdown","b0ed887a":"markdown","b0a7819e":"markdown","63320be2":"markdown","3809f22e":"markdown","4e0660bc":"markdown","aa11d04c":"markdown","97996cd1":"markdown","eeed86bd":"markdown","5aa68ea3":"markdown","fd8bbda2":"markdown","dc06eeef":"markdown","a1e0f658":"markdown","82375852":"markdown","3b51efdc":"markdown","0113adba":"markdown","967edf93":"markdown","6a0afdd4":"markdown","cabf2979":"markdown","237e8a1d":"markdown","bbe369de":"markdown","5350eda3":"markdown","ccfe6a36":"markdown","435ca518":"markdown","3389531f":"markdown","59eefe59":"markdown"},"source":{"72bc2425":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n\n\nfrom sklearn.model_selection import cross_val_score,cross_val_predict, train_test_split\nfrom sklearn.preprocessing import OneHotEncoder,StandardScaler,PowerTransformer,LabelEncoder\n\nfrom sklearn.metrics import accuracy_score,classification_report, recall_score,confusion_matrix, roc_auc_score, precision_score, f1_score, roc_curve, auc, plot_confusion_matrix,plot_roc_curve\n\n\nimport optuna\nfrom xgboost import XGBClassifier\nfrom lightgbm import LGBMClassifier\nfrom catboost import CatBoostClassifier\n\n\n\n\n#importing plotly and cufflinks in offline mode\nimport cufflinks as cf\nimport plotly.offline\ncf.go_offline()\ncf.set_config_file(offline=False, world_readable=True)\n\n\nimport plotly \nimport plotly.express as px\nimport plotly.graph_objs as go\nimport plotly.offline as py\nfrom plotly.offline import iplot\nfrom plotly.subplots import make_subplots\nimport plotly.figure_factory as ff\n\nimport shap \n\nimport missingno as msno\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","93bdb12b":"pd.set_option('max_columns',100)\npd.set_option('max_rows',900)\n\npd.set_option('max_colwidth',200)\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf.head()","3539a704":"df.duplicated().sum()","f7071c3a":"def missing (df):\n    missing_number = df.isnull().sum().sort_values(ascending=False)\n    missing_percent = (df.isnull().sum()\/df.isnull().count()).sort_values(ascending=False)\n    missing_values = pd.concat([missing_number, missing_percent], axis=1, keys=['Missing_Number', 'Missing_Percent'])\n    return missing_values\n\nmissing(df)","c8ecbc40":"df.info()","63fccd04":"df1 = df.drop('customerID',axis=1).copy()","4cdb9d66":"df1['TotalCharges'][3826]","ecdfa795":"df1.iloc[3826]","d5ed65d7":"df1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)","0b3cefb3":"def missing (df):\n    missing_number = df.isnull().sum().sort_values(ascending=False)\n    missing_percent = (df.isnull().sum()\/df.isnull().count()).sort_values(ascending=False)\n    missing_values = pd.concat([missing_number, missing_percent], axis=1, keys=['Missing_Number', 'Missing_Percent'])\n    return missing_values\n\nmissing(df1)","58cd778a":"y = df1['Churn']\nprint(f'Percentage of Churn:  {round(y.value_counts(normalize=True)[1]*100,2)} %  --> ({y.value_counts()[1]} customer)\\nPercentage of customer did not churn: {round(y.value_counts(normalize=True)[0]*100,2)}  %  --> ({y.value_counts()[0]} customer)')\n","c5e48f46":"y.iplot(kind='hist', title= 'Churn')","d8c354d5":"le = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])","5ba27b7d":"numerical= df1.select_dtypes('number').columns\n\ncategorical = df1.select_dtypes('object').columns\n\nprint(f'Numerical Columns:  {df1[numerical].columns}')\nprint('\\n')\nprint(f'Categorical Columns: {df1[categorical].columns}')","d2edfa5c":"df1['tenure']= df1['tenure'].astype(float)\nnumerical= df1.select_dtypes('number').columns\n\ndf1[numerical].describe()","9894ec5e":"df1[['tenure', 'MonthlyCharges', 'TotalCharges']].iplot(kind='histogram',subplots=True,bins=50)","43ad2e57":"\nmatrix = np.triu(df1[numerical].corr())\nfig, ax = plt.subplots(figsize=(14,10)) \nsns.heatmap (df1[numerical].corr(), annot=True, fmt= '.2f', vmin=-1, vmax=1, center=0, cmap='coolwarm',mask=matrix, ax=ax);","e30c04b3":"df1[categorical].nunique()","4c681e20":"for feature in df1[categorical]:\n        print(f'{feature}: {df[feature].unique()}')","eb9a531c":"print (f'A female customer has a probability of {round(df1[df1[\"gender\"]==\"Female\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A male customer has a probability of {round(df1[df1[\"gender\"]==\"Male\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()","4392bbfc":"fig = px.histogram(df1, x=\"gender\", color=\"Churn\",width=400, height=400)\nfig.show()","740451a5":"print (f'A customer with a partner has a probability of {round(df1[df1[\"Partner\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any partner has a probability of {round(df1[df1[\"Partner\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","d6258371":"fig = px.histogram(df1, x=\"Partner\", color=\"Churn\",width=400, height=400)\nfig.show()","a49f68bb":"print (f'A customer with dependents has a probability of {round(df1[df1[\"Dependents\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any dependents has a probability of {round(df1[df1[\"Dependents\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","51c0f6fa":"fig = px.histogram(df1, x=\"Dependents\", color=\"Churn\",width=400, height=400)\nfig.show()","767122f6":"print (f'A customer with a phone service has a probability of {round(df1[df1[\"PhoneService\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any phone service has a probability of {round(df1[df1[\"PhoneService\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","e6944080":"fig = px.histogram(df1, x=\"PhoneService\", color=\"Churn\",width=400, height=400)\nfig.show()","8394fc01":"df1['MultipleLines']= df1['MultipleLines'].replace('No phone service','No')","8fa5489d":"print (f'A customer with a multiple lines has a probability of {round(df1[df1[\"MultipleLines\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without multiple lines has a probability of {round(df1[df1[\"MultipleLines\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","9268b273":"fig = px.histogram(df1, x=\"MultipleLines\", color=\"Churn\",width=400, height=400)\nfig.show()","d57152ba":"print (f'A customer with a Fiber Optic internet service has a probability of {round(df1[df1[\"InternetService\"]==\"Fiber optic\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer with a DSL internet service has a probability of {round(df1[df1[\"InternetService\"]==\"DSL\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any internet service has a probability of {round(df1[df1[\"InternetService\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","b34eb3c8":"fig = px.histogram(df1, x=\"InternetService\", color=\"Churn\",width=400, height=400)\nfig.show()","3d152943":"df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')","1408f242":"print (f'A customer with a online security has a probability of {round(df1[df1[\"OnlineSecurity\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any online security has a probability of {round(df1[df1[\"OnlineSecurity\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","242e2cd7":"fig = px.histogram(df1, x=\"OnlineSecurity\", color=\"Churn\",width=400, height=400)\nfig.show()","ffe44ae4":"print (f'A customer with a online backup has a probability of {round(df1[df1[\"OnlineBackup\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any online backup has a probability of {round(df1[df1[\"OnlineBackup\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","c2b75466":"fig = px.histogram(df1, x=\"OnlineBackup\", color=\"Churn\",width=400, height=400)\nfig.show()","a23a4791":"print (f'A customer with a device protection has a probability of {round(df1[df1[\"DeviceProtection\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any device protection has a probability of {round(df1[df1[\"DeviceProtection\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","bf5e651d":"fig = px.histogram(df1, x=\"DeviceProtection\", color=\"Churn\",width=400, height=400)\nfig.show()","dc2e1ddf":"print (f'A customer with a Tech Support has a probability of {round(df1[df1[\"TechSupport\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any Tech Support has a probability of {round(df1[df1[\"TechSupport\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","5c5e6cca":"fig = px.histogram(df1, x=\"TechSupport\", color=\"Churn\",width=400, height=400)\nfig.show()","8a62a1e9":"print (f'A customer with a Streaming TV service with the company has a probability of {round(df1[df1[\"StreamingTV\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any Streaming TV service with the company has a probability of {round(df1[df1[\"StreamingTV\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","8831fcf3":"fig = px.histogram(df1, x=\"StreamingTV\", color=\"Churn\",width=400, height=400)\nfig.show()","644a974c":"\nprint (f'A customer with a Streaming movies service with the company has a probability of {round(df1[df1[\"StreamingMovies\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without any Streaming movies service with the company has a probability of {round(df1[df1[\"StreamingMovies\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()","c789a98a":"fig = px.histogram(df1, x=\"StreamingMovies\", color=\"Churn\",width=400, height=400)\nfig.show()","86181757":"\nprint (f'A customer with a Month to month contract has a probability of {round(df1[df1[\"Contract\"]==\"Month-to-month\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer with a Two year contract has a probability of {round(df1[df1[\"Contract\"]==\"Two year\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer with a One year contract has a probability of {round(df1[df1[\"Contract\"]==\"One year\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()","d2a441f6":"fig = px.histogram(df1, x=\"Contract\", color=\"Churn\",width=400, height=400)\nfig.show()","11f17141":"\nprint (f'A customer with a Paperless billing  has a probability of {round(df1[df1[\"PaperlessBilling\"]==\"Yes\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer without a Paperless billing has a probability of {round(df1[df1[\"PaperlessBilling\"]==\"No\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","0db07ca7":"fig = px.histogram(df1, x='PaperlessBilling', color=\"Churn\",width=400, height=400)\nfig.show()","b8211dfd":"\nprint (f'A customer with a Payment method as a Electornic Check has a probability of {round(df1[df1[\"PaymentMethod\"]==\"Electronic check\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer with a Payment method as a Mailed Check has a probability of {round(df1[df1[\"PaymentMethod\"]==\"Mailed check\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer with a Payment method as a Bank transfer (automatic) has a probability of {round(df1[df1[\"PaymentMethod\"]==\"Bank transfer (automatic)\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n\nprint (f'A customer with a Payment method as a Credit card (automatic) has a probability of {round(df1[df1[\"PaymentMethod\"]==\"Credit card (automatic)\"][\"Churn\"].mean()*100,2)} % churn')\n\nprint()\n","19ffcf02":"fig = px.histogram(df1, x='PaymentMethod', color=\"Churn\",width=400, height=400)\nfig.show()","415003c2":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\nmodel_names =[]\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\n\ndf1['tenure']= df1['tenure'].astype(float)\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\n\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\ncategorical_features_indices = np.where(X.dtypes != np.float)[0]\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\ncatboost_base = CatBoostClassifier(verbose=False,random_state=0)\n\ncatboost_base.fit(X_train, y_train,cat_features=categorical_features_indices,eval_set=(X_test, y_test))\ny_pred = catboost_base.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['Catboost_default']\nresult_df1 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df1","d2edec29":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(catboost_base, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","a46fe00f":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\ndf1['tenure']= df1['tenure'].astype(float)\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\n\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\ncategorical_features_indices = np.where(X.dtypes != np.float)[0]\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\ncatboost = CatBoostClassifier(verbose=False,random_state=0,scale_pos_weight=3)\n\ncatboost.fit(X_train, y_train,cat_features=categorical_features_indices,eval_set=(X_test, y_test))\ny_pred = catboost.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['Catboost_adjusted_weight_3']\nresult_df2 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df2","b7e1ccb2":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(catboost, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","71c19190":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\ndf1['tenure']= df1['tenure'].astype(float)\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\n\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\ncategorical_features_indices = np.where(X.dtypes != np.float)[0]\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\ncatboost_5 = CatBoostClassifier(verbose=False,random_state=0,scale_pos_weight=5)\n\ncatboost_5.fit(X_train, y_train,cat_features=categorical_features_indices,eval_set=(X_test, y_test))\ny_pred = catboost_5.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['Catboost_adjusted_weight_5']\nresult_df3 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df3","3be499ec":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(catboost_5, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","112e3ded":"explainercat = shap.TreeExplainer(catboost_5)\nshap_values_cat_test = explainercat.shap_values(X_test)\nshap_values_cat_train = explainercat.shap_values(X_train)","fe971886":"shap.summary_plot(shap_values_cat_train, X_train, plot_type=\"bar\")","f9538d6b":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\ndf1= pd.get_dummies(df1)\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\nxgbc_base = XGBClassifier(random_state=0)\n\nxgbc_base.fit(X_train, y_train)\ny_pred = xgbc_base.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['XGBoost_Default']\nresult_df4 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df4","17d97465":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(xgbc_base, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","da7c45c4":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\ndf1= pd.get_dummies(df1)\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\nxgbc_3 = XGBClassifier(random_state=0,scale_pos_weight=3)\n\nxgbc_3.fit(X_train, y_train)\ny_pred = xgbc_3.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['XGBoost_adjusted_weight_3']\nresult_df5 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df5","2fb5677a":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(xgbc_3, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","613d0a94":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\ndf1= pd.get_dummies(df1)\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\nxgbc_5 = XGBClassifier(random_state=0,scale_pos_weight=5)\n\nxgbc_5.fit(X_train, y_train)\ny_pred = xgbc_5.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['XGBoost_adjusted_weight_5']\nresult_df6 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df6","c0d2a2b0":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(xgbc_5, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","5f34f1b7":"explainerxgbc = shap.TreeExplainer(xgbc_5)\nshap_values_XGBoost_test = explainerxgbc.shap_values(X_test)\nshap_values_XGBoost_train = explainerxgbc.shap_values(X_train)","2a32495f":"shap.summary_plot(shap_values_XGBoost_train, X_train, plot_type=\"bar\")","9baff7c9":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\ndf1= pd.get_dummies(df1)\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\nfor col in X.columns:\n    col_type = X[col].dtype\n    if col_type == 'object' or col_type.name == 'category':\n        X[col] = X[col].astype('category')\n\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\nlgbmc_base=LGBMClassifier(random_state=0)\n\nlgbmc_base.fit(X_train, y_train,categorical_feature = 'auto',eval_set=(X_test, y_test),feature_name='auto', verbose=0)\n\ny_pred = lgbmc_base.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['LightGBM_default']\nresult_df7 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df7","2ac3c52d":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(lgbmc_base, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","e8682192":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\ndf1= pd.get_dummies(df1)\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\nfor col in X.columns:\n    col_type = X[col].dtype\n    if col_type == 'object' or col_type.name == 'category':\n        X[col] = X[col].astype('category')\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\nlgbmc_3=LGBMClassifier(random_state=0,scale_pos_weight=3)\n\nlgbmc_3.fit(X_train, y_train,categorical_feature = 'auto',eval_set=(X_test, y_test),feature_name='auto', verbose=0)\n\ny_pred = lgbmc_3.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['LightGBM_adjusted_weight_3']\nresult_df8 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df8","503d55be":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(lgbmc_3, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","db2b87ba":"accuracy= []\nrecall =[]\nroc_auc= []\nprecision = []\n\n\ndf = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')\ndf1 = df.drop(['customerID','gender','PhoneService'],axis=1).copy()\nle = LabelEncoder()\ndf1['Churn']=le.fit_transform(df1['Churn'])\n\ndf1['TotalCharges']= df1['TotalCharges'].apply(lambda x: x if x!= ' ' else np.nan).astype(float)\n\ndf1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']]= df1[['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies']].replace('No internet service','No')\n\ndf1= pd.get_dummies(df1)\nX= df1.drop('Churn', axis=1)\ny= df1['Churn']\n\nfor col in X.columns:\n    col_type = X[col].dtype\n    if col_type == 'object' or col_type.name == 'category':\n        X[col] = X[col].astype('category')\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)\n\nlgbmc_5=LGBMClassifier(random_state=0,scale_pos_weight=5)\n\nlgbmc_5.fit(X_train, y_train,categorical_feature = 'auto',eval_set=(X_test, y_test),feature_name='auto', verbose=0)\n\ny_pred = lgbmc_5.predict(X_test)\n\naccuracy.append(round(accuracy_score(y_test, y_pred),4))\nrecall.append(round(recall_score(y_test, y_pred),4))\nroc_auc.append(round(roc_auc_score(y_test, y_pred),4))\nprecision.append(round(precision_score(y_test, y_pred),4))\n\nmodel_names = ['LightGBM_adjusted_weight_5']\nresult_df9 = pd.DataFrame({'Accuracy':accuracy,'Recall':recall, 'Roc_Auc':roc_auc, 'Precision':precision}, index=model_names)\nresult_df9","4119e3c4":"fig, ax = plt.subplots(figsize=(8, 8))\nplot_confusion_matrix(lgbmc_5, X_test, y_test, cmap=plt.cm.Blues, ax=ax);","90191a8d":"explainerlgbmc = shap.TreeExplainer(lgbmc_5)\nshap_values_LightGBM_test = explainerlgbmc.shap_values(X_test)\nshap_values_LightGBM_train = explainerlgbmc.shap_values(X_train)","69188d08":"shap.summary_plot(shap_values_LightGBM_train, X_train, plot_type=\"bar\")","5c42ec8d":"result_final= pd.concat([result_df1,result_df2,result_df3,result_df4,result_df5,result_df6, result_df7,result_df8,result_df9],axis=0)\nresult_final","ef17db1b":"result_final.sort_values(by=['Recall'], ascending=True,inplace=True)\nfig = px.bar(result_final, x='Recall', y=result_final.index,title='Model Comparison',height=600,labels={'index':'MODELS'})\nfig.show()","7a1ebf5f":"- We can see that **`No internet service`** is repeating several times in the features and in this problem at hand, it gives same meaning as **No**\n- So we can change them to **No** and then features will have two unique values, \n- Also **`MultipleLines`** has **`No phone service`** option, which in this problem gives same meaning as **No** so we can change it to **No** and do the same thing for this feature.\n- Lets'start with the bivariate analysis and on the way we will make the relevant changes.","d59e2cc6":"<a id=\"15\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>XGBoost (with adjusted Scale_Pos_Weight = 5) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","f11a92d4":"<a id=\"19\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>LightGBM (with adjusted Scale_Pos_Weight =5) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","dbb94e66":"- With the **default parameters, XGBoost** get **.47 Recall and .68 Roc_Auc**.","4776c701":"- A customer with an online backup service with the company almost **1.35 times** less likely to leave the company than a customer without any online backup service with the company.","7580e949":"In this notebook, we have looked in detail at how famous trio (XGBoost & LightGBM & Catboost) handle the imbalanced data.\n\n- We looked at the CatBoost, XGBoost and LightGBM  and showed how they deal with imbalanced data internally.\n- In general, boosting algorithms do good job even on imbalanced data.\n- They produce good results on the imbalanced daata by giving an opportunity to focus more on the minority class and accordingly tune the training algorithm.\n\n- CatBoost, XGBoost and LightGBM use **`scale_pos_weight`** hyperparameter to tune the training algrotih for the imbalanced data.\n\n- **`scale_pos_weight`** is **1** by default. Both major class and minority class get the same weight.\n- When dealing with imbalanced daya, story changes a bit.\n- **`scale_pos_weight`** gets the number of ( total number of examples in the majority class divided by the total number of examples in the minority class.)     \n- By adjusting the weight, minority class got 3 times more impact and 3 times more correction than errors made on the majority class. \n- We also observed that when we changed **`scale_pos_weight`** from **3** to **5** , we have observed significant increase on the **`recall`** score.\n- Two important point, \n    - by changing **`scale_pos_weight`** we observed changes on the **`recall, accuracy, roc-auc, precision score`**\n    - If we use extreme values for the **`scale_pos_weight`**, we can overfit the minority class and model could make worse predictions.\n\n\n- I have to emphasize that it is important to get deep knowledge on the data and problem on the hand. Based on the stakeholder's \/ customer's demand and domain knowledge we can make changes accordingly.","b0cd4786":"* Based on the matrix, we can observe weak level correlation between the numerical features and the target variable\n* There is strong correlation between tenure and total charges.\n* Being senior citizen and increasing monthly charges have a positive correlation with the churn.\n* Senior citizen more likely churn than younger customers.\n* Customer with higher monthly charges also more likely churn than lesser monthly charges customers.\n* Being long term with the company, customer less likely churn than customer  with lesser time with the company.\n* Total charges has negative correlation with the churn.","109460dd":"\n- CatBoost, XGBoost and LightGBM use **`scale_pos_weight`** hyperparameter to tune the training algorithm for the imbalanced data.\n\n- **`scale_pos_weight`** is **1** by default.\n\n- Both major class and minority class get the same weight.\n\n- When dealing with imbalanced data, story changes a bit.\n- **`scale_pos_weight`** gets the number of ( total number of examples in the majority class divided by the total number of examples in the minority class.)\n\n- For example, in our data;\n     - Number of Non-churned customer:  5174\n     - Number of Churned customer: 1869\n     -  **`scale_pos_weight`** should get 5174 \/ 1869  which is almost **3**\n     \n- By adjusting the weight, minority class gets 3 times more impact and 3 times more correction than errors made on the majority class. \n\n- Two important point, \n    - by changing **`scale_pos_weight`** we can also see changes on the **`recall, accuracy, roc-auc, precision score`**\n    - If we use extreme values for the **`scale_pos_weight`**, we can overfit the minority class and model could make worse predictions.\n\n","a6db1c65":"## **SHAP Summary Plot - CatBoost (with adjusted Scale_Pos_Weight = 5 )**","baab58b1":"- By using weight a little bit higher than recommended formula for **`scale_pos_weight = 5`**, **CatBoost** correctly predict almost **92% of the churned customers**.\n- On the other hand we have lost 7% for the precision and 3 points for the Roc_Auc score.","dc9a1c8b":"- With the adjusted **`scale_pos_weight=5`**, **CatBoost** got  almost **.92 Recall and .75 Roc_Auc**","1ca9638b":"- With the adjusted **`scale_pos_weight`**, **XGBoost** got almost **.67 Recall and .73 Roc_Auc**","e7ef5273":"### **Contract Type & Churn**","4f4a959b":"- With the adjusted **`scale_pos_weight`**, **LightGBM** got almost **.54 Recall and .72 Roc_Auc**","3a2e8c81":"- Customer without any dependents, almost 2.03 times more likely churn than cutomer with a dependent.","fc875322":"<a id=\"9\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>CatBoost (with default Parameters) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","4fd2d7d6":"![](https:\/\/media.giphy.com\/media\/EMvZor0TLYdACIug6S\/giphy-downsized-large.gif)","ac376ae2":"- Bu using deafult value of **`scale_pos_weight`**, **XGBoost** correctly predicted **less than half of the churned customers**. ","e62968dd":"- For the sake of showing the power of model with a small increase on the weight, let's see the differences on the Recall score and Roc_Auc.\n- We will increase **`scale_pos_weight`**  from **3** to **5**.\n- Minority class gets 5 times more impact and 5 times more correction than errors made on the majority class. ","79cf1c8e":"![](https:\/\/media.giphy.com\/media\/Q9v2RwHugTfz39afpy\/giphy.gif)","5e8b561f":"### **Multiple Lines and Churn**","34dc49f1":"<a id=\"6\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>Overall Insights<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","f0a481fb":"- There is not much difference between gender on the churn rate.","94f6f195":"<a id=\"3\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>Target Variable<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","806f0f82":"Image Credit: https:\/\/miro.medium.com\/","8f3cdb7e":"<a id=\"5\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>Categorical Features<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","fa51f056":"- Based on the data and data dictionary, We have a classification problem.\n- We wil make classification on the target variable **`Churn`**\n- And we will build a model to get best classification possible on the target variable.\n- For that we will look at the balance of the target variable.\n- As we will see later, our target variable has imblanced data\n- For that reason we are not going to use Accuracy score, \n- Based on the problem on the hand, we will use **`Recall score`**.\n- [For the detailed info about the evaluation metrics](https:\/\/www.kaggle.com\/kaanboke\/the-most-common-evaluation-metrics-a-gentle-intro)","efbeec18":"## **SHAP Summary Plot- XGBoost (with adjusted Scale_Pos_Weight = 5)**","9bf96c74":"- When we play around a little bit with the value of  **`scale_pos_weight`**, **XGBoost** correctly predicted almost **74% of the churned customers** by using **scale_pos_weight=5** (Roc_Auc = .75)\n","869498ef":"- We will make the correct coding to define misisng values.","b1f16ece":"<a id=\"toc\"><\/a>\n\n<h3 class=\"list-group-item list-group-item-action active\" data-toggle=\"list\" role=\"tab\" aria-controls=\"home\">Table of Contents<\/h3>\n    \n* [Data](#0)\n* [What Problem We Have and Which Metric to Use?](#1)\n\n* [Exploratory Data Analysis](#2)\n    * [Target Variable](#3)\n    * [Numerical Features](#4)\n    * [Categorical Features](#5)\n    * [Overall Insights](#6)\n      \n      \n* [How Famous Trio (XGBoost & LightGBM & Catboost) Deal With Imbalanced Data?](#7) \n\n\n* [CATBOOST](#8)\n    * [CatBoost (with default Parameters) Deals With Imbalanced Data](#9)\n    * [CatBoost (with adjusted Scale_Pos_Weight = 3) Deals With Imbalanced Data](#10)\n    * [CatBoost (with adjusted Scale_Pos_Weight = 5) Deals With Imbalanced Data](#11)\n\n\n* [XGBOOST](#12)    \n    * [XGBoost (with default Parameters) Deals With Imbalanced Data](#13)    \n    * [XGBoost (with adjusted Scale_Pos_Weight) Deals With Imbalanced Data](#14)\n    * [XGBoost (with adjusted Scale_Pos_Weight = 5) Deals With Imbalanced Data](#15)\n\n\n* [LightGBM](#16)\n    * [LightGBM (with default Parameters) Deals With Imbalanced Data](#17)    \n    * [LightGBM (with adjusted Scale_Pos_Weight) Deals With Imbalanced Data](#18)\n    * [LightGBM (with adjusted Scale_Pos_Weight = 5) Deals With Imbalanced Data](#19)\n \n \n* [Final Result Table and Model Comparison](#20)\n\n* [Conclusion](#21)\n\n* [Further Reading](#22)","3349aabf":"- By using deafult value of **`scale_pos_weight`**, **CatBoost** correctly predicted **almost half of the churned customer**\n- But model couldn't be able to correctly predict the other half.","17267e93":"- Customer without any relationship, single customer almost 1.7 times more likely churn than cutomer with a partner.","cbe85503":"- Bu using recommended adjusted value of **`scale_pos_weight`**, **XGBoost** correctly predicted almost **67% of the churned customers**.","89410b93":"Image Credit: https:\/\/www.questionpro.com","11e4ab42":"- Almost half of the customers with a payment method as a Electornic Check churn, which is a quite big percentage.","ac678f93":"Gif Credit: https:\/\/media.giphy.com\/","d0c8e500":"- For further usage, let's get the list of the numerical and categorical features.","0609eeb9":"- By using recommended formula for **`scale_pos_weight`**, **LightGBM** correctly predicted almost 77% of the churned customer.\n- As you have observed that, we didn't change any other parameter and get almost 23% lift in our recall score without overfitting.\n- We can improve this score without destroying the Roc_Auc.","4857d0af":"### **Paperless Billing & Churn**","58a1e859":"Image Credit: https:\/\/repository-images.githubusercontent.com\/64991887\/","b511740a":"<a id=\"20\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>Final Result Table and Model Comparison<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","9cc9ac1e":"- Churn rate difference between customer has a multiple lines phone service with the company and customer does not have a multiple line phone service with the company is very small.","9c3148a8":"<a id=\"17\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>LightGBM (with default Parameters) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","3b3f4fc7":"- Data coding is always to be examined carefully.\n- When we try to change the datatype of the `Total charges` from object type to float type, we will get error.\n- Let's see what is the reason?","9a382600":"### **Device Protection and Churn**","4cf800b4":"![](https:\/\/miro.medium.com\/max\/1400\/1*1kjLMDQMufaQoS-nNJfg1Q.png)","903ef7e9":"<a id=\"2\"><\/a>\n<font color=\"Darkblue\" size=+2.5><b>Exploratory Data Analysis<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","3e8cf0a4":"- With the adjusted **`scale_pos_weight = 5`**, **XGBoost** got **.74 Recall and .75 Roc_Auc**","bfe74447":"- Churn rate difference between customer has a phone service with the company and customer does not have a home phone service with the company is very small.","d4dec9e0":"- We have imbalanced data.\n- Almost 27% of the customers didn't continue with the company and churned.\n- 1869 customer churned.\n- Almost 73% of the customers continue with the company and didn't churn.\n- 5174 customer didn't churn.\n","e4d707c1":"<a id=\"16\"><\/a>\n<font color=\"Darkblue\" size=+2.5><b>LightGBM<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","e131b3dc":"- Let's import the libraries","13b9af0d":"- Let's see cardinality of the categorical features.","68692283":"- A customer with a Tech Support service with the company almost **2.06 times** less likely to leave the company than a customer without any a Tech Support service with the company.","6daa987e":"<a id=\"13\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>XGBoost (with default Parameters) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","4445a9ce":"Image Credit: https:\/\/avatars.mds.yandex.net","7549aa4b":"- A customer with a paperless billing with the company almost **2.06 times** more likely to leave the company than a customer without a paperless billing with the company.","04bc3705":"## **SHAP Summary Plot- LightGBM (with adjusted Scale_Pos_Weight = 5)**","57be2f8f":"- Let's see the unique values of the categorical features.","af5501a6":"- By using **`scale_pos_weight =5`**, **LightGBM** correctly predicted **83% of the churned customer**.","70864c06":"### **Having Partner and Churn**","6d77a70d":"### **Online Backup and Churn**","b53fa09d":"- With the adjusted **`scale_pos_weight`**, **LightGBM** got **.77 Recall and .76 Roc_Auc**","f8561e98":"![](https:\/\/repository-images.githubusercontent.com\/64991887\/dc855780-e34b-11ea-9ab8-e08ca33288b0)","a95010f8":"- A customer with a Streaming Movies service with the company almost **1.23 times** more likely to leave the company than a customer without any a Streaming movies service with the company.","0f345a99":"### **Having Dependents and Churn**","f106fbd5":"- Customer with fiber optic internet with the company compare to customer without any internet service with the company **5.66 times** more likely to churn.\n- Customer with fiber optic internet with the company compare to customer with DSL internet service with the company almost **2.21 times** more likely to churn.\n- Customer with DSL internet service with the company compare to customer without any internet service with the company **2.56 times** more likley to churn.","d52881ac":"<a id=\"8\"><\/a>\n<font color=\"Darkblue\" size=+2.5><b>CatBoost<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","4f5890f6":"<a id=\"11\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>CatBoost (with adjusted Scale_Pos_Weight = 5) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","f260c409":"- Data does not have a high cardinality or zero variance issues. ","208f827f":"- Let's look at the data.","43ae53ba":"- For the sake of showing the power of model with a small increase on the weight, let's see the differences on the Recall score and Roc_Auc.\n- We will increase **`scale_pos_weight`**  from **3** to **5**.\n- Minority class gets 5 times more impact and 5 times more correction than errors made on the majority class. ","12ce2cc4":"#### By the way, when you like the topic, you can show it by supporting \ud83d\udc4d\n\n####  **Feel free to leave a comment**. \n\n#### All the best \ud83e\udd18","40c62c77":"Gif Credit: https:\/\/media.giphy.com","40dff9bc":"### **Gender and Churn**","166a71fe":"- By using recommended formula for **`scale_pos_weight`**, **CatBoost** correctly predicted **84% of the churned customers**.\n- As you have seen that, we didn't change any other parameter and get almost 32% lift in our recall score.","d09035a6":"![](https:\/\/avatars.mds.yandex.net\/get-bunker\/56833\/dba868860690e7fe8b68223bb3b749ed8a36fbce\/orig)","428a987e":"<a id=\"18\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>LightGBM (with adjusted Scale_Pos_Weight =3) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","9680b900":"- In this part, we will look at the CatBoost, XGBoost and LightGBM and will see how they deal imbalanced data internally.\n- In general, boosting algorithms do good job even on imbalanced data.\n- They produce good results on the imbalanced daata by giving an opportunity to focus more on the minority class and accordingly tune the training algorithm.","6662ccd5":"- A customer with a device protection service with the company almost **1.27 times** less likely to leave the company than a customer without any a device protection service with the company.","47e5c963":"- Even though we don't see any missing values, when we look at the data, `total charges` feature has missing values.","79988180":"### **Online Security and Churn**","16918fc4":"<a id=\"0\"><\/a>\n<font color=\"Darkblue\" size=+2.5><b>Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","c0f91c69":"# **Telco Customer Churn**","176d9b96":"<a id=\"12\"><\/a>\n<font color=\"Darkblue\" size=+2.5><b>XGBoost<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","0c5f6cc0":"### **Data Dictionary**\n\n1. **`CustomerID`**: A unique ID that identifies each customer.\n\n2. **`Gender`**: The customer\u2019s gender: Male, Female\n\n3. **`Age`**: The customer\u2019s current age, in years, at the time the fiscal quarter ended.\n\n4. **`Senior Citizen`**: Indicates if the customer is 65 or older: Yes, No\n\n5. **`Married (Partner)`**: Indicates if the customer is married: Yes, No\n\n6. **`Dependents`**: Indicates if the customer lives with any dependents: Yes, No. Dependents could be children, parents, grandparents, etc.\n\n7. **`Number of Dependents`**: Indicates the number of dependents that live with the customer.\n\n8. **`Phone Service`**: Indicates if the customer subscribes to home phone service with the company: Yes, No\n\n9. **`Multiple Lines`**: Indicates if the customer subscribes to multiple telephone lines with the company: Yes, No\n\n10. **`Internet Service`**: Indicates if the customer subscribes to Internet service with the company: No, DSL, Fiber Optic, Cable.\n\n11. **`Online Security`**: Indicates if the customer subscribes to an additional online security service provided by the company: Yes, No\n\n12. **`Online Backup`**: Indicates if the customer subscribes to an additional online backup service provided by the company: Yes, No\n\n13. **`Device Protection Plan`**: Indicates if the customer subscribes to an additional device protection plan for their Internet equipment provided by the company: Yes, No\n\n14. **`Premium Tech Support`**: Indicates if the customer subscribes to an additional technical support plan from the company with reduced wait times: Yes, No\n\n15. **`Streaming TV`**: Indicates if the customer uses their Internet service to stream television programing from a third party provider: Yes, No. The company does not charge an additional fee for this service.\n\n16. **`Streaming Movies`**: Indicates if the customer uses their Internet service to stream movies from a third party provider: Yes, No. The company does not charge an additional fee for this service.\n\n17. **`Contract`**: Indicates the customer\u2019s current contract type: Month-to-Month, One Year, Two Year.\n\n18. **`Paperless Billing`**: Indicates if the customer has chosen paperless billing: Yes, No\n\n19. **`Payment Method`**: Indicates how the customer pays their bill: Bank Withdrawal, Credit Card, Mailed Check\n\n20. **`Monthly Charge`**: Indicates the customer\u2019s current total monthly charge for all their services from the company.\n\n21. **`Total Charges`**: Indicates the customer\u2019s total charges, calculated to the end of the quarter specified above.\n\n22. **`Tenure`**: Indicates the total amount of months that the customer has been with the company.\n\n23. **`Churn`**: Yes = the customer left the company this quarter. No = the customer remained with the company. Directly related to Churn Value.\n\nReference:\nhttps:\/\/www.kaggle.com\/blastchar\/telco-customer-churn\n\nhttps:\/\/community.ibm.com\/community\/user\/businessanalytics\/blogs\/steven-macko\/2019\/07\/11\/telco-customer-churn-1113\n\n","cc8a0ade":"### **Internet Service and Churn**","e9ad0525":"- With the adjusted **`scale_pos_weight = 5`**, **LightGBM** got **.83 Recall and almost .76 Roc_Auc**","22251646":"<a id=\"1\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>What Problem We Have and Which Metric to Use?<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","6d67345c":"### **Payment Method & Churn**","5c2ff417":"### **Tech Support and Churn**","b0ed887a":"- **`Gender`** : There is not much difference between gender on the churn rate. We won't include gender into our model.\n- **`Partner`** :  Customer without any relationship, single customer almost 1.7 times more likely churn than cutomer with a partner.\n- **`Dependents`** : Customer without any dependents, almost 2.03 times more likely churn than cutomer with a dependent.\n- **`Phone Service`**: Churn rate difference between customer has a phone service with the company and customer does not have a home phone service with the company is very small. We won't include phone service into our model.\n- **`Multiple Lines`** : Churn rate difference between customer has a multiple lines phone service with the company and customer does not have a multiple line phone service with the company is very small.\n- **`\u00ecnternet Service`** : Customer with fiber optic internet with the company compare to customer without any internet service with the company 5.66 times more likely to churn.\n- **`Online Security`**: A customer with an online security service with the company almost 2.14 times less likely to leave the company than a customer without any online security service with the company.\n- **`Online Backup`** A customer with an online backup service with the company almost 1.35 times less likely to leave the company than a customer without any online backup service with the company.\n- **`Device Protection`** : A customer with a device protection service with the company almost 1.27 times less likely to leave the company than a customer without any a device protection service with the company.\n- **`Tech Support`** : A customer with a Tech Support service with the company almost 2.06 times less likely to leave the company than a customer without any a Tech Support service with the company.\n- **`Streaming TV Service`** : A customer with a Streaming TV service with the company almost 1.24 times more likely to leave the company than a customer without any a Streaming TV service with the company.\n- **`Streaming Movies Service`** : A customer with a Streaming Movies service with the company almost 1.23 times more likely to leave the company than a customer without any a Streaming movies service with the company.\n- **`Contract Type`** : Great differences based on the contract were seen in the histogram and mean differences.\n    - Customer with the 2 year contract almost 15.1 times less likely to churn compare to customer with a monthly contract.\n    - On the other hand customer with the 1 year contract almost 3.79 times less likely to churn compare to customer with a monthly contract.\n- **`Paperless Billing`** : A customer with a paperless billing with the company almost 2.06 times more likely to leave the company than a customer without a paperless billing with the company.\n- **`Payment Method`** : Almost half of the customers with a payment method as a Electornic Check churn, which is a quite big percentage.\n","b0a7819e":"- Bu using deafult value of **`scale_pos_weight`**, **LightGBM** correctly predicted alittle bit more than half of the churned customers. ","63320be2":"<a id=\"22\"><\/a>\n<font color=\"darkblue\" size=+1.5><b>Further Reading<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>\n\n\n[Machine Learning - Beginner &Intermediate-Friendly BOOKS](https:\/\/www.kaggle.com\/general\/255972)\n","3809f22e":"- For the sake of showing the power of model with a small increase on the weight, let's see the differences on the Recall score and Roc_Auc.\n- We will increase **`scale_pos_weight`**  from **3** to **5**.\n- Minority class gets 5 times more impact and 5 times more correction than errors made on the majority class. ","4e0660bc":"### **Phone Service and Churn**","aa11d04c":"<a id=\"21\"><\/a>\n<font color=\"Darkblue\" size=+2.5><b>Conclusion<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","97996cd1":"<a id=\"4\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>Numerical Features<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","eeed86bd":"## After first sight, what we will do next?\n-  We won't use **`customerID`**, so we will drop it.\n- **`Total charges`** has object type we will change it to float type.\n- **`Tenure`** has integer type we will change it to float type, for catboost model.\n-  We will look at the cardinality of the categorical variables.\n-  We will encode target variable (**`churn`**) to numeric type by using label encoding. ","5aa68ea3":"- Dataset does not have any duplicated and mising values. But don't be sure, always look deeper.","fd8bbda2":"- Duplicated and Missing Value check","dc06eeef":"Image Credit: https:\/\/e7.pngegg.com","a1e0f658":"### **Streaming Movies Service and Churn**","82375852":"### **Streaming TV Service and Churn**","3b51efdc":"<a id=\"10\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>CatBoost (with adjusted Scale_Pos_Weight = 3) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","0113adba":"![](https:\/\/www.questionpro.com\/blog\/wp-content\/uploads\/2018\/02\/Customer-Churn.jpg)","967edf93":"- Even thoguh data has missing values, models which we will use in this study can handle the missing values internally.","6a0afdd4":"<a id=\"7\"><\/a>\n<font color=\"Darkblue\" size=+2.5><b>How Famous Trio (XGBoost & LightGBM & Catboost) Deal Imbalanced Data?<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>","cabf2979":"- With the adjusted **`scale_pos_weight=3`**, **CatBoost** got  **.84 Recall and .78 Roc_Auc**","237e8a1d":"![](https:\/\/e7.pngegg.com\/pngimages\/301\/649\/png-clipart-snake-scale-measuring-scales-measurement-scale-light-fixture-measuring-scales-thumbnail.png)","bbe369de":"- A customer with an online security service with the company almost **2.14 times** less likely to leave the company than a customer without any online security service with the company.","5350eda3":"#### Hi all.  \ud83d\ude4b\n\n#### We continue our **Beginner-Intermediate Friendly Machine Learning series**, which would help anyone who wants to learn or refresh the basics of ML.\n\n#### What we have covered: \n\n#### [Beginner Friendly Detailed Explained EDAs \u2013 For anyone at the beginnings of DS\/ML journey](https:\/\/www.kaggle.com\/general\/253911#1393015) \u2714\ufe0f\n\n#### [BIAS & VARIANCE TRADEOFF](https:\/\/www.kaggle.com\/kaanboke\/ml-basics-bias-variance-tradeoff) \u2714\ufe0f\n\n#### [LINEAR ALGORITHMS](https:\/\/www.kaggle.com\/kaanboke\/ml-basics-linear-algorithms)  \u2714\ufe0f\n\n#### [NONLINEAR ALGORITHMS](https:\/\/www.kaggle.com\/kaanboke\/nonlinear-algorithms)  \u2714\ufe0f\n\n#### [The Most Used Methods to Deal with MISSING VALUES](https:\/\/www.kaggle.com\/kaanboke\/the-most-used-methods-to-deal-with-missing-values)  \u2714\ufe0f\n\n#### [Beginner Friendly End to End ML Project- Classification with Imbalanced Data](https:\/\/www.kaggle.com\/kaanboke\/beginner-friendly-end-to-end-ml-project-enjoy)  \u2714\ufe0f\n\n#### [How to Prevent the Data Leakage ?](https:\/\/www.kaggle.com\/kaanboke\/how-to-prevent-the-data-leakage) \u2714\ufe0f\n\n#### [The Most Common EVALUATION METRICS- A Gentle Intro](https:\/\/www.kaggle.com\/kaanboke\/the-most-common-evaluation-metrics-a-gentle-intro) \u2714\ufe0f\n\n#### [Feature Selection-The Most Common Methods to Know](https:\/\/www.kaggle.com\/kaanboke\/feature-selection-the-most-common-methods-to-know) \u2714\ufe0f\n\n#### [Beginner Friendly End to End ML Project- Car Price Prediction](https:\/\/www.kaggle.com\/kaanboke\/car-price-prediction-beginner-friendly-94-3)  \u2714\ufe0f\n\n#### [Beginner Friendly CATBOOST with OPTUNA](https:\/\/www.kaggle.com\/kaanboke\/beginner-friendly-catboost-with-optuna)  \u2714\ufe0f\n\n#### [A Gentle Intro to PYCARET-Beginner Friendly](https:\/\/www.kaggle.com\/kaanboke\/a-gentle-intro-to-pycaret-beginner-friendly)  \u2714\ufe0f\n\n\n#### In this notebook, we will look in detail at how the famous trio (**XGBoost & LightGBM & Catboost**) handle the imbalanced data.\n\n\n#### **Enjoy** \ud83e\udd18","ccfe6a36":"- A customer with a Streaming TV service with the company almost **1.24 times** more likely to leave the company than a customer without any a Streaming TV service with the company.","435ca518":"- With the **default parameters, Catboost** get almost**.52 Recall and .72 Roc_Auc**","3389531f":"- Great differences based on the contract were seen in the histogram and mean differences.\n- Customer with the 2 year contract almost **15.1 times** less likely to churn compare to customer with a monthly contract.\n- On the other hand customer with the 1 year contract almost **3.79 times** less likely to churn compare to customer with a monthly contract.","59eefe59":"<a id=\"14\"><\/a>\n<font color=\"Darkblue\" size=+1.5><b>XGBoost (with adjusted Scale_Pos_Weight = 3) Deals With Imbalanced Data<\/b><\/font>\n\n<a href=\"#toc\" class=\"btn btn-primary btn-sm\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\">Table of Contents<\/a>"}}