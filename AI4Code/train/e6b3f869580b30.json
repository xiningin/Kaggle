{"cell_type":{"a398560f":"code","b8654039":"code","60acde8e":"code","235d2e46":"code","9333c7a9":"code","f6f1a028":"code","28ee3056":"code","9871563f":"code","b4a75958":"code","e1589a5f":"code","8a4cfcc1":"code","84060730":"code","cb051596":"code","95665ce9":"code","30fdf3f8":"code","5dbf0a2e":"code","ae0080f7":"code","a464ad1e":"code","1b7d4199":"code","9a7a6b11":"code","9f9ed75c":"code","608db261":"code","f9c7ad40":"code","2930ce2d":"code","ba8de248":"code","7fd10142":"code","0e11e0e4":"code","ccb4869f":"code","f232bddd":"markdown","48a69c9c":"markdown","e0876c69":"markdown","daa3ab0f":"markdown","3f42383a":"markdown","c18ba45b":"markdown","14a24049":"markdown","29ec4821":"markdown","dd7df18c":"markdown","14d001ff":"markdown","85884766":"markdown","538a74c4":"markdown","6143b237":"markdown","9cecec1d":"markdown","11c683a7":"markdown","eb90dc3b":"markdown","b9d0c9ed":"markdown","143a56f9":"markdown","04a39042":"markdown","64d01533":"markdown","98552372":"markdown","f27002d1":"markdown","b552b3d6":"markdown","e4ab6e99":"markdown","4e08b89b":"markdown","40ef35ef":"markdown","e676bd09":"markdown","63499443":"markdown","8c1e06d6":"markdown"},"source":{"a398560f":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport pandas as pd\nimport numpy as np\nfrom sklearn.datasets import make_classification\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn import preprocessing\nfrom sklearn.model_selection import train_test_split\nfrom sklearn import metrics\nfrom xgboost import XGBClassifier\nfrom sklearn.model_selection import GridSearchCV\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","b8654039":"df = pd.read_csv('..\/input\/train_LZdllcl.csv')\ndf.columns","60acde8e":"df['department'].value_counts()","235d2e46":"plt.rcParams['figure.figsize'] = [10, 5]\nct = pd.crosstab(df.department,df.is_promoted,normalize='index')\nct.plot.bar(stacked=True)\nplt.legend(title='is_promoted',bbox_to_anchor=(1,0.5))","9333c7a9":"reg = pd.crosstab(df.region,df.is_promoted,normalize='index')\nreg.plot.bar(stacked=True)\nplt.legend(title='is_promoted',bbox_to_anchor=(1,0.5))","f6f1a028":"plt.rcParams['figure.figsize'] = [5, 5]\nedu = pd.crosstab(df.education,df.is_promoted,normalize='index')\nedu.plot.bar(stacked=True)\nplt.rcParams['figure.figsize'] = [5, 5]\nplt.legend(title='is_promoted',bbox_to_anchor=(1,0.5))","28ee3056":"pd.crosstab(df.gender,df.is_promoted,normalize='index')","9871563f":"pd.crosstab(df.recruitment_channel,df.is_promoted,normalize='index')","b4a75958":"pd.crosstab(df['KPIs_met >80%'],df.is_promoted,normalize='index')","e1589a5f":"sales = df[df['department']=='Sales & Marketing']\noperations = df[df['department']=='Operations']\ntechnology = df[df['department']=='Technology']\nhr = df[df['department']=='HR']\nfin = df[df['department']=='Finance']\nlegal = df[df['department']=='Legal']\nRnD = df[df['department']=='R&D']\npd.crosstab(sales.gender,sales.is_promoted,normalize='index')","8a4cfcc1":"pd.crosstab(operations.gender,operations.is_promoted,normalize='index')","84060730":"pd.crosstab(technology.gender,technology.is_promoted,normalize='index')","cb051596":"plt.rcParams['figure.figsize'] = [3, 5]\ngender = pd.crosstab(RnD.gender,RnD.is_promoted,normalize='index')\ngender.plot.bar(stacked=True)\nplt.legend(title='is_promoted',loc='upper left',bbox_to_anchor=(1, 0.5))","95665ce9":"rating = pd.crosstab(df.previous_year_rating,df.is_promoted,normalize='index')\nrating.plot.bar(stacked=True)\nplt.legend(title='is_promoted',loc='upper left',bbox_to_anchor=(1, 0.5))","30fdf3f8":"bins = [30,40,50,60,70,80,90,100]\nlabels = ['30-40','40-50','50-60','60-70','70-80','80-90','90-100']\ndf['score_binned'] = pd.cut(df['avg_training_score'], bins=bins, labels=labels)\ndf['score_binned'].value_counts()","5dbf0a2e":"plt.rcParams['figure.figsize'] = [10, 5]\nscore_bin = pd.crosstab(df.score_binned,df.is_promoted,normalize='index')\nscore_bin.plot.bar(stacked=True)\nplt.legend(title='is_promoted',loc='upper left',bbox_to_anchor=(1, 0.5))","ae0080f7":"plt.rcParams['figure.figsize'] = [5, 5]\nage_bins = [20,30,40,50,60]\nage_labels = ['20-30','30-40','40-50','50-60']\ndf['age_binned'] = pd.cut(df['age'], bins=bins, labels=labels)\ndf['age_binned'].value_counts()\nage_bin = pd.crosstab(df.age_binned,df.is_promoted,normalize='index')\nage_bin.plot.bar(stacked=True)\nplt.rcParams['figure.figsize'] = [5, 5]\nplt.legend(title='is_promoted',loc='upper left',bbox_to_anchor=(1, 0.5))","a464ad1e":"plt.rcParams['figure.figsize'] = [14, 5]\nsns.scatterplot(x='age',y='avg_training_score',hue='is_promoted',data=df)","1b7d4199":"df.groupby([\"education\"])['avg_training_score'].mean()","9a7a6b11":"df.isnull().any()","9f9ed75c":"df['previous_year_rating'] = df.groupby([\"KPIs_met >80%\"])[\"previous_year_rating\"].apply(lambda x: x.fillna(x.mean()))\ndf[\"education\"] = df[\"education\"].astype('object')\ndf['education'] = df.groupby([\"department\"])[\"education\"].apply(lambda x: x.fillna(x.value_counts().index[0]))","608db261":"scaled_features = df.copy()\ncol_names = ['no_of_trainings', 'age','previous_year_rating','length_of_service','awards_won?','avg_training_score']\nlabel_names = ['department','gender','recruitment_channel','region']\nfeatures = scaled_features[col_names]\nscaler = preprocessing.StandardScaler().fit(features.values)\nfeatures = scaler.transform(features.values)\nscaled_features = pd.get_dummies(scaled_features, columns=label_names, drop_first=True)\nscaled_features[col_names] = features\nscaled_features.drop(columns=['employee_id','age','education','score_binned','age_binned'],inplace=True)","f9c7ad40":"X_train, X_test, y_train, y_test = train_test_split(\n    scaled_features.loc[:, scaled_features.columns != 'is_promoted'], scaled_features['is_promoted'], test_size=0.33, random_state=42)\n#forest = RandomForestClassifier(n_jobs=-1, random_state=0,class_weight='balanced',n_estimators=100,bootstrap=True, max_depth=80)\nforest = GradientBoostingClassifier(loss='exponential',max_features='auto')\nparam_grid = {\n    'n_estimators': [200,500,800]\n}\ngrid_search = GridSearchCV(estimator = forest, param_grid = param_grid,cv = 3, n_jobs = -1, verbose = 2)\n# Fit the grid search to the data\ngrid_search.fit(X_train, y_train)\ngrid_search.best_params_","2930ce2d":"feature_importances = grid_search.best_estimator_.feature_importances_\nfeature_importance = {}\nfor i in range(len(X_train.columns)):\n    feature_importance[X_train.columns[i]] = feature_importances[i]\nimportance_df = pd.DataFrame(list(feature_importance.items()),columns=['feature','importance'])\nimportance_df = importance_df.sort_values('importance',ascending=False)\nplt.xticks(rotation='vertical')\nplt.rcParams['figure.figsize'] = [18, 10]\nsns.barplot(x=\"feature\",y=\"importance\",data=importance_df)","ba8de248":"pred = grid_search.predict(X_test)\naccuracy = metrics.accuracy_score(y_test, pred)\n'accuracy - '+str(accuracy)","7fd10142":"f1 = metrics.f1_score(y_test, pred)\n'f1 score - '+str(f1)","0e11e0e4":"recall = metrics.recall_score(y_test,pred)\n'recall - '+str(recall)","ccb4869f":"precision = metrics.precision_score(y_test,pred)\n'precision - '+str(precision)","f232bddd":"Let us check if there is any ratio difference across gender within the departments. For this I chose the top 3 highly populated departments.","48a69c9c":"Fill missing values of  'previous_year_rating' with mean based on 'KPIs_met >80%' and 'education'  with median based on 'department'","e0876c69":"The transformed features are fit to a Gradient Boosting Algorithm.\nGrid Search cross validation is used to find the best hyperparameter('n_estimators')","daa3ab0f":"Promotions ratio increases with the score and the ratio is very high in 90-100 range which means getting promoted is highly dependent on the average score.\n\n**Distribution of promotion ratios with respect to age**","3f42383a":"As we can see the percentages are pretty much the same aross different educational backgrounds.","c18ba45b":"The model has a high accuracy but F1 score is less because of lesser Recall value. This means that number of False Negatives are higher which might have arised due to unbalanced classes. Oversampling or undersampling might increase F1 score.","14a24049":"While most of the employees have score in the range of 50-60, the least score bin has very faint number,\n\n**Distribution of promoted employees ratio across different score ranges**","29ec4821":"**Difference in the percentage of promoted employees with respect to previous year ratings**","dd7df18c":"**Distribution of promotions among people with different Educational backgrounds**","14d001ff":"**Prediction of employee promotion potential**","85884766":"According to the results of grid search, 500 is the optimal number of estimators.\n\n**Finding feature importances**","538a74c4":"The above graph shows the importance of each feature in building the model. Here also average training score takes first place.","6143b237":"Slight difference in the ratios can be seen within the departments unlike the ratios calculated without any department barriers.","9cecec1d":"**Feature engineering**\nNormalize all the numerical features and encode all the categorical features.","11c683a7":"There is major differnce in percentages across genders too. \nLet us check if differnce arises within the departments","eb90dc3b":"While Technology department had highest percentage of employees getting promoted, Legal department has the least number. But we don't see major differences in terms of percentages.","b9d0c9ed":"**Percentage of promotions across all the regions**","143a56f9":"This graph reinforces the fact the promotions are majorly dependent on the score and not on age.\n\n**Mean score of employees with different educational background**","04a39042":"Mean training score doesn't vary with education","64d01533":"**Percentage of people who got promoted from each department**","98552372":"The ratio of promoted employees increases with previous year rating which is quite obvious.\n\n**Distribution of average training score**","f27002d1":"**Variation of promotion percentage with respect to gender**","b552b3d6":"Higher percentage of employees got promoted in the group of people whose KPIs_met is greater than 80%.","e4ab6e99":"**Variation of promotion percentage with recruitment channel that they have come from**","4e08b89b":"**Variation of promotion percentage with respect to KPIs met or not**","40ef35ef":"**Filling the missing values**","e676bd09":"Ratio doesn't vary much with age.","63499443":"**Distribution of employees across various departments**","8c1e06d6":"According to the data, percentage of promotions is higher among the employees who got recruited through referrals."}}