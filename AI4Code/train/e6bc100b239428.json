{"cell_type":{"3658b047":"code","77f34180":"code","bab8903b":"code","2c82209f":"code","18381a81":"code","61a15ee7":"code","187150f2":"code","85b82441":"code","fcc7f8b3":"code","75bed1e0":"code","aba79a07":"code","6c6b33c7":"code","22b02282":"code","453e416a":"code","fde30169":"code","85f775d6":"code","c1bc3a98":"markdown","04b37390":"markdown","779af9c7":"markdown","fb6bfaf6":"markdown","16a152f5":"markdown","98e238a7":"markdown","a4fca323":"markdown","faf47693":"markdown","294db665":"markdown"},"source":{"3658b047":"import numpy as np\nimport pandas as pd \nimport json\nimport os\nimport matplotlib.pyplot as plt\nimport seaborn as sns \nimport datetime as dt\nfrom shapely.geometry import shape, Point, Polygon\nimport folium\nfrom folium.plugins import HeatMap, HeatMapWithTime\n%matplotlib inline","77f34180":"data_df = pd.read_csv(\"\/kaggle\/input\/covid19-romania-county-level\/ro_covid_19_time_series.csv\")","bab8903b":"ro_geo_data = \"\/kaggle\/input\/elementary-school-admission-romania-2014\/romania.geojson\"","2c82209f":"ro_map = folium.Map(location=[45.9, 24.9], zoom_start=7)\n\nfolium.GeoJson(\n    ro_geo_data,\n    name='geojson'\n).add_to(ro_map)\n\nfolium.LayerControl().add_to(ro_map)\n\nro_map","18381a81":"with open(ro_geo_data) as json_file:\n    json_data = json.load(json_file)","61a15ee7":"county_lat_long_df = pd.DataFrame()\nfor item in json_data['features']:\n    polygons = list(shape(item['geometry']))\n    county = item['properties']['name']\n    #print(county, polygons[0].centroid)\n    county_lat_long_df = county_lat_long_df.append(pd.DataFrame({'county': county, 'Lat':polygons[0].centroid.y, 'Long': polygons[0].centroid.x}, index=[0]))","187150f2":"print(list(data_df.County.unique()))","85b82441":"county_join = pd.DataFrame(list(data_df.County.unique()))\ncounty_join.columns = ['County']\ncounty_join = county_join.loc[~(county_join.County=='Not identified')]\ncounty_join.head()","fcc7f8b3":"import difflib \ndifflib.get_close_matches\ncounty_lat_long_df['County'] = county_lat_long_df.county.map(lambda x: difflib.get_close_matches(x, county_join.County)[0])\nprint(f\"Validation: {county_lat_long_df.County.nunique()},{county_lat_long_df.county.nunique()}\")\ncounty_lat_long_df.head()","75bed1e0":"data_df = data_df.merge(county_lat_long_df, on='County', how='inner')","aba79a07":"last_data_df = data_df.loc[data_df.Date==max(data_df.Date)].reset_index()\nlast_data_df.head(10)\nprint(f\"Validation: {last_data_df.county.nunique()}\")","6c6b33c7":"ro_map = folium.Map(location=[45.9, 24.9], zoom_start=6)\n\nfolium.Choropleth(\n    geo_data=ro_geo_data,\n    name='choropleth',\n    data=last_data_df,\n    columns=['county', 'Confirmed'],\n    key_on='feature.properties.name',\n    fill_color='Reds',\n    fill_opacity=0.6,\n    line_opacity=0.5,\n    legend_name='Confirmed cases \/ county'\n).add_to(ro_map)\n\n\n\nradius_min = 3\nradius_max = 50\nweight = 1\nfill_opacity = 0.2\n\n_color_conf = 'Magenta'\ngroup0 = folium.FeatureGroup(name='<span style=\\\\\"color: #EFEFE8FF;\\\\\">Confirmed cases<\/span>')\nfor i in range(len(last_data_df)):\n    lat = last_data_df.loc[i, 'Lat']\n    lon = last_data_df.loc[i, 'Long']\n    county = last_data_df.loc[i, 'county']\n\n    _radius_conf = np.sqrt(last_data_df.loc[i, 'Confirmed'])\n    if _radius_conf < radius_min:\n        _radius_conf = radius_min\n\n    if _radius_conf > radius_max:\n        _radius_conf = radius_max\n\n    _popup_conf = str(county) + '\\nConfirmed: '+str(last_data_df.loc[i, 'Confirmed'])\n                                                    \n    folium.CircleMarker(location = [lat,lon], \n                        radius = _radius_conf, \n                        popup = _popup_conf, \n                        color = _color_conf, \n                        fill_opacity = fill_opacity,\n                        weight = weight, \n                        fill = True, \n                        fillColor = _color_conf).add_to(group0)\n\ngroup0.add_to(ro_map)\n\n\nfolium.LayerControl().add_to(ro_map)\n\nro_map\n    ","22b02282":"def plot_count(feature, value, title, df, size=4):\n    f, ax = plt.subplots(1,1, figsize=(4*size,4))\n    df = df.sort_values([value], ascending=False).reset_index(drop=True)\n    g = sns.barplot(df[feature], df[value], palette='Set3')\n    g.set_title(\"Number of {}\".format(title))\n    ax.set_xticklabels(ax.get_xticklabels(),rotation=90)\n    plt.show()  ","453e416a":"plot_count('county', 'Confirmed', 'Confirmed cases per county (Judet) - last day', last_data_df)","fde30169":"def plot_time_variation(df, y='Confirmed', hue='county', size=1, is_log=False):\n    f, ax = plt.subplots(1,1, figsize=(4*size,3*size))\n    g = sns.lineplot(x=\"Date\", y=y, hue=hue, data=df)\n    plt.xticks(rotation=90)\n    plt.title(f'{y} cases grouped by {hue}')\n    if(is_log):\n        ax.set(yscale=\"log\")\n        plt.title(f'{y} cases grouped by {hue} - log scale')\n    else:\n        plt.title(f'{y} cases grouped by {hue}')\n    ax.grid(color='black', linestyle='dotted', linewidth=0.75)\n    plt.show()  ","85f775d6":"plot_time_variation(data_df, size=5, is_log=True)","c1bc3a98":"Merge the data.","04b37390":"### County distribution","779af9c7":"### Load packages","fb6bfaf6":"### Read GeoJSON Data","16a152f5":"### Check GeoJSON Data","98e238a7":"### Read Covid-19 Data","a4fca323":"### Match County names\n\nThe names in GeoJSON does not have diacritics, the names in the dataset has diacritics. We will match them. We will also dismiss the 'Not identified' data.","faf47693":"## County level distribution","294db665":"### Extract County names from GeoJSON"}}