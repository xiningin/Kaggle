{"cell_type":{"89ce2230":"code","3434056f":"code","5e97fb4b":"code","ea33358c":"code","c391c651":"code","6a248dc9":"code","5a8d3019":"code","a64c2c5f":"code","4f2b84dc":"code","4a8705e5":"code","b76c7f44":"code","bc11b0b5":"code","1f3abfd1":"code","8676527a":"code","4153b2d0":"code","cb3a5f26":"code","553bd3e1":"code","9df8a244":"code","c2cf6098":"code","895ef9cf":"code","7edaa50d":"code","8cdd5f47":"code","1312561c":"code","7ccc9dae":"code","1d47de85":"code","dda53076":"code","e34c759b":"code","2bb1b4f2":"code","9a4a1ef7":"code","5237e1d5":"code","e619846d":"markdown","11bd89bb":"markdown","946620f7":"markdown","a59645d5":"markdown","9cd7540f":"markdown","0b734791":"markdown","3ea4e2ba":"markdown","d3e0dac7":"markdown","5fcba00d":"markdown","2c950589":"markdown","34b16097":"markdown","d1a9fba1":"markdown","f7070bf9":"markdown","429f8f50":"markdown","3a73f8e4":"markdown","57013349":"markdown","32785179":"markdown","1e8a0de0":"markdown","0e54dccc":"markdown","b0a1e82e":"markdown","5f15811e":"markdown","a5ad18bc":"markdown","6ceb8b2e":"markdown","2ca348f3":"markdown","78fe02b9":"markdown","c2abe47b":"markdown","f4fd5663":"markdown","84740ecf":"markdown","4a4bddcc":"markdown","86a7217f":"markdown","f3e82c86":"markdown","15be3729":"markdown","80aa9df0":"markdown","a233b62d":"markdown","b079cc94":"markdown","bf52e71c":"markdown","9de9f337":"markdown","05038a4d":"markdown","e99b50ec":"markdown","cf027349":"markdown","1f9e1602":"markdown","7667bc74":"markdown","731d89fa":"markdown","a94a416f":"markdown"},"source":{"89ce2230":"import numpy as np \nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nwarnings.filterwarnings('ignore')\ncolor=sns.color_palette()","3434056f":"data=pd.read_csv('..\/input\/heart.csv')\ndata.head()","5e97fb4b":"fig,ax=plt.subplots(1, 2, figsize = (14,5))\nsns.countplot(data=data, x='target', ax=ax[0],palette='Set2')\nax[0].set_xlabel(\"\u041f\u0456\u0434\u0440\u0430\u0445\u0443\u043d\u043e\u043a \u0437\u0430\u0445\u0432\u043e\u0440\u044e\u0432\u0430\u043d\u044c \\n [0]->\u041d\u0456 [1]->\u0422\u0430\u043a\")\nax[0].set_ylabel(\"\u041a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044c\")\nax[0].set_title(\"\u041a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044c \u0441\u0435\u0440\u0446\u0435\u0432\u0438\u0445 \u0437\u0430\u0445\u0432\u043e\u0440\u044e\u0432\u0430\u043d\u044c\")\ndata['target'].value_counts().plot.pie(explode=[0.1,0.0],autopct='%1.1f%%',ax=ax[1],shadow=True, cmap='Greens')\nplt.title(\"\u0417\u0430\u0445\u0432\u043e\u0440\u044e\u0432\u0430\u043d\u043d\u044f \u0441\u0435\u0440\u0446\u044f\")","ea33358c":"fig,ax=plt.subplots(1,2,figsize=(14,5))\nsns.countplot(x='sex',data=data,hue='target',palette='Set1',ax=ax[0])\nax[0].set_xlabel(\"0 ->Female , 1 ->Male\")\ndata.sex.value_counts().plot.pie(ax=ax[1],autopct='%1.1f%%',shadow=True, explode=[0.1,0], cmap='Reds')\nax[1].set_title(\"0 ->Female , 1 -> Male\")","c391c651":"fig,ax=plt.subplots(1,2,figsize=(14,5))\nsns.countplot(x='fbs',data=data,hue='target',palette='Set3',ax=ax[0])\nax[0].set_xlabel(\"0-> fps <120 , 1-> fps>120\",size=12)\ndata.fbs.value_counts().plot.pie(ax=ax[1],autopct='%1.1f%%',shadow=True, explode=[0.1,0],cmap='Oranges')\nax[1].set_title(\"0 -> fps <120 , 1 -> fps>120\",size=12)","6a248dc9":"fig,ax=plt.subplots(1,2,figsize=(14,5))\nsns.countplot(x='restecg',data=data,hue='target',palette='Set3',ax=ax[0])\nax[0].set_xlabel(\"resting electrocardiographic\",size=12)\ndata.restecg.value_counts().plot.pie(ax=ax[1],autopct='%1.1f%%',shadow=True,\n                                     explode=[0.005,0.05,0.05],cmap='Blues')\nax[1].set_title(\"resting electrocardiographic\",size=12)","5a8d3019":"fig,ax=plt.subplots(1,2,figsize=(14,5))\nsns.countplot(x='slope',data=data,hue='target',palette='Set1',ax=ax[0])\nax[0].set_xlabel(\"peak exercise ST segment\",size=12)\ndata.slope.value_counts().plot.pie(ax=ax[1],autopct='%1.1f%%',shadow=True,explode=[0.005,0.05,0.05],cmap='Blues')\n\nax[1].set_title(\"peak exercise ST segment \",size=12)","a64c2c5f":"fig,ax=plt.subplots(1,2,figsize=(14,5))\nsns.countplot(x='ca',data=data,hue='target',palette='Set2',ax=ax[0])\nax[0].set_xlabel(\"number of major vessels colored by flourosopy\",size=12)\ndata.ca.value_counts().plot.pie(ax=ax[1],autopct='%1.1f%%',shadow=True,cmap='Oranges')\nax[1].set_title(\"number of major vessels colored by flourosopy\",size=12)","4f2b84dc":"fig,ax=plt.subplots(1,2,figsize=(14,5))\nsns.countplot(x='cp',data=data,hue='target',palette='Set3',ax=ax[0])\nax[0].set_xlabel(\"Chest Pain\")\ndata.cp.value_counts().plot.pie(ax=ax[1],autopct='%1.1f%%',explode=[0.01,0.01,0.01,0.01],shadow=True, cmap='Blues')\nax[1].set_title(\"Chest pain\")","4a8705e5":"fig,ax=plt.subplots(2,2,figsize=(14,10))\nsns.boxplot(y='trestbps',data=data,x='sex',hue='target',palette='Set2',ax=ax[0,0])\nax[0,0].set_title(\"Trestbps V\/S Sex\")\nsns.factorplot(y='trestbps',data=data,x='cp',hue='target',ax=ax[0,1],palette='Set2')\nax[0,1].set_title(\"Trestbps V\/S Chest Pain\")\nsns.violinplot(y='trestbps',data=data,x='exang',hue='target',ax=ax[1,0],palette='Set2')\nax[1,0].set_title(\"Trestbps V\/S Exang\")\nsns.swarmplot(y='trestbps',data=data,x='ca',hue='target',ax=ax[1,1],palette='Set2')\nax[1,1].set_title(\"Trestbps V\/S CA (Major Vessel Coloured)\")","b76c7f44":"fig,ax=plt.subplots(2,2,figsize=(14,10))\nsns.boxplot(y='chol',data=data,x='sex',hue='target',palette='Set3',ax=ax[0,0])\nax[0,0].set_title(\"Cholestrol V\/S Sex\")\nsns.boxplot(y='chol',data=data,x='cp',hue='target',ax=ax[0,1],palette='Set3')\nax[0,1].set_title(\"Cholestrol V\/S Chest Pain\")\nsns.swarmplot(y='chol',data=data,x='thal',hue='target',ax=ax[1,0],palette='Set3')\nax[1,0].set_title(\"Cholestrol V\/S Thal\")","bc11b0b5":"fig,ax=plt.subplots(2,2,figsize=(14,10))\nsns.boxplot(y='oldpeak',data=data,x='sex',hue='target',palette='Set1',ax=ax[0,0])\nax[0,0].set_title(\"oldpeak V\/S Sex\")\nsns.boxplot(y='oldpeak',data=data,x='cp',hue='target',ax=ax[0,1],palette='Set1')\nax[0,1].set_title(\"oldpeak V\/S Chest Pain\")\nsns.swarmplot(y='oldpeak',data=data,x='thal',hue='target',ax=ax[1,0],palette='Set1')\nax[1,0].set_title(\"oldpeak V\/S Thal\")\nsns.factorplot(y='oldpeak',data=data,x='ca',hue='target',ax=ax[1,1],palette='Set1')\nax[1,1].set_title(\"oldpeak V\/S CA\")","1f3abfd1":"fig,ax=plt.subplots(4,3,figsize=(15,15))\nfor i in range(12):\n    plt.subplot(4,3,i+1)\n    sns.distplot(data.iloc[:,i],kde=True, color='green')","8676527a":"fig,ax=plt.subplots(figsize=(15,5))\nsns.heatmap(data.isnull(), annot=True)","4153b2d0":"fig=plt.figure(figsize=(18,18))\nsns.heatmap(data.corr(), annot= True, cmap='Blues')","cb3a5f26":"data.sex=data.sex.astype('category')\ndata.cp=data.cp.astype('category')\ndata.fbs=data.fbs.astype('category')\ndata.restecg=data.restecg.astype('category')\ndata.exang=data.exang.astype('category')\ndata.ca=data.ca.astype('category')\ndata.slope=data.slope.astype('category')\ndata.thal=data.thal.astype('category')","553bd3e1":"data_label=data['target']\ndel data['target']\ndata_label=pd.DataFrame(data_label)","9df8a244":"data=pd.get_dummies(data,drop_first=True)\ndata.head(),data_label.head()","c2cf6098":"from sklearn.preprocessing import StandardScaler\ndata_scaled=StandardScaler().fit_transform(data)\ndata_scaled=pd.DataFrame(data=data_scaled, columns=data.columns)","895ef9cf":"data_scaled.head()","7edaa50d":"from sklearn.model_selection import train_test_split\nXtrain,Xtest,Ytrain,Ytest = train_test_split(data_scaled, data_label, test_size=0.20,\n                                             stratify=data_label,random_state=975456)","8cdd5f47":"from sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import ExtraTreesClassifier","1312561c":"from sklearn.metrics import confusion_matrix\nfrom sklearn.metrics import precision_recall_curve\nfrom sklearn.metrics import average_precision_score\nfrom sklearn.metrics import roc_curve\nfrom sklearn.metrics import auc\nfrom sklearn.model_selection import cross_val_score","7ccc9dae":"def CrossVal(dataX,dataY,mode,cv=10):\n    score=cross_val_score(mode,dataX , dataY, cv=cv, scoring='accuracy')\n    return(np.mean(score))","1d47de85":"def plotting(true,pred):\n    fig,ax=plt.subplots(1,2,figsize=(10,5))\n    precision,recall,threshold = precision_recall_curve(true,pred[:,1])\n    ax[0].plot(recall,precision,'g--')\n    ax[0].set_xlabel('Recall')\n    ax[0].set_ylabel('Precision')\n    ax[0].set_title(\"Average Precision Score : {}\".format(average_precision_score(true,pred[:,1])))\n    fpr,tpr,threshold = roc_curve(true,pred[:,1])\n    ax[1].plot(fpr,tpr)\n    ax[1].set_title(\"AUC Score is: {}\".format(auc(fpr,tpr)))\n    ax[1].plot([0,1],[0,1],'k--')\n    ax[1].set_xlabel('False Positive Rate')\n    ax[1].set_ylabel('True Positive Rate')","dda53076":"dtc=DecisionTreeClassifier(max_depth=7)\nscore_dtc=CrossVal(Xtrain,Ytrain,dtc)\nprint(\"Accuracy is : \",score_dtc)\ndtc.fit(Xtrain,Ytrain)\nplotting(Ytest,dtc.predict_proba(Xtest))\n\n","e34c759b":"rf=RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=253)\nscore_rf= CrossVal(Xtrain,Ytrain,rf)\nprint('Accuracy is:',score_rf)\nrf.fit(Xtrain,Ytrain)\nplotting(Ytest,rf.predict_proba(Xtest))\n\n","2bb1b4f2":"etc=ExtraTreesClassifier(n_estimators=10, n_jobs=-1, random_state=800)\nscore_etc= CrossVal(Xtrain,Ytrain,etc)\nprint('Accuracy is:',score_etc)\netc.fit(Xtrain,Ytrain)\nplotting(Ytest,etc.predict_proba(Xtest))\n\n","9a4a1ef7":"fig= plt.figure(figsize=(10,10))\nimportant=pd.Series(rf.feature_importances_, index=Xtrain.columns)\nsns.set_style('whitegrid')\nimportant.sort_values().plot.barh()\nplt.title('Feature Importance')","5237e1d5":"model_accuracy = pd.Series(data=[score_dtc, score_rf, score_etc, ], \n                           index=['decision tree','Random Forest', 'Extra Tree'])\nfig= plt.figure(figsize=(8,8))\nmodel_accuracy.sort_values().plot.barh()\nplt.title('Model Accracy')","e619846d":"Let's see the correlation between different features.","11bd89bb":"From the chart above, we can say that more than half of the population suffers from heart disease with a percentage of 54.5%.","946620f7":"### How Many People Have Heart Disease?","a59645d5":"The number of women suffering from heart disease exceeds that of men, but the population of men is greater than that of women.","9cd7540f":"### Cross validation function","0b734791":"Divide data into test and train sets","3ea4e2ba":"Based on the graphs, we can conclude that if the Old Peak is smaller, people will be more likely to have heart disease","d3e0dac7":"### j) Oldpeak (continuous feature)","5fcba00d":"### 1) Decision Tree Classifier","2c950589":"### a)->SEX (Category)","34b16097":"It follows that people who have upsloping are more prone to heart disease than flat and downsloping.","d1a9fba1":"Plot ROC and Precision Recall Curve functions","f7070bf9":"Let's learn more data for more information.","429f8f50":"We standardize the data (to bring each function to one scale)","3a73f8e4":"### e)  number of major vessels colored by flourosopy (category)","57013349":"### Analysis by each category","32785179":"Based on the above analysis, it can be said that gender plays a minor role in blood pressure (trestbps). But chest pain plays an important role. As chest pain increases, blood pressure will also increase with the chance of heart disease.","1e8a0de0":"An electrocardiogram (ECG) is a test that measures the electrical activity of your heart to show whether it works or not. The ECG records the rhythm and activity of the heart on a rolling strip of paper or a line on the screen.","0e54dccc":"### d) the slope of the peak exercise ST segment (slope)(Category)","b0a1e82e":"4 levels of chest pain are given in the data where 3 are the highest.","5f15811e":"Working with missing data","a5ad18bc":"So, after modeling, we can say that thal_2 and oldeak are the most important prediction feature","6ceb8b2e":"### Attribute information:\n    1. age                                                  2. sex\n    3. chest pain type (4 values)                           4. resting blood pressure\n    5. serum cholestoral in mg\/dl                           6. fasting blood sugar > 120 mg\/dl\n    7. resting electrocardiographic results (values 0,1,2)  8. maximum heart rate achieved\n    9. exercise induced angina                              10. oldpeak = ST depression induced by exercise relative to rest\n    11. the slope of the peak exercise ST segment           12. number of major vessels (0-3) colored by flourosopy\n    13. thal: 3 = normal; 6 = fixed defect; \n            7 = reversable defect                           14. target column","2ca348f3":"The feature (the peak exercise ST segment slope) has three symbolic values (flat, upsloping, downsloping).","78fe02b9":"### 2) Random Forest Classifier","c2abe47b":"### IMOPORTANT FEATURES\n","f4fd5663":"Thanks for useful information to vbmokin (https:\/\/www.kaggle.com\/vbmokin)","84740ecf":"## Data analysis","4a4bddcc":"### i) Cholestrol (continuous feature)","86a7217f":"According to the chart, people who have fps <120 are more likely to get sick than people who have fps> 120","f3e82c86":"Women have higher cholesterol than men. Chances of heart disease diminish with lowering cholesterol.","15be3729":"### h) Trestbps (continuous feature)","80aa9df0":"Graph accuracy models","a233b62d":"### 3) Extra Trees Classifier","b079cc94":"From the above graph you can say that if the value of the criterion of resting electrocardiographic is 1, then the person is more likely to get sick.","bf52e71c":"People who are at the 3rd level of chest pain are significantly less compared to people who are at the second level of chest pain.","9de9f337":"### b)-> fasting blood sugar (Fbs) (Category)","05038a4d":"Now we work on every feature conversion","e99b50ec":"This kernel should help students for understanding how to work with classifiers (that is why there is ukrainian language).","cf027349":"Using the second chart (Cholestrol V \/ S Chest Pain), we can say that if cholesterol is less than 240 and chest pain is at 3 ~ 4, then the chances of heart disease are higher.","1f9e1602":"### c) resting electrocardiographic results (values 0,1,2) (Category)","7667bc74":"Based on the heat map above, most features are highly correlated with each other.","731d89fa":"### g) Chest Pain (category)","a94a416f":"### Importing ML libraries"}}