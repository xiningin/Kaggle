{"cell_type":{"d48d6f62":"code","28041ae0":"code","0c14cce1":"code","163bcf1b":"code","03cb4948":"code","f43fc65e":"code","e810233d":"code","21c40db3":"code","be088cf0":"code","39327156":"code","8760ffc0":"code","c1daf8be":"markdown","e4d64c02":"markdown","23ab117f":"markdown","fe484273":"markdown","8ffa44c7":"markdown","d0ca31a3":"markdown","5e34f7a5":"markdown","add04235":"markdown","a4d2d75c":"markdown","e35ff605":"markdown","0d87e74e":"markdown","629145b7":"markdown","15191df1":"markdown","91d95fa7":"markdown"},"source":{"d48d6f62":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","28041ae0":"import tensorflow as tf\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator","0c14cce1":"datagen = ImageDataGenerator(rescale=1.\/255,\n                                      zoom_range=0.2,\n                                      width_shift_range=0.2,\n                                      height_shift_range=0.2,\n                                      validation_split=0.2\n                                      )\ntrain_data = datagen.flow_from_directory('..\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images',\n                                                     target_size=(224,224),\n                                                     batch_size=32,\n                                                     class_mode = 'categorical',\n                                                     subset = 'training')\n\nvalid_data = datagen.flow_from_directory('..\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images',\n                                                     target_size=(224,224),\n                                                     batch_size=32,\n                                                     class_mode = 'categorical',\n                                                     subset = 'validation')","163bcf1b":"!pip install -q efficientnet","03cb4948":"import efficientnet.tfkeras as efn","f43fc65e":"def lr_rate(epoch,lr):\n    if epoch<10:\n        lr=0.0001\n        return lr\n    elif epoch<=15:\n        lr=0.0005\n        return lr\n    elif epoch<=30:\n        lr=0.0001\n        return lr\n    else:\n        lr=lr*(epoch\/(1+epoch))\n        return lr\nlr_callback=tf.keras.callbacks.LearningRateScheduler(lr_rate)","e810233d":"model = tf.keras.Sequential([\n        efn.EfficientNetB0(\n            input_shape=(224,224, 3),\n            weights='imagenet',\n            include_top=False\n        ),tf.keras.layers.Flatten(),tf.keras.layers.Dense(5, activation='softmax')\n    ])\n    \nmodel.compile(optimizer=\"Adam\",loss='categorical_crossentropy',metrics=['acc'])\n","21c40db3":"\nhistory=model.fit_generator(train_data,validation_data = valid_data,callbacks=[lr_callback],epochs=40,verbose=1)\n","be088cf0":"import matplotlib.pyplot as plt","39327156":"def display_training_curves(training, validation, title, subplot):\n    \n    if subplot%10==1: # set up the subplots on the first call\n        plt.subplots(figsize=(10,10), facecolor='#F0F0F0')\n        plt.tight_layout()\n    ax = plt.subplot(subplot)\n    ax.set_facecolor('#F8F8F8')\n    ax.plot(training)\n    ax.plot(validation)\n    ax.set_title('model '+ title)\n    ax.set_ylabel(title)\n    #ax.set_ylim(0.28,1.05)\n    ax.set_xlabel('epoch')\n    ax.legend(['train', 'valid.'])","8760ffc0":"display_training_curves(\n    history.history['loss'], \n    history.history['val_loss'], \n    'loss', 211)\ndisplay_training_curves(\n    history.history['acc'], \n    history.history['val_acc'], \n    'accuracy', 212)","c1daf8be":"## Defining the learning rate scheduler","e4d64c02":"Google recently published both a very exciting paper and source code for a newly designed CNN (convolutional neural network) called EfficientNet, that set new records for both accuracy and computational efficiency.\nThis was not a minor improvement but rather an accuracy improvement of up to 6% while on the order of 5\u201310x more efficient than most current CNN\u2019s. ","23ab117f":"## We got smoother validation and training curves.","fe484273":"You might not have symptoms in the early stages of diabetic retinopathy. As the condition progresses, diabetic retinopathy symptoms may include:\n\n* Spots or dark strings floating in your vision (floaters)\n* Blurred vision\n* Fluctuating vision\n* Impaired color vision\n* Dark or empty areas in your vision\n* Vision loss\n* Diabetic retinopathy usually affects both eyes.","8ffa44c7":"## Using EfficientNet for Transfer Learning","d0ca31a3":"**Diabetic retinopathy** is a diabetes complication that affects eyes. It's caused by damage to the blood vessels of the light-sensitive tissue at the back of the eye (retina). At first, diabetic retinopathy may cause no symptoms or only mild vision problems.\n\n![image.png](attachment:image.png)","5e34f7a5":"Diabetic retinopathy is caused by high blood sugar due to diabetes. Over time, having too much sugar in your blood can damage your retina \u2014 the part of your eye that detects light and sends signals to your brain through a nerve in the back of your eye (optic nerve).  \n\n\n\nDiabetes damages blood vessels all over the body. The damage to your eyes starts when sugar blocks the tiny blood vessels that go to your retina, causing them to leak fluid or bleed. To make up for these blocked blood vessels, your eyes then grow new blood vessels that don\u2019t work well. These new blood vessels can leak or bleed easily. ","add04235":"In this kernel we wil use Convolutional Neural Networks to predict the probability that wether a person is suffering from DIabteic Retinopathy or not using the sample images provided to us in the dataset.","a4d2d75c":"![image.png](attachment:image.png)","e35ff605":"**Diabetic retinopathy can lead to other serious eye conditions:** \n\n1. Diabetic macular edema (DME). Over time, about half of people with diabetic retinopathy will develop DME. DME happens when blood vessels in the retina leak fluid, causing swelling in the macula (a part of the retina). If you have DME, your vision will become blurry because of the extra fluid in your macula.  \n\n2. Neovascular glaucoma. Diabetic retinopathy can cause abnormal blood vessels to grow out of the retina and block fluid from draining out of the eye. This causes a type of glaucoma.","0d87e74e":"## Now, let us try Efficient Net","629145b7":"### Using the Image Data Generator ","15191df1":"![image.png](attachment:image.png)","91d95fa7":"## Diabetic Retinopathy"}}