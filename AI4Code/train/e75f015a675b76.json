{"cell_type":{"8dc1b74c":"code","4247811c":"code","3f59fdcc":"code","8944d7c8":"code","0218b01a":"code","24e26f26":"code","2f91dc6e":"code","7696594d":"code","0d6ef309":"code","d751b37d":"code","ad1089c5":"code","3e12197b":"code","1e73441e":"code","f4c67b8d":"code","7329ef99":"code","1ba0f358":"code","4fdc5c60":"code","226f3885":"code","be32b14b":"code","adf6a56a":"code","899373d9":"code","bdf4aab1":"code","59a4114a":"code","c2415c67":"code","343ae6c5":"code","6fa99175":"code","eaca2e34":"code","b1cc44e7":"code","fba7c845":"code","1fe692db":"code","66dc0da7":"code","9cede3b1":"code","ba39aad0":"code","952158bc":"code","9c16b37d":"code","2d299ed1":"code","5e94277b":"code","9d72325a":"code","c4bbf7e5":"code","e4a35d7d":"code","bd7dace0":"markdown","bad4288c":"markdown","6b25d0fc":"markdown","981df92c":"markdown","e668a703":"markdown","836eab55":"markdown","259f74ad":"markdown","896dd080":"markdown"},"source":{"8dc1b74c":"import numpy as np\nimport pandas as pd\nimport xgboost as xgb\nimport os\nfrom sklearn.model_selection import train_test_split","4247811c":"train_df = pd.read_csv('..\/input\/train.csv')\ntest_df = pd.read_csv('..\/input\/test.csv')\n","3f59fdcc":"train_df.dtypes","8944d7c8":"train_df.head()","0218b01a":"test_df.tail()","24e26f26":"train_df['trsin_or_test'], test_df['trsin_or_test'] = 'train', 'test'\ndata_df = pd.concat([train_df, test_df])\ndata_df.head()","2f91dc6e":"data_df['date']=pd.to_datetime(data_df['date'])","7696594d":"data_df.dtypes","0d6ef309":"data_df.info()","d751b37d":"data_df['year'] = data_df['date'].dt.year\ndata_df['quarter'] = data_df['date'].dt.quarter\ndata_df['month'] = data_df['date'].dt.month\ndata_df['weekofyear'] = data_df['date'].dt.weekofyear\ndata_df['weekday'] = data_df['date'].dt.weekday\ndata_df['dayofweek'] = data_df['date'].dt.dayofweek","ad1089c5":"data_df.head()","3e12197b":"data_df.groupby(['quarter', 'item'])['sales'].mean()","1e73441e":"data_df['item_quarter_mean'] = data_df.groupby(['quarter', 'item'])['sales'].transform('mean')","f4c67b8d":"data_df.head()","7329ef99":"data_df['store_quarter_mean'] = data_df.groupby(['quarter', 'store'])['sales'].transform('mean')\ndata_df['store_item_quarter_mean'] = data_df.groupby(['quarter', 'item', 'store'])['sales'].transform('mean')","1ba0f358":"data_df['item_month_mean'] = data_df.groupby(['month', 'item'])['sales'].transform('mean')\ndata_df['store_month_mean'] = data_df.groupby(['month', 'store'])['sales'].transform('mean')\ndata_df['store_item_month_mean'] = data_df.groupby(['month', 'item', 'store'])['sales'].transform('mean')","4fdc5c60":"data_df['item_weekofyear_mean'] = data_df.groupby(['weekofyear', 'item'])['sales'].transform('mean')\ndata_df['store_weekofyear_mean'] = data_df.groupby(['weekofyear', 'store'])['sales'].transform('mean')\ndata_df['store_item_weekofyear_mean'] = data_df.groupby(['weekofyear', 'item', 'store'])['sales'].transform('mean')\n","226f3885":"data_df['itemweekday_mean'] = data_df.groupby(['weekday', 'item'])['sales'].transform('mean')\ndata_df['storeweekday_mean'] = data_df.groupby(['weekday', 'store'])['sales'].transform('mean')\ndata_df['storeitemweekday_mean'] = data_df.groupby(['weekday', 'item', 'store'])['sales'].transform('mean')","be32b14b":"data_df.head()","adf6a56a":"data_df.tail(n=3)","899373d9":"data_df.isnull().sum().sum()","bdf4aab1":"data_df.info()","59a4114a":"data_df.head()","c2415c67":"data_df.shape","343ae6c5":"data_df.columns","6fa99175":"data_df.drop(['date','id','sales'],axis=1,inplace=True)","eaca2e34":"data_df.info()","b1cc44e7":"x= data_df[data_df['trsin_or_test'] == 'train']#.dropna().drop(['id', 'sales', 'trsin_or_test', 'date'], axis=1)\ntest = data_df[data_df['trsin_or_test'] == 'train']#.dropna()['sales']","fba7c845":"x.head()","1fe692db":"test.head()","66dc0da7":"x.drop(['trsin_or_test'],axis=1,inplace=True)\ntest.drop(['trsin_or_test'],axis=1,inplace=True)","9cede3b1":"y=pd.read_csv('..\/input\/train.csv',usecols=['sales'])\ny=y.sales","ba39aad0":"y.shape","952158bc":"y.head()","9c16b37d":"x_train, x_validate, y_train, y_validate = train_test_split(x, y, random_state=0, test_size=0.25)","2d299ed1":"print(x_train.shape, x_validate.shape, y_train.shape, y_validate.shape)","5e94277b":"%%time\nparams = {\n    'colsample_bytree': 0.8,\n    'eta': 0.1,\n    'eval_metric': 'mae',\n    'lambda': 1,\n    'max_depth': 6,\n    'objective': 'reg:linear',\n    'seed': 0,\n    'silent': 1,\n    'subsample': 0.8,\n}\nxgbtrain = xgb.DMatrix(x_train, label=y_train)\nxgbvalidate = xgb.DMatrix(x_validate, label=y_validate)\nxgbmodel = xgb.train(list(params.items()), xgbtrain, early_stopping_rounds=50, evals=[(xgbtrain, 'train'), (xgbvalidate, 'validate')], num_boost_round=200, verbose_eval=50)","9d72325a":"%%time\nmodel = xgbmodel\n\n\npredict=pd.DataFrame(model.predict(xgb.DMatrix(test),ntree_limit=model.best_ntree_limit),columns=['sales'])\n","c4bbf7e5":"ids=pd.read_csv(\"..\/input\/test.csv\",usecols=['id'])\nsub=ids.join(predict)\nsub.head()","e4a35d7d":"sub.to_csv('xgb_grpby_mean.csv',index=False)","bd7dace0":"> **New cols for mean() based on quarter**","bad4288c":"> **loading dataset**","6b25d0fc":"> **submssion of results**\n\n","981df92c":"> **New cols for mean() based on weekof year** ","e668a703":"> **New cols for mean() based on weekday** ","836eab55":"> **Model Predection**","259f74ad":"> **New cols for mean() based on month** ","896dd080":"### Libraries"}}