{"cell_type":{"4f3a3df7":"code","22b056ac":"code","cc4a68b3":"code","251beb57":"code","3007ab43":"code","3d2b4a7b":"code","c79b2796":"code","12f10d54":"code","de44d620":"code","2e4eec48":"code","b2e22b63":"code","33a201b6":"code","9a7dc1ab":"code","351cb294":"code","8e2a2753":"code","60b7b810":"code","86ec0a1a":"code","97b4d2ef":"code","77e9b3c0":"code","194e858f":"code","389ee134":"code","d2605276":"code","ffe60ba4":"code","be205fc2":"code","4fdd43a0":"code","98631e04":"code","36da7e1a":"code","1a86f314":"code","3ebb1c13":"code","b15c71f3":"code","bb1301a9":"code","c643a8ec":"code","41b4116f":"code","38bc70cc":"code","74579cd2":"code","16d086fa":"code","44498d6f":"code","30dcbfa4":"code","210269be":"code","e54929f9":"code","8373e941":"code","4c11aa9d":"code","4398e24d":"code","7c0cec76":"code","acac9ea8":"code","5e96c89f":"code","0e47d733":"code","a658dca9":"code","67535d03":"code","0910decd":"code","88cbb096":"code","53b0128f":"code","bda19f8e":"code","b4f9d308":"code","0623e28f":"code","cb195044":"code","78c343cc":"code","f7ee0c23":"code","5fc7c173":"code","a37ec3fa":"code","00f97314":"markdown","f413eefe":"markdown","1e38293d":"markdown","0e1a1756":"markdown","8302ae66":"markdown","2ea94f0d":"markdown","d5456680":"markdown","de6036b5":"markdown","9884ba21":"markdown","d0f64c93":"markdown","04d72cad":"markdown","520ff4f0":"markdown","9bbed992":"markdown","6d2bd685":"markdown","251854fd":"markdown","5e74d9e1":"markdown","cec175a5":"markdown","66e4503e":"markdown","e785ba11":"markdown","f8121575":"markdown","38e281d2":"markdown","b34a876a":"markdown","1a89bba5":"markdown","6b096f18":"markdown","e4410e50":"markdown","6b93e047":"markdown","1167088c":"markdown","d1e1e9d4":"markdown","94d9faf0":"markdown","5a87c59f":"markdown","49f23610":"markdown","593a4c63":"markdown","9e9cc6ca":"markdown","5f43109c":"markdown","ae88d8ea":"markdown","3ff6524f":"markdown","d8021b79":"markdown","17960f9c":"markdown","9f34d826":"markdown"},"source":{"4f3a3df7":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","22b056ac":"data = pd.read_csv('\/kaggle\/input\/sao-paulo-real-estate-sale-rent-april-2019\/sao-paulo-properties-april-2019.csv')","cc4a68b3":"data.head()","251beb57":"data.isnull().sum()","3007ab43":"data.shape","3d2b4a7b":"data.dtypes","c79b2796":"# Checking unique values for negotition types\ndata['Negotiation Type'].unique(), data['Property Type'].unique()","12f10d54":"# We have a good proportions of values between our dataset, this could be nice for us to \n#maybe predict which appartment is on rent or sale,\n#or maybe create a different model for prices according to the negotiation type\ndata['Negotiation Type'].value_counts()","de44d620":"# to split data we have to distinguish wich columns we want to split, in our case im splitting District and city\ndata[['District','City']] = data['District'].str.split('\/', expand = True)","2e4eec48":"data.head()","b2e22b63":"data.describe()","33a201b6":"## So we can drop the last column City from our dataset\ndata = data.drop(columns = 'City', axis = 1)\ndata.head()","9a7dc1ab":"plt.figure(figsize = (12,8))\nax = sns.countplot(x = 'Negotiation Type', data = data, alpha = 0.8)\nax.set_title('Amount of apartaments for sale and in rent in S\u00e3o Paulo', fontsize = 22)\nax.set_ylabel('Number of apartments', fontsize = 1)\nax.set_xlabel('Status', fontsize = 16)","351cb294":"data['District'].value_counts()","8e2a2753":"ax = sns.catplot(x = 'Negotiation Type', y = 'Price', kind = 'boxen',\n                data = data)","60b7b810":"sns.scatterplot(x = 'Condo', y = 'Price', hue = 'Negotiation Type', data = data)","86ec0a1a":"# Let's keep exploring out data\nplt.figure(figsize = (12,8))\nax = sns.catplot(x = 'Suites', y = 'Price',data = data[data['Negotiation Type'] == 'sale'], kind = 'boxen');","97b4d2ef":"plt.figure(figsize = (10,8))\nax = sns.regplot(x = 'Size', y = 'Price', data = data[data['Negotiation Type'] == 'sale'])","77e9b3c0":"plt.figure(figsize = (10,6))\nax = sns.scatterplot(x = 'Size', y = 'Condo', hue = 'Negotiation Type', data = data)\n\nax.set_title('Condo x Size', fontsize = 22)\nax.set_ylabel('Condo', fontsize = 16)\nax.set_xlabel('Size', fontsize = 16)","194e858f":"sns.relplot(x = 'Size', y = 'Condo', data = data, hue = 'Negotiation Type', col = 'Negotiation Type')","389ee134":"data_rent = data[data['Negotiation Type'] == 'rent']\ndata_sale = data[data['Negotiation Type'] == 'sale']","d2605276":"# Let's keep exploring out data\nax = sns.catplot(x = 'Rooms', y = 'Price',data = data_sale, kind = 'boxen',\n            palette = 'cubehelix')","ffe60ba4":"plt.figure(figsize =(10,6))\nax = sns.boxplot(x = 'Toilets', y = 'Price', data = data_sale,\n                palette = 'plasma')\n\nax.set_title('Distribution of toilets', fontsize = 22)\nax.set_ylabel('Price', fontsize = 16)\nax.set_xlabel('Size', fontsize = 16)\n","be205fc2":"grouped = data_sale.groupby('District')['Price'].mean().reset_index()\ngrouped = grouped.sort_values(by = 'Price',ascending = False)\nplt.figure(figsize = (40,40))\nsns.set(font_scale = 2.3)\nax = sns.barplot(x='Price', y='District', data= grouped,palette = 'plasma')","4fdd43a0":"sns.set(font_scale = 1)","98631e04":"data_rent.describe()","36da7e1a":"# Let's keep exploring out data\nplt.figure(figsize =(10,8))\nax = sns.boxplot(x = 'Rooms', y = 'Price',data = data_rent,\n            palette = 'cubehelix')","1a86f314":"# Let's keep exploring out data\nax = sns.catplot(x = 'Suites', y = 'Price',data = data_rent, kind = 'boxen',\n            palette = 'cubehelix')","3ebb1c13":"grouped = data_rent.groupby('District')['Price'].mean().reset_index()\ngrouped = grouped.sort_values(by = 'Price',ascending = False)\nplt.figure(figsize = (40,40))\nsns.set(font_scale = 2.3)\nax = sns.barplot(x='Price', y='District', data= grouped,\n                palette = 'plasma')\nax.set_title('Mean Price per District', fontsize = 45)","b15c71f3":"sns.set(font_scale = 1)","bb1301a9":"sns.catplot(x='Parking', y='Price', data=data_rent);\n","c643a8ec":"plt.figure(figsize =(10,8))\nax = sns.boxplot(x = 'Furnished', y = 'Price',data = data_rent,\n            palette = 'cubehelix')","41b4116f":"plt.figure(figsize=(10,10))\nax = sns.distplot(data_rent['Price'])","38bc70cc":"ax = sns.pairplot(data_rent, y_vars = 'Price', x_vars = ['Condo', 'Size', 'Rooms','Toilets','Suites','Parking','Elevator'], height = 5, kind = 'reg')\nax.fig.suptitle('Dispers\u00e3o entre as Vari\u00e1veis', fontsize=20, y=1.05)\nax","74579cd2":"data_rent['log_Price'] = np.log(data_rent['Price'])\ndata_rent['log_Condo'] = np.log(data_rent['Condo'])\ndata_rent['log_Size'] = np.log(data_rent['Size'])\ndata_rent['log_Furnished'] = np.log(data_rent['Furnished']+1)\ndata_rent['log_Swim'] = np.log(data_rent['Swimming Pool']+1)\ndata_rent['log_Elevator'] = np.log(data_rent['Elevator']+1)","16d086fa":"data_rent.head()","44498d6f":"# correlation plot\nplt.figure(figsize = (10,8))\ncorr = data_rent.corr()\nsns.heatmap(corr, cmap = 'plasma', annot= True);","30dcbfa4":"y = data_rent['log_Price']","210269be":"X = data_rent[['log_Size', 'log_Swim', 'log_Furnished']]","e54929f9":"## Train test split\nfrom sklearn.model_selection import train_test_split","8373e941":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 42)","4c11aa9d":"import statsmodels.api as sm","4398e24d":"X_train_const = sm.add_constant(X_train)\nX_train","7c0cec76":"X_train_const","acac9ea8":"model_statsmodels = sm.OLS(y_train,X_train_const, hasconst = True).fit()","5e96c89f":"model_statsmodels.summary()","0e47d733":"print(model_statsmodels.summary())","a658dca9":"from sklearn.linear_model import LinearRegression\nfrom sklearn import metrics","67535d03":"model = LinearRegression()\nmodel.fit(X_train,y_train)","0910decd":"model.score(X_train,y_train).round(3)","88cbb096":"y_pred = model.predict(X_test)","53b0128f":"metrics.r2_score(y_test, y_pred).round(3)","bda19f8e":"print(model.coef_)\nprint(model.intercept_)","b4f9d308":"X_train.columns","0623e28f":"index = ['Intercept','log_Size', 'log_Swim', 'log_Furnished']","cb195044":"pd.DataFrame(data= np.append(model.intercept_, model.coef_), index = index, columns = ['Parameters'])","78c343cc":"y_pred_train = model.predict(X_train)","f7ee0c23":"ax = sns.scatterplot(x = y_pred_train, y = y_train)\nax.figure.set_size_inches(12, 6)\nax.set_title('Pred X Real', fontsize=18)\nax.set_xlabel('log Price - Pred', fontsize=14)\nax.set_ylabel('log Price - Real', fontsize=14)\nax","5fc7c173":"## Getting residuals\nresid = y_train - y_pred_train","a37ec3fa":"## Ploting the histogram of the residuals\nplt.figure(figsize=(10,8))\nsns.distplot(resid)\nax.figure.set_size_inches(20, 10)\nax.set_title('Histogram from our resid', fontsize=18)\nax.set_xlabel('log Price', fontsize=14)\nax","00f97314":"## Making predictions with our X_train","f413eefe":"Strange values coming up the mean of price is 2.877, std aswell, weird. Let's found out","1e38293d":"Does number of parkings increases the price ?","0e1a1756":"\n In this code we can conclude that in this dataset we only have appartaments for sale or rent in SP","8302ae66":"\nReally there are appartaments with more than 5 toilets ? xD\n\nWhats the average price for sale in each district ?","2ea94f0d":"\nThe values for rent are with 0 prices, because they pay for Condo, instead of actually paying to buy the appartment\n\nThere is difference of price with apparamets with suites or no ?","d5456680":"Creating dataframe to show the coefs","de6036b5":"\nYes, for sure. As increase the number of suites in the appartment, grows it's price\n\nLet's see how is related our variable size in our dataset","9884ba21":"The prices increase as the number of suites gets higher...\n\nWhich district has higher mean price in S\u00e3o Paulo ?","d0f64c93":"*Let's start the analysis for appartaments for sale*\n\nNumber of rooms inscrease the final price ?\n","04d72cad":"*Maybe the rent dataset is better than data_sale, we will keep our analysis with data_rent*","520ff4f0":"\nWe can visualize a positive relation between size and price. Let's visualize the condo for the rent appartments","9bbed992":"Knowing more about our dataset","6d2bd685":"\nThe number of Suites inscreases the price ?","251854fd":"\nReally weird this data, let's plot in a scatter plot some of these values","5e74d9e1":"# From here i will digging into our x , y variables\n","cec175a5":"## Exploratory Data Analysis (EDA)\n\n\nFirst question, how many apartments we have for sale anf for rent ?\n\n","66e4503e":"\nIf we want we can plot differently","e785ba11":"Checking null values","f8121575":"\nChecking the distribuition of price","38e281d2":"## Getting R\u00b2 from our y_pred","b34a876a":"*Not the best R-Squared but ok.*","1a89bba5":"# Implementing linear regression","6b096f18":"## Declaring x and y","e4410e50":"## Splitting into rent and sale \nI think the best situation we have is try an analysis differently for each type of negociation\u00b6","6b93e047":"## Now lets visualize the data in rent","1167088c":"## Getting predictions","d1e1e9d4":"Itaim bibi, Iguatemi, Pinheiros and Moema they are the top4 in price rent in s\u00e3o paulo","94d9faf0":"*Intercept - Excluding all effects from the variables log_size, log_swim and log_furnished, we the mean price of R$ 30*\n\n*log_size = For every 1 % incresead in size we have an increase of 0.94% of the price*\n\n\n*log_swim = For every 1 % incresead in size we have an increase of 0.36% of the price*\n\n\n*log_Furnished = For every 1 % incresead in size we have an increase of 0.60% of the price*","5a87c59f":"\nThe distribuition for our y is not a normal distribution","49f23610":"## Checking our model","593a4c63":"Second question, how's distribuited the apartaments in the districs  ?","9e9cc6ca":"\nWe can't see the difference due the outliers from unfurnished appartaments, but is a slighty diference between the medians","5f43109c":"*We see that the price really increases when the appartment has more than 3 rooms apparently. It's is not really good these analysis, because 4 rooms has a huge outlier and probably the y scale is not really realistic But for what we can see, now, we can assume that*\n\nAnd for toilets ? Maybe more than 2 toilets increases a lot ?","ae88d8ea":"\nI guess furnished appartaments for sure has higher values, lets check this","3ff6524f":"Types of our data looks like ok","d8021b79":"## Getting our R\u00b2","17960f9c":"\nWe can see the we have 96 districts in S\u00e3o Paulo, and the top5 are Moema, Mooca, Br\u00e1s, Bela Vista and Brooklin\n\nThird question, how's our price is distribuited between for sale and rent","9f34d826":"## Interpreting our coeficient"}}