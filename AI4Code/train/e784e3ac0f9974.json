{"cell_type":{"19718f59":"code","13f5bd6b":"code","e605f9fb":"code","21d3aa90":"code","e028727e":"code","47ed34f9":"code","dd34b520":"code","21cba114":"code","4902300f":"code","cfd2f85d":"code","a90494d0":"code","dc034e34":"code","3e5a1597":"code","70f2fa95":"code","de0fd568":"code","49112aad":"code","7d1dea9d":"code","4a62d16b":"code","4e223aed":"code","0eeb03a4":"code","c9d33bb4":"code","4a3360b5":"code","24a66b13":"code","b6777a8f":"code","640f15b6":"code","61fd976c":"code","2c59be53":"code","5642aa8d":"code","5356a1d4":"code","1b894d36":"code","76ae54fb":"code","c75ab384":"code","da07c46d":"code","d83944ca":"code","8e6f3456":"code","3d8a66b5":"code","3f2a4627":"code","1757a90d":"code","cd5b691e":"code","3ee7b797":"code","d884d249":"code","ad62e00c":"code","26cef661":"markdown","b1bd0a74":"markdown","e4afc02b":"markdown","2b0ebac8":"markdown","800d9535":"markdown","53905483":"markdown","f23aaecc":"markdown","ab59e920":"markdown","3c59f0a1":"markdown","fdd8b6ef":"markdown","043e23ad":"markdown","3b71ba1a":"markdown","0a8f542b":"markdown","5b12ec9e":"markdown","8cfafb61":"markdown","cd8be43b":"markdown","310b3eb8":"markdown","d929b4a6":"markdown","dbb4758a":"markdown","2b82689c":"markdown","2d2ef999":"markdown","8c8ddbfe":"markdown","c3e3d970":"markdown","c41d3429":"markdown","ab19128b":"markdown","0babeab4":"markdown","de6bc940":"markdown","efec05d8":"markdown","54502348":"markdown","a65eb9c9":"markdown","a8c88a93":"markdown","fda1df8a":"markdown","733c67f3":"markdown","bf27d85d":"markdown","a3291276":"markdown","74488e70":"markdown","937ce0a1":"markdown","9c33fe6c":"markdown","3231e14e":"markdown","56b6a0ac":"markdown","120b55e5":"markdown","a89145c0":"markdown","75efff6f":"markdown","247d8886":"markdown","fc1a5355":"markdown","1e5810be":"markdown","18fcfe51":"markdown"},"source":{"19718f59":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nfrom sklearn import tree\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier, ExtraTreesClassifier, AdaBoostClassifier, GradientBoostingClassifier, VotingClassifier\nfrom sklearn.model_selection import cross_val_score, train_test_split, StratifiedKFold\nfrom sklearn.metrics import accuracy_score, confusion_matrix, f1_score\nfrom sklearn.preprocessing import MinMaxScaler, StandardScaler, LabelEncoder\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.discriminant_analysis import LinearDiscriminantAnalysis\nfrom sklearn.svm import SVC\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.naive_bayes import GaussianNB\nimport xgboost as xgb","13f5bd6b":"SEED = 1\nsns.set(rc={'figure.figsize': (9, 6)})\nsns.set_style('white')","e605f9fb":"# Load the data\n\ndf = pd.read_csv('..\/input\/WA_Fn-UseC_-Telco-Customer-Churn.csv')","21d3aa90":"df.shape","e028727e":"df.head()","47ed34f9":"df.columns","dd34b520":"df.info()","21cba114":"# Find the ratio of churned customers\n\nprint(df['Churn'].value_counts(normalize=False))\nprint('\\n')\nprint(df['Churn'].value_counts(normalize=True))","4902300f":"# Replace the text values in Churn column with boolean values of 0 and 1\n\ndf['Churn'].replace({'No': 0, 'Yes': 1}, inplace=True)","cfd2f85d":"target_variable = 'Churn'","a90494d0":"def plot_categorical_column(column_name):\n    \"\"\"\n    A generic function to plot the distribution of a categorical column, and\n    the ratio of Churn in each of the values of that column.\n    \"\"\"\n    f, (ax1, ax2) = plt.subplots(2, figsize=(9, 12))\n    sns.countplot(x=column_name, data=df, ax=ax1)\n    sns.pointplot(x=column_name, y=target_variable, data=df, ax=ax2)\n    ax2.set_ylim(0, 0.5)","dc034e34":"def plot_continuous_column(column_name):\n    \"\"\"\n    A generic function to plot the distribution of a continuous column, and\n    boxplot of that column for each value of Churn\n    \"\"\"\n    f, (ax1, ax2) = plt.subplots(2, figsize=(9, 12))\n    sns.distplot(df[column_name], ax=ax1)\n    sns.boxplot(x='Churn', y=column_name, data=df, ax=ax2)","3e5a1597":"plot_categorical_column('gender')","70f2fa95":"plot_categorical_column('SeniorCitizen')","de0fd568":"plot_categorical_column('Partner')","49112aad":"plot_categorical_column('Dependents')","7d1dea9d":"plot_continuous_column('tenure')","4a62d16b":"plot_categorical_column('PhoneService')","4e223aed":"plot_categorical_column('MultipleLines')","0eeb03a4":"plot_categorical_column('InternetService')","c9d33bb4":"plot_categorical_column('OnlineSecurity')","4a3360b5":"plot_categorical_column('OnlineBackup')","24a66b13":"plot_categorical_column('DeviceProtection')","b6777a8f":"plot_categorical_column('TechSupport')","640f15b6":"plot_categorical_column('StreamingTV')","61fd976c":"plot_categorical_column('StreamingMovies')","2c59be53":"plot_categorical_column('Contract')","5642aa8d":"plot_categorical_column('PaperlessBilling')","5356a1d4":"plot_categorical_column('PaymentMethod')","1b894d36":"plot_continuous_column('MonthlyCharges')","76ae54fb":"binary_columns_replace_dict = {\n    'gender': {\n        'Female': 0,\n        'Male': 1\n    },\n    'Partner': {\n        'No': 0,\n        'Yes': 1\n    },\n    'Dependents': {\n        'No': 0,\n        'Yes': 1\n    },\n    'PhoneService': {\n        'No': 0,\n        'Yes': 1\n    },\n    'MultipleLines': {\n        'No phone service': 0,\n        'No': 0,\n        'Yes': 1\n    },\n    'OnlineSecurity': {\n        'No internet service': 0,\n        'No': 0,\n        'Yes': 1\n    },\n    'OnlineBackup': {\n        'No internet service': 0,\n        'No': 0,\n        'Yes': 1\n    },\n    'DeviceProtection': {\n        'No internet service': 0,\n        'No': 0,\n        'Yes': 1\n    },\n    'TechSupport': {\n        'No internet service': 0,\n        'No': 0,\n        'Yes': 1\n    },\n    'StreamingTV': {\n        'No internet service': 0,\n        'No': 0,\n        'Yes': 1\n    },\n    'StreamingMovies': {\n        'No internet service': 0,\n        'No': 0,\n        'Yes': 1\n    },\n    'PaperlessBilling': {\n        'No': 0,\n        'Yes': 1\n    }\n}\n\nfor binary_col in binary_columns_replace_dict:\n    df[binary_col].replace(binary_columns_replace_dict[binary_col], inplace=True)","c75ab384":"df.info()","da07c46d":"categorical_columns = ['InternetService', 'Contract', 'PaymentMethod']\n\nfor categorical_column in categorical_columns:\n    dummy_df = pd.get_dummies(df[categorical_column], prefix=categorical_column, drop_first=True)\n    df = pd.concat([df, dummy_df], axis=1)","d83944ca":"# Create a feature for the number of internet services used\n\ndf['internet_services_count'] = df['OnlineSecurity'] + df['OnlineBackup'] + df['DeviceProtection'] \\\n                                + df['TechSupport'] + df['StreamingTV'] + df['StreamingMovies']","8e6f3456":"# Create a feature for checking if the payment is automatic or not\n\ndf['is_payment_automatic'] = df['PaymentMethod'].isin(['Bank transfer (automatic)', 'Credit card (automatic)'])","3d8a66b5":"target_variable = 'Churn'","3f2a4627":"features = [\n    'gender', 'SeniorCitizen', 'Partner', 'Dependents', 'tenure', 'PhoneService', 'MultipleLines',\n    'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', 'TechSupport', 'StreamingTV', 'StreamingMovies',\n    'PaperlessBilling', 'MonthlyCharges', 'internet_services_count', 'is_payment_automatic'\n]\n\nfor col in df.columns:\n    if not col in features and col.startswith(('InternetService_', 'Contract_')):\n        features.append(col)","1757a90d":"features","cd5b691e":"scaler = MinMaxScaler()\nscaled_df = pd.DataFrame(scaler.fit_transform(df[features]))\nscaled_df.columns = features\nscaled_df[target_variable] = df[target_variable]","3ee7b797":"def evaluate_models(df, features):\n    \"\"\"\n    Evaluate different models on the passed dataframe using the given features.\n    \"\"\"\n    \n    # Create testing and training data\n    X_train, X_test, y_train, y_test = train_test_split(\n        df[features], df[target_variable], test_size=0.2, random_state=SEED\n    )\n\n    results = {} # to store the results of the models\n    models = [\n        ('lr', LogisticRegression(random_state=SEED)),\n        ('lda', LinearDiscriminantAnalysis()),\n        ('svm', SVC(random_state=SEED)),\n        ('knn', KNeighborsClassifier(n_neighbors=5)),\n        ('nb', GaussianNB()),\n        ('dt', DecisionTreeClassifier(random_state=SEED)),\n        ('rf', RandomForestClassifier(random_state=SEED, n_estimators=100)),\n        ('et', ExtraTreesClassifier(random_state=SEED, n_estimators=100)),\n        ('gb', GradientBoostingClassifier(random_state=SEED, n_estimators=100)),\n        ('ada', AdaBoostClassifier(random_state=SEED)),\n        ('xgb', xgb.XGBClassifier(random_state=SEED))\n        \n    ]\n\n    for model_name, model in models:\n        model.fit(X_train, y_train)\n        y_pred = model.predict(X_test)\n        accuracy = model.score(X_test, y_test)\n        f1 = f1_score(y_test, y_pred)\n        cm = confusion_matrix(y_test, y_pred)\n        results[model_name] = (model, accuracy, f1, cm)\n        \n    sorted_results = sorted(results.items(), key=lambda x: x[1][1], reverse=True)\n    for model_name, (model, accuracy, f1, cm) in sorted_results:\n        print(model_name, accuracy, f1)\n        \n    return results","d884d249":"results = evaluate_models(scaled_df, features)","ad62e00c":"model = xgb.XGBClassifier(random_state=SEED)\ncross_val_scores = cross_val_score(model, scaled_df[features], scaled_df[target_variable], cv=5)\nprint(cross_val_scores.mean())","26cef661":"### Replace binary text values with numbers","b1bd0a74":"### Observation: The ratio of Female and Male is quite comparable, the churn probabilities are also almost the same in both the classes","e4afc02b":"### The distribution is imbalanced as ratio of churned customers is only 0.26","2b0ebac8":"### Cross validation accuracy: 0.8054","800d9535":"### Observation: TechSupport service also helps in reducing the churn rate.","53905483":"### Try running different models","f23aaecc":"## Visualize InternetService column","ab59e920":"### Observation: DeviceProtection service helps in reducing the churn rate.","3c59f0a1":"### Observation: Churn rate is highest for Electronic check payment method. As expected, automatic payment methods have low churn rate as people care less when the amount is debited automatically.","fdd8b6ef":"## Visualize OnlineBackup column","043e23ad":"## Visualize Dependents column","3b71ba1a":"### Create dummy variables","0a8f542b":"## Visualize gender column","5b12ec9e":"### Observation: Internet Service is looking like a major reason for churn, as we can see that the churn rate for those people who don't use internet services is real low ~ 0.07, and it becomes more than 0.4 for people who are using Fiber optic.\n### The company should really focus on improving its Fiber optic services.","8cfafb61":"### Observation: The churn probability of senior citizens is quite high with the prob being more than 0.4","cd8be43b":"## Visualize PhoneService column","310b3eb8":"# Modeling","d929b4a6":"## Visualize PaperlessBilling column","dbb4758a":"## Visualize DeviceProtection column","2b82689c":"### Good News: There's no missing data","2d2ef999":"### Observation: Seems that people who opt for paperless bills are less likely to churn. Maybe because people generally don't spend too much time on paperless bills, they do more on hard copies. This could be one theory, could be any other reason also.","8c8ddbfe":"## Visualize Tenure column","c3e3d970":"### Observation: People without partners are more likely to churn","c41d3429":"### Observation: Similar to partners, people without dependents are more likely to churn","ab19128b":"### Observation: As expected, people who have less tenure are more likely to churn. When people have been associated for long, they tend to stick around.","0babeab4":"## Visualize StreamingTV column","de6bc940":"### Scale the data","efec05d8":"## Visualize Contract column","54502348":"### Observation: People who have comparatively high monthly charges are more likely to churn","a65eb9c9":"### Create new features","a8c88a93":"## Visualize OnlineSecurity column","fda1df8a":"## Visualize SeniorCitizen column","733c67f3":"### Observation: As expected, people who opt for long contracts are less likely to churn as evident from the \"Two year\" contract, highest churn rate is from people who opt for monthly contract.\n### If the company can manage to convert the monthly people to take the one-year\/two-year contract, the churn rate can vastly come down.","bf27d85d":"# EDA","a3291276":"### Observation: No real impact of PhoneService as most people are using it.","74488e70":"## Visualize Partner column","937ce0a1":"### Observation: Similar to the Online security service, Online backup service should also be promoted as this also improves in customer retention.","9c33fe6c":"## Visualize TechSupport column","3231e14e":"## Visualize PaymentMethod column","56b6a0ac":"## Visualize MonthlyCharges column","120b55e5":"### Observation: People who take the Online security service are less likely to churn. Company should promote this service, maybe give a discount also if need be, because it greatly improves the churn rate.","a89145c0":"### Observation: Not much impact of StreamingTV service on churn rate.","75efff6f":"## Visualize MultipleLines column","247d8886":"### Observation: Not much impact of StreamingMovies service on churn rate.","fc1a5355":"### XGBoost is giving the highest accuracy of 0.8176\n\n### Lets apply cross validation to it","1e5810be":"## Visualize StreamingMovies column","18fcfe51":"### Observation: Multiple Lines is increasing the churn, although the effect is small"}}