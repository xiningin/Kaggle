{"cell_type":{"277a9e79":"code","992fcd56":"code","15214b2a":"code","d60f3a5d":"code","035f3abb":"code","e2657b5c":"code","9ebdf1ca":"code","204f2b84":"code","1705c3e4":"code","fc6f8b99":"code","12e48606":"code","ab0e15e5":"code","47bc8996":"code","2dd355b0":"code","072d1f72":"code","e097acd5":"code","aafb0619":"code","6e8307dd":"code","c877abf9":"code","809461ad":"code","61bf3e10":"code","3e58d3b7":"code","42bd0d1b":"code","93606d42":"code","c6e871ea":"code","aef5ba2a":"code","c13789d4":"code","50d032d0":"code","1ec47207":"code","5714bb67":"code","4e0ede8d":"code","75d67a68":"code","d654d5fe":"code","7d39666c":"code","883485d2":"code","66aab195":"code","cc4136b8":"code","ffd4cdad":"code","e8893616":"code","c57eec27":"code","e80e9711":"code","6d261039":"code","8a6c9fdf":"code","5234c5da":"markdown","2df6c769":"markdown","cb292898":"markdown","dd9ebe36":"markdown","2e1d0be3":"markdown","6f043553":"markdown","c805ee15":"markdown","77b48a0e":"markdown","72f5f349":"markdown","b99282e2":"markdown","11ae75e2":"markdown","f2be149b":"markdown","665f1c25":"markdown","59edca67":"markdown","9b8db08f":"markdown","19ee98ad":"markdown","89b5c61b":"markdown","5abe71cd":"markdown","ad4a2144":"markdown","5e19f81e":"markdown"},"source":{"277a9e79":"import numpy as np\nimport pandas as pd\nimport os\nimport glob\nimport matplotlib\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline \nfrom wordcloud import WordCloud, STOPWORDS","992fcd56":"for dirname, _, filenames in os.walk('\/kaggle\/input'):\n    print(dirname)","15214b2a":"print(os.listdir(\"\/kaggle\/input\/ocular-disease-recognition-odir5k\/ODIR-5K\"))","d60f3a5d":"data_df = pd.read_excel(open(\"\/kaggle\/input\/ocular-disease-recognition-odir5k\/ODIR-5K\/data.xlsx\", 'rb'), sheet_name='Sheet1')  ","035f3abb":"data_df.head()","e2657b5c":"data_df.columns = [\"id\", 'age', \"sex\", \"left_fundus\", \"right_fundus\", \"left_diagnosys\", \"right_diagnosys\", \"normal\",\n                  \"diabetes\", \"glaucoma\", \"cataract\", \"amd\", \"hypertension\", \"myopia\", \"other\"]","9ebdf1ca":"data_df.head()","204f2b84":"print(f\"data shape: {data_df.shape}\")\nprint(f\"left fundus: {data_df.left_fundus.nunique()}\")\nprint(f\"right fundus: {data_df.right_fundus.nunique()}\")","1705c3e4":"print(f\"train images: {len(os.listdir('\/\/kaggle\/\/input\/\/ocular-disease-recognition-odir5k\/\/ODIR-5K\/\/Training Images'))}\")\nprint(f\"test images: {len(os.listdir('\/\/kaggle\/\/input\/\/ocular-disease-recognition-odir5k\/\/ODIR-5K\/\/Testing Images'))}\")\nprint(f\"train images - left eye: {len(glob.glob('\/\/kaggle\/\/input\/\/ocular-disease-recognition-odir5k\/\/ODIR-5K\/\/Training Images\/\/*_left.jpg'))}\")\nprint(f\"train images - right eye: {len(glob.glob('\/\/kaggle\/\/input\/\/ocular-disease-recognition-odir5k\/\/ODIR-5K\/\/Training Images\/\/*_right.jpg'))}\")\nprint(f\"test images - left eye: {len(glob.glob('\/\/kaggle\/\/input\/\/ocular-disease-recognition-odir5k\/\/ODIR-5K\/\/Testing Images\/\/*_left.jpg'))}\")\nprint(f\"test images - right eye: {len(glob.glob('\/\/kaggle\/\/input\/\/ocular-disease-recognition-odir5k\/\/ODIR-5K\/\/Testing Images\/\/*_right.jpg'))}\")","fc6f8b99":"def plot_count(feature, title, df, size=1, show_all=False):\n    f, ax = plt.subplots(1,1, figsize=(4*size,4))\n    total = float(len(df))\n    if show_all:\n        g = sns.countplot(df[feature], palette='Set3')\n        g.set_title(\"{} distribution\".format(title))\n    else:\n        g = sns.countplot(df[feature], order = df[feature].value_counts().index[:20], palette='Set3')\n        if(size > 2):\n            plt.xticks(rotation=90, size=8)\n            for p in ax.patches:\n                height = p.get_height()\n                ax.text(p.get_x()+p.get_width()\/2.,\n                        height + 0.2,\n                        '{:1.2f}%'.format(100*height\/total),\n                        ha=\"center\") \n        g.set_title(\"Number and percentage of {}\".format(title))\n    plt.show()    ","12e48606":"plot_count(\"age\", \"Age\", data_df, size=5, show_all=True)","ab0e15e5":"plot_count(\"sex\", \"Sex\", data_df, size=2)","47bc8996":"plot_count(\"normal\", \"Normal\", data_df, size=2)","2dd355b0":"plot_count(\"diabetes\", \"Diabetes\", data_df, size=2)","072d1f72":"plot_count(\"glaucoma\", \"Glaucoma\", data_df, size=2)","e097acd5":"plot_count(\"cataract\", \"Cataract\", data_df, size=2)","aafb0619":"plot_count(\"amd\", \"AMD\", data_df, size=2)","6e8307dd":"plot_count(\"hypertension\", \"Hypertension\", data_df, size=2)","c877abf9":"plot_count(\"myopia\", \"Myopia\", data_df, size=2)","809461ad":"plot_count(\"other\", \"Other\", data_df, size=2)","61bf3e10":"plot_count(\"left_diagnosys\", \"Left eye diagnosys (first 20 values)\", data_df, size=4)","3e58d3b7":"plot_count(\"right_diagnosys\", \"Right eye diagnosys (first 20 values)\", data_df, size=4)","42bd0d1b":"stopwords = set(STOPWORDS)\n\ndef show_wordcloud(data, title = None):\n    wordcloud = WordCloud(\n        background_color='white',\n        stopwords=stopwords,\n        max_words=40,\n        max_font_size=40, \n        scale=3,\n        random_state=1,\n    ).generate(str(data))\n\n    fig = plt.figure(1, figsize=(12,10))\n    plt.axis('off')\n    if title: \n        fig.suptitle(title, fontsize=20)\n        fig.subplots_adjust(top=2.3)\n\n    plt.imshow(wordcloud)\n    plt.show()","93606d42":"show_wordcloud(data_df['left_diagnosys'], title = 'Prevalent words in left eye diagnosys')","c6e871ea":"show_wordcloud(data_df['left_diagnosys'], title = 'Prevalent words in right eye diagnosys')","aef5ba2a":"cataract_df = data_df.loc[data_df.cataract == 1]\nshow_wordcloud(cataract_df['left_diagnosys'], title = 'Prevalent words in left eye diagnosys for cataract')","c13789d4":"show_wordcloud(cataract_df['right_diagnosys'], title = 'Prevalent words in right eye diagnosys for cataract')","50d032d0":"def plot_feature_distribution_grouped(feature, title, df, hue, size=4):\n    plt.figure(figsize=(size*5,size*2))\n    plt.title(title)\n    if(size > 2):\n        plt.xticks(rotation=90, size=8)\n    g = sns.countplot(df[feature], hue=df[hue], palette='Set3')\n    plt.xlabel(feature)\n    plt.legend()\n    plt.show()","1ec47207":"plot_feature_distribution_grouped('sex', 'Normal diagnosys grouped by sex', data_df, 'normal', size=2)","5714bb67":"plot_feature_distribution_grouped('sex', 'Diabetes diagnosys grouped by sex', data_df, 'diabetes', size=2)","4e0ede8d":"plot_feature_distribution_grouped('sex', 'Glaucoma diagnosys grouped by sex', data_df, 'glaucoma', size=2)","75d67a68":"plot_feature_distribution_grouped('sex', 'Cataract diagnosys grouped by sex', data_df, 'cataract', size=2)","d654d5fe":"plot_feature_distribution_grouped('sex', 'AMD diagnosys grouped by sex', data_df, 'amd', size=2)","7d39666c":"plot_feature_distribution_grouped('sex', 'Hypertension diagnosys grouped by sex', data_df, 'hypertension', size=2)","883485d2":"plot_feature_distribution_grouped('sex', 'Myopia diagnosys grouped by sex', data_df, 'myopia', size=2)","66aab195":"plot_feature_distribution_grouped('sex', 'Other diseases diagnosys grouped by sex', data_df, 'other', size=2)","cc4136b8":"import imageio\nIMAGE_PATH = \"\/kaggle\/input\/ocular-disease-recognition-odir5k\/ODIR-5K\/Training Images\"\ndef show_images(df, title=\"Diagnosys\", eye_exam=\"left_fundus\"):\n    print(f\"{title}; eye exam: {eye_exam}\")\n    f, ax = plt.subplots(3,3, figsize=(16,16))\n    for i,idx in enumerate(df.index):\n        dd = df.iloc[idx]\n        image_name = dd[eye_exam]\n        image_path = os.path.join(IMAGE_PATH, image_name)\n        img_data=imageio.imread(image_path)\n        ax[i\/\/3, i%3].imshow(img_data)\n        ax[i\/\/3, i%3].axis('off')\n    plt.show()","ffd4cdad":"df = data_df.loc[(data_df.cataract==1) & (data_df.left_diagnosys==\"cataract\")].sample(9).reset_index()\nshow_images(df,title=\"Left eye with cataract\",eye_exam=\"left_fundus\")","e8893616":"df = data_df.loc[(data_df.cataract==1) & (data_df.right_diagnosys==\"cataract\")].sample(9).reset_index()\nshow_images(df,title=\"Right eye with cataract\",eye_exam=\"right_fundus\")","c57eec27":"df = data_df.loc[(data_df.glaucoma==1) & (data_df.left_diagnosys==\"glaucoma\")].sample(9).reset_index()\nshow_images(df,title=\"Left eye with glaucoma\",eye_exam=\"left_fundus\")","e80e9711":"df = data_df.loc[(data_df.glaucoma==1) & (data_df.right_diagnosys==\"glaucoma\")].sample(9).reset_index()\nshow_images(df,title=\"Right eye with glaucoma\",eye_exam=\"right_fundus\")","6d261039":"df = data_df.loc[(data_df.myopia==1)].sample(9).reset_index()\nshow_images(df,title=\"Left eye with myopia\",eye_exam=\"left_fundus\")","8a6c9fdf":"df = data_df.loc[(data_df.myopia==1)].sample(9).reset_index()\nshow_images(df,title=\"Right eye with myopia\",eye_exam=\"right_fundus\")","5234c5da":"## Images inspection\n\nLet's inspect the images.","2df6c769":"We can observe that the words used in diagnosys are quite balanced from the point of view of the two eyes.  \n\n\nLet's look now to people with cataract and check what are the associated texts for left and right diagnosys,\n\n","cb292898":"## Explore data sources","dd9ebe36":"## Check image data\n\n\nWe check now the image data for completeness.","2e1d0be3":"Let's check now frequence of words used in diagnosys for left and right eye, as a wordcloud, to see what are the most frequent words used in such diagnosys.","6f043553":"# Data exploration\n\n","c805ee15":"\n## Load tabelar data (Excel)","77b48a0e":"### Left-eye and right-eye myopia","72f5f349":"### Left-eye and right-eye cataract","b99282e2":"## Data distribution","11ae75e2":"We have 3500 records, and unique images associated with each record for left and respectively right eye.","f2be149b":"Here we have train, test images and an Excel file. Let's start with the Excel file.","665f1c25":"We have multiple folders, let's look first in the main folder.","59edca67":"# Data preparation\n\n\n## Load packages","9b8db08f":"### Left-eye and right-eye glaucom","19ee98ad":"We will change the labels for the columns so it will be easier to process.","89b5c61b":"# Introduction\n\n\nThis is an exploratory data analysis (EDA) Notebook for Ocular Disease Recognition dataset.\n\nAnnotations were added by trained human readers with quality control management. They classify patient into eight labels including:\n\n* Normal (N);  \n* Diabetes (D);  \n* Glaucoma (G);  \n* Cataract (C);  \n* AMD (A);  \n* Hypertension (H);  \n* Myopia (M);\n* Other diseases\/abnormalities (O)  \n\n","5abe71cd":"Let's verify now the distribution of comments associated with the left and right eye.","ad4a2144":"## Check tabelar data","5e19f81e":"There are 7000 images in training set and 1000 images in testing set, with half of them for left eye and half of them for right eye.\n\nSince there is only one flag for each patology, and we have same record for both eyes for each patient, we will need to infer from the left diagnosys, respectively from right diagnosis, to which eye reffers the flag.\n\nFor example, for patient with id `0` (Female, age 69), there is a flag `1` for **cataract**. Looking to the **left_diagnosys** and **right_diagnosys**, we observe that only for left_diagnosys we have cataract marked. Consequently, if we want to train a model to recognize cataract, we will only label left eye (image `0_left.png` as being with **cataract** flag 1."}}