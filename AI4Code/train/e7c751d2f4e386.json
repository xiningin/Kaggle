{"cell_type":{"446f210b":"code","8108c0fd":"code","348d205c":"code","cfac7e3a":"code","ca44d04c":"code","8e8e7124":"code","d64856eb":"code","fb0777ef":"code","4a29c5cf":"code","1de93a3a":"code","79c9c26f":"code","a34e7974":"code","48d89301":"code","91f21886":"code","a4a07f1e":"code","11f8835f":"code","f7a01091":"code","6f8d8671":"markdown","95bbf9be":"markdown","a087ed26":"markdown","2b9139f4":"markdown","e45ad2d1":"markdown","2c90203f":"markdown"},"source":{"446f210b":"import os \nimport glob\n\nimport pandas as pd\nimport numpy as np\nimport random\n\nimport cv2\n\nimport matplotlib.pyplot as plt\nfrom matplotlib.image import imread\nimport seaborn as sns\nsns.set(rc={'figure.figsize':(10,6)})\nsns.set(font_scale=1.3)\nplt.style.use('fivethirtyeight')\n\nfrom sklearn.model_selection import train_test_split\nimport tensorflow as tf\nfrom tensorflow.keras.applications import ResNet50V2, MobileNetV2\nfrom tensorflow.keras.applications.resnet import preprocess_input\nfrom tensorflow.keras.models import Sequential, Model\nfrom tensorflow.keras.layers import Activation, Dropout, Flatten, Dense, Conv2D, MaxPooling2D\nfrom tensorflow.keras.optimizers import Adam\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom tensorflow.keras.callbacks import EarlyStopping, ReduceLROnPlateau\n\nimport warnings\nwarnings.filterwarnings(action=\"ignore\")","8108c0fd":"data_path = '..\/input\/cell-images-for-detecting-malaria\/cell_images'","348d205c":"label = []\npath = []\nfor dirname, _,filenames in os.walk(data_path):\n    for filename in filenames:\n        if os.path.splitext(filename)[1]=='.png':\n            if dirname.split()[-1]!='GT':          \n                label.append(os.path.split(dirname)[1])\n                path.append(os.path.join(dirname,filename))\n\ndata = pd.DataFrame(columns=['path','label'])\ndata['path'] = path\ndata['label'] = label","cfac7e3a":"data.head()","ca44d04c":"data.info()","8e8e7124":"data['label'] = data['label'].astype('category')","d64856eb":"fig, ax = plt.subplots(nrows=1, ncols=2, figsize=(8,8), constrained_layout=True)\nax=ax.flatten()\nj=0\n    \nfor i in data['label'].unique():\n    \n    ax[j].imshow(plt.imread(data[data['label']==i].iloc[0,0]))\n    ax[j].set_title(i)\n    j=j+1","fb0777ef":"fig=plt.figure(figsize=(15,8))\ncontagem = data['label'].value_counts()\n\nax = sns.countplo(data=data, x='label')\nfor c in ax.patches:\n    ax.text(c.get_x()-.1, + c.get_widh() \/ 3, c.get_height() +2, c.get_height(), fontsize='20')\n    \nax.set_xlabel('')\nax.set_ylabel('')\n#sns.countplot(data['label']);","4a29c5cf":"train, test = train_test_split(data, test_size=0.2, random_state=2021)","1de93a3a":"print(train.shape)\nprint(test.shape)","79c9c26f":"train_gen = ImageDataGenerator(preprocessing_function=preprocess_input, validation_split=0.2)\ntest_gen = ImageDataGenerator(preprocessing_function= preprocess_input)\n\nx_train = train_gen.flow_from_dataframe(dataframe=train, x_col='path', y_col='label',\n                                           class_mode='categorical', subset='training', \n                                           color_mode='rgb', batch_size=32, shuffle=False)\n\nx_val = train_gen.flow_from_dataframe(dataframe=train, x_col='path', y_col='label',\n                                         class_mode='categorical', subset='validation', \n                                         color_mode='rgb', batch_size=32, shuffle=False)\n\nx_test = test_gen.flow_from_dataframe(dataframe=test, x_col='path', y_col='label',\n                                         class_mode='categorical', color_mode='rgb', \n                                         batch_size=32, shuffle=False)","a34e7974":"fit, ax= plt.subplots(nrows=2, ncols=3, figsize=(15,8))\nax = ax.flatten()\nj = 0\nfor _ in range(6):\n    img, label = x_test.next()\n    ax[j].imshow(img[0],);\n    ax[j].set_title(label[0])\n    j=j+1","48d89301":"x_test[0][0].shape","91f21886":"image_shape=(224,224,3)","a4a07f1e":"early = EarlyStopping(monitor='val_loss',patience=5)\nreduce = ReduceLROnPlateau(monitor='val_loss', patience=3, factor=0.2, mil_lr=0.001)","11f8835f":"pre_trained= MobileNetV2(include_top=False, pooling='avg', input_shape=image_shape)\n\npre_trained.trainable=False\n\ninp_model = pre_trained.input\nx = Dense(128, activation='relu')(pre_trained.output)\nx = Dense(128, activation='relu')(x)\n\noutput = Dense(2, activation='softmax')(x)\nmodel = Model(inputs=inp_model, outputs=output)\n\nmodel.compile(loss='categorical_crossentropy',\n              optimizer='adam',\n              metrics=['accuracy'])\n\nresults = model.fit(x_train,epochs=30, validation_data=x_val, callbacks=[early, reduce])","f7a01091":"fig, axes = plt.subplots(1, 2, figsize=(15,5))\naxes[0].plot(results.history['accuracy'])\naxes[0].plot(results.history['val_accuracy'])\naxes[0].set_xlabel('Epochs')\naxes[0].set_ylabel('Accuracy')\naxes[0].legend(['Accuracy in Train','Accuracy in Test'])\naxes[0].grid(True)\n\naxes[1].plot(results.history['loss'])\naxes[1].plot(results.history['val_loss'])\naxes[1].set_xlabel('Epochs')\naxes[1].set_ylabel('Erro')\naxes[1].legend(['Erro in Train','Erro in Test'])\naxes[1].grid(True)","6f8d8671":"# <p style=\"background-color:#80ccff; font-family:newtimeroman; font-size:150%; text-align:center; border-radius:  80px 5px; padding-top:8px; padding-bottom:8px;\">Model<\/p>","95bbf9be":"# <p style=\"background-color:#80ccff; font-family:newtimeroman; font-size:150%; text-align:center; border-radius:  80px 5px; padding-top:8px; padding-bottom:8px;\">Images<\/p>","a087ed26":"## What is Malaria?\nMalaria is a serious and sometimes fatal disease caused by a parasite that commonly infects a certain type of mosquito that feeds on humans. People who contract malaria often get very sick, with high fever, chills, and flu-like illnesses.\n\n## How is malaria transmitted?\nNormally, people get malaria from being bitten by an infecting female Anopheles mosquito. Only Anopheles mosquitoes can transmit malaria and they must have been infected through a previous blood meal taken from an infected person. ","2b9139f4":"# <p style=\"background-color:#80ccff; font-family:newtimeroman; font-size:150%; text-align:center; border-radius:  80px 5px; padding-top:8px; padding-bottom:8px;\">Image Manipulation<\/p>","e45ad2d1":"# <p style=\"background-color:#80ccff; font-family:newtimeroman; font-size:150%; text-align:center; border-radius:  80px 5px; padding-top:8px; padding-bottom:8px;\">Import<\/p>","2c90203f":"# <p style=\"background-color:#80ccff; font-family:newtimeroman; font-size:150%; text-align:center; border-radius:  80px 5px; padding-top:8px; padding-bottom:8px;\">Loading directory<\/p>"}}