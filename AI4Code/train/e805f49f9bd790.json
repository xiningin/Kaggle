{"cell_type":{"f84076d3":"code","8ce66b99":"code","7571efad":"code","b700f665":"code","0f752bf1":"code","18535a93":"code","841c3426":"code","6dab46d5":"code","cb06fd13":"code","25ab1476":"code","c86b6599":"markdown","47cc994a":"markdown","8c0965f3":"markdown","4a1799ee":"markdown","3619ca76":"markdown","34ab0459":"markdown","03214e70":"markdown","80c40914":"markdown","5ab9bafe":"markdown","2af33fda":"markdown","9a0261c7":"markdown","aad7b804":"markdown","01802927":"markdown","19b81cb9":"markdown","e43d96b4":"markdown"},"source":{"f84076d3":"# Usual imports that are needed for most analysis\nimport matplotlib.pyplot as plt\nimport pandas as pd\nfrom pandas.io import gbq\n\nfrom sklearn import linear_model\nimport seaborn as sns\nimport bq_helper\nlondon = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\", dataset_name=\"london_crime\")","8ce66b99":"import bq_helper\nCrimes = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\", dataset_name=\"london_crime\")","7571efad":"QUERY =\"\"\"\nSELECT year, borough, sum(value) as number \nFROM  `bigquery-public-data.london_crime.crime_by_lsoa`\ngroup by borough ,year\norder by borough,year DESC; \n\"\"\"\ndf = Crimes.query_to_pandas_safe(QUERY)\ndf.head()","b700f665":"mio = df.copy()\nmio=mio.groupby('year').sum()\nmio=mio.sort_values(['year'])\n\nmio['year']=mio.index\nval_max = mio.number.max()\nval_min = mio.number.min()\n# standardization\nmio['number_st']=(mio.number-val_min)\/(val_max-val_min)\n\nregr = linear_model.LinearRegression()\nregr.fit(mio[['year']],mio.number_st)\nprint(\"The Linear Coefficient for the whole London between 2008 to 2016 is {:.2f}\".format(regr.coef_[0]))  ","0f752bf1":"regr.fit(mio[['year']],mio.number)\ny_est=regr.predict(mio[['year']])\nmio.number.plot(figsize=(15, 6))\nplt.plot(mio[['year']],y_est)\nplt.title('Number of Crimes in London 2008-2016 ')\nplt.ylabel('Number of Crimes per Month')\nplt.xlabel('... Time ...')\nplt.show()","18535a93":"borough=list(set(df['borough']));\nbor_crime = dict()\nmin_reg=9\nmin_item=\"\"\nmax_reg=0\nmax_item=\"\"\n\nfor bor in borough:\n    temp=df[df['borough'] == bor];\n    X=temp[['year']];\n    val_max = temp.number.max();\n    val_min = temp.number.min();\n    temp['number']=(temp.number-val_min)\/(val_max-val_min);\n    \n    \n    regr = linear_model.LinearRegression()\n    regr.fit(X, temp.number.values)\n    bor_crime[bor] = regr.coef_;\n    if regr.coef_ > max_reg:\n        max_reg = regr.coef_\n        max_item = bor\n    if regr.coef_ < min_reg:\n        min_reg = regr.coef_\n        min_item = bor;\n        \nprint(\" The coef max is {:.2f}, for the borough {}\".format(max_reg[0], max_item));\nprint(\" The coef min is {:.2f}, for the borough {}\".format(min_reg[0], min_item));","841c3426":"mio_dataset=pd.DataFrame.from_dict(bor_crime, orient='index',columns=['coef_regr'])\nmio_dataset.sort_values('coef_regr')","6dab46d5":"mio_dataset.hist();\nprint(\"Mean {}\".format(mio_dataset.coef_regr.mean()))\nprint(\"Median {}\".format(mio_dataset.coef_regr.median()))","cb06fd13":"tempmin=df[df['borough'] == min_item]\n\nregrmin = linear_model.LinearRegression()\nregrmin.fit(X, tempmin.number.values)\ny_minPredict=regrmin.predict(mio[['year']])\n\nX=tempmin[['year']]\n\nplt.figure(figsize=(15, 6))\nplt.scatter(X,tempmin.number.values, color='green')    \nplt.plot(mio[['year']],y_minPredict,color='green')\nplt.xlabel('... Time ...')\nplt.ylabel(\"Crimes per Day\")\nplt.title(\"The Borough Trend for {}\".format(min_item));","25ab1476":"\ntempmax=df[df['borough'] == max_item]\n\nregrmax = linear_model.LinearRegression()\nregrmax.fit(X, tempmax.number.values)\ny_maxPredict=regrmax.predict(mio[['year']])\n\nX=tempmax[['year']]\n\nplt.figure(figsize=(15, 6))\nplt.scatter(X,tempmax.number.values, color='red')    \nplt.plot(mio[['year']],y_maxPredict,color='red')\nplt.xlabel('... Time ...')\nplt.ylabel(\"Crimes per Day\")\nplt.title(\"The Borough Trend for {}\".format(max_item));","c86b6599":"To compare the linear coefficients for the different sets we need to standardize the data.\nOtherwise, a borough with major number of events would have different weight than a borough with less events.\n","47cc994a":"### Summary:\n\nOverall, the number of crimes in London is decreasing, there are few boroughs where the number is increasing.\nThe good news is that for those like City of London, the global number is relatively small, therefore even if increasing the effect is not so dramatic.","8c0965f3":"### Let 's first check the coefficient for the whole London ","4a1799ee":"### Just out of curiosity... let's find the Borough with most crimes decrease and the one with most crimes increase.\n  ","3619ca76":"## Which of the London Boroughs has an increasing and which has a decreasing amount of crime events?  ","34ab0459":"### Let's see how they are distributed","03214e70":"From the chart we can see that the trend is negative, mainly because of the years 2013 and 2014.\n2016 has a similar number of events as the initial period of 2008.","80c40914":"The number increased from zero to 175, it is an increase, but we should check if something was changing on how the crimes were registered between 2010 and 2011.","5ab9bafe":"### Let's check the trend for each Borough.","2af33fda":"From the year 2008 to the year 2016  the number of Crimes in Waltham Forest decreased of more of four thousands.","9a0261c7":"The coefficient is negative, but very close to zero.\nLet's see the chart:","aad7b804":"### The chart of the Borough with most crimes increase (with the real value).","01802927":"According to the distribution most of the Boroughs have a decreasing number of crimes.","19b81cb9":"### The metric used to define whether the crime events  are increasing or decreasing is the linear regression coefficient of number of crimes over the years.\nIf positive it is increasing, if negative it is decreasing.\n\nThe absolute value of the coefficient defines the magnitude of the increasing\/decreasing. ","e43d96b4":"#### The charts of the borough with most crimes decrease (with the real value)."}}