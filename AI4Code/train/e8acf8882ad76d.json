{"cell_type":{"bccc654d":"code","71515402":"code","ef1868d1":"code","67eaf8bd":"code","77c2b8b7":"code","13e031ab":"code","2cb57fa5":"code","4e6a91ef":"code","946733aa":"code","82c95a8b":"code","de711abf":"code","d191528b":"code","3f28ffbc":"code","25fada16":"code","e429141a":"code","44fae993":"code","9c932e3d":"code","ed8f7726":"code","6c98a465":"code","e5193a47":"code","7db46a52":"code","75dafb63":"code","fda965cd":"code","09ed308d":"code","58bb4718":"code","317b6209":"code","9d3fe878":"code","15799849":"code","04400b01":"code","67ad55c1":"code","d209a9c5":"code","95552704":"code","959bcfba":"code","c380a9a6":"code","58b25493":"code","22e2c2fa":"code","c266b5f7":"markdown","47328749":"markdown","0e3ec035":"markdown","ab77ab85":"markdown","a91267c2":"markdown","a4b6b032":"markdown","49b36a71":"markdown","ee3ad180":"markdown","13b54ae0":"markdown","3cc714fa":"markdown","cea67610":"markdown","41aa79dd":"markdown","4050e5e4":"markdown","5decbb93":"markdown","b96a4116":"markdown","365c6c66":"markdown","5e2d7fdd":"markdown","6eb851e6":"markdown","9ad68708":"markdown","d8d87f7b":"markdown","70b0a2be":"markdown","150ea434":"markdown","23c8b1e7":"markdown","c2070850":"markdown","06134580":"markdown","06ea42bd":"markdown","ce45d6ea":"markdown","f5041717":"markdown","591a6cfa":"markdown","8a1341d2":"markdown","8d7e4bdf":"markdown","c95092c1":"markdown","0d8d309f":"markdown","643852f1":"markdown","e582ffdf":"markdown","6d8b405c":"markdown","2a4e0c00":"markdown","2de887af":"markdown","e6baec13":"markdown","5b6116ef":"markdown","e15e1e04":"markdown","57bffe44":"markdown","14cf2000":"markdown","9affeba0":"markdown","48e61046":"markdown","47ab9d95":"markdown","c1e00b14":"markdown","164f172f":"markdown"},"source":{"bccc654d":"import os\nimport cv2\nimport plotly\nimport pydicom\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport plotly.express as px\nimport matplotlib.pyplot as plt\nimport plotly.graph_objects as go\nimport plotly.figure_factory as ff\nimport plotly.graph_objs as go\nfrom plotly.subplots import make_subplots\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode(connected = True)\n\nfrom IPython.display import display_html\nfrom PIL import Image\nimport gc\nfrom scipy.stats import pearsonr\nimport pydicom # for DICOM images\nfrom skimage.transform import resize\nimport copy\nimport re\n\n# Segmentation\nfrom glob import glob\nfrom mpl_toolkits.mplot3d.art3d import Poly3DCollection\nimport scipy.ndimage\nfrom skimage import morphology\nfrom skimage import measure\nfrom skimage.transform import resize\nfrom sklearn.cluster import KMeans\nfrom plotly import __version__\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nfrom plotly.tools import FigureFactory as FF\nfrom plotly.graph_objs import *\ninit_notebook_mode(connected=True) \n\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# Set Color Palettes for the notebook\ncustom_colors = ['#74a09e','#86c1b2','#98e2c6','#f3c969','#f2a553', '#d96548', '#c14953']","71515402":"train = pd.read_csv('..\/input\/osic-pulmonary-fibrosis-progression\/train.csv')\ntrain.head()","ef1868d1":"test = pd.read_csv('..\/input\/osic-pulmonary-fibrosis-progression\/test.csv')\ntest.head()","67eaf8bd":"print(\"Shape of training set : {}\".format(train.shape))\nprint(\"Shape of testing set : {}\".format(test.shape))","77c2b8b7":"train.info()","13e031ab":"print(\"*** Train set ***\")\nprint(train.isnull().sum())\nprint(\"--------------\")\nprint(\"*** Test set ***\")\nprint(test.isnull().sum())","2cb57fa5":"train.describe()","4e6a91ef":"print(\"Q. How many patients are present in train set ?\")\nprint(\"A.\",train['Patient'].nunique())\nprint(\"------------\")\nprint(\"Q. How many unique ages are present in train set ?\")\nprint(\"A.\",train['Age'].nunique())\nprint(\"------------\")\nprint(\"Q. How many smoking statuses are present in train set ?\")\nprint(\"A.\",train['SmokingStatus'].nunique())","946733aa":"fig, axes = plt.subplots(1, 3, figsize=(17,5))\nfig.suptitle('Distribution of different features')\n\nsns.distplot(train['FVC'], color='blue', ax=axes[0])\nsns.distplot(train['Percent'], color='orange', ax=axes[1])\nsns.distplot(train['Age'],color='green', ax=axes[2])\n\nplt.show()","82c95a8b":"# Count of unique entities in both 'Sex' and 'SmokingStatus'\n\nsex_count = train['Sex'].value_counts()\nprint('*** Sex Count ***\\n')\nprint(\"No. of records for males in train set : {}\".format(sex_count[0]))\nprint(\"No. of records for females in train set : {}\".format(sex_count[1]))\n\nsmoker_count = train['SmokingStatus'].value_counts()\nprint(\"\\n*** Smoker's Count ***\\n\")\nprint(\"No. of records for ex-smokers in train set : {}\".format(smoker_count[0]))\nprint(\"No. of records for non-smokers in train set : {}\".format(smoker_count[1]))\nprint(\"No. of records for current smokers in train set : {}\".format(smoker_count[2]))","de711abf":"fig, axes = plt.subplots(1, 2, figsize=(15,5))\nfig.suptitle(\"Count Plots\")\nsns.countplot(x='Sex', data=train, ax=axes[0])\nsns.countplot(x='SmokingStatus', data=train, ax=axes[1])\nplt.show()","d191528b":"# Percentage of unique entities in both 'Sex' and 'SmokingStatus'\n\nsex_count = train['Sex'].value_counts()\nprint('*** Sex Percentage ***\\n')\nprint(\"Percentage of males in train set : {:.2f}%\".format((sex_count[0] \/ sex_count.sum()) * 100))\nprint(\"Percentage of females in train set : {:.2f}%\".format((sex_count[1] \/ sex_count.sum()) * 100))\n\nsmoker_count = train['SmokingStatus'].value_counts()\nprint(\"\\n*** Smoker's Percentage ***\\n\")\nprint(\"Percentage of ex-smokers in train set : {:.2f}%\".format((smoker_count[0] \/ smoker_count.sum()) * 100))\nprint(\"Percentage of non-smokers in train set : {:.2f}%\".format((smoker_count[1] \/ smoker_count.sum()) * 100))\nprint(\"Percentage of current smokers in train set : {:.2f}%\".format((smoker_count[2] \/ smoker_count.sum()) * 100))","3f28ffbc":"labels1 = ['Male', 'Female']\nvalues1 = [sex_count[0], sex_count[1]]\nlabels2 = ['Ex-smokers', 'Never Smoked', 'Current Smokers']\nvalues2 = [smoker_count[0], smoker_count[1], smoker_count[2]]\n\nfig1 = go.Figure(data=[go.Pie(labels=labels1, values=values1)])\nfig1.update_layout(\n    title={\n        'text': \"Percentage of Males and Females\",\n        'y':0.9,\n        'x':0.5,\n        'xanchor': 'center',\n        'yanchor': 'top'})\n\nfig2 = go.Figure(data=[go.Pie(labels=labels2, values=values2)])\nfig2.update_layout(\n    title={\n        'text': \"Percentage of smokers, non-smokers and ex-smokers\",\n        'y':0.9,\n        'x':0.5,\n        'xanchor': 'center',\n        'yanchor': 'top'})\n\nfig1.show()\nfig2.show()","25fada16":"print(train.Patient.unique()[:6])","e429141a":"patient1_df = train[train['Patient']=='ID00007637202177411956430']\npatient2_df = train[train['Patient']=='ID00009637202177434476278']\npatient3_df = train[train['Patient']=='ID00010637202177584971671']\npatient4_df = train[train['Patient']=='ID00011637202177653955184']\npatient5_df = train[train['Patient']=='ID00012637202177665765362']\npatient6_df = train[train['Patient']=='ID00014637202177757139317']","44fae993":"fig, axes = plt.subplots(3, 2, figsize = (15,12))\nfig.suptitle(\"Trends of FVC over time for 6 different patients\")\n\n\nsns.regplot(patient1_df['Weeks'], patient1_df['FVC'], \n            data=patient1_df, ax=axes[0,0]).set_title(\"Patient 1\")\nsns.regplot(patient2_df['Weeks'], patient2_df['FVC'], \n            data=patient2_df, ax=axes[0,1]).set_title(\"Patient 2\")\nsns.regplot(patient3_df['Weeks'], patient3_df['FVC'], \n            data=patient3_df, ax=axes[1,0]).set_title(\"Patient 3\")\nsns.regplot(patient4_df['Weeks'], patient4_df['FVC'], \n            data=patient4_df, ax=axes[1,1]).set_title(\"Patient 4\")\nsns.regplot(patient5_df['Weeks'], patient5_df['FVC'], \n            data=patient5_df, ax=axes[2,0]).set_title(\"Patient 5\")\nsns.regplot(patient6_df['Weeks'], patient6_df['FVC'], \n            data=patient6_df, ax=axes[2,1]).set_title(\"Patient 6\")\n\nplt.show()","9c932e3d":"# Segregate train set according to Smoking status into 3 dataframes\nex_smoker_df = train[train['SmokingStatus'] == 'Ex-smoker']\nnon_smoker_df = train[train['SmokingStatus'] == 'Never smoked']\ncurrent_smoker_df = train[train['SmokingStatus'] == 'Currently smokes']","ed8f7726":"import plotly.express as px\nfig = px.histogram(train, x=\"FVC\",\n                   title='How FVC is distributed among each Smoker type',\n                   opacity=0.7,\n                   color='SmokingStatus'\n                  )\nfig.show()","6c98a465":"fig_dims = (17, 8)\nfig, ax = plt.subplots(figsize=fig_dims)\nx1 = ex_smoker_df['FVC']\nx2 = non_smoker_df['FVC']\nx3 = current_smoker_df['FVC']\nsns.kdeplot(x1, label=\"Ex-Smoker\", shade=True, ax=ax)\nsns.kdeplot(x2, label=\"Non-Smoker\", shade=True, ax=ax)\nsns.kdeplot(x3, label=\"Current Smoker\", shade=True, ax=ax)\nplt.legend();","e5193a47":"male_df = train[train['Sex'] == 'Male']\nfemale_df = train[train['Sex'] == 'Female']","7db46a52":"fig, axes = plt.subplots(1, 2, figsize=(15,5))\nfig.suptitle(\"'FVC' v\/s 'Sex'\")\nsns.swarmplot(x=\"Sex\", y=\"FVC\", data=train, ax=axes[0])\nsns.violinplot(x=\"Sex\", y=\"FVC\", data=train, ax=axes[1])\nplt.show()","75dafb63":"fig, axes = plt.subplots(1, 2, figsize=(16,8))\nfig.suptitle(\"'FVC' v\/s 'Age'\")\nsns.scatterplot(x='Age', y='FVC', hue='Sex', data=train, ax=axes[0])\nsns.scatterplot(x='Age', y='FVC', hue='SmokingStatus', data=train, ax=axes[1])\nplt.show()","fda965cd":"import plotly.express as px\nfig = px.histogram(train, x=\"Age\",\n                   title=\"How many males and females are there across different ages\",\n                   color='Sex'\n                  )\nfig.show()","09ed308d":"import plotly.express as px\nfig = px.histogram(train, x=\"Age\",\n                   title=\"Relationship b\/w 'Age' and 'SmokingStatus'\",\n                   color='SmokingStatus'\n                  )\nfig.show()","58bb4718":"import plotly.express as px\nfig = px.histogram(train, x=\"SmokingStatus\",\n                   title=\"Count of males and females in each smoking category\",\n                   color='Sex'\n                  )\nfig.show()","317b6209":"# Create base director for Train .dcm files\ndirector = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\"\n\n# Create path column with the path to each patient's CT\ntrain[\"Path\"] = director + \"\/\" + train[\"Patient\"]\n\n# Create variable that shows how many CT scans each patient has\ntrain[\"CT_number\"] = 0\n\nfor k, path in enumerate(train[\"Path\"]):\n    train[\"CT_number\"][k] = len(os.listdir(path))","9d3fe878":"print(\"Minimum number of CT scans: {}\".format(train[\"CT_number\"].min()), \"\\n\" +\n      \"Maximum number of CT scans: {:,}\".format(train[\"CT_number\"].max()))\n\n# Scans per Patient\ndata = train.groupby(by=\"Patient\")[\"CT_number\"].first().reset_index(drop=False)\n# Sort by Weeks\ndata = data.sort_values(['CT_number']).reset_index(drop=True)\n\n# Plot\nplt.figure(figsize = (16, 6))\np = sns.barplot(data[\"Patient\"], data[\"CT_number\"], color=custom_colors[5])\nplt.axvline(x=85, color=custom_colors[2], linestyle='--', lw=3)\n\nplt.title(\"Number of CT Scans per Patient\", fontsize = 17)\nplt.xlabel('Patient', fontsize=14)\nplt.ylabel('Frequency', fontsize=14)\n\nplt.text(86, 850, \"Median=94\", fontsize=13)\n\np.axes.get_xaxis().set_visible(False);","15799849":"class bcolors:\n    OKBLUE = '\\033[96m'\n    OKGREEN = '\\033[92m'","04400b01":"path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00007637202177411956430\/19.dcm\"\ndataset = pydicom.dcmread(path)\n\nprint(bcolors.OKBLUE + \"Patient id.......:\", dataset.PatientID, \"\\n\" +\n      \"Modality.........:\", dataset.Modality, \"\\n\" +\n      \"Rows.............:\", dataset.Rows, \"\\n\" +\n      \"Columns..........:\", dataset.Columns)\n\nplt.figure(figsize = (7, 7))\nplt.imshow(dataset.pixel_array, cmap=\"gray\")\nplt.axis('off');","67ad55c1":"patient_dir = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00007637202177411956430\"\ndatasets = []\n\n# First Order the files in the dataset\nfiles = []\nfor dcm in list(os.listdir(patient_dir)):\n    files.append(dcm) \nfiles.sort(key=lambda f: int(re.sub('\\D', '', f)))\n\n# Read in the Dataset\nfor dcm in files:\n    path = patient_dir + \"\/\" + dcm\n    datasets.append(pydicom.dcmread(path))\n\n# Plot the images\nfig=plt.figure(figsize=(16, 6))\ncolumns = 10\nrows = 3\n\nfor i in range(1, columns*rows +1):\n    img = datasets[i-1].pixel_array\n    fig.add_subplot(rows, columns, i)\n    plt.imshow(img, cmap=\"gray\")\n    plt.title(i, fontsize = 9)\n    plt.axis('off');","d209a9c5":"from PIL import Image\nfrom IPython.display import Image as show_gif\nimport scipy.misc\nimport matplotlib","95552704":"def create_gif(number_of_CT = 87):\n    \"\"\"Picks a patient at random and creates a GIF with their CT scans.\"\"\"\n    \n    # Select one of the patients\n    # patient = \"ID00007637202177411956430\"\n    patient = train[train[\"CT_number\"] == number_of_CT].sample(random_state=1)[\"Patient\"].values[0]\n    \n    # === READ IN .dcm FILES ===\n    patient_dir = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/\" + patient\n    datasets = []\n\n    # First Order the files in the dataset\n    files = []\n    for dcm in list(os.listdir(patient_dir)):\n        files.append(dcm) \n    files.sort(key=lambda f: int(re.sub('\\D', '', f)))\n\n    # Read in the Dataset from the Patient path\n    for dcm in files:\n        path = patient_dir + \"\/\" + dcm\n        datasets.append(pydicom.dcmread(path))\n        \n        \n    # === SAVE AS .png ===\n    # Create directory to save the png files\n    if os.path.isdir(f\"png_{patient}\") == False:\n        os.mkdir(f\"png_{patient}\")\n\n    # Save images to PNG\n    for i in range(len(datasets)):\n        img = datasets[i].pixel_array\n        matplotlib.image.imsave(f'png_{patient}\/img_{i}.png', img)\n        \n        \n    # === CREATE GIF ===\n    # First Order the files in the dataset (again)\n    files = []\n    for png in list(os.listdir(f\"..\/working\/png_{patient}\")):\n        files.append(png) \n    files.sort(key=lambda f: int(re.sub('\\D', '', f)))\n\n    # Create the frames\n    frames = []\n\n    # Create frames\n    for file in files:\n    #     print(\"..\/working\/png_images\/\" + name)\n        new_frame = Image.open(f\"..\/working\/png_{patient}\/\" + file)\n        frames.append(new_frame)\n\n    # Save into a GIF file that loops forever\n    frames[0].save(f'gif_{patient}.gif', format='GIF',\n                   append_images=frames[1:],\n                   save_all=True,\n                   duration=200, loop=0)","959bcfba":"create_gif(number_of_CT=12)\n# create_gif(number_of_CT=30)\n# create_gif(number_of_CT=87)\n\n# print(\"First file len:\", len(os.listdir(\"..\/working\/png_ID00165637202237320314458\")), \"\\n\" +\n#       \"Second file len:\", len(os.listdir(\"..\/working\/png_ID00199637202248141386743\")), \"\\n\" +\n#       \"Third file len:\", len(os.listdir(\"..\/working\/png_ID00340637202287399835821\")))","c380a9a6":"show_gif(filename=\".\/gif_ID00165637202237320314458.gif\", format='png', width=400, height=400)","58b25493":"# https:\/\/www.raddq.com\/dicom-processing-segmentation-visualization-in-python\/\n\ndef make_lungmask(img, display=False):\n    row_size= img.shape[0]\n    col_size = img.shape[1]\n    \n    mean = np.mean(img)\n    std = np.std(img)\n    img = img-mean\n    img = img\/std\n    \n    # Find the average pixel value near the lungs\n        # to renormalize washed out images\n    middle = img[int(col_size\/5):int(col_size\/5*4),int(row_size\/5):int(row_size\/5*4)] \n    mean = np.mean(middle)  \n    max = np.max(img)\n    min = np.min(img)\n    \n    # To improve threshold finding, I'm moving the \n    # underflow and overflow on the pixel spectrum\n    img[img==max]=mean\n    img[img==min]=mean\n    \n    # Using Kmeans to separate foreground (soft tissue \/ bone) and background (lung\/air)\n    \n    kmeans = KMeans(n_clusters=2).fit(np.reshape(middle,[np.prod(middle.shape),1]))\n    centers = sorted(kmeans.cluster_centers_.flatten())\n    threshold = np.mean(centers)\n    thresh_img = np.where(img<threshold,1.0,0.0)  # threshold the image\n\n    # First erode away the finer elements, then dilate to include some of the pixels surrounding the lung.  \n    # We don't want to accidentally clip the lung.\n\n    eroded = morphology.erosion(thresh_img,np.ones([3,3]))\n    dilation = morphology.dilation(eroded,np.ones([8,8]))\n\n    labels = measure.label(dilation) # Different labels are displayed in different colors\n    label_vals = np.unique(labels)\n    regions = measure.regionprops(labels)\n    good_labels = []\n    for prop in regions:\n        B = prop.bbox\n        if B[2]-B[0]<row_size\/10*9 and B[3]-B[1]<col_size\/10*9 and B[0]>row_size\/5 and B[2]<col_size\/5*4:\n            good_labels.append(prop.label)\n    mask = np.ndarray([row_size,col_size],dtype=np.int8)\n    mask[:] = 0\n\n\n    #  After just the lungs are left, we do another large dilation\n    #  in order to fill in and out the lung mask \n    \n    for N in good_labels:\n        mask = mask + np.where(labels==N,1,0)\n    mask = morphology.dilation(mask,np.ones([10,10])) # one last dilation\n\n    if (display):\n        fig, ax = plt.subplots(3, 2, figsize=[12, 12])\n        ax[0, 0].set_title(\"Original\")\n        ax[0, 0].imshow(img, cmap='gray')\n        ax[0, 0].axis('off')\n        ax[0, 1].set_title(\"Threshold\")\n        ax[0, 1].imshow(thresh_img, cmap='gray')\n        ax[0, 1].axis('off')\n        ax[1, 0].set_title(\"After Erosion and Dilation\")\n        ax[1, 0].imshow(dilation, cmap='gray')\n        ax[1, 0].axis('off')\n        ax[1, 1].set_title(\"Color Labels\")\n        ax[1, 1].imshow(labels)\n        ax[1, 1].axis('off')\n        ax[2, 0].set_title(\"Final Mask\")\n        ax[2, 0].imshow(mask, cmap='gray')\n        ax[2, 0].axis('off')\n        ax[2, 1].set_title(\"Apply Mask on Original\")\n        ax[2, 1].imshow(mask*img, cmap='gray')\n        ax[2, 1].axis('off')\n        \n        plt.show()\n    return mask*img","22e2c2fa":"# Select a sample\npath = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00007637202177411956430\/19.dcm\"\ndataset = pydicom.dcmread(path)\nimg = dataset.pixel_array\n\n# Masked image\nmask_img = make_lungmask(img, display=True)","c266b5f7":"## _1.4 Evaluation Metric :_\n**Laplace Log Likelihood (modified version)**: useful to evaluate a model's confidence in its decisions. Accordingly, the metric is designed to reflect both the accuracy and certainty of each prediction.\n\n\nThe error is thresholded at 1000 ml to avoid large errors adversely penalizing results, while the confidence values are clipped at 70 ml to reflect the approximate measurement uncertainty in FVC. \n\n<font color='red'>Note : The metric values will be negative and higher is better.<\/font>","47328749":"The above block tells us that there are:\n- 1 float64 feature.\n- 3 int64 features.\n- 3 object type features.\n\n**It also tells us the there is no missing data from the train set as the shape of dataset is equal to the count of non-null values present in each feature.** ","0e3ec035":"### _2.5.7 'Sex' and 'SmokingStatus'_","ab77ab85":"## _1.5 Importing relevant packages_ \ud83d\udce6","a91267c2":"# _Next Up : Baseline model. Stay Tuned..._","a4b6b032":"### _2.5.6 'Age' and 'Smoking' -_","49b36a71":"**Let's have a look at the KDE plots to have a more clear picture**","ee3ad180":"### <font color='orange'>If you find this kernel useful, please **UPVOTE** it \ud83d\ude0a which keeps me motivated to do more hard work and produce more quality content.<\/font>","13b54ae0":"It is clear from the plot that pulmonary fibrosis is more prominent across 'Males' than in 'Females' across all age groups. This thing is clear from the data itself as there are only 325 records who are female and 1224 records who are Male. ","3cc714fa":"### _2.4 Let's now have a look at the count and percentage of each - 'Sex' and 'SmokingStatus'_","cea67610":"### _3.5.1 How does the mask work?_","41aa79dd":"### Let's wrap up the EDA part here and move on to DICOM visualization and Analysis part","4050e5e4":"## _3.4 GIF from Images_ \ud83c\udf14\ud83c\udf15\ud83c\udf16\nPatients have various number of CT scans: the more scans\/patient, the more information we have about well ... their lungs. Here we can see that when patients have low number of scans (~ 12) only an \"inhale\"? is observed, whereas when we have 80+ scans the details are much more enhanced.","5decbb93":"#### **Disclaimer :** *A major part of this section is taken from [Andrada Olteanu's Notebook](https:\/\/www.kaggle.com\/andradaolteanu\/pulmonary-fibrosis-competition-eda-dicom-prep). Do check out her [notebook](https:\/\/www.kaggle.com\/andradaolteanu\/pulmonary-fibrosis-competition-eda-dicom-prep).*","b96a4116":"![](https:\/\/medicaldialogues.in\/h-upload\/2020\/05\/18\/128958-idiopathic-pulmonary-fibrosis.jpg)","365c6c66":"### _3.4.2 12 CT Scans GIF_","5e2d7fdd":"#      \ud83d\udc68\u200d\u2695\ufe0f _OSIC Pulmonary Fibrosis Progression_ \ud83d\udc69\u200d\u2695\ufe0f ","6eb851e6":"## _3.3 An inhale for the Patient_\nYou can see how the lungs expand image by image.","9ad68708":"### _<font color='gray'> Let's now have a look at relation of 'FVC' with other features as well...<\/font>_\n\n### _2.5.2 First we will analyze 'FVC' and 'SmokingStatus'_","d8d87f7b":"# _<font color='red'> 3. DICOM Viz. + Analysis<\/font>_ \ud83d\udcf8","70b0a2be":"## _1.2 About OSIC :_ \n***Open Source Imaging Consortium*** (OSIC) is a not-for-profit, co-operative effort between academia, industry and philanthropy. The group enables rapid advances in the fight against Idiopathic Pulmonary Fibrosis (IPF), fibrosing interstitial lung diseases (ILDs), and other respiratory diseases, including emphysematous conditions.","150ea434":"**Thus, no missing data throughout our train and test set**","23c8b1e7":"### _2.1 Descriptive Statistics_","c2070850":"## _2.5 It's time now to get a bit deeper into the feature 'FVC' (Forced Vital Capacity) as it is the main feature of this competition_\n\n<font color='blue'>Question 1.<\/font> <font color='red'>So What is FVC ?<\/font><br><br>\n<font color='blue'>Answer 1.<\/font> <font color='red'> Forced vital capacity (FVC) is the amount of air that can be forcibly exhaled from your lungs after taking the deepest breath possible, as measured by spirometry. This test may help distinguish obstructive lung diseases, such as asthma and COPD, from restrictive lung diseases, such as pulmonary fibrosis and sarcoidosis.<\/font>\n\n<font color='red'>FVC can also help doctors assess the progression of lung disease and evaluate the effectiveness of treatment. An abnormal FVC value may be chronic, but sometimes the problem is reversible and the FVC can be corrected.<\/font><br><br>\n\n<font color='blue'>Question 2.<\/font> <font color='red'>What is the normal FVC range in males and females ?<\/font><br><br>\n<font color='blue'>Answer 2.<\/font> <font color='red'>  Normal values in healthy males aged 20-60 range from 3500 to 4500 ml, and normal values for females aged 20-60 range from 2500 to 3500 ml.<\/font>\n\n\n### _2.5.1 First, we will have a look at the regplot of 'FVC' just to get a fair idea of how FVC trends over time for first 6 patients_","06134580":"### _1.6.1 Dimensions of our dataset_","06ea42bd":"### But just to make sure, let's check if there is any missing data...","ce45d6ea":"### It is clear from the plot that the general trend of FVC is downwards, which means it is decreasing over time. This is *bad* because Forced vital capacity (FVC) is the amount of air that can be forcibly exhaled from your lungs after taking the deepest breath possible and a reducing FVC value indicates deteorating condition of lungs and ultimately the deteorating condition of patient.","f5041717":"### _2.5.3 Let's see if we can find anything between 'FVC' and 'Sex'_","591a6cfa":"# <font color='red'>1. Introduction<\/font> \ud83d\udc68\ud83c\udffb\u200d\ud83d\udcbb\n## _1.1 What is Pulmonary Fibrosis ?_","8a1341d2":"Pulmonary fibrosis is a lung disease that occurs when lung tissue becomes damaged and scarred. This thickened, stiff tissue makes it more difficult for your lungs to work properly. As pulmonary fibrosis worsens, you become progressively more short of breath.","8d7e4bdf":"## _1.3 Competition Objective :_\n\nIn this competition, you\u2019ll predict a patient\u2019s severity of decline in lung function based on a CT scan of their lungs. You\u2019ll determine lung function based on output from a spirometer, which measures the volume of air inhaled and exhaled. The challenge is to use machine learning techniques to make a prediction with the image, metadata, and baseline FVC as input.","c95092c1":"### _2.2 No. of unique patients, Age and Smoking Status_","0d8d309f":"## _1.6 Importing the train and test set ..._ \ud83e\uddea","643852f1":"### Most of the patients who have been diagnoed with this disease were Ex-Smokers throughout all ages.","e582ffdf":"### _2.5.5 How many males and females are there across different ages ?_","6d8b405c":"###  _2.5.4 What about 'FVC' and 'Age'???_","2a4e0c00":"# _<font color='red'>4. References<\/font>_\n- https:\/\/www.kaggle.com\/andradaolteanu\/pulmonary-fibrosis-competition-eda-dicom-prep\n- https:\/\/medium.com\/@hengloose\/a-comprehensive-starter-guide-to-visualizing-and-analyzing-dicom-images-in-python-7a8430fcb7ed","2de887af":"#### **We see that there are 7 features in each train and test sets. Let's look at what each feature means :**\n- **Patient** - a unique Id for each patient (also the name of the patient's DICOM folder)\n- **Weeks** - the relative number of weeks pre\/post the baseline CT (may be negative)\n- **FVC** - the recorded lung capacity in ml (Forced vital capacity)\n- **Percent** - a computed field which approximates the patient's FVC as a percent of the typical FVC for a person of similar characteristics\n- **Age** - Age of person\n- **Sex** - Sex of person (Male\/Female)\n- **SmokingStatus** - Whether the patient is a smoker\/non-smoker\/ex-smoker","e6baec13":"### _2.3 How 'FVC', 'Percent' and 'Age' are distributed_","5b6116ef":"# _<font color='red'>2. Exploratory Data Analysis (EDA)<\/font>_ \ud83d\udcca","e15e1e04":"## _3.1 Number of CT scans per patient_\nHuge imbalance in the number of CT scans: half of the patients have less that 100 photos registered.","57bffe44":"## _3.5 DICOM Lung Mask_\n- Segmentation is part of the preprocessing method\n- Has the purpose of auto-detecting the boundaries surrounding a volume of interest (our case is the lungs)\n- Drawbacks: be sure you don't exclude important parts (like lesions)","14cf2000":"**It is good to see that the distribution is somewhat normally distributed with a little bit of skewness for the 3 features.**","9affeba0":"### _3.4.1 Create and compare GIFs_","48e61046":"## _3.2 Visualize the DICOM Info and Image_\n\nDICOM data can be extracted by using pydicom.dcmread()","47ab9d95":"### FVC values are greater in males as compared to females. This is fine because the normal range of females is less as compared to males.","c1e00b14":"A lot of patients with this disease were Ex-smokers. Also, this disease seems to be more prominent in an Ex smoker than in other two categories.","164f172f":"All there curves for all three smoking categories is somewhat normally distributed with skewness in each category curve.\n\n\n- An FVC value of approx. 3000 seems to be more prominent in patients who currently smoke. This is a bit of concern as a healhty male shoul have an FVC value of 3500 - 4500.\n- Patients who are non smokers have a much flattened curve indicating that such patients varying range of FVC from 1000 to 4000.\n- Patients who were ex-smoker have a range of aprrox. 2000-3500. This is a thing of concern as such patients have already damaged their lungs from smoking and there FVC value is also low. The skewness in the curve depicts that a few patients have an increased level of FVC (~5500-7000)."}}