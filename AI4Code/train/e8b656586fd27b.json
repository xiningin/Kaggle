{"cell_type":{"164a447e":"code","b7287ed0":"code","3773d5a1":"code","aa453dc7":"code","68894f47":"code","bda90d3d":"code","75c3f4c9":"code","a79d3e0c":"code","50a43bcc":"code","305f41d2":"code","77e603c7":"code","15a86e1d":"code","25752508":"code","1d728a06":"code","aecb011a":"code","c09251d1":"code","899d90c9":"code","9d59040b":"code","3d66b993":"code","62541bf1":"code","780ed523":"code","2e310ced":"code","2ea484c4":"code","70eec8ac":"code","82bd74b1":"code","41767a19":"code","c5d1c5db":"code","8938a850":"code","88a76065":"code","d3facd8f":"code","9a3594f0":"code","451a563d":"code","ec084bf0":"code","470fe61f":"markdown","ad2acb04":"markdown","88c90c9e":"markdown","09c25e64":"markdown","5bb24849":"markdown","e403c5e6":"markdown","66b74ffe":"markdown","04036a59":"markdown","002ee345":"markdown","2fb54ac5":"markdown","e757801b":"markdown","d235f7b8":"markdown","9cfed0c9":"markdown","1fce5dae":"markdown","2f7912df":"markdown","7b4847d0":"markdown","eff416b8":"markdown","18ae8060":"markdown","00968c13":"markdown","d4f63057":"markdown","568e03b5":"markdown","1f694fc1":"markdown"},"source":{"164a447e":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","b7287ed0":"%matplotlib inline\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn import datasets, linear_model\nfrom sklearn.metrics import mean_squared_error, r2_score\nfrom sklearn.linear_model import LogisticRegression\nplt.style.use('ggplot')\n","3773d5a1":"df = pd.read_csv('\/kaggle\/input\/top-20-chess-ratings-20002021\/Chess.csv')\ndf.head()","aa453dc7":"df.info()","68894f47":"df.corr()","bda90d3d":"df['Date'] = df['Date'].replace(' Jan', '', regex=True).astype(int)\ndf.info()","75c3f4c9":"df.nlargest(1, 'ELO')","a79d3e0c":"average_20_elo = df.nlargest(20, 'ELO')['ELO'].mean()\nprint('The average ELO of the top 20 position is: %s'%average_20_elo)","50a43bcc":"plt.figure(figsize=(18, 6))\nplt.plot(np.sort(df['Date'].unique()), df.groupby('Date')['ELO'].mean())\nplt.xlabel('Date')\nplt.ylabel('Elo')\nplt.title('Time Trend For Average ELO');","305f41d2":"# Singular player trend over the years\nname_list = list(df['Name'].unique())\ndef trend_play(name):\n    plt.figure(figsize=(18, 6))\n    for i in name_list:\n        if i == name:\n            df_name = df[['Name', 'Date', 'ELO']].loc[df['Name']==i].sort_values('Date')\n    return plt.plot(df_name['Date'], df_name['ELO']), plt.xlabel('Years'), plt.title(name+''+' trend' );\n\nfor i in name_list[:10]:\n    print(trend_play(i))\n","77e603c7":"# Analysing the trend of all the players\nplt.figure(figsize=(18, 10))\n\nsns.barplot(x='Date', y='ELO', data=df, ci=False)\nplt.xticks(rotation=45)\nplt.title('Average ELO trend over years')\nplt.show()","15a86e1d":"df.nlargest(20, 'ELO').min()","25752508":"top_20_average_age = df.nlargest(20, 'ELO').Age.mean()\nprint(f'Average age of top 20 ELO players: {top_20_average_age:.2f}')","1d728a06":"mean_age = df.groupby('Date')['Age'].mean()\n# display(mean_age)\nplt.figure(figsize=(18, 6))\nplt.plot(mean_age);\nplt.xlabel('Date')\nplt.ylabel('Age')\nplt.title('Average age time trend')","aecb011a":"plt.figure(figsize=(18, 6))\nsns.barplot(x='Date', y='Age', data=df, ci=False)\nplt.xticks(rotation=45)\nplt.title('Age distribution over the years')","c09251d1":"df.nlargest(20, 'ELO')['Name'].value_counts()","899d90c9":"average_age_top_10 = df.nlargest(10, 'ELO')['Age'].mean()\nprint(f'The average age of top 10 players is: {average_age_top_10:.2f}')","9d59040b":"df.nlargest(10, 'ELO').groupby('Name')['Age'].mean()","3d66b993":"best_ever_carlsen = df.loc[df['Name']=='Carlsen']['ELO'].max()\ndef prob_win(name_1, name_2, rating_b):\n    rating_a = df.loc[df['Name']==name_1]['ELO'].max()\n    m = (rating_b - rating_a)\/400\n    prob = round((1 \/ (1 + 10**m)*100), 2)\n    return f'The probability of winning for \"best ever\" {name_1} against {name_2} is {prob}%.\\\n The probability of draw is {prob\/2:0.2f}%'\n\nprint(prob_win('Carlsen', 'Undetermined Engine', 3100))\nprint(prob_win('Carlsen', 'Stockfish', 3512))","62541bf1":"df = df.copy()\ndf.head()","780ed523":"df['Age'].plot.hist(bins=50, title = \"Histogram of the Age variable\")","2e310ced":"df['ELO'].plot.hist(bins=50, title = 'Histogram of the ELO variable')","2ea484c4":"from scipy.stats import zscore\ndf[\"Age_zscore\"] = zscore(df[\"Age\"])\ndf[\"is_outlier\"] = df[\"Age_zscore\"].apply(lambda x: x <= -2.5 or x >= 2.5)\ndf[df[\"is_outlier\"]]","70eec8ac":"df[\"ELO_zscore\"] = zscore(df[\"ELO\"])\ndf[\"elo_is_outlier\"] = df[\"ELO_zscore\"].apply(lambda x: x <= -2.5 or x >= 2.5)\ndf[df[\"elo_is_outlier\"]]","82bd74b1":"data = df[['Age', 'ELO']].where(df['Name'] == 'Carlsen').dropna().sort_values('Age', ascending=True)\nX_age = data[['Age']].to_numpy()\nY_elo = data[['ELO']].to_numpy()\ndisplay(data)\ndisplay(X_age.shape)\ndisplay(Y_elo.shape)\n# sns.scatterplot(x=data['Age'], y=data['ELO'])\nplt.plot(X_age, Y_elo)","41767a19":"from sklearn.svm import SVR\nsvm = SVR(gamma=1).fit(X_age_train, Y_elo_train.ravel())\ny_pred = svm.predict(X_age_test)\ny_pred","c5d1c5db":"from sklearn.preprocessing import PolynomialFeatures\npoly = PolynomialFeatures(degree=10, include_bias=False)\nX_age_poly = poly.fit_transform(X_age)\nX_age_poly.shape","8938a850":"# Split the data in to training\/testing sets\nX_age_train = X_age_poly[:-4]\nX_age_test = X_age_poly[-4:]\n# Split the targets in to training\/testing sets \nY_elo_train = Y_elo[:-4]\nY_elo_test = Y_elo[-4:]\n\n# Create linear regression object\nregr = linear_model.LinearRegression()\nprint(X_age_test.shape)","88a76065":"Y_elo_train","d3facd8f":"# Train the model using the training set\nregr.fit(X_age_train, Y_elo_train)","9a3594f0":"# Make predictions using the testing test\nY_elo_pred = regr.predict(X_age_test)\nprint('Prediction for next year Carlsen\\'s ELO is: %.02f'%Y_elo_pred[0])\n# The coefficients\nprint('Coefficients:', regr.coef_)\n# The mean squared error\nprint('Mean squared error : %.2f'%mean_squared_error(Y_elo_test, Y_elo_pred))\n# The coefficient of determination: 1 is perfect prediction\nprint('Coefficient of determination: %.2f'%r2_score(Y_elo_test, Y_elo_pred))","451a563d":"Y_elo_pred\nX_age_test.shape","ec084bf0":"# Plot outputs\nplt.figure(figsize=(18, 6))\nplt.scatter(data.ELO, data.Age, color='black')\nplt.plot(Y_elo_pred, X_age_test, color='blue', linewidth=3)\nplt.xlabel('Age')\nplt.ylabel('ELO')\n# plt.xticks(rotation=45)\n# plt.yticks(())\nplt.title('Linear regression study Age\/ELO - Magnus Carlsen')\n\nplt.show()","470fe61f":"We can now proceed to the prediction","ad2acb04":"## The probability of winning for player A is P(A)= 1\/(1+10^m) where m is the rating difference (rating(B)-rating(A)) divided by 400. If a chess engine has ELO 3100, what is the chance of win for \"best ever\" Magnus Carlsen? Currently Stockfish engine have ELO 3512, what is the chance of a win for Magnus Carlsen? What is the chance of drawing?","88c90c9e":"## Import the data","09c25e64":"## Create a model which uses age as predictor of ELO. Try to predict Magnus Carlsen next year rating!","5bb24849":"### Z-score","e403c5e6":"## What is the top 20 average age?","66b74ffe":"## What is the average age of peak performance of top 10 players?","04036a59":"## Preprocess Year column to make it integer (remove \u201cJan\u201d)","002ee345":"<br><h1 style=\"font-family:COMIC SANS;text-align:center;background-color:lightblue\" ><b>Table of Contents<\/b><\/h1><br>","2fb54ac5":"First, we are going to find the outliers in the age column. To decide which method of finding outliers we should use, we must plot the histogram of the variable and look at its distribution.","e757801b":"We can see that there is a slight positive trend over the years","d235f7b8":"Thank you!!","9cfed0c9":"## Are the player getting older, younger or there is no significant difference?","1fce5dae":"## Are the players getting stronger, weaker or there is no significant difference?","2f7912df":"## Who appeared most times in the top 20?","7b4847d0":"##  What is the time trend for the average ELO?","eff416b8":"## What is the minimum ELO of a player who ever appeared in top 20? Who is he?","18ae8060":"It looks a little bit like Gaussian distribution so we will use z-score. Z-score is the difference between the value and the sample mean expressed as the number of standard deviations. To check what percentage of values covers a range of z-score values we should take a look at a (z-table)[http:\/\/www.z-table.com\/].","00968c13":"## What is the time trend for the average age?","d4f63057":"We will try to answer to the following\n\n1. Preprocess Year column to make it integer (remove \u201cJan\u201d)\n2. Who had the highest ELO? In which year?\n3. What is the top 20 average ELO? What is the time trend for the average ELO?\n4. Are the players getting stronger, weaker or there is no significant difference?\n5. What is the minimum ELO of a player who ever appeared in top 20? Who is this?\n6. What is the top 20 average age? What is the time trend for the average age?\n7. Are the players getting older, younger or there is no significant difference?\n8. who appeared most times in the top 20?\n9. what is the average age of peak performance of top 10 players?\n10. The probability of winning for player A is P(A) = 1\/(1+10^m) where m is the rating difference (rating(B)-rating(A)) divided by 400. If a chess     Engine has ELO 3100, what is the chance of win for \u201cbest ever\u201d Magnus Carlsen? Currently, Stockfish engine have ELO 3512, what is the chance of a win for Magnus Carlsen? What is the chance of drawing?\n11. create a model which uses age as a predictor of ELO. Try to predict Magnus Carlsen\u2019s next year rating!","568e03b5":"## What is the top 20 average ELO?","1f694fc1":"## Who had the highest ELO? In which year?"}}