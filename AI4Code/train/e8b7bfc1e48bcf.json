{"cell_type":{"54d3c846":"code","c506b2fb":"code","66bcffa1":"code","722d4a34":"code","d94ab664":"code","9f71e799":"code","87174dd5":"code","9dccc5bf":"code","b091da69":"code","6820e5e3":"code","0ac10ba5":"code","036f7882":"code","8adeb15d":"code","633dc954":"code","3876aa87":"code","ac83b9ae":"code","22996da5":"code","f19d487f":"code","b883a869":"code","1421de4f":"code","95de48cf":"code","cd49b86f":"code","283479bb":"code","17b6c1ac":"code","80295cd9":"code","e85ef7fc":"code","3e9112c7":"code","95c9cefe":"code","1d1dac2d":"code","c4685d90":"code","d1a11929":"code","c06db677":"code","b666caa7":"code","db26a955":"code","79fb1d94":"markdown","ee18e37a":"markdown","5ee88637":"markdown","8fcb5593":"markdown","2c8a213e":"markdown","a4504f88":"markdown","21575b3f":"markdown","02c27586":"markdown","f08f329c":"markdown","2a49bae6":"markdown","032c72b6":"markdown","f42fb52b":"markdown","443cd9ab":"markdown","c11876ad":"markdown","81191369":"markdown","31f5365e":"markdown","06834a39":"markdown","b29305ef":"markdown","bdb5f598":"markdown","0599bb09":"markdown","b6fe3d3f":"markdown","f986add0":"markdown","ceae991d":"markdown","d4a88193":"markdown","762f45c4":"markdown","0edd96f6":"markdown","c3c7b138":"markdown","6e6d7294":"markdown","6f9de3dd":"markdown","ce7db0df":"markdown","ea2c738d":"markdown","fdc9e7f5":"markdown","db2bd451":"markdown","83f153ac":"markdown","8d89ac13":"markdown"},"source":{"54d3c846":"import numpy as np\nimport pandas as pd\nimport plotly.express as px\nfrom IPython.display import display\nfrom ashrae_utils import reduce_mem_usage","c506b2fb":"data_path = '..\/input\/ashrae-energy-prediction\/'","66bcffa1":"X_train = pd.read_csv(data_path + 'train.csv', engine='python')\nX_train, na_list = reduce_mem_usage(X_train)\nX_train['timestamp'] = pd.to_datetime(X_train['timestamp'], format='%Y-%m-%d %H:%M:%S')\nX_train['meter'] = pd.Categorical(X_train['meter']).rename_categories({0: 'electricity', 1: 'chilledwater', 2: 'steam', 3: 'hotwater'})","722d4a34":"X_train.head()","d94ab664":"building_metadata = pd.read_csv(data_path + 'building_metadata.csv', engine='python')\nbuilding_metadata, na_list = reduce_mem_usage(building_metadata)","9f71e799":"building_metadata.head()","87174dd5":"daily_train = X_train\ndaily_train['date'] = daily_train['timestamp'].dt.date\ndaily_train = daily_train.groupby(['date', 'building_id', 'meter']).sum()\ndaily_train","9dccc5bf":"daily_train_agg = daily_train.groupby(['date', 'meter']).agg(['sum', 'mean', 'idxmax', 'max'])\ndaily_train_agg = daily_train_agg.reset_index()\nlevel_0 = daily_train_agg.columns.droplevel(0)\nlevel_1 = daily_train_agg.columns.droplevel(1)\nlevel_0 = ['' if x == '' else '-' + x for x in level_0]\ndaily_train_agg.columns = level_1 + level_0\ndaily_train_agg.rename_axis(None, axis=1)\ndaily_train_agg.head()","b091da69":"fig_total = px.line(daily_train_agg, x='date', y='meter_reading-sum', color='meter', render_mode='svg')\nfig_total.update_layout(title='Total kWh per energy aspect')\nfig_total.show()","6820e5e3":"fig_maximum = px.line(daily_train_agg, x='date', y='meter_reading-max', color='meter', render_mode='svg')\nfig_maximum.update_layout(title='Maximum kWh value per energy aspect')\nfig_maximum.show()","0ac10ba5":"daily_train_agg['building_id_max'] = [x[1] for x in daily_train_agg['meter_reading-idxmax']]\ndaily_train_agg.head()","036f7882":"def show_building(building, energy_aspects=None):\n    fig = px.line(daily_train.loc[(slice(None), building, slice(None)), :].reset_index(),\n                  x='date',\n                  y='meter_reading',\n                  color='meter',\n                  render_mode='svg')\n    if energy_aspects:\n        if 'electricity' not in energy_aspects:\n            fig['data'][0].visible = 'legendonly'\n        if 'chilledwater' not in energy_aspects:\n            fig['data'][1].visible = 'legendonly'\n        if 'steam' not in energy_aspects:\n            fig['data'][2].visible = 'legendonly'\n        if 'hotwater' not in energy_aspects:\n            fig['data'][3].visible = 'legendonly'\n    fig.update_layout(title='Building ID: {}'.format(building))        \n    fig.show()\n    display(building_metadata[building_metadata['building_id']==building])","8adeb15d":"print('Number of days that a building has the maximum electricity consumption of all the buildings:\\n')\nprint(daily_train_agg[daily_train_agg['meter'] == 'electricity']['building_id_max'].value_counts())","633dc954":"daily_train_electricity = daily_train_agg[daily_train_agg['meter']=='electricity'].copy()\ndaily_train_electricity['building_id_max'] = pd.Categorical(daily_train_electricity['building_id_max'])\nfig_daily_electricity = px.scatter(daily_train_electricity,\n                                   x='date',\n                                   y='meter_reading-max',\n                                   color='building_id_max',\n                                   render_mode='svg')\nfig_daily_electricity.update_layout(title='Maximum consumption values for the day and energy aspect')\nfig_daily_electricity.show()","3876aa87":"show_building(803, ['electricity'])","ac83b9ae":"show_building(801, ['electricity'])","22996da5":"show_building(799, ['electricity'])","f19d487f":"show_building(1088, ['electricity'])","b883a869":"show_building(993, ['electricity'])","1421de4f":"show_building(794, ['electricity'])","95de48cf":"print('Number of days that a building has the maximum chilledwater consumption of all the buildings:\\n')\nprint(daily_train_agg[daily_train_agg['meter'] == 'chilledwater']['building_id_max'].value_counts())","cd49b86f":"daily_train_chilledwater = daily_train_agg[daily_train_agg['meter']=='chilledwater'].copy()\ndaily_train_chilledwater['building_id_max'] = pd.Categorical(daily_train_chilledwater['building_id_max'])\nfig_daily_chilledwater = px.scatter(daily_train_chilledwater,\n                                    x='date',\n                                    y='meter_reading-max',  \n                                    color='building_id_max', \n                                    render_mode='svg')\nfig_daily_chilledwater.update_layout(title='Maximum consumption values for the day and energy aspect')\nfig_daily_chilledwater.show()","283479bb":"show_building(778, ['chilledwater'])","17b6c1ac":"show_building(1088, ['chilledwater'])","80295cd9":"print('Number of days that a building has the maximum steam consumption of all the buildings:\\n')\nprint(daily_train_agg[daily_train_agg['meter'] == 'steam']['building_id_max'].value_counts())","e85ef7fc":"daily_train_steam = daily_train_agg[daily_train_agg['meter']=='steam'].copy()\ndaily_train_steam['building_id_max'] = pd.Categorical(daily_train_steam['building_id_max'])\nfig_daily_steam = px.scatter(daily_train_steam,\n                             x='date',\n                             y='meter_reading-max',\n                             color='building_id_max',\n                             render_mode='svg')\nfig_daily_steam.update_layout(title='Maximum consumption values for the day and energy aspect')\nfig_daily_steam.show()","3e9112c7":"show_building(1099, ['steam'])","95c9cefe":"show_building(1168, ['steam'])","1d1dac2d":"show_building(1197, ['steam'])","c4685d90":"show_building(1148, ['steam'])","d1a11929":"print('Number of days that a building has the maximum hotwater consumption of all the buildings:\\n')\nprint(daily_train_agg[daily_train_agg['meter'] == 'hotwater']['building_id_max'].value_counts())","c06db677":"daily_train_hotwater = daily_train_agg[daily_train_agg['meter']=='hotwater'].copy()\ndaily_train_hotwater['building_id_max'] = pd.Categorical(daily_train_hotwater['building_id_max'])\nfig_daily_hotwater = px.scatter(daily_train_hotwater,\n                                x='date',\n                                y='meter_reading-max',\n                                color='building_id_max',\n                                render_mode='svg')\nfig_daily_hotwater.update_layout(title='Maximum consumption values for the day and energy aspect')\nfig_daily_hotwater.show()","b666caa7":"show_building(1021, ['hotwater'])","db26a955":"show_building(1331, ['hotwater'])","79fb1d94":"## Electricity","ee18e37a":"The building 1099 has a very large consumption and irreal values: 450\u202f000\u202f000\u00a0kWh.\n\nThe buildings 1168 and 1197 have large consumption: 3\u202f000\u202f000\u00a0kWh.\n\nAnd the building 1148 has values above 1\u202f000\u202f000\u00a0kWh.","5ee88637":"# Conclusion","8fcb5593":"This building has a steady period in the cold part of the year and a very noisy period in the hot part of the year.\n\nMaybe the total is the sum of more than one meter, and maybe the meter which measures the HVAC is not well configured.","2c8a213e":"This building has a very steady daily consumption with a weekly pattern, and without a seasonal pattern.\n\nIt has an average of 95\u202f000\u00a0kWh for 750\u202f000\u00a0ft\u00b2 each day.\nThe second has an average of 175\u202f000\u00a0kWh.\n\nThis is 0.13 kWh\/ft\u00b2\/day or 45 kWh\/ft\u00b2\/year.\nWhere the typical consumptions is about 20 kWh\/ft\u00b2\/year.\nThe specific consumption is more than twice the typical.\n\nSome peak has the maximum of all the buildings at a single day.","a4504f88":"# Group data in a daily basis","21575b3f":"When the value is not gargantuan, it is below 50\u202f000\u00a0kWh.\n\nProbably, as it is something like a three order magnitude difference,\nis a unit misconfiguration, like kWh instead of Wh.","02c27586":"The sum, facetted for each energy aspect, shows some aberrant values.","f08f329c":"Very big value.","2a49bae6":"# Introduction\n\nThe aim of this notebook is to analyse data that can spoil averages.\n\nTo show the data with less noise, a daily grouping has been performed.","032c72b6":"The max values of electricity are caused by only 4 buildings. ","f42fb52b":"The max consumption of the non-aberrant buildings is about 700\u202f000\u00a0kWh.\nThe consumption of this building is 25 times this.\nAnd only for a span of two months.\n\nProbably, the measure is wrong.","443cd9ab":"This is a building typified as an educational center.\nTherefore, there should not be an industrial electricity consumption.\n\nThe electricity consumption has an average of about 120\u202f000\u00a0kWh for 180\u202f000\u00a0ft\u00b2 each day.\n\nThis is 0.66 kWh\/ft\u00b2\/day or 243 kWh\/ft\u00b2\/year.\nWhere the typical consumptions is about 20 kWh\/ft\u00b2\/year.\n\nThis building has a 10 fold more electricity consumption than the typical one.\nMaybe the meter or the software that reads it is not configured correctly.","c11876ad":"## Steam","81191369":"The max values of electricity are caused by only 6 buildings. ","31f5365e":"A 1\u202f000\u202f000\u00a0kWh daily average is too big up to a 500\u202f000\u00a0ft\u00b2 office.","06834a39":"## train","b29305ef":"Taking only the buildings that consume more than the others,\ncould be seen that there are a lot of measure scale errors.\n\nThe error could be:\n\n- The meter is not configured correctly. E.g., a bad voltage or current primary to secondary ratio.\n- The software has not the units configured correctly. E.g., MJ\/kg for steam.\n- The software has not the decimal digits configured correctly.\n- Using a power variable instead of an energy one.\n\nThe measure could be done with an unique meter, or the sum of several of them.\n\nSome changes over time, values go to zero or the scale is changed,\nindicates that some buildings have more than one meter.\nOne error in one meter and the overall measure is garbage.\n\nThis notebook has only analised the outliers that influence the maximum consumption in a daily basis.\nThis is only the tip of the iceberg.\nA sound analysis should be done to detect and correct these outliers.\n\nA solution to avoid scale errors is to normalize the values from 0 to 1, for each building and for each energy aspect.","bdb5f598":"The max values of electricity are caused by only 7 buildings.\nPractically, two of them.","0599bb09":"Too much steam energy for a not so big building.","b6fe3d3f":"## Hotwater","f986add0":"## building metadata","ceae991d":"## Chilledwater","d4a88193":"Big consumption even for a very huge office.","762f45c4":"# Aggregate the data for buildings","0edd96f6":"The max values of electricity are caused by only 10 buildings. ","c3c7b138":"Looking at the max value for each day, and for each energy aspect, shows that only a single building (for day and energy aspect) is causing the aberrant peaks.","6e6d7294":"It's a very big consumption for an education building.","6f9de3dd":"This building has a very erractic behaviour with\nsome periods of no data,\na period of increasing consumption,\nand two periods of stable consumptions with a weekly pattern.\n\nThe first of the two periods has an average of 75\u202f000\u00a0kWh for 500\u202f000\u00a0ft\u00b2 each day.\nThe second has an average of 175\u202f000\u00a0kWh.\n\nThis is 0.15-0.35 kWh\/ft\u00b2\/day or 55-130 kWh\/ft\u00b2\/year.\nWhere the typical consumptions is about 20 kWh\/ft\u00b2\/year.\n\nBoth specific consumptions are from 3 to 7 times the typical.\n\nThis center could be new. The consumption in the summer period is due to office and equipments.\nThen in half september, the course begins. Something changed in November.\n\nThe most problable is that the building is not new, you don't build buildings for half a million square feet in one year. Then, meters have been added progressively, and some of them are not well configured.","ce7db0df":"This building has a typical hot part of the year chilledwater consumption,\nwith a maximum of 100\u202f000\u00a0kWh.\nIn some other short periods has very high peaks of about a hundred times more.","ea2c738d":"Only buildings 778 and 1088 have aberrant values.","fdc9e7f5":"# Prepare data","db2bd451":"# Identifying outliers","83f153ac":"This is a building typified as an educational center.\nTherefore, there should not be an industrial electricity consumption.\n\nThe electricity consumption has an average of about 110\u202f000\u00a0kWh for 500\u202f000\u00a0ft\u00b2 each day.\n\nThis is 0.22 kWh\/ft\u00b2\/day or 80 kWh\/ft\u00b2\/year.\nWhere the typical consumptions is about 20 kWh\/ft\u00b2\/year.\n\nThis building has a 4 fold more electricity consumption than the typical one.\nMaybe the meter or the software that reads it is not configured correctly.","8d89ac13":"This building has a very steady daily consumption with a weekly pattern, and without a seasonal pattern.\n\nIt has some vacational pauses at July and December, and some peaks."}}