{"cell_type":{"2e0aa4de":"code","767126da":"code","523ba1a3":"code","2b89880c":"code","1e159202":"code","eaf71e19":"code","e8f6bc62":"code","80ba6b4d":"code","9e116476":"code","7873f5d5":"code","9aca21e2":"code","2efdd9fb":"code","7cc81727":"code","ecaee582":"code","41423fd5":"code","255a4b02":"code","21b533e0":"code","b391eb96":"code","f7e8f868":"code","6d474909":"code","6bb1d646":"code","6ab0c6f9":"code","8876ec78":"code","a8991b1b":"code","58c78850":"code","2806863f":"code","002c4dad":"code","5b94e5d8":"code","819f8dc7":"code","559c7acb":"code","ba3e73de":"code","706e1cbb":"code","5c3bb541":"code","4b92b00f":"code","53dbe188":"code","068ae5ad":"code","606140ab":"code","b7857548":"code","7c31004d":"code","c86ff4d1":"code","1027f019":"code","067ec287":"markdown","78008ef9":"markdown","2309622e":"markdown","9a8d1c4d":"markdown","db6a3a48":"markdown","f1f648fc":"markdown","97af939e":"markdown","5233cc51":"markdown","ab5354c1":"markdown","acbef27a":"markdown","b7879566":"markdown","b581bee5":"markdown","bde422c0":"markdown","92abfae5":"markdown","d7ebcc76":"markdown","3fedf2f4":"markdown","7eb36324":"markdown","7cf7e9bd":"markdown","2f26db02":"markdown","fbea3c2e":"markdown","3a0e830c":"markdown","c8fbb2aa":"markdown","e9d95177":"markdown","77cdfe1b":"markdown","987fbb9a":"markdown","3852a879":"markdown","8301979f":"markdown","a4b66ae4":"markdown","83cf290d":"markdown","bf3d3fe1":"markdown","4cb2e38f":"markdown","acb55f80":"markdown","e721616d":"markdown","addaa7d8":"markdown","7182d21b":"markdown","acd20ac8":"markdown","4c3eee8a":"markdown","b2c6cd29":"markdown"},"source":{"2e0aa4de":"# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","767126da":"# import all packages and set plots to be embedded inline\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sb\n\n%matplotlib inline\nimport warnings\nwarnings.filterwarnings(\"ignore\")","523ba1a3":"df = pd.read_csv('\/kaggle\/input\/prosper-loan-data\/prosperLoanData.csv')\ndf.head()","2b89880c":"df.shape","1e159202":"# The cols name that i work on it \ncols = ['Term','LoanStatus','ListingCategory (numeric)','EmploymentStatus','IsBorrowerHomeowner',\n        'CreditScoreRangeLower','CreditScoreRangeUpper','StatedMonthlyIncome','LoanOriginalAmount','MonthlyLoanPayment']","eaf71e19":"# filter the data on that cols and save it in a new dataframe colled new_df\nnew_df = df[cols]\nnew_df.head()","e8f6bc62":"new_df.info()","80ba6b4d":"new_df['EmploymentStatus'].fillna(\"Not available\",inplace=True)\nnew_df.dropna(subset = [\"CreditScoreRangeLower\"], inplace=True)","9e116476":"new_df.info()","7873f5d5":"new_df.query('CreditScoreRangeLower < 300').shape[0],new_df.query('CreditScoreRangeUpper < 549').shape[0]","9aca21e2":"new_df.query('CreditScoreRangeLower > 750').shape[0],new_df.query('CreditScoreRangeUpper > 900').shape[0]","2efdd9fb":"# little fun to cluster score\ndef Credit_score(x):\n    outcome=\"\"\n    if x >= 300 :\n        outcome = \"Poor\"\n    if x>=550:\n        outcome = \"Fair\"\n    if x>=650:\n        outcome = \"Good\"\n    if x>=750:\n        outcome = \"Excellent\"\n    return outcome\n    ","7cc81727":"new_df['CreditScore'] = new_df['CreditScoreRangeLower'].apply(Credit_score)","ecaee582":"# Drop the redundant columns\ncols = ['CreditScoreRangeLower','CreditScoreRangeUpper']\nnew_df.drop(columns=cols , axis=1 , inplace=True)","41423fd5":"order = ['Poor','Fair','Good','Excellent']\norder_class = pd.api.types.CategoricalDtype(ordered=True ,categories= order)\nnew_df['CreditScore'] = new_df['CreditScore'].astype(order_class)","255a4b02":"new_df.head(1)","21b533e0":"def H_M_Yers(x):\n    return x\/12\n\nnew_df['Term'] = new_df['Term'].apply(H_M_Yers).astype(int)","b391eb96":"new_df.head(1)","f7e8f868":"listing_Cat = {0:\"Not Available\",\n               1:\"Debt Consolidation\",\n               2:\"Home Improvement\",\n               3:\"Business\",\n               4:\"Personal Loan\",\n               5:\"Student Use\",\n               6:\"Auto\",\n               7:\"Other\",\n               8:\"Baby&Adoption\",\n               9:\"Boat\",\n               10:\"Cosmetic Procedure\",\n               11:\"Engagement Ring\",\n               12:\"Green Loans\",\n               13:\"Household Expenses\",\n               14:\"Large Purchases\",\n               15:\"Medical\/Dental\",\n               16:\"Motorcycle\",\n               17:\"RV\",\n               18:\"Taxes\",\n               19:\"Vacation\",\n               20:\"Wedding Loans\",}\ndef Lst_Cat(x,y=listing_Cat):\n    return y[x]\nnew_df.rename(columns={'ListingCategory (numeric)': 'ListingCategory'},inplace=True)\nnew_df['ListingCategory'] = new_df['ListingCategory'].apply(Lst_Cat)","6d474909":"new_df.head(2)","6bb1d646":"new_df.info()","6ab0c6f9":"plt.hist(x=new_df.StatedMonthlyIncome);","8876ec78":"plt.figure(figsize=[8,2])\nsb.boxplot(data=new_df,x='StatedMonthlyIncome')\nplt.xlim([0,12500]);","a8991b1b":"new_df[new_df['StatedMonthlyIncome']==0]","58c78850":"index = new_df[new_df['StatedMonthlyIncome']==0].index\nnew_df.drop(index,inplace=True)","2806863f":"new_df[new_df['StatedMonthlyIncome']>=12500][:3][:]","002c4dad":"index = new_df[new_df['StatedMonthlyIncome']>=12500].index\nnew_df.drop(index,inplace=True)","5b94e5d8":"x_bins = np.arange(0,new_df.StatedMonthlyIncome.max()+500,500)\nplt.figure(figsize=[10,5])\nplt.hist(x=new_df.StatedMonthlyIncome,bins = x_bins);\nplt.xlabel(\"Stated Monthly Income\");","819f8dc7":"x_bins = np.arange(0,new_df.LoanOriginalAmount.max()+500,500)\nplt.figure(figsize=[10,5])\nplt.hist(x=new_df.LoanOriginalAmount,bins=x_bins);\nplt.xlabel(\"Loan Original Amount\");","559c7acb":"x_bins = np.arange(0,new_df.MonthlyLoanPayment.max()+50,50)\nplt.figure(figsize=[10,5])\nplt.hist(x=new_df.MonthlyLoanPayment,bins=x_bins);","ba3e73de":"x_bins = 10**np.arange(0,np.log10(new_df.MonthlyLoanPayment.max())+0.025,0.025)\nplt.figure(figsize=[10,5])\nplt.hist(x=new_df.MonthlyLoanPayment,bins=x_bins);\nplt.xscale('log')\nplt.xticks([50, 100, 150, 200, 300, 400,600], ['50', '100', '150', '200', '300', '400','600'])\nplt.xlim([50,1200])\nplt.xlabel(\"Monthly Loan Payment (log)\");","706e1cbb":"fig, ax = plt.subplots(nrows=3,ncols=2, figsize = [15,15])\n\ndefault_color = sb.color_palette()[0]\nsb.countplot(data = new_df, x = 'Term', color = default_color, ax = ax[0,0])\n\nsb.countplot(data = new_df, x = 'IsBorrowerHomeowner', color = default_color, ax = ax[0,1])\n\nsb.countplot(data = new_df, x = 'CreditScore', color = default_color, ax = ax[1,0])\n\nsb.countplot(data = new_df, y = 'LoanStatus',order=new_df.LoanStatus.value_counts().index\n             ,color = default_color, ax = ax[1,1])\n\nsb.countplot(data = new_df, y = 'ListingCategory',order=new_df.ListingCategory.value_counts().index\n             , color = default_color, ax = ax[2,0])\n\nsb.countplot(data = new_df, y = 'EmploymentStatus',order=new_df.EmploymentStatus.value_counts().index\n             , color = default_color, ax = ax[2,1])\n\nplt.tight_layout()","5c3bb541":"num_var = ['StatedMonthlyIncome','MonthlyLoanPayment','LoanOriginalAmount']\nordr = ['Current','Completed','Chargedoff','FinalPaymentInProgress','Past Due (1-15 days)','Past Due (16-30 days)'\n        ,'Past Due (31-60 days)','Past Due (61-90 days)','Past Due (91-120 days)','Past Due (>120 days)','Defaulted','Cancelled']","4b92b00f":"def boxplott(x, y, **kwargs):\n    default_color = sb.color_palette()[0]\n    sb.boxplot(x, y, color = default_color,order=ordr)\n    plt.xticks(rotation=90)\n\nplt.figure(figsize = [10, 10])\ng = sb.PairGrid(data = new_df, y_vars = num_var, x_vars = 'LoanStatus',\n                size = 3, aspect = 5)\ng.map(boxplott);\n","53dbe188":"# lets reset indexing\nnew_df.reset_index(inplace=True)","068ae5ad":"new_df.drop('index',axis=1,inplace=True)","606140ab":"# take a rondom 500 sample forom the data and loc for them by the index that why me reset the index\nsamples = np.random.choice(new_df.shape[0], 500, replace = False)\nLoan_samp = new_df.loc[samples,:]\n\ng = sb.PairGrid(data = Loan_samp, vars = num_var)\ng = g.map_diag(plt.hist, bins = 20);\ng.map_offdiag(plt.scatter);","b7857548":"fig , ax = plt.subplots(nrows=3,figsize= [15,10])\n\nsb.countplot(data=new_df,x='LoanStatus',hue='Term',palette=\"Blues\",ax=ax[0])\nax[0].set_xticks([])\nax[0].set_xlabel('')\nsb.countplot(data=new_df,x='LoanStatus',hue='CreditScore',palette=\"Blues\",ax=ax[1])\nax[1].set_xticks([])\nax[1].set_xlabel('')\n\nsb.countplot(data=new_df,x='LoanStatus',hue='EmploymentStatus',palette=\"Blues_r\",ax=ax[2])\nplt.xticks(rotation = 90);\nplt.legend(loc=1);\n","7c31004d":"fig, ax = plt.subplots(nrows=3, figsize = [10,8])\n\ndefault_color = sb.color_palette()[0]\nsb.countplot(data = new_df,x='CreditScore', hue = 'Term',palette='Greens', ax = ax[0])\n\nsb.countplot(data = new_df,x='EmploymentStatus', hue = 'Term',palette='Greens',  ax = ax[1])\n\nsb.countplot(data = new_df,x='EmploymentStatus', hue = 'CreditScore',palette='Greens', ax = ax[2])\n\nplt.tight_layout()","c86ff4d1":"cat_var = ['Term','CreditScore','EmploymentStatus']\nfig , ax = plt.subplots(nrows= 3 ,ncols=3,figsize =[15,10])\nfor i in range(len(cat_var)):\n    var = cat_var[i]\n    sb.violinplot(data=new_df,x=var , y='StatedMonthlyIncome',color=default_color, ax=ax[i,0])\n    sb.violinplot(data=new_df,x=var , y='MonthlyLoanPayment' ,color=default_color, ax=ax[i,1])\n    sb.violinplot(data=new_df,x=var , y='LoanOriginalAmount' ,color=default_color, ax=ax[i,2])\n    plt.xticks(rotation = 90)\n    \n    \nplt.tight_layout()","1027f019":"fig, ax = plt.subplots(ncols = 3, figsize = [15,6])\n\nsb.pointplot(data = new_df, x = 'LoanStatus', y = 'StatedMonthlyIncome', hue = 'Term',order=ordr,\n             palette = 'Greens', linestyles = '', dodge = 0.4, ax = ax[0])\nax[0].set_ylabel('Stated Monthly Income (Mean)')\nax[0].set_yticklabels([],minor = True)\nax[0].set_xticklabels(ordr,rotation = 90)\n\nsb.pointplot(data = new_df, x = 'LoanStatus', y = 'MonthlyLoanPayment', hue = 'Term',order=ordr,\n             palette = 'Greens', linestyles = '', dodge = 0.4, ax = ax[1])\nax[1].set_ylabel('Monthly Loan Payment (Mean)')\nax[1].set_yticklabels([],minor = True)\nax[1].set_xticklabels(ordr,rotation = 90)\nsb.pointplot(data = new_df, x = 'LoanStatus', y = 'LoanOriginalAmount', hue = 'Term',order=ordr,\n             palette = 'Greens', linestyles = '', dodge = 0.4, ax = ax[2])\nax[2].set_ylabel('Loan Original Amount (Mean)')\nax[2].set_yticklabels([],minor = True)\nax[2].set_xticklabels(ordr,rotation = 90)\n\nplt.tight_layout()\nplt.show();","067ec287":"lets discover the relation of categorical features [`Term`,`EmploymentStatus`,`CreditScore`]","78008ef9":"I will leave the data as it is and make my cluster\n#### code","2309622e":"Lets discover the relation between num features[`StatedMonthlyIncome`,`MonthlyLoanPayment`,`LoanOriginalAmount`] and cat features[`Term`,`EmploymentStatus`,`CreditScore`]","9a8d1c4d":"### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?\n\n>There is a negative correlation between monthly income and delay lenth in repayment when borrowers ask for 1 term loan and thier income is low and the repayment is the highest in 1 year term so almost they make a delay on repayment\nin the defaulted status i cant see any evedince to tell me why this borrowers defaulted \n\n\n### Were there any interesting or surprising interactions between features?\n>More loan amount it seem that the term will be 5 years and high monthly loan payment fall into the 1 year term ","db6a3a48":"Most of the borrowers loans for 3 years then 5 and 1. almost 50:50 borrowers have home a slightly bigger in False.\ncredit score for borrowers seems good most of them in the good score and Fair. in the Loan Status few borrowers have passed due and almost pay in time and there is about 3000 defaulted. a big spike in lean for Debt Consolidation and that is a predictable and high percentage for employed and full-time Employment Status for borrowers","f1f648fc":"# Multivariate Exploration\nThe main thing I want to explore in this part of the analysis is how the three numerical feature play into the relationship between Loan Status and its Term.","97af939e":"# Bivariate Exploration\n\nlet's see the relation between `LoanStatus` and [`StatedMonthlyIncome`,`MonthlyLoanPayment`,`LoanOriginalAmount`]","5233cc51":"#### Test","ab5354c1":"**There is a 1388 row with not provided State Monthly Income**\n> from my position, I think i will drop them","acbef27a":"#### Test","b7879566":"There doesn't seem to be that much interaction between CreditScore and Term it seems like they might be more borrower loan for 3 years and they more employed and they have in much percentage good credit score ","b581bee5":"This distribution is right-skewed most of the monthly income for the borrowers in range 2k to 6k","bde422c0":"Let's see the distribution of numeric values [`StatedMonthlyIncome`,`LoanOriginalAmount`,`MonthlyLoanPayment`]","92abfae5":"#### Code","d7ebcc76":"#### Code","3fedf2f4":"# (Prosper Loan Data)\n## by (Mohamed Hekal)\n\n## Preliminary Wrangling\n\n> > This data about Prosper Marketplace, Inc. is a San Francisco, California-based company in the peer-to-peer lending industry. Prosper Funding LLC, one of its subsidiaries, operates Prosper.com, a website where individuals can either invest in personal loans or request to borrow money.\nThe data contain 113937 raw and 81 columns.","7eb36324":"### Discuss the distribution(s) of your variable(s) of interest. Were there any unusual points? Did you need to perform any transformations?\n\n>Most of the borrowers pay in time and there is about 3000 defaulted Loan and a little percentage that passed their due date\n\n### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?\n\n>When investigating the MonthlyLoanPayment a long right tail were identified so i transform to log scale and notice a big spike between 150 to 200 dollar and most loan term is 3 years term and borrowers take a Loan for Debt Consolidation in high percentage and borrowers in most are Emplyed or full time  ","7cf7e9bd":"**There is a 5512 row considered outliers in State Monthly Income**\n> i will drop them too ","2f26db02":"Still have over 100K that is good<br>\nLet's plot the distribution for `StatedMonthlyIncome` again","fbea3c2e":"Monthly Loan Payment has a long-tailed distribution,a lot of borrowers pay little and few pay much.When plotted in log scale the distribution is a multimodal and have a big spike between 150 to 200 and one before 400<br>\nNext up let's see the categorical [`Term`,`LoanStatus`,`ListingCategory`,`EmploymentStatus`,`IsBorrowerHomeowner`,`CreditScore`] \n\n\n","3a0e830c":"There is a lot of data rows and a lot of columns that have much Null value, so I choose specific columns I work on it and drop all of the others","c8fbb2aa":"It is not high interaction between term and monthly income, in normal higher in term lower in loan monthly payment but the plot shows that borrowers that loan for 5 years pay much every month and this because that these borrowers make a high Loan amount and it makes sense.<br>\nthere is a linear correlation in CreditScore and other numeric features and with poor credit scores borrowers pay less each month because they ask for low amounts and borrowers that not employed have a lower monthly income","e9d95177":"there is a negative correlation between monthly income and Loan status borrowers that passed their due date have a lower income but that is true from past due 1-15 days and borrowers that passed their due date > 120 days have a short distribution in monthly income\nand there is a slightly positive correlation that borrowers that pass their due data ask for a higher loan amount\nI will discover more in the next section","77cdfe1b":"#### Define \n> Convert `ListingCategory (numeric)` to the corresponding element \n>>0 - Not Available \n1 - Debt Consolidation \n2 - Home Improvement \n3 - Business\n4 - Personal Loan\n5 - Student Use \n6 - Auto \n7 - Other\n8 - Baby&Adoption \n9 - Boat\n10 - Cosmetic Procedure \n11 - Engagement Ring \n12 - Green Loans \n13 - Household Expenses \n14 - Large Purchases \n15 - Medical\/Dental \n16 - Motorcycle \n17 - RV\n18 - Taxes\n19 - Vacation\n20 - Wedding Loans","987fbb9a":"Ohh Nooo a lot of outlier\ud83d\ude25let's clean\n> i have a question  -At what value do I consider this is outlier? I suggest plt a box plot ","3852a879":"There are a much big spikes in different amount like 4k, 5K,10k and 15k. almost few ask for fractions and a lot ask for multiples of five","8301979f":"# Univariate Exploration","a4b66ae4":"#### Define\n> replace Term cols from [12,36,60] month  to [1,2,3] year","83cf290d":"#### Test","bf3d3fe1":"#### Test","4cb2e38f":"#### Define\n> I will convert `CreditScoreRangeLower`, `CreditScoreRangeUpper` to one column have its score regard to source in next photo and make it in order format\n>> <img src=\"https:\/\/www.bankbazaar.com\/images\/india\/infographic\/get-your-free-credit-score.webp\" alt=\"CreditScore\">\n","acb55f80":"there is an approximately positive linear ralation between Monthly loan amount and Loan original amount and not a big corr between monthly income and monthly loan payment <br>\n\nlet's discover the categorical feature with the feature of interest","e721616d":"#### Code","addaa7d8":"#### Define\n> `EmploymentStatus` , `CreditScoreRangeLower`, `CreditScoreRangeUpper` have Null value \n>> I will replace NaN value in `EmploymentStatus` with \"Not available\"\nand i will drop NaN value in `CreditScoreRangeLower` and `CreditScoreRangeUpper`","7182d21b":"### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?\n\n> There is a negative correlation between monthly income and loan status in past due the lower the income, the more will be the delay in payment and their borrowers Loan a high amount <br><br>\nMost of the borrowers loan for 3 years and there is no interaction between Loan Status and term years\n### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?\n\n> There is an approximately positive relation between Loan Monthly payment and Loan amount.\nBorrowers that loan for 5 term years pay much each month for this loan and they make a higher loan amount and almost with excellent credit score","acd20ac8":"### What is the structure of your dataset?\n\n> After Cleansing there are 113346 Loans in the dataset with 9 features (Term,LoanStatus,ListingCategory,EmploymentStatus,etc..)with 3 numeric values [`StatedMonthlyIncome`,`LoanOriginalAmount`,`MonthlyLoanPayment`] and one bool [`IsBorrowerHomeowner`] and others are categorical with two with order in nature [`Term`,`CreditScore`]\n\n### What is\/are the main feature(s) of interest in your dataset?\n\n> I am interested in factors that affect `Loan Status`\n\n### What features in the dataset do you think will help support your investigation into your feature(s) of interest?\n\n> I think all 8 features will support my investigation. I choose these features because i think it will help","4c3eee8a":"There doesn't seem to be that much interaction between categorical feature and Loan Status in a completed loans borrowers often borrow for 3 years and their credit score fall in most in fair and good in the current there are 3 and 5 years term and almost no loan for 1 term ","b2c6cd29":"It is clear that the lower the monthly income, the longer the repayment delay. In all cases, the larger the monthly loan payment of loans when the loan is for one year. When the loan is of high amount, the monthly payment of the loan is large and the monthly income is low, The delay in repayment often occurs. Most borrowers who need a loan of high amount make it for 5 Years"}}