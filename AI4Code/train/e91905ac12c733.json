{"cell_type":{"8ad0a506":"code","25aaee37":"code","0e9df7e9":"code","27bd19ae":"code","73a2cad7":"code","10b17694":"code","dcaabea0":"code","faecf031":"code","e82aaacf":"code","6301abee":"code","c44c21ba":"code","ccdc9bf8":"code","5994af93":"code","b55a4748":"code","0520c490":"code","f3bee0f8":"code","cebbccdb":"code","c2b2463f":"code","7da93cf2":"code","87644d42":"code","5360fbee":"code","0edc1f29":"code","3b4ca4ac":"code","4b29462a":"code","12553736":"code","b274e02c":"code","821b8cf8":"markdown","87df82f1":"markdown","26823261":"markdown","78bac171":"markdown","1ef3282e":"markdown","10b9e47e":"markdown","a1995e48":"markdown","f6dbea1f":"markdown","543167fc":"markdown","3f6a1500":"markdown","bd5b90c0":"markdown","4cd5c587":"markdown","39d4b2ce":"markdown","8d504534":"markdown","4a30e527":"markdown","343209b3":"markdown","dbe9d01b":"markdown","3735fb0a":"markdown","03c4705f":"markdown","216bce0b":"markdown","1eee2677":"markdown","ff1ea7bb":"markdown"},"source":{"8ad0a506":"import numpy as np \nimport pandas as pd \n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\nimport plotly.offline as py\nimport plotly.express as px\nimport plotly.graph_objects as go\n\npy.init_notebook_mode()\npd.plotting.register_matplotlib_converters()","25aaee37":"tests_vs_confirmed= pd.read_csv(\"..\/input\/covid19-tested-vs-confirmed\/tests-vs-confirmed-cases-covid-19-per-million.csv\")\n\ntests_vs_confirmed=tests_vs_confirmed.dropna()\n\ntests_vs_confirmed=tests_vs_confirmed.rename(columns={'Total COVID-19 tests per million people':'tested',\n                                  'Total confirmed cases of COVID-19 per million people':'confirmed'})\n\n","0e9df7e9":"fig1 = px.scatter(tests_vs_confirmed, x=\"tested\", y=\"confirmed\", hover_data=['Entity'])\n\nfig1.update_layout(xaxis_type=\"log\", yaxis_type=\"log\", \n                   title_text='Number of people tested per million vs number of positive per million')\n\nfig1.show()","27bd19ae":"\nfrom sklearn.linear_model import RidgeCV,RANSACRegressor\nfrom sklearn.metrics import median_absolute_error, r2_score\n\nX=np.array(tests_vs_confirmed['tested'].apply(np.log1p))\ny=np.array(tests_vs_confirmed['confirmed'].apply(np.log1p))\n\n\n\nregr = RidgeCV()\nregr.fit(X.reshape(-1, 1), y)\n\nX_line=np.linspace(1.0, 10.0, num=10)\n\ny_line = regr.predict(X_line.reshape(-1, 1))\n\nregr1 =  RANSACRegressor(random_state=42,residual_threshold=2.)\n\n\n\n#regr1 = HuberRegressor()\nregr1.fit(X.reshape(-1, 1), y)\n\n\n\ny_line1 = regr1.predict(X_line.reshape(-1, 1))","73a2cad7":"print(\"R2:{} \".format(regr.score(X.reshape(-1, 1),y)))","10b17694":"print(\"R2:{} \".format(regr1.score(X[regr1.inlier_mask_].reshape(-1,1), y[regr1.inlier_mask_])))","dcaabea0":"tests_vs_confirmed[ np.logical_not(regr1.inlier_mask_)]","faecf031":"fig1.add_trace(go.Scatter(\n        x=np.exp(X_line),\n        y=np.exp(y_line1),\n        mode=\"lines\",\n        line=go.scatter.Line(color=\"red\"),\n        showlegend=False))\nfig1.show()","e82aaacf":"populations = pd.read_csv(\"..\/input\/global-population-estimates\/data.csv\")","6301abee":"South_Korea_data=populations[populations['Country Code']==\"KOR\"]\nSouth_Korea_data.head()","c44c21ba":"def WorldBank_to_df(data):\n\n    ages=range(0,80,5)\n\n    code={}\n\n    for c in data['Series Code'].values:\n        code[c]=-1\n\n    for a in ages:\n        code[\"SP.POP.{:02d}{:02d}.MA\".format(a,a+4)]=a\n        code[\"SP.POP.{:02d}{:02d}.FE\".format(a,a+4)]=a\n    code[\"SP.POP.{:02d}UP.MA\".format(80)]=80\n    code[\"SP.POP.{:02d}UP.FE\".format(80)]=80\n    \n    population_data=data[['Series Code','2020 [YR2020]']].copy()\n    population_data=population_data.reindex()\n    population_data['age']=population_data['Series Code'].apply(lambda x: code[x])\n    population_data['sex']=population_data['Series Code'].str[-2:]\n    population_data=population_data.drop(population_data[population_data['age']==-1].index)\n    population_data=population_data.drop(columns='Series Code')\n    population_data=population_data.rename(columns={\"2020 [YR2020]\" : \"population\"})\n    \n    return population_data\n    \n    ","ccdc9bf8":"South_Korea_population_data=WorldBank_to_df(South_Korea_data)\nSouth_Korea_population_data.head()","5994af93":"def population_data_to_age10(data):\n    \n    pop_data=data.copy()\n    \n    pop_data['age10']=pop_data['age'].apply(lambda x: (x\/\/10)*10)\n    pop_data=pop_data[['population','age10']].groupby(['age10']).sum()\n    pop_total=pop_data.sum()\n    pop_data['fraction']=pop_data['population'].apply(lambda x: 100*x\/pop_total)\n\n    \n    return pop_data","b55a4748":"South_Korea_pop_data=population_data_to_age10(South_Korea_population_data)","0520c490":"timeage=pd.read_csv('\/kaggle\/input\/coronavirusdataset\/TimeAge.csv', index_col=\"date\")\ntimeage.head()","f3bee0f8":"South_Korea_latest_timeage=timeage[timeage.index.max()==timeage.index][['age','confirmed','deceased']]\nSouth_Korea_latest_timeage['age']=South_Korea_latest_timeage['age'].apply(lambda x: int(x[:-1]))\nSouth_Korea_latest_timeage=South_Korea_latest_timeage.set_index('age')\n\nSouth_Korea_age_stat=pd.concat([South_Korea_pop_data,South_Korea_latest_timeage],axis=1)\n\nSouth_Korea_age_stat['confirmed_per_million']=1000000*South_Korea_age_stat['confirmed']\/South_Korea_age_stat['population']\nSouth_Korea_age_stat['confirmed_percentage']=100*South_Korea_age_stat['confirmed']\/South_Korea_age_stat['confirmed'].sum(axis=0)\n\nSouth_Korea_age_stat.to_csv('South_Korea_final.csv')\nSouth_Korea_age_stat","cebbccdb":"TimeAge2=pd.read_csv('..\/input\/covid19-confirmed-cases-by-country-and-age\/COVID-19_Age.csv', index_col=\"Date\")","c2b2463f":"def latest_age_data(df,country):\n    tmp=df[df['Country']==country].copy()\n    tmp_timeage=tmp[tmp.index.max()==tmp.index][['Age_start','Positive']]\n    tmp_timeage=tmp_timeage.rename(columns={'Positive':'confirmed','Age_start':'Age'})\n    tmp_timeage=tmp_timeage.set_index('Age')\n    if 90 in tmp_timeage.index:\n        tmp_timeage.loc[80]=tmp_timeage.loc[80]+tmp_timeage.loc[90]\n        tmp_timeage.drop(90,inplace=True)\n    if 100 in tmp_timeage.index:\n        tmp_timeage.loc[80]=tmp_timeage.loc[80]+tmp_timeage.loc[100]\n        tmp_timeage.drop(100,inplace=True)\n    return tmp_timeage\n    ","7da93cf2":"def get_age_stat(country,country_code,populations,TimeAge2):\n    tmp_data=populations[populations['Country Code']==country_code]\n    tmp_age_stat=pd.concat([population_data_to_age10(WorldBank_to_df(tmp_data)),\n                            latest_age_data(TimeAge2,country)],axis=1)\n    tmp_age_stat['confirmed_per_million']=1000000*tmp_age_stat['confirmed']\/tmp_age_stat['population']\n    tmp_age_stat['confirmed_percentage']=100*tmp_age_stat['confirmed']\/tmp_age_stat['confirmed'].sum(axis=0)\n    tmp_age_stat.to_csv(country+'_final.csv')\n    \n    return tmp_age_stat \n    \n    ","87644d42":"Iceland_age_stat=get_age_stat(\"Iceland\",\"ISL\",populations,TimeAge2)\nIceland_age_stat\n","5360fbee":"Norway_age_stat=get_age_stat(\"Norway\",\"NOR\",populations,TimeAge2)\nNorway_age_stat","0edc1f29":"Italy_age_stat=get_age_stat(\"Italy\",\"ITA\",populations,TimeAge2)\nItaly_age_stat","3b4ca4ac":"Danmark_age_stat=get_age_stat(\"Danmark\",\"DNK\",populations,TimeAge2)\nDanmark_age_stat","4b29462a":"Switzerland_age_stat=get_age_stat(\"Switzerland\",\"CHE\",populations,TimeAge2)\nSwitzerland_age_stat","12553736":"fig = go.Figure(data=[\n    go.Bar(name='Norway', x=Norway_age_stat.index, y=Norway_age_stat['confirmed_percentage']),\n    go.Bar(name='Iceland', x=Iceland_age_stat.index, y=Iceland_age_stat['confirmed_percentage']),\n    go.Bar(name='South Korea', x=South_Korea_age_stat.index, y=South_Korea_age_stat['confirmed_percentage']),\n    go.Bar(name='Italy', x=Italy_age_stat.index, y=Italy_age_stat['confirmed_percentage']),\n    go.Bar(name='Danmark', x=Danmark_age_stat.index, y=Danmark_age_stat['confirmed_percentage']),\n    go.Bar(name='Switzerland', x=Switzerland_age_stat.index, y=Switzerland_age_stat['confirmed_percentage'])\n])\n\nfig.update_layout(barmode='group',title_text='Confirmed by age group',\n                 xaxis_title=\"Age group\",\n                 yaxis_title=\"Percentage of cases\")\n\nfig.update_layout(\n    xaxis = dict(\n        tickmode = 'array',\n        tickvals = [0, 10, 20, 30, 40, 50, 60 , 70, 80],\n        ticktext = ['0-9', '10-19', '20-29', '30-39', '40-49', '50-59', '60-69', '70-79', '80+']\n    )\n)\n\n\nfig.update_layout(\n    yaxis = dict(\n        tickmode = 'array',\n        tickvals = [0, 5, 10, 15, 20, 25],\n        ticktext = ['0%', '5%', '10%', '15%', '20%', '25%']\n    )\n)\n\nfig.show()","b274e02c":"\n\nfig = go.Figure(data=[\n    go.Bar(name='Norway', x=Norway_age_stat.index, y=Norway_age_stat['confirmed_per_million']),\n    go.Bar(name='Iceland', x=Iceland_age_stat.index, y=Iceland_age_stat['confirmed_per_million']),\n    go.Bar(name='South Korea', x=South_Korea_age_stat.index, y=South_Korea_age_stat['confirmed_per_million']),\n    go.Bar(name='Italy', x=Italy_age_stat.index, y=Italy_age_stat['confirmed_per_million']),\n    go.Bar(name='Danmark', x=Danmark_age_stat.index, y=Danmark_age_stat['confirmed_per_million']),\n    go.Bar(name='Switzerland', x=Switzerland_age_stat.index, y=Switzerland_age_stat['confirmed_per_million'])\n])\n\nfig.update_layout(barmode='group',title_text='Confirmed cases per million people by age group',\n                 xaxis_title=\"Age group\",\n                 yaxis_title=\"Number of cases per million\")\n\nfig.update_layout(\n    xaxis = dict(\n        tickmode = 'array',\n        tickvals = [0, 10, 20, 30, 40, 50, 60 , 70, 80],\n        ticktext = ['0-9', '10-19', '20-29', '30-39', '40-49', '50-59', '60-69', '70-79', '80+']\n    )\n)\n\nfig.show()\n\n\n","821b8cf8":"The RANSAC seems to perform better and we only have a couple of strong outliers:","87df82f1":"# Population coverage by tests \n\nFirst, let's look at data on the number of confirmed cases v.s. number of tested. This will also allow us to select some \"similar\" cases that we can compare. ","26823261":"Percentage of cases per age group","78bac171":"# Comparison","1ef3282e":"Let us select the countries with a high number of tested people per million and a high number of positives per million. These are South Korea, Norway, Italy and Iceland. It turns out that for all these countries there is also some data on the age distribution of positive cases.","10b9e47e":"Coronavirus 2019 (COVID-19) is an infectuous desease first identified in December 2019 in Wuhan, China.\nThe World Health Organisation (WHO) recognized it as a pandemic on March 11, 2020. \n\nThere has been numerous discussions as to the percentages of infected in different age groups. In particular there is a clame that the [20-29 year-olds could be leading carreers](http:\/\/twitter.com\/DrEricDing\/status\/1239041092978343937). \nThe aim of this notebook to look into this question of number of positive cases by age group. \n\n","a1995e48":"Import libraries","f6dbea1f":"# Switzerland\n\nApply the same operations for Switzerland","543167fc":"# Iceland","3f6a1500":"Function to transform the data from World Bank codes to age groups.","bd5b90c0":"On this log-log plot, where individual points correspond to countries we see that there is a correlation between the number of tested people and the number of positive cases: i.e. the more people per million were tested - the more positive cases were found.","4cd5c587":"# Danmark \nApply the same operations for Danmark.","39d4b2ce":"# Italy\n\nApply the same operations for Italy. ","8d504534":"Import data on the distribution of the number of cases per age group as a function of time. We use only the latest time-stamp.","4a30e527":"Function to change the age groups from multiples of 5 (World Bank) into multiples of 10 (As reported by countries)","343209b3":"# Norway\n\nApply same operations for Norway.","dbe9d01b":"We find that Iceland has the highest number of detected positive cases per million, then come Norway and Danmark, and only after that South Korea and Italy. \n\nWe also see the shapes of the age distributions for Danmark, Iceland and Norway look quite alike: there is a mode around 40-49 and 50-59 respectively, and the rest is lower. However, Norway and Danmark have a second peak for 80+, that Iceland doesn't have. \n\nThe data for Italy seems to have a mode at 80. This could be due to the fact that there, mostly people with severe symptoms were tested, whereas in the other cases the coverage was much more varied.\n\nFinally, the data for South Korea seems close to Norway, if we forget the peak for ages 20-29. Yet the peak is there an obviously requires further investigation to understand its origin. ","3735fb0a":"We can fit this dependance with a simple linear regressor, or a more complicated RANSAC Regressor that is not perturbed by outliers. ","03c4705f":"Apply the same operations for Iceland.","216bce0b":"# South Korea\n\nFirst let's import data on South Korea. We will need the data on the total number of people in different age groups. For this we use World Bank Data.","1eee2677":"What can be somewhat more informative, is the distribution that takes into account the demographics i.e. information on the total number of people in a given age group.","ff1ea7bb":"We make use of data collected by https:\/\/ourworldindata.org\/"}}