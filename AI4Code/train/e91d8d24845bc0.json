{"cell_type":{"ae0fbc18":"code","cdd817ba":"code","dda42604":"code","5f75f5c1":"code","4485720c":"code","b88d3f5f":"code","f33c0ca1":"code","853c62fb":"code","74e6182a":"code","3ea8455c":"code","773da236":"code","af7e7f64":"code","9b30ee64":"code","98c27bfd":"code","c98835c6":"code","4ca03da5":"code","369b1eba":"code","37609ba7":"code","a6a24dff":"code","ea1e5dc3":"code","d9710ff1":"code","36535f83":"code","aeb7252b":"code","f7726a0f":"code","2175a3f6":"markdown","4bb86094":"markdown","0a76459d":"markdown","854a968a":"markdown","7e56c59d":"markdown"},"source":{"ae0fbc18":"# Importing the Packages\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\n\nfrom pathlib import Path","cdd817ba":"# Installing Pytorch 1.6 for FastAI v2\n\n!pip install torch==1.6.0+cu101 torchvision==0.7.0+cu101 -f https:\/\/download.pytorch.org\/whl\/torch_stable.html","dda42604":"# Installing FastAI v2\n\n!pip install -Uqq fastbook\nimport fastbook\nfastbook.setup_book()\n\nfrom fastbook import *","5f75f5c1":"# Checking if cuda is available to make use of GPU\n\nimport torch\nprint(torch.cuda.is_available())\nprint(torch.cuda.get_device_name(0))","4485720c":"# Seed everything\n\ndef seed_everything(seed):\n    random.seed(seed)\n    os.environ['PYTHONHASHSEED'] = str(seed)\n    np.random.seed(seed)\n    torch.manual_seed(seed)\n    torch.cuda.manual_seed_all(seed)\n    torch.cuda.manual_seed(seed)\n    torch.backends.cudnn.deterministic = True\n    \nseed_everything(42)","b88d3f5f":"path = Path(\"..\/input\/aptos2019-blindness-detection\")\npath.ls()","f33c0ca1":"# Let's have a look at the training data\n\ntrain_df = pd.read_csv(path\/\"train.csv\")\nprint(train_df.shape)\ntrain_df.head()","853c62fb":"# The test data does not have any labels that we are going to predict\n\ntest_df = pd.read_csv(path\/\"test.csv\")\nprint(test_df.shape)\ntest_df.head()","74e6182a":"train_path = path\/\"train_images\"\ntrain_path.ls()","3ea8455c":"# Let's have a look at some of the images in the folder\n\nfig = plt.figure(figsize = (10,10))\nrows = 3\ncolumns = 3\nfor i in range(1, rows*columns+1):\n    img = Image.open(train_path.ls()[i])\n    fig.add_subplot(rows, columns, i)\n    plt.imshow(img)\n    \nplt.show()","773da236":"train_df['diagnosis'].value_counts()","af7e7f64":"LABEL_COLS = [0, 1, 2, 3, 4]","9b30ee64":"def get_dls(size, bs):\n    datablock = DataBlock(\n                blocks = (ImageBlock, CategoryBlock(vocab = LABEL_COLS)),\n                get_x = ColReader('id_code', pref = train_path, suff = '.png'),\n                get_y = ColReader('diagnosis'),\n                splitter = RandomSplitter(valid_pct = 0.2, seed= 42),\n                item_tfms = Resize(size)\n    )\n    \n    return datablock.dataloaders(train_df, bs= bs)\n","98c27bfd":"dls = get_dls(224, 64)","c98835c6":"dls.show_batch()","4ca03da5":"dls.valid.show_batch()","369b1eba":"ARCH = densenet121\nquadratic_kappa = CohenKappa(weights = 'quadratic')","37609ba7":"learn = cnn_learner(dls, ARCH, metrics = [accuracy, quadratic_kappa])","a6a24dff":"learn.loss_func","ea1e5dc3":"learn.lr_find()","d9710ff1":"lr = 3e-3\nlearn.fit_one_cycle(10, lr)\nlearn.recorder.plot_loss()","36535f83":"learn.show_results(nrows=3, figsize=(6,8))","aeb7252b":"# Plot Confusion Matrix\n\ninterp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix(normalize = True)","f7726a0f":"# Save the model\n\nlearn.save(\"densenet121-stage-1\")\nlearn = learn.load(\"densenet121-stage-1\")","2175a3f6":"A simple way to think this is that Cohen\u2019s Kappa is a quantitative measure of reliability for two raters that are rating the same thing, corrected for how often that the raters may agree by chance.<br>\n<br>\nCohen suggested the Kappa result be interpreted as follows: values \u2264 0 as indicating no agreement and 0.01\u20130.20 as none to slight, 0.21\u20130.40 as fair, 0.41\u2013 0.60 as moderate, 0.61\u20130.80 as substantial, and 0.81\u20131.00 as almost perfect agreement.\n","4bb86094":"Number of images in train folder is same as number of records in the csv file. We can go ahead with creating DataBunch.","0a76459d":"### Modelling","854a968a":"**If you like it , please upvote :)**","7e56c59d":"There is some imbalance in the classes. For now, we will proceed normally.\n<br> We may try some balancing in the future experiments."}}