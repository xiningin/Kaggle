{"cell_type":{"b295ce1e":"code","348bb0cf":"code","99ef0569":"code","dae1abf0":"code","a52cba6e":"code","ae195ae8":"code","ef679957":"code","f6e6d2e2":"code","53f9b178":"markdown","82beea5e":"markdown","4e8821f7":"markdown","be530699":"markdown","0186b7b9":"markdown","638e15e4":"markdown","46577e59":"markdown","1eccd3d4":"markdown"},"source":{"b295ce1e":"import pandas as pd\ndf=pd.read_csv(\"..\/input\/rainfall-data-from-1901-to-2017-for-india\/Rainfall_Data_LL.csv\")","348bb0cf":"df.head()","99ef0569":"import matplotlib.pyplot as plt\nimport matplotlib.image as mpimg\nimg=mpimg.imread('..\/input\/india-background-map\/india-outline-map_2.jpeg')\n\ndef vis(year,month,df):\n    d=df[df[\"YEAR\"]==year]\n    d.plot(kind='scatter', x='Longitude', y='Latitude', alpha=1,\n                      label='rainfall', figsize=(10,7),\n                      c=month, cmap=plt.get_cmap('hot'), colorbar=True,s=90)\n    plt.imshow(img, extent=[67.4, 98, 6, 38], alpha=1)\n    plt.ylabel(\"Latitude\", fontsize=14)\n    plt.xlabel(\"Longitude\", fontsize=14)\n    plt.legend() \n    plt.show()\nvis(1901,\"JAN\",df)    ","dae1abf0":"import seaborn as sns\ndef trend(df,subdivision):\n    d=df[df[\"SUBDIVISION\"]==subdivision]\n    d=d[[\"YEAR\",\"ANNUAL\"]]\n    sns.set(rc={'figure.figsize':(11.7,8.27)})\n    #sns.scatterplot(data=d, x=\"YEAR\", y=\"ANNUAL\",linewidth = 3,color='r',s=100,alpha=1)\n    sns.regplot(x=\"YEAR\", y=\"ANNUAL\", data=d);\n\ntrend(df,\"Arunachal Pradesh\")\n    ","a52cba6e":"from scipy.optimize import curve_fit\ndef objective(x, a, b):\n    return a * x + b\n\ndef decrease(df,subdivision):\n    d=df[df[\"SUBDIVISION\"]==subdivision]\n    d=d[[\"YEAR\",\"ANNUAL\"]]\n    popt, _ = curve_fit(objective, range(d[\"YEAR\"].shape[0]), d[\"ANNUAL\"])\n    slope, b = popt\n    return slope\n    \ndef all_states(df):\n    a=[]\n    for i in df.SUBDIVISION.unique():\n        a.append([i,decrease(df,i)])\n        \n    \n    d=pd.DataFrame(a,columns=[\"SUBDIVISION\",\"increase in rainfall (mm\/year)\"])\n    \n    return d\n\nChange_rainfall=all_states(df)\ndef highlight_greaterthan(s, column):\n        is_max = pd.Series(data=False, index=s.index)\n        is_max[column] = s.loc[column]>0\n        return ['background-color: #e6ffe6' if is_max.any() else 'background-color: #ffe6e6' for v in is_max]\ndisplay(Change_rainfall.style.apply(highlight_greaterthan, column=['increase in rainfall (mm\/year)'], axis=1))","ae195ae8":"import matplotlib.pyplot as plt\nimport matplotlib.image as mpimg\nimport numpy as np\ndef vis_change(df,Change_rainfall):\n    d=Change_rainfall.merge(df[[\"SUBDIVISION\",\"Latitude\",\"Longitude\"]],on=\"SUBDIVISION\",how=\"inner\").drop_duplicates(subset=\"SUBDIVISION\",keep=\"last\").reset_index(drop=True)\n    colors = np.where(d[\"increase in rainfall (mm\/year)\"]<0, 'C0', 'C1')\n\n    d.plot(kind='scatter', x='Longitude', y='Latitude', alpha=1\n                      , figsize=(10,7),c=colors.ravel()\n                      ,s=90)\n    \n    plt.imshow(img, extent=[67.4, 98, 6, 38], alpha=1)\n    plt.ylabel(\"Latitude\", fontsize=14)\n    plt.xlabel(\"Longitude\", fontsize=14)\n    plt.legend() \n    plt.show()\n\nvis_change(df,Change_rainfall)","ef679957":"from sklearn.svm import SVC\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn import svm, datasets\n\nd=Change_rainfall.merge(df[[\"SUBDIVISION\",\"Latitude\",\"Longitude\"]],on=\"SUBDIVISION\",how=\"inner\").drop_duplicates(subset=\"SUBDIVISION\",keep=\"last\").reset_index(drop=True)\nd[\"class\"]=1\nd.loc[d[\"increase in rainfall (mm\/year)\"]<0,\"class\"]=0\n# Select 2 features \/ variable for the 2D plot that we are going to create.\nX = d[[\"Longitude\",\"Latitude\"]].values\ny = d[\"class\"].values\n\ndef make_meshgrid(x, y, h=.02):\n    x_min, x_max = 67.4,98\n    y_min, y_max = 6, 38\n    xx, yy = np.meshgrid(np.arange(x_min, x_max, h), np.arange(y_min, y_max, h))\n    return xx, yy\n\ndef plot_contours(ax, clf, xx, yy, **params):\n    Z = clf.predict(np.c_[xx.ravel(), yy.ravel()])\n    Z = Z.reshape(xx.shape)\n    out = ax.contourf(xx, yy, Z, **params)\n    return out\n\nmodel = svm.SVC(kernel='poly')\nclf = model.fit(X, y)\n\nfig, ax = plt.subplots()\n# title for the plots\ntitle = ('Decision surface of linear SVC ')\n# Set-up grid for plotting.\nX0, X1 = X[:, 0], X[:, 1]\nxx, yy = make_meshgrid(X0, X1)\nplt.imshow(img, extent=[67.4, 98, 6, 38], alpha=1)\nplot_contours(ax, clf, xx, yy, cmap=plt.cm.coolwarm, alpha=0.8)\nax.scatter(X0, X1, c=y, cmap=plt.cm.coolwarm, s=20, edgecolors='k')\nax.set_ylabel('y label here')\nax.set_xlabel('x label here')\nax.set_xticks(())\nax.set_yticks(())\nax.set_title(title)\nax.legend()\nplt.show()","f6e6d2e2":"from sklearn.cluster import KMeans\nmonths=[x for x in df.columns if len(x)==3]\ndf.loc[:,~df.columns.str.contains(\"-\")]\n\ndef class_names(d):\n    m=d[\"rainfall\"].idxmax()\n    mc=d.at[m,\"class\"]\n    mon=d.at[m,\"month\"]\n    d.loc[d[\"class\"]==mc,\"class\"]=\"monsoon\"\n    d.loc[(d[\"month\"]<mon) & (d[\"class\"]!=\"monsoon\"),\"class\"]=\"pre monsoon\"\n    d.loc[(d[\"month\"]>mon) & (d[\"class\"]!=\"monsoon\"),\"class\"]=\"post monsoon\"\n    return d\n    \ndef month_trend(year,df,subdivision):\n    months=[x for x in df.columns if len(x)==3]\n    d=df[(df[\"YEAR\"]==year) & (df[\"SUBDIVISION\"]==subdivision)]\n    d=(d[months].T)\n    d.columns=[\"rainfall\"]\n    d[\"month\"]=list(range(1,13))\n    d1=[list(d[\"rainfall\"]),list(d[\"month\"])]\n    d1=np.array(d)\n    kmeans = KMeans(n_clusters=3)\n    kmeans.fit(d1)\n    y_kmeans = kmeans.predict(d)\n    d[\"class\"]=y_kmeans\n    d=class_names(d)\n    sns.scatterplot(data=d, x=\"month\", y=\"rainfall\",linewidth = 3,color='r',s=100,alpha=1,hue=\"class\")\n\nmonth_trend(2003,df,\"Kerala\")","53f9b178":"## Using SVM to draw a decision boundary between the 2 classes\n\nFitting a polynomial decision boundary between states that have a positive slope and negative slope.","82beea5e":"## plotting Increase\/Decrease for all Subdivisions","4e8821f7":"## Clustering to find monsoon months\nUsing k-means clustering to find 3 clusters. The cluster with the max rainfall month will represent the months in monsoon season.","be530699":"**Blue represent States which have a positive slope (increase in rainfall), red represent location with negative slope**","0186b7b9":"## Rate for all Subdivisions\n","638e15e4":"## Heatmap plot \nlocation closer to the himalayas recieve more rainfall compared to the distant states","46577e59":"## Decrease or Increase in Rainfall over the years\n\nSlope of the best fit line will give us the rate of decrease in annual rainfall in (mm\/year).","1eccd3d4":"# India Rainfall Analysis\n\nHere we have Rainfall data for 100 years, data includes monthly rainfall in mm for all the states and union territories of india. \n\nThough we could work out a time series prediction model but given the small number of datapoints and the variability in the data, the accuracy will not be good enough.\n\nHere I have worked out some simple analyses that could be done to dig out usefull information about the patterns of rainfall here in India"}}