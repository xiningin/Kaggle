{"cell_type":{"c078c8fb":"code","6a8cd9d5":"code","a7d7b6df":"code","ddfbdc36":"code","44ea25d3":"code","d8a94492":"code","ac8d9962":"code","5ca0e3a2":"code","b1a88cac":"code","c12643ac":"code","5e17ecc2":"code","08d869ec":"code","b9534c02":"code","88829e4c":"code","c7e5d5be":"code","48c91737":"code","3a1b9a3c":"code","55fa187a":"code","a2cbd410":"code","2f493556":"markdown","ae48c3be":"markdown","c4080ff0":"markdown","650e0b84":"markdown","0e35d4cb":"markdown","ec0a2321":"markdown","486f3c91":"markdown","b399ebae":"markdown","a8da6513":"markdown","160e0b44":"markdown","457f0722":"markdown","b5e4a5d1":"markdown","94d6df43":"markdown","7bcf9eb1":"markdown","e51820da":"markdown","8dd64476":"markdown"},"source":{"c078c8fb":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport statsmodels.api as sm\nimport seaborn as sns\nfrom sklearn.preprocessing import OrdinalEncoder, RobustScaler\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import KFold, train_test_split, cross_val_score, GridSearchCV\nfrom sklearn.pipeline import Pipeline\nfrom scipy import stats\nfrom scipy.stats import norm\nfrom tqdm.notebook import tqdm\nimport warnings\nwarnings.filterwarnings('ignore')\nplt.style.use('ggplot')\nimport os\nprint(os.listdir(\"..\/input\/bank-marketing-dataset\"))","6a8cd9d5":"df = pd.read_csv('..\/input\/bank-marketing-dataset\/bank.csv')\ndf = df.rename(columns={'deposit': 'y'})\ndf.head(10)","a7d7b6df":"df['y'].value_counts().plot.bar()\nplt.ylabel('Count')\nplt.show()","ddfbdc36":"categorical_cols = ['job', 'marital', 'education', 'default', 'housing', 'loan', 'contact', 'month','poutcome']\nfig, axes = plt.subplots(nrows=3, ncols=3, figsize=(20,20))\nfor i, col in enumerate(categorical_cols):\n    row_index = (i % 3)\n    col_index = int(i \/ 3)\n    fig.add_subplot(df[col].value_counts().plot.bar(ax=axes[row_index, col_index], title=col))","44ea25d3":"numerical_cols = ['balance', 'day','duration', 'campaign', 'pdays', 'previous']\nfig, axes = plt.subplots(nrows=3, ncols=2, figsize=(20,20))\nfor i, col in enumerate(numerical_cols):\n    row_index = (i % 3)\n    col_index = i \/\/ 3\n    fig.add_subplot(df[col].value_counts().plot.hist(ax=axes[row_index, col_index], title=col))","d8a94492":"data = df[['age', 'y']]\ndata['y'] = data['y'].apply(lambda y: 1 if y == 'yes' else 0)\ndata = data.groupby('age')['y'].mean() * 100\ndata.plot.bar(figsize=(15, 5), title='Success Rate x Age')\nplt.ylabel('Success Rate (%)')\nplt.show()","ac8d9962":"data = df[df['y'] == 'yes'].groupby(df['job'])\nN = 12\ndata['job'].count().nlargest(N).plot.bar(figsize=(15, 5),\n                                           title='Number of subscriptions per Job')\nplt.grid(True)\nplt.ylabel(\"Number of Subscriptions\")\nplt.xlabel(\"Job\")\nplt.show()","5ca0e3a2":"data = df[df['y'] == 'yes'].groupby(df['marital'])\nN = 3\ndata['marital'].count().nlargest(N).plot.bar(figsize=(15, 5),\n                                           title='Number of subscriptions per Marital')\nplt.ylabel(\"Number of Subscriptions\")\nplt.show()\nprint('Proportion from the biggest number to the second one: {}'.format(\n      data['marital'].count().nlargest(N)[0] \/ data['marital'].count().nlargest(N)[1]))","b1a88cac":"data = df.copy()\ndata['loan'] = data['loan'].apply(lambda x: 1 if x == 'yes' else 0)\ndata['housing'] = data['housing'].apply(lambda x: 1 if x == 'yes' else 0)\ndata['default'] = data['default'].apply(lambda x: 1 if x == 'yes' else 0)\ndata['y'] = data['y'].apply(lambda x: 1 if x == 'yes' else 0)\ndata = pd.get_dummies(data)","c12643ac":"sns.distplot(df['duration'], fit=norm);\nfig = plt.figure()\nres = stats.probplot(df['duration'], plot=plt)","5e17ecc2":"# The data is not in a normal distribution, so let's transform it\ndata['duration'] = np.log(data['duration'] + 1)\nsns.distplot(data['duration'], fit=norm);\nfig = plt.figure()\nres = stats.probplot(data['duration'], plot=plt)","08d869ec":"sns.distplot(data['age'], fit=norm)\nfig = plt.figure()\nres = stats.probplot(data['age'], plot=plt)","b9534c02":"# The data is not in a normal distribution, so let's transform it\ndata['age'] = np.log(data['age'])\nsns.distplot(data['age'], fit=norm)\nfig = plt.figure()\nres = stats.probplot(data['age'], plot=plt)","88829e4c":"sns.distplot(data['balance'], fit=norm)\nfig = plt.figure()\nres = stats.probplot(data['balance'], plot=plt)","c7e5d5be":"y_train = data['y']\ndata = data.drop(columns=['y'])","48c91737":"def model_scores(model):\n    kf = KFold(n_folds, shuffle=True).get_n_splits(data.values)\n    score = cross_val_score(model, data.values, y_train, scoring='accuracy', cv = kf, n_jobs=-1)\n    return(score)","3a1b9a3c":"params = {\n    'n_estimators':[50, 100, 150, 200, 250],\n    'max_depth': [None, 2, 3, 4, 5]\n}\nforest = Pipeline([('scaler', RobustScaler()),\n                   ('model', GridSearchCV(RandomForestClassifier(n_jobs=-1), params))])\nparams = {'kernel':('linear', 'rbf'), 'C':range(1, 10)}\nsvc = Pipeline([('scaler', RobustScaler()),\n                ('model', GridSearchCV(SVC(class_weight='balanced', max_iter=1000, gamma='scale'), params))])\nparams = {'n_neighbors' : range(3, 10)}\nknn = Pipeline([('scaler', RobustScaler()),\n                ('model', GridSearchCV(KNeighborsClassifier(n_jobs=-1), params))])\nlogistic = Pipeline([('scaler', RobustScaler()), ('model', LogisticRegression(class_weight='balanced', n_jobs=-1))])\n\nmodels = [forest, svc, knn, logistic]\nn_folds = 5","55fa187a":"scores = [model_scores(model) for model in tqdm(models)]","a2cbd410":"precision = [np.mean(score) for score in scores]\nfinal_precision = max(precision)\nprint('Final model accuracy-score: {:.2f}%'.format(final_precision))","2f493556":"With this plot, we can conclude that older people tend to have higher chance tp subscribe to a term deposit. Also, young people can also have a high chance to subscribe, which reduces as the person gets older and get stabilize at 30 years old, growing again only after the 60 years.","ae48c3be":"## Analyzing the influence of the age\n\nTo check how the age influence the 'y', we can calculate the success rate (number of 'yes' divided by number of 'no') for each age and plot it","c4080ff0":"Married people have a higher number of subscriptions (almost 70% bigger than single), followed by single and divorced (in last).","650e0b84":"As we can see, this plot shows that 'jobs' with a possible economical stability have a higher number of subscriptions, as 'management', 'technician', 'blue-collar' and 'admin'. ","0e35d4cb":"## Defining the model\n\nFor this study, we will test the acuraccy of some classifiers, like RandomForest, kNN, SVC and LogistcRegression.\n\nOur final model will be the best between those","ec0a2321":"As we can see, this dataset have a lot of categorical features.\n\nTo begin our study, we should have a look at the 'y' distribution.","486f3c91":"The plot shows that there are a considerable unbalance between the classes, our model should consider that.\n\nNow, let's check the categorical columns","b399ebae":"## Imports","a8da6513":"## Preprocessing the data\n\nNow, we could analyze the correlation of the variables to have a better knowledge of how much each one is important to predict 'y'.\n\nFirst, we need to transform the categorical column into numerical:","160e0b44":"## Analyzing the influence of the marital\n\nWe will apply the same logic as before","457f0722":"## Analyzing the influence of the job\n\nWith a similar analysis, we can plot the number of 'yes' per job","b5e4a5d1":"Now, let's check the skewness of the numerical values","94d6df43":"For each model, we will perform a grid search, for the best parameters, and then perform a 5-Fold Cross Validation, shuffling the data for each fold","7bcf9eb1":"Balance has a lot of zero values, so let's keep it for this study.\n\nFinally, separating the 'y' column:","e51820da":"# Bank Marketing Dataset\n\nThis dataset contains information about a Portuguese bank marketing campaign. It's goal is to predict if the client will subscribe to a term deposit, indicated by the variable 'y'.\n\nMore information about this database can be found at: https:\/\/archive.ics.uci.edu\/ml\/datasets\/Bank+Marketing","8dd64476":"## Opening database"}}