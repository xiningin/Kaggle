{"cell_type":{"ff3a1681":"code","af3601b8":"code","1f4d94b8":"code","bebe09c3":"code","27bc28b7":"code","c59b54b6":"code","ecf00673":"code","ba2a6334":"code","5ece85ed":"code","290fb581":"code","01d0206a":"code","482ec41f":"code","cb60cdaf":"code","8b5e0b1c":"code","9729d9b0":"code","f92250b4":"code","674b1b5e":"code","d911803c":"markdown","6a8ed340":"markdown","a212d7d9":"markdown","38707d4f":"markdown","50d49ea4":"markdown"},"source":{"ff3a1681":"%matplotlib inline\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nimport plotly.graph_objs as go\ninit_notebook_mode(connected=True)\nfrom matplotlib import pyplot as plt\nfrom plotly import tools","af3601b8":"data_df = pd.read_csv(\"..\/input\/train.csv\")\ntest_df = pd.read_csv(\"..\/input\/test.csv\")\n\ndef print_numbers(df, category):\n    print('%s Data containing %d fields provided for %d individuals of %d families'\n          %(category, df.shape[1], df.shape[0], len(np.unique(df['idhogar']))))\n    \nprint_numbers(data_df, 'Training')\nprint_numbers(test_df, 'Testing')","1f4d94b8":"data_df.head()","bebe09c3":"topnan_train = data_df.isnull().sum().sort_values(0, ascending = False)\/(data_df.shape[0])*100\nprint(\"Field Name   %NaN\")\nprint(topnan_train.head())","27bc28b7":"def remove_strings(val):\n    \"\"\"Converts strings to boolean values\"\"\"\n    if not isinstance(val, str):\n        return val\n    if val.lower() == \"yes\":\n        return 1\n    else:\n        return 0","c59b54b6":"# Making data numerical for easier computations\n# data_df['idhogar'] = data_df['idhogar'].apply(hash)         \ndata_df['dependency'] = data_df['dependency'].apply(remove_strings)\ndata_df['edjefe'] = data_df['edjefe'].apply(remove_strings)\ndata_df['edjefa'] = data_df['edjefa'].apply(remove_strings)","ecf00673":"# Deleting columns with very less data\ndrop_column_list = ['rez_esc', 'v18q1', 'v2a1']\ndata_df.drop(drop_column_list, axis=1, inplace=True)\n\n# Deleting Id too, it is unique per row, hence not useful for classification\ndel data_df['Id']\n\n# Dropping duplicate columns\ndata_df = data_df.T.drop_duplicates().T\n\n# Replacing missing data with mean\ndata_df.fillna(data_df.mean(), inplace=True) ","ba2a6334":"# Dictionary showing way(s) to aggregate each type of column\n# We have taken mean for data that should be same across household (e.g bedrooms)\naggregation_dict = {'SQBage': ['mean'],\n 'SQBdependency': ['mean'],\n 'SQBedjefe': ['mean'],\n 'SQBescolari': ['mean', 'sum'],\n 'SQBhogar_nin': ['mean'],\n 'SQBhogar_total': ['mean'],\n 'SQBmeaned': ['mean'],\n 'SQBovercrowding': ['mean'],\n 'abastaguadentro': ['mean'],\n 'abastaguafuera': ['mean'],\n 'abastaguano': ['mean'],\n 'age': ['mean', 'sum', 'min', 'max'],\n 'agesq': ['mean'],\n 'area1': ['mean'],\n 'area2': ['mean'],\n 'bedrooms': ['mean'],\n 'cielorazo': ['mean'],\n 'computer': ['mean'],\n 'coopele': ['mean'],\n 'dependency': ['mean'],\n 'dis': ['sum'],\n 'edjefa': ['mean'],\n 'edjefe': ['mean'],\n 'elimbasu1': ['mean'],\n 'elimbasu2': ['mean'],\n 'elimbasu3': ['mean'],\n 'elimbasu4': ['mean'],\n 'elimbasu5': ['mean'],\n 'elimbasu6': ['mean'],\n 'energcocinar1': ['mean'],\n 'energcocinar2': ['mean'],\n 'energcocinar3': ['mean'],\n 'energcocinar4': ['mean'],\n 'epared1': ['mean'],\n 'epared2': ['mean'],\n 'epared3': ['mean'],\n 'escolari': ['mean', 'max', 'sum'],\n 'estadocivil1': ['sum'],\n 'estadocivil2': ['sum'],\n 'estadocivil3': ['sum'],\n 'estadocivil4': ['sum'],\n 'estadocivil5': ['sum'],\n 'estadocivil6': ['sum'],\n 'estadocivil7': ['sum'],\n 'etecho1': ['mean'],\n 'etecho2': ['mean'],\n 'etecho3': ['mean'],\n 'eviv1': ['mean'],\n 'eviv2': ['mean'],\n 'eviv3': ['mean'],\n 'female': ['sum'],\n 'hacapo': ['mean'],\n 'hacdor': ['mean'],\n 'hhsize': ['mean'],\n 'hogar_adul': ['mean'],\n 'hogar_mayor': ['mean'],\n 'hogar_nin': ['mean'],\n 'hogar_total': ['mean'],\n#  'idhogar': ['mean'],\n 'instlevel1': ['mean', 'sum'],\n 'instlevel2': ['mean', 'sum'],\n 'instlevel3': ['mean', 'sum'],\n 'instlevel4': ['mean', 'sum'],\n 'instlevel5': ['mean', 'sum'],\n 'instlevel6': ['mean', 'sum'],\n 'instlevel7': ['mean', 'sum'],\n 'instlevel8': ['mean', 'sum'],\n 'instlevel9': ['mean', 'sum'],\n 'lugar1': ['mean'],\n 'lugar2': ['mean'],\n 'lugar3': ['mean'],\n 'lugar4': ['mean'],\n 'lugar5': ['mean'],\n 'lugar6': ['mean'],\n 'male': ['sum'],\n 'meaneduc': ['mean'],\n 'mobilephone': ['mean'],\n 'noelec': ['mean'],\n 'overcrowding': ['mean'],\n 'paredblolad': ['mean'],\n 'pareddes': ['mean'],\n 'paredfibras': ['mean'],\n 'paredmad': ['mean'],\n 'paredother': ['mean'],\n 'paredpreb': ['mean'],\n 'paredzinc': ['mean'],\n 'paredzocalo': ['mean'],\n 'parentesco1': ['sum'],\n 'parentesco10': ['sum'],\n 'parentesco11': ['sum'],\n 'parentesco12': ['sum'],\n 'parentesco2': ['sum'],\n 'parentesco3': ['sum'],\n 'parentesco4': ['sum'],\n 'parentesco5': ['sum'],\n 'parentesco6': ['sum'],\n 'parentesco7': ['sum'],\n 'parentesco8': ['sum'],\n 'parentesco9': ['sum'],\n 'pisocemento': ['mean'],\n 'pisomadera': ['mean'],\n 'pisomoscer': ['mean'],\n 'pisonatur': ['mean'],\n 'pisonotiene': ['mean'],\n 'pisoother': ['mean'],\n 'planpri': ['mean'],\n 'public': ['mean'],\n 'qmobilephone': ['mean'],\n 'r4h1': ['mean'],\n 'r4h2': ['mean'],\n 'r4h3': ['mean'],\n 'r4m1': ['mean'],\n 'r4m2': ['mean'],\n 'r4m3': ['mean'],\n 'r4t1': ['mean'],\n 'r4t2': ['mean'],\n 'r4t3': ['mean'],\n 'refrig': ['mean'],\n 'rooms': ['mean'],\n 'sanitario1': ['mean'],\n 'sanitario2': ['mean'],\n 'sanitario3': ['mean'],\n 'sanitario5': ['mean'],\n 'sanitario6': ['mean'],\n 'tamhog': ['mean'],\n 'tamviv': ['mean'],\n 'Target': ['max'],\n 'techocane': ['mean'],\n 'techoentrepiso': ['mean'],\n 'techootro': ['mean'],\n 'techozinc': ['mean'],\n 'television': ['mean'],\n 'tipovivi1': ['mean'],\n 'tipovivi2': ['mean'],\n 'tipovivi3': ['mean'],\n 'tipovivi4': ['mean'],\n 'tipovivi5': ['mean'],\n 'v14a': ['mean'],\n 'v18q': ['mean'],\n                   }\n\npop_list = list( set(aggregation_dict.keys()) - set(data_df.columns)) \n\nfor key in pop_list:\n    aggregation_dict.pop(key)","5ece85ed":"# Cross checking assumption of same data across household (where we are taking mean).\n#NoAssumptions #WeBelieveInCrossChecking #Hash\nfor column_name, agg in aggregation_dict.items():\n    if 'mean' in agg:\n        s1 = data_df.groupby(['idhogar', column_name])\n        s2 = data_df.groupby(['idhogar'])\n        \n        if len(s1)!=len(s2):\n            print (column_name, len(s1), len(s2))\n\n# All the households were expected to have different values for all the ones printed below.","290fb581":"family_data_df = data_df.groupby('idhogar', as_index=True).agg(aggregation_dict).reset_index()\nprint (\"Length of new dataframe(number of families): \" + str(len(family_data_df)))\nfamily_data_df.columns = [\"_\".join(x) for x in family_data_df.columns.ravel()]\nfamily_data_df.head()","01d0206a":"target_sizes = data_df.groupby('Target').size()\n\npoverty_levels_dict = {'1': 'extreme poverty' ,'2':'moderate poverty' ,\n'3' : 'vulnerable households', '4': 'non vulnerable households'}\ngroups = target_sizes.index.values.astype(str)\nlabels  = [poverty_levels_dict[group] for group in groups]\n\nfig = {\n  \"data\": [\n    {\n      \"values\": target_sizes.values,\n      \"labels\": labels,\n      #\"domain\": {\"x\": [0, .48]},\n      \"name\": \"GHG Emissions\",\n      \"hoverinfo\":\"label+percent+name\",\n        \"textfont\": dict(size=12),\n      \"type\": \"pie\"\n    },\n    ],\n       'layout': {'title': 'Distribution of different poverty classes'}\n}\niplot(fig, filename='donut')","482ec41f":"target_sizes.values","cb60cdaf":"grouped_houses_data = data_df.groupby('idhogar', as_index=False)\n\n\nfig = {\n    'data': [\n        {\n            'labels': [\"Households who doesn't have a tablet\", \"Households who have a tablet\"],\n            'values': (grouped_houses_data['v18q'].mean())['v18q'].value_counts().sort_index(),\n            'type': 'pie',\n            'hole': 0.45,\n            'domain': {'x': [0, .33],\n                      'y': [0, .5]},\n            'hoverinfo':'label+percent+name',\n            'textinfo':'none'\n        },\n        {\n            'labels': [\"Households who doesn't have a refrigerator\", \"Households who have a refrigerator\"],\n            'values': (grouped_houses_data['refrig'].mean())['refrig'].value_counts().sort_index(),\n            'type': 'pie',\n            'hole': 0.45,\n            'domain': {'x': [.34, 0.66],\n                       'y': [0, .5]},\n            'hoverinfo':'label+percent+name',\n            'textinfo':'none'\n\n        },\n        {\n            'labels': [\"Households who doesn't have a toilet\", \"Households who have a toilet\"],\n            'values': (grouped_houses_data['v14a'].mean())['v14a'].value_counts().sort_index(),\n            'type': 'pie',\n            'hole': 0.45,\n            'domain': {'x': [0.67, 1],\n                       'y': [0, 0.5]},\n            'hoverinfo':'label+percent+name',\n            'textinfo':'none'\n        },\n        {\n            'labels': [\"Households who doesn't have a television\", \"Households who have a television\"],\n            'values': (grouped_houses_data['television'].mean())['television'].value_counts().sort_index(),\n            'type': 'pie',\n            'hole': 0.45,\n            'domain': {'x': [0, 0.33],\n                       'y': [.51, 1]},\n            'hoverinfo':'label+percent+name',\n            'textinfo':'none'\n        },\n        {\n            'labels': [\"Households who doesn't have a computer\", \"Households who have a computer\"],\n            'values': (grouped_houses_data['computer'].mean())['computer'].value_counts().sort_index(),\n            'type': 'pie',\n            'hole': 0.45,\n            'domain': {'x': [.34, 0.66],\n                       'y': [.51, 1]},\n            'hoverinfo':'label+percent+name',\n            'textinfo':'none'\n        },\n        {\n            'labels': [\"Households who doesn't have a mobilephone\", \"Households who have a mobilephone\"],\n            'values': (grouped_houses_data['mobilephone'].mean())['mobilephone'].value_counts().sort_index(),\n            'type': 'pie',\n            'hole': 0.45,\n            'domain': {'x': [.67, 1],\n                       'y': [.51, 1]},\n            'hoverinfo':'label+percent+name',\n            'textinfo':'none'\n        }\n    ],\n    'layout': {'title': 'Households having different amenties or not',\n               'annotations': [{'text': 'Television', 'showarrow': False, 'x': 0.125, 'y': 0.77, 'font': {'size': 16}},\n                               {'text': 'Computer', 'showarrow': False, 'x': 0.5, 'y': 0.77, 'font': {'size': 16}},\n                               {'text': 'Mobilephone', 'showarrow': False, 'x': 0.9, 'y': 0.77, 'font': {'size': 16}},\n                               {'text': 'Tablet', 'showarrow': False, 'x': 0.13, 'y': 0.23, 'font': {'size': 16}},\n                               {'text': 'Refrigerator', 'showarrow': False, 'x': 0.5, 'y': 0.23, 'font': {'size': 16}},\n                               {'text': 'Toilet', 'showarrow': False, 'x': 0.865, 'y': 0.23, 'font': {'size': 16}}\n                              ], \n               'showlegend': False,\n               'width': 1000,\n               'height':1000}\n}\n\n\niplot(fig)","8b5e0b1c":"fig = tools.make_subplots(rows=2, cols=2, print_grid=False, subplot_titles=['Bedrooms','Rooms', 'Total household Members', '# Persons Per Room'])\n\nx = (grouped_houses_data['bedrooms'].mean())['bedrooms']\ntr1 = go.Histogram(x = x, showlegend=True)\nfig.append_trace(tr1,1,1)\n\n\nx = (grouped_houses_data['rooms'].mean())['rooms']\ntr1 = go.Histogram(x = x, showlegend=True)\nfig.append_trace(tr1,1,2)\n\nx = (grouped_houses_data['tamhog'].mean())['tamhog']\ntr1 = go.Histogram(x = x, showlegend=True)\nfig.append_trace(tr1,2,1)\n\nx = (grouped_houses_data['overcrowding'].mean())['overcrowding']\ntr1 = go.Histogram(x = x, showlegend=True)\nfig.append_trace(tr1,2,2)\n\nfig['layout'].update(height=900, title=\"Household Members\/ rooms\", barmode=\"stack\", showlegend=False)\niplot(fig)","9729d9b0":"grouped_houses_data.apply(np.mean)","f92250b4":"region_fields = ['lugar1', 'lugar2', 'lugar3', 'lugar4', 'lugar5', 'lugar6']\nlabels  = ['Central', 'Chorotega', 'Pacifico central', 'Brunca', 'Huetar Atlantica', 'Huetar Norte']\nfig = {\n    'data':[{\n        'values': (grouped_houses_data[region_fields].mean())[region_fields].sum().values,\n        'labels': labels,\n        'name': 'Regions',\n        'hoverinfo': 'label+percent+name',\n        'textfont': dict(size=12),\n        'type': 'pie'\n    }],\n    'layout': {\n        'title': 'Distributions of household in different regions'\n    }\n}\n\niplot(fig)","674b1b5e":"fig = {\n    'data':[{\n        'values': (grouped_houses_data['area1'].mean())['area1'].value_counts().sort_index(),\n        'labels': [\"Households in rural area\", \"Households in urban area\"],\n        'name': 'Regions',\n        'hoverinfo': 'label+percent+name',\n        'textfont': dict(size=12),\n        'type': 'pie'\n    }],\n    'layout': {\n        'title': 'Distributions of household in rural\/ urban regions'\n    }\n}\n\niplot(fig)","d911803c":"### Missing values\nTop fields with missing values: (Just 3 fields with majority of the data missing)\n1. rez_esc, Years behind in school \n2. v18q1, number of tablets household owns\n3. v2a1, Monthly rent payment","6a8ed340":"\n### Costa Rica\nCosta Rica is a Central American nation with a population of 4.9 Million population. It has been known for its stable democracy, in a region that has had some instability. As per a report by the National Statistics and Census Institute (INEC) in 2015, more than 1.1 million Costa Ricans lived in poverty, According to data from the National Household Survey of the National Institute of Statistics and Census, the percentage of poor households in Costa Rica went from 20.5  to 20 percent between 2016 and 2017, and extreme poverty dropped from 6.3 percent to 5.7 percent. \n\n### IDB \nInter-American Development Bank (IDB) works in Latin America and the Caribbean region to improve the general life conditions of the population. financial and technical support for countries working to reduce poverty and inequality, they help improve health and education, and advance infrastructure.\n\n### Proxy Means Testing \nIn any social program, it is always tough to make sure that the aid goes to the deserving. The poorest segment of the population usually is unable to provide the necessary income and expense records to prove that they qualify. This is where proxy means testing (PMT) comes into the picture. The key idea  is to use observable characteristics of the household or the members to estimate their incomes or consumption, when other income data (salary slips, tax returns) are unavailable or sketchy. More details about PMT can be found in [this report](https:\/\/olc.worldbank.org\/sites\/default\/files\/1.pdf).\n\n### About the competetion\nThis dataset provided by IADB has the 142 fields of labelled data for 2988 households in the training set and 7352 in the test set. Of these,  8% fall in the extremely poor category. The goal is to maximize the f1 score (harmonic mean of precision and recall) across all the categories. A generalized solution which can build on the above metrics would be helpful to IDB and other institutions working towards helping the economically weaker sections of the society.\n\n![Costa Rica](https:\/\/raw.githubusercontent.com\/InFoCusp\/kaggle_images\/master\/costa_rica.jpg)","a212d7d9":"### Some samples from the data\n\nIt is important to note here that there are multiple entries - one for each member of the household and some of the fields common to all members of the household such as #rooms, material of the house, total members in the house, etc. can be eassily collapsed till we have one row per house.","38707d4f":"Work in progress, more cool stuff coming up soon.. \n![](data:image\/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK0AAAC2CAMAAACcYP0pAAAAY1BMVEX\/\/\/85V5pyh7dVb6jj5\/BDX55AXJ2Qoca5w9tof7Lv8fdddqw9WZvAyt\/8\/P3Gz+LM1OWaqctKZqL19\/rY3ux7j7yXp8rq7fSxvdeKnMPd4u1YcamkstGsuNVNaKRuhLWAk74kkUFCAAADm0lEQVR4nO2cbXeyMAyGh8IUYYCKPr7r\/\/+Vz0THENuiJEvKOff12dNdw5KmTerHBwAAAAAAAAAAAAAAAAAusnw+nxb\/tDVeI4yDinQ\/KbVdOsmS4Je40NbpYB08MNf2cVIGLQ7aRi6Stq3Puk+P9ht\/37WtwfasLWUjiwy2ga+BITfJBiNtLQtzo22krWVhZLQNdtpeZk5m2422l5GZWTaYaIsZ+bLY+vmarS22sbaYkdhim2iLmcg+LbZ7bTMThUU2GGubmTAlCd7O26UxSbhy0VYzcLTJ+riBWC6sth6uZdZZ62PKuLHLBjNtuTa2RfeKd4tDYVsYrqy17VqE1uB1xbP0djl2yXq2NmRnl2zwpe33yMQp61lKM3XKevZoS1c48C18zZxvmGfrWGbbL9zxKyBc3LJBri3Y5NAhu8i0DRvkaYetiXSRrKYKic7OueC6lbfSvl3hwE00FZXtCgediOZmXeGgG8HzMXd28BpiGzbbmddbpDKpb0afBhUip4\/Fc1msJ8Q0Ir8kYwPxNvz5xO5iOQLvA+1Fs7870T1R\/XJniG9COtBzbbSjquXAvWF8H8qS5gz4VcXWXGTqDyUqOB\/c6vqJFbMt5TVzDlyFG0tJrDeUmrW8bdil5JXtcki2pC2xuC1pdRC3Ja280ra0sxFpW9qxk7AtMWGUtT0R972yttRWMVnb1aBsqedOsrbU+omwLfEEUtiWeJ4AWwfEgzth22HN20GtZdTuIFlb6gGuqG1K2UGK21LTBFHbiHw5RtKWfrVA0pbeJSZpexmULb0XQNJ2MShbegtLc7QoblVGmW3p9ZyG6zWbC+On4fls6ZXIeqj0dgr8UMtltqUXIp\/+8fDvbKlZQsO2zpMbc5fXlqEMWY9VlwPi1vhstgx9YvVY9Y6pUeVhtR0zdNzUg\/10RjUb6ThtPznuH\/4Od8vry2YBjdOWpTOhMV48LfPJQ08Soy05EW\/bPsNoy3OnALawveHslGCsofN0rjn7ZaoHwtOfwNOrZL8Z9B3Qqz8RcjSqpEyto\/YvOr0H9E2fvtAWbI1Vx8T48KJzXZEtR\/bbTi8i2\/k+Kw4jwoxQ6CHO8m3fvjCl+2bFts+k0LuMnL0vfFL9KZs3hcf0\/RiVYvLqHE78uMi3O466mwYXB3+uFGTl5rJ3LB7jOaWf6k9YltP5Kjk9huN0kYyO+hPWTjYLa2b+fP8AAAAAAAAAAAAAAAAAAAAADIf\/NIsxVYyjpCsAAAAASUVORK5CYII=) <b>Please leave an upvote if you found the notebook to be useful. <\/b> <br\/>","50d49ea4":"# Uniting the families\n\n### Family is not an important thing. It's everything. -Michael J Fox\n#RandomInternetQuote"}}