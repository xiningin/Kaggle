{"cell_type":{"3428f819":"code","438fe4e9":"code","499da22d":"code","b147f898":"code","d91e960a":"code","ac7bf5c6":"code","fc6c9be5":"code","2a36d9bf":"code","cabe0ee1":"code","01311449":"code","a4840ddc":"code","4a5a14ef":"code","ba035fed":"code","9b98388a":"code","3291ef39":"code","067ed1d6":"code","c0a98c4c":"code","8a4a1dcc":"code","d05f058e":"code","f5c9dcf8":"markdown","2fbfcc6f":"markdown","c5dfc452":"markdown","2cd3a4c0":"markdown","f2a4cd30":"markdown","4b450bd8":"markdown","1a377d66":"markdown","368cf5c1":"markdown"},"source":{"3428f819":"import numpy as np\nimport pandas as pd\nimport datetime as dt\nfrom matplotlib import pyplot as plt\nimport numpy as np\nfrom sklearn.preprocessing import OneHotEncoder\nimport seaborn as sns\nimport matplotlib.colors as mcolors","438fe4e9":"# load data using pandas\n\nroot=\"\/kaggle\/input\/coronavirusdataset\/\"\n\ndata_patient = pd.read_csv(\n    root+\"patient.csv\",\n    parse_dates=[\"confirmed_date\", \"released_date\", \"deceased_date\"]\n)\n\ndata_time = pd.read_csv(\n    root+\"time.csv\",\n    parse_dates=[\"date\"]\n)\n\ndata_route = pd.read_csv(\n    root+\"route.csv\",\n    parse_dates=[\"date\"]\n)\n\n\n# change indexes after loading\n\ndata_time.index = data_time.date\ndata_time.drop(\"date\", axis=1, inplace=True)\n\ndata_patient.index = data_patient.id\ndata_patient.drop(\"id\", axis=1, inplace=True)\n\ndata_route.index = data_route.id\ndata_route.drop(\"id\", axis=1, inplace=True)\n\n\n# add columns\n\ndata_patient[\"age\"] = dt.datetime.now().year - data_patient.birth_year\ndata_patient[\"age_binned\"] = pd.cut(data_patient.age, bins=range(0,100,5))","499da22d":"data_time.head(3)","b147f898":"data_patient.head(3)","d91e960a":"data_route.head(3)","ac7bf5c6":"plt.figure(figsize=(20,8))\n\nfor column in data_time.columns:\n    if column[0:3] == \"acc\":\n        plt.plot(data_time[column], label=column)\n\nplt.legend(loc=0)\nplt.title(\"Development of COVID-19 cases over time\")\nplt.xlabel(\"time\")\nplt.ylabel(\"cases\")\n\n\nplt.show()","fc6c9be5":"plt.figure(figsize=(20,8))\n\n\nplt.plot(data_time.new_negative, label=\"new negative\", color=\"k\", ls=\":\")\nplt.plot(data_time.new_confirmed, label=\"new confirmed\", color=\"k\")       \nplt.axvline(x=dt.datetime.strptime(\"2020-02-12\", \"%Y-%m-%d\"), label=\"change of assessment method\", color=\"red\", ls=\":\")\n\nplt.legend(loc=0)\nplt.title(\"Development of new COVID-19 cases over time\")\nplt.xlabel(\"time\")\nplt.ylabel(\"cases\")\n\nplt.show()","2a36d9bf":"fig, ax = plt.subplots(2,1, figsize=(20,8), sharex=True)\n\nax[0].hist(data_patient.age.dropna(), bins=10, color=\"k\")\nax[0].axvline(x=np.median(data_patient.age.dropna()), label=\"median\", color=\"red\")\nax[0].axvline(x=np.mean(data_patient.age.dropna()), label=\"mean\", color=\"orange\")\nax[0].axvline(x=np.quantile(data_patient.age.dropna(), q=[.25]), label=\"quart 1\", color=\"green\")\nax[0].axvline(x=np.quantile(data_patient.age.dropna(), q=[.75]), label=\"quart 3\", color=\"lightgreen\")\n\nax[0].set_title(\"Distribution of Patient Age\")\nax[0].set_ylabel(\"abs. freuquency\")\nax[0].set_xlabel(\"age\")\nax[0].legend(loc=0)\n\nax[1].boxplot(data_patient.age.dropna(), vert=False)\nax[1].set_xlabel(\"age\")\n\nplt.show()","cabe0ee1":"bin_vector=range(0,100,5)\n\nfig, ax = plt.subplots(1,3, figsize=(20,8), sharex=True, sharey=True)\n\nax[2].hist(data_patient.age.loc[data_patient.state==\"deceased\"].dropna(), color=\"k\", bins=bin_vector)\nax[2].axvline(x=np.median(data_patient.age.loc[data_patient.state==\"deceased\"].dropna()), label=\"median\", color=\"red\")\nax[2].set_title(\"Deceased persons\")\nax[2].legend(loc=0)\n\nax[0].hist(data_patient.age.dropna(), color=\"k\", bins=bin_vector)\nax[0].axvline(x=np.median(data_patient.age.dropna()), label=\"median\", color=\"red\")\nax[0].set_title(\"Infected persons\")\nax[0].legend(loc=0)\n\nax[1].hist(data_patient.age.loc[data_patient.state==\"released\"].dropna(), bins=bin_vector, color=\"k\")\nax[1].axvline(x=np.median(data_patient.age.loc[data_patient.state==\"released\"].dropna()), label=\"median\", color=\"red\")\nax[1].set_title(\"Released persons\")\nax[1].legend(loc=0)\n\nplt.show()","01311449":"bin_vector=range(0,100,5)\n\nplt.figure(figsize=(20,8))\n\nplt.hist(data_patient.age.dropna(), bins=bin_vector, color=\"black\", label=\"infected\")\nplt.hist(data_patient.age.loc[data_patient.state==\"released\"].dropna(), bins=bin_vector, color=\"orange\", label=\"released\", alpha=0.7)\nplt.hist(data_patient.age.loc[data_patient.state==\"deceased\"].dropna(), bins=bin_vector, color=\"red\", label=\"deceased\", alpha=0.7)\n\nplt.xticks(ticks=bin_vector)\nplt.title(\"Distribution of Patient Age\")\nplt.ylabel(\"abs. freuquency\")\nplt.xlabel(\"age\")\nplt.legend(loc=0)\n\nplt.show()","a4840ddc":"import seaborn as sns\n\nplt.figure(figsize=(20,8))\n\nsns.distplot(data_patient.age.dropna(), hist=False, rug=False, label=\"infected\")\nsns.distplot(data_patient.age.loc[data_patient.state==\"released\"].dropna(), hist=False, rug=False, label=\"released\")\nsns.distplot(data_patient.age.loc[data_patient.state==\"deceased\"].dropna(), hist=False, rug=False, label=\"deceased\")\n\nplt.title(\"Relative Density of persons in group of infected\/released\/deceased\")\nplt.ylabel(\"rel density\")\nplt.xlabel(\"age\")\n\nplt.legend(loc=0)","4a5a14ef":"plt.figure(figsize=(10,10))\n\nplt.pie(\n    data_patient.state.value_counts(),\n    labels=data_patient.state.value_counts().index,\n    colors=[\"k\", \"lightgreen\", \"red\"],\n    explode=(0.2, 0.2, 0.2)\n)\n\nplt.show()","ba035fed":"plt.figure(figsize=(20,10))\nsns.heatmap(\n    data_patient.pivot_table(\n        values=\"age\",\n        columns='region',\n        index='age_binned',\n        margins=False,\n        aggfunc='count'\n    ),\n    annot=True,\n    linewidths=0.1,\n    linecolor=\"k\",\n    cbar=False\n)\n\nplt.title(\"Age group over Region (Counts)\")","9b98388a":"plt.figure(figsize=(10,6))\nsns.stripplot(x=data_patient.country, y=data_patient.age, hue=data_patient.sex)\nplt.title(\"Age of patients from different countries\")\nplt.show()","3291ef39":"plt.figure(figsize=(20,8))\n\nplt.scatter(data_patient.age, data_patient.contact_number, alpha=0.7, color=\"k\", label=\"data\")\nplt.axvline(np.median(data_patient.age.dropna()), label=\"median age\", color=\"orange\")\nplt.axhline(np.median(data_patient.contact_number.dropna()), label=\"median contact count\", color=\"r\")\n\nplt.title(\"Age over Contacts\")\nplt.xlabel(\"age\")\nplt.ylabel(\"contacts\")\n\nplt.legend(loc=0)\n\nplt.show()","067ed1d6":"from scipy.stats import ttest_ind\nfrom itertools import combinations\n\nreleased = (\"released\", data_patient.age.loc[data_patient.state==\"released\"].dropna())\ndeceased = (\"deceased\", data_patient.age.loc[data_patient.state==\"deceased\"].dropna())\ninfected = (\"infected\", data_patient.age.dropna())\n\nfor item in combinations([released, infected, deceased], r=2):\n    \n    result = ttest_ind(a=item[0][1], b=item[1][1])\n    a_name = item[0][0]\n    b_name = item[1][0]\n    p = round(result[1], 4)\n    t = round(result[0], 2)\n    \n    print(f\"H0: age({a_name}) = age({b_name}) has a p-value of {p}\")\n    print(f\"H0: age({a_name}) >= age({b_name}) has a p-value of {p\/2} and a t of {t}\\n\")","c0a98c4c":"data_route.head(10)","8a4a1dcc":"bounding_box = (\n    np.floor(data_route.longitude.min()),\n    np.ceil(data_route.longitude.max()),\n    np.floor(data_route.latitude.min()),\n    np.ceil(data_route.latitude.max())\n)","d05f058e":"plt.figure(figsize=(20,16))\n\nplt.scatter(\n    data_route.longitude,\n    data_route.latitude,\n    marker=\"o\",\n    zorder=1,\n    c=\"k\",\n    alpha=0.6,\n    s=120\n)\n\nplt.xlim(bounding_box[0], bounding_box[1])\nplt.ylim(bounding_box[2], bounding_box[3])\n\nplt.imshow(\n    plt.imread(\"\/kaggle\/input\/sk-map\/map.png\"),\n    zorder=0,\n    extent=bounding_box,\n    aspect='equal',\n    alpha=0.4\n)\n\nplt.title('Plotting Spatial data about COVID-19 patients in South Korea')\nplt.legend(loc=0)\n\nplt.show()","f5c9dcf8":"## Significant Impact of Age on Status?","2fbfcc6f":"## Data Loading","c5dfc452":"## Geographical Trajectories","2cd3a4c0":"One **major question** was: Did the change of the **assessment method change the number of cases**? Here is one quote from the online media:\n\n> On Feb. 12, the national health committee announced that it was changing the way cases were counted in Hubei province. People with symptoms of the disease and with evidence of pneumonia on a CT scan but who had not been tested for presence of the virus \u2014 in other words, people who had a clinical diagnosis \u2014 would be added to the list of cases\" ([Statnews 2020](https:\/\/www.statnews.com\/2020\/02\/20\/experts-say-confusion-over-coronavirus-case-count-in-china-is-muddying-picture-of-spread\/)).\n\nThe plot below analyses whether there was a change in the number of new confirmed or new negatives cases after February 12, 2020.","f2a4cd30":"# Data Visualization of Corona Dataset","4b450bd8":"This is how the data present:\n\n* $H_0: \\mu_{age-released} = \\mu_{age-infected}$ cannot be rejected ($\\alpha = 1\\%$).\n* $H_0: \\mu_{age-released} = \\mu_{age-deceased}$ must be rejected ($\\alpha = 1\\%$).\n* $H_0: \\mu_{age-infected} = \\mu_{age-deceased}$ must be rejected ($\\alpha = 1\\%$).\n\nFurther we see that:\n\n* $H_0: \\mu_{age-released} \\geq \\mu_{age-deceased}$ must be rejected and $H_1: \\mu_{age-released} < \\mu_{age-deceased}$ holds ($\\alpha = 1\\%$).\n* $H_0: \\mu_{age-infected} \\geq \\mu_{age-deceased}$ must be rejected and $H_1: \\mu_{age-infected} < \\mu_{age-deceased}$ holds  ($\\alpha = 1\\%$).","1a377d66":"## Data Inspection","368cf5c1":"## Plotting"}}