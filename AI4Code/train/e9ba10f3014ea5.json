{"cell_type":{"81995ad9":"code","ddddf3ab":"code","efe47ae4":"code","5a933081":"code","6472c959":"code","50bee888":"code","a6e99221":"code","993fbcb9":"code","66483de6":"code","2f282989":"code","5bbd1ba5":"code","20f9b105":"code","6e309e2e":"code","cd60c3ed":"code","ecb66c7f":"code","daf0a9a1":"code","c956792e":"code","5d323835":"code","4097ee41":"code","ab84f3da":"code","a988c3dd":"code","a64d7d89":"code","e25ef9a2":"code","53b39a2c":"code","0638401c":"code","81f3353c":"code","d5d6109c":"code","ae4228c3":"code","1827c1e1":"code","f236e713":"code","30e6a044":"code","02e47cf5":"code","90deb649":"code","b9f9b8d8":"code","b7b6f282":"code","a79f2b0b":"code","63d35ba6":"code","f15d0380":"code","36e7d5d7":"code","ea28c946":"code","02d56f82":"code","56adb158":"code","5ad20e17":"code","1ab3ed6c":"code","3c0ccbf9":"code","653fafc4":"code","85366bdd":"code","a763eb08":"code","e1c2dc07":"code","a01abb5b":"code","e9e07732":"markdown","71e46f4c":"markdown","351d2d22":"markdown","4d9f6ab9":"markdown","52ab871c":"markdown","590c3a03":"markdown"},"source":{"81995ad9":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly\nimport plotly.offline as py\nimport plotly.graph_objs as go\nimport plotly.express as px\nfrom plotly.subplots import make_subplots\nimport os\n\n\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","ddddf3ab":"train = pd.read_csv('\/kaggle\/input\/av-genpact-hack-dec2018\/train.csv')\nmeal = pd.read_csv('\/kaggle\/input\/av-genpact-hack-dec2018\/meal_info.csv')\ncenter = pd.read_csv('\/kaggle\/input\/av-genpact-hack-dec2018\/fulfilment_center_info.csv')","efe47ae4":"train.head()","5a933081":"len(train)","6472c959":"meal.head()","50bee888":"center.head()","a6e99221":"train = train.merge(center,on='center_id')","993fbcb9":"train.head()","66483de6":"train = train.merge(meal,on='meal_id')","2f282989":"train.head(20)","5bbd1ba5":"len(train)","20f9b105":"train.sort_values(by='week',inplace=True)","6e309e2e":"train.head()","cd60c3ed":"fig = plt.figure(1,(15,10))\noverall_data = train.groupby('week')['num_orders'].sum()\nplt.plot(overall_data.index,overall_data)\nplt.title('Week wise food demand')\nplt.ylabel('Total Demand')\nplt.show()","ecb66c7f":"def plot_center_wise(center_id):\n    center_wise_data = train[train['center_id']==center_id]\n    center_wise_orders = center_wise_data['num_orders']\n    center_wise_dates = center_wise_data['week']\n    return center_wise_orders,center_wise_dates\n\nfig = make_subplots(rows=20, cols=2)\nfor index,_id in enumerate(list(set(train['center_id']))):\n    if index == 21:\n        break\n    center_wise_orders,center_wise_dates = plot_center_wise(_id)\n    fig.add_trace(\n        go.Scatter(x=center_wise_dates, y=center_wise_orders,name=_id),\n        row=(index\/\/2)+1, col=(index%2)+1\n    )\nfig.update_layout(height =1500 ,width =1500 ,title_text=\"Center wise food demand\")\nfig.show()\n","daf0a9a1":"def plot_meal_wise(meal_id):\n    meal_wise_data = train[train['meal_id']==meal_id]\n    meal_wise_orders = meal_wise_data['num_orders']\n    meal_wise_dates = meal_wise_data['week']\n    return meal_wise_orders,meal_wise_dates\n\nfig = make_subplots(rows=len(list(set(train['meal_id'])))+2, cols=2)\nfor index,_id in enumerate(list(set(train['meal_id']))):\n    if index == len(list(set(train['meal_id']))):\n        break\n    meal_wise_orders,meal_wise_dates = plot_meal_wise(_id)\n    fig.add_trace(\n        go.Scatter(x=meal_wise_dates, y=meal_wise_orders,name=_id),\n        row=(index\/\/2)+1, col=(index%2)+1\n    )\nfig.update_layout(height =4500 ,width =1500 ,title_text=\"Meal wise food demand\")\nfig.show()","c956792e":"def plot_cuisine_wise(cuisine_id):\n    cuisine_wise_data = train[train['cuisine']==cuisine_id]\n    cuisine_wise_orders = cuisine_wise_data['num_orders']\n    cuisine_wise_dates = cuisine_wise_data['week']\n    return cuisine_wise_orders,cuisine_wise_dates\n\nfig = make_subplots(rows=len(list(set(train['cuisine'])))+2, cols=2)\nfor index,_id in enumerate(list(set(train['cuisine']))):\n    if index == len(list(set(train['cuisine']))):\n        break\n    cuisine_wise_orders,cuisine_wise_dates = plot_cuisine_wise(_id)\n    fig.add_trace(\n        go.Scatter(x=cuisine_wise_dates, y=cuisine_wise_orders,name=_id),\n        row=(index\/\/2)+1, col=(index%2)+1\n    )\nfig.update_layout(height =1100 ,width =900 ,title_text=\"Cuisine wise food demand\")\nfig.show()","5d323835":"def plot_category_wise(category_id):\n    category_wise_data = train[train['category']==category_id]\n    category_wise_orders = category_wise_data['num_orders']\n    category_wise_dates = category_wise_data['week']\n    return category_wise_orders,category_wise_dates\n\nfig = make_subplots(rows=len(list(set(train['category'])))+2, cols=2)\nfor index,_id in enumerate(list(set(train['category']))):\n    if index == len(list(set(train['category']))):\n        break\n    category_wise_orders,category_wise_dates = plot_category_wise(_id)\n    fig.add_trace(\n        go.Scatter(x=category_wise_dates, y=category_wise_orders,name=_id),\n        row=(index\/\/2)+1, col=(index%2)+1\n    )\nfig.update_layout(height =1500 ,width =900 ,title_text=\"Category wise food demand\")\nfig.show()","4097ee41":"fig = plt.figure(1,(15,10))\npriced_data = train.groupby('checkout_price').sum()\nnum_orders_by_price = priced_data['num_orders']\npriced_data = priced_data.index\nplt.plot(priced_data,num_orders_by_price)\nplt.title('Checkout price vs number of orders')\nplt.xlabel('Price of the food item')\nplt.ylabel('Number of orders')\nplt.show()","ab84f3da":"fig = plt.figure(1,(15,10))\nweekly_avg = train.groupby('week').mean()\nprices_avg = weekly_avg['checkout_price']\nplt.plot(weekly_avg.index,prices_avg,color='green')\nplt.title('weekly price')\nplt.xlabel('Weeks')\nplt.ylabel('Price of the food items')\nplt.show()","a988c3dd":"fig = plt.figure(1,(15,10))\noverall_data = train.groupby('week')['num_orders'].sum()\nplt.plot(overall_data.index,overall_data)\nplt.title('Week wise food demand')\nplt.ylabel('Total Demand')\nplt.show()","a64d7d89":"from statsmodels.tsa.stattools import adfuller\n\ndef check_stationarity(data):\n    rolling_mean = data.rolling(window = 4).mean()\n    rolling_std = data.rolling(window = 4).std() \n        \n    fig = plt.figure(1,(9,6))\n    plt.plot(rolling_mean , color = 'r')\n    plt.plot(rolling_std , color ='g')\n    plt.plot(data,color='b')\n    plt.title('Rolling Mean and Standard Deviation')\n    plt.show()\n    \n    result = adfuller(data)\n    \n    print('ADF Statistic: %f' % result[0])\n    print('p-value: %f' % result[1])\n    print('Critical Values:')\n    \n    for key, value in result[4].items():\n        print('\\t%s: %.3f' % (key, value))\n    ","e25ef9a2":"check_stationarity(overall_data)","53b39a2c":"ts_log = np.log(overall_data)\ncheck_stationarity(ts_log)","0638401c":"ts_sqrt = np.sqrt(overall_data)\ncheck_stationarity(ts_sqrt)","81f3353c":"moving_average = ts_log.rolling(window = 12).mean()\nplt.plot(ts_log)\nplt.plot(moving_average , color = 'r')","d5d6109c":"ts_log_moving_average = ts_log - moving_average\nts_log_moving_average.dropna(inplace=True)\ncheck_stationarity(ts_log_moving_average)","ae4228c3":"exp_mva = pd.DataFrame.ewm(ts_log,halflife=4).mean()\nplt.plot(exp_mva,color='r')\nplt.plot(ts_log)","1827c1e1":"ts_log_exp_mva = ts_log-exp_mva\nts_log_exp_mva.dropna(inplace=True)\ncheck_stationarity(ts_log_exp_mva)","f236e713":"ts_log_diff = ts_log - ts_log.shift()\nts_log_diff.dropna(inplace=True)\ncheck_stationarity(ts_log_diff)","30e6a044":"ts_log","02e47cf5":"import datetime\nfrom dateutil.relativedelta import relativedelta\n\nyear = 2000\ndef change_week_to_datetime(data):\n    return datetime.date(year,1,1)+relativedelta(weeks=+data)","90deb649":"ts_log_index = list(ts_log.index)\nts_log_index = list(map(change_week_to_datetime,ts_log_index))\nts_log_index","b9f9b8d8":"ts_log.index = ts_log_index","b7b6f282":"ts_log","a79f2b0b":"from statsmodels.tsa.seasonal import seasonal_decompose\n\ndecomposed_data = seasonal_decompose(ts_log,period=4)\ntrend = decomposed_data.trend\n_seasonal = decomposed_data.seasonal\nresid = decomposed_data.resid","63d35ba6":"plt.plot(trend)","f15d0380":"plt.plot(_seasonal)\nplt.show()","36e7d5d7":"def difference_series(data,interval = 1):\n    difference = []\n    for i in range(interval,len(data)):\n        difference.append(data[i]-data[i-interval])\n    return pd.Series(difference)","ea28c946":"def apply_inverse(history,prediction,interval = 1):\n    return prediction + history[-interval]","02d56f82":"seasonally_differenced_data = difference_series(ts_log,4)\nseasonally_differenced_data.index = ts_log.index[4:]","56adb158":"check_stationarity(seasonally_differenced_data)","5ad20e17":"from statsmodels.graphics.tsaplots import plot_acf\nfrom statsmodels.graphics.tsaplots import plot_pacf\n\nplt.figure()\nplt.subplot(211)\nplot_acf(seasonally_differenced_data, ax=plt.gca())\nplt.subplot(212)\nplot_pacf(seasonally_differenced_data, ax=plt.gca())\nplt.show()","1ab3ed6c":"from statsmodels.tsa.arima_model import ARIMA\nfrom sklearn.metrics import mean_squared_error\nimport math\n\ntrain_data = overall_data.values\ntraining,validation = train_data[:int(len(train_data)*0.7)],train_data[int(len(train_data)*0.7):] \nhistory = [item for item in training]\noutputs = []\nfor i in range(len(validation)):\n    differenced_data = difference_series(history,4)\n    model = ARIMA(differenced_data,(4,0,6))\n    model = model.fit(trend='nc',disp = 0)\n    output = model.forecast()[0]\n    output = apply_inverse(history,output,4)\n    outputs.append(output)\n    history.append(validation[i])\n    print(\"Actual Value: {:.2f} Predicted value: {:.2f}\".format(validation[i],output))\n\nprint(\"Root mean squared error: \",math.sqrt(mean_squared_error(validation,outputs)))","3c0ccbf9":"residual_overall_data = pd.DataFrame([validation[i]-outputs[i] for i in range(len(validation))])\nresidual_overall_data.describe()","653fafc4":"mean_to_be_added = -15994.344968\nplt.figure()\nplt.subplot(211)\nresidual_overall_data.hist(ax = plt.gca())\nplt.subplot(212)\nresidual_overall_data.plot(kind='kde',ax = plt.gca())\nplt.show()","85366bdd":"train_data = overall_data.values\ntraining,validation = train_data[:int(len(train_data)*0.7)],train_data[int(len(train_data)*0.7):] \nhistory = [item for item in training]\noutputs = []            \nfor i in range(len(validation)):\n    differenced_data = difference_series(history,4)\n    model = ARIMA(differenced_data,(4,0,5))\n    model = model.fit(trend='nc',disp = 0)\n    output = model.forecast()[0]\n    output = mean_to_be_added + apply_inverse(history,output,4)\n    outputs.append(output)\n    history.append(validation[i])\n#     print(\"Actual Value: {:.2f} Predicted value: {:.2f}\".format(validation[i],output))\n\nprint(\"Root mean squared error: \",math.sqrt(mean_squared_error(validation,outputs)))","a763eb08":"residual_overall_data = pd.DataFrame([validation[i]-outputs[i] for i in range(len(validation))])\nplt.figure()\nplt.subplot(211)\nresidual_overall_data.hist(ax = plt.gca())\nplt.subplot(212)\nresidual_overall_data.plot(kind='kde',ax = plt.gca())\nplt.show()","e1c2dc07":"plt.figure()\nplt.subplot(211)\nplot_acf(residual_overall_data, ax=plt.gca())\nplt.subplot(212)\nplot_pacf(residual_overall_data, ax=plt.gca())\nplt.show()","a01abb5b":"plt.plot(validation,color='g')\nplt.plot(outputs,color='r')","e9e07732":"Category wise demand for food.\n","71e46f4c":"Plotting the data as it is.","351d2d22":"Meal wise food demand","4d9f6ab9":"Average food cost per week","52ab871c":"Plotting the data center-wise","590c3a03":"Checkout Price v\/s Number of orders"}}