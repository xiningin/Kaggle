{"cell_type":{"5a0c4278":"code","9aae3e45":"code","353a3f4b":"code","58ae90ef":"code","921b3b74":"code","6978d499":"code","cf7626f0":"code","bedb0aa7":"code","ca4dbb2c":"code","c4876367":"code","a9cb0b71":"code","88f6480f":"code","9da86b93":"code","53d8d9cf":"code","b41465cb":"code","58a3179b":"code","7df06944":"code","4c9568c8":"code","775e04ea":"code","001bdce9":"code","f8cea60e":"code","7cede936":"code","aeab80d1":"code","d13682b1":"markdown"},"source":{"5a0c4278":"%%writefile cmap_header.py\nfrom IPython.display import display,HTML\nfrom IPython.core.magic import register_line_magic\nimport random\n#Sequential (Single-Hue,Multi-Hue),Diverging, Cyclical cmaps: \n#Reds,Sinebow,Rainbow,Turbo,Warm,Cool,Plasma,Spectral,etc.\n@register_line_magic\ndef cmap_header(params):\n    params=params.split('|'); string=params[0]\n    if len(params)==1: \n        font_size='30'; font_family='Akronim'; cmap='Sinebow'\n    elif  len(params)==2: \n        font_size=params[1]\n        font_family='Akronim'; cmap='Sinebow'\n    elif  len(params)==3: \n        font_size=params[1]; font_family=params[2]\n        cmap='Sinebow'\n    else: \n        font_size=params[1]; font_family=params[2]; cmap=params[3]\n    height=int(font_size)*2.5; randi=str(random.uniform(0,9999999))\n    html_str=\"\"\"\n    <head><script src='https:\/\/d3js.org\/d3.v6.min.js'><\/script>\n    <\/head><style>@import 'https:\/\/fonts.googleapis.com\/css?family=\"\"\"+\\\n    font_family+\"\"\"&effect=3d'; #colorized {font-family:\"\"\"+font_family+\\\n    \"\"\"; color:white; padding-left:10px; font-size:\"\"\"+font_size+\\\n    \"\"\"px;}<\/style><h1 id='colorized' class='font-effect-3d'>\"\"\"+\\\n    string+\"\"\"<\/h1><script>\n    var tc=setInterval(function(){\n        var now=new Date().getTime();\n        var iddoc=document.getElementById('colorized');\n        iddoc.style.color=d3.interpolate\"\"\"+cmap+\\\n    \"\"\"(now%(30000)\/30000);},1)<\/script>\"\"\"\n    file='d3header'+randi+'.html'\n    with open(file,'w') as f:\n         f.write(html_str); f.close()\n    string=\"\"\"<div id='html_string\"\"\"+randi+\\\n    \"\"\"' style='width:100%;'><iframe src='\"\"\"+file+\\\n    \"\"\"' height=\"\"\"+str(height)+\"\"\"\n    style='display:block; width:100%;'><\/iframe><\/div>\"\"\"\n    display(HTML(string))","9aae3e45":"%run cmap_header.py\n%cmap_header Code Modules & Functions","353a3f4b":"import tensorflow as tf,pylab as pl\nimport pandas as pd,numpy as np,seaborn as sb\nimport tensorflow.keras.utils as tku\nfrom tensorflow.data import Dataset as tds\nimport sklearn.model_selection as sms","58ae90ef":"def phtml(str):\n    display(HTML(\"\"\"<style>@import \n    'https:\/\/fonts.googleapis.com\/css?family=Aladin&effect=3d-float';      \n    <\/style><h1 class='font-effect-3d-float' \n    style='font-family:Aladin; color:#ee55ee; font-size:20px;'>\n    %s<\/h1>\"\"\"%str))\ndef pd_style():\n    return [dict(selector='th',props=[('font-size','10pt')]),\n            dict(selector='td',props=[('padding','0em 0em')]),\n            dict(selector='th:hover',props=[('font-size','12pt')]),\n            dict(selector='tr:hover td:hover',\n                 props=[('max-width','200px'),('font-size','10pt')])]","921b3b74":"%cmap_header Data Processing","6978d499":"url='http:\/\/archive.ics.uci.edu\/ml\/machine-learning-databases'+\\\n    '\/auto-mpg\/auto-mpg.data'\ndp=tku.get_file('auto-mpg.data',url)","cf7626f0":"columns=['MPG','Cylinders','Displacement','Horsepower',\n         'Weight','Acceleration','ModelYear','Origin']\nnumeric_columns=columns[2:6]\ndf=pd.read_csv(dp,names=columns,\n               na_values=\"?\",comment='\\t',sep=\" \",\n               skipinitialspace=True)\ndf.head(10).style.background_gradient('cool',axis=1)\\\n    .set_properties(**{'max-width':'80px','font-size':'1pt'})\\\n    .set_caption(phtml('Data Exploration'))\\\n    .set_precision(2).set_table_styles(pd_style())","bedb0aa7":"df=df.dropna().reset_index(drop=True)\ndf.tail(10).style.background_gradient(\n    cmap='cool',axis=0,subset=numeric_columns)\\\n.set_table_styles(pd_style())","ca4dbb2c":"stats=df.describe().transpose()\ndfn=df.copy()\nfor nc in numeric_columns:\n    mean=stats.loc[nc,'mean']\n    std=stats.loc[nc,'std']\n    dfn.loc[:,nc]=(dfn.loc[:,nc]-mean)\/std\ndfn.tail(10).style.bar(\n    align='mid',color=['#55eeee','#ee55ee'],\n    subset=numeric_columns).set_table_styles(pd_style())","c4876367":"%cmap_header TF Data","a9cb0b71":"numeric_features=[]\nfor nc in numeric_columns:\n    nf=tf.feature_column.numeric_column(key=nc)\n    numeric_features.append(nf) \nfor nf in numeric_features: \n    phtml(str(nf)); break","88f6480f":"fyear=tf.feature_column.numeric_column(key=\"ModelYear\")\nfcylinders=tf.feature_column.numeric_column(key=\"Cylinders\")\nbucketized_features=[]\nfyear=tf.feature_column.bucketized_column(\n    source_column=fyear,boundaries=[73,76,79])\nfcylinders=tf.feature_column.bucketized_column(\n    source_column=fcylinders,boundaries=[4,6,8])\nbucketized_features.append(fyear)\nbucketized_features.append(fcylinders)\nfor bf in bucketized_features: \n    phtml(str(bf)); break","9da86b93":"forigin=tf.feature_column\\\n.categorical_column_with_vocabulary_list(\n    key='Origin',vocabulary_list=[1,2,3])\ncategorical_features=\\\n[tf.feature_column.indicator_column(forigin)]\nphtml(str(categorical_features[0]))","53d8d9cf":"features=(numeric_features+bucketized_features+categorical_features)\ndfn_train,dfn_test=\\\nsms.train_test_split(dfn,train_size=.8,shuffle=True)\nphtml(str([len(dfn_train),len(dfn_test)]))","b41465cb":"batch_size=8\ndef train_input_fn(dfn_train,batch_size):\n    dft=dfn_train.copy()\n    x_train,y_train=dft,dft.pop('MPG')\n    ds_train=tds.from_tensor_slices((dict(x_train),y_train))\n    return ds_train.shuffle(len(x_train)).repeat().batch(batch_size)\nds_train=train_input_fn(dfn_train,batch_size)\nbatch=next(iter(ds_train))\nphtml('keys: <\/br>%s'%batch[0].keys())\nphtml('batch values of `Cylinders`: <\/br> %s'%batch[0]['Cylinders'])","58a3179b":"def test_input_fn(dfn_test,batch_size):\n    dft2=dfn_test.copy()\n    x_test,y_test=dft2,dft2.pop('MPG')\n    ds_test=tds.from_tensor_slices((dict(x_test),y_test))\n    return ds_test.batch(batch_size)\nds_test=test_input_fn(dfn_test,batch_size)\nbatch=next(iter(ds_test))\nphtml('keys: <\/br>%s'%batch[0].keys())\nphtml('batch values of `ModelYear`: <\/br>%s'%\\\n      batch[0]['ModelYear'])","7df06944":"%cmap_header TF Regressor","4c9568c8":"reg=tf.estimator.DNNRegressor(\n    feature_columns=features,hidden_units=[64,32,16,8],\n    model_dir='models\/autompg-dnnregressor\/');","775e04ea":"epochs=1000\nsteps=epochs*int(np.ceil(len(dfn_train)\/batch_size))\nphtml('training steps: %d'%steps)\nreg.train(input_fn=lambda:\\\n          train_input_fn(dfn_train,\n          batch_size),steps=steps);","001bdce9":"reloaded_reg=tf.estimator.DNNRegressor(\n    feature_columns=features,hidden_units=[64,32,16,8],\n    warm_start_from='models\/autompg-dnnregressor\/',\n    model_dir='models\/autompg-dnnregressor\/');","f8cea60e":"test_results=reloaded_reg\\\n.evaluate(input_fn=lambda:\\\n          test_input_fn(dfn_test,batch_size))\nfor key in test_results:\n    phtml('{}: {}'.format(key,test_results[key]))\nphtml('test average loss% {:.4f}'\\\n      .format(test_results['average_loss']))","7cede936":"y_test_pred=reg.predict(input_fn=lambda:\\\n                        test_input_fn(dfn_test,batch_size))\npy_test=[]\nfor i in range(len(dfn_test)):\n    py_test.append(next(iter(y_test_pred))['predictions'][0])","aeab80d1":"pl.figure(figsize=(10,4))\npl.plot(range(len(dfn_test)),dfn_test['MPG'],\n        '-o',label='real data',c='#55eeee',ms=7)\npl.plot(range(len(dfn_test)),py_test,\n        '-o',label='predictions',c='#ee55ee',ms=5)\npl.tight_layout(); pl.grid(); pl.legend();","d13682b1":"Reading classics [Python Machine Learning 3rd Edition](https:\/\/github.com\/rasbt\/python-machine-learning-book-3rd-edition\/blob\/master\/ch14\/ch14_part2.ipynb)"}}