{"cell_type":{"84a9a240":"code","4be9efea":"code","df7bd794":"code","76f13dd7":"code","2e946edb":"code","e2f7df66":"code","edbd2cc6":"code","0f4a1c67":"code","3c1ff572":"code","172d4c84":"code","e3d55906":"code","edfa3d8f":"code","7d96af3d":"code","75e11b36":"code","c5cf34f2":"code","705a58c3":"code","45bf8b0b":"code","e3f8fcbc":"code","c0b7334d":"code","74d01d3f":"code","5df37179":"code","86988680":"code","03177a78":"code","7611b224":"code","053904e8":"code","21ba6401":"code","5564964f":"code","a4e8009b":"code","00c47327":"code","fc4efed4":"code","c44fc446":"code","31109a9e":"code","dcb740bc":"code","166686fb":"code","1d8ba6bd":"code","f6b36477":"code","e6fbdeea":"code","c227f1d5":"code","c4a62d75":"code","9538dc10":"code","a2995f18":"code","4c7b5358":"code","eb3607a8":"code","065f7850":"code","f2ac61fe":"code","1b8716e5":"code","8a2f50d8":"code","813cd593":"code","63a3c99d":"code","1fe7396b":"markdown","aae45b84":"markdown","95249f21":"markdown","daac62f4":"markdown","f7f6b31c":"markdown","9d05a261":"markdown","8490e6e0":"markdown","ec5439a8":"markdown","8d6378d7":"markdown","c3033114":"markdown","eb4fa2f6":"markdown","a9bf2b32":"markdown","8724c71b":"markdown","812e296f":"markdown","ba6af9e4":"markdown","3167e00a":"markdown","84145ad5":"markdown","e544985c":"markdown","fafa2c31":"markdown","ca763275":"markdown","95c6160e":"markdown","3fee74da":"markdown","6345d5fd":"markdown","d59c6625":"markdown","3d3787e4":"markdown","3e6cb4e2":"markdown","043e0f10":"markdown","b83f85f9":"markdown","7e8fe8a4":"markdown","63e2628e":"markdown","eb94d865":"markdown","1c7c748a":"markdown","062f3aed":"markdown","122343a5":"markdown","0d51f9ca":"markdown","2bd7061c":"markdown","56e1b888":"markdown","0dce2f49":"markdown","91296414":"markdown","86198f2c":"markdown","d5632e70":"markdown"},"source":{"84a9a240":"import pandas as pd\nimport missingno as msno\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","4be9efea":"df = pd.read_excel(\"..\/input\/boroughpop.xlsx\")\ndf2 = pd.read_excel(\"..\/input\/londonimddecile.xlsx\")\ndf_map = pd.read_excel(\"..\/input\/mmap.xlsx\")","df7bd794":"df.head()","76f13dd7":"df2.head()","2e946edb":"df_map.head()","e2f7df66":"# Change name of column 'ladname' to 'ladnm' for merging data\ndf2 = df2.rename(columns={'ladname':'ladnm'})","edbd2cc6":"# First merge (df and df2)\ndata = pd.merge(df,df2, on='ladnm',how='outer')","0f4a1c67":"# Second merge (merged df,df2 and map data)\ndata = pd.merge(data,df_map, on=['ladnm','lsoacode'],how='outer')","3c1ff572":"# Overall information about merged data\ndata.info()","172d4c84":"# Look at first 5 rows of the merged data\ndata.head()","e3d55906":"msno.bar(data)","edfa3d8f":"# Number of unique boroughs in London\ndata.ladnm.nunique()","7d96af3d":"df.sort_values('population', ascending=False).set_index('ladnm').plot.barh(figsize=(10,8))","75e11b36":"# Distribution of Index of Multiple Deprivation\nsns.distplot(data[data.imddecile.notnull()].imddecile)","c5cf34f2":"# Proportion of boroughs where gangs are present (In Orange)\n(data.groupby('ladnm').first().gangpresent.value_counts()*100 \/ data.groupby('ladnm').first().gangpresent.value_counts().sum()).plot('bar')","705a58c3":"# Chi-Squared test of goodness-of-fit \nfrom scipy import stats\nstats.chisquare(f_obs= data.groupby('ladnm').first().gangpresent.value_counts()*100 \/ data.groupby('ladnm').first().gangpresent.\\\n                value_counts().sum(),\n                f_exp= [0.5,0.5])","45bf8b0b":"f, axes = plt.subplots(nrows=1, ncols=2, figsize=(8, 4))\nax1 = sns.distplot(data[data.vicage.notnull()].vicage,ax=axes[0],color='darkred')\nax2 = sns.distplot(data[data.susage.notnull()].susage,ax=axes[1],color='darkblue')","e3f8fcbc":"# Victim sex proportion\nlabels='Male','Female'\nplt.pie(data['vicsex'].value_counts(), labels=labels,autopct='%1.1f%%', startangle = 150, shadow=True)","c0b7334d":"# Suspect sex proportion\nlabels='Male','Female'\nplt.pie(data['sussex'].value_counts(), labels=labels,autopct='%1.1f%%', startangle = 150,shadow=True)","74d01d3f":"data.weapon.value_counts().plot('bar')","5df37179":"(data.Status.value_counts() * 100 \/ data.Status.value_counts().sum()).plot('bar')\nplt.title(\"% proportion homicide cases by Status\")","86988680":"data['date_year'] = data.date.dt.year\ndata['date_month'] = data.date.dt.month","03177a78":"data.groupby('date_year').size().plot()\nplt.title(\"Number of homicides in London over time\")","7611b224":"data.groupby('date_month').size().plot('bar')\nplt.title(\"Number of homocides by month\")","053904e8":"f, axes = plt.subplots(1,2, figsize=(10,4),sharey=True)\n\nax1 = (data[data.sussex=='M'].weapon.value_counts() * 100 \/ data[data.sussex=='M'].weapon.value_counts().sum()).plot('bar', ax=axes[0])\nax1.set_ylabel(\"% Proportion\")\nax1.set_title(\"Proportion of Male Suspects by weapon\")\n\nax2 = (data[data.sussex=='F'].weapon.value_counts() * 100 \/ data[data.sussex=='F'].weapon.value_counts().sum()).plot('bar', ax=axes[1])\nax2.set_ylabel(\"% Proportion\")\nax2.set_title(\"Proportion of Female Suspects by weapon\")\nplt.tight_layout()","21ba6401":"from scipy.stats import chi2_contingency\ntable = pd.crosstab(data.sussex, data.weapon)\nstat, p, dof, expected = chi2_contingency(table)\nprint(\"p-value: \",p) ","5564964f":"# Add information about number of homicides in which victims were females to the original dataframe\ndata = data.merge(pd.DataFrame(data[data.vicsex=='F'].groupby('ladnm').size(),columns=['num_of_female_vic_cases']).reset_index(),\n           how='left',on=['ladnm'])","a4e8009b":"# Number of homicides in which victims were females by gang present status\ndata.groupby('ladnm').first().groupby('gangpresent').mean().\\\nreset_index().plot(y='num_of_female_vic_cases',x= 'gangpresent', kind='barh')","00c47327":"# Variance of Number of homicides in which victims were females in gang present boroughs\ndata.groupby('ladnm').first().groupby('gangpresent').get_group('Y').num_of_female_vic_cases.var()","fc4efed4":"# Variance of Number of homicides in which victims were females in gang non-present boroughs\ndata.groupby('ladnm').first().groupby('gangpresent').get_group('N').num_of_female_vic_cases.var()","c44fc446":"from scipy.stats import ttest_ind\nd1,d2 = data.groupby('ladnm').first().groupby('gangpresent').get_group('Y').num_of_female_vic_cases,\\\ndata.groupby('ladnm').first().groupby('gangpresent').get_group('N').num_of_female_vic_cases\n\nttest_ind(d1,d2, equal_var=False)","31109a9e":"# Chi Squared Test of Indepenence on Victims' ethnicity and sex\nchi2_contingency(pd.crosstab(data.vicethnic, data.vicsex))","dcb740bc":"data2 = data.copy() # Make a copy of data just for this test\ndata2 = data2.join(pd.get_dummies(data2.vicethnic)) # Join the dummy variables onto the original dataframe","166686fb":"# Chi Squared test of indepence on relationship between victims having any other ethnic appearance and their sex\nchi2_contingency(pd.crosstab(data2['Any Other Ethnic Appearance'], data2.vicsex))","1d8ba6bd":"# Chi Squared test of indepence on relationship between victims being White or White British and their sex\nchi2_contingency(pd.crosstab(data2['White or White British'], data2.vicsex))","f6b36477":"# Chi Squared test of indepence on relationship between victims being Black or Black British and their sex\nchi2_contingency(pd.crosstab(data2['Black or Black British'], data2.vicsex))","e6fbdeea":"# Chi Squared test of indepence on relationship between victims being Asian or Asian British and their sex\nchi2_contingency(pd.crosstab(data2['Asian or Asian British'], data2.vicsex))","c227f1d5":"# Percentage Proportion normalized by row\npd.crosstab(data.vicethnic, data.vicsex,normalize='index')","c4a62d75":"# Chi Squared Test of Indepenence on suspects' sex and status\nchi2_contingency(pd.crosstab(data.sussex, data.Status))","9538dc10":"# Chi Squared Test of Indepenence on choice of weapons and status\nchi2_contingency(pd.crosstab(data.weapon, data.Status))","a2995f18":"pd.crosstab(data.weapon, data.Status, normalize='columns')","4c7b5358":"# Chi Squared Test of Indepenence on victims' ethnicity and status\nchi2_contingency(pd.crosstab(data.vicethnic, data.Status))","eb3607a8":"pd.crosstab(data.vicethnic, data.Status,normalize='index')","065f7850":"# Chi Squared Test of Indepenence on Victims' sex and status\nchi2_contingency(pd.crosstab(data.vicsex, data.Status))","f2ac61fe":"pd.crosstab(data.vicsex, data.Status, normalize='index')","1b8716e5":"# Victims' ethnicity in various boroughs(location)\nsns.scatterplot(x='latitude',y='longitude',data=data,hue='vicethnic')\nplt.legend(loc='best', bbox_to_anchor=(1,1))","8a2f50d8":"# Victims' sex in various boroughs(location)\nsns.scatterplot(x='latitude',y='longitude',data=data,hue='vicsex')\nplt.legend(loc=1)","813cd593":"# Suspects' sex in various boroughs(location)\nsns.scatterplot(x='latitude',y='longitude',data=data,hue='sussex')","63a3c99d":"sns.pairplot(data.groupby('ladnm').first().reset_index(), vars=['population','imddecile','num_of_female_vic_cases'], hue='ladnm')","1fe7396b":"Choice of weapons and case status is correlated but need to perform post-hoc chi squared tests on every single weapon. We skip this for now. But the table above shows that 51% among all solved cases were homicides that involved knives and 38% among all unsolves cases were homicides that involved guns.","aae45b84":"### Thank you for reading my kernel! If you liked my kernel, please upvote it! Happy new year and happy Kaggling! :)","95249f21":"The p-value is smaller than 0.05 which is the typical significance level for statistical significance and thus **London has statistically higher proportion of boroughs that don't have gangs.**","daac62f4":"https:\/\/assets.publishing.service.gov.uk\/government\/uploads\/system\/uploads\/attachment_data\/file\/579151\/English_Indices_of_Deprivation_2015_-_Frequently_Asked_Questions_Dec_2016.pdf\n\nThe Index of Multiple Deprivation, commonly known as the IMD, is the official measure of relative deprivation for small areas in England. The Index of Multiple Deprivation ranks every small area in England from 1 (mostdeprived area) to 32,844 (least deprived area). The Index of Multiple Deprivation (IMD) combines information from the seven domains to produce an overall relative measure of deprivation. Those domains include income deprivation, employment deprivation, barriers to housing etc.","f7f6b31c":"I guess knife is the most commonplace weapon people can easily access to kill people","9d05a261":"From the observed data, we see that knives and guns are common weapons of choie for male suspects while non-traditional ways of homicide that don't require weapons (as indicated by \"None\", \"Other\", \"Poison\") are preferred by female suspects. But is this difference statistically significant? We can use the Chi Squared Test of Indepence for this!","8490e6e0":"###### What are some variables that are statistically significant with \"Status\"(Whether cases are resolved or unsolved etc.)","ec5439a8":"But the variable \"imddecile\" is given in deciles and there is no additional information about whether the higher deciles (closer to 12) represent more deprived areas or not, so unsure how to interpret this variable for now!","8d6378d7":"###### Victim Profile","c3033114":"Suspects' sex is not much correlated with the case Status (statistically insignificant)","eb4fa2f6":"# Merging Data","a9bf2b32":"###### Population of each Borough","8724c71b":"###### Is there a statistically significant difference in average number of homicides in which victims were females between gang present and non-present boroughs?","812e296f":"Boroughs where gangs are present have more cases of homicide cases where victims were females. Is this statistically significant? We can use the independent two sample t-test with non-equal variance(we just checked above that the variances of the two groups are different) to test this!","ba6af9e4":"P-value is 1.865400421831358e-14 < 0.05 and thus there is statistically significant correlation between victims' ethnicity and age. We can perform 2x2 post-hoc tests to find out which category is correlated to which category","3167e00a":"The p-value is smaller than 0.05 and thus suspect's sex and the choice of weapon are not independent. They are correlated! Male suspects are more likely to use some form of weapon most likely because of their stronger physical strength.","84145ad5":"# Univariate EDA","e544985c":"The total number of homicides was on the decreasing trend until 2014 but it has been increasing again ever since!","fafa2c31":"The missingno package allows us to visualize how many missing values we have for each variable!","ca763275":"###### How has the total number of homicides change over time (year and month)","95c6160e":"# Read in Essential Libraries","3fee74da":"###### Index of Deprivation(imd decile)","6345d5fd":"If the victim was a man, it is less likely that the case was solved","d59c6625":"###### Where Gang is Present in a certain Borough (Binary variable: Yes or No) ","3d3787e4":"# Missing Data","3e6cb4e2":"# Bivariate & Multivariate EDA","043e0f10":"We first extract year and month information from the date column and make them into sepearate columns for convenience","b83f85f9":"###### Sex proportions of victims and suspects","7e8fe8a4":"p-value is smaller than 0.05 and thus it is statistically significant! Thus, boroughs with gangs have significantly more cases of homicide where victims were females!","63e2628e":"Asian females had higher risk of being killed than females of other races. Black men had higher risk of being killed than men of other racces. ","eb94d865":"###### Types of weapons used","1c7c748a":"London has slightly more (about 57%) boroughs that don't have gangs. But is this proportion statistically significant? We can use the Chi-Squared test of goodness-of-fit to check this.","062f3aed":"###### Which weapons are male suspects more likely to use than female suspects?","122343a5":"###### Age distribution of victims and suspects","0d51f9ca":"###### Relationship amongst population, IMD Decile and number of cases where victims were females of boroughs","2bd7061c":"The scatter plot above suggests that White victims(blue dots) were killed in broader regions across London while Asian(red dots) or Black(Green dots) victims were mainly killed in central regions (less variance)","56e1b888":"# Read in Data","0dce2f49":"Boroughs with bigger population are more likely to have higher number of homicide cases where victims are females. I guess this this natural because if the population is bigger, more people are exposed to crimes like homicide. Also, IMD decile and the number of homicide cases where victims are females also has some correlation although the strength of the correlation doesn't seem to be that strong. The higher the IMD decile (presumably, the more deprived a certain borough is... need more info on this variable), the lower the number of homicide cases where victims are females.","91296414":"###### Geospatial patterns of victim profile","86198f2c":"The proportion of males is higher suspects than victims (92.4% > 76.1%)","d5632e70":"If the victim was Black, it is more likely that the case has been unsolved compared to other cases regarding White victims. If the victim was White, it is more likely that the case has been solved compared to other cases regarding victims of color. Some evidence of ethnic bias?"}}