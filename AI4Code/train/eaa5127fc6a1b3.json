{"cell_type":{"28409bd2":"code","61dcb545":"code","86fbbfeb":"code","6344281a":"code","a70a74c5":"code","d65f7b0f":"code","74f7dfc7":"code","351bd8b4":"code","2795e706":"code","31779017":"code","6ae0caf1":"code","6aa98d06":"code","80613a87":"code","126000c6":"code","b413e032":"code","35e73734":"code","75cbcdf0":"code","5cb6fcc5":"code","59918567":"code","7dcefede":"code","ad877aab":"code","3d192c4f":"code","31fd5ca6":"code","a59586ee":"markdown","d90670de":"markdown","910e2885":"markdown","3a333850":"markdown","7c57b2d4":"markdown","dde0905d":"markdown","15cda1b5":"markdown","e73e9751":"markdown","a2e42bf1":"markdown","1041eb82":"markdown","ce64a215":"markdown","4cb28030":"markdown","0d0a1a3c":"markdown","952ade94":"markdown","35ceecbc":"markdown","d2de7616":"markdown","30a0f4a1":"markdown","51950d03":"markdown","54e7c350":"markdown","a40b284d":"markdown","767c7cdc":"markdown","0b075da5":"markdown","c5223421":"markdown","3a031e29":"markdown","78925d6a":"markdown","512d10b2":"markdown","596972c0":"markdown","b51c5171":"markdown"},"source":{"28409bd2":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom matplotlib.ticker import PercentFormatter\nimport seaborn as sns\nfrom sklearn.preprocessing import StandardScaler\n\n# load the train and test data files\ntrain = pd.read_csv(\"..\/input\/santander-customer-satisfaction\/train.csv\", index_col=0)\ntest = pd.read_csv(\"..\/input\/santander-customer-satisfaction\/test.csv\", index_col=0)","61dcb545":"print(train.shape)\nprint(test.shape)","86fbbfeb":"train.head()","6344281a":"train.describe()","a70a74c5":"train.columns.values","d65f7b0f":"train.dtypes.value_counts()","74f7dfc7":"train.var3.value_counts()","351bd8b4":"# filter by top countries, excluding the most common one (2)\ntop_countries = train[(train.var3 != -999999) & (train.var3 != 2)].groupby('var3').filter(lambda x: len(x) > 80)\n\n# plot number of satisfied \/ unsatisfied customers by country\nsns.catplot(x='var3', hue='TARGET', kind='count', data=top_countries);","2795e706":"train.var15.value_counts()","31779017":"print(train[(train.var15 < 23)].shape)\nprint(train[(train.var15 < 23)].TARGET.sum())","6ae0caf1":"g = sns.catplot(x='var15', y='TARGET', kind='bar', data=train[(train.var15 > 22) & (train.var15 < 100)], aspect=3)\n\nfor ax in g.axes.flat:\n    ax.yaxis.set_major_formatter(PercentFormatter())\n\nplt.show();","6aa98d06":"train.var38.value_counts()","80613a87":"train[(train.var38 != 117310.979016494) & (train.var38 < 300000)].var38.hist(bins=20);","126000c6":"train[(train.var38 != 117310.979016494) & (train.var38 < 300000) & (train.TARGET == 1)].var38.hist(bins=20);","b413e032":"train.TARGET.value_counts(normalize=True) * 100","35e73734":"train.shape","75cbcdf0":"# return a dataset with the columns where any of the values is not 0\ntrain = train.loc[:, (train != 0).any(axis=0)]","5cb6fcc5":"train.shape","59918567":"train.var3 = train.var3.replace(-999999, 2)","7dcefede":"train.head()","ad877aab":"train.describe()","3d192c4f":"# standarize our training dataset values and convert it to a new dataframe\n# we won't standarize the TARGET feature\ntrain_scaled = StandardScaler().fit_transform(train.drop('TARGET', axis=1).values)\ntrain_scaled_df = pd.DataFrame(train_scaled, index=train.index, columns=train.drop('TARGET', axis=1).columns)\ntrain_scaled_df['TARGET'] = train['TARGET']","31fd5ca6":"train_scaled_df.to_csv('train_clean_standarized.csv')","a59586ee":"Here we can see that the most common value is actually close to the average of the rest of the mortgages. Let's look at the value of the mortgage of the unsatisfied customers:","d90670de":"## 1.3 var38: Mortgage\nAccording to some users, the **var38** corresponds to the Mortgage:","910e2885":"There are no unsatisfied customers below 23 years. Let's look at the satisfaction rate per age:","3a333850":"It doesn't look like there's a bit correlation between the country and the customer satisfaction.","7c57b2d4":"Less than **4%** of our customers are unsatisfied. We will probably need to do some resampling (either upsampling or downsampling) to balance the classes. We'll also need to take this into account while splitting our dataset in train data and test data!","dde0905d":"# 3. Standarize\nIt's recommended to standarize the data for the models we're going to build (although normalization is not required):","15cda1b5":"# Imports","e73e9751":"## 1.1 var3: Country\nAccording to some Kaggle users, the var3 feature would correspond to the customer country. Let's explore this feature:","a2e42bf1":"# Output","1041eb82":"It looks like most of the features are numerical, let's have a look at all the column names to see if they follow any naming convention:","ce64a215":"Seems that **-999999** is a placeholder when the country is unkown, we'll replace this with the most common value later (**2**, which probably corresponds to Spain). let's see ","4cb28030":"Our training dataset has 370 features. The test dataset will be used to submit the predictions to the Kaggle competition. We'll split our training dataset in training data and test data to train and validate our models.\n\nNote that according to the description of the dataset in the Kaggle competition, the TARGET variable determines if the customer is satisfied (0) or not (1). We'll look into the target feature in more detail later on.\n\nNow we're going to have a look at our training dataset and the name and data type of our features:","0d0a1a3c":"## 1.2 var15: Customer Age\nIt seems that the **var15** feature corresponds to the customer age:","952ade94":"After a first look, we can see three big groups of features:\n\n1. Features starting with **imp_**, **num_**, **saldo_**: Probably from *importe* (amount), *numerico* (numerical), and *saldo* (balance). Should be numerical.\n2. Features starting with **delta_imp_**, **delta_num_**: A feature linked and probably calculated based on the previous features. Should be numerical.\n3. Features starting with **ind_**: Looks like an index (probably categorical). Should be 1\/0.\n\nLet's verify that we only have numerical data in our dataset:","35ceecbc":"# Feature exploration and dataset preparation\n---\nIn this kernel we're going to explore and prepare the data that will be used in our models:\n\n1. Explore the dataset and look at some of the most important features with the help of some of the notebooks in Kaggle\n2. Data cleaning, remove unused features, replace null values and outliers\n3. Standarize","d2de7616":"As expected, we can see that all the features are numerical. Now let's explore some of the most important features. As most of the features have non descriptive names, we're going to rely on the information from other notebooks in Kaggle ([https:\/\/www.kaggle.com\/cast42\/exploring-features](https:\/\/www.kaggle.com\/cast42\/exploring-features)).\n\nOther than the group of features above, these are the other features in our dataset:\n\n- var3\n- var15\n- var38\n- TARGET feature","30a0f4a1":"# 1. Initial exploration and feature analysis","51950d03":"As mentioned before, our target feature is the customer satisfaction: **0** for satisfied customers and **1** for unsatisfied customers. Let's look at the distribution of the classes:","54e7c350":"We can see that customers become increasingly unsatisfied from around 23 to 40 years old.","a40b284d":"We'll use this processed dataset as the input for our models:","767c7cdc":"The most common value is 117310, which according to some users may correspond to the median value of a mortgage in Spain. Let's see the relationship between the mortgage and the customer satisfaction:","0b075da5":"# 2. Data cleaning","c5223421":"## 1.4 TARGET: Customer satisfaction","3a031e29":"## 2.2 Replace placeholder in the Country feature","78925d6a":"It seems to follow a similar distribution, and we don't see a direct relation between the amount of the mortgage and the customer satisfaction.","512d10b2":"## 2.1 Remove empty columns","596972c0":"We'll proceed to do some data cleaning before building any models:\n\n1. We've observed that some columns are empty (all zeroes), so we'll proceed to remove them.\n2. As mentioned before we'll replace the placeholder in the Country feature with the most commond country (2).","b51c5171":"Which makes sense looking at the data. The most common age is 23 years. Let's see how the age relates to the customer satisfaction:"}}