{"cell_type":{"000604f0":"code","3dd12819":"code","7913c30c":"code","f9fe6693":"code","2e072fe6":"code","118b9a7e":"code","7a5023b0":"code","d7c6cf11":"code","fdceed36":"code","1bb16193":"code","50a2c89c":"markdown","3427ade7":"markdown","44c00edc":"markdown","1d931728":"markdown","32524010":"markdown","134d3c37":"markdown","8db1b1d3":"markdown","bffedcb1":"markdown"},"source":{"000604f0":"import numpy as np\nimport pandas as pd\nimport optuna\nimport os\n\nfrom sklearn import preprocessing\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import mean_squared_log_error\n\nimport tensorflow as tf\nfrom tensorflow import keras\nfrom tensorflow.keras import layers\n\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n        \n#import the data\ntrain_data = pd.read_csv(\"..\/input\/house-prices-advanced-regression-techniques\/train.csv\")\ntest_data = pd.read_csv(\"..\/input\/house-prices-advanced-regression-techniques\/test.csv\")","3dd12819":"#set the train data\ny = train_data.SalePrice\nx = train_data.drop(columns=[\"SalePrice\",\"Id\"], axis=1)","7913c30c":"x[[i for i in x.select_dtypes(exclude=object)]] = x.select_dtypes(exclude=object).fillna(0).astype('int')\nscaler = preprocessing.MinMaxScaler().fit(x.select_dtypes(exclude=object))\nx[[i for i in x.select_dtypes(exclude=object)]] = scaler.transform(x.select_dtypes(exclude=object))","f9fe6693":"x = pd.get_dummies(x)\nx = x.reindex(columns = x.columns, fill_value=0)","2e072fe6":"x_train, x_val, y_train, y_val = train_test_split(x, y, test_size=0.02, random_state=1)\nx_train.shape, x_val.shape, y_train.shape, y_val.shape","118b9a7e":"def create_model(para_layers, para_dense, para_dropout):\n    model = keras.Sequential()\n    \n    for i in range(para_layers):\n        model.add(layers.Dense(para_dense, activation='relu'))\n        model.add(layers.Dropout(para_dropout))\n    model.add(layers.Dense(1))\n    \n    return model","7a5023b0":"# try yourself removing comment tag\n'''\ndef objective(trial):\n    tf.random.set_seed(17)\n\n    #trials\n    epochs = trial.suggest_int('epochs',90,150)\n    batch_size = trial.suggest_int('batch_size',32,72)\n    n_layer = trial.suggest_int('n_layer', 3, 7)\n    dense = trial.suggest_int('dense', 256, 1024)\n    dropout = trial.suggest_uniform('dropout',0.3,0.8)\n    \n    #get the model\n    model = create_model(n_layer, dense, dropout)\n    \n    model.compile(\n        optimizer=\"adam\",\n        loss='mean_squared_logarithmic_error',\n        metrics=['mean_squared_logarithmic_error'],\n    )\n\n    #train\n    history = model.fit(\n        x_train, y_train,\n        batch_size = batch_size,\n        epochs = epochs,\n        validation_data=(x_val, y_val),\n        verbose=0\n    )\n\n    return np.sqrt(mean_squared_log_error(model.predict(x_val), y_val))\n\n# trial on parameter optimization\nstudy = optuna.create_study()\nstudy.optimize(objective, n_trials=2)\n\nprint(\"study.best_trial: {}\".format(study.best_trial))\n'''","d7c6cf11":"tf.random.set_seed(17)\n\n#value 0.0955187237646741\nepochs = 100\nbatch_size = 65\nn_layer = 5\ndense = 467\ndropout = 0.6182326089265743\n\n# directly get the best result from optuna result\n'''\nepochs = study.best_params['epochs']\nbatch_size = study.best_params['batch_size']\nn_layer = study.best_params['n_layer']\ndense = study.best_params['dense']\ndropout = study.best_params['dropout']\n'''\n\nmodel = create_model(n_layer, dense, dropout)\n\nmodel.compile(\n    optimizer=\"adam\",\n    loss='mean_squared_logarithmic_error',\n    metrics=['mean_squared_logarithmic_error'],\n)\n\nhistory = model.fit(\n    x_train, y_train,\n    batch_size = batch_size,\n    epochs = epochs,\n    validation_data=(x_val, y_val),\n    verbose=0\n)\n\nmsle = np.sqrt(mean_squared_log_error(model.predict(x_val), y_val))\nprint(msle)","fdceed36":"x_test = test_data.drop(columns=[\"Id\"], axis=1)\nx_test[[i for i in x_test.select_dtypes(exclude=object)]] = scaler.transform(x_test.select_dtypes(exclude=[object]).fillna(0).astype('int'))\nx_test = pd.get_dummies(x_test)\nx_test = x_test.reindex(columns = x.columns, fill_value=0)","1bb16193":"preds = model.predict(x_test)\npreds_2 = [i[0] for i in preds]\nout = pd.DataFrame({'Id': test_data['Id'], 'SalePrice': preds_2}) \nout.to_csv('submission.csv',index=False)","50a2c89c":"## SCALING THE DATA\nFilling NaN and scaling to limited range","3427ade7":"## Reference\nHouse Prices - Regression Techniques Submission  \nhttps:\/\/www.kaggle.com\/omkaarp\/house-prices-regression-techniques-submission\n\nHouse prices. Keras NN with data augmentation.  \nhttps:\/\/www.kaggle.com\/paveltrusov\/house-prices-keras-nn-with-data-augmentation","44c00edc":"Split data to training and validation","1d931728":"## MAKE THE MODEL and FIND THE PARAMETERS\nParameterize the model and find optimized parameters using bayesian optimization","32524010":"## TEST DATA","134d3c37":"## IMPORT","8db1b1d3":"## MAKE SUBMISSION DATA","bffedcb1":"Convert category to number"}}