{"cell_type":{"0c2f0a38":"code","b474f1f2":"code","d1e66fd7":"code","dbe38a60":"code","f571f42c":"code","1476ec69":"code","8d5dae02":"code","ee58bad9":"code","eaaa0eff":"code","318b910b":"code","b60f6829":"code","da9e5c7a":"code","d2a6aec4":"code","3db35ba0":"code","4a57b880":"code","989b0121":"code","a71710bd":"code","73402013":"code","48efbf86":"code","9047bbd8":"code","fc52a1a0":"code","3ee1c508":"code","11e00802":"code","346ddcc1":"code","6ecc5a39":"code","370bba2e":"code","00ee7f9e":"code","4523d436":"code","0a7d6348":"code","be1538b5":"code","ce357025":"code","9e1202c6":"code","f8a16cb7":"code","499c5cd7":"code","e1f00763":"code","919f4e9d":"code","5d5595d3":"code","2adcd470":"markdown","a1255c63":"markdown","6c3f81bd":"markdown","4dd28e14":"markdown","66380c65":"markdown","06a7b652":"markdown","75211c79":"markdown","d136bdca":"markdown","f3495da3":"markdown","c6636fc8":"markdown","0a9e1881":"markdown","244d5f8a":"markdown","810d67d9":"markdown","0a30f2be":"markdown","582bc6a8":"markdown","985c8c45":"markdown","48b4eed2":"markdown","9cbc1f1d":"markdown","c2c8ac08":"markdown","6a4df49c":"markdown","6f6bff71":"markdown","b2cee61d":"markdown","792b4daf":"markdown","809810fe":"markdown","2598ea73":"markdown","befed081":"markdown","ab984fe6":"markdown","cf96198f":"markdown","97960ec8":"markdown","a0105830":"markdown","73841638":"markdown","01f91a26":"markdown","e73d64c7":"markdown","baf042d5":"markdown","8a912578":"markdown","76b590fa":"markdown","c19ae7bc":"markdown","e80ba147":"markdown","a1d4c4b3":"markdown","4fd3dfb5":"markdown","7d245d0a":"markdown","8285a40e":"markdown","4ba6c316":"markdown"},"source":{"0c2f0a38":"# Let's import some essentials\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom scipy import stats","b474f1f2":"df = pd.read_csv(\"..\/input\/crimes-in-boston\/crime.csv\",encoding='latin-1')\ndf.head(5)","d1e66fd7":"df = df.drop(\"Location\", axis = 1)","dbe38a60":"df = df.drop([\"INCIDENT_NUMBER\", \"OFFENSE_CODE\"], axis = 1)\ndf.head(5)","f571f42c":"df['SHOOTING'].describe()","1476ec69":"df[\"SHOOTING\"].isna().sum()","8d5dae02":"df[\"SHOOTING\"].fillna('N', inplace=True)\ndf.head(5)","ee58bad9":"df.OFFENSE_CODE_GROUP.isna().sum()","eaaa0eff":"years = [2015, 2016, 2017, 2018]\nfor year in years:\n    print(df[df[\"YEAR\"] == year][\"MONTH\"].unique())","318b910b":"time_list = [\"HOUR\", \"DAY_OF_WEEK\", \"MONTH\", \"OCCURRED_ON_DATE\"]\nfor item in time_list:\n    print(\"No. of NaNs in {} = {}\".format(item, df[item].isna().sum()))","b60f6829":"locations_list = [\"DISTRICT\", \"REPORTING_AREA\", \"STREET\", \"Lat\", \"Long\"]\nfor item in locations_list:\n    print(\"No. of NaNs in {} = {}\".format(item, df[item].isna().sum()))","da9e5c7a":"df[\"Long\"].describe()","d2a6aec4":"df[\"Lat\"].replace(-1, None, inplace=True)\ndf[\"Long\"].replace(-1, None, inplace=True)\n(df[\"Long\"].isna()).sum()","3db35ba0":"def plot_quantitative(df, col1=None, col2=None, hue=None, k=10, palette=None):\n    if col2 == None:\n        col2 = col1\n    sns.catplot(x=col1, y=col2, kind='count', height=8, aspect=1.5,\n                order=df[col2].value_counts().index[0:k],\n                hue=hue, data=df, palette=palette)\n    plt.show()","4a57b880":"plot_quantitative(df, None, \"OFFENSE_CODE_GROUP\", None, 10)","989b0121":"df_part_one = df[df[\"UCR_PART\"] == \"Part One\"]\ndf_part_two = df[df[\"UCR_PART\"] == \"Part Two\"]\ndf_part_three = df[df[\"UCR_PART\"] == \"Part Three\"]\nplt.figure(figsize=(14, 7))\nplt.subplots_adjust(bottom=0.0001, left=0.01, wspace=0.35, hspace=0.35)\ncol = \"OFFENSE_CODE_GROUP\"\nk = 5\nplt.subplot(221)\nplt.title('Part One crimes')\nplt.ylabel('OFFENSE_CODE_GROUP')\nsns.countplot(y=col, data=df_part_one, hue=\"YEAR\", order=df_part_one[col].value_counts().index[0:k])\nplt.subplot(222)\nplt.title('Part Two crimes')\nplt.ylabel(' ')\nsns.countplot(y=col, data=df_part_two, hue=\"YEAR\", order=df_part_two[col].value_counts().index[0:k])\nplt.subplot(223)\nplt.title('Part Three crimes')\nplt.ylabel(' ')\nsns.countplot(y=col, data=df_part_three, hue=\"YEAR\", order=df_part_three[col].value_counts().index[0:k])\nplt.show()","a71710bd":"hue = \"YEAR\"\ncol1 = \"OFFENSE_CODE_GROUP\"\nplot_quantitative(df, None, col1, hue, 10)","73402013":"(df[df[\"OFFENSE_CODE_GROUP\"] == \"Towed\"][\"YEAR\"] == 2017).sum()","48efbf86":"def construct_crosstab(col1_name, col2_name):\n    ct = pd.crosstab(df[col1_name], df[col2_name])\n    return ct","9047bbd8":"ct = construct_crosstab(\"YEAR\", \"OFFENSE_CODE_GROUP\")","fc52a1a0":"chi2, pvalue, dof, _ = stats.chi2_contingency(ct)","3ee1c508":"pvalue","11e00802":"def cramersV(chi2, num_samples, num_rows_in_ct, num_cols_in_ct):\n    squared_phi = chi2\/num_samples\n    squared_phi_corr = max(0, squared_phi - ((num_cols_in_ct-1)*(num_rows_in_ct-1))\/(num_samples-1))    \n    row_corr = num_rows_in_ct - ((num_rows_in_ct-1)**2)\/(num_samples-1)\n    col_corr = num_cols_in_ct - ((num_cols_in_ct-1)**2)\/(num_samples-1)\n    return np.sqrt(squared_phi_corr \/ min( (col_corr-1), (row_corr-1)))\n\ndef compute_degree_of_relatedness(col1, col2):\n    ct = construct_crosstab(col1, col2)\n    chi2, pvalue, dof, _ = stats.chi2_contingency(ct)\n    num_samples = ct.sum().sum()\n    num_rows, num_cols = ct.shape\n    return cramersV(chi2, num_samples, num_rows, num_cols)","346ddcc1":"degree_year = compute_degree_of_relatedness(\"YEAR\", \"OFFENSE_CODE_GROUP\")\ndegree_year","6ecc5a39":"df['OCCURRED_ON_DATE'] = pd.to_datetime(df['OCCURRED_ON_DATE'])\ndf.head(10)","370bba2e":"df[\"QUARTER\"] = df[\"OCCURRED_ON_DATE\"].dt.quarter","00ee7f9e":"hue = \"QUARTER\"\ncol1 = \"OFFENSE_CODE_GROUP\"\nplot_quantitative(df, None, col1, hue, 10)","4523d436":"degree_quarter = compute_degree_of_relatedness(\"QUARTER\", \"OFFENSE_CODE_GROUP\")\ndegree_quarter","0a7d6348":"hue = \"MONTH\"\ncol1 = \"OFFENSE_CODE_GROUP\"\nplot_quantitative(df, None, col1, hue, 10, \"bright\")","be1538b5":"degree_month = compute_degree_of_relatedness(\"MONTH\", \"OFFENSE_CODE_GROUP\")\ndegree_month","ce357025":"degree_hour = compute_degree_of_relatedness(\"HOUR\", \"OFFENSE_CODE_GROUP\")\ndegree_hour","9e1202c6":"loc_list = [\"STREET\", \"REPORTING_AREA\", \"DISTRICT\", \"Lat\", \"Long\"]\ndegree = []\nfor loc in loc_list:\n    degree.append(compute_degree_of_relatedness(loc, \"OFFENSE_CODE_GROUP\"))\ndegree","f8a16cb7":"import folium\nfrom folium.plugins import MarkerCluster\n\nplot_data = df[df['UCR_PART'] == 'Part One'].dropna(axis = 0)\nboston_crime_map = folium.Map(location = [plot_data['Lat'].mean(), \n                                          plot_data['Long'].mean()], \n                            zoom_start = 11\n                             )\nmc = MarkerCluster()\nfor row in plot_data.itertuples():\n    mc.add_child(folium.Marker(location = [row.Lat,  row.Long]))\n\nboston_crime_map.add_child(mc)\n\nboston_crime_map","499c5cd7":"df[df.UCR_PART == 'Part One']['STREET'].value_counts()[:10]","e1f00763":"df[df.UCR_PART == 'Part One']['STREET'].value_counts()[-10:]","919f4e9d":"df[df.UCR_PART != 'Part One']['STREET'].value_counts()[:10]","5d5595d3":"df['STREET'].value_counts()[:10]","2adcd470":"## Answering question 3: Which are the dangerous and safe areas in Boston? \n\n### Visualizing on a map\n\nNow let's seen the locations of the occurence of serious crimes.","a1255c63":"## Statistical tests for multivariate analysis\n** $\\chi^2$ test of independence **\n \n $H_0$ : There is no relationship between YEAR and OFFENSE_CODE_GROUP\n \n 1. Construct the crosstab for the two variables.","6c3f81bd":"** Testing degree of correlation between categorical variables **\n\nWe just saw that YEAR and OFFENSES_CODE_GROUP are related, but we do not know to what degree. Cramer's V gives out a degree of correlatedness. Let's try that.","4dd28e14":"Now let's read in the data.","66380c65":"Next we have variables like INCIDENT_NUMBER and OFFENSE_CODE, which serve no purpose in answering our questions. So, let's get rid of them too.","06a7b652":"2. Compute chi-square statistic and pvalue.","75211c79":"DISTRICT and STREET have missing values. REPORTING_AREA looks like a good variable to consider, since it has no missing values. But, let's also have a look at Lat and Long.","d136bdca":"The above plot clearly shows certain areas of Boston where the number of serious crimes are high.\n\n*Observations*\n\n* Areas near the financial district appear to have many serious crimes.\n* Certain parts of Boston like Pond Street have very few serious crimes.\n\nNow let's get then names of streets with high crime rate and those with low crime rates.","f3495da3":"Regardless of the type of crimes, the following streets have the majority of crimes reported in Boston.","c6636fc8":"*** Inferences ***\n\n* The least amount of offenses occur in the year 2015 except in one.\n* The year 2016 seems to have more crimes than 2015, but lesser crimes than 2017.\n* In almost all offenses, the year 2017 seems to have the majority of crimes.\n* 2018 exhibits a decline in crimes.\n\n*** Correctness of the inferences *** [TODO]\n\n* 2015 and 2018 do not have data for all months. So the previous conclusions need not be true.","0a9e1881":"*** Location *** variables: DISTRICT, REPORTING_AREA, STREET, Lat, Long, Location","244d5f8a":"Most of the entries are NaNs, but there are a few 'Y's in there too. But according to the descriptions of the variables in the table given above, NaN corresponds to \"no shooting\" incident. So let's change NaN to 'N'.","810d67d9":"## ** Understanding the variables **\n\n*** This data was obtained from [this](https:\/\/data.boston.gov\/dataset\/crime-incident-reports-august-2015-to-date-source-new-system\/resource\/9c30453a-fefa-4fe0-b51a-5fc09b0f4655?view_id=380adcd5-c841-4320-a9fa-604e7a6a94f5) link. ***\n![description.png](attachment:description.png)\n","0a30f2be":"**Conclusion:**\n\nIn the serious offenses category, significant (>=4000) occurences of larceny are observed in all years.\nIn the less serious offenses category, significant (> 4000) occurences of the crimes shown in the above plots are observed.\n\nLocation variables seem to be more correlated to the type of crime than the Time variables, in particular the variable STREET.\nAmong the other location variables, Latitude and Longitude also appear to be related to the type of crime.\n    \nAreas near the financial district appear to have many serious crimes.\nCertain parts of Boston like Pond Street have very few serious crimes.\n\nBUSTBUY, LONG WHRF, ARLINGTON AVE etc have the lowest number of serious crimes.\nWASHINGTON ST, BOYLSTON ST, BLUE HILL AVE etc have the largest number of serious crimes.\nRegardless of the type of crimes, WASHINGTON ST, BLUE HILL AVE, BOYLSTON ST, DORCHESTER AVE streets have the majority of crimes reported in Boston.","582bc6a8":"## ** Multivariate Analysis **\n\nNow let's see the relation between YEAR and OFFENSE_CODE_GROUP.","985c8c45":"** Result of analysis of ** *** Time *** ** variables **\n\n* The variable HOUR seems to have the most correlation to the OFFENSES_CODE_GROUP","48b4eed2":"** Analysis of ** *** Location *** ** based variables **","9cbc1f1d":"So it turns out that Lat and Long are more related to the target variable than the others.\n\n*** Observations ***\n\n* ***Location*** variables seem to be more correlated to OFFENSE_CODE_GROUP that the ***Time*** variables, in particular the variable STREET.\n* Among the other location variables, Lat and Long also appear to be related to OFFENSE_CODE_GROUP.","c2c8ac08":"Cramer's V for MONTH and OFFENSES_CODE_GROUP","6a4df49c":"# **Analysis of Boston crime reports**\n\nWe are about to embark on a journey to explore the crime reports recorded in Boston. \n\nIn particular, we answer the following questions:\n1. What types of crimes are most common? \n2. How are they related to Location and Time?\n3. Which are the dangerous and safe areas in Boston?","6f6bff71":"Computing Cramer's V for QUARTER and OFFENSES_CODE_GROUP","b2cee61d":"Now, that's interesting! WASHINGTON ST still appears in this list. Looks like it has a very high number of crimes in general. In addition there are streets like BOYLSTON ST that have large number of less serious offenses, which were found to have the least number of serious offenses.","792b4daf":"*Observations*\n\n* In the serious offenses category, significant ($\\geq 4000$) occurences of larceny are observed in all years.\n* In the less serious offenses category, significant ($\\geq 4000$) occurences of the crimes shown in the above plots are observed.\n","809810fe":"## Answering question 2: How are they related to Location and Time?\n\nWe perform some analysis on the variables in order to arrive at an answer to question part 2.","2598ea73":"### ** Univariate Analysis **\n\n*** Visualizations ***\n\nWe can start with plotting the histogram of a variable like \"OFFENSE_CODE\". The plot will not be too clear because we have 67 types of offenses in total. Let's just take the top 10 most frequent and plot their histogram.","befed081":"* Complete data is available for the years 2016 and 2017.\n* 2015 : data available from June onwards, 2018: data available till September.","ab984fe6":"Moving on to MONTH","cf96198f":"## Answering question 1: What types of crime are most common?\n\nThe above plot shows the top 10 most frequent crimes in Boston. They are Motor Vehicle Accident, Larceny, Medical Assistance, Investigate Person, Other, Drug Violation, Simple Assault, Vandalism, Verbal Disputes, Towed.\n\nNext we take a look at the UCR_PART variable of the top 10 most frequent crimes. According to [UCR](https:\/\/www.ucrdatatool.gov\/offenses.cfm), offenses with Part One tag are among the serious crimes, those with the tag Part Two and Three are less serious crimes.\n\nUsing this info, let's create a histogram showing the top 5 crimes in each category.","97960ec8":"The pvalue is less than 0.05, so we reject $H_0$. Thus YEAR and OFFENSE_CODE_GROUP are related.","a0105830":"HOUR vs OFFENSES_CODE_GROUP","73841638":"Other *** Time *** variables: HOUR, DAY_OF_WEEK, MONTH, OCCURRED_ON_DATE","01f91a26":"*** Examining the YEAR variable ***","e73d64c7":"Summary: \n\n* BUSTBUY, LONG WHRF, ARLINGTON AVE etc have the lowest number of serious crimes.\n* WASHINGTON ST, BOYLSTON ST, BLUE HILL AVE etc have the largest number of serious crimes.\n\nNow let's look at the less serious crimes.","baf042d5":"### **Missing Values **\n\nThe column SHOOTING appears to have nothing but NaN values. Let's confirm that.","8a912578":"1. 3. If pvalue is less than 0.05, reject $H_0$.","76b590fa":"### ** Removing less useful variables**\n\nBy observing the variables, it can be easily deduced that the Location variable is just storing the concatenation of the Lat and Long, so let's get rid of this.","c19ae7bc":"A plot of the number of offenses in each quarter will be useful in giving us some idea about whether this variable is related to the offense type.","e80ba147":"NaNs may also occur in other variables. So, let's check that.","a1d4c4b3":"This graph plots the count of the incident I for any year Y, to check try the following code.","4fd3dfb5":"So I have identified three categories of variables here. \n1. *Location* variables like DISTRICT, REPORTING_AREA, STREET, Lat, Long, Location \n2. *Nature* of the crime like OFFENSE_CODE, OFFENSE_CODE_GROUP, OFFENSE_DESCRIPTION, UCR_PART\n3. *Time* variables like OCCURED_ON_DATE, YEAR, MONTH, DAY_OF_WEEK, HOUR\n\nIntuitively, 1. and 2. will influence the kind as well as frequency of crimes.","7d245d0a":"This value is pretty low, which indicates lesser degree of correlatedness.\n\nNow let's consider other ***Time*** variables.\n\nThe next logical time division is a quarter of a year, obtained as follows.\n* Q1 = [Jan, Mar]\n* Q2 = [Apr, Jun]\n* Q3 = [Jul, Sep]\n* Q4 = [Oct, Dec]","8285a40e":"*** Adding a new column \"QUARTER\" to df ***\n\nPandas has an easy way of extracting the quarter information (using Series.dt.quarter) from a datetime object. First we must convert the OCCURRED_ON_DATE to datetime format.","4ba6c316":"Lat is assigned to -1 to indicate an absence. Similarly, for Long, -1 indicates absence. Let's replace -1 with None."}}