{"cell_type":{"78522ffa":"code","0e3decf9":"code","d18575da":"code","de9ec354":"code","687c4974":"code","172e13fa":"code","b37aee14":"code","f1e1f1a5":"code","d9dea78b":"code","d3979f67":"code","66893513":"code","19e06e9e":"code","4b459373":"code","631181ab":"code","2a0ce029":"code","af8faa82":"code","5058b24d":"code","b2a392d2":"code","9a96be3b":"code","aeed852c":"code","e6c79fe6":"code","9223646d":"code","755a10f3":"code","ab6ec093":"code","e2a96d72":"code","bfe76401":"code","9b9ef062":"code","69f52b87":"markdown","65897657":"markdown","8d40529a":"markdown","73cc4cad":"markdown","e06a0640":"markdown","7b0d1d89":"markdown","aeb699c1":"markdown","7590c523":"markdown","d081d24b":"markdown","5acf9041":"markdown","660424e7":"markdown","27ebbaa2":"markdown","06181c9a":"markdown","20350db2":"markdown","482799ff":"markdown","c7387c3f":"markdown","45d9e02c":"markdown","4ac25ff5":"markdown","3f9e52d8":"markdown","074fd8ae":"markdown","bc3429c1":"markdown","e6bc25b3":"markdown","d6fd233f":"markdown","f6da677f":"markdown","ed702b87":"markdown","4b8d0f1a":"markdown"},"source":{"78522ffa":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","0e3decf9":"import matplotlib.pyplot as plt\nimport seaborn as sns\n\n\nimport scipy.stats as stats\nfrom statsmodels.formula.api import ols\nimport statsmodels.api as sm\nfrom scipy.stats import mannwhitneyu \n\nfrom sklearn.feature_selection import f_regression\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import StandardScaler, MinMaxScaler , PolynomialFeatures\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.ensemble import RandomForestRegressor\n\nfrom sklearn.metrics import r2_score,mean_squared_error\n","d18575da":"path = \"\/kaggle\/input\/insurance\/insurance.csv\"\ndf = pd.read_csv(path)","de9ec354":"df.info()","687c4974":"df.describe()","172e13fa":"print(df['smoker'].value_counts())\nprint('='*30)\nprint(df['region'].value_counts())\nprint('='*30)\nprint(df['sex'].value_counts())","b37aee14":"plt.figure(figsize=(10,10))\nplt.suptitle(\"Concentration of smokers and non-smokers across regions\",fontsize = 18)\nplt.title(\"Fig : 1\",fontsize = 15)\n\nsns.countplot(x = 'region',hue='smoker', data=df)","f1e1f1a5":"plt.figure(figsize=(10,10))\nsns.distplot(df['age'],color='r')\nplt.suptitle(\"Distribution of Age Across Population\", fontsize = 18)\nplt.title(\"Fig : 2\",fontsize = 15)","d9dea78b":"labels = ['0','1','2','3','4','5']\n\nsizes = [df['children'].value_counts()[0],\n        df['children'].value_counts()[1],\n        df['children'].value_counts()[2],\n        df['children'].value_counts()[3],\n        df['children'].value_counts()[4],\n        df['children'].value_counts()[5]]\n\nplt.figure(figsize=(10,10))\nplt.pie(sizes, labels=labels, autopct='%1.1f%%', shadow=True)\nplt.suptitle(\"Percentage Distribution of Number of Children\", fontsize = 18)\nplt.title(\"Fig : 3\",fontsize = 15)\nplt.show()","d3979f67":"plt.figure(figsize=(20,20))\nsns.catplot(x='smoker',\n           kind = 'count',\n           data = df,\n           hue = 'sex')\nplt.suptitle(\"Number of Smokers and Non-Smokers acorss Genders\", fontsize = 18)\nplt.title(\"Fig : 4\",fontsize = 15)","66893513":"sns.catplot(x = 'smoker',\n           kind = 'count',\n           data = df,\n           hue = 'children')\nplt.suptitle(\"Number of Smokers and Non-Smokers based on Number of children\", fontsize = 18)\nplt.title(\"Fig : 5\",fontsize = 15)","19e06e9e":"plt.figure(figsize=(15,15))\nsns.scatterplot(x='bmi',\n                y= 'charges',\n                hue = 'smoker',\n                data = df)\nplt.suptitle(\"BMI Vs CHARGES for Smoker and Non-Smoker\", fontsize = 18)\nplt.title(\"Fig : 6\",fontsize = 15)","4b459373":"plt.figure(figsize=(15,15))\nsns.scatterplot(x = 'bmi',\n            y= 'charges',\n            data = df,\n            hue = 'children',\n            palette = 'magma')\nplt.suptitle(\"BMI Vs CHARGES for Number of Children\", fontsize = 18)\nplt.title(\"Fig : 7\",fontsize = 15)","631181ab":"plt.figure(figsize=(15,15))\nsns.scatterplot(x = 'age',\n                y = 'charges',\n                hue = 'smoker',\n                data = df)\nplt.suptitle(\"AGE Vs CHARGES for Smoker and Non-Smoker\", fontsize = 18)\nplt.title(\"Fig : 8\",fontsize = 15)","2a0ce029":"# defining the sample dataset\nsample_df = df.sample(100)","af8faa82":"model_age = ols(\"charges ~ age\",data= sample_df).fit()     #.ols() function\nmodel_bmi = ols(\"charges ~ bmi\",data = sample_df).fit()","5058b24d":"print(model_bmi.summary())\nprint(\"_\"*100)\nprint(\"_\"*100)\nprint(model_age.summary())","b2a392d2":"stats_age, p_age = mannwhitneyu(sample_df.charges, sample_df.age)\nstats_bmi, p_bmi = mannwhitneyu(sample_df.charges, sample_df.bmi)\n\npd.DataFrame({'Age': [stats_age, p_age],\n             'Bmi': [stats_bmi, p_age]},\n             index = ['stats','p_value'])","9a96be3b":"sample_df = pd.get_dummies(sample_df,drop_first=False)","aeed852c":"sample_df.columns","e6c79fe6":"X = sample_df[['children','sex_female', 'sex_male',\n       'smoker_no', 'smoker_yes', 'region_northeast', 'region_northwest',\n       'region_southeast', 'region_southwest']]\nY = sample_df['charges']\n\nstats , p_value = f_regression(X,Y)\n\npd.DataFrame({'Stats': stats,\n             'P_Value': p_value},\n             index = ['children','sex_female', 'sex_male',\n       'smoker_no', 'smoker_yes', 'region_northeast', 'region_northwest',\n       'region_southeast', 'region_southwest']).sort_values(by='P_Value',ascending=True)\n","9223646d":"df = df[['age','bmi','smoker','charges']]\ndf = pd.get_dummies(df, drop_first=True)\n\nX = df.loc[:,['age','bmi','smoker_yes']]\nY = df.loc[:,'charges'].values","755a10f3":"train_X, test_X, train_Y , test_Y = train_test_split(X,Y, test_size = 0.2 , random_state = 0)","ab6ec093":"lr = LinearRegression()\nlr.fit(train_X,train_Y)","e2a96d72":"pred_y = lr.predict(test_X)","bfe76401":"quad = PolynomialFeatures (degree = 2)\nx_quad = quad.fit_transform(X)\n\nX_train,X_test,Y_train,Y_test = train_test_split(x_quad,Y, random_state = 0)\n\nplr = LinearRegression().fit(X_train,Y_train)\n\nY_train_pred = plr.predict(X_train)\nY_test_pred = plr.predict(X_test)\n\nprint(plr.score(X_test,Y_test))","9b9ef062":"forest = RandomForestRegressor(n_estimators = 100,\n                              criterion = 'mse',\n                              random_state = 1,\n                              n_jobs = -1)\nforest.fit(X_train,Y_train)\nforest_train_pred = forest.predict(X_train)\nforest_test_pred = forest.predict(X_test)\n\n\npd.DataFrame({\n                'Train':[r2_score(Y_train,forest_train_pred),mean_squared_error(Y_train,forest_train_pred)],\n                'Test' : [r2_score(Y_test,forest_test_pred),mean_squared_error(Y_test,forest_test_pred)]},\n                index=['R2_Score','MSE'],)\n                ","69f52b87":"# Importing necessary libraries","65897657":"We see that most of the population are non smokers. We can also conclude that distribution of population is **uniform across all regions and genders**","8d40529a":"To perform statistical analysis on the given set of data, we shall consider the a sample set of 100 records","73cc4cad":"Let's see the number of smoker and non smoker patients","e06a0640":"## Ordinary Least Square Analysis (OLS)\n\nIn statistics, ordinary least squares (OLS) is a type of linear least squares method for estimating the unknown parameters in a linear regression model. OLS chooses the parameters of a linear function of a set of explanatory variables by the principle of least squares: minimizing the sum of the squares of the differences between the observed dependent variable (values of the variable being observed) in the given dataset and those predicted by the linear function of the independent variable.\n\nGeometrically, this is seen as the sum of the squared distances, parallel to the axis of the dependent variable, between each data point in the set and the corresponding point on the regression surface\u2014the smaller the differences, the better the model fits the data. The resulting estimator can be expressed by a simple formula, especially in the case of a simple linear regression, in which there is a single regressor on the right side of the regression equation.","7b0d1d89":"# Loading Dataset","aeb699c1":"## BIVARIATE ANALYSIS","7590c523":"## MULTIVARIATE ANALYSIS","d081d24b":"Since the **P_value of both Age and BMI is below 0.05** we can reject the null hypothesis.\n* It can be concluded that age has influence on the charges a cosumer pays towards insurance. \n* Older coustomer tend to pay more towards medical insurance compare to younger customers.","5acf9041":"It can be observed that **SMOKERS with HIGH BMI** suffering from obesity are likely to **pay higher charges** compared to **NON SMOKERS with HIGH BMI**. ","660424e7":"# STATISTIC ANALYSIS","27ebbaa2":"# Modeling the data","06181c9a":"# Pre-modeling Tasks","20350db2":"# F TEST\n\nF Test also called as one sample ANOVA is carried out to identify the dependency of t categorical variables. Here I assume my null hypothesis as that the smoking habits donot have infulence on the charges paid by customer towards meidcal insurance.\nLets see what the results of the F_test have to say about this assumption !!","482799ff":"It is clearly observed that **smoking habits have a P_Value < 0.05**. Hence,we can reject the null hypothesis and conclude\n* Smoking habits have a stong influence on the charges payed towards medical insurance, \n","c7387c3f":"# EXPLORATORY DATA ANALYSIS","45d9e02c":"From our ***statistical analysis*** it is observed that \n* Age , Smoking habits and BMI have a significant influence on the insurance charges","4ac25ff5":"**SMOKERS** tend to **spend more on charges** as they grow older **compared to NON SMOKERS**","3f9e52d8":"Conclusions from the OLS analysis:\n* BMI is a statictically significant variable with P_Value = 0.014 i.e. less than 0.05 .\n* Age is a statictically significant variable with P_Value = 0.00 i.e. less than 0.05 .","074fd8ae":"A vast majority of the population has 0 or 1 kid in the house. There are **31.8%** of household with more than 1 children. ","bc3429c1":"## VARIABLE DESCRIPTION","e6bc25b3":"## Man Whiteny Test\n\nHere I hvave chosen Man whitney Test because the **frequncy distribution of Age and BMI is not normal** preventing us from using the popolation parameters( mean , Standard Deviation and Variance) to carry out the hypothesis testing.Such variables with skewed distribution are called **Non Parametric Variable** and test conducted on such variables are called **Non-Parametric Tests**. The Man whiteny test is carried out to compare samples of two independent variables and determine their statistical significance. This returns the test statistic and the P_value of the variable based on which we can draw conclusions. ","d6fd233f":"Among the population of smokers majority of them are **MALE have 0 or 1 children**","f6da677f":"## POPULATION DISTRIBUTION","ed702b87":"It can be observed that patients with **HIGH BMI and 0-2 children** are likely to **pay higher charges** compared to patients with **HIGH BMI and more than 3 children**.","4b8d0f1a":"The population of smokers is slightly concentrated in the **southeastern** part of the region. "}}