{"cell_type":{"c19489dd":"code","b3f3de93":"code","4ea211d4":"code","969edfe0":"code","9d8d4909":"code","da52647c":"code","817f5d5b":"code","7258bfcf":"code","06ba96ef":"code","c8bdcdaa":"code","7031a646":"code","0c687324":"code","69bba0b4":"code","429de878":"code","3ab1a108":"code","f13681ca":"code","dc5b3f07":"code","089f62e1":"code","643f0103":"code","b355f23f":"markdown","3405b98a":"markdown","2cb2fce7":"markdown"},"source":{"c19489dd":"%matplotlib inline\n\nimport os\nimport pandas as pd\nimport seaborn as sns\n\nfrom sklearn.externals import joblib\nfrom tqdm import tqdm_notebook as tqdm","b3f3de93":"application = pd.read_csv('..\/input\/application_train.csv')\nprevious_application = pd.read_csv('..\/input\/previous_application.csv')","4ea211d4":"previous_application.head()","969edfe0":"PREVIOUS_APPLICATION_AGGREGATION_RECIPIES = []\nfor agg in ['mean', 'min', 'max', 'sum', 'var']:\n    for select in ['AMT_ANNUITY',\n                   'AMT_APPLICATION',\n                   'AMT_CREDIT',\n                   'AMT_DOWN_PAYMENT',\n                   'AMT_GOODS_PRICE',\n                   'CNT_PAYMENT',\n                   'DAYS_DECISION',\n                   'HOUR_APPR_PROCESS_START',\n                   'RATE_DOWN_PAYMENT'\n                   ]:\n        PREVIOUS_APPLICATION_AGGREGATION_RECIPIES.append((select, agg))\nPREVIOUS_APPLICATION_AGGREGATION_RECIPIES = [(['SK_ID_CURR'], PREVIOUS_APPLICATION_AGGREGATION_RECIPIES)]","9d8d4909":"groupby_aggregate_names = []\nfor groupby_cols, specs in tqdm(PREVIOUS_APPLICATION_AGGREGATION_RECIPIES):\n    group_object = previous_application.groupby(groupby_cols)\n    for select, agg in tqdm(specs):\n        groupby_aggregate_name = '{}_{}_{}'.format('_'.join(groupby_cols), agg, select)\n        application = application.merge(group_object[select]\n                              .agg(agg)\n                              .reset_index()\n                              .rename(index=str,\n                                      columns={select: groupby_aggregate_name})\n                              [groupby_cols + [groupby_aggregate_name]],\n                              on=groupby_cols,\n                              how='left')\n        groupby_aggregate_names.append(groupby_aggregate_name)","da52647c":"application.head()","817f5d5b":"application_agg = application[groupby_aggregate_names + ['TARGET']]\napplication_agg_corr = abs(application_agg.corr())","7258bfcf":"application_agg_corr.sort_values('TARGET', ascending=False)['TARGET']","06ba96ef":"numbers_of_applications = [1, 3, 5]","c8bdcdaa":"features = pd.DataFrame({'SK_ID_CURR': previous_application['SK_ID_CURR'].unique()})\nprev_applications_sorted = previous_application.sort_values(['SK_ID_CURR', 'DAYS_DECISION'])","7031a646":"group_object = prev_applications_sorted.groupby(by=['SK_ID_CURR'])['SK_ID_PREV'].nunique().reset_index()\ngroup_object.rename(index=str,\n                    columns={'SK_ID_PREV': 'previous_application_number_of_prev_application'},\n                    inplace=True)\nfeatures = features.merge(group_object, on=['SK_ID_CURR'], how='left')","0c687324":"prev_applications_sorted['previous_application_prev_was_approved'] = (\n        prev_applications_sorted['NAME_CONTRACT_STATUS'] == 'Approved').astype('int')\ngroup_object = prev_applications_sorted.groupby(by=['SK_ID_CURR'])[\n    'previous_application_prev_was_approved'].last().reset_index()\nfeatures = features.merge(group_object, on=['SK_ID_CURR'], how='left')","69bba0b4":"prev_applications_sorted['previous_application_prev_was_refused'] = (\n        prev_applications_sorted['NAME_CONTRACT_STATUS'] == 'Refused').astype('int')\ngroup_object = prev_applications_sorted.groupby(by=['SK_ID_CURR'])[\n    'previous_application_prev_was_refused'].last().reset_index()\nfeatures = features.merge(group_object, on=['SK_ID_CURR'], how='left')","429de878":"for number in numbers_of_applications:\n    prev_applications_tail = prev_applications_sorted.groupby(by=['SK_ID_CURR']).tail(number)\n\n    group_object = prev_applications_tail.groupby(by=['SK_ID_CURR'])['CNT_PAYMENT'].mean().reset_index()\n    group_object.rename(index=str, columns={\n        'CNT_PAYMENT': 'previous_application_term_of_last_{}_credits_mean'.format(number)},\n                        inplace=True)\n    features = features.merge(group_object, on=['SK_ID_CURR'], how='left')\n\n    group_object = prev_applications_tail.groupby(by=['SK_ID_CURR'])['DAYS_DECISION'].mean().reset_index()\n    group_object.rename(index=str, columns={\n        'DAYS_DECISION': 'previous_application_days_decision_about_last_{}_credits_mean'.format(number)},\n                        inplace=True)\n    features = features.merge(group_object, on=['SK_ID_CURR'], how='left')\n\n    group_object = prev_applications_tail.groupby(by=['SK_ID_CURR'])['DAYS_FIRST_DRAWING'].mean().reset_index()\n    group_object.rename(index=str, columns={\n        'DAYS_FIRST_DRAWING': 'previous_application_days_first_drawing_last_{}_credits_mean'.format(number)},\n                        inplace=True)\n    features = features.merge(group_object, on=['SK_ID_CURR'], how='left')","3ab1a108":"features.head()","f13681ca":"application = application.merge(features,\n                                left_on=['SK_ID_CURR'],\n                                right_on=['SK_ID_CURR'],\n                                how='left',\n                                validate='one_to_one')","dc5b3f07":"engineered_numerical_columns = list(features.columns)\nengineered_numerical_columns.remove('SK_ID_CURR')\ncredit_eng = application[engineered_numerical_columns + ['TARGET']]\ncredit_eng_corr = abs(credit_eng.corr())","089f62e1":"credit_eng_corr.sort_values('TARGET', ascending=False)['TARGET']","643f0103":"sns.heatmap(credit_eng_corr, \n            xticklabels=credit_eng_corr.columns,\n            yticklabels=credit_eng_corr.columns)","b355f23f":"## Solution 4\n### Hand crafted features","3405b98a":"### Aggregations","2cb2fce7":"# Feature Engineering\n## Solution 3"}}