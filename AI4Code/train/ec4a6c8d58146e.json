{"cell_type":{"3a0f0ce2":"code","15aa234f":"code","294e8326":"code","a38872b3":"code","3e7f7dc9":"code","a71ace37":"code","1261d926":"code","f848578d":"code","8fea023d":"code","8a856af4":"code","efc431ef":"code","4061b488":"code","422494d1":"code","b3d58cfa":"code","243124b1":"code","97f12721":"code","89f344ff":"code","9c8def51":"code","bc69be9b":"code","b1f2b932":"code","4297c100":"code","2e7acb6e":"code","3539e9c7":"code","55290ae3":"code","20648dcb":"code","49eaa317":"code","fad5225d":"code","9c60c5a5":"markdown","9c852e79":"markdown","67c36d8d":"markdown","ffa24724":"markdown","d27b8829":"markdown","beaf0aca":"markdown","1580e611":"markdown","9d15eb2d":"markdown","e35f731f":"markdown","5d3e0805":"markdown","0f4aea9c":"markdown","cb76e929":"markdown","5305f285":"markdown","2fa0c347":"markdown","9c3dd203":"markdown","1d22b07a":"markdown","b4c1d513":"markdown","6939f9db":"markdown","7e93d5a4":"markdown","ced70aad":"markdown","3fd99b60":"markdown","09301441":"markdown"},"source":{"3a0f0ce2":"import pandas as pd\nimport sklearn\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn import preprocessing\nfrom sklearn.preprocessing import OneHotEncoder\n\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nimport seaborn as sns","15aa234f":"adultTrain = pd.read_csv('..\/input\/adult-pmr3508\/train_data.csv',\n                      index_col=['Id'], na_values=\"?\")\nadultTest = pd.read_csv('..\/input\/adult-pmr3508\/test_data.csv',\n                        index_col=['Id'], na_values=\"?\")","294e8326":"adultTrainFit = adultTrain.fillna(0)","a38872b3":"adultTrain.head()","3e7f7dc9":"adultTest.head()","a71ace37":"adultTrainNum = adultTrain[['age','fnlwgt','education.num','capital.gain','capital.loss','hours.per.week','income']]","1261d926":"%%capture\nencoder = preprocessing.LabelEncoder()\ngraph_data  = adultTrainNum.copy()\ngraph_data['income'] = encoder.fit_transform(graph_data['income'])","f848578d":"plt.figure(figsize=(10, 8))\nsns.heatmap(graph_data.corr(), annot=True, vmin=-1, vmax=1, cmap = 'rocket')","8fea023d":"## Compara\u00e7\u00e3o entre sexos \nplt.figure(figsize=(12,12))\nplt.suptitle(\"Compara\u00e7\u00e3o entre sexos\")\nplt.subplot(221)\nadultTrain[adultTrain['income'] == '<=50K'].sex.value_counts().plot(kind = \"pie\")\nplt.title(\"income <=50K\")\nplt.subplot(222)\nadultTrain[adultTrain['income'] == '>50K'].sex.value_counts().plot(kind = \"pie\")\nplt.title(\"income >50K\")\nplt.show()","8a856af4":"## Compara\u00e7\u00e3o entre classes de trabalho \nplt.figure(figsize=(12,12))\nplt.suptitle(\"Compara\u00e7\u00e3o entre ocupa\u00e7\u00f5es de trabalho\")\nplt.subplot(221)\nadultTrain[adultTrain['income'] == '<=50K'].workclass.value_counts().plot(kind = \"pie\")\nplt.title(\"income <=50K\")\nplt.subplot(222)\nadultTrain[adultTrain['income'] == '>50K'].workclass.value_counts().plot(kind = \"pie\")\nplt.title(\"income >50K\")\nplt.show()","efc431ef":"plt.figure(figsize=(16,4))\nsns.countplot(x=\"income\", hue='marital.status', data=adultTrain, palette='rocket')","4061b488":"plt.figure(figsize=(25,4))\nsns.countplot(x=\"income\", hue='occupation', data=adultTrain, palette='rocket')","422494d1":"plt.figure(figsize=(16,4))\nsns.countplot(x=\"income\", hue='relationship', data=adultTrain, palette='rocket')","b3d58cfa":"plt.figure(figsize=(16,4))\nsns.countplot(x=\"income\", hue='race', data=adultTrain, palette='rocket')","243124b1":"plt.figure(figsize=(16,4))\nsns.countplot(x=\"income\", hue='sex', data=adultTrain, palette='rocket')","97f12721":"knn = KNeighborsClassifier(n_neighbors=5)","89f344ff":"X = adultTrainFit[['age','education.num','sex','capital.gain','capital.loss','hours.per.week']]\nY = adultTrainFit['income']","9c8def51":"X","bc69be9b":"X[\"sex-int\"] = np.where(X.sex=='Male', 1, 0)\nX = X.drop(['sex'], axis = 1)","b1f2b932":"X","4297c100":"accuracy = cross_val_score(knn, X, Y, cv = 5, scoring=\"accuracy\")\nprint(\"Acur\u00e1cia com cross validation:\", accuracy.mean())","2e7acb6e":"k = 1\nbest_k = k\nbest_accuracy = 0\nk_array = []\naccuracy_array = []\nwhile k <=30:\n    knn = KNeighborsClassifier(n_neighbors=k)\n    accuracy = cross_val_score(knn, X, Y, cv = 5)\n    \n    k_array.append(k)\n    accuracy_array.append(accuracy.mean())\n    if accuracy.mean() >= best_accuracy:\n        best_accuracy = accuracy.mean()\n        best_k = k\n        print('K = ', k)\n        print('Accuracy: ', accuracy.mean())\n    k = k + 1\n    \nprint(\"O melhor k encontrado foi {0} que levou a uma acur\u00e1cia de {1}\".format(best_k,best_accuracy))","3539e9c7":"k = best_k\n\nKNN = KNeighborsClassifier(n_neighbors=k)\nKNN.fit(X, Y)","55290ae3":"adultTestFit = adultTest.fillna(0)","20648dcb":"Xt = adultTestFit[['age','education.num','sex','capital.gain','capital.loss','hours.per.week']]\nXt[\"sex-int\"] = np.where(Xt.sex=='Male', 1, 0)\nXt = Xt.drop(['sex'], axis = 1)\n","49eaa317":"predicoes = KNN.predict(Xt)","fad5225d":"submission = pd.DataFrame()\nsubmission['income'] = predicoes\nsubmission.to_csv('submission.csv',index_label = 'Id')","9c60c5a5":"H\u00e1 uma propor\u00e7\u00e3o maior de Exec-managerial e Priv-house-serv com as demais ocupa\u00e7\u00f5es.","9c852e79":"H\u00e1 uma maior propor\u00e7\u00e3o de Maridos entre as rendas maiores de 50k. Esse dado pode ser relacionado com o de estado civil","67c36d8d":"Analisando a matriz de correla\u00e7\u00e3o, pode-se notar que a feature fnlwgt tem pouca influencia sobre o income, principalmente quando comparado com as demais features num\u00e9ricas. Sendo assim, vamos desconsider\u00e1-la na an\u00e1lise.Pode-se verificar que h\u00e1 uma maior propor\u00e7\u00e3o de Homens em rela\u00e7\u00e3o a mulheres com income superior a 50K em compara\u00e7\u00e3o com <=50k","ffa24724":"H\u00e1 uma diferen\u00e7a proporcional de renda entre diferentes estados civis. H\u00e1 uma propor\u00e7\u00e3o bem maior de Married-civ-spouse com renda acima de 50k.","d27b8829":"Para isso, utiliza-se uma convers\u00e3o que cria uma nova feature bin\u00e1ria equivalente \u00e0 feature de sexo. Em seguida-exclue-se a feature de sexo da sele\u00e7\u00e3o.","beaf0aca":"Pode-se verificar que h\u00e1 uma maior propor\u00e7\u00e3o de Homens em rela\u00e7\u00e3o a mulheres com income superior a 50K em compara\u00e7\u00e3o com <=50k","1580e611":"Para a fun\u00e7\u00e3o heatmap, \u00e9 necess\u00e1rio transformar os valores em income em valores num\u00e9ricos. Vamos utilizar esse m\u00e9todo novamente mais para a frente.","9d15eb2d":"# 1. Prepara\u00e7\u00e3o dos dados\n\nInicialmente \u00e9 necess\u00e1rio importar todas as bibliotecas que ser\u00e3o usadas no c\u00f3digo","e35f731f":"Comparando os cabe\u00e7alhos dos arquivos de treino e de teste \u00e9 pos\u00edvel notar que a coluna faltante no arquivo de teste \u00e9 a de Income, com uma classifica\u00e7\u00e3o bin\u00e1ria de <=50k ou >50k.\nSendo assim, o exerc\u00edcio est\u00e1 em analisar os dados que relacionam as demais features em rela\u00e7\u00e3o a essa discri\u00e7\u00e3o e renda e treinar um classificador KNN relacionado a essa base de dados.","5d3e0805":"Cria\u00e7\u00e3o do arquivo de predi\u00e7\u00e3o.","0f4aea9c":"Escolhemos para nosso classificador as features num\u00e9ricas e a de sexo, contudo, h\u00e1 a necessidade de converter a vari\u00e1vel de sexo em um valor num\u00e9rico para o treino do classificador.","cb76e929":"Preenchimento de valores nulos","5305f285":"Para a verifica\u00e7\u00e3o do valor de K mais adequado, utilizaremos a valida\u00e7\u00e3o cruzada dos nossos dados de treino.","2fa0c347":"    1.2 Features Classificat\u00f3rias\n    \nAgora vamos analisar as features classificat\u00f3rias n\u00e3o num\u00e9ricas graficamente, vendo quais delas podem possuir uma maior influ\u00eancia sobre a nossa Label.","9c3dd203":"Substitui\u00e7\u00e3o de valores faltantes por 0","1d22b07a":"Equivalencia bin\u00e1ria da feature de sexo.","b4c1d513":"#     1.1 Features num\u00e9ricas\n Inicialmente vamos comparar as features que s\u00e3o n\u00famericos. \u00c9 poss\u00edvel com eles executar uma compara\u00e7\u00e3o estat\u00edstica de correla\u00e7\u00e3o, estimando suas influ\u00eancias sobre a label.","6939f9db":"# 2. Prepara\u00e7\u00e3o dos dados","7e93d5a4":"N\u00e3o h\u00e1 uma diferen\u00e7a proporcional significativa de Income entre diferentes classes de trabalho","ced70aad":"Em uma primeira an\u00e1lise, n\u00e3o h\u00e1 uma grande diferen\u00e7a proporcional entre ra\u00e7as na renda nessa base de dados.","3fd99b60":"Em seguida, carregamos os dados de treino e de teste","09301441":"# **PMR3508 - Aprendizado de M\u00e1quina e Reconhecimento de Padr\u00f5es**\n\nAn\u00e1lise e aplica\u00e7\u00e3o do KNN na base Adult\n\nAutor: David Calil Spindola Pedro\nNusp: 8989384"}}