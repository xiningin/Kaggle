{"cell_type":{"2d993426":"code","5b6d83e8":"code","880055e9":"code","7c3d7cf3":"code","6b9a325c":"code","a3ad9836":"code","18816b7c":"markdown","3832e5bb":"markdown","ddcb71cc":"markdown","ea205155":"markdown","44b171d9":"markdown","915d2887":"markdown","ac3a3c15":"markdown","e3ea71aa":"markdown","d9c83016":"markdown","aa0f7799":"markdown","8613e444":"markdown","7e3d8baf":"markdown","4d34810a":"markdown","f43bb5b3":"markdown","222a5c49":"markdown","eaa729b3":"markdown","cc4ecff6":"markdown","0b0e758f":"markdown","8ee7a145":"markdown","48fadac9":"markdown","16a8d3e9":"markdown","a7d69ec6":"markdown","a0f8a49e":"markdown","90bb52f1":"markdown","708a620a":"markdown","31e4ac80":"markdown"},"source":{"2d993426":"import numpy as np \nimport pandas as pd \nimport plotly.express as px\nimport plotly.graph_objects as go\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nfrom sklearn import datasets\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.linear_model import LinearRegression\n\nsns.set_theme()","5b6d83e8":"class LinearRegression:\n    def __init__(self, learning_rate=0.1, n_iters=100):\n        self.lr = learning_rate\n        self.n_iters = n_iters\n        self.weights = None\n        self.bias = None\n    \n    def fit(self, X, y):\n        n_samples, n_features = X.shape\n        \n        self.weights = np.zeros(n_features)\n        self.bias = 0\n        \n        for _ in range(self.n_iters):\n            pred = self.predict(X)\n            loss = pred - y\n            \n            dw = X.T @ loss\n            db = loss.mean(axis=0)\n            \n            self.weights -= self.lr * dw\n            self.bias -= self.lr * db\n    \n    def predict(self, X):\n        return X @ self.weights + self.bias","880055e9":"X, y = datasets.load_diabetes(return_X_y=True)\n\nX = X[:, [2]]\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=0)","7c3d7cf3":"fig, ax = plt.subplots(figsize=(14, 7))\n\nsns.scatterplot(x=X_train[:, 0], y=y_train, ax=ax);","6b9a325c":"model = LinearRegression(n_iters=10000)\nmodel.fit(X_train, y_train)\nMSE = mean_squared_error(y_test, model.predict(X_test))\nprint('MSE: {}'.format(MSE))","a3ad9836":"x_values = np.linspace(-0.1, 0.2, 100)\ny_values = [model.bias + model.weights[0] * x for x in x_values]\n\nfig, ax = plt.subplots(figsize=(14, 7))\n\nsns.scatterplot(x=X_train[:, 0], y=y_train, ax=ax);\nsns.lineplot(x=x_values, y=y_values);","18816b7c":"$$\\large\n    \\frac{\\partial F}{\\partial W} = \\begin{pmatrix}\n        2 (\\hat{y_1} - y_1) \\frac{\\partial (\\hat{y_1}) }{\\partial w_1} & \n        \\ldots & \n        2 (\\hat{y_1} - y_1) \\frac{\\partial (\\hat{y_1}) }{\\partial w_j} &  \\\\\n        2 (\\hat{y_2} - y_2) \\frac{\\partial (\\hat{y_2}) }{\\partial w_1} & \n        \\ldots & \n        2 (\\hat{y_2} - y_2) \\frac{\\partial (\\hat{y_2}) }{\\partial w_j} &  \\\\\n        \\vdots & & \\vdots \\\\\n        2 (\\hat{y_i} - y_i) \\frac{\\partial (\\hat{y_i}) }{\\partial w_1} & \n        \\ldots & \n        2 (\\hat{y_i} - y_i) \\frac{\\partial (\\hat{y_i}) }{\\partial w_j} &  \\\\\n        \\end{pmatrix}\\\\\n$$","3832e5bb":"# Generate data\n\nWe will be using only one feature with index 2","ddcb71cc":"#### Compute $\\large \\frac{\\partial MSE}{\\partial W}$","ea205155":"$$\\large\n        \\frac{\\partial F}{\\partial b} = \\begin{pmatrix}\n        \\frac{\\partial f_1}{\\partial b} \\\\\n        \\frac{\\partial f_2}{\\partial b} \\\\\n        \\vdots \\\\\n        \\frac{\\partial f_i}{\\partial b} \\\\\n        \\end{pmatrix}    \n        \\quad\n        \\frac{\\partial F}{\\partial b} = \\begin{pmatrix}\n        \\frac{\\partial (\\hat{y_1} - y_1)^{2} }{\\partial b} \\\\\n        \\frac{\\partial (\\hat{y_2} - y_2)^{2}}{\\partial b} \\\\\n        \\vdots \\\\\n        \\frac{\\partial (\\hat{y_i} - y_i)^{2}}{\\partial b} \\\\\n        \\end{pmatrix}\n        \\quad\n        \\frac{\\partial F}{\\partial b} = \\begin{pmatrix}\n        \\frac{\\partial (\\hat{y_1} - y_1)^{2} }{\\partial (\\hat{y_1} - y_1)} \\cdot \\frac{\\partial (\\hat{y_1} - y_1) }{\\partial (\\hat{y_1})} \\cdot  \\frac{\\partial (\\hat{y_1}) }{\\partial b} \\\\\n        \\frac{\\partial (\\hat{y_2} - y_2)^{2} }{\\partial (\\hat{y_2} - y_2)} \\cdot \\frac{\\partial (\\hat{y_2} - y_2) }{\\partial (\\hat{y_2})} \\cdot  \\frac{\\partial (\\hat{y_2}) }{\\partial b}  \\\\\n        \\vdots \\\\\n        \\frac{\\partial (\\hat{y_i} - y_i)^{2} }{\\partial (\\hat{y_i} - y_i)} \\cdot \\frac{\\partial (\\hat{y_i} - y_i) }{\\partial (\\hat{y_i})} \\cdot  \\frac{\\partial (\\hat{y_i}) }{\\partial b} \\\\\n        \\end{pmatrix} \n$$","44b171d9":"\n$$\\large\n\\begin{align*} \nf_{1} &= (\\hat{y_1} - y_1)^{2} \\\\\nf_{2} &= (\\hat{y_2} - y_2)^{2} \\\\\n\\ldots &= \\ldots \\\\\nf_{i} &= (\\hat{y_i} - y_i)^{2}\n\\end{align*} \n\\quad\nF = \\begin{pmatrix}\n        f_{1} \\\\\n        f_{2}  \\\\\n        \\vdots \\\\\n        f_{j} \\\\\n        \\end{pmatrix}\n$$","915d2887":"$$\\large\n\\hat{y_i} = x_{i1}w_1 + x_{i2}w_2 + \\ldots + x_{ij}w_j + b\n$$","ac3a3c15":"#### Let's define column vector of outputs","e3ea71aa":"#### Compute $\\large \\frac{\\partial MSE}{\\partial b}$","d9c83016":"$$\\large\n        \\frac{\\partial F}{\\partial W} = \\begin{pmatrix}\n        \\frac{\\partial f_1}{\\partial w_1} & \\ldots & \\frac{\\partial f_1}{\\partial w_j}\\\\\n        \\frac{\\partial f_2}{\\partial w_1} & \\ldots & \\frac{\\partial f_2}{\\partial w_j}\\\\\n        \\vdots                     &        & \\vdots \\\\\n        \\frac{\\partial f_i}{\\partial w_1} & \\ldots & \\frac{\\partial f_i}{\\partial w_j}\\\\\n        \\end{pmatrix}    \n        \\quad\n        \\frac{\\partial F}{\\partial W} = \\begin{pmatrix}\n        \\frac{\\partial (\\hat{y_1} - y_1)^{2} }{\\partial w_1} & \\ldots & \\frac{\\partial (\\hat{y_1} - y_1)^{2}}{\\partial w_j}\\\\\n        \\frac{\\partial (\\hat{y_2} - y_2)^{2}}{\\partial w_1} & \\ldots & \\frac{\\partial (\\hat{y_2} - y_2)^{2}}{\\partial w_j}\\\\\n        \\vdots  &        & \\vdots \\\\\n        \\frac{\\partial (\\hat{y_i} - y_i)^{2}}{\\partial w_1} &  \\ldots & \\frac{\\partial (\\hat{y_i} - y_i)^{2}}{\\partial w_j}\\\\\n        \\end{pmatrix}\\\\\n$$","aa0f7799":"$$\\large\n\\frac{\\partial F}{\\partial b} = \\frac{2}{i}(\\hat{y} - y)\n$$","8613e444":"#### Loss function","7e3d8baf":"# Implementation of Linear Regression with Regularization","4d34810a":"$$\\large\nX = \\begin{pmatrix}\n        x_{11} & \\ldots & x_{1j} \\\\\n        x_{21} & \\ldots & x_{2j} \\\\\n        \\vdots &        & \\vdots \\\\\n        x_{i1} & \\ldots & x_{ij} \\\\\n        \\end{pmatrix}\n    \\quad\n    Y = \\begin{pmatrix}\n        y_{1} \\\\\n        y_{2}  \\\\\n        \\vdots \\\\\n        y_{i} \\\\\n        \\end{pmatrix}\n    \\quad\n    W = \\begin{pmatrix}\n        w_{1} \\\\\n        w_{2}  \\\\\n        \\vdots \\\\\n        w_{j} \\\\\n        \\end{pmatrix} \n$$","f43bb5b3":"$$\\large\n    \\frac{\\partial F}{\\partial W} = \\begin{pmatrix}\n        2 \\cdot (\\hat{y_1} - y_1) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_1}) }{\\partial w_1} & \n        \\ldots & \n        2 \\cdot (\\hat{y_1} - y_1) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_1}) }{\\partial w_j} \\\\\n        2 \\cdot (\\hat{y_2} - y_2) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_2}) }{\\partial w_1} & \n        \\ldots & \n        2 \\cdot (\\hat{y_2} - y_2) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_2}) }{\\partial w_j} \\\\\n        \\vdots & & \\vdots \\\\\n        2 \\cdot (\\hat{y_i} - y_i) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_i}) }{\\partial w_1} & \n        \\ldots & \n        2 \\cdot (\\hat{y_i} - y_i) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_i}) }{\\partial w_j} \\\\\n        \\end{pmatrix}\\\\\n$$","222a5c49":"#### How do we present data\n\n$i$ rows (samples), $j$ columns (features)","eaa729b3":"$$\\large\n\\frac{\\partial F}{\\partial W} = \\begin{pmatrix}\n        2 (\\hat{y_1} - y_1) x_{11} & \n        \\ldots & \n        2 (\\hat{y_1} - y_1) x_{1j} & \\\\\n        2 (\\hat{y_2} - y_2) x_{21} & \n        \\ldots & \n        2 (\\hat{y_2} - y_2) x_{2j} & \\\\\n        \\vdots & & \\vdots \\\\\n        2 (\\hat{y_i} - y_i) x_{i1} & \n        \\ldots & \n        2 (\\hat{y_i} - y_i) x_{ij} & \\\\\n        \\end{pmatrix}\n$$","cc4ecff6":"# Run model","0b0e758f":"$$\\large\n        \\frac{\\partial F}{\\partial b} = \\begin{pmatrix}\n        2 (\\hat{y_1} - y_1) \\frac{\\partial (x_{11}w_1 + x_{12}w_2 + \\ldots + x_{1j}w_j + b) }{\\partial b} \\\\\n        2 (\\hat{y_2} - y_2) \\frac{\\partial (x_{11}w_1 + x_{12}w_2 + \\ldots + x_{1j}w_j + b)}{\\partial b} \\\\\n        \\vdots \\\\\n        2 (\\hat{y_i} - y_i) \\frac{\\partial (x_{11}w_1 + x_{12}w_2 + \\ldots + x_{1j}w_j + b)}{\\partial b} \n        \\end{pmatrix}\n        \\quad\n        \\frac{\\partial F}{\\partial b} = \\begin{pmatrix}\n        2 (\\hat{y_1} - y_1)\\\\\n        2 (\\hat{y_2} - y_2)\\\\\n        \\vdots \\\\\n        2 (\\hat{y_i} - y_i)\\\\\n        \\end{pmatrix}\n$$","8ee7a145":"$$\\large\n\\frac{\\delta F}{\\delta W} = \n      \\frac{2}{i} \\begin{pmatrix}\n        x_{11} & \\ldots & x_{1j} \\\\\n        x_{21} & \\ldots & x_{2j} \\\\\n        \\vdots &               & \\vdots \\\\\n        x_{i1} & \\ldots & x_{ij} \\\\\n        \\end{pmatrix}^{T}\n        \\begin{pmatrix}\n        \\hat{y_1} - y_1 \\\\\n        \\hat{y_2} - y_2 \\\\\n        \\vdots \\\\\n        \\hat{y_i} - y_i \\\\\n        \\end{pmatrix} =\n        X^{T} (\\hat{y} - y)\n$$","48fadac9":"$$\n\\large\n    \\frac{\\partial F}{\\partial W} = \\begin{pmatrix}\n        \\frac{\\partial (\\hat{y_1} - y_1)^{2} }{\\partial (\\hat{y_1} - y_1)} \\cdot \\frac{\\partial (\\hat{y_1} - y_1) }{\\partial (\\hat{y_1})} \\cdot  \\frac{\\partial (\\hat{y_1}) }{\\partial w_1} & \n        \\cdots &\n        \\frac{\\partial (\\hat{y_1} - y_1)^{2} }{\\partial (\\hat{y_1} - y_1)} \\cdot \\frac{\\partial (\\hat{y_1} - y_1) }{\\partial (\\hat{y_1})} \\cdot  \\frac{\\partial (\\hat{y_1}) }{\\partial w_j} \\\\\n        \\frac{\\partial (\\hat{y_2} - y_2)^{2} }{\\partial (\\hat{y_2} - y_2)} \\cdot \\frac{\\partial (\\hat{y_2} - y_2) }{\\partial (\\hat{y_2})} \\cdot  \\frac{\\partial (\\hat{y_2}) }{\\partial w_1} & \n        \\cdots &\n        \\frac{\\partial (\\hat{y_2} - y_2)^{2} }{\\partial (\\hat{y_2} - y_2)} \\cdot \\frac{\\partial (\\hat{y_2} - y_2) }{\\partial (\\hat{y_2})} \\cdot  \\frac{\\partial (\\hat{y_2}) }{\\partial w_j} \\\\\n        \\vdots & & \\vdots \\\\\n        \\frac{\\partial (\\hat{y_i} - y_i)^{2} }{\\partial (\\hat{y_i} - y_i)} \\cdot \\frac{\\partial (\\hat{y_i} - y_i) }{\\partial (\\hat{y_i})} \\cdot  \\frac{\\partial (\\hat{y_i}) }{\\partial w_1} & \n        \\cdots &\n        \\frac{\\partial (\\hat{y_i} - y_i)^{2} }{\\partial (\\hat{y_i} - y_i)} \\cdot \\frac{\\partial (\\hat{y_i} - y_i) }{\\partial (\\hat{y_i})} \\cdot  \\frac{\\partial (\\hat{y_i}) }{\\partial {w_j}}\n        \\end{pmatrix}\n$$","16a8d3e9":"#### How we compute a output","a7d69ec6":"$$\\large\nMSE = (\\hat{y} - y)^{2}\n\\\\[2ex]\n\\large\nMSE' = 2 \\cdot (\\hat{y} - y)\\cdot \\hat{y}' = (\\hat{y} - y)\\cdot \\hat{y}'\n$$","a0f8a49e":"$$\\large\n        \\frac{\\partial F}{\\partial b} = \\begin{pmatrix}\n        2 \\cdot (\\hat{y_1} - y_1) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_1}) }{\\partial b} \\\\\n        2 \\cdot (\\hat{y_2} - y_2) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_2}) }{\\partial b} \\\\\n        \\vdots \\\\\n        2 \\cdot (\\hat{y_i} - y_i) \\cdot 1 \\cdot  \\frac{\\partial (\\hat{y_i}) }{\\partial b}\n        \\end{pmatrix}\n        \\quad\n        \\frac{\\partial F}{\\partial b} = \\begin{pmatrix}\n        2 (\\hat{y_1} - y_1) \\frac{\\partial (\\hat{y_1}) }{\\partial b} \\\\\n        2 (\\hat{y_2} - y_2) \\frac{\\partial (\\hat{y_2}) }{\\partial b} \\\\\n        \\vdots \\\\\n        2  (\\hat{y_i} - y_i)\\frac{\\partial (\\hat{y_i}) }{\\partial b}\n        \\end{pmatrix}\n$$","90bb52f1":"<div style='text-align: center'>\n    <img src='https:\/\/i.postimg.cc\/9fSGwckm\/islr-linear-regression-1.png' width='700' \/>\n<\/div>","708a620a":"$$\\large\n    \\frac{\\partial F}{\\partial W} = \\begin{pmatrix}\n        2 (\\hat{y_1} - y_1) \\frac{\\partial (x_{11}w_1 + x_{12}w_2 + \\ldots + x_{1j}w_j + b) }{\\partial w_1} & \n        \\ldots & \n        2 (\\hat{y_1} - y_1) \\frac{\\partial (x_{11}w_1 + x_{12}w_2 + \\ldots + x_{1j}w_j + b) }{\\partial w_j} \\\\\n        2 (\\hat{y_2} - y_2) \\frac{\\partial (x_{21}w_1 + x_{22}w_2 + \\ldots + x_{2j}w_j + b) }{\\partial w_1} & \n        \\ldots & \n        2 (\\hat{y_2} - y_2) \\frac{\\partial (x_{11}w_1 + x_{12}w_2 + \\ldots + x_{1j}w_j + b) }{\\partial w_j} \\\\\n        \\vdots & & \\vdots \\\\\n        2 (\\hat{y_i} - y_i) \\frac{\\partial (x_{i1}w_1 + x_{i2}w_2 + \\ldots + x_{ij}w_j + b) }{\\partial w_1} & \n        \\ldots & \n        2 (\\hat{y_i} - y_i) \\frac{\\partial (x_{i1}w_1 + x_{i2}w_2 + \\ldots + x_{ij}w_j + b) }{\\partial w_j} \\\\\n        \\end{pmatrix}\\\\\n$$","31e4ac80":"<h1 style='text-align: center'>Linear Regression From Scratch<\/h1>\n\n<p  style='text-align: center'>\nThis notebook is in <span style='color: green; font-weight: 700'>Active<\/span> state of development!\n<a style='font-weight:700' href='https:\/\/github.com\/LilDataScientist'> Code on GitHub! <\/a><\/p>"}}