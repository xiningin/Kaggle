{"cell_type":{"84166412":"code","61acbba7":"code","a92fa7a0":"code","8f910ee8":"code","88c97236":"code","6f0243ce":"code","a8a1ee3e":"code","014b0ae1":"code","fe5fc451":"code","f559c679":"code","1331b7b6":"code","3659b3e4":"code","863db659":"code","2eb9a433":"code","bf807eef":"code","f8865f6f":"code","9470fd28":"code","523b3ea3":"code","ae0413dd":"code","748d83f4":"code","ac2b5753":"code","45ff70c4":"code","9c4edeaa":"code","96009e80":"code","1cedce4a":"code","69296794":"code","a72ff1e1":"code","baeb56db":"code","7ae79b22":"code","457aa615":"code","292cf400":"code","aa401c5e":"code","6b8a65de":"code","58aac3f8":"code","4646f37e":"code","f73ffef5":"code","e8dfc341":"code","a6c5f92e":"code","ddf44630":"code","68b52daf":"code","5cd7cc18":"code","e38db9e0":"code","824b45d1":"code","0690c324":"markdown","4999e382":"markdown","ea9a47a4":"markdown","e3a44bb8":"markdown","d568ce23":"markdown","01dafb90":"markdown","f1d2d910":"markdown","5a5b7883":"markdown","89312599":"markdown","098e4e3a":"markdown","1f640020":"markdown","e2abf5fd":"markdown","2aa04dfe":"markdown","2fcd06a4":"markdown","9ae5df2b":"markdown","3634d616":"markdown","ce4e3829":"markdown","f7b65061":"markdown","5c04bbf1":"markdown","9e84863c":"markdown","42749472":"markdown","8ce01e84":"markdown","4014037d":"markdown","8167427d":"markdown","333ac9eb":"markdown","8a2c1a5f":"markdown","f726ea18":"markdown","ba8358fe":"markdown"},"source":{"84166412":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\nsns.set(style='whitegrid');\nimport warnings\nwarnings.filterwarnings('ignore')","61acbba7":"df = pd.read_csv('\/kaggle\/input\/insurance\/insurance.csv')\ndf.head()","a92fa7a0":"df.isnull().sum()","8f910ee8":"df.info()","88c97236":"df.describe()","6f0243ce":"plt.figure(figsize =(10,7));\nsns.distplot(df['charges'])","a8a1ee3e":"plt.figure(figsize =(10,7));\nsns.distplot(np.log(df['charges']))","014b0ae1":"df.corr()","fe5fc451":"from sklearn.preprocessing import LabelEncoder\n\nle = LabelEncoder()\n\nle.fit(df.sex)\ndf.sex = le.transform(df.sex)\ndf.head()","f559c679":"df.smoker = le.fit_transform(df.smoker)","1331b7b6":"df.region = le.fit_transform(df.region)","3659b3e4":"plt.figure(figsize = (10,7))\nsns.heatmap(df.corr(), annot = True)","863db659":"df.corr()['charges'].sort_values()","2eb9a433":"f= plt.figure(figsize=(15,7))\n\nax=f.add_subplot(1,2,1)\nsns.distplot(df[(df.smoker == 1)][\"charges\"],color='c',ax=ax)\nax.set_title('Distribution of charges for smokers')\n\nax=f.add_subplot(1,2,2)\nsns.distplot(df[(df.smoker == 0)]['charges'],color='b',ax=ax)\nax.set_title('Distribution of charges for non-smokers')","bf807eef":"sns.countplot(x=\"smoker\",hue = 'sex',data = df)","f8865f6f":"plt.figure(figsize= (15,10))\nsns.violinplot(x = 'smoker',y='charges',hue = 'sex',data = df)","9470fd28":"plt.figure(figsize= (12,7))\nsns.boxplot(y= 'smoker',x = 'charges',hue='sex',orient= 'h', data = df)\nplt.title(\"Comparing smoking vs non-smoking class for male and female\");","523b3ea3":"plt.figure(figsize= (12,7))\nsns.distplot(df['age'])\nplt.title('Age distribution')\n","ae0413dd":"sns.jointplot(x= 'age',y='charges',hue = 'sex', data = df[df.smoker == 0])\nax.set_title('Distribution of charges and age for non-smokers')","748d83f4":"sns.jointplot(x= 'age',y='charges',hue ='sex', data = df[df.smoker == 1])\nax.set_title('Distribution of charges and age for smokers')","ac2b5753":"sns.lmplot(x=\"age\", y=\"charges\", hue=\"smoker\", data=df, palette = 'inferno_r', size = 7)\nax.set_title('Smokers and non-smokers')","45ff70c4":"plt.figure(figsize=(12,5))\nplt.title(\"Distribution of bmi\")\nsns.distplot(df[\"bmi\"])","9c4edeaa":"plt.figure(figsize= (12,5))\nsns.distplot(x= df[df.bmi <= 30]['charges'],color = 'r')\nplt.title(\"Charges for people who are below BMI 30\")","96009e80":"plt.figure(figsize= (12,5))\nsns.distplot(x= df[df.bmi > 30]['charges'],color = 'r')\nplt.title(\"Charges for people who are above BMI 30\")","1cedce4a":"sns.jointplot(x='bmi',y='charges' ,data = df);\n","69296794":"\nsns.jointplot(x='bmi',y='charges',hue ='smoker' ,data = df);","a72ff1e1":"sns.lmplot(x= 'bmi',y='charges',hue='smoker',data = df)","baeb56db":"plt.figure(figsize = (10,7))\nsns.countplot(x= 'children',data= df)","7ae79b22":"\nsns.lmplot(x= 'children',y='charges',hue='smoker',data = df)","457aa615":"plt.figure(figsize = (10,7))\nsns.violinplot(x= 'children',y='charges',hue='smoker',data = df)","292cf400":"df.groupby('region')['charges'].mean()","aa401c5e":"df.groupby('region')['charges'].median()","6b8a65de":"plt.figure(figsize = (10,7))\nsns.barplot(x='region',y='charges',data= df,palette='cool')","58aac3f8":"plt.figure(figsize = (7,5))\nsns.countplot(x='region',hue='smoker',data= df)","4646f37e":"plt.figure(figsize = (10,7))\nsns.barplot(x='region',y='charges',hue='smoker',data= df)","f73ffef5":"plt.figure(figsize = (10,7))\nsns.barplot(x='region',y='charges',hue='sex',data= df,palette='cool')","e8dfc341":"plt.figure(figsize = (10,7))\nsns.barplot(x='region',y='charges',hue='children',data= df,palette='cool')","a6c5f92e":"from sklearn.linear_model import LinearRegression\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.metrics import r2_score,mean_squared_error\nfrom sklearn.ensemble import RandomForestRegressor","ddf44630":"x = df.drop(['charges'],axis = 1)\ny = df['charges']\n\ntrain_X, test_X, train_y, test_y = train_test_split(x,y,test_size=0.2, random_state= 42)\nlinear_model = LinearRegression()\nlinear_model.fit(train_X,train_y)\n\ny_preds = linear_model.predict(test_X)\nprint(linear_model.score(test_X, test_y))","68b52daf":"X = df.drop(['charges'], axis = 1)\nY = df.charges\n\n\n\nquad = PolynomialFeatures (degree = 2)\nx_quad = quad.fit_transform(X)\n\nX_train,X_test,Y_train,Y_test = train_test_split(x_quad,Y, random_state = 0)\n\nplr = LinearRegression().fit(X_train,Y_train)\n\nY_train_pred = plr.predict(X_train)\nY_test_pred = plr.predict(X_test)\n\nprint(plr.score(X_test,Y_test))","5cd7cc18":"X = df.drop(['charges'], axis = 1)\nY = df.charges\n\n\n\nquad = PolynomialFeatures (degree = 3)\nx_quad = quad.fit_transform(X)\n\nX_train,X_test,Y_train,Y_test = train_test_split(x_quad,Y, random_state = 0)\n\nplr = LinearRegression().fit(X_train,Y_train)\n\nY_train_pred = plr.predict(X_train)\nY_test_pred = plr.predict(X_test)\n\nprint(plr.score(X_test,Y_test))","e38db9e0":"ans = pd.DataFrame({'Actual':Y_test, 'Predicted':Y_test_pred})\nans.head()","824b45d1":"x = df.drop(['charges'],axis = 1)\ny = df['charges']\n\ntrain_X, test_X, train_y, test_y = train_test_split(x,y,test_size=0.2, random_state= 42)\nforest = RandomForestRegressor(n_estimators = 50,\n                              criterion = 'mse',\n                              random_state = 1)\nforest.fit(train_X,train_y)\nforest_train_pred = forest.predict(train_X)\nforest_test_pred = forest.predict(test_X)\n\nprint('MSE train data: %.3f, MSE test data: %.3f' % (\nmean_squared_error(train_y,forest_train_pred),\nmean_squared_error(test_y,forest_test_pred)))\nprint('R2 train data: %.3f, R2 test data: %.3f' % (\nr2_score(train_y,forest_train_pred),\nr2_score(test_y,forest_test_pred)))\n\nprint(f\"score of the model is {forest.score(test_X,test_y)}\")","0690c324":"As we can see when we increase the degree more than 2, the score decreases, so lets just stick with degree 2 and it is performing very good.","4999e382":"There is significant difference between mean and median between regions so there are outliers in the data, but for simplicity now stick with mean and see everything through mean lens.","ea9a47a4":"Here after converting the cat variable to numerical, we can see that smoker has sigificant correlation with charges, and region has negative correlation. Now lets see the distribution of each variable with charges.","e3a44bb8":"* 0 - Female 1 - male in the sex column\n* 1 - yes 0 - no in smoker column\n* 0 - northeast, 1-  northwest,2 - southeast, 3 - southwest","d568ce23":"Here if we see in the charges column there is huge gap or difference between 75% and max (63770 - 16639) which implies there are outliers in the data.","01dafb90":"There is no clear relationship between the variables.","f1d2d910":"For non-smokers as age increases they are charged more, but there is no signficant relationship between smoker and charges all we know is that smokers are charged more irrespective of gender, but there us no clear trend as non-smokers.","5a5b7883":"From here we can say that irrespective of no of children people who smoke have higher charges.","89312599":"We have no patients below age 18, may policy is elgible for people who are 20 or more and also we can see that there is huge spike for age group 20, may once people turn into 20 they actively start taking insurance.","098e4e3a":"From the above we can see that polynomial regression produced the best result, eventhough random forest could use some hyper parameter tunning, I think it is a great start.","1f640020":"Here we can see women are being charged more in case of smoker men, but this might be due to outliers, but we can see that median for the smoking mean is heigher than of the smoking women, as we know median is non sensitive to outliers we can say that generally men who smoke more are charged more. And in case of non smoking men and women both are having similar pattern.","e2abf5fd":"We can clearly see that maximum no of people have no or 1 children.Now lets see whether there is pattern between smoker and non-smoker and children.","2aa04dfe":"People in southeast smoke more","2fcd06a4":"Here there are 2 cluster of points, where men and women are mixed and one group even though they smoke they are charged comparatively less, may be the people in upper cluster are heavy smokers or may have more diseases.","9ae5df2b":"## Model Training","3634d616":"**Conclusion:**\n\nSmoker had the high correlation with charges variable and we saw trend as age increases the charge also increases, and it increase further more if the person is smoker. Out of the 3 models we tried Polynomial Regression turned out to be the best.","ce4e3829":"We get a normal distribution for bmi 30, and as per google 30 is obese, as this is normal distribution we can expect maximum window of people falling in this category.","f7b65061":"From here it is quite difficult to decide which variable has more correlation with the charges as the correlation value is quite small, there might be a chance that catgorical variables might have higher correlation with the charges, now lets do encoding on sex, region, smoker.","5c04bbf1":"Here we can see there are no null values. so lets start exploring the data set further more to gain more insights.","9e84863c":"I would say for simple model it performed quite well, even without any preprocessing steps. I have learnt this technique recently now lets implement polynomialfeatures which is if the simple model is struggling to find the relationship between variables, we increase the power of variables and see whether model is able to capture some complex relationship.\n\nEg: lets say in our dataset we are having X feature now when we apply polynomial feature on it, lets say degree 2 we will get one extra feature.","42749472":"But when we see between smokers and non-smokers there seems to be 2 clustes which can be seperated, from above graph it is quite clear that smoker with high bmi is bad combination for insurance.","8ce01e84":"But if we take in case of people who are having bmi above 30, are paying more compared to people who are having bmi less than 30.","4014037d":"As we can see from these barplots the highest charges due to smoking are still in the Southeast but the lowest are in the Northeast. People in the Southwest generally smoke more than people in the Northeast, but people in the Northeast have higher charges by gender than in the Southwest and Northwest overall. And people with children tend to have higher medical costs overall as well.\n","8167427d":"We can maximum people are spending less amount if they are having bmi less than 30 and maximum diminishes around 40k.","333ac9eb":"Generally for non-smokers people charges are less, eventhough there are still some people who are charged more,but generally their spent is around 1000 - 10000.","8a2c1a5f":"If we take a normal look at the distribution then it is left-skewed but since the vakues are spread out more, if we apply log transformation we can see there is slight right skewness.","f726ea18":"We can see there are lot of non-smokers compared to smokers. Another small observation no of non-smoking females are slightly higher than of men and in case of smokers men smoke more than women do.","ba8358fe":"Smoking patients are spending more than non-smokers, but the no of smokers and non-smokers might also lead to this result, so lets check it out."}}