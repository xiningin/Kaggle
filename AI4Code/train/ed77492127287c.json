{"cell_type":{"714100f5":"code","10621cda":"code","719d6355":"code","430d9d0c":"code","7950f628":"code","ce943f52":"code","a595a9cf":"code","22f854c4":"code","a758d5a3":"code","78b2ad44":"code","eb980258":"code","1a3e134d":"code","cc52436f":"code","de706c49":"code","ff2558fc":"code","ed342ce5":"code","a493514f":"code","6dd95960":"code","686603fd":"code","ef331ef9":"code","b792e85c":"code","d50229b8":"code","500ec4c5":"code","1d666b7c":"code","45428159":"code","852b06c3":"code","8919dbbb":"code","cf0c6311":"code","d5366bf5":"code","86aaa8c9":"code","a844e500":"code","9fd1518a":"code","7980e11b":"code","81874337":"code","65b9e37e":"code","65f62b80":"code","28fb0882":"code","a07e4655":"code","42edb0f5":"code","5653c401":"code","dc6cfcdc":"code","2f1881e6":"code","9d2c3555":"code","9f3e669e":"code","9d291f1b":"code","7bb7609a":"code","e58e3ff0":"code","7445b260":"code","5cd56c11":"code","e004e09c":"code","f7df150b":"code","1643cbb4":"code","b074f235":"code","7addc8e1":"code","31c633f5":"code","bc6b74cb":"code","ffe38b2a":"code","c4a8c929":"code","79b4212c":"code","903352a4":"code","a75192e6":"code","9bdf3adc":"code","4e44ff3e":"code","7001ca67":"code","18567a0e":"code","5d326594":"code","a6c4c85c":"code","96f55ae1":"code","d30140d9":"code","d761f9ad":"code","6c7ff0f4":"code","2f9eb90d":"code","cd0fb1e6":"code","703f5744":"code","45079679":"code","ed3c682a":"code","59f58ff1":"code","d6f2ba38":"code","750434e6":"code","1683a54f":"code","a8e174f8":"code","f0cbb071":"code","8539e497":"code","26ee13bf":"code","a9d66bee":"code","58f6da08":"code","3641d678":"code","4cf578e5":"code","1f2d171c":"code","1c1733b8":"code","e4ebba82":"code","2deba797":"code","b5361aa8":"code","174871e0":"code","da3cc163":"code","1966a96e":"code","b03d52fd":"code","dcbece98":"code","2c022089":"code","8be8b210":"code","0d9b900c":"code","f95d8539":"code","623e5351":"code","3b2f7692":"code","01bc48e7":"code","dc383153":"code","f325f12e":"code","c37edd63":"code","9d544e02":"code","e7b46a8c":"code","2bfc89f5":"code","e8273f35":"code","652ea7dd":"code","2c9f6681":"code","f4f18db0":"code","680c4390":"code","f3a01ec6":"code","18fc9bae":"code","939ee1db":"code","d7d262bc":"code","93401c31":"code","98cd480b":"code","b90b2ad4":"code","3004f02f":"code","08f01e9f":"code","4d250d6c":"code","84f37814":"code","c0c92a26":"code","fbc46b8f":"code","7547720d":"code","1f728946":"code","773b678d":"code","f23eefeb":"code","fe75473d":"code","534c9f23":"code","ce5f6787":"code","fc4d6736":"code","5231bd27":"code","38d81d40":"markdown","cd812aee":"markdown","e0004076":"markdown","4047df77":"markdown","9d448d07":"markdown","3e90e62c":"markdown","bac07e07":"markdown","a29b9cca":"markdown","1e57dfc9":"markdown","6294dfef":"markdown","49af3b25":"markdown","f4fd72d2":"markdown","dc405215":"markdown","298aafeb":"markdown","ba583944":"markdown","1212e11d":"markdown","4f63f191":"markdown","d05aa84d":"markdown","386c2342":"markdown","dd5aa1fe":"markdown","6d205d8b":"markdown","47c1492f":"markdown","07c4332a":"markdown","5bbd67a1":"markdown","2fc84080":"markdown","37940efe":"markdown","6a6b2824":"markdown","61cddd9a":"markdown","4cc64b66":"markdown","bf73e89b":"markdown","2b510720":"markdown","8461e103":"markdown","d0a37b27":"markdown","15263d81":"markdown","4529a309":"markdown","da8885c5":"markdown","9f8ce9de":"markdown","71bfe787":"markdown","f2c5f8f2":"markdown","3af85b7e":"markdown","da96aafe":"markdown","ba68c6c3":"markdown","7973e9bd":"markdown","85c0ac1f":"markdown","c9e44cbc":"markdown","138abec2":"markdown","70272faa":"markdown","ba66c0c9":"markdown","bf514b85":"markdown","94668563":"markdown","c8c55448":"markdown","52bf253a":"markdown","4eb841d5":"markdown","03fc6d72":"markdown","9c9a2727":"markdown","26674ed9":"markdown","e642c0f6":"markdown","ca31d4a2":"markdown","94c7cfd7":"markdown","6e8203de":"markdown","913e8541":"markdown","b97b9adf":"markdown","a5d1095f":"markdown","5da0306e":"markdown","a92c09b8":"markdown","0889a92d":"markdown","0d2bf8f8":"markdown","191e5d4d":"markdown","a3f176ab":"markdown","54a7c195":"markdown","42c37f7c":"markdown","5b585b2d":"markdown","4eef655b":"markdown","396f9afe":"markdown","e57d0709":"markdown","51e2e046":"markdown","51f604e7":"markdown","934a0771":"markdown","d37eb3c1":"markdown","1d0caec7":"markdown","183c66be":"markdown","39ceafa6":"markdown","5b0a1156":"markdown","2df3c234":"markdown","7b00919c":"markdown","70b6d3a2":"markdown","c4bb28e5":"markdown","63b1df2b":"markdown","08d54bf9":"markdown","7a0f9aed":"markdown","3a608e01":"markdown","08fa302a":"markdown","6984dcc4":"markdown","b885e5b0":"markdown","b456c2b3":"markdown","5a50017f":"markdown","0da28a97":"markdown","3def5187":"markdown","fcc2e4dd":"markdown","4fd91af8":"markdown","22b1b229":"markdown","550106c7":"markdown","60a47e75":"markdown","38b0bde1":"markdown","e923acd2":"markdown","cc62201e":"markdown","ca0dba45":"markdown","e563145b":"markdown","79eceafc":"markdown","55752b04":"markdown","ccfbc642":"markdown","8c80c8d3":"markdown","d4b35812":"markdown","b692d07d":"markdown","28a6061d":"markdown"},"source":{"714100f5":"import pandas as pd\nimport numpy as np\nimport re\nfrom numpy import nan\nimport warnings\nwarnings.filterwarnings(\"ignore\")","10621cda":"train = pd.read_csv(\"..\/input\/train.csv\")\ntest = pd.read_csv(\"..\/input\/test.csv\")","719d6355":"train.sample(2)","430d9d0c":"test.sample(2)","7950f628":"#combine data\ncombine = pd.concat([train,test],sort = True,ignore_index=True)  ","ce943f52":"combine.info()","a595a9cf":"%%HTML\n<div class='tableauPlaceholder' id='viz1563348721864' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ov&#47;OverviewofWomanData&#47;OverviewofWomanData&#47;1_rss.png' style='border: none' \/><\/a><\/noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' \/> <param name='embed_code_version' value='3' \/> <param name='site_root' value='' \/><param name='name' value='OverviewofWomanData&#47;OverviewofWomanData' \/><param name='tabs' value='yes' \/><param name='toolbar' value='yes' \/><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ov&#47;OverviewofWomanData&#47;OverviewofWomanData&#47;1.png' \/> <param name='animate_transition' value='yes' \/><param name='display_static_image' value='yes' \/><param name='display_spinner' value='yes' \/><param name='display_overlay' value='yes' \/><param name='display_count' value='yes' \/><param name='filter' value='publish=yes' \/><\/object><\/div>                <script type='text\/javascript'>                    var divElement = document.getElementById('viz1563348721864');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='1024px';vizElement.style.height='694px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https:\/\/public.tableau.com\/javascripts\/api\/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                <\/script>","22f854c4":"%%HTML\n<div class='tableauPlaceholder' id='viz1563351259461' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ov&#47;OverviewofManData&#47;EmbarkedandPclass&#47;1_rss.png' style='border: none' \/><\/a><\/noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' \/> <param name='embed_code_version' value='3' \/> <param name='site_root' value='' \/><param name='name' value='OverviewofManData&#47;EmbarkedandPclass' \/><param name='tabs' value='yes' \/><param name='toolbar' value='yes' \/><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ov&#47;OverviewofManData&#47;EmbarkedandPclass&#47;1.png' \/> <param name='animate_transition' value='yes' \/><param name='display_static_image' value='yes' \/><param name='display_spinner' value='yes' \/><param name='display_overlay' value='yes' \/><param name='display_count' value='yes' \/><param name='filter' value='publish=yes' \/><\/object><\/div>                <script type='text\/javascript'>                    var divElement = document.getElementById('viz1563351259461');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https:\/\/public.tableau.com\/javascripts\/api\/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                <\/script>","a758d5a3":"combine[[\"Name\"]].sample(10)","78b2ad44":"combine[\"Surname\"] = combine[\"Name\"].str.split(\",\",expand = True)[0]\ncombine[\"Surname\"] = combine[\"Surname\"].str.split(\"-\",expand = True)[0]\ncombine[[\"Name\",\"Surname\"]].head(2)","eb980258":"#Number of passengers with the same family name\nfor name in combine.Surname.values:\n    combine.loc[combine.Surname==name,\"Surname_Counts\"]=combine[combine.Surname==name].shape[0]\ncombine[[\"Surname\",\"Surname_Counts\"]].head(2)","1a3e134d":"combine['Title'] = combine.Name.str.extract('([A-Za-z]+)\\.', expand=False)","cc52436f":"#Distinguish passenger titles by gender\nfor i,j in combine.groupby([\"Sex\"]):\n    j_title_list = set(list(j.Title.values))\n    print(i,j_title_list)","de706c49":"female_list = ['Lady', 'Dona', 'Ms', 'Countess', 'Mrs', 'Mme', 'Miss', 'Dr', 'Mlle']\nmale_list = ['Don', 'Sir',  'Capt', 'Rev', 'Jonkheer', 'Col', 'Mr', 'Major', 'Dr']\nboy_list = ['Master']\ncombine.loc[(combine.Title.isin(female_list))&(combine.Sex==\"female\"),\"Gender\"]=\"Woman\"\ncombine.loc[(combine.Title.isin(male_list))&(combine.Sex==\"male\"),\"Gender\"]=\"Man\"\ncombine.loc[(combine.Title.isin(boy_list)),\"Gender\"]=\"Boy\"","ff2558fc":"type1 = combine[(combine.Gender==\"Boy\")].shape[0]\ntype2 = combine[(combine.Sex==\"male\")&(combine.Age<16)].shape[0]\ntype3 = combine[((combine.Sex==\"male\")&(combine.Age<16))|((combine.Gender==\"Boy\"))].shape[0]\nprint(\"The amount of Boy in method1 is %d and the amount of Boy in method2 is %d and the amount of Boy in method2 is %d\"%(type1,type2,type3))","ed342ce5":"survival_1 = combine[(combine.Gender==\"Boy\")&(combine.Pclass.isin([1,2]))][\"Survived\"].mean()\nsurvival_2 = combine[(combine.Sex==\"male\")&(combine.Age<16)&(combine.Pclass.isin([1,2]))][\"Survived\"].mean()\nsurvival_3 = combine[(((combine.Sex==\"male\")&(combine.Age<16))|(combine.Gender==\"Boy\"))&(combine.Pclass.isin([1,2]))][\"Survived\"].mean()\nprint(\"The Survival probability of method1 is %.2f%%,the survival probability of method2 is %.2f%%,and the survival probability of method3 is %.2f%%\"\n      %(survival_1*100,survival_2*100,survival_3*100))","a493514f":"combine.loc[(combine.Sex==\"male\")&(combine.Age<16),\"Gender\"]=\"Boy\"","6dd95960":"combine[combine.Gender==\"Boy\"][[\"Gender\",\"Sex\",\"Title\",\"Age\"]].sample(3)","686603fd":"combine.drop([\"Title\",\"Sex\"],axis = 1,inplace=True)","ef331ef9":"combine_female = combine[combine.Gender == \"Woman\"]\ncombine_female.reset_index(inplace = True)\n\nfor i,name in enumerate(list(combine_female.Name.values)):\n    name = str(name)\n    name = re.sub(\"\\\\s$\",\"\",name)\n    name = re.sub(\".*[^\\\\)]$\",\"\",name)\n    name = re.sub(\".*\\\\s(.*)\\\\)$\",\"\\\\1\",name)\n    name = re.sub(\"^\\\\(\",\"\",name)\n    combine_female.loc[i,\"Maiden_name\"] = name\ncombine_female[[\"Name\",\"Maiden_name\",\"Age\"]].head(3)","b792e85c":"#Add maiden name to the full dataset\nfor id in combine_female.PassengerId.values:\n    id2 = int(id)\n    name = combine_female[combine_female.PassengerId==id][\"Maiden_name\"].values\n    combine.loc[combine.PassengerId==id2,\"Maiden\"] = name\ncombine[[\"Name\",\"Maiden\"]].head(2)","d50229b8":"combine.loc[combine.Maiden==\"\",\"Maiden\"]=nan","500ec4c5":"for mai in combine.Maiden.values:\n    combine.loc[combine.Maiden==mai,\"Maiden_Counts\"]=combine[combine.Maiden==mai].shape[0]\ncombine[[\"Maiden\",\"Maiden_Counts\"]].head(2)","1d666b7c":"combine[\"Family_size\"] = combine[\"Parch\"]+combine[\"SibSp\"]+1\ncombine[[\"Name\",\"Surname_Counts\",\"Maiden_Counts\",\"Family_size\"]].head(2)","45428159":"pclass_gender_list = []\nfor pclass,gender in zip(combine.Pclass.values,combine.Gender.values):\n    pclass_gender = \"P\"+str(pclass)+\"-\"+str(gender)\n    pclass_gender_list = pclass_gender_list+[pclass_gender]","852b06c3":"combine[\"Pclass_Gender\"] = pclass_gender_list\ncombine[[\"Pclass\",\"Gender\",\"Pclass_Gender\"]].head(2)","8919dbbb":"combine[[\"Ticket\"]].sample(5)","cf0c6311":"combine[\"Ticket\"].value_counts()[:5]","d5366bf5":"#Extract the numeric part of the ticket number as the new ticket number\ncombine[\"Ticket_new\"] = combine[\"Ticket\"].str.extract('([0-9]+)$',expand = False)","86aaa8c9":"combine[combine.Ticket_new.isna()][[\"Ticket\",\"Ticket_new\"]]","a844e500":"#Modify the ticket number without numeric part to the original ticket number\ncombine.loc[combine.Ticket_new.isna(),\"Ticket_new\"]=\"LINE\"","9fd1518a":"#Replace the original ticket number with the new ticket number\nfor i,tic in enumerate(combine.Ticket_new.values):\n    combine.loc[i,\"Ticket\"] = tic\ncombine.drop([\"Ticket_new\"],axis = 1,inplace = True)","7980e11b":"combine[\"Ticket\"].value_counts()[:5]","81874337":"tic_list = combine.Ticket.values\nfor i in tic_list:\n    combine.loc[combine[\"Ticket\"]==i,\"Ticket_Counts\"] = combine[combine[\"Ticket\"] == i].shape[0]\ncombine[[\"Ticket\",\"Ticket_Counts\"]].head(2)","65b9e37e":"for i,ti in enumerate(combine.Ticket.values):\n    t = list(ti)[:-2]+list(\"xx\")\n    d = ''\n    combine.loc[i,\"Ticket2\"] = d.join(t)","65f62b80":"tic2_list = combine.Ticket2.values\nfor i in tic2_list:\n    combine.loc[combine[\"Ticket2\"]==i,\"Ticket2_Counts\"] = combine[combine[\"Ticket2\"] == i].shape[0]\ncombine[[\"Ticket\",\"Ticket2\",\"Ticket2_Counts\"]].head(2)","28fb0882":"combine[combine.Cabin.notna()][[\"Cabin\"]].sample(5)","a07e4655":"have_cabin = combine[combine.Cabin.notna()]\nhave_cabin.reset_index(inplace = True)\nmulti_cabin = []\nsingle_cabin = []\nfor i,j in enumerate(have_cabin.Cabin.values):\n    passid = have_cabin.loc[i].PassengerId\n    if len(j)>4:\n        multi_cabin = multi_cabin+[passid]\n    else:\n        single_cabin = single_cabin+[passid]\nprint(multi_cabin)","42edb0f5":"#Extract the initials of a single cabin\ncabin_title = have_cabin[have_cabin.PassengerId.isin(single_cabin)].Cabin.str.extract('^([A-Z])',expand=False)\nhave_cabin.loc[have_cabin.PassengerId.isin(single_cabin),\"Cabin_Title\"] = cabin_title\nhave_cabin[[\"Cabin\",\"Cabin_Title\"]].head(2)","5653c401":"have_cabin[have_cabin.PassengerId.isin(multi_cabin)][[\"Cabin\"]].sample(5)","dc6cfcdc":"multi_cabin_title = []\nfor cabin in have_cabin[have_cabin.PassengerId.isin(multi_cabin)][\"Cabin\"].values:\n    cabinA = cabin.split(\" \")[0]\n    cabinA_title = list(cabinA)[0]\n    cabinB = cabin.split(\" \")[1]\n    cabinB_title = list(cabinB)[0]\n    if cabinA_title==cabinB_title:\n        multi_cabin_title = multi_cabin_title+[cabinA_title]\n    else:\n        multi_cabin_title = multi_cabin_title+[cabinA_title+cabinB_title]\n        \nhave_cabin.loc[(have_cabin.PassengerId.isin(multi_cabin)),\"Cabin_Title\"] = multi_cabin_title\nhave_cabin[have_cabin.PassengerId.isin(multi_cabin)][[\"Cabin\",\"Cabin_Title\"]][:3]","2f1881e6":"#Add \"Cabin_Title\" to full dataset\ncabin_title_list = list(have_cabin.Cabin_Title.values)\ncombine.loc[(combine.Cabin.notna()),\"Cabin_Title\"] = cabin_title_list\ncombine[combine.Cabin.notna()][[\"Cabin\",\"Cabin_Title\"]].head(2)","9d2c3555":"combine[[\"Fare\",\"Ticket_Counts\",\"Pclass\"]].sample(5)","9f3e669e":"combine.loc[(combine.Fare.notna()),\"Fare_PP\"] = combine.Fare\/combine.Ticket_Counts\ncombine[[\"Fare\",\"Fare_PP\",\"Ticket_Counts\"]].sample(5)","9d291f1b":"combine[combine.Fare.isna()]","7bb7609a":"combine.loc[(combine.Fare_PP.isna()),\"Fare_PP\"] = combine[(combine.Embarked==\"S\")&(combine.Pclass==3)][\"Fare_PP\"].median()\ncombine.loc[(combine.Fare.isna()),\"Fare\"]  = combine[(combine.Embarked==\"S\")&(combine.Pclass==3)][\"Fare_PP\"].median()","e58e3ff0":"#Ticket with multiple passengers and have cabin\nmulti_ticket = list(combine[(combine.Ticket_Counts>=2)&(combine.Cabin_Title.notna())][\"Ticket\"].values)\nlen(set(multi_ticket))","7445b260":"#With the same \"Ticket\" but different \"Cabin_Title\"\nmulti_ticket_cabin = combine[(combine.Cabin_Title.notna())&(combine.Ticket_Counts>=2)][[\"Ticket\",\"Cabin_Title\"]]\nsame_ticket_differ_cabin = []\nfor i,j in multi_ticket_cabin.groupby([\"Ticket\"]):\n    differ_cabin = set(list(j.Cabin_Title.values))\n    if len(differ_cabin)>=2:\n        same_ticket_differ_cabin = same_ticket_differ_cabin+[i]\nprint(same_ticket_differ_cabin)","5cd56c11":"need_filling = list(combine[(combine.Ticket.isin(multi_ticket))&(combine.Cabin.isna())].PassengerId.values)\nfor passid in need_filling:\n    ticket = list(combine[combine.PassengerId==passid][\"Ticket\"].values)\n    cabin_title = combine[combine.Ticket.isin(ticket)][\"Cabin_Title\"].describe()[\"top\"]\n    combine.loc[combine.PassengerId==passid,\"Cabin_Title\"] = cabin_title\ncombine[combine.PassengerId.isin(need_filling)][[\"Cabin_Title\"]][:3]","e004e09c":"#remove repeated features\ncombine.drop([\"Cabin\",\"Fare\"],axis = 1,inplace = True)","f7df150b":"maybe_wrong = []\nfor i in range(combine.shape[0]):\n    fz = combine.iloc[i][\"Family_size\"]\n    sc = combine.iloc[i][\"Surname_Counts\"]\n    surname = combine.iloc[i][\"Surname\"]\n    maiden = combine.iloc[i][\"Maiden\"]\n    passengerid = combine.iloc[i][\"PassengerId\"]\n    maiden_count = combine[combine.PassengerId==(i+1)][\"Maiden\"].describe()[\"count\"]\n    if fz>sc:\n        if maiden_count==0:\n            sur_mai_family_count = combine[(combine.Maiden==surname)&(combine.Family_size>=2)].shape[0]\n            if sur_mai_family_count==0:\n                maybe_wrong = maybe_wrong+[passengerid]\n        else:\n            sur_mai_family_count = combine[(combine.Maiden==surname)&(combine.Family_size>=2)].shape[0]\n            if sur_mai_family_count==0:\n                mai_mai_family_count = combine[(combine.Maiden==maiden)&(combine.Family_size>=2)].shape[0]\n                if mai_mai_family_count==0:\n                    mai_sur_family_count = combine[(combine.Surname==maiden)&(combine.Family_size>=2)].shape[0]\n                    if mai_sur_family_count==0:\n                        maybe_wrong = maybe_wrong+[passengerid]\nprint(maybe_wrong)","1643cbb4":"need_check = combine[(combine.PassengerId.isin(maybe_wrong))&(combine.Ticket_Counts==1)][\"PassengerId\"].values\nneed_check","b074f235":"def get_from_passid(dataset,passid_list):\n    return dataset[dataset.PassengerId.isin(passid_list)][['Age', 'Cabin_Title', 'Embarked', 'Name', 'Parch', 'SibSp','Ticket',\n                                                           'Ticket2', 'Surname','Maiden',\"Ticket_Counts\", 'Pclass_Gender',\n                                                           'Family_size',\"Survived\"]]\n\ndef get_from_name(dataset,name_list):\n    return dataset[(dataset.Surname.isin(name_list))\n                   |(dataset.Maiden.isin(name_list))][['Age', 'Cabin_Title', 'Embarked', 'Name', 'Parch', 'SibSp','Ticket',\n                                                           'Ticket2', 'Surname','Maiden',\"Ticket_Counts\", 'Pclass_Gender',\n                                                           'Family_size',\"Survived\"]]","7addc8e1":"get_from_passid(combine,need_check)","31c633f5":"get_from_name(combine,[\"Newsom\",\"Monypeny\"])","bc6b74cb":"#Check if  [274] have immediate family member\ncombine[(combine.Ticket2==\"175xx\")&(combine.Cabin_Title==\"C\")&(combine.Embarked==\"C\")&(combine.Family_size>=2)&(combine.Pclass==1)]","ffe38b2a":"#Check if  [418&1130] have immediate family member\ncombine[((combine.Age<=3)|(combine.Age>=32))\n        &(combine.Embarked==\"S\")&(combine.Family_size>=2)\n        &(combine.Ticket2==\"2506xx\")&(combine.Pclass==2)][['Age', 'Cabin_Title', 'Embarked', 'Name', 'Parch', 'SibSp','Ticket',\n                                                           'Ticket2', 'Surname','Maiden',\"Ticket_Counts\", 'Pclass_Gender', 'Family_size']]","c4a8c929":"#Check if  [443] have immediate family member\ncombine[(combine.Embarked==\"S\")&(combine.Ticket2==\"3470xx\")&(combine.Pclass==3)&(combine.Family_size==2)][['Age', 'Cabin_Title', 'Embarked', 'Name', 'Parch', 'SibSp','Ticket', 'Surname', 'Maiden', \n       'Pclass_Gender', 'Family_size', 'Surname_Counts', 'Ticket_Counts',\"Maiden_Counts\",\"Survived\"]]","79b4212c":"combine.loc[combine.PassengerId.isin([137]),\"Maiden\"] = \"Monypeny\"\ncombine.loc[combine.Maiden.isin([\"Monypeny\"]),\"Maiden_Counts\"] = 2\n\ncombine.loc[combine.PassengerId.isin([274]),\"Parch\"] = 0\ncombine.loc[combine.PassengerId.isin([274]),\"Family_size\"] = 1\n\ncombine.loc[combine.PassengerId.isin([418]),\"Parch\"] = 0\ncombine.loc[combine.PassengerId.isin([418]),\"Family_size\"] = 1\n\ncombine.loc[combine.PassengerId.isin([1130]),\"Parch\"] = 0\ncombine.loc[combine.PassengerId.isin([1130]),\"SibSp\"] = 0\ncombine.loc[combine.PassengerId.isin([1130]),\"Family_size\"] = 1","903352a4":"%%HTML\n<div class='tableauPlaceholder' id='viz1562742692050' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ti&#47;Titanic_15627427473480&#47;Overview2&#47;1_rss.png' style='border: none' \/><\/a><\/noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' \/> <param name='embed_code_version' value='3' \/> <param name='site_root' value='' \/><param name='name' value='Titanic_15627427473480&#47;Overview2' \/><param name='tabs' value='yes' \/><param name='toolbar' value='yes' \/><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ti&#47;Titanic_15627427473480&#47;Overview2&#47;1.png' \/> <param name='animate_transition' value='yes' \/><param name='display_static_image' value='yes' \/><param name='display_spinner' value='yes' \/><param name='display_overlay' value='yes' \/><param name='display_count' value='yes' \/><param name='filter' value='publish=yes' \/><\/object><\/div>                <script type='text\/javascript'>                    var divElement = document.getElementById('viz1562742692050');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https:\/\/public.tableau.com\/javascripts\/api\/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                <\/script>","a75192e6":"test_error = pd.DataFrame(columns=[\"Category\",\"Train_data\",\"Test_data\",\"Error_Counts\",\"Error_Probability\"])\n\ndef get_error_counts(pg,index):\n    PG_train_size = combine[(combine.Pclass_Gender.isin(pg))&(combine.Survived.notna())].shape[0]\n    PG_test_size = combine[(combine.Pclass_Gender.isin(pg))&(combine.Survived.isna())].shape[0]\n    PG_survival = combine[(combine.Pclass_Gender.isin(pg))][\"Survived\"].mean()\n    if PG_survival>=0.5:\n        error_probability = 1-PG_survival\n        try:\n            test_error_counts = round(error_probability*PG_test_size)\n        except:\n            test_error_counts=0\n    else:\n        error_probability = PG_survival\n        test_error_counts = round(error_probability*PG_test_size)\n    test_error.loc[index]=[pg,PG_train_size,PG_test_size,test_error_counts,\"%.2f%%\"%(round(PG_survival*100,2))]\n\nindex = 0\nPG_list = [[\"P1-Woman\",\"P2-Woman\"],[\"P3-Woman\"],[\"P1-Man\"],[\"P2-Man\"],[\"P3-Man\"],[\"P1-Boy\",\"P2-Boy\"],[\"P3-Boy\"]]\nfor pg in PG_list:\n    get_error_counts(pg,index)\n    index +=1\ntest_error.sort_values(by = \"Error_Counts\",ascending = False)","9bdf3adc":"combine.loc[(combine.Pclass_Gender.isin([\"P1-Boy\",\"P2-Boy\",\"P1-Woman\",\"P2-Woman\"])),\"Predict\"] = 1\ncombine.loc[(combine.Pclass_Gender==\"P2-Man\"),\"Predict\"] = 0","4e44ff3e":"have_family = combine[combine.Family_size>=2]","7001ca67":"have_family[have_family.Ticket2_Counts==1][['Age','Cabin_Title', 'Embarked','Pclass_Gender','Name',\n                                        \"Surname\",'Maiden', 'Parch','SibSp', 'Family_size','Ticket',\"Ticket_Counts\"]]","18567a0e":"get_from_name(have_family,[\"Olsen\"])","5d326594":"def get_team_id(dataset,name_list):\n    return dataset[(dataset.Surname.isin(name_list))|(dataset.Maiden.isin(name_list))][\"PassengerId\"].values","a6c4c85c":"team_id =get_team_id(have_family,[\"Olsen\"])\nhave_family.loc[have_family.PassengerId.isin(team_id),\"Group_size\"] = have_family[have_family.PassengerId.isin(team_id)].shape[0]\nhave_family.loc[have_family.PassengerId.isin(team_id),\"Ave_Survival\"] = have_family[have_family.PassengerId.isin(team_id)][\"Survived\"].mean()","96f55ae1":"get_from_name(have_family,[\"Crosby\",\"Halstead\"])","d30140d9":"team_id = get_team_id(have_family,[\"Crosby\",\"Halstead\"])\nhave_family.loc[have_family.PassengerId.isin(team_id),\"Group_size\"] = have_family[have_family.PassengerId.isin(team_id)].shape[0]\nhave_family.loc[have_family.PassengerId.isin(team_id),\"Ave_Survival\"] = have_family[have_family.PassengerId.isin(team_id)][\"Survived\"].mean()","d761f9ad":"have_secondary_family1 = []\nhave_secondary_family2 = []\nship_team_1 = []\nship_team_2 = []\nship_team_2_tic2 = []\nfor passengerid in have_family.PassengerId.values:\n    \n    #Extracting some feature values of the passenger to identify same\"ship team\" and same\"family\" \n    ticket = have_family[have_family.PassengerId==passengerid][\"Ticket\"].describe()[\"top\"]\n    ticket_counts = have_family[have_family.PassengerId==passengerid][\"Ticket_Counts\"].describe()[\"mean\"]\n    family_size = have_family[have_family.PassengerId==passengerid][\"Family_size\"].describe()[\"mean\"]\n    ticket2 = have_family[have_family.PassengerId==passengerid][\"Ticket2\"].describe()[\"top\"]\n    surname = have_family[have_family.PassengerId==passengerid][\"Surname\"].describe()[\"top\"]\n    maiden = set(have_family[(have_family.PassengerId==passengerid)&(have_family.Maiden.notna())][\"Maiden\"].values)\n    \n    #When \"Family_size\" is greater than Ticket_Counts\",\n    #it may be that some family members exist in the adjacent ticket number.(it still the same \"ship team\")\n    if family_size>ticket_counts:\n        \n        #Extract all passengers with the same name (family surname or maiden name) from the passenger \n        #in the fuzzy ticket number (adjacent or same ticket number)\n        group_by_tic2 = have_family[((have_family.Surname.isin({surname}|maiden))\n                                                  |(have_family.Maiden.isin({surname}|maiden)))\n                                                 &(have_family.Ticket2.isin({ticket2}))]\n        group_by_tic2_size = group_by_tic2.shape[0]\n        if group_by_tic2_size == family_size:\n            ship_team_1 = ship_team_1+[passengerid]\n        else:\n            #If the team is smaller than the \"Family_size\", the passenger has a secondary family\n            have_secondary_family1 = have_secondary_family1+[passengerid]\n       \n    #When the \"\"Family_size\" is equal to the \"Ticket_Counts\", \n    #first check if all passengers with the same ticket number are family members,\n    #if not, continue to check if all family members are in the adjacent ticket number.\n    \n    #When the \"\"Family_size\" is less than the \"Ticket_Counts\",\n    #First check if the number of family members with the same ticket number is equal to the total number of family members\n    #(with family and friends traveling together)\n    #if not, continue to check if all family members are in the adjacent ticket number.\n    else:\n        group_by_tic = have_family[((have_family.Surname.isin({surname}|maiden))|(have_family.Maiden.isin({surname}|maiden)))\n                                      &(have_family.Ticket.isin({ticket}))]\n        group_by_tic2 = have_family[((have_family.Surname.isin({surname}|maiden))\n                                     |(have_family.Maiden.isin({surname}|maiden)))\n                                    &(have_family.Ticket2.isin({ticket2}))]\n        group_by_tic_size = group_by_tic.shape[0]\n        group_by_tic2_size = group_by_tic2.shape[0]\n        if group_by_tic_size == family_size:\n            ship_team_2 = ship_team_2+[passengerid]\n        elif group_by_tic2_size == family_size:\n            ship_team_2_tic2 = ship_team_2_tic2+[passengerid]\n        else:\n            have_secondary_family2 = have_secondary_family2+[passengerid]\nprint(have_secondary_family1)\nprint(\"-\"*50)\nprint(have_secondary_family2)","6c7ff0f4":"def full_gs_and_as(dataset,id_list,ticket_kind,check_list,with_friend,count_maiden):\n    for i in id_list:\n        surname = set(dataset[dataset.PassengerId.isin([i])][\"Surname\"].values)\n        ticket_list = set(dataset[dataset.PassengerId.isin([i])][ticket_kind].values)\n        \n        #For passengers with immediate family members, \n        #the identification of \u201cship team\u201d and \u201csecondary family\u201d requires the use of \u201cmaiden name\u201d\n        if count_maiden ==True:\n            maiden = set(dataset[dataset.PassengerId.isin([i])&(dataset.Maiden.notna())].Maiden.values)\n            team = dataset[((dataset.Surname.isin(surname|maiden))\n                        |(dataset.Maiden.isin(surname|maiden)))\n                       &(dataset[ticket_kind].isin(ticket_list))]\n            team_pg = team.Pclass_Gender.describe().top\n            \n            #When the \"ship team\" is identified by the same ticket number\n            if ticket_kind==\"Ticket\":\n                team_size = team.shape[0]\n                ave_survival = dataset[dataset[ticket_kind].isin(ticket_list)].Survived.mean()\n                team_passid = list(team.PassengerId.values)\n                \n            #When the \"ship team\" is identified by the fuzzy ticket number(Same or adjacent ticket number)\n            else:\n                team_size = round(team.Family_size.describe().mean())\n                ticket = set(team.Ticket.values)\n                ave_survival = dataset[dataset.Ticket.isin(ticket)].Survived.mean()\n                team_passid = list(team.PassengerId.values)\n                \n        #To identify the members of the same \"ship team\"  which only consists of cousins, it is not necessary to use \u201cmaiden name\u201d \n        #(I will talk about it later, not used here)\n        else:\n            team = dataset[(dataset[ticket_kind].isin(ticket_list))&(dataset.Surname.isin(surname))&(dataset.Group_size.isna())]\n            team_size = team.shape[0]\n            if team_size >=1:\n                team_pg = team.Pclass_Gender.describe().top\n            else:\n                team_pg = []\n            if team_size>=2:\n                ticket = set(team.Ticket.values)\n                ticket_team_size = dataset[dataset.Ticket.isin(ticket)].shape[0]\n                if team_size == ticket_team_size:\n                    team_passid = list(team.PassengerId.values)\n                    ave_survival=team.Survived.mean()\n                else:\n                    team_passid = []\n                    ave_survival = nan\n                    with_friend = with_friend+[i]\n            else:\n                team_passid = []\n                ave_survival = nan\n                \n        #Number of test data and train data in the team\n        empty_survived = dataset[(dataset.PassengerId.isin(team_passid))&(dataset.Survived.isna())].shape[0]\n        full_survived = dataset[(dataset.PassengerId.isin(team_passid))&(dataset.Survived.notna())].shape[0]\n        \n        #The following loop is consistent with the judgment rule about True \"Ave_Survival\" in step 2\n        if full_survived>0:\n            if empty_survived>0:\n                empty_gender_count = team[(team.Survived.isna())].Gender.describe()[\"unique\"]\n                empty_gender = set(team[(team.Survived.isna())].Gender.values)\n                full_gender = set(team[(team.Survived.notna())].Gender.values)\n                if ave_survival ==0:\n                    if (\"Woman\" in full_gender)|((\"Man\" in empty_gender)&(empty_gender_count==1)):\n                        dataset.loc[dataset.PassengerId.isin(team_passid),\"Ave_Survival\"] = 0\n                    else:\n                        dataset.loc[dataset.PassengerId.isin(team_passid),\"Ave_Survival\"] = 0.5\n                elif ave_survival==1:\n                    if (\"Man\" in full_gender)|((\"Woman\" in empty_gender)&(empty_gender_count==1)):\n                        dataset.loc[dataset.PassengerId.isin(team_passid),\"Ave_Survival\"] = 1\n                    else:\n                        dataset.loc[dataset.PassengerId.isin(team_passid),\"Ave_Survival\"] = 0.5\n                \n                #When the training data is all women, even if the average survival rate of the team is greater than 0.5, \n                #it cannot be judged that the survival rate of the men in the team is greater than 0.5\n                #When the training data is all men, even if the average survival rate of the team is less than 0.5, \n                #it cannot be judged that the survival rate of the women in the team is less than 0.5\n                else:\n                    check_list=check_list+[team_passid]\n            else:\n                dataset.loc[(dataset.PassengerId.isin(team_passid)),\"Ave_Survival\"]=ave_survival\n        else:\n            dataset.loc[(dataset.PassengerId.isin(team_passid)),\"Ave_Survival\"]=nan\n        dataset.loc[(dataset.PassengerId.isin(team_passid)),\"Group_size\"] = team_size\n    print(\"These passenger travel not only with cousin:\",with_friend)\n    check_list = list(np.unique(check_list))\n    print(\"these passenger need check more:\",check_list)","2f9eb90d":"full_gs_and_as(dataset = have_family,id_list=ship_team_2,ticket_kind = \"Ticket\",check_list = [],with_friend=[],count_maiden = True)","cd0fb1e6":"#Since the survival rate of the P2 passengers has been predicted by \"Pclass_Gender\", \n#the misjudgment of the average survival rate of such passengers may not be considered.\ndef fillfull_p2(dataset,check_list,check_more):\n    for i in check_list:\n        pclass = dataset[dataset.PassengerId.isin(i)].Pclass.describe()[\"mean\"]\n        if pclass != 2:\n            check_more = check_more+[i]\n        else:\n            dataset.loc[dataset.PassengerId.isin(i),\"Group_size\"] = len(i)\n            dataset.loc[dataset.PassengerId.isin(i),\"Ave_Survival\"] = dataset[dataset.PassengerId.isin(i)][\"Survived\"].mean()\n    return print(check_more)","703f5744":"check_list = [[26, 183, 234, 262, 1046, 1066, 1271], [28, 89, 342, 439, 945, 961], [44, 609, 686, 1188], [59, 451, 473, 1142],\n              [94, 789, 924, 1246], [119, 300, 1076], [246, 413, 1303], [280, 747, 1284], [298, 306, 499, 1198], [671, 685, 1067], \n              [818, 828, 1253]]\nfillfull_p2(dataset = have_family,check_list = check_list,check_more = [])","45079679":"def check_ave_survival(dataset,passid):\n    return dataset[dataset.PassengerId.isin(passid)][[\"Pclass_Gender\",\"Survived\"]]\n\ndef fullfill_ave_survival(dataset,check_list,check_more):\n    for i in check_list:\n        ave_survival = dataset[dataset.PassengerId.isin(i)].Survived.mean()\n        empty_gender = list(dataset[(dataset.PassengerId.isin(i))&(dataset.Survived.isna())].Gender.values)\n        if ave_survival>0.5:\n            if \"Man\" in empty_gender:\n                dataset.loc[(dataset.PassengerId.isin(i)),\"Ave_Survival\"] = 0.5\n            else:\n                dataset.loc[(dataset.PassengerId.isin(i)),\"Ave_Survival\"] = ave_survival\n        elif ave_survival==0.5:\n            if \"Woman\"in empty_gender:\n                dataset.loc[(dataset.PassengerId.isin(i)),\"Ave_Survival\"] = 0.5\n            else:\n                dataset.loc[(dataset.PassengerId.isin(i)),\"Ave_Survival\"] = ave_survival\n        else:\n            check_more = check_more+[i]\n    return print(check_more)","ed3c682a":"check_list = [[26, 183, 234, 262, 1046, 1066, 1271], [28, 89, 342, 439, 945, 961], [94, 789, 924, 1246],\n              [119, 300, 1076], [246, 413, 1303], [280, 747, 1284], [298, 306, 499, 1198]]\nfullfill_ave_survival(have_family,check_list,check_more = [])","59f58ff1":"check_ave_survival(have_family,[298, 306, 499, 1198])","d6f2ba38":"have_family.loc[(have_family.PassengerId.isin([298, 306, 499, 1198])),\"Ave_Survival\"] = 0.33","750434e6":"situation_2 = ship_team_1+ship_team_2_tic2\nfull_gs_and_as(dataset = have_family,id_list=situation_2,ticket_kind = \"Ticket2\",check_list = [],with_friend=[],count_maiden = True)","1683a54f":"check_list = [[70, 185, 1057, 1268, 1286], [408, 438, 530, 775, 832, 944], [438, 530, 775, 944], [477, 727, 923, 1211], \n              [672, 821, 984, 1200], [727, 923, 1211], [821, 984, 1200]]\nfillfull_p2(have_family,check_list,check_more = [])","a8e174f8":"check_list = [[70, 185, 1057, 1268, 1286], [672, 821, 984, 1200], [821, 984, 1200]]\nfullfill_ave_survival(have_family,check_list,check_more=[])","f0cbb071":"remain_second_family = list(have_family[(have_family.PassengerId.isin(have_secondary_family1+have_secondary_family2))\n                                        &(have_family.Group_size.isna())][\"PassengerId\"].values)\nprint(len(remain_second_family))","8539e497":"#Some passengers have a secondary family, but only the first-class family members are used as the basis for \"Group_size\" and \"Ave_Survival\".\n#That is, although the passengers of the same ticket are all immediate family members, some relatives are not in the same ticket.\nsecond_family = have_secondary_family1+have_secondary_family2\nfor i in remain_second_family:\n    second_family.remove(i)\nprint(second_family)","26ee13bf":"check_list = []\nfor i in second_family:\n    pclass = have_family[have_family.PassengerId==i].Pclass.describe().max\n    if pclass != 2:\n        surname = list(have_family[have_family.PassengerId.isin([i])].Surname.values)\n        try:\n            maiden = list(have_family[have_family.PassengerId.isin([i])].Maiden.values)\n        except:\n            maiden = []\n        ticket2 = list(have_family[have_family.PassengerId.isin([i])].Ticket2.values)\n        old_team_size = have_family[have_family.PassengerId.isin([i])].Group_size.describe()[\"mean\"]\n        new_team = have_family[(have_family.Ticket2.isin(ticket2))\n                               &((have_family.Surname.isin(surname+maiden))|(have_family.Maiden.isin(surname+maiden)))]\n        new_team_size = new_team.shape[0]\n        new_team_passid = list(new_team.PassengerId.values)\n        ave_survival = new_team.Survived.mean()\n        \n        #The following loop is consistent with the previous one\n        full_survived = new_team[new_team.Survived.notna()].shape[0]\n        empty_survived = new_team[new_team.Survived.isna()].shape[0]\n        if new_team_size>old_team_size:\n            if full_survived>0:\n                if empty_survived>0:\n                    empty_gender_count = new_team[(new_team.Survived.isna())].Gender.describe()[\"unique\"]\n                    empty_gender = set(new_team[(new_team.Survived.isna())].Gender.values)\n                    full_gender = set(new_team[(new_team.Survived.notna())].Gender.values)\n                    if ave_survival ==0:\n                        if (\"Woman\" in full_gender)|((\"Man\" in empty_gender)&(empty_gender_count==1)):\n                            have_family.loc[have_family.PassengerId.isin(new_team_passid),\"Ave_Survival\"] = 0\n                        else:\n                            have_family.loc[have_family.PassengerId.isin(new_team_passid),\"Ave_Survival\"] = 0.5\n                    elif ave_survival==1:\n                        if (\"Man\" in full_gender)|((\"Woman\" in empty_gender)&(empty_gender_count==1)):\n                            have_family.loc[have_family.PassengerId.isin(new_team_passid),\"Ave_Survival\"] = 1\n                        else:\n                            have_family.loc[have_family.PassengerId.isin(new_team_passid),\"Ave_Survival\"] = 0.5\n                    else:\n                        check_list=check_list+[new_team_passid]\n                else:\n                    have_family.loc[(have_family.PassengerId.isin(new_team_passid)),\"Ave_Survival\"]=ave_survival\n            else:\n                have_family.loc[(have_family.PassengerId.isin(new_team_passid)),\"Ave_Survival\"]=nan\n        have_family.loc[have_family.PassengerId.isin(new_team_passid),\"Group_size\"] = new_team_size\nprint(check_list)","a9d66bee":"have_family[have_family.PassengerId.isin([70, 185, 1057, 1268, 1286])][[\"Pclass_Gender\",\"Survived\",\"Ave_Survival\"]]","58f6da08":"next_check = []\nhave_stepparent=[]\nfor i in remain_second_family:\n    ticket = have_family[have_family.PassengerId==i].Ticket.describe()[\"top\"]\n    team = have_family[have_family.Ticket.isin([ticket])]\n    team_passid = list(team.PassengerId.values)\n    team_size = team.shape[0]\n    family_size = team.Family_size.describe()[\"max\"]\n    if team_size == family_size:\n        have_family.loc[(have_family.PassengerId.isin(team_passid)),\"Ave_Survival\"] = team.Survived.mean()\n        have_family.loc[(have_family.PassengerId.isin(team_passid)),\"Group_size\"] = team_size\n        have_stepparent=have_stepparent+[team_passid]\n    else:\n        next_check = next_check+[i]\nhave_stepparent = np.unique(have_stepparent)\nprint(\"these passengers are stepparent relationship:\",have_stepparent)\nprint(\"these passengers need to be checked more:\",next_check)","3641d678":"next_check_2 = []\nhave_grouped = []\nfor i,j in have_family[have_family.PassengerId.isin(next_check)].groupby([\"Surname\"]):\n    if (len(j))>=2:\n        family_size = j.Family_size.mean()\n        j_size = j.shape[0]\n        j_passid = list(j.PassengerId.values)\n        if j_size == family_size:\n            have_grouped = have_grouped+[j_passid]\n            have_family.loc[(have_family.PassengerId.isin(j_passid)),\"Group_size\"] = j_size\n            have_family.loc[(have_family.PassengerId.isin(j_passid)),\"Ave_Survival\"] = j.Survived.mean()\n        else:\n            next_check_2 = next_check_2+[j_passid]\n    else:\n        j_passid = list(j.PassengerId.values)\n        next_check_2 = next_check_2+[j_passid]\nprint(\"have grouped\",have_grouped)\nprint(\"next more check\",next_check_2)","4cf578e5":"need_more_check = [41,193,69,1106,581,1133,1296,248,756,722,313,1041,443,893]\ncan_groupby_ticket2 = []\nmaybe_wrong = []\nfor i,j in have_family[have_family.PassengerId.isin(need_more_check)].groupby([\"Embarked\",\"Ticket2\",\"Pclass\"]):\n    if len(j)>=2:\n        can_groupby_ticket2 = can_groupby_ticket2+[i[1]]\n    else:\n        maybe_wrong = maybe_wrong+[i[1]]\nprint(\"can groupby ticket2\",can_groupby_ticket2)\nprint(\"maybe wrong\",maybe_wrong)","1f2d171c":"def get_from_id_tic2(dataset,passid,tic2):\n    return dataset[(dataset.PassengerId.isin(passid))\n                   &(dataset.Ticket2.isin(tic2))][['Age', 'Embarked', 'Parch', 'SibSp','Ticket','Surname', 'Maiden','Family_size',\n                                                   'Pclass_Gender','Cabin_Title',\"Survived\",\"Ave_Survival\"]]","1c1733b8":"get_from_id_tic2(have_family,need_more_check,[\"2377xx\"])","e4ebba82":"have_family.loc[(have_family.PassengerId.isin([581,1133])),[\"Group_size\",\"Ave_Survival\"]] = [2,1]","2deba797":"get_from_id_tic2(have_family,need_more_check,['2506xx'])","b5361aa8":"have_family.loc[(have_family.PassengerId.isin([248,313,756,1041])),[\"Group_size\",\"Ave_Survival\"]] = [3,0.5]","174871e0":"get_from_id_tic2(have_family,need_more_check,['3470xx'])","da3cc163":"get_from_id_tic2(have_family,need_more_check,['3500xx'])","1966a96e":"have_family.loc[(have_family.PassengerId.isin([193,722])),[\"Group_size\",\"Ave_Survival\"]] = [2,0.5]","b03d52fd":"have_family.loc[have_family.PassengerId==443,[\"Group_size\",'Ave_Survival']] = [2,0]\nhave_family.loc[have_family.PassengerId==1106,[\"Group_size\",'Ave_Survival']] = [7,0]","dcbece98":"get_from_id_tic2(have_family,need_more_check,maybe_wrong)","2c022089":"have_family.loc[have_family.PassengerId.isin([41,893,1296]),[\"SibSp\",\"Family_size\"]] = [0,1]\ncombine.loc[combine.PassengerId.isin([41,893,1296]),[\"SibSp\",\"Family_size\"]] = [0,1]\nhave_family.loc[have_family.PassengerId.isin([69,1106]),[\"Group_size\",'Ave_Survival']] = [7,0.125]","8be8b210":"have_family = have_family[have_family.Family_size!=1]\npassid_list = list(have_family.PassengerId.values)\ngroup_size_list = list(have_family.Group_size.values)\nave_survival = list(have_family.Ave_Survival.values)\ncombine.loc[combine.PassengerId.isin(passid_list),\"Group_size\"] = group_size_list\ncombine.loc[combine.PassengerId.isin(passid_list),\"Ave_Survival\"] = ave_survival","0d9b900c":"all_passenger = []\nfor i,j in combine[(combine.Surname_Counts>=2)].groupby([\"Ticket2\",\"Surname\"]):\n    if len(j)>=2:\n        j_passid = list(j.PassengerId.values)\n        all_passenger = all_passenger+j_passid\nsame_surname = list(combine[(combine.PassengerId.isin(all_passenger))&(combine.Group_size.isna())][\"PassengerId\"].values)\nprint(len(same_surname))","f95d8539":"#maiden\nall_passenger = []\nfor i,j in combine[(combine.Maiden_Counts>=2)].groupby([\"Ticket2\",\"Maiden\"]):\n    if len(j)>=2:\n        j_passid = list(j.PassengerId.values)\n        all_passenger = all_passenger+j_passid\nsame_maiden = list(combine[(combine.PassengerId.isin(all_passenger))&(combine.Group_size.isna())][\"PassengerId\"].values)\nprint(same_maiden)","623e5351":"same_surname_ticket = list(combine[(combine.PassengerId.isin(same_surname))].Ticket.values)\ncombine[(combine.Ticket.isin(same_surname_ticket))&(combine.Group_size.notna())][['Age', 'Embarked', 'Parch', 'SibSp','Ticket',\n                                                                                             'Surname', 'Maiden','Family_size',\n                                                                                             'Pclass_Gender','Cabin_Title',\"Surname_Counts\",\"Group_size\"]]","3b2f7692":"combine[combine.Ticket==\"31352\"][['Age', 'Embarked', 'Parch', 'SibSp','Ticket','Surname', 'Maiden','Family_size','Pclass_Gender',\n                                  'Cabin_Title',\"Surname_Counts\",\"Group_size\",\"Survived\"]]","01bc48e7":"team = combine[(combine.Ticket==\"31352\")|((combine.Surname==\"Ware\")&(combine.Family_size!=1))]\ncombine.loc[(combine.PassengerId.isin([1170,1254])),\"Group_size\"] = 2\ncombine.loc[(combine.PassengerId.isin([1170,1254])),\"Ave_Survival\"] = team.Survived.mean()","dc383153":"same_surname.remove(1254)\nfull_gs_and_as(dataset = combine,id_list=same_surname,ticket_kind = \"Ticket2\",check_list = [],with_friend=[],count_maiden = False)","f325f12e":"combine[(combine.PassengerId.isin([115, 245, 303, 598, 693, 827]))][[\"Pclass_Gender\",\"Survived\",\"Ticket\"]]","c37edd63":"combine.loc[(combine.Ticket.isin([\"2627\",\"2694\"])),\"Group_size\"] = combine[(combine.Ticket.isin([\"2627\",\"2694\"]))].shape[0]\ncombine.loc[(combine.Ticket.isin([\"2627\",\"2694\"])),\"Ave_Survival\"] = combine[(combine.Ticket.isin([\"2627\",\"2694\"]))][\"Survived\"].mean()\ncombine.loc[(combine.Ticket.isin([\"LINE\"])),\"Group_size\"] = combine[(combine.Ticket.isin([\"LINE\"]))].shape[0]\ncombine.loc[(combine.Ticket.isin([\"LINE\"])),\"Ave_Survival\"] = combine[(combine.Ticket.isin([\"LINE\"]))][\"Survived\"].mean()\ncombine.loc[(combine.Ticket.isin([\"1601\"])),\"Group_size\"] = combine[(combine.Ticket.isin([\"1601\"]))].shape[0]\ncombine.loc[(combine.Ticket.isin([\"1601\"])),\"Ave_Survival\"] = combine[(combine.Ticket.isin([\"1601\"]))][\"Survived\"].mean()","9d544e02":"surname_list = list(combine.Surname.values)\ncommon_name = []\nfor maiden in combine.Maiden.values:\n    if maiden in surname_list:\n        common_name = common_name+[maiden]\nprint(len(common_name))\nprint(common_name[:5])","e7b46a8c":"possible_cousin = combine[((combine.Surname.isin(common_name))|(combine.Maiden.isin(common_name)))\n                          &(combine.Family_size==1)&(combine.Group_size.isna())]\npossible_cousin_id = []\nfor i,j in possible_cousin.groupby([\"Ticket2\"]):\n    if len(j)>=2:\n        j_passid = list(j.PassengerId.values)\n        possible_cousin_id = possible_cousin_id+[j_passid]\nprint(possible_cousin_id)","2bfc89f5":"combine[(combine.PassengerId.isin([41, 104, 714, 877]))][[\"Surname\",\"Maiden\"]]","e8273f35":"combine[(combine.PassengerId.isin([41, 714]))][['Age',\"Cabin_Title\", 'Embarked','Pclass_Gender',\"Surname\",'Maiden','Ticket',\"Survived\"]]","652ea7dd":"combine.loc[combine.PassengerId.isin([41, 714]),[\"Group_size\",'Ave_Survival']] = [2,0]","2c9f6681":"remain_passenger = combine[(combine.Group_size.isna())&(combine.Ticket_Counts>=2)]\nremain_ticket = list(remain_passenger.Ticket.values)\ncheck_list = []\nfor i in remain_ticket:\n    team = combine[(combine.Ticket.isin([i]))]\n    empty_size = combine[(combine.Ticket.isin([i]))&(combine.Survived.isna())].shape[0]\n    full_size = combine[(combine.Ticket.isin([i]))&(combine.Survived.notna())].shape[0]\n    team_passid = list(team.PassengerId.values)\n    team_size = team.shape[0]\n    ave_survival = team.Survived.mean()\n    if full_size>0:\n        if empty_size>0:\n            empty_gender_count = combine[(combine.PassengerId.isin(team_passid))&(combine.Survived.isna())].Gender.describe()[\"unique\"]\n            empty_gender = set(combine[(combine.PassengerId.isin(team_passid))&(combine.Survived.isna())].Gender.values)\n            full_gender = set(combine[(combine.PassengerId.isin(team_passid))&(combine.Survived.notna())].Gender.values)\n            if ave_survival ==0:\n                if (\"Woman\" in full_gender)|((\"Man\" in empty_gender)&(empty_gender_count==1)):\n                    combine.loc[combine.PassengerId.isin(team_passid),\"Ave_Survival\"] = 0\n                else:\n                    combine.loc[combine.PassengerId.isin(team_passid),\"Ave_Survival\"] = 0.5\n            elif ave_survival==1:\n                if (\"Man\" in full_gender)|((\"Woman\" in empty_gender)&(empty_gender_count==1)):\n                    combine.loc[combine.PassengerId.isin(team_passid),\"Ave_Survival\"] = 1\n                else:\n                    combine.loc[combine.PassengerId.isin(team_passid),\"Ave_Survival\"] = 0.5\n            else:\n                check_list=check_list+[team_passid]\n        else:\n            combine.loc[(combine.PassengerId.isin(team_passid)),\"Ave_Survival\"]=ave_survival\n    else:\n        combine.loc[(combine.PassengerId.isin(team_passid)),\"Ave_Survival\"]=nan\n    combine.loc[(combine.PassengerId.isin(team_passid)),\"Group_size\"] = team_size\ncheck_list = list(np.unique(check_list))\nprint(check_list)","f4f18db0":"check_list = [[146, 550, 1068, 1222], [270, 326, 374, 1206], [280, 747, 1065, 1284], [291, 742, 988], [298, 306, 499, 709, 1033, 1198],\n              [308, 506, 1306], [381, 558, 701, 717, 1094], [538, 545, 1131]]\nfillfull_p2(combine,check_list,check_more = [])","680c4390":"check_list = [[270, 326, 374, 1206], [280, 747, 1065, 1284], [291, 742, 988], [298, 306, 499, 709, 1033, 1198], [308, 506, 1306],\n              [381, 558, 701, 717, 1094], [538, 545, 1131]]\nfullfill_ave_survival(combine,check_list,check_more=[])","f3a01ec6":"#P3-Man\nsurvival = combine[(combine.Pclass_Gender==\"P3-Man\")&(combine.Ave_Survival==0.5)][\"Survived\"].mean()\nshape = combine[(combine.Pclass_Gender==\"P3-Man\")&(combine.Ave_Survival==0.5)&(combine.Survived.notna())].shape[0]\nprint(survival)\nprint(shape)","18fc9bae":"#P1-Man\nsurvival = combine[(combine.Pclass_Gender==\"P1-Man\")&(combine.Ave_Survival==0.5)][\"Survived\"].mean()\nshape = combine[(combine.Pclass_Gender==\"P1-Man\")&(combine.Ave_Survival==0.5)&(combine.Survived.notna())].shape[0]\nprint(survival)\nprint(shape)","939ee1db":"#P3-Woman\nsurvival =combine[(combine.Pclass_Gender==\"P3-Woman\")&(combine.Ave_Survival==0.5)][\"Survived\"].mean()\nshape = combine[(combine.Pclass_Gender==\"P3-Woman\")&(combine.Ave_Survival==0.5)&(combine.Survived.notna())].shape[0]\nprint(survival)\nprint(shape)","d7d262bc":"#P3-Boy\nsurvival =combine[(combine.Pclass_Gender==\"P3-Boy\")&(combine.Ave_Survival==0.5)][\"Survived\"].mean()\nshape = combine[(combine.Pclass_Gender==\"P3-Boy\")&(combine.Ave_Survival==0.5)&(combine.Survived.notna())].shape[0]\nprint(survival)\nprint(shape)","93401c31":"combine[(combine.Pclass_Gender==\"P3-Boy\")&(combine.Ave_Survival==0.5)\n        &(combine.Survived.isna())][[\"PassengerId\",\"Ticket\",\"Ticket_Counts\"]]","98cd480b":"combine[combine.Ticket==\"2673\"][[\"PassengerId\",\"Age\",\"Pclass_Gender\",\"Survived\",\"Ave_Survival\"]]","b90b2ad4":"combine.loc[(combine.Pclass_Gender.isin([\"P3-Woman\"]))&(combine.Ave_Survival>=0.5),\"If_Survived\"] = 1\ncombine.loc[(combine.Pclass_Gender.isin([\"P3-Woman\"]))&(combine.Ave_Survival<0.5),\"If_Survived\"] = 0\n\ncombine.loc[(combine.Pclass_Gender.isin([\"P1-Man\",\"P3-Man\"])&(combine.Ave_Survival>0.5)),\"If_Survived\"] = 1\ncombine.loc[(combine.Pclass_Gender.isin([\"P1-Man\",\"P3-Man\"])&(combine.Ave_Survival<=0.5)),\"If_Survived\"] = 0\n\ncombine.loc[((combine.Pclass_Gender.isin([\"P3-Boy\"]))&(combine.Ave_Survival>0.5)),\"If_Survived\"] = 1\ncombine.loc[((combine.Pclass_Gender.isin([\"P3-Boy\"]))&(combine.Ave_Survival<0.5)),\"If_Survived\"] = 0\n\ncombine.loc[(combine.PassengerId.isin([1053,1199,1309])),\"If_Survived\"] = 1\ncombine.loc[(combine.PassengerId.isin([1046,1084,1231,1236,1271,1284])),\"If_Survived\"] = 0\n\ncombine.loc[(combine.Group_size.isna()),\"Group_size\"] = 1","3004f02f":"%%HTML\n<div class='tableauPlaceholder' id='viz1563324785218' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ov&#47;OverviewoftheRelationshipBetweenIf_SurvivedandSurvived&#47;OverviewoftheRelationshipBetweenIf_SurvivedandSurvived&#47;1_rss.png' style='border: none' \/><\/a><\/noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' \/> <param name='embed_code_version' value='3' \/> <param name='site_root' value='' \/><param name='name' value='OverviewoftheRelationshipBetweenIf_SurvivedandSurvived&#47;OverviewoftheRelationshipBetweenIf_SurvivedandSurvived' \/><param name='tabs' value='yes' \/><param name='toolbar' value='yes' \/><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ov&#47;OverviewoftheRelationshipBetweenIf_SurvivedandSurvived&#47;OverviewoftheRelationshipBetweenIf_SurvivedandSurvived&#47;1.png' \/> <param name='animate_transition' value='yes' \/><param name='display_static_image' value='yes' \/><param name='display_spinner' value='yes' \/><param name='display_overlay' value='yes' \/><param name='display_count' value='yes' \/><param name='filter' value='publish=yes' \/><\/object><\/div>                <script type='text\/javascript'>                    var divElement = document.getElementById('viz1563324785218');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https:\/\/public.tableau.com\/javascripts\/api\/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                <\/script>","08f01e9f":"combine[(combine.Pclass_Gender.isin([\"P1-Man\",\"P3-Man\"]))\n        &(combine.Survived.isna())&(combine.If_Survived==1)][[\"Pclass_Gender\",\"Group_size\",\"Ave_Survival\",\"Ticket\"]]","4d250d6c":"combine.loc[(combine.If_Survived==0),\"Predict\"] = 0\ncombine.loc[(combine.If_Survived==1),\"Predict\"] = 1\ncombine.loc[(combine.PassengerId.isin([1036,1047,1210])),\"Predict\"] = 0","84f37814":"combine = combine[[\"PassengerId\",\"Age\",\"Embarked\",\"Survived\",\"Pclass_Gender\",\"Fare_PP\",\"Cabin_Title\",\"Predict\"]]","c0c92a26":"remain_train = combine[(combine.Predict.isna())&(combine.Survived.notna())]\nremain_test = combine[(combine.Predict.isna())&(combine.Survived.isna())]","fbc46b8f":"print(\"Pclass_Gender distribution in train data:\",remain_train.Pclass_Gender.value_counts())\nprint(\"-\"*50)\nprint(\"Pclass_Gender distribution in test data:\",remain_test.Pclass_Gender.value_counts())","7547720d":"#P1-Man\nsurvival_in_remain = remain_train[(remain_train.Pclass_Gender==\"P1-Man\")][\"Survived\"].mean()\nsurvival_in_all = combine[(combine.Pclass_Gender==\"P1-Man\")][\"Survived\"].mean()\nprint(round(survival_in_all,2),round(survival_in_remain,2))","1f728946":"#P3-Man\nsurvival_in_remain = remain_train[(remain_train.Pclass_Gender==\"P3-Man\")][\"Survived\"].mean()\nsurvival_in_all = combine[(combine.Pclass_Gender==\"P3-Man\")][\"Survived\"].mean()\nprint(round(survival_in_all,2),round(survival_in_remain,2))","773b678d":"#P3-Woman\nsurvival_in_remain =remain_train[(remain_train.Pclass_Gender==\"P3-Woman\")][\"Survived\"].mean()\nsurvival_in_all = combine[(combine.Pclass_Gender==\"P3-Woman\")][\"Survived\"].mean()\nprint(round(survival_in_all,2),round(survival_in_remain,2))","f23eefeb":"%%HTML\n<div class='tableauPlaceholder' id='viz1563451480836' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;An&#47;AnOverviewofWoman2&#47;AnOverviewofP3-Woman&#47;1_rss.png' style='border: none' \/><\/a><\/noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' \/> <param name='embed_code_version' value='3' \/> <param name='site_root' value='' \/><param name='name' value='AnOverviewofWoman2&#47;AnOverviewofP3-Woman' \/><param name='tabs' value='yes' \/><param name='toolbar' value='yes' \/><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;An&#47;AnOverviewofWoman2&#47;AnOverviewofP3-Woman&#47;1.png' \/> <param name='animate_transition' value='yes' \/><param name='display_static_image' value='yes' \/><param name='display_spinner' value='yes' \/><param name='display_overlay' value='yes' \/><param name='display_count' value='yes' \/><param name='filter' value='publish=yes' \/><\/object><\/div>                <script type='text\/javascript'>                    var divElement = document.getElementById('viz1563451480836');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https:\/\/public.tableau.com\/javascripts\/api\/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                <\/script>","fe75473d":"%%HTML\n<div class='tableauPlaceholder' id='viz1563448568883' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;An&#47;AnOverviewofP1-Man&#47;AnOverviewofP1-Man&#47;1_rss.png' style='border: none' \/><\/a><\/noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' \/> <param name='embed_code_version' value='3' \/> <param name='site_root' value='' \/><param name='name' value='AnOverviewofP1-Man&#47;AnOverviewofP1-Man' \/><param name='tabs' value='yes' \/><param name='toolbar' value='yes' \/><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;An&#47;AnOverviewofP1-Man&#47;AnOverviewofP1-Man&#47;1.png' \/> <param name='animate_transition' value='yes' \/><param name='display_static_image' value='yes' \/><param name='display_spinner' value='yes' \/><param name='display_overlay' value='yes' \/><param name='display_count' value='yes' \/><param name='filter' value='publish=yes' \/><\/object><\/div>                <script type='text\/javascript'>                    var divElement = document.getElementById('viz1563448568883');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https:\/\/public.tableau.com\/javascripts\/api\/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                <\/script>","534c9f23":"%%HTML\n<div class='tableauPlaceholder' id='viz1563451555664' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;An&#47;AnOverviewofP3-Man&#47;AnOverviewofP3-Man&#47;1_rss.png' style='border: none' \/><\/a><\/noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' \/> <param name='embed_code_version' value='3' \/> <param name='site_root' value='' \/><param name='name' value='AnOverviewofP3-Man&#47;AnOverviewofP3-Man' \/><param name='tabs' value='yes' \/><param name='toolbar' value='yes' \/><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;An&#47;AnOverviewofP3-Man&#47;AnOverviewofP3-Man&#47;1.png' \/> <param name='animate_transition' value='yes' \/><param name='display_static_image' value='yes' \/><param name='display_spinner' value='yes' \/><param name='display_overlay' value='yes' \/><param name='display_count' value='yes' \/><param name='filter' value='publish=yes' \/><\/object><\/div>                <script type='text\/javascript'>                    var divElement = document.getElementById('viz1563451555664');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https:\/\/public.tableau.com\/javascripts\/api\/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                <\/script>","ce5f6787":"combine.loc[(combine.Predict.isna())&(combine.Survived.isna())&(combine.Pclass_Gender==\"P3-Woman\"),\"Predict\"] = 1\ncombine.loc[(combine.Predict.isna())&(combine.Survived.isna()),\"Predict\"]=0","fc4d6736":"final_submit = pd.DataFrame({\"PassengerId\":combine[combine.Survived.isna()].PassengerId.values,\n                       \"Survived\":combine[combine.Survived.isna()].Predict.values})\nfinal_submit[\"Survived\"] = final_submit.Survived.astype(\"int64\")\nfinal_submit.tail(2)","5231bd27":"final_submit.to_csv(\"Titanic.csv\",index = False)","38d81d40":"**Summary\uff1aso far\uff0cthe \"Group_size\" and \"Ave_survival\" of all non-single passengers are filled.**","cd812aee":"## 2.3 Modify error information<a id=\"6\"><\/a>\n- Since \"Parch\",\"SibSp\",\"Family_size\" are important features to group \"ship team\" and \"second family\",and we can find out through the internet that there are some people cancel the trip.This may result in an inconsistent number of registered relatives and the number of relatives on the ship.\n- When the \"Family_size\" of a passenger is greater than or equal to 2\uff0cbut there is nobody with the same surname or maiden name,or same ticket,when the relationship of the step-parent is also excluded, the passenger's information may be statistically incorrect.","e0004076":"#### Step 4\uff1aone person's surname is the same as another person's maiden name","4047df77":"- there is a brother and sister relationship between [193,722]","9d448d07":"- Except in rare cases, passenger under the same ticket has the same \"Cabin_Title\", so we can use the \"Cabin_Title\" of the same ticket to filling the missing \"Cabin_Title\".","3e90e62c":"# 3.Analysis of relationship between new features and results<a id=\"7\"><\/a>","bac07e07":"**Step 5: Filling the \"Group_size\" and \"Ave_Survival\" of the passengers who have \"secondary families\" **","a29b9cca":"# 2.Feature engineering<a id=\"3\"><\/a>","1e57dfc9":"- Passengers under the same ticket number as \"members of the same ship group\", the survival rate between \"members of the same ship group\" may affect each other.","6294dfef":"- [248,313,756,1041] is a \"ship team\", but there is a brother of sister of 756 and a child of 581 canceled boarding.","49af3b25":"- [581, 1133] is a \"ship team\", but there is a child of 1133, a brother of sister of 581 canceled boarding.","f4fd72d2":"## 4.2 Identify the \"ship team\"<a id=\"13\"><\/a>","dc405215":"### 2.3.1 Filter passengers who may have incorrect information","298aafeb":"**Two situations**\n- Situation 1: All immediate family members are in the same ticket number (ship_family_2). In this situation, the \"Group_size\" is the size of the \"team consisting of all passengers with the same ticket number and the same name\", and the \"Ave_Survival\" is the average survival of all passengers in the same ticket in the complete train data.\n- Situation 2:All immediate family members are in the fuzzy ticket(ship_family_2_tic2, ship_family_1).In this situation, the \"Group_size\" is the average \"Family_size\" of all passengers in the same fuzzy ticket and same name.and the \"Ave_Survival\" is the average survival of all passengers in the team ticket in the complete train data.","ba583944":"## 4.3 Add new feature \u201cIf_Survived\u201d<a id=\"14\"><\/a>","1212e11d":"#### 3.Based on other important features\n- See if there are immediate family members based on the remaining important features\uff0csuch as:\"Cabin_Title\",\"Embarked\",\"Family_size\",\"Pclass\" and \"Age\".","4f63f191":"## 4.5 Survival prediction<a id=\"16\"><\/a>","d05aa84d":"### 6A.\"Ticket\"(New)","386c2342":"- Since there only one missing value in \"Fare\", and \"Fare\" is associate with \"Embarked\" (distance) and \"Pclass\" (level), it is possible to use the median fare of the same \"Embarked\" and \"Pclass\" to filling the missing values","dd5aa1fe":"**Summary**\nthe \"Group_size\" and \"Ave_Survival\" of  all \u201cpassengers with immediate family members\u201d have been fully filled. However, among the single passengers, there still could have a \u201cship team\u201d that consists of cousins, friends, or couples etc.\n- Traveling with cousins: same name, adjacent ticket number, and non-immediate relatives\n- Friends and other non-relative relationships: same ticket number,and non-immediate relatives","6d205d8b":"#### C.Text variable\n- \"Name\"\uff1aIt is composed of family name, name, title, maiden name, nickname, etc. It maybe the most important feature of all, So I will conduct an in-depth analysis later.\n- \"Ticket\"\uff1aThere are many people in the same ticket number.they may be from the same family\uff0cbut it not sure","47c1492f":"### 1B.\"Surname_Counts\"","07c4332a":"__These two passenger also have statistical error__","5bbd67a1":"**Observation conclusion\uff1a**\n- 1.When considering the combined effects of all features, the average survival rate of \"P1-Man\" was 35%.\n- 2.When considering the effect of each feature on \"Survived\" alone, there are no categories of survival rates above mortality,Therefore, for \"P1-Man\",they will all be predicted to died based on the average survival rate.","2fc84080":"## 1.2 Understand the features<a id=\"2\"><\/a>","37940efe":"## Table of Contents\n\n#### Qian Liu\n- email:liuqiantx1221@163.com\n- <18\/07\/2019>\n\n<div class=\"alert alert-block alert-info\" style=\"margin-top: 20px\">\n\n1. [Understand the data](#0)<br>\n[Import data set](#1)<br>\n[Understand the features](#2)<br>\n2. [Feature engineering](#3)<br>\n[Add new features](#4)<br>\n[Filling missing values](#5)<br>\n[Modify error information](#6)<br>\n3. [Analysis of relationship between new features and results](#7)<br>\n[An overview of features and Survived](#8)<br>\n[Check the survival rate of all types of passengers](#9)<br>\n[Survival prediction](#10)<br>\n4. [\"ship team\" and \"secondary family\"](#11)<br>\n[Passengers with immediate family members](#12)<br>\n[Identify the \"ship team\"](#13)<br>\n[Add new feature \u201cIf_Survived\u201d](#14)<br>\n[An overview of \"If_Survived\" and \"Survived\"](#15)<br>\n[Survival prediction](#16)<br>\n5. [Analysis of the remaining datasets](#17)<br>\n[Learn about the remaining training data and test data](#18)<br>\n[Visualization of the relationship between passenger's features and survival rate](#19)<br>\n[Survival prediction and result submission](#20)<br>","6a6b2824":"### 6B.\u201cTicket_Counts\u201d","61cddd9a":"## 5.1 Learn about the remaining training data and test data<a id=\"18\"><\/a>","4cc64b66":"## Introduction\nThis is my first kernel at Kaggle\uff0cI have learned a lot in Kaggle these two months,and I'm glad to share my kernel with you.Actually,I'm still a beginner in data science,so,if you have any suggestions, please leave a message or email me.:)\n\nThis kernel only uses knowledge of feature engineering, but for the use of pandas, I think this will be a good review.The core of the method is to decompose layer by layer, looking for \u201cship team\u201d and \u201csecondary family\u201d.The analysis logic is somewhat complicated, but each step has annotations, and some also have charts. If there are any unclear points, please leave a message.I hope this kernel can help you.","bf73e89b":"- If the \u201cnumber of members of the same ship team\u201d is inconsistent with the \u201cFamily_size\u201d, the passenger may still have immediate family members in other \u201cship team\u201d. It can form a \"secondary family.\"","2b510720":"**Note: When the \"Ave_Survival\" is 0 or 1, and the test data is included in the team, the real \"Ave_Survival\" needs to be checked again. The rules are as follows:**\n- When \"Ave_Survival\" is 0, in both cases, the real \"Ave_Survival\" is 0: A. Train data include women. B.Test data in team are all men.\n- When \"Ave_Survival\" is 1, in both cases, the real \"Ave_Survival\" is 1: A. Train data include men. B.Test data in team are all women. \n- In addition to these cases, the \"Ave_Survival\" was set at 0.5.","8461e103":"**Observation conclusion\uff1a**\n- 1.The average survival rate for female is 74% when considering the effects of all variables\n- 2.\"Pclass\" has the greatest impact on survival rate\uff0cEspecially for P1 and P2 female, their average survival rate is 95%.It can be understood that the survival rate of upper-class passengers is higher than that of the lower class.\n- 3.\"Embarked\" also has some impact on survival rate,as the survival rate of C port is 88%,higher than average survival,and according to \u3010Embarked,Pclass\u3011\uff0cWhen Embarked is not considered, the survival rate of P3 is 50%. When Embarked is considered, the survival rate of each port changes greatly.\n- 4.\"Age\" is normal distribution\uff0cits impact on survival rate is not obvious.\n- 5.The distribution of \"Fare\" has a very large positive skew.For most passenger,its impact on survival rate is not obvious,But overall, passengers with high fares also have higher survival rates.According to \u3010Fare,Pclass\u3011\uff0cexcept Pclass 1,the other's distribution is concentrated.\n- 6.The distribution shape and impact of SibSp and Parch are familiar,and they both represent family relationships,so they can be combined.","d0a37b27":"### 4.1.1 \u201cOnly with the immediate family members\u201d or \u201cincluding a secondary family\u201d","15263d81":"# 1.Understand the data<a id=\"0\"><\/a>","4529a309":"###### 3.Use \"Embarked\", \"Ticket2\", \"Pclass\" to group the remaining passengers","da8885c5":"- There is no evidence to prove that there is a brother and sister relationship between [443,1106].especially [1106] has a large family.","9f8ce9de":"- Conclusion: These three passengers are the relationship between parents and daughters","71bfe787":"## 3.3 Survival prediction<a id=\"10\"><\/a>","f2c5f8f2":"__[268&443] may be step brother,but not sure__","3af85b7e":"###### 2.Immediate relatives with large difference in ticket number","da96aafe":"**Observation conclusion\uff1a**\n- 1.When considering the combined effects of all features, the average survival rate of \"P3-Man\" was only 11%.\n- 2.When considering the effect of each feature on \"Survived\" alone, there are no categories of survival rates above mortality,Therefore, for \"P3-Man\",they will all be predicted to died based on the average survival rate.","ba68c6c3":"- 2.same maiden name","7973e9bd":"## 3.2 Check the survival rate of all types of passengers<a id=\"9\"><\/a>","85c0ac1f":"##### Step 2: Check for abnormal passengers and add new features \"Group_size\" and \"Ave_Survival\" for them","c9e44cbc":"#### Step 3: Divide these passengers into two categories: \u201conly with the cousins\u201d and \u201cwith non-cousin passengers in the ship team\u201d,and filling the \"Group_size\" and the \"Ave_Survival\" of them.","138abec2":"<h1 align=center><font size = 5> Titanic:only use two features to reach top 5%<\/font><\/h1>","70272faa":"**Observation conclusion\uff1a**\n- 1.For \"P1-Man\" and \"P3-Man\", due to their higher mortality in the complete dataset\uff0cespecially for \"P3-Man\"\uff0cwhen making predictions based on \"IF_Survived\", although some passengers can be predicted to survive, their error rate is greater than 20%\uff0cand the sample size is small\uff0cit may have errors, so\uff0cfor \"P1-Man\" and \"P3-Man\" in test data and be predicted to survive,it needs more check.\n- 2.For \"P3-Boy\",since the prediction accuracy rate for them is 100%. the prediction results are credible.\n- 3.For \"P3-Woman\":since the prediction accuracy rate for them is 97%\uff0cand in complete dataset,it's only 50%\uff0ccompared with before, there has been a big improvement, so the prediction results are credible.","ba66c0c9":"### 4.3.1 When \"Ave_Survival\" is equal to 0.5","bf514b85":"### 5.\"Pclass_Gender\"","94668563":"# 5.Analysis of the remaining datasets<a id=\"17\"><\/a>","c8c55448":"### 3B.\"Maiden_Counts\"\n- When the maiden name is repeated, there may be relatives on board.","52bf253a":"## 5.3 Survival prediction and result submission<a id=\"20\"><\/a>","4eb841d5":"__[137] passenger have maiden  extraction errors__","03fc6d72":"### 2.\"Gender\"","9c9a2727":"- In addition to the common titles such as Ms., Mr. and Miss, it is observed that the male contains \"Master\", which means \"boy\". According to previous observations, the survival rate of young men is higher, so \"Mater\" can be extracted. ,  while other titles are still used as a sign to distinguish between men and women.","26674ed9":"**Step 6: Add \"Group_size\" and \"Ave_Survival\" of all passengers with immediate family members to the complete dataset**","e642c0f6":"- For the initials of a cabin in multi-cabin, some have the same initials and some are different. In different cases, the initials are extracted differently.","ca31d4a2":"**Observation conclusion\uff1a**\n- 1.The average survival rate for male is 19% which is much lower than female.\n- 2.\"Pclass\" also has some impact on male survival rate\uff0cfor example, the survival rate for P1 male is 37%,but according to the probability, none of them can predict to survive.\n- 3.For male,Embarked C has the highest survival rate,but only 30%.Embarked Q survival rate is below average, only 7%.According to \u3010Embarked and Pclass\u3011\uff0csince the Q port is almost all P3 male, and there are many P1 male embarked from C port,the impact of \"Embarked\" on male survival is not clear.\n- 4.The survival rate of young men is much higher than the average, reaching 65%.According to \u3010Pclass and Age\u3011\uff0cthe survival rate of P1 and P2 young men has reached 100%, which is also in line with the \u201cprinciple of women and children\u201d.\n- 5.The distribution and impact of \"Fare\" in male data is familiar with it in female data.","94c7cfd7":"**Summary:**\n- Since the survival rates of \"P1-Man\" and \"P3-Man\" are consistent in the complete dataset and the remaining dataset, the relationship between features and \"Survived\" of these passengers will be observed in the complete dataset.\n- the relationship between features and \"Survived\" of \"P3-Woman\" will be observed in the remaining dataset.\n- The survivability of \"P3-Boy\" will be predicted to be died based on its survival rate in the complete dataset.","6e8203de":"#### 2.Check for maiden name\n- check if there are extraction errors of passenger's maiden name ","913e8541":"- For the above groups\uff0cif one's surname is the same with another persons' maiden name in the same group,than they can group a \"ship team\".","b97b9adf":"#### 1.\"Fare\"\u548c\"Fare_PP\"","a5d1095f":"### 1A.\"Surname\"\n- Extract family names to identify passengers belonging to the same family","5da0306e":"#### Step 2: Filter passengers travelling with cousins who have \u201cImmediate family\u201d","a92c09b8":"## 4.1 Passengers with immediate family members<a id=\"12\"><\/a>","0889a92d":"- Conclusion: The two passengers are father-son relationship, but their ticket is quite different","0d2bf8f8":"### 7A.\"Ticket2\"\n- Some family members may be present in the adjacent ticket number, which can also be considered as \"the same ship team\"\u3002\uff08This rule is effective only when there is a kinship relationship.\uff09","191e5d4d":"### 3A.\"Maiden\"\n- Extract the maiden name as another sign to identify family members","a3f176ab":"# 4.\"ship team\" and \"secondary family\"<a id=\"11\"><\/a>\n\n**Noun definition\uff1a**\n- 1.\"ship team\"\uff1aA. Passengers with the same ticket. B. Immediate family members adjacent to the ticket. C. Cousins adjacent to the ticket (same surname or maiden, but not each other's immediate family).\n- 2.\"secondary family\"\uff1aImmediate family members of different \"ship team\" can form a secondary family\n\n**Core method: layer by layer**","54a7c195":"- In the three ways, the survival rate of \"P1 and P2 Boys\" is 100%, but the number of boys in method 3 is the largest. Therefore,method 3 is used as the way to distinguish between boys and men.","42c37f7c":"#### 2.\"Cabin_Title\"","5b585b2d":"**Step 1: Extract all passengers with immediate family members**","4eef655b":"## 1.1 Import data set<a id=\"1\"><\/a>","396f9afe":"#### A.Category data\n**1.Nominal variable**\n- \"Cabin\":The combination of letters and numbers,it indicates the passenger compartment and it has a great amount of missing data.\n- \"Embarked\"\uff1aS,Q,C\uff0cit represent different ports.\n\n**2.Binary variable**\n- \"Sex\":male,female\n\n**3.Ordinal variables**\n- \"Pclass \":1\uff08high\uff09,2\uff08medium\uff09,3\uff08low\uff09\uff0cit represents socioeconomic status","e57d0709":"### 7B.\"Ticket2_Counts\"","51e2e046":"### 2.3.2 Check these passenger's imformation","51f604e7":"- It seems that the initials of the cabin are more useful, but some of the cabin values contain multiple cabin, so the initials of the single cabin and the initials of the multi-cabin can be extracted separately.","934a0771":"###### 3.1 Check the team group by fuzzy ticket.","d37eb3c1":"#### 1.Filtering step-parent relationship\n-  If there is a step_parent relationship,they should have the same ticket,that is,\"Ticket_Counts\"should greater or equal to 2.","1d0caec7":"#### B.Numerical data\n**1.Discrete variable**\n- \"PassengerId\"\uff0cPassenger's unique identifier\n- \"SibSp\"\uff1aThe number of siblings and spouses on board.\n- \"Parch\"\uff1aThe number of children and parents on board,including stepparents.\n- \"Survived\"\uff1aTarget variable.\n\n**2.Continuous variable**\n- \"Age\"\n- \"Fare\"","183c66be":"- There are no passengers of the same surname with a \"Family_size\" greater or equal to 2, and no passengers of the same maiden name with a \"Family_size\" greater or equal to, but the \"Family_size\" of  the passenger is greater or equal to 2. ","39ceafa6":"**Observation conclusion:**\n- 1.The \"Survived\" of these passenger can be predicted only based on \"Pclass_Gender\": \"P1&P2 Woman\",\"P1&P2 Boy\" and \"P2-Man\"\n- 2.The survival rate of the remaining passengers needs to be predicted based on other features.","5b0a1156":"## 2.2 Filling missing values<a id=\"5\"><\/a>\n- Since some features aren't important and rarely used,for missing values,we just make a simple filling.","2df3c234":"**Step 3: Divide the remaining passengers into two categories: \u201cOnly with the immediate family members\u201d or \u201cincluding a secondary family\u201d**","7b00919c":"**Observation conclusion\uff1a**\n\n**Aboout Overview 1**\n- 1.\"Pclass_Gender\" has a greater relationship with survival rate, \"P1&P2 Boy\" all survives, \"P1&P2 Woman\" has a high survival rate, and \"P2 Man\" has a low survival rate.\n- 2.When \"Fare_PP\" is higher than 40, the survival rate is higher. However, due to the concentrated distribution of fares, \"Fare_PP\" can only be used as an auxiliary feature to predict survival.\n- 3.The \"Age\" distribution is a normal distribution, except for the higher survival rate of the younger passengers, the survival rate of the other passengers is not much different, which is consistent with the conclusion 1.\n- 4.Passengers embarked from \"S port\" have the highest mortality rate, and the survival rates of the other two ports are not much different,so it can only be used as an auxiliary feature to predict survival.\n- 5.\"Cabin_Title\" is also a normal distribution, and overall it has little to do with survival.\n\n**About Overview 2**\n- 1.The distribution of \"Ticket_Counts\" differs from the distribution of \"Family_size\", indicating that not all family members are in the same \"ship team\"\u3002\n- 2.The distribution of the four features is similar ,indicating that these features are related to each other.\n- 3.Since their distribution shape are all with a very large positive skew, the relationship between these features and survival rate is not clear.","70b6d3a2":"### 1.2.2 Analysis of the relationship between independent variables and dependent variables","c4bb28e5":"- In addition to \"Title\", \"Age\" is another way to distinguish between boys and men,according to the visual chart of\u3010Pclass and Age\u3011\uff0cmale under 16 years old is also \"Boy\",what's more,we can also combine the two methods.","63b1df2b":"- \"Name\" includes family name, title, name, nickname(partial), and maiden name(partial),the following focuses on family name, title, and maiden name.","08d54bf9":"### 8.\"Cabin_Title\"\n- Although there are many missing values in \"Cabin\", we can still extract the effective information from it for backup.","7a0f9aed":"### 4.\"Family_size\"\n- The \"Family_size\" here only represents a first-class family consisting of immediate family members.(Note:Due to the existence of a relationship such as step-parent, family members in the same family may have different surnames.)","3a608e01":"#### Step 5\uff1aFilling  the \"Group_size\" and \"Ave_survival\" of  the remaining \"ship team\"(group by the same ticket)","08fa302a":"- Only [41] maiden is the same with [714] surname,so they can group a \"ship team\"","6984dcc4":"###### 3.2 Check the information of the remaining passengers","b885e5b0":"## 5.2 Visualization of the relationship between passenger's features and survival rate<a id=\"19\"><\/a>","b456c2b3":"<img src=\"https:\/\/raw.githubusercontent.com\/liuqiantx\/Mechine-learning\/master\/Titanic\/Visio.png\">","5a50017f":"**Note**\n- team1:when \"Family_size\" is greater than \"Ticket_Counts\",all passengers with the same name (family surname or maiden name) from the passenger in the fuzzy ticket number(adjacent or same ticket number)\n- team2:when \"Family_size\" is less than or equal to \"Ticket_Counts\",all passengers with the same name (family surname or maiden name) from the passenger in the same ticket number.\n- team3:when \"Family_size\" is less than or equal to \"Ticket_Counts\",all passengers with the same name (family surname or maiden name) from the passenger in the fuzzy ticket number(adjacent or same ticket number).","0da28a97":"## 3.1 An overview of features and Survived<a id=\"8\"><\/a>","3def5187":"## 2.1 Add new features<a id=\"4\"><\/a>","fcc2e4dd":"- 1.same surname","4fd91af8":"###### 1.Stepparent relationship","22b1b229":"- \u5f53\"Ave_Survival\"\u4e3a0.5\u65f6\uff0c\"P1-Man\" & \"P3-Man\" can be predicted as died\uff0c\"P3-Woman\"can be predicted as survived\uff0cbut for \"P3-Boy\",it needs more check.","550106c7":"#### Step 1\uff1aFilter passengers who traveling with cousins","60a47e75":"## 4.4 An overview of \"If_Survived\" and \"Survived\"<a id=\"15\"><\/a>","38b0bde1":"### 2.3.3 Modify incorrect information","e923acd2":"- Except that [931] has a high probability of surviving, the probability of the other three passengers surviving is unclear.Therefore, in addition to [931], the other three passengers will be predicted to die based on the probability in the complete dataset.","cc62201e":"**The \u201csecondary family\u201d of the remaining 30 passengers is divided into three situations:**\n- Possibility #1: There is a step-parent relationship. That is, the family size of all members with the same ticket is equal to the size of this team.\n- Possibility #2: There are immediate family members on ship, but their ticket is very different.That is,The size of the team which consists of all members with same name among the remaining passengers is equal to the \"Family_size\" of the team members.\n- Possibility #3\uff1aIf the above conditions are not met, it is necessary to use more feature values of the passengers, or it may be a statistical error of the passenger information.","ca0dba45":"### 1.2.1 The analysis of data category and meaning","e563145b":"- According to human nature, when a mother took a son and no one in the group died, the son would survived,so [1053,1199,1309] will be predicted as survived.\n- For the remaining boys,since someone in the team has died\uff0cso they will be predicted as died.","79eceafc":"- Since \"Gender\", \"Title\" and \"Sex\" are repeated, \"Title\" and \"Sex\" can be removed.","55752b04":"### 4.2.1 Traveling with cousins\n- The identification method of the cousin:same surname,same maiden name,or one's surname is the same as another person's maiden name. ","ccfbc642":"__According \"Age\",\"Parch\" and \"SibSp\",Judging there is a statistical error of [274] passenger__","8c80c8d3":"- After considering multiple features comprehensively, passenger [41,893,1296] have a statistical error\n- Passenger [69] is in a large family.","d4b35812":"**Step 4: Filling the \"Group_size\" and \"Ave_Survival\" of the passengers who \"only with their immediate relatives\"**","b692d07d":"### 9.\"Fare_PP\"\n- Since a single ticket may contain more than one passenger, and the existing \"Fare\" indicates the price of a single ticket, the \"Fare per person\" can be extracted as another feature.","28a6061d":"**Observation conclusion\uff1a**\n- 1.When considering the combined effects of all features, the average survival rate of \"P3-Woman\" was 65%.\n- 2.When considering the effect of each feature on \"Survived\" alone, only when age is between 36 and 47,the survival rate is 0%,However, the sample size of it is too low and the prediction error is large.Therefore, for \"P3-Woman\",they will all be predicted to survive based on the average survival rate."}}