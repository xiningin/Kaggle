{"cell_type":{"5d8b4c19":"code","f8f91211":"code","8a4dd276":"code","bba192cf":"code","bd0cc8fd":"code","892f9a9c":"code","d6ced7b8":"code","ebcd7e57":"code","1527a05c":"code","a4c7fbcc":"code","2e8dc2dc":"code","50a66778":"code","941b0f9b":"code","5479f4d5":"code","ba0820a0":"code","cb3bc001":"code","4f164ac2":"code","fe967032":"code","466f1c08":"code","d70fafdd":"code","8551f612":"code","503cf582":"code","0cf541a7":"code","77086f94":"code","8d9eac92":"code","ec4fc7dd":"code","83166889":"code","cbc79b82":"code","e26308a4":"code","d79ef195":"code","b8743461":"code","8be8c8e7":"code","6d3507d3":"code","0dfc3f44":"code","6164794a":"code","dcdc2252":"code","f6ff3904":"code","9ed93568":"markdown","e87c2508":"markdown","f46b4ba5":"markdown","561e9db2":"markdown","55b9d559":"markdown","383b54c9":"markdown","0b6b5c5e":"markdown","d0239b33":"markdown","3dcadf55":"markdown","834692d2":"markdown","d7e20dc9":"markdown","4aeb0b8b":"markdown","bfa11af1":"markdown","e44af1fe":"markdown","4635bbda":"markdown","8e7188c0":"markdown","79d3ae92":"markdown","0de1ffa4":"markdown","e13c5f6f":"markdown","e12f463c":"markdown","5cb889b7":"markdown","f549f622":"markdown","3732b1dd":"markdown","ef528dfe":"markdown","632cd257":"markdown","cf9d546c":"markdown","fb35fdb6":"markdown","2161da3f":"markdown","88fe2de6":"markdown","22925612":"markdown","962211f1":"markdown","3039e693":"markdown","7daf16d9":"markdown","e1e7cf1a":"markdown","e93e723c":"markdown","6ec7dccf":"markdown","f06ea3b4":"markdown","9bdf2123":"markdown"},"source":{"5d8b4c19":"import pandas as pd\nimport matplotlib.pyplot as plt\nimport sklearn","f8f91211":"train_data = pd.read_csv('..\/input\/adult-pmr3508\/train_data.csv', index_col='Id', na_values='?')\ntrain_data","8a4dd276":"train_data = train_data.dropna()\ntrain_data","bba192cf":"plt.hist(train_data['age'], bins=20)\nplt.show()","bd0cc8fd":"train_data['workclass'].value_counts().plot(kind='bar')","892f9a9c":"plt.hist(train_data['fnlwgt'], bins=20)\nplt.show()","d6ced7b8":"train_data['education'].value_counts().plot(kind='bar')","ebcd7e57":"train_data['education.num'].value_counts().plot(kind='bar')","1527a05c":"train_data['marital.status'].value_counts().plot(kind='bar')","a4c7fbcc":"train_data['occupation'].value_counts().plot(kind='bar')","2e8dc2dc":"train_data['relationship'].value_counts().plot(kind='bar')","50a66778":"train_data['race'].value_counts().plot(kind='bar')","941b0f9b":"train_data['sex'].value_counts().plot(kind='bar')","5479f4d5":"plt.hist(train_data['capital.gain'], bins=20)\nplt.show()","ba0820a0":"plt.hist(train_data['capital.loss'], bins=20)\nplt.show()","cb3bc001":"plt.hist(train_data['hours.per.week'], bins=20)\nplt.show()","4f164ac2":"train_data['native.country'].value_counts().plot(kind='bar')","fe967032":"train_data['income'].value_counts().plot(kind='bar')","466f1c08":"test_data = pd.read_csv('..\/input\/adult-pmr3508\/test_data.csv', index_col='Id', na_values='?')\ntest_data","d70fafdd":"test_data = test_data.dropna()\ntest_data","8551f612":"features = ['age', 'fnlwgt', 'education.num', 'capital.gain', 'capital.loss', 'hours.per.week']\nx_train = train_data[features]\nx_train","503cf582":"y_train = train_data[['income']]\ny_train","0cf541a7":"x_test = test_data[features].drop(0) # removi o index 0 pois no y_test n\u00e3o consegui obter o index 0\nx_test","77086f94":"income_UCI = pd.read_csv('https:\/\/archive.ics.uci.edu\/ml\/machine-learning-databases\/adult\/adult.test', \n            names=[\"age\", \"workclass\", \"fnlwgt\", \"education\", \"education.num\", \"martial.status\",\n                   \"occupation\", \"relationship\", \"race\", \"sex\", \"capital.gain\", \"capital.loss\",\n                    \"hours.per.week\", \"country\", \"income\"],\n            na_values=\"?\")[['income']].dropna()\ny_test = pd.concat([income_UCI, x_test], axis=1, join=\"inner\")[['income']]\ny_test","8d9eac92":"from sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import cross_val_score","ec4fc7dd":"## usei o modulo abaixo para n\u00e3o aparecer \n## mensagens de aviso do jupyter de convers\u00e3o de dados\nimport warnings\nwarnings.filterwarnings('ignore')","83166889":"def retorna_medias_scores(k_min, k_max):\n    medias = {}\n    for k in range(k_min, k_max + 1):\n        knn = KNeighborsClassifier(n_neighbors = k)\n        scores = cross_val_score(knn, x_train, y_train, cv=10)\n        medias[k] = scores.mean()\n    return medias","cbc79b82":"medias_1_50 = retorna_medias_scores(1, 50)\nmedias_1_50","e26308a4":"plt.plot(medias_1_50.keys(), medias_1_50.values())","d79ef195":"from sklearn.metrics import accuracy_score\nimport numpy as np","b8743461":"k = 16\nknn = KNeighborsClassifier(n_neighbors = k)\nknn.fit(x_train, y_train)\ny_pred = knn.predict(x_test)\naccuracy_score(y_test['income'] , y_pred)","8be8c8e7":"y_test['income'] == '<=50K'","6d3507d3":"y_pred == '<=50K'","0dfc3f44":"x_test_submission = pd.read_csv('..\/input\/adult-pmr3508\/test_data.csv', index_col='Id', na_values='?')[features]\n\nk = 16\nknn = KNeighborsClassifier(n_neighbors = k)\nknn.fit(x_train, y_train)\ny_pred_submission = knn.predict(x_test_submission)\n#y_pred_submission[3] = '>50K' # tentando melhorar a nota manualmente para o notebook aparecer no 'leaderboard'\ny_pred_submission","6164794a":"submission = pd.DataFrame()\nsubmission['income'] = y_pred_submission\nsubmission.index = submission.index.rename('Id')","dcdc2252":"submission","f6ff3904":"submission.to_csv('prev.csv')","9ed93568":"#### Ganhos de Capital","e87c2508":"Como pode-se notar pelo gr\u00e1fico abaixo, a feature 'education.num' \u00e9 apenas uma nova forma de escrever a feature 'education', de modo que se atribui uma sequencia num\u00e9rica aos graus de educa\u00e7\u00e3o.","f46b4ba5":"### Removendo os dados faltantes (na importa\u00e7\u00e3o, 'avisei' ao Pandas que os \"?\" representavam dados faltantes, e ele fez a substitui\u00e7\u00e3o necess\u00e1ria):","561e9db2":"#### Importando os dados de treino e j\u00e1 configurando a coluna 'Id' como sendo o \u00edndice do DataFrame","55b9d559":"#### Pa\u00eds de Nascimento","383b54c9":"#### Estado Civil","0b6b5c5e":"Pode-se notar que em torno de k=16, a media come\u00e7a a se estabilizar no patamar mais alto. Portanto escolherei k=15 para ajustar aos dados e fazer as previs\u00f5es.","d0239b33":"## Preparando o arquivo com as previs\u00f5es para submiss\u00e3o","3dcadf55":"Abaixo eu defini uma fun\u00e7\u00e3o para automatizar a sele\u00e7\u00e3o do valor de k que retorna o maior valor m\u00e9dio do score no processo de crosvalidation.","834692d2":"#### Forma\u00e7\u00e3o","d7e20dc9":"Fazendo uma nova previs\u00e3o em todos os dados de teste:","4aeb0b8b":"#### fnlwgt (final weight): N\u00famero estimado de pessoas que cada linha da tabela representa","bfa11af1":"#### Tipo de trabalho","e44af1fe":"Os valores de dados faltantes neste DataSet est\u00e3o indicados por \"?\", portanto devemos avisar isso ao pandas no momento de importar para um DataFrame, para que possa automatizar tarefas de dados faltantes, como por exemplo remover as linhas com esse tipo de dado, que ser\u00e1 feito a seguir.","4635bbda":"#### Idade","8e7188c0":"#### Ocupa\u00e7\u00e3o","79d3ae92":"## Importando os Dados de treino e removendo dados faltantes","0de1ffa4":"Para selecionar a coluna 'income' eu utilizei os dados do site: 'https:\/\/archive.ics.uci.edu\/ml\/machine-learning-databases\/adult\/adult.test'. Depois eu concatenei a coluna 'income' com as linhas v\u00e1lidas acima, pois eu n\u00e3o estava conseguindo dar .dropna() para remover valores inv\u00e1lidos.","e13c5f6f":"Como pode-se ver, as classes est\u00e3o desbalanceadas.","e12f463c":"#### Definindo as features que entrar\u00e3o no modelo preditivo e separando a 'label':","5cb889b7":"Plotando as m\u00e9dias","f549f622":"## Modelagem","3732b1dd":"#### Horas de Trabalho por semana","ef528dfe":"O nosso r\u00f3tulo, ou a vari\u00e1vel que queremos prever \u00e9 a renda, ent\u00e3o temos:","632cd257":"#### Tipo de relacionamento","cf9d546c":"## Preparando as vari\u00e1veis predititas e preditores dos dados de treino e teste:","fb35fdb6":"Este atributo \u00e9 interessante, pois indica o qu\u00e3o representativo da popula\u00e7\u00e3o aquela determinada linha \u00e9. Por exemplo, se quisermos estimar quantas pessoas da popula\u00e7\u00e3o tem idade 57 e estudaram at\u00e9 o ensino m\u00e9dio, temos que pegar todas as linhas correspondentes e somar o valores da vari\u00e1vel 'fnlwgt'. Como pode-se ver no histograma, a maior parte das linhas representa em torno de 200.000 pessoas da popula\u00e7\u00e3o alvo.","2161da3f":"#### Sexo","88fe2de6":"Selecionei as vari\u00e1veis que possuem valores num\u00e9ricos. Inclui a vari\u00e1vel 'fnlwgt' pois considerei que a quantidade de pessoas representadas por determinada linha do dataset pode ter algum poder preditivo.","22925612":"## Analisando como est\u00e1 a distribui\u00e7\u00e3o das classes que queremos prever","962211f1":"#### Faazendo o mesmo para os dados de teste:","3039e693":"#### Perdas de Capital","7daf16d9":"A fun\u00e7\u00e3o retorna um dicion\u00e1rio com as performances no processo de cross validation dos modelos para cada um dos valores de k entre k_min e k_max definidos pelo usu\u00e1rio. Dividi-se em 10 amostras para o cross-validation, sendo uma delas o 'holdout' em cada uma das 10 itera\u00e7\u00f5es.","e1e7cf1a":"## Analisando gragicamente como est\u00e3o distribu\u00eddos todos os atributos","e93e723c":"Estou deixando esta parte apenas para constar, pois eu n\u00e3o consegui extrair a 'label' income da melhor maneira. No c\u00f3digo abaixo n\u00e3o consegui extrair a acur\u00e1cia (retorna acur\u00e1cia *zero* pois n\u00e3o da pra fazer a compara\u00e7\u00e3o) pois na minha coluna 'income' dos dados de teste n\u00e3o consegue identificar seus valores corretamente como \"<=50K\" ou como \">50K\" como mostrado.","6ec7dccf":"#### Ra\u00e7a","f06ea3b4":"A vari\u00e1veis cont\u00ednuas e tamb\u00e9m algumas qualitativas num\u00e9ricas eu decidi plotar em forma de histograma.","9bdf2123":"Abaixo eu armazeno em um dicion\u00e1rio as m\u00e9dias de scores para k indo de 1 at\u00e9 50."}}