{"cell_type":{"c6ede0e7":"code","33b1b2eb":"code","435adb63":"code","4ea94ec4":"code","a21738ee":"code","6c164433":"code","c91a5768":"code","7eab6a76":"code","78d63f2c":"code","a0be7538":"code","6eb527d0":"code","5d3a3af9":"code","6c1617c9":"code","1b4cdbee":"code","0ec17044":"code","ac6a342d":"code","9c4446e2":"code","0e94d799":"code","c4aee8d9":"code","3389a917":"markdown","550edcfc":"markdown"},"source":{"c6ede0e7":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport datetime\nimport warnings\nwarnings.filterwarnings('ignore')\nimport keras\nimport keras.backend as K\nfrom keras.layers.core import Activation\nfrom keras.models import Sequential,load_model\nfrom keras.layers import Dense, Dropout, LSTM\nfrom keras.optimizers import Adam\nfrom keras.models import load_model\nfrom keras.callbacks import ModelCheckpoint\nfrom keras.callbacks import EarlyStopping\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","33b1b2eb":"#load files\ntrain = pd.read_csv(\"\/kaggle\/input\/train_label.csv\")\nfeatures = pd.read_excel(\"\/kaggle\/input\/feature.xlsx\")\ntest = pd.read_csv(\"\/kaggle\/input\/test_label_sample.csv\")","435adb63":"train['date']= pd.to_datetime(train['date'],format='%d\/%m\/%Y') \ntrain.shape","4ea94ec4":"test['date']= pd.to_datetime(test['date'],format='%d\/%m\/%Y') \ntest.shape","a21738ee":"new_header = features.iloc[0] #grab the first row for the header\nfeatures = features[1:] #take the data less the header row\nfeatures.columns = new_header #set the header row as the df header\nfeatures['date'] = features['date'].dt.date","6c164433":"error_id_count=features.iloc[:,1:28]\nerror_id_count['date']= pd.to_datetime(error_id_count['date'],format='%Y-%m-%d')\nerror_id_count.shape","c91a5768":"df_train= pd.merge(error_id_count, train, on='date')\ndf_train.columns = ['date', 'e1', 'e2', 'e3','e4', 'e5', 'e6', 'e7', 'e8', 'e9', 'e10', 'e11', 'e12', 'e13', 'e14',\n                     'e15', 'e16', 'e17', 'e18', 'e19', 'e20', 'e21','e22','e23','e24','e25','e26','label']\ndf_train.head()","7eab6a76":"df_test = pd.merge(error_id_count, test, on='date')\ndf_test.columns = ['date', 'e1', 'e2', 'e3','e4', 'e5', 'e6', 'e7', 'e8', 'e9', 'e10', 'e11', 'e12', 'e13', 'e14',\n                     'e15', 'e16', 'e17', 'e18', 'e19', 'e20', 'e21','e22','e23','e24','e25','e26','label']\ndf_test.head()","78d63f2c":"features_col_name=[ 'e1', 'e2', 'e3','e4', 'e5', 'e6', 'e7', 'e8', 'e9', 'e10', 'e11', 'e12', 'e13', 'e14',\n                     'e15', 'e16', 'e17', 'e18', 'e19', 'e20', 'e21','e22','e23','e24','e25','e26']\ntarget_col_name='label'","a0be7538":"from sklearn.preprocessing import MinMaxScaler\nsc=MinMaxScaler()\ndf_train[features_col_name]=sc.fit_transform(df_train[features_col_name])\ndf_test[features_col_name]=sc.transform(df_test[features_col_name])","6eb527d0":"def gen_sequence(id_df, seq_length, seq_cols):\n    df_zeros=pd.DataFrame(np.zeros((seq_length-1,id_df.shape[1])),columns=id_df.columns)\n    id_df=df_zeros.append(id_df,ignore_index=True)\n    data_array = id_df[seq_cols].values\n    num_elements = data_array.shape[0]\n    lstm_array=[]\n    for start, stop in zip(range(0, num_elements-seq_length), range(seq_length, num_elements)):\n        lstm_array.append(data_array[start:stop, :])\n    return np.array(lstm_array)","5d3a3af9":"def gen_label(id_df, seq_length, seq_cols,label):\n    df_zeros=pd.DataFrame(np.zeros((seq_length-1,id_df.shape[1])),columns=id_df.columns)\n    id_df=df_zeros.append(id_df,ignore_index=True)\n    data_array = id_df[seq_cols].values\n    num_elements = data_array.shape[0]\n    y_label=[]\n    for start, stop in zip(range(0, num_elements-seq_length), range(seq_length, num_elements)):\n        y_label.append(id_df[label][stop])\n    return np.array(y_label)","6c1617c9":"# timestamp or window size\nseq_length=50\nseq_cols=features_col_name","1b4cdbee":"X_train=gen_sequence(df_train, seq_length, seq_cols)\nprint(X_train.shape)\n# generate y_train\ny_train=gen_label(df_train, 50, seq_cols,'label')\nprint(y_train.shape)","0ec17044":"X_test=gen_sequence(df_test, seq_length, seq_cols)\nprint(X_test.shape)\n# generate y_train\ny_test=gen_label(df_test, 50, seq_cols,'label')\nprint(y_test.shape)","ac6a342d":"nb_features =X_train.shape[2]\ntimestamp=seq_length\n\nmodel = Sequential()\n\nmodel.add(LSTM(\n         input_shape=(timestamp, nb_features),\n         units=100,\n         return_sequences=True))\nmodel.add(Dropout(0.2))\n\nmodel.add(LSTM(\n          units=50,\n          return_sequences=False))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(units=1, activation='sigmoid'))\nmodel.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])\n\nmodel.summary()","9c4446e2":"model.fit(X_train, y_train, epochs=10, batch_size=200, validation_split=0.05, verbose=1,\n          callbacks = [EarlyStopping(monitor='val_loss', min_delta=0, patience=0, verbose=0, mode='auto')])","0e94d799":"# training metrics\nscores = model.evaluate(X_train, y_train, verbose=1, batch_size=200)\nprint('Accurracy: {}'.format(scores[1]))","c4aee8d9":"y_pred=model.predict_proba(X_test)","3389a917":"* reference : https:\/\/www.kaggle.com\/nafisur\/predictive-maintenance-using-lstm-on-sensor-data\n* data : https:\/\/www.kaggle.com\/c\/predictive-maintenance1\/data","550edcfc":"**LSTM NETWORK**"}}