{"cell_type":{"358e4be5":"code","f0f43665":"code","cc0500f6":"code","82d993d3":"code","3ebc1b02":"code","a6493eae":"code","950cab4d":"code","e55804ac":"code","dec55f84":"code","9af6f9b5":"markdown","a36a5982":"markdown","de644ab3":"markdown","a1d39f7b":"markdown"},"source":{"358e4be5":"import pandas as pd\nimport numpy as np\nimport pylab\n%matplotlib inline\n\nimport plotly.graph_objs as go\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode(connected=True)","f0f43665":"df = pd.read_csv(\"..\/input\/20181019-wikia_stats_users_birthdate.csv\")\ndf['datetime.birthDate'] = pd.to_datetime(df['datetime.birthDate'], infer_datetime_format=True, errors='coerce') \ndf.set_index(df['datetime.birthDate'], inplace=True)\ndf.head()","cc0500f6":"byYear = df.resample('y').count()['id']\nbyYear","82d993d3":"dfClean = df['2004':'2017'].copy()\nbyYear = dfClean.resample('y').count()['id']\n\n# Active Wikis: at least one active user in the last 30 days\nactiveByYear = dfClean[(dfClean['stats.activeUsers']>=1)&(dfClean['users_1']>0)].resample('y').count()['id']\nactiveByYear","3ebc1b02":"traceTotal = go.Bar(x=byYear.index.year, y=byYear.values, name=\"Total wikis\")\ntraceActive = go.Bar(x=activeByYear.index.year, y=activeByYear.values, name=\"Active wikis\")\nlayout = go.Layout(\n    legend=dict(x=0.1, y=0.85),\n    xaxis=dict(\n        tickangle=30\n    )\n)\niplot(go.Figure(data=[traceTotal, traceActive], layout=layout), filename='byYear')","a6493eae":"def computeAge(birthDate):\n    timeSinceBirth = pd.Timestamp(2018, 2, 20)-birthDate\n    return int(timeSinceBirth.days\/365)\ndfClean['age'] = dfClean['datetime.birthDate'].apply(computeAge)","950cab4d":"activeWikis = dfClean[(dfClean['stats.activeUsers']>=1)&(dfClean['users_1']>0)]\ninactiveWikis = dfClean[(dfClean['stats.activeUsers']<1)|(dfClean['users_1']==0)]","e55804ac":"activeByAge = activeWikis.groupby(by=['age']).url.count()\ninactiveByAge = inactiveWikis.groupby(by=['age']).url.count()","dec55f84":"trace0 = go.Scatter(\n    x=activeByAge.index.values,\n    y=activeByAge.values,\n    mode='lines',\n    name=\"Active wikis\",\n    line=dict(width=0.5),\n    fill='tonexty'\n)\n\ntrace1 = go.Scatter(\n    x=inactiveByAge.index.values,\n    y=inactiveByAge.values,\n    mode='lines',\n    name=\"Inactive wikis\",\n    line=dict(width=0.5),\n    fill='tonexty'\n)\n\nlayout = go.Layout(\n    yaxis=dict(title='Number of active wikis'),\n    xaxis=dict(\n        domain=[0,0.5],\n        tickmode='array',\n        tickvals=list(range(0,20)),\n        title=\"Age (in years)\"\n    ),\n    legend=dict(\n        x=0.4\n    )\n);\n\nfig = go.Figure(data=[trace0], layout=layout)\niplot(fig, filename='stacked-area-plot')","9af6f9b5":"# Load data","a36a5982":"Data shows an anomaly because Wikia was created in 2004. A deepen analysis of some of the anomaly wikis shows that some fake birthdates were included by a maintenance script (see [the earliest edit of this wiki, as an example](http:\/\/blasterman.wikia.com\/wiki\/Blasterman_Wiki?dir=prev&action=history)).\n\nAdditionally, 2018 wikis are very young (no more than two months) so they will be also removed.\n","de644ab3":"## Wiki age\n\nInstead of showing the number of wikis over the years, we will focus on the age of the active wikis in order to visualize the population pyramid.","a1d39f7b":"# Number of wikis over the years"}}