{"cell_type":{"76fe5934":"code","445e860d":"code","fe0468d5":"code","07cf5d2d":"code","f4de3802":"code","b9fab9af":"code","f9e3b90d":"code","407fca79":"code","92fa7266":"code","c6aa02b9":"code","17446b33":"code","d97bbc30":"code","70b2c968":"code","186bdb18":"code","d246e1ea":"code","8429a089":"code","a2856524":"code","4e40b312":"code","0a451259":"code","6e5e178a":"markdown","6427286b":"markdown"},"source":{"76fe5934":"path = \"..\/input\/chest_xray\/chest_xray\/\"\nprint(path)","445e860d":"from fastai import *\nfrom fastai.vision import *","fe0468d5":"# set the batch size i.e. the number of images to train at a time\n# reduce this number if you get an out of memory error \nbs = 64","07cf5d2d":"# create a data bunch\nnp.random.seed(42)\ndata = ImageDataBunch.from_folder(path, ds_tfms=get_transforms(do_flip=False), \n                                  size=224, num_workers=0, \n                                  bs=bs, valid_pct=0.2).normalize(imagenet_stats)","f4de3802":"# display 3 rows of data\ndata.show_batch(rows=3, figsize=(7,6))","b9fab9af":"# verify the classes\nprint(data.classes)\nlen(data.classes),data.c","f9e3b90d":"# create a neural network\nlearn = create_cnn(data, models.resnet34, metrics=error_rate, model_dir=\"\/tmp\/model\/\")","407fca79":"# fit 4 layers\nlearn.fit_one_cycle(4)","92fa7266":"# interpret the results\ninterp = ClassificationInterpretation.from_learner(learn)\n\nlosses,idxs = interp.top_losses()\n\nlen(data.valid_ds)==len(losses)==len(idxs)","c6aa02b9":"# plot the top losses\ninterp.plot_top_losses(9, figsize=(15,11))","17446b33":"# plot the confusion matrix\ninterp.plot_confusion_matrix(figsize=(5,5), dpi=60)","d97bbc30":"learn.save('stage-1')","70b2c968":"learn.unfreeze()","186bdb18":"learn.fit_one_cycle(1)","d246e1ea":"learn.lr_find()","8429a089":"learn.recorder.plot()","a2856524":"# we select the slice with the steepest slope\nlearn.unfreeze()\nlearn.fit_one_cycle(1, max_lr=slice(1e-3,1e-2))","4e40b312":"# interpret the results\ninterp = ClassificationInterpretation.from_learner(learn)\n\nlosses,idxs = interp.top_losses()","0a451259":"interp.plot_confusion_matrix(figsize=(5,5), dpi=60)","6e5e178a":"We have managed to significantly reduce the error rate and predict the Pneumonia cases correctly which is the class we care about!","6427286b":"The number of samples that were pneumonia but predicted as normal is a lot (55) and hence we will train the model more!"}}