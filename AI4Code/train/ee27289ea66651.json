{"cell_type":{"c886b8ab":"code","3e8690a6":"code","306c889c":"code","8f316006":"code","5cff3ce2":"code","eb382b2c":"code","24e5e6e9":"code","a6808062":"code","89ba40f0":"code","14c8d8ca":"code","2ec64270":"code","25054218":"code","95badd27":"code","f0166afe":"code","d2443f36":"code","9e250ccf":"code","bae2b015":"code","ca961e5e":"code","dbe23009":"code","b06937d2":"code","527f5b9c":"code","33c899c2":"code","7dd0baf7":"code","e5c91671":"code","07691ae5":"markdown","f7ca6f2d":"markdown","9e2172fa":"markdown","91a86463":"markdown","702819e0":"markdown","0000fc39":"markdown","e959c39c":"markdown","38410fc5":"markdown","0e0d23a4":"markdown","152fa489":"markdown","184d7be2":"markdown"},"source":{"c886b8ab":"%matplotlib inline\nimport matplotlib.pyplot as plt\nimport random as rnd\nimport pandas as pd\nimport numpy as np\nimport time\nimport datetime\nimport calendar\nimport json\nimport matplotlib.dates as mdates\n\n# fix what is missing with the datetime\/time\/calendar package\ndef add_months(sourcedate,months):\n    month = sourcedate.month - 1 + months\n    year = int(sourcedate.year + month \/ 12 )\n    month = month % 12 + 1\n    day = min(sourcedate.day,calendar.monthrange(year, month)[1])\n    return datetime.date(year,month,day)\n\n#saving plots\nsave_figures=False","3e8690a6":"!pip install openpyxl","306c889c":"# make initialization dictionary\n# reading excel data (back)\ninput_file = '..\/input\/matching-market-dataset\/init_buyers_sellers_LNG.xlsx'\ndf_buyer = pd.read_excel(input_file,sheet_name='buyers')\ndf_seller = pd.read_excel(input_file,sheet_name='sellers')\ndf_buyer['market'] = [eval(i) for i in df_buyer['market'].values]\ndf_seller['market'] = [eval(i) for i in df_seller['market'].values]\ninit_buyer = df_buyer.to_dict('index')\ninit_seller = df_seller.to_dict('index')","8f316006":"# getting all unique markets\nmarket = []\nfor i in init_seller:\n    for x in init_seller[i]['market']: market.append(x)\nfor i in init_buyer:\n    for x in init_buyer[i]['market']: market.append(x)\nmarket = list(set(market))\ninit_market = market","5cff3ce2":"# Reading data back\nwith open('..\/input\/circle-data\/marketdata.json', 'r') as f:\n     run_market = json.load(f)\n        ","eb382b2c":"# Reading data back\nwith open('..\/input\/circle-data\/sellerdata.json', 'r') as f:\n     run_seller = json.load(f)# Show some real consumption data, for more data see folder data analytics","24e5e6e9":"# Reading data back\nwith open('..\/input\/circle-data\/buyerdata.json', 'r') as f:\n     run_buyer = json.load(f)","a6808062":"# Show some real consumption data, for more data see folder data analytics\n#read montly consumption data of 2010 into a dataframe\ndf = pd.read_csv('..\/input\/circle-data\/2010cbstestrun.csv', header=0, index_col=0)\ndf = df.transpose()\ndf.head()","89ba40f0":"#plot the 2010 monthly consumption data\nax=df.plot(kind='bar',figsize=(20,5))\nfor p in ax.patches:\n    ax.annotate(str(p.get_height()), (p.get_x() * 1.01 , p.get_height() * 1.01))\nplt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\nplt.ylabel('MWh')\nplt.xlabel('Month')\nif save_figures:\n    filepath = '.\/cbs_data.png'\n    plt.savefig(filepath, bbox_inches='tight')\nplt.grid()","14c8d8ca":"df = pd.read_excel('..\/input\/circle-data\/US_monthly_inputdata.xlsx', header=[0,1], index_col=0)\ndf.index = pd.to_datetime(df.index)\nheader_list = list(df['TWh'].columns.values)\ndf['TWh'][header_list[-4:]].plot(figsize=(20,5))\nplt.legend(loc='upper center', bbox_to_anchor=(.5, -0.25), ncol=1)\nplt.ylabel('TWh')\nplt.xlabel('Month')\nif save_figures:\n    filepath = '.\/us_data.png'\n    plt.savefig(filepath, bbox_inches='tight')\nplt.grid()","2ec64270":"# import scenarios\ninputfile = '..\/input\/circle-data\/economic growth scenarios (2).xlsx'\neconomic_growth = pd.read_excel(inputfile, sheet_name='ec_growth', skiprows=0, index_col=0, header=[0,1])\neconomic_growth = economic_growth['ECONOMIC GROWTH'][['CIRCLES','TIDES','PACES']]\neconomic_growth.head() ","25054218":"# demand for electricity import scenarios spaced by excel\nelec_space = pd.read_excel(inputfile, sheet_name='elec_space', index_col=0, header=[0,1])\nelec_space = elec_space['RELATIVE']\nelec_space.head()","95badd27":"# gasdemand home (percentage increases)\nhome_savings = {'PACES': 1.01, 'TIDES': .99, 'CIRCLES': .97}\n\nax = economic_growth.plot(title= 'economic growth',figsize=(20,5))\nvals = ax.get_yticks()\nax.set_yticklabels(['{:3.1f}%'.format(x*100) for x in vals])\nplt.ylabel('Growth')\nplt.xlabel('Time')\nplt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\nif save_figures:\n    filepath = '.\/EconGrowthScen.png'\n    plt.savefig(filepath, bbox_inches='tight')\nplt.grid()","f0166afe":"ax = elec_space.plot(title='natural gas demand growth for EU elec',figsize=(20,5))\nvals = ax.get_yticks()\nax.set_yticklabels(['{:3.1f}%'.format((x-1)*100) for x in vals])\nplt.ylabel('Growth')\nplt.xlabel('Time')\nplt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\nif save_figures:\n    filepath = '.\/ElecDemGrowthScen.png'\n    plt.savefig(filepath, bbox_inches='tight')\nplt.grid()","d2443f36":"# Reserves\nfor reserve in init_seller:\n    for scen in run_seller:\n        df_res = pd.DataFrame(run_seller[scen])\n        df_res = df_res[df_res[3]==reserve]\n        df_res = df_res.set_index(0)\n        df_res.index = pd.to_datetime(df_res.index)\n        df_res[1].plot(label=\"%s\" % (scen),rot=45,title=init_seller[reserve][\"Unnamed: 0\"],figsize=(20,5))\n        plt.grid()\n        \n    plt.legend()\n    plt.ylabel('TWh')\n    plt.xlabel('Time')\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    if save_figures:\n        filepath = '.\/reserve_%s.png' %(reserve)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()","9e250ccf":"plt.subplots()\nfor market in init_market:\n    for i in run_market:\n        run_df = pd.DataFrame(run_market[i])\n        run_df = run_df[run_df[3]==market]\n        run_df.set_index(0, inplace=True)\n        run_df.index = pd.to_datetime(run_df.index)\n        run_df[1].plot(label=i, rot=45, title=market,figsize=(20,5))\n        plt.grid()\n    plt.ylabel('Euro\/MWh')\n    plt.xlabel('Time')\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    if save_figures:\n        filepath = '.\/market_price_Monthly_%s.png' %(market)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()","bae2b015":"plt.subplots()\nfor market in init_market:\n    for i in run_market:\n        run_df = pd.DataFrame(run_market[i])\n        run_df = run_df[run_df[3]==market]\n        run_df.set_index(0, inplace=True)\n        run_df.index = pd.to_datetime(run_df.index)\n        run_df.index.name = 'month'\n        run_df.rename(columns={1: 'price', 2: 'quantity'}, inplace=True)\n        run_df = run_df['price'].resample('A').mean().plot(label=i, title=market,figsize=(20,5))\n        plt.grid()\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    plt.ylabel('\u20ac\/MWh')\n    plt.xlabel('Time')\n    if save_figures:\n        filepath = '.\/market_price_Yearly_%s.png' %(market)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show();","ca961e5e":"plt.subplots()\nfor market in init_market:\n    for i in run_market:\n        run_df = pd.DataFrame(run_market[i])\n        run_df = run_df[run_df[3]==market]\n        run_df.set_index(0, inplace=True)\n        run_df.index = pd.to_datetime(run_df.index)\n        run_df[2].plot(label=i, title=market,figsize=(20,5))\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    plt.grid()\n    plt.ylabel('TWh')\n    plt.xlabel('Time')\n    if save_figures:\n        filepath = '.\/market_quantity_Monthly_%s.png' %(market)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()","dbe23009":"plt.subplots()\nfor market in init_market:\n    for i in run_market:\n        run_df = pd.DataFrame(run_market[i])\n        run_df = run_df[run_df[3]==market]\n        run_df.set_index(0, inplace=True)\n        run_df.index = pd.to_datetime(run_df.index)\n        run_df.index.name = 'month'\n        run_df.rename(columns={1: 'price', 2: 'quantity'}, inplace=True)\n        run_df = run_df['quantity'].resample('A').sum().plot(label='%s'%(i),rot=45, title=market,figsize=(20,5))\n        plt.grid()\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    plt.ylabel('TWh')\n    plt.xlabel('Time')\n    if save_figures:\n        filepath = '.\/market_quantity_Yearly_%s.png' %(market)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()\n","b06937d2":"# What did buyers consume?\nfor buyer in init_buyer:\n    for scen in run_buyer:\n        df_buy = pd.DataFrame(run_buyer[scen])\n        df_buy = df_buy[df_buy[3]==buyer]\n        df_buy = df_buy.set_index(0)\n        df_buy.index = pd.to_datetime(df_buy.index)\n        df_buy[2].plot(label=\"%s\" % (scen),rot=45, title=init_buyer[buyer][\"Unnamed: 0\"],figsize=(20,5))\n        plt.grid()\n    plt.legend()\n    plt.ylabel('TWh')\n    plt.xlabel('Time')\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    if save_figures:\n        filepath = '.\/buyer_quantity_Monthly_%s.png' %(buyer)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()","527f5b9c":"# What did buyers consume?\nfor buyer in init_buyer:\n    for scen in run_buyer:\n        df_buy = pd.DataFrame(run_buyer[scen])\n        df_buy = df_buy[df_buy[3]==buyer]\n        df_buy = df_buy.set_index(0)\n        df_buy.index = pd.to_datetime(df_buy.index)\n        df_buy[2].resample('A').sum().plot(label=\"%s\" % (scen),rot=45, title=init_buyer[buyer][\"Unnamed: 0\"],figsize=(20,5))\n        plt.grid()\n    plt.legend()\n    plt.ylabel('TWh')\n    plt.xlabel('Time')\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    if save_figures:\n        filepath = '.\/buyer_quantity_Yearly_%s.png' %(buyer)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()","33c899c2":"# What did sellers sell?\nfor seller in init_seller:\n    for scen in run_seller:\n        df_seller = pd.DataFrame(run_seller[scen])\n        df_seller = df_seller[df_seller[3]==seller]\n        df_seller = df_seller.set_index(0)\n        df_seller.index = pd.to_datetime(df_seller.index)\n        df_seller[2].plot(label=\"%s\" % (scen),rot=45, title=init_seller[seller][\"Unnamed: 0\"],figsize=(20,5))\n        plt.grid()\n    plt.legend()\n    plt.ylabel('TWh')\n    plt.xlabel('Year')\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    if save_figures:\n        filepath = '.\/seller_quantity_Monthly_%s.png' %(seller)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()","7dd0baf7":"# What did sellers sell?\nfor seller in init_seller:\n    for scen in run_seller:\n        df_seller = pd.DataFrame(run_seller[scen])\n        df_seller = df_seller[df_seller[3]==seller]\n        df_seller = df_seller.set_index(0)\n        df_seller.index = pd.to_datetime(df_seller.index)\n        df_seller[2].resample('A').sum().plot(label=\"%s\" % (scen),rot=45, title=init_seller[seller][\"Unnamed: 0\"],figsize=(20,5))\n        plt.grid()\n    plt.legend()\n    plt.ylabel('TWh')\n    plt.xlabel('Year')\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    if save_figures:\n        filepath = '.\/seller_quantity_Yearly_%s.png' %(seller)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()","e5c91671":"# What did buyers do with their storage space?\nfor buyer in init_buyer:\n    for scen in run_buyer:\n        df_buy = pd.DataFrame(run_buyer[scen])\n        df_buy = df_buy[df_buy[3]==buyer]\n        df_buy = df_buy.set_index(0)\n        df_buy.index = pd.to_datetime(df_buy.index)\n        df_buy[1].plot(label=\"%s\" % (scen),rot=45, title=init_buyer[buyer][\"Unnamed: 0\"],figsize=(20,5))\n        plt.grid()\n    plt.legend()\n    plt.ylabel('TWh')\n    plt.xlabel('Time')\n    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)\n    if save_figures:\n        filepath = '.\/buyer_quantity_Storage_%s.png' %(buyer)\n        plt.savefig(filepath, bbox_inches='tight')\n    plt.show()","07691ae5":"This file is made for visualizing the results. It uses Json objects to communicate with other notebooks.","f7ca6f2d":"What did they sell?","9e2172fa":"# Prices","91a86463":"In 'reserves' we examine the","702819e0":"What did they buy?","0000fc39":"# Quantity","e959c39c":"# Let us focus on some agents","38410fc5":"## Buyers","0e0d23a4":"# Scenarios & CBS data","152fa489":"# Sellers","184d7be2":"# Reserves"}}