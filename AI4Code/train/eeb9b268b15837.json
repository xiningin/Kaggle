{"cell_type":{"64325fa4":"code","f1b5bf15":"code","272e04c3":"code","d71fa295":"code","26b71e60":"code","8322a252":"code","b6756316":"code","2a5b1b65":"code","0ca48de5":"code","b309f24f":"code","bd5202bd":"code","2f7d8b55":"code","fdb2ab8a":"markdown","5c088582":"markdown","604c72e9":"markdown","c8c58fb1":"markdown","a7bc9a0e":"markdown","740574a3":"markdown"},"source":{"64325fa4":"import pandas as pd\nimport numpy as np\nfrom pathlib import Path\nfrom tqdm import tqdm\nimport os\nfrom glob import glob\n\nimport matplotlib.pyplot as plt\nplt.style.use('seaborn')\n\nimport folium\nimport branca","f1b5bf15":"trainfile = pd.read_csv(\"..\/input\/google-smartphone-decimeter-challenge\/baseline_locations_train.csv\")\ntestfile = pd.read_csv(\"..\/input\/google-smartphone-decimeter-challenge\/baseline_locations_test.csv\")\nsubmission = pd.read_csv(\"..\/input\/google-smartphone-decimeter-challenge\/sample_submission.csv\")","272e04c3":"datapath = Path(\"..\/input\/google-smartphone-decimeter-challenge\")\ntruths = (datapath \/ 'train').rglob('ground_truth.csv')\n\ncols = ['collectionName', 'phoneName', 'millisSinceGpsEpoch', 'latDeg', 'lngDeg']\ntruth_arr =[]\nfor filepath in tqdm(truths, total=73):\n    df_buf = pd.read_csv(filepath, usecols=cols)\n    truth_arr.append(df_buf)\n    \ndf_truth = pd.concat(truth_arr, ignore_index=True)\ndf_train = pd.merge(trainfile, df_truth, on=['collectionName', 'phoneName', 'millisSinceGpsEpoch'], suffixes=(\"_current\", \"_truth\"))","d71fa295":"df_train.sample(3)","26b71e60":"df_train['lat_dif'] = df_train['latDeg_truth'] - df_train['latDeg_current']\ndf_train['lng_dif'] = df_train['lngDeg_truth'] - df_train['lngDeg_current']\ndf_train['dummy_dist'] = df_train['lat_dif']**2 + df_train['lng_dif']**2","8322a252":"pnames = df_train['phoneName'].unique()\npnames","b6756316":"df_train.groupby('phoneName').std()[['lat_dif','lng_dif']]","2a5b1b65":"fig, axes = plt.subplots(nrows=3, ncols=3, figsize=(15, 15))\nax = axes.flatten()\nfor i, pn in enumerate(pnames):\n    df_g = df_train[df_train['phoneName']==pn]\n    ax[i].scatter(df_g['lng_dif'], df_g['lat_dif'], s=20, c='blue', alpha=0.5)\n    ax[i].spines['left'].set(position=('data', 0.0))\n    ax[i].spines['bottom'].set(position=('data', 0.0))\n    ax[i].set_title(pn)\n    if pn == 'Mi8': continue\n    if pn == 'Pixel4':\n        ax[i].set_xlim((-0.015, 0.015))\n        ax[i].set_ylim((-0.015, 0.015))\n    else:\n        ax[i].set_xlim((-0.006, 0.003))\n        ax[i].set_ylim((-0.006, 0.003))\n        \nplt.show()","0ca48de5":"fig, axes = plt.subplots(nrows=3, ncols=3, figsize=(15, 15))\nax = axes.flatten()\nfor i, pn in enumerate(pnames):\n    df_g = df_train[df_train['phoneName']==pn]\n    ax[i].hist(df_g['dummy_dist'], bins=20)\n    ax[i].set_yscale('log')\n    ax[i].set_title(pn)\n    \nplt.show()","b309f24f":"cname = df_train['collectionName'].unique()[4]\ndf_cn = df_train[df_train['collectionName']==cname][['phoneName','latDeg_current','lngDeg_current','latDeg_truth','lngDeg_truth','dummy_dist']]\nprint('ex.', cname)","bd5202bd":"cm = branca.colormap.LinearColormap(['blue','lime','red'], vmin=0, vmax=np.quantile(df_cn['dummy_dist'], 0.95))\ncm","2f7d8b55":"center = df_cn[['latDeg_current','lngDeg_current']].mean().tolist()\nm = folium.Map(location=center, zoom_start=10)\nfor pn, df_pn in df_cn.groupby('phoneName'):\n    fg = folium.FeatureGroup(name=pn)\n    cm = branca.colormap.LinearColormap(['blue','lime','red'], vmin=0, vmax=np.quantile(df_pn['dummy_dist'], 0.95))\n    for pn, latc, lonc, latt, lont, dist in df_pn.values:\n#         folium.Circle(location=[latc,lonc], radius=2, color='tomato').add_to(fg)\n#         folium.Circle(location=[latt,lont], radius=2, color='blue').add_to(fg)\n        folium.Circle(location=[latt,lont], radius=8, color=cm(dist), fill=True).add_to(fg)\n    folium.Marker(location=df_pn[['latDeg_current','lngDeg_current']].values[0].tolist(), popup=pn).add_to(fg)\n    fg.add_to(m)\n\nfolium.LayerControl(collapsed=False).add_to(m)\nm","fdb2ab8a":"### Verification phoneName difference","5c088582":"### Check sample collectionName.","604c72e9":"Data read","c8c58fb1":"Latitude \/ longitude difference and simple distance","a7bc9a0e":"Although there are differences in variation, the points that do not deviate are similar. ","740574a3":"The variation of Mi8 is remarkable."}}