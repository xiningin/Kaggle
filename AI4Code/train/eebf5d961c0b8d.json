{"cell_type":{"f16b0d06":"code","bcf50df6":"code","e16e0e2e":"code","a8082fc5":"code","258d52a3":"code","96e86a7a":"code","1674d918":"code","385300e7":"code","f3dc8608":"code","4ea38d21":"code","545f6f5c":"code","c9e97227":"code","9d98c7a5":"code","e1427db2":"code","ff88d7bd":"code","d363d798":"code","b37656f8":"code","191f6ec9":"code","8cddfcbf":"code","bc3e428f":"code","4fd5eb6f":"code","73df32b8":"code","2b3ac260":"code","0e8e6f22":"code","0826e54b":"code","64d5b9a2":"code","46d5de5b":"code","a9960345":"code","c4777c85":"markdown","1df1861b":"markdown","6779af67":"markdown","2105445e":"markdown","9ece740b":"markdown","0525589d":"markdown","5ef5c3ae":"markdown"},"source":{"f16b0d06":"# Importing Libraries\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport sqlite3\nimport matplotlib.pyplot as plt","bcf50df6":"pd.options.display.max_rows = 20 # maximum number of rows to display","e16e0e2e":"# connecting to the salika database\ndatabase_path = \"..\/input\/sqlite-sakila-sample-database\/sqlite-sakila.db\"\nconnection = sqlite3.connect(database_path)","a8082fc5":"# Displaying all the tables in the Sakila Database\ntables = pd.read_sql(\"\"\"\n\nSELECT *\nFROM sqlite_master\nWHERE type = 'table';\n\n\"\"\", connection)\n\ntables","258d52a3":"# The film table is a list of all films potentially in stock in the stores. The actual in-stock copies \n# of each film are represented in the inventory table.\n\n# Q. How many films of each rating are present in 'film' table?\nfilm_ratings = pd.read_sql(\"\"\"\n\nSELECT \n    rating, COUNT(film_id) AS film_count\n    FROM film\n    GROUP BY rating\n    ORDER BY COUNT(film_id) DESC\n\n\"\"\", connection)\n\nfilm_ratings ","96e86a7a":"#pie chart for film_ratings \n\nfig, ax = plt.subplots(figsize = (8,8))\n\ndef func(pct, allvals):\n    absolute = int(pct\/100.*np.sum(allvals))\n    return \"{:,.0f}\\n({:.0f}%)\".format(absolute, pct)\n\n\nwedges, texts, autotexts = ax.pie(film_ratings[\"film_count\"],\n       labels = film_ratings[\"rating\"],\n       autopct=lambda pct: func(pct, film_ratings[\"film_count\"]),\n       textprops=dict(color=\"w\", fontsize = 13, fontweight = \"bold\"))\nax.legend(wedges, film_ratings[\"rating\"],\n          title=\"Ratings\",\n          fontsize = 10,\n          loc=\"center left\",\n          bbox_to_anchor=(1, 0.2, 0.5, 1))\nax.set_title(\"Film Ratings\", fontsize = 15, color='#ffffff')\nplt.rcParams['legend.title_fontsize'] = 12\n\nplt.show()","1674d918":"# The inventory table contains one row for each copy of a given film in a given store.\n\n# Q. How many films(DISTINCT) of each rating are in stock?\n\nfilm_rating_inventory = pd.read_sql(\"\"\"\n\nSELECT \n    film.rating, COUNT(DISTINCT inventory.film_id) AS film_count\n    FROM film JOIN inventory\n    ON film.film_id = inventory.film_id\n    GROUP BY film.rating\n    ORDER BY COUNT(inventory.film_id) DESC\n\n\"\"\", connection)\n\nfilm_rating_inventory","385300e7":"# Donut graph for film rating count of films in inventory.\n\nfig, ax = plt.subplots(figsize = (5,5))\n\ndef func(pct, allvals):\n    absolute = int(pct\/100.*np.sum(allvals))\n    return \"{:,.0f} films\".format(absolute, pct)\n\n \nwedges, texts, autotexts = ax.pie(film_rating_inventory[\"film_count\"],\n       labels = film_ratings[\"rating\"],\n       autopct=lambda pct: func(pct, film_rating_inventory[\"film_count\"]),\n       explode = (0.05, 0.05, 0.05, 0.05, 0.05),\n       textprops=dict(color=\"#00fff6\", fontsize = 13, fontweight = \"bold\"))\nax.legend(wedges, film_rating_inventory[\"rating\"],\n          title=\"Ratings\",\n          fontsize = 10,\n          loc=\"center left\",\n          bbox_to_anchor=(1, 0.2, 0.5, 1))\nax.set_title(\"Film Ratings\", fontsize = 10, color='#ffffff')\nplt.rcParams['legend.title_fontsize'] = 10\n\n# Adding Circle in Pie chart\ncentre_circle = plt.Circle((0, 0), 0.70, fc='#ffffff')\nfig = plt.gcf()\nfig.gca().add_artist(centre_circle)\n\nplt.show()","f3dc8608":"# Q. How many films are unvailable at the stores?\n# A. Total 42 films in 'film' table are not in 'inventory' table.\n\npd.read_sql(\"\"\"\n\nSELECT\n\tCOUNT(film_id) AS films_unavailable\n\tFROM film \n\tWHERE film_id NOT IN (SELECT\n\t\t\t\t\t\t\tfilm_id \n\t\t\t\t\t\t\tFROM inventory)\t\n\n\"\"\", connection)","4ea38d21":"# Q. In which cities are the stores located?\n# A. There are only 2 stores one in Lethbridge and one in Woodridge.\n\npd.read_sql(\"\"\"\n\nSELECT\n\tcity.city,  COUNT(store.store_id) AS number_of_stores\n\tFROM store JOIN address JOIN city\n\tON store.address_id = address.address_id\n\tAND address.city_id = city.city_id\n\tGROUP BY address.city_id\n\n\"\"\", connection)","545f6f5c":"# Q. What is the average rental duration of films of each category?\n# A. The average rental duration for every catergory is approx 5 days.\n\navg_rental_duration_category = pd.read_sql(\"\"\"\n\t\nSELECT \n\tcategory.category_id,category.name AS category_name, AVG(film.rental_duration) AS avg_rental_duration\n\tFROM film JOIN film_category JOIN category\n\tON film.film_id = film_category.film_id \n\tAND film_category.category_id = category.category_id\n\tGROUP BY category.category_id\n\tORDER BY category_name\n    \n\"\"\", connection)\n\navg_rental_duration_category","c9e97227":"# bar chart of avg_rental_duration_category\n\nfig, ax = plt.subplots(figsize = (16,4))\n\nypos = np.arange(len(avg_rental_duration_category[\"avg_rental_duration\"]))\nbars = ax.bar(ypos, avg_rental_duration_category[\"avg_rental_duration\"], width = 0.50)\nax.set_xticks(ypos)\nax.set_xticklabels(avg_rental_duration_category[\"category_name\"])\nax.set_ylim(ymax = 6)\nax.set_title(\"Average rental duration of films in different categories\", fontsize = 14)\nax.set_ylabel(\"Number of days\", fontsize = 12)\n\n\nplt.show()","9d98c7a5":"# Q. Which 3 category films are most common?\n# A. Sports, Foreign and Family categories have most number of films.\n\npd.read_sql(\"\"\"\n\t\nSELECT \n\tcategory.name, COUNT(film_category.film_id) AS film_cnt\n\tFROM film_category JOIN category\n\tON film_category.category_id = category.category_id\n\tGROUP BY category.name\n\tORDER BY COUNT(film_category.film_id) DESC\n\tLIMIT 3\n    \n\"\"\", connection)","e1427db2":"# Q. How many films of different languages?\n# A. there are total 1000 films, all in english language.\n\npd.read_sql(\"\"\"\n\t\nSELECT\n\tlanguage.name, COUNT(film.film_id)\n\tFROM film JOIN language\n\tON film.language_id = language.language_id\n    GROUP BY language.name\n\t\n\"\"\", connection)","ff88d7bd":"# Q. Which actors have performed films of all 16 categories?\n# A. total 11 actors have worked in all 16 categories of films.\n\npd.read_sql(\"\"\"\n\t\nSELECT \n\tsub_table.actorid, actor.first_name, actor.last_name, sub_table.categories_cnt\n\tFROM actor JOIN (SELECT \n\t\t\t\t\t\tfilm_actor.actor_id AS actorid, COUNT(DISTINCT film_category.category_id) AS categories_cnt\n\t\t\t\t\t\tFROM film_actor JOIN film JOIN film_category\n\t\t\t\t\t\tON film_actor.film_id = film.film_id\n\t\t\t\t\t\tAND film.film_id = film_category.film_id\n\t\t\t\t\t\tGROUP BY film_actor.actor_id\n\t\t\t\t\t\tHAVING COUNT(DISTINCT film_category.category_id) >= 16) AS sub_table\n\tON actor.actor_id = sub_table.actorid\n\t\n\"\"\", connection)","d363d798":"# Q. Which actor, amongst the actors who have worked in all 16 film categories, has performed in most numer of films?\n# A. GINA DEGENERES has performed in most number of films amongst the actors who have performed in all categories.\n\npd.read_sql(\"\"\"\n\t\nSELECT \n\tactor.actor_id, actor.first_name, actor.last_name, COUNT(film_actor.film_id) AS films_count\n\tFROM actor JOIN film_actor\n\tON actor.actor_id = film_actor.actor_id\n\tWHERE actor.actor_id IN (SELECT \n\t\t\t\t\t\tfilm_actor.actor_id\n\t\t\t\t\t\tFROM film_actor JOIN film JOIN film_category\n\t\t\t\t\t\tON film_actor.film_id = film.film_id\n\t\t\t\t\t\tAND film.film_id = film_category.film_id\n\t\t\t\t\t\tGROUP BY film_actor.actor_id\n\t\t\t\t\t\tHAVING COUNT(DISTINCT film_category.category_id) >= 16)\n\tGROUP BY actor.actor_id\n    ORDER BY COUNT(film_actor.film_id) DESC\n    LIMIT 1\n\t\n\"\"\", connection)","b37656f8":"# What were the total sales per month?\n\ntotal_m_sale = pd.read_sql(\"\"\"\n\t\nSELECT  \n    strftime('%Y-%m', payment_date) AS Date,\n    ROUND(SUM(amount), 0) AS Sales\n    FROM payment\n    GROUP BY Date\n    ORDER BY Date ASC\n\t\n\"\"\", connection)\n\ntotal_m_sale","191f6ec9":"# line graph for total sales per month (EXCLUDING FEB-2006 SALES)\n\nsales_per_month = total_m_sale.iloc[0:4].set_index(\"Date\") # Excluding the 2006-02 sales\n\nfig, ax = plt.subplots(figsize = (10,5))\nax.plot(sales_per_month,\"g*-\")\nax.set_ylim(ymin = 0, ymax = 30000)\nax.set_ylabel(\"Sales\")\nax.set_xlabel(\"Date\")\n\nfor date, sales in sales_per_month[\"Sales\"].items():\n    ax.annotate(str(\"${:,.0f}\".format(sales)),\n                xy=(date, sales))\n\nplt.show()","8cddfcbf":"# Q. Make line graphs to compare monthly sales of each store.\n# A. Since we now know that there is discontuinity of sales data from 2005-08 to 2006-02, we will exclude 2006-02 sales \n#    in the SQL query itself.\n\nsale_per_store = pd.read_sql(\"\"\"\n\t\nSELECT \n\tc.store_id AS store, strftime('%Y-%m', sub_table.payment_date) AS Date, ROUND(SUM(sub_table.amount),0) AS sales\n\tFROM customer c JOIN (SELECT   \n\t\t\t\t\t\t\tcustomer_id,\n\t\t\t\t\t\t\tpayment_date,\n\t\t\t\t\t\t\tamount\n\t\t\t\t\t\t\tFROM payment\n\t\t\t\t\t\t\t) AS sub_table\n\tON c.customer_id = sub_table.customer_id\n    WHERE Date < '2006-01'\n\tGROUP BY c.store_id, Date\n\tORDER BY c.store_id, Date\n\t\n\"\"\", connection)\n\nsale_per_store\n# We will make line chart for the following table.","bc3e428f":"plt.subplots(figsize=(8, 8))\nsns.lineplot(data=sale_per_store, x=\"Date\", y=\"sales\", hue=\"store\", palette=\"tab10\", )\nplt.show()","4fd5eb6f":"# We see that sales of store 1 were consistently higher than sales of store 2.","73df32b8":"# Q. Make pivot table for monthly sales of the stores.\n\nsales_store = pd.read_sql(\"\"\"\n\nSELECT \n\tstrftime('%Y-%m', sub_table.payment_date) AS Date, \n    c.store_id AS store,\n    sub_table.amount AS sales_data\n\tFROM customer c JOIN (SELECT  \n\t\t\t\t\t\t\tcustomer_id,\n\t\t\t\t\t\t\tpayment_date,\n\t\t\t\t\t\t\tamount\n\t\t\t\t\t\t\tFROM payment\n\t\t\t\t\t\t\t) AS sub_table\n\tON c.customer_id = sub_table.customer_id\n\t\n\"\"\", connection)\n","2b3ac260":"pivottable = pd.pivot_table(sales_store, index=sales_store['Date'], columns=sales_store['store'], aggfunc=np.sum)\npivottable","0e8e6f22":"# Q. What are the 5 'G' rated films that have lowest replacement cost and atmost 3 copies of itself in the inventory?\n\npd.read_sql(\"\"\"\n\nSELECT \n\tDISTINCT f.film_id, f.title, replacement_cost, COUNT(i.film_id) AS copies_in_inv\n\tFROM film f JOIN inventory i\n\tON f.film_id = i.film_id\n    WHERE rating = 'G'\n    GROUP BY f.film_id, f.title\n    HAVING copies_in_inv <= 3\n\tORDER BY replacement_cost\n\tLIMIT 5\n    \n\"\"\", connection)","0826e54b":"# Q. What is the category id of 'Foreign' category?\n# A. 9\npd.read_sql(\"\"\"\n\nSELECT c.name, fc.category_id from film_category fc JOIN category c\non fc.category_id = c.category_id\nwhere c.name = 'Foreign'\nLIMIT 1\n\"\"\", connection)","64d5b9a2":"# Q. Compare the average replacement cost for films that are 'Foreign' category and flims that are not foreign category.\n# A. Films of foreign category have lower mean replacement cost than mean replacement cost of films that are not foreign category.\nreplacement_cost_category = pd.read_sql(\"\"\"\n\nSELECT\n\t'Foriegn', AVG(f.replacement_cost) AS avg_replacement_cost\n\tFROM film f JOIN film_category fc\n\tON f.film_id = fc.film_id\n\tWHERE fc.category_id = 9\nUNION\nSELECT\n\t'Non Foreign',AVG(f.replacement_cost) AS avg_replacement_cost\n\tFROM film f JOIN film_category fc\n\tON f.film_id = fc.film_id\n\tWHERE fc.category_id != 9\n \n\"\"\", connection)\nreplacement_cost_category","46d5de5b":"# Q. Make Boxplot of replacement_cost of films\n\nreplacement_c = pd.read_sql(\"\"\"    \nSELECT \n    replacement_cost\n    FROM film    \n\"\"\", connection)\n\n# making boxplot for replacement_c\nreplacement_c.boxplot(color='g', vert=False, grid=False, figsize=(12,4))","a9960345":"# Q. Make boxplots for replacement cost of films of different ratings\n\nreplacement_c_rating = pd.read_sql(\"\"\"  \nSELECT \n    rating, replacement_cost\n    FROM film    \n\"\"\", connection)\n\n# making boxplot for replacement_c_rating\nreplacement_c_rating[['replacement_cost' , 'rating']].boxplot(by='rating', figsize=(12,6), grid=False)","c4777c85":"***THE END***","1df1861b":"![](http:\/\/https:\/\/www.google.com\/images\/branding\/googlelogo\/1x\/googlelogo_light_color_272x92dp.png)","6779af67":"**About the notebook:**The notebook connects to the SAKILA database and eplores the relation between various attributes of different tables in the database with the help of SQL queries and Data visualization.\n\n* Tools used: SQL, pandas, matplotlib, numpy, seaborn\n* Number of SQL queries: 18\n* Visualizations used: pie chart, donut chart, bar graph, line chart, boxplot.\n* Some of the questions answered:\n                                - Number of films of each rating.\n                                - Total number of unavailable films.\n                                - Total monthly sales.\n                                - Sales of different stores.\n                                - Replacement cost and stock size.\n                                \n                                    ","2105445e":"**!! As there is a gap of 6 months between Aug-2005 and Feb-2006, we will exclude 2006-02 sales month from the line graph !!**","9ece740b":"**About Sakila Database:** The Sakila sample database was initially developed by Mike Hillyer, a former member of the MySQL AB documentation team. It is intended to provide a standard schema that can be used for examples in books, tutorials, articles, samples, and so forth. The Sakila database is a nicely normalised schema modelling a DVD rental store, featuring things like films, actors, film-actor relationships, and a central inventory table that connects films, stores, and rentals.","0525589d":"*Notebook by Vaishnavi Sharma*","5ef5c3ae":"## SAKILA DATABASE: Data Analysis and Visualisation "}}