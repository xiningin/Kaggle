{"cell_type":{"c4393297":"code","bcc6384e":"code","a38be277":"code","b4480f49":"code","259b165b":"code","a6dd5717":"code","25cc7f0b":"code","b3eb86a1":"code","a195c481":"code","209943a4":"code","68c72b87":"code","c1b2f54f":"code","48d2144f":"code","acb39a57":"code","d3d6893d":"code","3acbc688":"code","637c4cee":"code","76862fcc":"code","c343ab35":"code","4243aa2d":"code","34f77c4f":"code","36fbe1c9":"code","3dcf34c4":"code","93625dda":"code","335b87ad":"code","e24e498a":"code","42825bf3":"code","51dbd20b":"code","69ccd391":"code","4bc508a5":"code","d8e41da7":"code","ff686e47":"code","a7f7f2f8":"code","5f2c9eba":"markdown","6fec7cf4":"markdown","dbe3ff85":"markdown"},"source":{"c4393297":"import pandas  as pd \nimport numpy   as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport datetime as dt","bcc6384e":"#Read the data that I uploaded to Kaggle.\ndf_2010_2011 = pd.read_excel(\"\/kaggle\/input\/online_retail_II.xlsx\" ,sheet_name = \"Year 2010-2011\")","a38be277":"df=df_2010_2011.copy()","b4480f49":"df.head()","259b165b":"#Delete NA values on the dataset\ndf.dropna(inplace = True)","a6dd5717":"df.shape","25cc7f0b":"#Find maximum date of Invoices\ndf[\"InvoiceDate\"].max()","b3eb86a1":"# Create a datetime for last day of Invoices  \ntoday_date = dt.datetime(2011,12,9)\ntoday_date","a195c481":"# Analyse Customers what was the last day of their Invoices\ndf.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}).head()","209943a4":"df[\"Customer ID\"]=df[\"Customer ID\"].astype(int)","68c72b87":"df_last_sales_date=(today_date-df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}))","c1b2f54f":"df_last_sales_date.rename(columns = {\"InvoiceDate\" : \"Recency\"}, inplace=True)","48d2144f":"df_recency=df_last_sales_date[\"Recency\"].apply(lambda x : x.days)","acb39a57":"df_recency.head()","d3d6893d":"df_freq=df.groupby([\"Customer ID\",\"Invoice\"]).agg({\"Invoice\":\"count\"})\ndf_freq.head()","3acbc688":"df_freq=df_freq.groupby(\"Customer ID\").agg({\"Invoice\":\"sum\"})","637c4cee":"df_freq.rename(columns = ({\"Invoice\":\"Frequency\"}),inplace =True)\ndf_freq.head()","76862fcc":"df.head()","c343ab35":"df[\"TotalPrice\"] = df[\"Quantity\"]*df[\"Price\"]\ndf","4243aa2d":"df_monetary=df.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"})","34f77c4f":"df_monetary.rename(columns ={\"TotalPrice\":\"Monetary\"},inplace=True)\ndf_monetary.head()","36fbe1c9":"rfm = pd.concat([df_recency, df_freq, df_monetary],  axis=1)","3dcf34c4":"rfm.head()","93625dda":"rfm[\"RecencyScore\"]   = pd.qcut(rfm['Recency'], 5,   labels = [5, 4, 3, 2, 1])\nrfm[\"FrequencyScore\"] = pd.qcut(rfm[\"Frequency\"], 5, labels = [5, 4, 3, 2, 1]) \nrfm[\"MonetaryScore\"] = pd.qcut(rfm['Monetary'], 5, labels = [1, 2, 3, 4, 5])\nrfm.head()","335b87ad":"rfm[\"RFM_SCORE\"]=(rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str) + rfm['MonetaryScore'].astype(str))","e24e498a":"seg_map = {\n    r'[1-2][1-2]': 'Hibernating',\n    r'[1-2][3-4]': 'At Risk',\n    r'[1-2]5': 'Can\\'t Loose',\n    r'3[1-2]': 'About to Sleep',\n    r'33': 'Need Attention',\n    r'[3-4][4-5]': 'Loyal Customers',\n    r'41': 'Promising',\n    r'51': 'New Customers',\n    r'[4-5][2-3]': 'Potential Loyalists',\n    r'5[4-5]': 'Champions'\n}","42825bf3":"rfm['Segment'] = rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str)\nrfm['Segment'] = rfm['Segment'].replace(seg_map, regex=True)\nrfm.head()","51dbd20b":"rfm[[\"Segment\",\"Recency\",\"Frequency\",\"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"count\"])","69ccd391":"rfm[rfm[\"Segment\"] == \"Need Attention\"].head()","4bc508a5":"new_df = pd.DataFrame()\nnew_df[\"NewCustomerID\"] = rfm[rfm[\"Segment\"] == \"New Customers\"].index","d8e41da7":"asleep_df = pd.DataFrame()\nasleep_df[\"AboutoSleepCustomerID\"] = rfm[rfm[\"Segment\"] == \"About to Sleep\"].index","ff686e47":"rfm[rfm[\"Segment\"] == \"About to Sleep\"].head()","a7f7f2f8":"rfm[rfm[\"Segment\"] == \"New Customers\"].head()","5f2c9eba":"# Frequency","6fec7cf4":"# Recency","dbe3ff85":"# Monetary"}}