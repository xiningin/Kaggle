{"cell_type":{"80b61767":"code","0d633e8e":"code","831ff803":"code","76cab362":"code","5169a232":"code","4188dcdc":"code","a74218b8":"code","79db3bfd":"code","18c7b4cf":"code","ca190d39":"code","7a340dd9":"code","0fea61ef":"code","06489ece":"code","e32dbaab":"code","a83204dc":"code","bc21df61":"code","fa88965d":"code","f80ffce1":"code","6b34e4f6":"code","b5b92e6a":"code","f054881e":"code","f9c05f3a":"code","a55dc119":"code","e4b7f1d3":"code","070b361e":"code","fa8e8177":"code","7844c3c8":"code","a7df1b6e":"code","d3eb5ffa":"code","c8e586b5":"code","0a3a46a8":"code","201a70b0":"code","9e13cf5c":"code","fa03323f":"code","4b45d032":"code","a0bb6465":"code","94f4f24a":"code","4a681f77":"code","4a3fdeba":"code","f1f8818e":"code","5b1695f5":"code","3ee2f583":"code","ae5c6295":"code","99dae5ed":"code","b8da4a1d":"code","bd4ab3f2":"code","c1c1299d":"code","b0da4faf":"code","bd04f08a":"code","59c173d6":"code","52df9191":"code","9816bb1f":"code","d7d915db":"code","ee83fb20":"code","2d8f9f83":"code","8ffb7807":"code","9c096f4f":"code","b36d763c":"code","3bbad275":"code","350cc9a7":"code","6f51e6dd":"code","41156432":"code","ff0be03f":"code","a99e5dff":"code","861c56c1":"code","3be690ae":"code","e55e2592":"code","eac6a8ce":"code","c52b05ad":"code","326e9de2":"code","7696dd72":"code","32a96e6f":"code","2cc0cf68":"code","f6e3643f":"code","fe71ca6f":"code","61676986":"code","a5f4ce8b":"code","0f5af173":"code","abcaa7e9":"code","0fce0d84":"code","682b484c":"code","cc348983":"markdown"},"source":{"80b61767":"\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport statsmodels.api as sm\n\nimport numpy as np\nimport pandas as pd\n\nimport os\nimport matplotlib.pyplot as plt\nimport pandas_datareader as web\nimport datetime as dt\n\nimport tensorflow as tf\nfrom sklearn.preprocessing import MinMaxScaler\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense, Dropout, LSTM\nfrom tensorflow.keras.callbacks import ModelCheckpoint, EarlyStopping\n\nimport matplotlib.dates as dates\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots","0d633e8e":"df=pd.read_csv('..\/input\/zoom-stock-price-all-time\/Zoom.csv')\n","831ff803":"df.head()","76cab362":"df.info()","5169a232":"df.index = pd.to_datetime(df[\"Date\"])\ndf.drop('Date', axis=1, inplace=True)\n","4188dcdc":"df.head()","a74218b8":"df.describe()","79db3bfd":"df['Open'].plot(figsize=(12,8))\nplt.ylabel(\"open price\")","18c7b4cf":"df['High'].plot(figsize=(12,8))\nplt.ylabel(\"High price\")","ca190d39":"df['Volume'].plot(figsize=(12,8))\nplt.ylabel(\"Volume price\")","7a340dd9":"df.isnull().sum()","0fea61ef":"df['Total Pos'] = df.sum(axis=1)","06489ece":"df.head()","e32dbaab":"df['Total Pos'].plot(figsize=(10,8))\nplt.title('Total Portfolio Value')","a83204dc":"df.drop('Total Pos',axis=1).plot(kind='line',figsize=(10,8))","bc21df61":"df['Daily Return'] = df['Total Pos'].pct_change(1)","fa88965d":"cum_ret = 100 * (df['Total Pos'][-1]\/df['Total Pos'][0] -1 )\nprint('Our return {} was percent!'.format(cum_ret))","f80ffce1":"df['Daily Return'].mean()","6b34e4f6":"df['Daily Return'].std()","b5b92e6a":"df['Daily Return'].plot(kind='kde')","f054881e":"SR = df['Daily Return'].mean()\/df['Daily Return'].std()","f9c05f3a":"SR","a55dc119":"ASR = (252**0.5)*SR","e4b7f1d3":"ASR","070b361e":"all_plot = df\/df.iloc[0]\nall_plot.plot(figsize=(24,16))","fa8e8177":"df.hist(bins=100,figsize=(12,6));\nplt.tight_layout()","7844c3c8":"df.resample(rule='A').mean()","a7df1b6e":"df.resample(rule='AS').min()","d3eb5ffa":"df.resample(rule='AS').std()","c8e586b5":"df.resample(rule='M').mean().head()","0a3a46a8":"df.resample(rule='MS').max().head()","201a70b0":"title = 'Yearly Mean Closing Price for zoom'\ndf['Close'].resample('A').mean().plot.bar(title=title,figsize=(10,8));","9e13cf5c":"df.resample(rule='M').max().head()","fa03323f":"df['Close'].resample('M').max().plot.bar(figsize=(16,6),color='#1f77b4');","4b45d032":"ax = df['Close'].plot(figsize=(24,6),title=title)\n","a0bb6465":"df['6-month-SMA'] = df['Close'].rolling(window=6).mean()\ndf['12-month-SMA'] = df['Close'].rolling(window=12).mean()\ndf['2-month-SMA'] = df['Close'].rolling(window=2).mean()","94f4f24a":"df.head(10)","4a681f77":"df[[\"Close\",\"6-month-SMA\",\"12-month-SMA\",\"2-month-SMA\"]].plot(figsize=(18,10));","4a3fdeba":"df['EWMA12'] = df['Close'].ewm(span=12,adjust=True).mean()","f1f8818e":"df[['Close','EWMA12']].plot(figsize=(12,6));","5b1695f5":"df[['Close','EWMA12','12-month-SMA']].plot(figsize=(30,15)).autoscale(axis='x',tight=True);","3ee2f583":"from statsmodels.tsa.holtwinters import SimpleExpSmoothing","ae5c6295":"span = 12\nalpha = 2\/(span+1)","99dae5ed":"df['EWMA12'] = df['Close'].ewm(alpha=alpha,adjust=False).mean()\n","b8da4a1d":"model=SimpleExpSmoothing(df[\"Close\"])","bd4ab3f2":"model.fit(smoothing_level=alpha,optimized=False)","c1c1299d":"fitted_model=model.fit(smoothing_level=alpha,optimized=False)","b0da4faf":"fitted_model.fittedvalues","bd04f08a":"fitted_model.fittedvalues.shift(-1)","59c173d6":"df[\"SES12\"]=fitted_model.fittedvalues.shift(-1)","52df9191":"df[['Close',\"SES12\"]].plot(figsize=(30,15)).autoscale(axis='x',tight=True);","9816bb1f":"from statsmodels.tsa.holtwinters import ExponentialSmoothing\n\ndf['DESadd12'] = ExponentialSmoothing(df['Close'], trend='add').fit().fittedvalues.shift(-1)\ndf.head()","d7d915db":"df[['Close',  'SES12', 'DESadd12']].plot(figsize=(24,12))","ee83fb20":"df['DESadd12'].head()\n","2d8f9f83":"df[['Close','EWMA12','DESadd12']].iloc[:12].plot(figsize=(12,6)).autoscale(axis='x',tight=True);","8ffb7807":"df['DESmul12'] = ExponentialSmoothing(df['Close'], trend='mul').fit().fittedvalues.shift(-1)\ndf.head()","9c096f4f":"df[['Close','DESadd12','DESmul12']].iloc[:24].plot(figsize=(12,6)).autoscale(axis='x',tight=True);","b36d763c":"df['TESadd12'] = ExponentialSmoothing(df['Close'],trend='add',seasonal='add',seasonal_periods=12).fit().fittedvalues\ndf.head()","3bbad275":"df['TESmul12'] = ExponentialSmoothing(df['Close'],trend='mul',seasonal='mul',seasonal_periods=12).fit().fittedvalues\ndf.head()","350cc9a7":"df[['Close','TESadd12','TESmul12']].plot(figsize=(12,6)).autoscale(axis='x',tight=True);","6f51e6dd":"df[['Close','TESadd12','TESmul12']].iloc[:24].plot(figsize=(12,6)).autoscale(axis='x',tight=True);","41156432":"df=pd.read_csv('..\/input\/zoom-stock-price-all-time\/Zoom.csv')\n\n","ff0be03f":"df","a99e5dff":"df.head()","861c56c1":"train_df = df.iloc[:500]\ntest_df = df.iloc[500:]","3be690ae":"fig=make_subplots(specs=[[{\"secondary_y\":False}]])\nfig.add_trace(go.Scatter(x=train_df['Date'],y=train_df['Open'],name=\"Zoom Train\"),secondary_y=False,)\nfig.add_trace(go.Scatter(x=test_df['Date'],y=test_df['Open'],name=\"Zoom Test\"),secondary_y=False,)\n\n","e55e2592":"test_df[0:3]\n","eac6a8ce":"from sklearn.preprocessing import MinMaxScaler","c52b05ad":"scaler = MinMaxScaler(feature_range=(0,1))\nscaled_data = scaler.fit_transform(train_df['Open'].values.reshape(-1,1))","326e9de2":"prediction_days = 30\n\nx_train = []\ny_train = []\n\nfor x in range(prediction_days, len(scaled_data)-3):     \n    x_train.append(scaled_data[x-prediction_days:x, 0])\n    y_train.append(scaled_data[x+3, 0])     \n    \nx_train, y_train = np.array(x_train), np.array(y_train)\nx_train = np.reshape(x_train, (x_train.shape[0], x_train.shape[1], 1))","7696dd72":"model = Sequential()    \nmodel.add(LSTM(units = 30, return_sequences = True, input_shape = (x_train.shape[1],1)))\nmodel.add(Dropout(0.2))\nmodel.add(LSTM(units = 30, return_sequences = True))\nmodel.add(Dropout(0.2))\nmodel.add(LSTM(units = 30))\nmodel.add(Dropout(0.2))\nmodel.add(Dense(units=1))\n    \n","32a96e6f":"\nmodel.summary()\nmodel.compile(optimizer='adam', loss='mean_squared_error', metrics = ['accuracy'])  ","2cc0cf68":"callback = tf.keras.callbacks.EarlyStopping(monitor='loss', patience=6)\nhis=model.fit(x_train,y_train,epochs=50,batch_size=32,callbacks=[callback])","f6e3643f":"plt.plot(his.history['loss'])\nplt.plot(his.history['accuracy'])\nplt.title('model loss')\nplt.ylabel('loss')\nplt.xlabel('epoch')\nplt.legend(['loss','accuracy'], loc='upper right')\nplt.show()","fe71ca6f":"actual_prices = test_df['Close'].values\ntotal_dataset = pd.concat((train_df['Close'], test_df['Close']), axis=0)\n\nmodel_inputs = total_dataset[len(total_dataset)-len(test_df)-prediction_days:].values\nmodel_inputs = model_inputs.reshape(-1,1)\nmodel_inputs = scaler.transform(model_inputs)","61676986":"x_test = []\nfor x in range(prediction_days,len(model_inputs)):\n    x_test.append(model_inputs[x-prediction_days:x,0])\n\nx_test = np.array(x_test)\nx_test = np.reshape(x_test,(x_test.shape[0],x_test.shape[1],1))\n\npredicted_prices = model.predict(x_test)\npredicted_prices = scaler.inverse_transform(predicted_prices)","a5f4ce8b":"plt.plot(actual_prices, color='red', label=f\"Actual price\")\nplt.plot(predicted_prices, color= 'blue', label=f\"Predicted 5-days-after price\")\nplt.title(f\"Zoom Stock\")\nplt.xlabel(\"Days in test period\")\nplt.ylabel(f\"Price\")\nplt.legend()\nplt.show()","0f5af173":"test_df['predict']=predicted_prices\ntest_df[[\"Date\",\"Close\",\"predict\"]]","abcaa7e9":"fig=make_subplots(specs=[[{\"secondary_y\":False}]])\nfig.add_trace(go.Scatter(x=train_df['Date'],y=train_df['Close'],name=\"Train Actual\"),secondary_y=False,)\nfig.add_trace(go.Scatter(x=test_df['Date'],y=test_df['Close'],name=\"Test Actual\"),secondary_y=False,)\nfig.add_trace(go.Scatter(x=test_df['Date'],y=test_df['predict'],name=\"Predicted 5-days after price\"),secondary_y=False,)\nfig.update_layout(autosize=False,width=900,height=500,title_text=\"Zoom\")\nfig.update_xaxes(title_text=\"year\")\nfig.update_yaxes(title_text=\"prices\",secondary_y=False)\nfig.show()","0fce0d84":"real_data = [model_inputs[len(model_inputs)+1-prediction_days:len(model_inputs+1),0]]\nreal_data = np.array(real_data)\nreal_data = np.reshape(real_data,(real_data.shape[0],real_data.shape[1],1))\nprint(real_data.shape)","682b484c":"prediction = model.predict(real_data)\nprediction = scaler.inverse_transform(prediction)\nprint(f\"prediction: {prediction[0][0]}\")","cc348983":"# deeplearning**"}}