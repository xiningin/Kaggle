{"cell_type":{"41dddc56":"code","3ebb5c10":"code","d9ce3d3e":"code","f33e503c":"code","8b4bf153":"code","d0036d7b":"code","f48ec18e":"code","989d6b7e":"code","5d71f111":"code","b7cc7498":"code","138251c1":"code","be4dcd90":"code","91062a60":"code","648b6313":"code","7f847d1a":"code","bb9784de":"code","2684bd10":"code","63b76f9a":"code","3acdb899":"code","38bf8f31":"code","568f8edf":"code","331af87b":"code","fb877a9b":"code","5997c805":"code","3569a6e1":"code","2291c369":"code","78ab2e89":"code","0c93bbcc":"code","5fbe3eab":"code","fbe11e2b":"code","523d40f9":"code","ddd991b3":"markdown","cd452385":"markdown","9960794e":"markdown","b8f150a5":"markdown","977c3322":"markdown","009c998c":"markdown","cf069d0b":"markdown","d847d3a2":"markdown","d72ec713":"markdown","24ae5463":"markdown","5ec3ab21":"markdown","72db21e4":"markdown","91985a4f":"markdown","c1cc7355":"markdown","6fcb7a74":"markdown","a88489e6":"markdown","0336b41b":"markdown","6e0b4b10":"markdown","729c3a18":"markdown","eec96b8d":"markdown","baf59049":"markdown","ca09d87e":"markdown","d7c33594":"markdown","9d818b4d":"markdown"},"source":{"41dddc56":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt \nimport seaborn as sns \nfrom sklearn.model_selection import train_test_split,cross_val_score, KFold\nfrom scipy import stats\ncolor = sns.color_palette()\n\n%matplotlib inline\n\npd.options.mode.chained_assignment = None\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","3ebb5c10":"filename='\/kaggle\/input\/top50spotify2019\/top50.csv'\ndf=pd.read_csv(filename,encoding='ISO-8859-1')\ndf.head()","d9ce3d3e":"plt.figure(figsize=(8,6))\nplt.scatter(range(df.shape[0]), np.sort(df.Popularity.values))\nplt.xlabel('index', fontsize=12)\nplt.ylabel('Popularity', fontsize=12)\nplt.show()","f33e503c":"plt.figure(figsize=(12,8))\nsns.countplot(x='Genre',data=df,color=color[2])\nplt.ylabel('Count', fontsize=12)\nplt.xlabel('Genre in data',fontsize=12)\nplt.xticks(rotation='vertical')\nplt.title('frequence of Genre',fontsize=12)\nplt.show()","8b4bf153":"plt.figure(figsize=(12,8))\nsns.boxplot(x=\"Genre\", y=\"Popularity\", data=df)\nplt.ylabel('Popularity', fontsize=12)\nplt.xlabel('Genre Count', fontsize=12)\nplt.xticks(rotation='vertical')\nplt.title(\"How Popularity changes with Genre ?\", fontsize=15)\nplt.show()","d0036d7b":"plt.figure(figsize=(12,8))\nsns.countplot(x='Artist.Name',data=df,color=color[4])\nplt.xlabel('Artist.Name in data given',fontsize=12)\nplt.ylabel('cont of song sung',fontsize=12)\nplt.xticks(rotation='vertical')\nplt.title('Artist.Name and no.of song cont',fontsize=12)\nplt.show()","f48ec18e":"grouped_df = df.groupby([\"Artist.Name\", \"Genre\"])[\"Track.Name\"].aggregate(\"count\").reset_index()\ngrouped_df = grouped_df.pivot('Artist.Name', 'Genre', 'Track.Name')\n\nplt.figure(figsize=(12,8))\nsns.heatmap(grouped_df)\nplt.title(\"Frequency of Artist.Name Vs Genre\")\nplt.show()","989d6b7e":"grouped_df = df.groupby([\"Artist.Name\", \"Genre\"])[\"Track.Name\"].aggregate(\"count\").reset_index()\n\nfig, ax = plt.subplots(figsize=(12,20))\nax.scatter(grouped_df['Track.Name'].values, grouped_df[\"Artist.Name\"].values)\nfor i, txt in enumerate(grouped_df.Genre.values):\n    ax.annotate(txt, (grouped_df['Track.Name'].values[i], grouped_df[\"Artist.Name\"].values[i]), rotation=45, ha='center', va='center', color='green')\nplt.xlabel('Reorder Ratio')\nplt.ylabel('department_id')\nplt.title(\"Reorder ratio of different aisles\", fontsize=15)\nplt.show()","5d71f111":"from wordcloud import WordCloud\nplt.style.use('seaborn')\nwrds1 = df[\"Artist.Name\"].str.split(\"(\").str[0].value_counts().keys()\n\nwc1 = WordCloud(scale=5,max_words=1000,colormap=\"rainbow\",background_color=\"white\").generate(\" \".join(wrds1))\nplt.figure(figsize=(12,18))\nplt.imshow(wc1,interpolation=\"bilinear\")\nplt.axis(\"off\")\nplt.title(\"Artist Name with more songs in data \",color='b')\nplt.show()","b7cc7498":"plt.figure(figsize=(12,8))\nsns.countplot(x=\"Beats.Per.Minute\", data=df, color=color[3])\nplt.ylabel('Count', fontsize=12)\nplt.xlabel('Beats.Per.Minute', fontsize=12)\nplt.xticks(rotation='vertical')\nplt.title(\"Frequency distribution by Beats.Per.Minute order\", fontsize=15)\nplt.show()","138251c1":"skew=df.skew()\nprint(skew)","be4dcd90":"plt.figure(figsize=(12,12))\nsns.jointplot(x=df[\"Beats.Per.Minute\"].values, y=df['Popularity'].values, size=10, kind=\"kde\",color=color[4])\nplt.ylabel('Popularity', fontsize=12)\nplt.xlabel(\"Beats.Per.Minute\", fontsize=12)\nplt.title(\"Beats.Per.Minute Vs Popularity\", fontsize=15)\nplt.show()","91062a60":"plt.figure(figsize=(12,8))\nsns.countplot(x=df.Energy.values,data=df,color=color[5])\nplt.xlabel('Energy label',fontsize=12)\nplt.ylabel('count')\nplt.xticks(rotation='vertical')\nplt.title('Energy label count',fontsize=12)\nplt.show()","648b6313":"plt.figure(figsize=(12,8))\nsns.jointplot(x=df[\"Energy\"], y=df['Popularity'], size=10,kind=\"kde\",color=color[6])\nplt.ylabel('Popularity', fontsize=12)\nplt.xlabel(\"Energy\", fontsize=12)\nplt.title(\"Energy Vs Popularity\", fontsize=15)\nplt.show()","7f847d1a":"df['Loudness..dB..'].value_counts()","bb9784de":"grouped_df = df.groupby([\"Loudness..dB..\"])[\"Popularity\"].aggregate(\"count\").reset_index()\n\nplt.figure(figsize=(12,8))\nsns.pointplot(grouped_df['Loudness..dB..'].values, grouped_df['Popularity'].values, alpha=0.8, color=color[2])\nplt.ylabel('Reorder ratio', fontsize=12)\nplt.xlabel('Department', fontsize=12)\nplt.title(\"Department wise reorder ratio\", fontsize=15)\nplt.xticks(rotation='vertical')\nplt.show()","2684bd10":"plt.figure(figsize=(12,8))\nsns.violinplot(x='Loudness..dB..', y='Popularity', data=df)\nplt.xlabel('Loudness..dB..', fontsize=12)\nplt.ylabel('Popularity', fontsize=12)\nplt.show()","63b76f9a":"plt.figure(figsize=(12,8))\nsns.countplot(x='Danceability',data=df,color=color[8])\nplt.xlabel('Danceability count',fontsize=12)\nplt.ylabel('count',fontsize=12)\nplt.xticks(rotation='vertical')\nplt.show()","3acdb899":"plt.figure(figsize=(12,8))\nsns.jointplot(x=df[\"Danceability\"], y=df['Popularity'], size=10,kind=\"kde\",color=color[6])\nplt.ylabel('Popularity', fontsize=12)\nplt.xlabel(\"Danceability\", fontsize=12)\nplt.title(\"Danceability Vs Popularity\", fontsize=15)\nplt.show()","38bf8f31":"grouped_df = df.groupby(['Energy','Danceability'])['Popularity'].aggregate('mean').reset_index()\n\ngrouped_df = grouped_df.pivot('Energy', 'Danceability', 'Popularity')\n\nplt.figure(figsize=(12,8))\nsns.heatmap(grouped_df)\nplt.title(\"Frequency of Energy Vs Danceability\")\nplt.show()","568f8edf":"plt.figure(figsize=(12,8))\nsns.countplot(x=df.Liveness.values,data=df,color=color[5])\nplt.xlabel('Liveness label',fontsize=12)\nplt.ylabel('count')\nplt.xticks(rotation='vertical')\nplt.title('Liveness label count',fontsize=12)\nplt.show()","331af87b":"#skew change \ntransform=np.asarray(df[['Liveness']].values)\ndf_transform = stats.boxcox(transform)[0]","fb877a9b":"fig=plt.subplots(figsize=(10,10))\nplt.title('Dependence between Liveness and popularity',fontsize=12)\nsns.regplot(x='Liveness', y='Popularity',\n            ci=None, data=df)\nsns.kdeplot(df.Liveness,df.Popularity)\nplt.show()","5997c805":"plt.figure(figsize=(12,8))\nsns.countplot(x=df['Acousticness..'].values,data=df,color=color[5])\nplt.xlabel('Acousticness label',fontsize=12)\nplt.ylabel('count')\nplt.xticks(rotation='vertical')\nplt.title('Acousticness label count',fontsize=12)\nplt.show()","3569a6e1":"fig=plt.subplots(figsize=(10,10))\nplt.title('Dependence between Acousticness and popularity',fontsize=12)\nsns.regplot(x='Acousticness..', y='Popularity',\n            ci=None, data=df)\nsns.kdeplot(df.Liveness,df.Popularity)\nplt.show()","2291c369":"print(df.dtypes)","78ab2e89":"xcol = [col for col in df.columns if col not in['Popularity'] if df[col].dtypes=='int64']\n\nlabel = []\nvales = []\n\nfor col in xcol:\n    label.append(col)\n    vales.append(np.corrcoef(df[col].values,df.Popularity.values)[0,1])\n    \ncorr_df = pd.DataFrame({'col_label':label,'col_values':vales})\ncorr_df =corr_df.sort_values(by = 'col_values')\n\n\nind = np.arange(len(label))\nwidth = 0.9\nfig, ax = plt.subplots(figsize=(12,40))\nrects = ax.barh(ind, np.array(corr_df.col_values.values), color='y')\nax.set_yticks(ind)\nax.set_yticklabels(corr_df.col_label.values, rotation='horizontal')\nax.set_xlabel(\"Correlation coefficient\")\nax.set_title(\"Correlation coefficient of the variables\")\nplt.show()","0c93bbcc":"corr_df_sel = corr_df.ix[(corr_df['col_values']>0.1) | (corr_df['col_values'] < -0.3)]\ncorr_df_sel","5fbe3eab":"train_y = df['Popularity'].values\nnum_df = df[xcol].drop(['Unnamed: 0'],axis=1)\nfeat_name = num_df.columns.values\n\nfrom sklearn import ensemble \nmodel = ensemble.ExtraTreesRegressor(n_estimators=25,max_depth=30,max_features=0.3, n_jobs=-1, random_state=0) \nmodel.fit(num_df,train_y)\n\nimportances = model.feature_importances_\nstd = np.std([tree.feature_importances_ for tree in model.estimators_],axis=0)\nindi = np.argsort(importances)[::-1][:20]\n\nplt.figure(figsize=(12,12))\nplt.title(\"Feature importances\")\nplt.bar(range(len(indi)), importances[indi], color=color[4], yerr=std[indi], align=\"center\")\nplt.xticks(range(len(indi)), feat_name[indi], rotation='vertical')\nplt.xlim([-1, len(indi)])\nplt.show()","fbe11e2b":"import xgboost as xgb\nxgb_params = {\n    'eta': 0.05,\n    'max_depth': 8,\n    'subsample': 0.7,\n    'colsample_bytree': 0.7,\n    'objective': 'reg:linear',\n    'silent': 1,\n    'seed' : 0\n}\ndtrain = xgb.DMatrix(num_df, train_y, feature_names=num_df.columns.values)\nmodel = xgb.train(dict(xgb_params, silent=0), dtrain, num_boost_round=50)\n\n# plot the important features #\nfig, ax = plt.subplots(figsize=(12,18))\nxgb.plot_importance(model, max_num_features=50, height=0.8, ax=ax)\nplt.show()","523d40f9":"def runXGB(train_X, train_y, test_X, test_y=None, feature_names=None, seed_val=0, num_rounds=1000):\n    param = {}\n    param['objective'] = 'multi:softprob'\n    param['eta'] = 0.1\n    param['max_depth'] = 6\n    param['silent'] = 1\n    param['num_class'] = 3\n    param['eval_metric'] = \"mlogloss\"\n    param['min_child_weight'] = 1\n    param['subsample'] = 0.7\n    param['colsample_bytree'] = 0.7\n    param['seed'] = seed_val\n    num_rounds = num_rounds\n\n    plst = list(param.items())\n    xgtrain = xgb.DMatrix(train_X, label=train_y)\n\n    if test_y is not None:\n        xgtest = xgb.DMatrix(test_X, label=test_y)\n        watchlist = [ (xgtrain,'train'), (xgtest, 'test') ]\n        model = xgb.train(plst, xgtrain, num_rounds, watchlist, early_stopping_rounds=20)\n    else:\n        xgtest = xgb.DMatrix(test_X)\n        model = xgb.train(plst, xgtrain, num_rounds)\n\n    pred_test_y = model.predict(xgtest)\n    return pred_test_y, model","ddd991b3":"more to come , will soon update with the modeling part ....\n\n*your one upvote can more me to work more*  :)","cd452385":"***univariate analysis***  :","9960794e":"**pleace upvote if you liked it thank you **","b8f150a5":"**3.Beats.Per.Minute**","977c3322":"**1.Genre**","009c998c":"**2.Artist.Name**","cf069d0b":"seems most of the songs are from Dance_pop genre ","d847d3a2":"we will check each Attribute and its distribution and its dependance with the target and check for the importance of the each Attribute with the target ....   :)","d72ec713":"first we check the target **'Popularity'**","24ae5463":"less songs with -9 ","5ec3ab21":"i thing songs should be with more energetic to Dance ","72db21e4":"**5.Danceability**","91985a4f":"**4.Energy**","c1cc7355":"seems like with good beats.per.Minute are more getting good  popularity ","6fcb7a74":"now, Since there are so many variables, let us first take the 'int' variables alone and then get the correlation with the target variable to see how they are related.","a88489e6":"seems like 'Valence','Energy' are more imporant variable and lets check with the XGB","0336b41b":"lets once check the skew() ","6e0b4b10":"**6.Liveness **","729c3a18":"seems like according to the Loudness they rated the songs ","eec96b8d":"yes we have Liveness with +ve skew and Popularity with -ve skew() but as Popularity is our target we cant change anything \nand we will change Liveness while deling with that ","baf59049":"so this are the more highly correlated with the target ","ca09d87e":"seems majority of the songs are by  Ed Sheeran now let combine the both and check ...! ","d7c33594":"We had an understanding of important variables from the univariate analysis. But this is on a stand alone basis and also we have linearity assumption. Now let us build a non-linear model to get the important variables by building Extra Trees model.","9d818b4d":"Using xgboost, the important variables are 'Valence' followed by 'Acousticness' and 'Beats.Per.Minute'"}}