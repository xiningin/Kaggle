{"cell_type":{"3978a27a":"code","2dccc948":"code","31363714":"code","d9ad94b5":"code","db720db2":"code","dc7122c7":"code","a002a0e9":"code","cace55c6":"code","5f6bfed0":"code","e6ba3ad2":"code","37f714c9":"code","17cb40db":"code","f5048b35":"code","56765915":"code","8562dd3e":"code","d7364c1f":"code","7d453199":"code","3601de11":"code","8b6c6582":"code","d7ebce2d":"code","9dc4c614":"code","6ccb39b5":"code","3653aca5":"code","bbb4d425":"code","6caf5276":"code","4e34a56f":"code","95f50dd8":"code","564c6d3d":"code","f79929cf":"code","61232116":"code","5c8edf7b":"code","154744d6":"markdown","bfed0130":"markdown","973eaeca":"markdown","850b1539":"markdown","1bdd7d87":"markdown","28b14afe":"markdown","2847a997":"markdown","7ced8319":"markdown","027ad816":"markdown","1d904c0c":"markdown","7aafb538":"markdown","38575f97":"markdown","0a557b29":"markdown","746bd333":"markdown","1b4f439a":"markdown","6ac26f21":"markdown","99add829":"markdown","d59c7bde":"markdown","8a22303d":"markdown","290b11ee":"markdown","89590e68":"markdown","b93d13ff":"markdown","d8885bb4":"markdown","78567b7e":"markdown","1d9f9d85":"markdown","4ea76922":"markdown","a5e51275":"markdown","f1e8955d":"markdown","74f82010":"markdown","9fc370bd":"markdown","bb6a651b":"markdown","72e1496d":"markdown","66c79ada":"markdown","73b8e007":"markdown"},"source":{"3978a27a":"import pandas as pd\nimport numpy as np\n\n# Operating System\nimport os\n\n# https requests\nimport requests\n\n# file encoding detection\nimport chardet\n\n# matplotlib for plots\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\n# seaborn for plots\nimport seaborn as sns\n\n# statsmodels for regression\nimport statsmodels.formula.api as sm","2dccc948":" # read csv data file into a DataFrame\ndf_candy = pd.read_csv(\"..\/input\/the-ultimate-halloween-candy-power-ranking\/candy-data.csv\", encoding='ISO-8859-1')","31363714":"df_candy.sample(5)","d9ad94b5":"df_candy.info()","db720db2":"df_candy.describe()","dc7122c7":"# convert YES\/NO features from integer type to boolean\n\nbool_feature_list = ['chocolate', 'fruity', 'caramel', 'peanutyalmondy', 'nougat', 'crispedricewafer', 'hard', 'bar', 'pluribus']\ndf_candy[bool_feature_list] = df_candy[bool_feature_list].astype(bool)","a002a0e9":"# define target or dependent variable\ntarget_name = 'winpercent'","cace55c6":"# list of boolean features\n\n# The same as defined above\n# bool_feature_list = df_candy.select_dtypes(include=['bool']).columns.tolist()\nbool_feature_list","5f6bfed0":"# list of numerical features\nnumeric_feature_list = df_candy.select_dtypes(include=['int', 'float']).columns.tolist()\n\n# remove target variable from numerical feature list\nnumeric_feature_list = [feat for feat in numeric_feature_list if not feat==target_name]\nnumeric_feature_list","e6ba3ad2":"# set plot styles\nsns.set_style(\"white\")\nsns.set_context(\"notebook\", font_scale=1.2, rc={\"lines.linewidth\": 2})\n\npalette_style = \"coolwarm\"\ncolor = \"blue\"","37f714c9":"sns.distplot(df_candy[target_name], bins=20, color = 'blue')\n\nplt.title(\"Distribution of win percentage on the data set\")\nplt.ylabel(\"density\")\nplt.show()","17cb40db":"df_aux = df_candy.loc[:,['competitorname','winpercent']].sort_values(by='winpercent', ascending=False).reset_index(drop=True)\ndf_aux.competitorname = df_aux.competitorname.str.replace('\u00d5',\"\\'\")\ndf_aux = df_aux[(df_aux.winpercent>76) | (df_aux.winpercent<30)]\n\n# blank row between top and bottom competitors\ndf_aux.iloc[5,0] = \"(...)\"\ndf_aux.iloc[5,1] = np.nan\n\nsns.barplot(x=df_aux['winpercent'], y=df_aux['competitorname'], palette = palette_style)\nplt.xlabel(\"[%]\")\nplt.ylabel(\"\")\nplt.yticks(rotation=25)\nplt.grid(axis='x')\n\nplt.title(\"Comparison of competitors' win percentages\")\nplt.show();","f5048b35":"df_candy[bool_feature_list].sum().sort_values(ascending=False)","56765915":"df_candy[bool_feature_list].sum().plot.barh()\nplt.xlabel(\"N\u00ba of occurrences\")\nplt.grid(axis='x')\n\nplt.title(\"N\u00ba of occurrences by boolean variables\")\n\nplt.show();","8562dd3e":"for feature_name in bool_feature_list:\n    \n    ax = sns.boxplot(x=feature_name, y=target_name, data=df_candy, palette=palette_style)\n    ax = sns.swarmplot(x=feature_name, y=target_name, data=df_candy, color=\".25\")\n    \n    # Format plot title\n    plot_title_str = 'Distribution of win percentage by {}'.format(feature_name)    \n    plt.title(plot_title_str)\n    \n    # Format file name\n    file_name_str = \".\/plots\/target_dist_by_{}\".format(feature_name)\n    plt.show();","d7364c1f":"for feature_name in bool_feature_list:\n    \n    sns.distplot(df_candy.loc[df_candy[feature_name]==False, target_name], bins=20, color = 'blue', label='False')\n    sns.distplot(df_candy.loc[df_candy[feature_name]==True, target_name], bins=20, color = 'tomato', label='True')\n    \n    # Format plot title\n    plot_title_str = 'Distribution of win percentage by {}'.format(feature_name)\n    plt.ylabel(\"density\")\n    plt.title(plot_title_str)\n    \n    plt.legend()\n    plt.show()","7d453199":"for feature_name in numeric_feature_list:\n    \n    ax = sns.regplot(x=feature_name, y=target_name, data=df_candy, color='royalblue')\n    \n    # Format plot title\n    plot_title_str = 'Scatter plot of win percentage vs. {}'.format(feature_name)    \n    plt.title(plot_title_str)\n    \n    # Format file name\n    file_name_str = \".\/plots\/target_regression_by_{}\".format(feature_name)\n    \n    plt.show();\n","3601de11":"corr = df_candy.corr().round(decimals=2)\n\n# Hide upper right diagonal\nmask = np.zeros_like(corr)\n# mask[np.triu_indices_from(mask)] = True\n\nplt.figure(figsize=(11,11))\nsns.heatmap(data=corr, mask=mask, annot=True, cmap='coolwarm')\nplt.show()","8b6c6582":"feat1 = 'chocolate'\nfeat2 = 'fruity'\ndf_aux = pd.DataFrame(np.zeros((2, 2)), index=[[feat1, feat1],['Yes','No']], columns=[[feat2, feat2],['Yes','No']])\n\nidx = pd.IndexSlice\ndf_aux.loc[idx[feat1,'No'], idx[:,'No']] = df_candy[(df_candy[feat1]==False) & (df_candy[feat2]==False)].count()[0]\ndf_aux.loc[idx[feat1,'No'], idx[:,'Yes']] = df_candy[(df_candy[feat1]==False) & (df_candy[feat2]==True)].count()[0]\ndf_aux.loc[idx[feat1,'Yes'], idx[:,'No']] = df_candy[(df_candy[feat1]==True) & (df_candy[feat2]==False)].count()[0]\ndf_aux.loc[idx[feat1,'Yes'], idx[:,'Yes']] = df_candy[(df_candy[feat1]==True) & (df_candy[feat2]==True)].count()[0]\nassert df_aux.sum().sum() == 85\ndf_aux.astype(int)","d7ebce2d":"# columns = [feat for feat in bool_feature_list if feat!='chocolate' and  feat!='fruity']\n# df_aux = pd.DataFrame(np.zeros((2, 7)), index=['chocolate', 'fruity'], columns=[columns]).astype(int)\n\n# for feat in columns:\n#     df_aux.loc['chocolate', feat] = df_candy.loc[((df_candy['chocolate']==True) & (df_candy[feat]==True)), :].count()[0]\n#     df_aux.loc['fruity', feat] = df_candy[(df_candy['fruity']==True) & (df_candy[feat]==True)].count()[0]\n    \n# df_aux","9dc4c614":"reg_formula_str = target_name + ' ~ ' + ' + '.join([col for col in df_candy.columns[:] if col!=target_name and col!='competitorname'])\nprint(reg_formula_str)","6ccb39b5":"result = sm.ols(formula=reg_formula_str, data=df_candy).fit()\nprint(result.summary())","3653aca5":"# select a subset of columns to use\ndf_test = df_candy.loc[:,['winpercent','chocolate','fruity','peanutyalmondy','crispedricewafer','hard','sugarpercent']]\n# create boolean feature chocolate & peanutyalmondy\ndf_test.loc[:,'chocolate_peanutyalmondy'] = (df_test.loc[:,'chocolate']==True) & (df_test.loc[:,'peanutyalmondy']==True)\n# create boolean feature chocolate & crispedricewafer\ndf_test.loc[:,'chocolate_crispedricewafer'] = (df_test.loc[:,'chocolate']==True) & (df_test.loc[:,'crispedricewafer']==True)\n# create boolean feature fruity & hard\ndf_test.loc[:,'fruity_hard'] = (df_test.loc[:,'fruity']==True) & (df_test.loc[:,'hard']==True)\n# create boolean feature high sugar content.\ndf_test.loc[:,'highsugar'] = df_test.loc[:,'sugarpercent'] > 0.8\n# drop columns we will not use in the regression\ndf_test = df_test.drop(columns=['crispedricewafer','peanutyalmondy', 'hard', 'sugarpercent'])\ndf_test.columns","bbb4d425":"reg_formula_str = target_name + ' ~ ' + ' + '.join([col for col in df_test.columns[:] if col!=target_name and col!='competitorname'])\nprint(reg_formula_str)","6caf5276":"result_test = sm.ols(formula=reg_formula_str, data=df_test).fit()\nprint(result_test.summary())","4e34a56f":"df_candy.winpercent.describe()[:2].round(1)","95f50dd8":"df_candy.loc[(df_candy.chocolate==True) & (df_candy.peanutyalmondy==True),:].winpercent.describe()[:2]","564c6d3d":"df_candy.loc[(df_candy.chocolate==False) | (df_candy.peanutyalmondy==False),:].winpercent.describe()[:2]","f79929cf":"df_candy.loc[(df_candy.chocolate==False) & (df_candy.peanutyalmondy==False),:].winpercent.describe()[:2]","61232116":"df_candy.loc[(df_candy.chocolate==True) & (df_candy.peanutyalmondy==True) & (df_candy.sugarpercent>0.8),:].winpercent.describe()[:2]","5c8edf7b":"ax = sns.boxplot(x='chocolate_peanutyalmondy', y=target_name, data=df_test, palette=palette_style)\nax = sns.swarmplot(x='chocolate_peanutyalmondy', y=target_name, data=df_test, color=\".25\")\n \nplt.title('Chocolate and peanut\/almond against the rest')\nplt.ylabel(\"Winning rate [%]\")\nplt.xlabel(\"chocolate and peanut\/almond\")\n\nplt.show();","154744d6":"# Introduction","bfed0130":"Count and average winning rate if the product contains chocolate and peanutyalmondy:","973eaeca":"The data contains the following fields:\n\nHeader | Description\n-------|------------\nchocolate | Does it contain chocolate?\nfruity | Is it fruit flavored?\ncaramel | Is there caramel in the candy?\npeanutalmondy | Does it contain peanuts, peanut butter or almonds?\nnougat | Does it contain nougat?\ncrispedricewafer | Does it contain crisped rice, wafers, or a cookie component?\nhard | Is it a hard candy?\nbar | Is it a candy bar?\npluribus | Is it one of many candies in a bag or box?\nsugarpercent | The percentile of sugar it falls under within the data set.\npricepercent | The unit price percentile compared to the rest of the set.\nwinpercent | The overall win percentage according to 269,000 matchups.","850b1539":"The purpose of this notebook is to explore the [FiveThirtyEight](https:\/\/fivethirtyeight.com\/) Candy Power Ranking [dataset](https:\/\/github.com\/fivethirtyeight\/data\/tree\/master\/candy-power-ranking). We are particularly interested in explaining the variation in the winning percentage among candies. I.e., we want to understand which candy characteristics influence its performance in the matchups against competitors.  \n\nWe start with an exploratory data analysis of the dataset, assessing the influence in the target variable of each feature alone. Then we proceed for a classical OLS, first including all explanatory variables, then with a subset of the most relevant ones.","1bdd7d87":"Top and bottom performers.","28b14afe":"# Import the data set","2847a997":"# Statistical analysis using OLS regression","7ced8319":"Two main characteristics define the candies: either contain chocolate or are fruity flavored. The combination of the two happens just once.","027ad816":"With the baseline configuration (i.e., including all variables as they came) we were able to attain an adjusted R squared of 47.1%.  \nSome of the features are clearly unable to help us explaining the variation of the dependent variable. For example `caramel`, `nougat`, `bar`, and `pluribus` have p-values above 50%, and the price a p-value of 28.6%.  \n`chocolate` clearly appears as the most important factor, with a coefficient of about 20 p.p. and a standard error of 3.9 p.p.. `fruity`, `peanutyalmondy`, `crispedricewafer`, `hard`, and `sugarpercent` also seem to be important. We will explore these features deeper in the next section.  \nThe biggest surprise was to find a positive coefficient for the `fruity` attribute. Based on the plot titled 'Distribution of win percentage by fruity' we would expect a negative coefficient. What happens is that fruity also means no chocolate (see the negative coefficient in the correlation matrix). Although both features have a positive effect, the chocolate coefficient is twice the size, so when we select `fruity` candies we see the positive effect of this feature but we don't see the positive effect of `chocolate`, and the overall effect becomes negative.","1d904c0c":"The percentage of won matchups varies from about 20% to 80% between the different brands. Ideally, we want to learn from the data set which characteristics make a candy more likely to win a matchup against its competitors.","7aafb538":"Count and average winning rate if the product contains neither of the two attributes:","38575f97":"Considering the complete data set, the average winning rate is 50.3% in 85 products. If we consider only competitors having the two characteristics identified as most important (i.e., higher regression coefficients), we are left with 12 products with an average winning rate of 68.5%. This is a substantial increase that should be taken into account in explaining the winning rate. If we drop one of these attributes then the average winning rate decreases to 47.3%, and if neither are present, which happens in 46 products (more than half of the products), the average winning rate decreases even further to 42.5%.  \n\nSumming up, a chocolate candy with peanuts, peanut butter, or almonds in it is likely to perform well above average.  \n\nFinally, high sugar (above 80th percentile) content also seems to be important. And indeed, when we consider the three characteristics: chocolate with peanut\/almond included and a high level of sugar, the winning rate further increases to 72.2%. However, since we are left with only two products, it is a little risky to make any strong conclusion, and it is probably more sensible to consider only the two attributes with a higher contribution to performance.","0a557b29":"## Multivariate analysis","746bd333":"# Conclusions","1b4f439a":"Let's see how these two main characteristics combine with the remaining ones.","6ac26f21":"Observations:\n- The average winning rate of candies having chocolate was 20 p.p. higher when compared with the remaining candies in the sample (not containing chocolate).\n- Fruit flavor seems to have a negative effect (we will comment on this latter).","99add829":"### Print a sample and main characteristics of the data set","d59c7bde":"Below, just a different approach with the same purpose.","8a22303d":"Observations from the correlation matrix:\n- Percentage of won matchups seems to be mainly affected by the presence of chocolate. The remaining categories seem to impact wins (positively or negatively) with comparable magnitudes.\n- As a consequence of previous observation, we remark that the impact of price on matchup results seems to be in line with the impact of remaining categories (except chocolate).\n- Fruit flavored most of the times means no chocolate, and vice-versa.\n- Sugar content is very well balanced among all categories, except price (cheaper candies also have lower sugar levels).  \n- Chocolate is sold at significantly higher prices than average whereas fruit-flavored at lower prices.\n- Chocolate frequently comes in bar-shaped candies, also with peanut\/almond, crisp texture, and nougat or caramel. The opposite happens with fruit-flavored candies, which frequently miss those categories.","290b11ee":"### Combination of boolean features one-by-one.","89590e68":"## Baseline  \nSimple OLS regression with all features included.","b93d13ff":"Count and average winning rate if the product contains all the three most important attributes:","d8885bb4":"## Univariate analysis - boolean variables","78567b7e":"### Data set description","1d9f9d85":"## Distribution of target variable","4ea76922":"## Univariate analysis - numerical variables","a5e51275":"Count and average winning rate if the product does not contains the two attributes together: ","f1e8955d":"### Prepare data for analysis","74f82010":"Count and average winning rate in the complete data set:","9fc370bd":"# Exploratory data analysis","bb6a651b":"Equivalent analysis for continuous variables. A scatter plot with the regression line superimposed.","72e1496d":"## Alternative specifications  \n\nWe have tried several alternative specifications for the regression equation. This was done by removing different features (simultaneously or separately) and trying their combination to investigate:\n- whether there was a significant change in the magnitude and standard error of the coefficients (robustness).\n- the best configuration in terms of adjusted R-squared (best fit).  \n\nIn the end, we have chosen to use `winpercent ~ chocolate + fruity + chocolate_peanutyalmondy + chocolate_crispedricewafer + fruity_hard + highsugar` (where the underscore in the name of the features means that characteristics before and after the underscore are both present and highsugar means above 80th percentile of sugar content), obtaining an adjusted R-squared of 52.3%.","66c79ada":"- Higher number of occurrences for: chocolate, fruity, and pluribus.\n- Nougat and crispedricewafer present in less than 10% of the sample: caution when drawing conclusions! ","73b8e007":"Let's see how each characteristic alone affects the percentage of won matchups."}}