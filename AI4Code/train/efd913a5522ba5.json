{"cell_type":{"a76e593d":"code","0fba578d":"code","7e4fcb5c":"code","8db68483":"code","dc11c620":"code","c3238e46":"code","ff06859c":"code","02877cbe":"code","9d017cd2":"code","68cb1424":"code","65d5904b":"code","fdfe710e":"code","89f01b6d":"code","97967b60":"code","7c168c45":"code","896dd74f":"code","a15ddeac":"code","37a97f11":"code","49703c24":"code","e8688249":"code","8a09752e":"code","0bc0b14a":"code","a4ef4a03":"markdown","733b1fb8":"markdown","b9723aa8":"markdown","174910df":"markdown","c69c674e":"markdown","d93ab4e2":"markdown","0ea76a49":"markdown","00f5265e":"markdown","f3d9ab1c":"markdown"},"source":{"a76e593d":"import pandas as pd\nimport numpy as np\nfrom collections import Counter\nimport matplotlib.pyplot as plt\n\nsales_file_path = '..\/input\/nyc-rolling-sales.csv'\nsales_data = pd.read_csv(sales_file_path)\nsales_data.columns =sales_data.columns.str.strip().str.lower().str.replace(' ', '_').str.replace('-', '_')\nsales_data.building_class_category=sales_data.building_class_category.str.strip().str.lower().str.replace(' ', '').str.replace('-', '_')\nsales_data = sales_data.drop_duplicates(sales_data.columns, keep='last')\nsales_data.describe() \n#print(sales_data.columns)\n\nprice=[]\nland_square=[]\ngross_square=[]\ntaxclass1=[]\ntaxclass2=[]\ntaxclass4=[]\nManhattan=[] #(1), \nBronx=[] #(2), \nBrooklyn=[] #(3), \nQueens=[] #(4), \nState_Island=[]#5\nbuildingclass1=[]\nbuildingclass2=[]\nbuildingclass3=[]\nbuildingclass10=[]\nbuildingclass13=[]\n\n#######YPU CAN DO THIS WITH GET DUMMIES\n##########pd.get_dummies(data=data, columns=[''])\nfor i in range(len(sales_data.sale_price)):\n    price.append(0) if sales_data.sale_price[i]==' -  ' else price.append(float(sales_data.sale_price[i]))\n    land_square.append(0) if sales_data.land_square_feet[i]==' -  ' else land_square.append(float(sales_data.land_square_feet[i]))\n    gross_square.append(0) if sales_data.gross_square_feet[i]==' -  ' else gross_square.append(float(sales_data.gross_square_feet[i]))\n    taxclass1.append(1) if sales_data.tax_class_at_time_of_sale[i]==1 else taxclass1.append(0)\n    taxclass2.append(1) if sales_data.tax_class_at_time_of_sale[i]==2 else taxclass2.append(0)\n    taxclass4.append(1) if sales_data.tax_class_at_time_of_sale[i]==4 else taxclass4.append(0)    \n    Manhattan.append(1) if sales_data.borough[i]==1 else Manhattan.append(0)    \n    Bronx.append(1) if sales_data.borough[i]==2 else Bronx.append(0)    \n    Brooklyn.append(1) if sales_data.borough[i]==3 else Brooklyn.append(0)    \n    Queens.append(1) if sales_data.borough[i]==4 else Queens.append(0)    \n    State_Island.append(1) if sales_data.borough[i]==5 else State_Island.append(0)    \n    buildingclass1.append(1) if sales_data.building_class_category[i]=='01onefamilydwellings' else buildingclass1.append(0)\n    buildingclass2.append(1) if sales_data.building_class_category[i]=='02twofamilydwellings' else buildingclass2.append(0)\n    buildingclass3.append(1) if sales_data.building_class_category[i]=='03threefamilydwellings' else buildingclass3.append(0)\n    buildingclass10.append(1) if sales_data.building_class_category[i]=='10coops_elevatorapartments' else buildingclass10.append(0)\n    buildingclass13.append(1) if sales_data.building_class_category[i]=='13condos_elevatorapartments' else buildingclass13.append(0)\n\n    \nsales_data['sale_date'] = pd.to_datetime(sales_data['sale_date'])\nsales_data.sale_date = [item.to_julian_date() for item in sales_data.sale_date] \n\nsales_data['price'] =price\nsales_data['land_square'] =land_square\nsales_data['gross_square'] =gross_square\nsales_data['taxclass1']=taxclass1\nsales_data['taxclass2']=taxclass2\nsales_data['taxclass4']=taxclass4\nsales_data['Manhattan']=Manhattan\nsales_data['Bronx']=Bronx\nsales_data['Brooklyn']=Brooklyn\nsales_data['Queens']=Queens\nsales_data['State_Island']=State_Island\nsales_data['buildingclass1']=buildingclass1\nsales_data['buildingclass2']=buildingclass2\nsales_data['buildingclass3']=buildingclass3\nsales_data['buildingclass10']=buildingclass10\nsales_data['buildingclass13']=buildingclass13\n\n\n#features=['borough','land_square', 'gross_square', 'year_built',\n      # 'tax_class_at_time_of_sale','sale_date','price']\nsales_data.describe()\n","0fba578d":"#print(sales_data.building_class_category.unique())\nplt.title(r'Building class category %')\n(sales_data['building_class_category'].value_counts().head() \/ len(sales_data)).plot.bar()","7e4fcb5c":"ax1=sales_data[sales_data.building_class_category=='01onefamilydwellings'].plot.scatter(x='gross_square', y='price',c='red',title='Relation price vs gross square per building class',label='01onefamilydwellings')\nsales_data[sales_data.building_class_category=='02twofamilydwellings'].plot.scatter(x='gross_square', y='price',c='black',label='02twofamilydwellings',ax=ax1)\nsales_data[sales_data.building_class_category=='03threefamilydwellings'].plot.scatter(x='gross_square', y='price',c='blue',label='03threefamilydwellings',ax=ax1)\nsales_data[sales_data.building_class_category=='10coops_elevatorapartments'].plot.scatter(x='gross_square', y='price',c='green',label='10coops_elevatorapartments',ax=ax1)\nsales_data[sales_data.building_class_category=='13condos_elevatorapartments'].plot.scatter(x='gross_square', y='price',c='cyan',label='13condos_elevatorapartments',ax=ax1)\nax1.set_xlabel(\"Gross Square\")\nax1.set_ylabel(\"Price\")\nax1.set_ylim([.5,10**9])\nax1.set_xlim([-50,10**4.1])\nax1.set_yscale(\"log\", nonposy='clip')\n","8db68483":"plt.title(r'Borough %')\n(sales_data['borough'].value_counts().head() \/ len(sales_data)).plot.bar()","dc11c620":"#Manhattan #Bronx #Brooklyn\n#Queens #State_Island=[]#5  \n\nax1=sales_data[sales_data.Manhattan==1].plot.scatter(x='gross_square', y='price',c='red',title='Relation price vs gross square per borough',label='Manhattan')\nsales_data[sales_data.Bronx==1].plot.scatter(x='gross_square', y='price',c='black',label='Bronx',ax=ax1)\nsales_data[sales_data.Brooklyn==1].plot.scatter(x='gross_square', y='price',c='blue',label='Brooklyn',ax=ax1)\nsales_data[sales_data.Queens==1].plot.scatter(x='gross_square', y='price',c='green',label='State Island',ax=ax1)\nsales_data[sales_data.State_Island==1].plot.scatter(x='gross_square', y='price',c='cyan',label='Queens',ax=ax1)\nax1.set_xlabel(\"Gross Square\")\nax1.set_ylabel(\"Price\")\nax1.set_ylim([.5,10**9])\nax1.set_xlim([-50,10**4.1])\nax1.set_yscale(\"log\", nonposy='clip')\n#ax1.set_xscale(\"log\", nonposx='clip')","c3238e46":"plt.title(r'Tax Class at time of sale %')\n(sales_data['tax_class_at_time_of_sale'].value_counts().head() \/ len(sales_data)).plot.bar()","ff06859c":"ax1=sales_data[sales_data.taxclass1==1].plot.scatter(x='gross_square', y='price',c='red',title='Relation price vs gross square per tax class',label='Tax class1')\nsales_data[sales_data.taxclass2==1].plot.scatter(x='gross_square', y='price',c='black',label='Tax class 2',ax=ax1)\nsales_data[sales_data.taxclass4==1].plot.scatter(x='gross_square', y='price',c='blue',label='Tax Class 4',ax=ax1)\nax1.set_xlabel(\"Gross Square\")\nax1.set_ylabel(\"Price\")\nax1.set_ylim([.5,10**9])\nax1.set_xlim([-50,10**4.1])\nax1.set_yscale(\"log\", nonposy='clip')\n#ax1.set_xscale(\"log\", nonposx='clip')","02877cbe":"plt.title(r'Price ')\nplt.xscale('log')\nplt.ylim((0,1050))\nsales_data['price'].value_counts().sort_index().plot.line()","9d017cd2":"plt.title(r'Price: houses under $10000 ')\nsales_data[sales_data['price'] < 10000]['price'].plot.hist()\nplt.text(1500,20000,'mostly between \\$0-\\$100'\n         'not really a sale and it will mess'\n         'with my predictions',wrap=True)\n","68cb1424":"plt.title(r'Price ')\nplt.xscale('log')\nplt.ylim((0,550))\nsales_data[sales_data['price']>10000]['price'].value_counts().sort_index().plot.line()","65d5904b":"plt.title(r' Year Built ')\nplt.xlim((-10,2020.10))\n#plt.ylim((0,1000.10))\nplt.text(250,400,'uppss First human settlement 1609')\nsales_data['year_built'].value_counts().sort_index().plot.line()","fdfe710e":"plt.title(r' Year Built ')\nplt.xlim((1880,2020.10))\n#plt.ylim((0,10.10))\nsales_data[sales_data['year_built']>1880]['year_built'].value_counts().sort_index().plot.line()","89f01b6d":"ax1=sales_data[sales_data.Manhattan==1].plot.scatter(x='year_built', y='price',c='red',title='Relation price vs year built per borough',label='Manhattan')\nsales_data[sales_data.Bronx==1].plot.scatter(x='year_built', y='price',c='black',label='Bronx',ax=ax1)\nsales_data[sales_data.Brooklyn==1].plot.scatter(x='year_built', y='price',c='blue',label='Brooklyn',ax=ax1)\nsales_data[sales_data.Queens==1].plot.scatter(x='year_built', y='price',c='green',label='State Island',ax=ax1)\nsales_data[sales_data.State_Island==1].plot.scatter(x='year_built', y='price',c='cyan',label='Queens',ax=ax1)\nax1.set_xlabel(\"Year_built\")\nax1.set_ylabel(\"Price\")\nax1.set_ylim([.05,10**9.5])\nax1.set_xlim([1880,2050])\nax1.set_yscale(\"log\", nonposy='clip')\n#ax1.set_xscale(\"log\", nonposx='clip')","97967b60":"plt.title(r' Sale_date ')\n#plt.xlim((-10,2020.10))\n#plt.ylim((0,1000.10))\n#plt.text(250,400,'uppss First human settlement 1609')\nsales_data['sale_date'].value_counts().sort_index().plot.line()","7c168c45":"features=['land_square', 'gross_square', 'year_built',\n          'taxclass1','taxclass2','taxclass4',\n          'Manhattan','Queens','Brooklyn','Bronx','State_Island',\n         'buildingclass1','buildingclass2','buildingclass3','buildingclass10',\n          'residential_units', 'commercial_units', 'total_units',\n       'price']\nX=sales_data[features]\nX=X[X.gross_square != 0]\nX=X[X.land_square != 0]\nX=X[X.price >100000]\nX=X[X.year_built >1880]\nX.describe()","896dd74f":"import pandas as pd\nimport numpy as np\nfrom collections import Counter\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nX['price']=np.log1p(X['price'])\nX['land_square']=np.log1p(X['land_square'])\nX['gross_square']=np.log1p(X['gross_square'])\nX['year_built']=np.log1p(X['year_built'])\n\ncolormap = plt.cm.magma\nplt.figure(figsize=(19,19))\nplt.title('Pearson Correlation of Features', y=1.05, size=15)\ncorr = X.corr()\nsns.heatmap(corr,linewidths=0.1,vmax=1.0, square=True, cmap=colormap, linecolor='white', annot=True)\ncorr['price'].sort_values(ascending=False)","a15ddeac":"from sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import r2_score\nfrom sklearn.metrics import explained_variance_score\nfrom sklearn.metrics import mean_squared_error\n\n#X= np.log1p(X)\ny = X['price']\nX2 = X.drop(['price'], axis=1).values \ntrain_X, val_X, train_y, val_y = train_test_split(X2, y, random_state = 0)\n\nmodel = LinearRegression()\nmodel.fit(train_X, train_y)\ny_pred = model.predict(val_X) \n\nprint('r2',model.score(val_X, val_y))####r2 score\nprint('rmse',(mean_squared_error(val_y, y_pred))**0.5)","37a97f11":"from sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import Ridge\nfrom sklearn.metrics import r2_score\nfrom sklearn.metrics import explained_variance_score\nfrom sklearn.metrics import mean_squared_error\n\ny = X['price']\nX2 = X.drop(['price'], axis=1).values \ntrain_X, val_X, train_y, val_y = train_test_split(X2, y, random_state = 0)\n\nalpha_ridge = [0.000001,0.0001,.001,1]\nfor item in alpha_ridge:\n    modelt = Ridge(alpha=item,copy_X=True, fit_intercept=True, max_iter=None,\n          normalize=False, random_state=None, solver='auto', tol=0.001)\n    modelt.fit(train_X, train_y)\n    y_predt = modelt.predict(val_X) \n\n   # print(item,'r2',modelt.score(val_X, val_y))####r2 score\n    #print('rmse',(mean_squared_error(val_y, y_predt))**0.5)\n   # print('explained variance',explained_variance_score(val_y,y_predt))\n    \nmodel2 = Ridge(alpha=0.000001,copy_X=True, fit_intercept=True, max_iter=None,\n          normalize=False, random_state=None, solver='auto', tol=0.001)\nmodel2.fit(train_X, train_y)\ny_pred2 = model2.predict(val_X) \n\nprint('r2',model2.score(val_X, val_y))####r2 score\nprint('rmse',(mean_squared_error(val_y, y_pred2))**0.5)","49703c24":"from sklearn.model_selection import train_test_split\nfrom sklearn import linear_model\nfrom sklearn.metrics import r2_score\nfrom sklearn.metrics import explained_variance_score\nfrom sklearn.metrics import mean_squared_error\n\ny = X['price']\nX2 = X.drop(['price'], axis=1).values \ntrain_X, val_X, train_y, val_y = train_test_split(X2, y, random_state = 0)\n\nalpha_ridge = [0.000001,0.0001,.001,1]\nfor item in alpha_ridge:\n    modelt = linear_model.Lasso(alpha=item, copy_X=True, fit_intercept=True, max_iter=1000,\n   normalize=False, positive=False, precompute=False, random_state=None,\n   selection='cyclic', tol=0.0001, warm_start=False)\n    modelt.fit(train_X, train_y)\n    y_predt = modelt.predict(val_X) \n\n   # print(item,'r2',modelt.score(val_X, val_y))####r2 score\n   # print('rmse',(mean_squared_error(val_y, y_predt))**0.5)\n  #  print('explained variance',explained_variance_score(val_y,y_predt))\n    \nmodel3 = linear_model.Lasso(alpha=0.000005, copy_X=True, fit_intercept=True, max_iter=1000,\n   normalize=False, positive=False, precompute=False, random_state=None,\n   selection='cyclic', tol=0.0001, warm_start=False)\n                            \nmodel3.fit(train_X, train_y)\ny_pred3 = model3.predict(val_X) \n\nprint('r2',model3.score(val_X, val_y))####r2 score\nprint('rmse',(mean_squared_error(val_y, y_pred3))**0.5)","e8688249":"from sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.metrics import r2_score\nfrom sklearn.metrics import explained_variance_score\nfrom sklearn.metrics import mean_squared_error\n\ny = X['price']\nX2 = X.drop(['price'], axis=1).values \ntrain_X, val_X, train_y, val_y = train_test_split(X2, y, random_state = 0)\n\n\nmodel4 = RandomForestRegressor()\nmodel4.fit(train_X, train_y)\ny_pred4 = model4.predict(val_X) \n\nprint('r2',model4.score(val_X, val_y))####r2 score\nprint('rmse',(mean_squared_error(val_y, y_pred4))**0.5)","8a09752e":"import matplotlib.pyplot as plt\n\n# plot a line, a perfit predict would all fall on this line\nind = np.linspace(10,21,1000)\nplt.xlabel('Test Data')\nplt.ylabel('Predicted DataPrice') \n#plt.xlim(-100,10000000)\n#plt.ylim(-100,10000000)\nplt.plot(ind, ind,'-')\nplt.plot(val_y, y_pred, '.',label='Linear Regression')\nplt.plot(val_y, y_pred2, 'o',label='Ridge Regression')\nplt.plot(val_y, y_pred3, '*',label='Lasso Regression')\nplt.plot(val_y, y_pred4, '.',label='Random Forest Regression')\nplt.legend(loc='lower right')\nplt.show()","0bc0b14a":"import matplotlib.pyplot as plt\nimport random\n#select random data to show\ni=random.randint(1,len(val_y)-101)\nind = np.linspace(0, 100,100)\n\nplt.xlabel('Data index')\nplt.ylabel('Price in thousands of $') \n\nplt.plot(ind, np.expm1(val_y[i:i+100])\/1000,'-', linewidth=2.2,label='Test data' )\nplt.plot(ind, np.expm1(y_pred[i:i+100])\/1000, '--',linewidth=1.4,label='Linear Regression')\nplt.plot(ind, np.expm1(y_pred2[i:i+100])\/1000, '-.',linewidth=1.3,label='Ridge Regression')\nplt.plot(ind, np.expm1(y_pred3[i:i+100])\/1000, '--',linewidth=1.2,label='Lasso Regression')\nplt.plot(ind, np.expm1(y_pred4[i:i+100])\/1000, '-.',linewidth=1.2,label='Random Forest Regression')\nplt.legend(loc='upper right')\nplt.xlim(-2,112)\nplt.show()","a4ef4a03":"I studied the borough categories, its relation with gross square and price.","733b1fb8":"I changed the sale date to julian time and explored the data, I didnt see any pater in the sale date.","b9723aa8":"This data is about properties sold in New York City over a 12-month period from September 2016 to September 2017.\n\n*1.  No (# in the data)\n2. BOROUGH (Code for the borough the property is located in; in order these are Manhattan (1), Bronx (2), Brooklyn (3), Queens (4), and State Island (5)), \n3. NEIGHBORHOOD \n4. BUILDING CLASS CATEGORY,\n5. TAX CLASS AT PRESENT (1,2,3,4,5)\n6. BLOCK,\n7. LOT,\n8. EASE-MENT\n9. BUILDING CLASS AT PRESENT\n10. ADDRESS (\u201cA\u201d signifies one-family homes, \u201cO\u201d signifies office buildings. \u201cR\u201d signifies condominiums)\n11. APARTMENT NUMBER\n12. ZIP CODE\n13. RESIDENTIAL UNITS\n14. COMMERCIAL UNITS,\n15. TOTAL UNITS\n16. LAND SQUARE FEET\n17. GROSS SQUARE FEET\n18. YEAR BUILT,\n19. TAX CLASS AT TIME OF SALE\n20. BUILDING CLASS AT TIME OF SALE\n21. SALE PRICE,\n22. SALE DATE*\n\nI cleaned the data: remove duplicate data, clean null data, converted the categorical data in numerical data that I can use in the regression, and normalize the use of strings.","174910df":"So finally, the features that I decided to use in my models:\n'land_square'\n'gross_square',\n'year_built',\n 'taxclass1',\n 'taxclass2',\n 'taxclass4',\n  'Manhattan','Queens','Brooklyn','Bronx','State_Island',\n  'buildingclass1','buildingclass2','buildingclass3','buildingclass10',\n 'residential_units', 'commercial_units', 'total_units',\n ","c69c674e":"I studied the sale prices. A lot of houses where sold by unreal prices ($0-$10) , this means that the houses where not sold, they were transfer between owners.\nI used houses with prices over $100,000, because is a relistic price that wont mess my models.","d93ab4e2":"I studied the building class categories, its relation with gross square and price.","0ea76a49":"I studied the tax class time categories at time of sale categories, its relation with gross square and price.\nI am not interested in the tax class at present time, that could cause at leakage of my regression.","00f5265e":"I transformed some data that was skewed to the right.\n\nI studied the correlations between the features and price:\n* gross_square         0.673120\n* Manhattan            0.457679\n* taxclass2            0.371986\n* taxclass4            0.325582\n* land_square          0.274129\n\n \n I will use four different methods for the regression:\n linear, lasso, ridge and random forest regression.","f3d9ab1c":"Results for the different regression:\n* linear:\n r2 0.6111805534821673\n rmse 0.5340183237978753\n* Ridge:\n r2 0.6111805532023231\n rmse 0.5340183239900492\n* lasso\n r2 0.6113140862445937\n rmse 0.5339266166236538\n* Random forest regression:\n r2 0.625753188947449\nrmse 0.5239154727330908\n\nThe best score is for the random forest."}}