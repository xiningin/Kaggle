{"cell_type":{"4a805a7f":"code","37728b8c":"code","615842a5":"code","87d760ff":"code","0066a4a5":"code","680ae352":"code","d3091480":"code","d87da383":"code","137189e9":"code","6ceab0c4":"code","2db7be59":"code","75e81962":"code","895d1bd0":"code","e091b118":"code","17ce0e58":"code","e0a99f4b":"code","6e780936":"code","5eb79ad4":"code","aad488bb":"code","77525af6":"code","9de1ba5f":"code","52dd9a54":"code","57abc9da":"code","c0749564":"code","f492ea89":"code","fef64c7f":"code","b0433f6e":"code","e4199aea":"code","60c872b3":"code","5ccd4eac":"code","efcc0af4":"code","cf0f5f21":"code","9e4dc194":"code","9ceb1a21":"markdown","068c0b86":"markdown","2ce13e77":"markdown","5a634b90":"markdown","ce8d2894":"markdown","d996f95d":"markdown","48ee33cb":"markdown","f981a045":"markdown","a1038046":"markdown","8acc092d":"markdown"},"source":{"4a805a7f":"import numpy as np\nimport pandas as pd\n\nfrom fastai import *\nfrom fastai.vision import *\n\nimport imageio\n\nimport os\n\nimport matplotlib.pyplot as plt\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","37728b8c":"root = Path('..\/input')\ntrain_path = Path('train')\nrseed = 7\nval_size = 0.05","615842a5":"def save_imgs(path:Path, data, labels):\n    path.mkdir(parents=True,exist_ok=True)\n    for label in np.unique(labels):\n        (path\/str(label)).mkdir(parents=True,exist_ok=True)\n    for i in range(len(data)):\n        if(len(labels)!=0):\n            imageio.imsave( str( path\/str(labels[i])\/(str(i)+'.jpg') ), data[i] )\n        else:\n            imageio.imsave( str( path\/(str(i)+'.jpg') ), data[i] )","87d760ff":"train_csv = pd.read_csv(root\/'train.csv')","0066a4a5":"test_csv = pd.read_csv(root\/'test.csv')","680ae352":"train_csv.head()","d3091480":"data_X, data_y = train_csv.loc[:,'pixel0':'pixel783'], train_csv['label']","d87da383":"from sklearn.model_selection import train_test_split\n\ntrain_X, val_X, train_y, val_y = train_test_split(data_X, data_y, test_size=val_size,random_state=rseed,stratify=data_y)","137189e9":"def to_img_shape(data_X, data_y=[]):\n    data_X = np.array(data_X).reshape(-1,28,28)\n    data_X = np.stack((data_X,)*3, axis=-1)\n    data_y = np.array(data_y)\n    return data_X,data_y","6ceab0c4":"train_X,train_y = to_img_shape(train_X, train_y)","2db7be59":"val_X,val_y = to_img_shape(val_X,val_y)","75e81962":"save_imgs(Path('\/data\/train'),train_X,train_y)","895d1bd0":"save_imgs(Path('\/data\/valid'),val_X,val_y)","e091b118":"data = ImageDataBunch.from_folder('\/data\/',bs=256,size=28,ds_tfms=get_transforms(do_flip=False),num_workers=0).normalize(imagenet_stats)","17ce0e58":"data.show_batch(3,figsize=(6,6))","e0a99f4b":"learn = cnn_learner(data,models.resnet18,metrics=accuracy,path='.')","6e780936":"learn.fit_one_cycle(4,0.01)","5eb79ad4":"learn.save('s1')","aad488bb":"learn.load('s1');","77525af6":"learn.unfreeze()","9de1ba5f":"learn.lr_find()","52dd9a54":"learn.recorder.plot()","57abc9da":"learn.fit_one_cycle(30,1e-4)","c0749564":"interp = ClassificationInterpretation.from_learner(learn)","f492ea89":"interp.plot_confusion_matrix(figsize=(8,8))","fef64c7f":"interp.plot_top_losses(9,figsize=(9,9))","b0433f6e":"sub_df = pd.DataFrame(columns=['ImageId','Label'])","e4199aea":"test_data = np.array(test_csv)","60c872b3":"def get_img(data):\n    t1 = data.reshape(28,28)\/255\n    t1 = np.stack([t1]*3,axis=0)\n    img = Image(FloatTensor(t1))\n    return img","5ccd4eac":"from fastprogress import progress_bar","efcc0af4":"mb=progress_bar(range(test_data.shape[0]))\nfor i in mb:\n    timg=test_data[i]\n    img = get_img(timg)\n    sub_df.loc[i]=[i+1,int(learn.predict(img)[1])]","cf0f5f21":"sub_df.head()","9e4dc194":"sub_df.to_csv('submission.csv',index=False)","9ceb1a21":"# Load data","068c0b86":"# Prepare data","2ce13e77":"# Explore data","5a634b90":"# Interpret results","ce8d2894":"# Helper functions","d996f95d":"Save images","48ee33cb":"# Train model","f981a045":"## Control Variables","a1038046":"# Fine tune","8acc092d":"# Make predictions"}}