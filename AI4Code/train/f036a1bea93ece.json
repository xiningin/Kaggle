{"cell_type":{"82ae444f":"code","f36249f1":"code","89229554":"code","c13ce601":"code","6f12722c":"code","72d9767d":"code","9acedad7":"code","dd2913d5":"code","fcc9aa84":"code","6d8a2730":"code","1e5845f4":"code","5883131a":"code","110e9d0d":"code","9e6f7f7b":"code","e582faea":"code","25999b63":"code","9f200838":"code","8a27305c":"code","e21389b9":"code","04df515f":"code","55b43170":"code","cfa6197f":"code","7aef9301":"code","e55d21ce":"code","5e0f4f42":"code","12f9d7bc":"code","5e0de6b4":"code","7b06470c":"code","6cdade37":"code","092d36d1":"code","88166c78":"code","2f8d5bd4":"markdown","57b71fab":"markdown","7e0aa86a":"markdown","43258e97":"markdown","65fae4b4":"markdown","4d52e636":"markdown","38e0dff1":"markdown","e25e08a1":"markdown","40156449":"markdown","5065238c":"markdown","fe8395aa":"markdown","295bba48":"markdown","9015bb97":"markdown","66d63f17":"markdown","63caa4f6":"markdown","c4c4173b":"markdown","bfe4269d":"markdown","9108f66f":"markdown","29fdebde":"markdown","87fb259a":"markdown","14a7c668":"markdown","e8987802":"markdown","ec6bcaf4":"markdown","6e23e41b":"markdown","a553bd2e":"markdown","79b50b5c":"markdown","a2b01e43":"markdown","794f28d9":"markdown","033f67cf":"markdown","583c96db":"markdown","180d5d4f":"markdown","69b7246e":"markdown","a2dcc151":"markdown","71189c87":"markdown","077edddd":"markdown","086fd5ea":"markdown","55e622b6":"markdown","69a51d05":"markdown","f3157841":"markdown"},"source":{"82ae444f":"# data analysis\nimport pandas as pd\nimport numpy as np\n\n# visualization\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as mtick\nimport seaborn as sns\n\n#predict\nfrom sklearn.model_selection import train_test_split, cross_val_score\nfrom sklearn import metrics\nfrom sklearn.preprocessing import MinMaxScaler, StandardScaler\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.linear_model import RidgeClassifier, LogisticRegression\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.feature_selection import SelectFromModel\nfrom sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.svm import SVC\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\n#read files\ndata = pd.read_csv(\"..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv\")","f36249f1":"print(data.columns.values)","89229554":"data.head()","c13ce601":"data.info()","6f12722c":"data['TotalCharges'] = pd.to_numeric(data['TotalCharges'], errors='coerce')\ndata[\"SeniorCitizen\"].replace(to_replace = 1, value = \"Yes\", inplace =True)\ndata[\"SeniorCitizen\"].replace(to_replace = 0, value = \"No\", inplace =True)\n\ndata.isnull().sum()\ndata[data.TotalCharges.isnull()] \n#Check the rows of data with null values in the TotalCharges field to determine how to deal with null values\n\ndata.dropna(axis=0, how='any', inplace=True)","72d9767d":"data.describe()","9acedad7":"fig,axes = plt.subplots(1,3,figsize = (10,4))\nplt.suptitle('Distribution of numerical feature values', fontsize = 20)\ncols = [\"tenure\", \"MonthlyCharges\", \"TotalCharges\"]\nylabel = [\"Months\", \"Dollars\", \"Dollars\"]\nfor i in range(3):\n    sns.violinplot(data=data[cols[i]],orient=\"v\",ax=axes[i], color=\"#D3D3D3\", cut=0)\n    axes[i].grid(linestyle=\"--\", alpha=0.5)\n    axes[i].set_xticks(np.arange(1))\n    axes[i].set_ylabel(ylabel[i], fontsize=15)\nlabel1=[\"tenure\"]\nlabel2=[\"MonthlyCharges\"]\nlabel3=[\"TotalCharges\"]\naxes[0].set_xticklabels(label1, fontsize=15)\naxes[1].set_xticklabels(label2, fontsize=15)\naxes[2].set_xticklabels(label3, fontsize=15)\nfig.tight_layout()\nplt.show()","dd2913d5":"data.describe(include=['O'])","fcc9aa84":"trans_df = data.iloc[:,1:21]\ntrans_df[\"Churn\"].replace(to_replace = \"Yes\", value = 1, inplace =True)\ntrans_df[\"Churn\"].replace(to_replace = \"No\", value = 0, inplace = True)\n\n#draw bar plot\ncate_cols = ['SeniorCitizen', 'gender', 'Partner', 'Dependents', 'PhoneService', 'MultipleLines', 'InternetService', 'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', 'TechSupport', 'StreamingTV', 'StreamingMovies', 'Contract', 'PaperlessBilling', 'PaymentMethod']\ncolors = [\"Salmon\", \"#5F9EA0\"]\n\nfig, axes = plt.subplots(nrows = 8,ncols = 2,figsize = (15,40))\n\nfor i,feature in enumerate(cate_cols):\n    if i < 8:\n        ax = trans_df.groupby([feature,'Churn']).size().groupby(level=0).apply( lambda x: 100 * x \/ x.sum()).unstack().plot(kind='bar', color=colors, ax=axes[i,0])\n    elif i >=8 and i < 16:\n        ax = trans_df.groupby([feature,'Churn']).size().groupby(level=0).apply( lambda x: 100 * x \/ x.sum()).unstack().plot(kind='bar', color=colors, ax=axes[i-8,1])\n    \n    ax.set_title(\"Distribution of {} and % Churn\".format(feature), fontsize = 20)\n    ax.set_ylabel(\"Percentage\", fontsize=15)\n    ax.set_xlabel(\"{}\".format(feature), fontsize=15)\n    ax.legend([\"No\", \"Yes\"], fontsize=12)\n    \n    for patch in ax.patches:\n        width, height = patch.get_width(), patch.get_height()\n        ax.annotate('{:.0f}%'.format(height), (patch.get_x()+0.1*width, patch.get_y()+0.5*height),\n                    color = 'Black',\n                    weight = 'bold',\n                    size = 20)\n\n    ax.yaxis.set_major_formatter(mtick.PercentFormatter())\n    plt.setp(ax.get_xticklabels(), rotation=10, fontsize=12)\n\nplt.tight_layout()\nplt.show()","6d8a2730":"fig, ax = plt.subplots(1, 2, figsize=(15, 4))\nax[0].set_title(\"Distribution of tenure by Churn\", fontsize = 20)\nitem = data[\"Churn\"].unique()\nsns.kdeplot(data.tenure[(data[\"Churn\"] == item[0]) ], color = \"Gold\", shade = True, ax = ax[0])\nsns.kdeplot(data.tenure[(data[\"Churn\"] == item[1]) ], ax = ax[0], color = \"#5F9EA0\", shade = True)\nax[0].legend([\"{}\".format(item[0]), \"{}\".format(item[1])], loc='upper right')\nax[0].set_ylabel('Density')\nax[0].set_xlabel('tenure')\n\nsns.lineplot(x = \"tenure\", y = \"Churn\", data = trans_df, ax = ax[1])\nax[1].set_title(\"Churn rate of tenure\", fontsize = 20)\nplt.show()","1e5845f4":"fig, ax = plt.subplots(1, 2, figsize=(15, 4))\nax[0].set_title(\"Distribution of Monthly Charges by Churn\", fontsize = 20)\nitem = data[\"Churn\"].unique()\nsns.kdeplot(data.MonthlyCharges[(data[\"Churn\"] == item[0]) ], color=\"Gold\", shade = True, ax = ax[0])\nax[0] = sns.kdeplot(data.MonthlyCharges[(data[\"Churn\"] == item[1]) ], ax = ax[0], color=\"#5F9EA0\", shade= True)\nax[0].legend([\"{}\".format(item[0]), \"{}\".format(item[1])], loc='upper right')\nax[0].set_ylabel('Density')\nax[0].set_xlabel('Total Charges')\n\ntrans_df[\"MonthlyCharges_cut\"] = pd.cut(trans_df.MonthlyCharges, bins=15, labels=np.arange(15))\nsns.lineplot(x = \"MonthlyCharges_cut\", y = \"Churn\", data = trans_df, ax = ax[1])\nax[1].set_title(\"Churn rate of MonthlyCharges\", fontsize = 20)\nplt.show()","5883131a":"fig, ax = plt.subplots(1, 2, figsize=(15, 4))\nax[0].set_title(\"Distribution of Total Charges by Churn\", fontsize = 20)\nitem = data[\"Churn\"].unique()\nsns.kdeplot(data.TotalCharges[(data[\"Churn\"] == item[0]) ], color=\"Gold\", shade = True, ax = ax[0])\nax[0] = sns.kdeplot(data.TotalCharges[(data[\"Churn\"] == item[1]) ], ax = ax[0], color=\"#5F9EA0\", shade= True)\nax[0].legend([\"{}\".format(item[0]), \"{}\".format(item[1])], loc='upper right')\nax[0].set_ylabel('Density')\nax[0].set_xlabel('Total Charges')\n\ntrans_df[\"TotalCharges_cut\"] = pd.cut(trans_df.TotalCharges, bins=9, labels=np.arange(9))\nsns.lineplot(x = \"TotalCharges_cut\", y = \"Churn\", data = trans_df, ax = ax[1])\nax[1].set_title(\"Churn rate of TotalCharges\", fontsize = 20)\nplt.show()","110e9d0d":"colors = [\"Salmon\", \"#5F9EA0\"]\nsns.catplot(x=\"Partner\", y=\"Churn\",\n            hue=\"Dependents\", col=\"SeniorCitizen\",\n            data=trans_df, kind=\"point\",\n            dodge=True, palette = colors,\n            height=3, aspect=1.5)","9e6f7f7b":"cols = [\"OnlineSecurity\", \"OnlineBackup\", \"DeviceProtection\", \"TechSupport\", \"StreamingTV\", \"StreamingMovies\"]\ncolors = [\"Salmon\", \"#5F9EA0\"]\nfig, ax = plt.subplots(3, 2, figsize=(15, 12))\ndf1 = pd.melt(data[(data[\"InternetService\"] != \"No\") & (data[\"Partner\"] ==\"Yes\")][cols]).rename({'value': 'Has service'}, axis=1)\nsns.countplot(data=df1, x='variable', hue='Has service', ax = ax[0, 0], palette = colors)\ndf2 = pd.melt(data[(data[\"InternetService\"] != \"No\") & (data[\"Partner\"] ==\"No\")][cols]).rename({'value': 'Has service'}, axis=1)\nsns.countplot(data=df2, x='variable', hue='Has service', ax = ax[0, 1], palette = colors)\ndf3 = pd.melt(data[(data[\"InternetService\"] != \"No\") & (data[\"Dependents\"] ==\"Yes\")][cols]).rename({'value': 'Has service'}, axis=1)\nsns.countplot(data=df3, x='variable', hue='Has service', ax = ax[1, 0], palette = colors)\ndf4 = pd.melt(data[(data[\"InternetService\"] != \"No\") & (data[\"Dependents\"] ==\"No\")][cols]).rename({'value': 'Has service'}, axis=1)\nsns.countplot(data=df4, x='variable', hue='Has service', ax = ax[1, 1], palette = colors)\ndf5 = pd.melt(data[(data[\"InternetService\"] != \"No\") & (data[\"SeniorCitizen\"] ==\"Yes\")][cols]).rename({'value': 'Has service'}, axis=1)\nsns.countplot(data=df5, x='variable', hue='Has service', ax = ax[2, 0], palette = colors)\ndf6 = pd.melt(data[(data[\"InternetService\"] != \"No\") & (data[\"SeniorCitizen\"] ==\"No\")][cols]).rename({'value': 'Has service'}, axis=1)\nsns.countplot(data=df6, x='variable', hue='Has service', ax = ax[2, 1], palette = colors)\n\nfor i in range(3):\n    for j in range(2):\n        ax[i,j].set_xlabel('Service Item', fontsize = 15)\n        ax[i,j].set_ylabel('Num of customers',  fontsize = 15)\n        ax[i,j].legend(bbox_to_anchor=(1.0, 1.0), loc='upper left', title=\"Has service\")\n        plt.setp(ax[i,j].get_xticklabels(), rotation=15, fontsize=12)\n\nax[0,0].set_title(\"Partner = Yes\", fontsize = 20)\nax[0,1].set_title(\"Partner = No\", fontsize = 20)\nax[1,0].set_title(\"Dependents = Yes\", fontsize = 20)\nax[1,1].set_title(\"Dependents = No\", fontsize = 20)\nax[2,0].set_title(\"SeniorCitizen = Yes\", fontsize = 20)\nax[2,1].set_title(\"SeniorCitizen = No\", fontsize = 20)\nplt.subplots_adjust(wspace=0.4, hspace=0.7)\nplt.show()","e582faea":"col_name1 = [\"SeniorCitizen\", \"Partner\", \"Dependents\"]\n\nfig, ax = plt.subplots(2, 2, figsize=(15,10))\nprint(\"Average:\")\n    \nfor i,j in enumerate(col_name1):\n    item = data[j].unique()\n    if i < 2:\n        ax[0,i] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[0]) ], color=\"Gold\", shade = True, ax = ax[0,i])\n        ax[0,i] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[1]) ], ax =ax[0,i], color=\"#5F9EA0\", shade= True)\n        ax[0,i].set_title(\"Distribution of monthly charges by {}\".format(j), fontsize = 20)\n        ax[0,i].legend([\"{}\".format(item[0]), \"{}\".format(item[1])], loc='upper right')\n        ax[0,i].set_ylabel('Density', fontsize = 15)\n        ax[0,i].set_xlabel('Monthly Charges', fontsize = 15)\n    elif i >= 2:\n        ax[1,i-2] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[0]) ], color=\"Gold\", shade = True, ax = ax[1,i-2])\n        ax[1,i-2] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[1]) ], ax =ax[1,i-2], color=\"#5F9EA0\", shade= True)\n        ax[1,i-2].set_title(\"Distribution of monthly charges by {}\".format(j), fontsize = 20)\n        ax[1,i-2].legend([\"{}\".format(item[0]), \"{}\".format(item[1])], loc='upper right')\n        ax[1,i-2].set_ylabel('Density', fontsize = 15)\n        ax[1,i-2].set_xlabel('Monthly Charges', fontsize = 15)\n    ave1 = data[data[j]==item[0]].MonthlyCharges.mean().round(2)\n    ave2 = data[data[j]==item[1]].MonthlyCharges.mean().round(2)\n    print(f\"{j} ({item[0]}\/{item[1]}) -->  {ave1} \/ {ave2}.\")\n\nfig.delaxes(ax[1,1])\nplt.tight_layout()\nplt.show()","25999b63":"col_name3 = [\"StreamingTV\", \"Contract\", \"StreamingMovies\", \"InternetService\"]\n\nfig, ax = plt.subplots(2, 2, figsize=(15,10))\nprint(\"Average:\")\nfor i,j in enumerate(col_name3):\n    if i < 2:\n        ax[i,0].set_title(\"Distribution of monthly charges by {}\".format(j), fontsize = 20)\n        item = data[j].unique()\n        ax[i,0] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[0]) ], color=\"Salmon\", shade = True, ax = ax[i,0])\n        ax[i,0] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[1]) ], ax =ax[i,0], color=\"Gold\", shade= True)\n        ax[i,0] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[2]) ], ax =ax[i,0], color=\"#5F9EA0\", shade= True)\n        ax[i,0].legend([\"{}\".format(item[0]), \"{}\".format(item[1]), \"{}\".format(item[2])], loc='upper right')\n        ax[i,0].set_ylabel('Density')\n        ax[i,0].set_xlabel('Monthly Charges')\n        if j != \"Contract\":\n            ax[i,0].set_ylim(0,0.12)\n    elif i >=2:\n        ax[i-2,1].set_title(\"Distribution of monthly charges by {}\".format(j), fontsize = 20)\n        item = data[j].unique()\n        ax[i-2,1] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[0]) ], color=\"Salmon\", shade = True, ax = ax[i-2,1])\n        ax[i-2,1] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[1]) ], ax =ax[i-2,1], color=\"Gold\", shade= True)\n        ax[i-2,1] = sns.kdeplot(data.MonthlyCharges[(data[j] == item[2]) ], ax =ax[i-2,1], color=\"#5F9EA0\", shade= True)\n        ax[i-2,1].legend([\"{}\".format(item[0]), \"{}\".format(item[1]), \"{}\".format(item[2])], loc='upper right')\n        ax[i-2,1].set_ylabel('Density')\n        ax[i-2,1].set_xlabel('Monthly Charges')\n        if j != \"Contract\":\n            ax[i-2,1].set_ylim(0,0.12)\n    ave1 = data[data[j]==item[0]].MonthlyCharges.mean().round(2)\n    ave2 = data[data[j]==item[1]].MonthlyCharges.mean().round(2)\n    ave3 = data[data[j]==item[2]].MonthlyCharges.mean().round(2)\n    print(f\"{j} ({item[0]}\/ {item[1]}\/ {item[2]}) -->  {ave1} \/ {ave2} \/ {ave3}.\")\n\nplt.tight_layout()\nplt.show()","9f200838":"fig, ax = plt.subplots(1, 2, figsize=(15,5))\nprint(\"Average:\")\n\nax[0].set_title(\"Distribution of monthly charges by PaperlessBilling\", fontsize = 20)\nitem = data[\"PaperlessBilling\"].unique()\nax[0] = sns.kdeplot(data.MonthlyCharges[(data[\"PaperlessBilling\"] == item[0]) ], color=\"Gold\", shade = True, ax = ax[0])\nax[0] = sns.kdeplot(data.MonthlyCharges[(data[\"PaperlessBilling\"] == item[1]) ], ax = ax[0], color=\"#5F9EA0\", shade= True)\nax[0].legend([\"{}\".format(item[0]), \"{}\".format(item[1])], loc='upper right')\nax[0].set_ylabel('Density')\nax[0].set_xlabel('Monthly Charges')\n\n\nave1 = data[data[\"PaperlessBilling\"]==item[0]].MonthlyCharges.mean().round(2)\nave2 = data[data[\"PaperlessBilling\"]==item[1]].MonthlyCharges.mean().round(2)\nprint(f\"PaperlessBilling ({item[0]}\/{item[1]}) -->  {ave1} \/ {ave2}.\")\n\nax[1].set_title(\"Distribution of monthly charges by PaymentMethod\", fontsize = 20)\nitem = data[\"PaymentMethod\"].unique()\nax[1] = sns.kdeplot(data.MonthlyCharges[(data[\"PaymentMethod\"] == item[0]) ], color=\"Salmon\", shade = True, ax = ax[1])\nax[1] = sns.kdeplot(data.MonthlyCharges[(data[\"PaymentMethod\"] == item[1]) ], ax = ax[1], color=\"Gold\", shade= True)\nax[1] = sns.kdeplot(data.MonthlyCharges[(data[\"PaymentMethod\"] == item[2]) ], ax = ax[1], color=\"#5F9EA0\", shade= True)\nax[1] = sns.kdeplot(data.MonthlyCharges[(data[\"PaymentMethod\"] == item[3]) ], ax = ax[1], color=\"#D3D3D3\", shade= True)\nax[1].legend([\"{}\".format(item[0]), \"{}\".format(item[1]), \"{}\".format(item[2]), \"{}\".format(item[3])], loc='upper right')\nax[1].set_ylabel('Density')\nax[1].set_xlabel('Monthly Charges')\n\nave1 = data[data[\"PaymentMethod\"]==item[0]].MonthlyCharges.mean().round(2)\nave2 = data[data[\"PaymentMethod\"]==item[1]].MonthlyCharges.mean().round(2)\nave3 = data[data[\"PaymentMethod\"]==item[2]].MonthlyCharges.mean().round(2)\nave4 = data[data[\"PaymentMethod\"]==item[3]].MonthlyCharges.mean().round(2)\nprint(f\"PaymentMethod ({item[0]}\/ {item[1]}\/ {item[2]}\/ {item[3]}) -->  {ave1} \/ {ave2} \/ {ave3} \/ {ave4}.\")\n\nplt.tight_layout()\nplt.show()","8a27305c":"#distribution of categorical features by Churn\ndef Donut_Chart(col_name):\n    def df(col_name, churn_YoN):\n        df = trans_df[trans_df[\"Churn\"]==churn_YoN][col_name].value_counts().to_frame().reset_index()\n        return df\n\n    fig, ax = plt.subplots(1,2, figsize=(18,6))\n    dict = {\"width\": 0.5}\n\n    ax[0].pie(df(col_name, 0)[col_name], \n            colors = [\"Salmon\", \"Gold\", \"#5F9EA0\", \"#D3D3D3\"], \n            autopct='%1.1f%%', startangle = 90, \n            pctdistance = 0.75,\n            wedgeprops=dict,\n            textprops={'fontsize': 17, 'weight' : 'heavy'})\n\n    ax[1].pie(df(col_name, 1)[col_name], \n            colors = [\"Salmon\", \"Gold\", \"#5F9EA0\", \"#D3D3D3\"], \n            autopct='%1.1f%%', startangle = 90, \n            pctdistance = 0.75,\n            wedgeprops=dict,\n            textprops={'fontsize': 17, 'weight' : 'heavy'})\n\n    ax[0].text(0, 0, 'No Churn', ha=\"center\", fontsize = 17, weight=\"bold\")\n    ax[1].text(0, 0, 'Churn', ha=\"center\", fontsize = 17, weight=\"bold\")\n    for i in range(2):\n        ax[i].legend(loc='upper left', fontsize=15, bbox_to_anchor=(0.9, 0.8), labels = df(col_name,i)[\"index\"])\n\n    plt.suptitle(\"The Composition of the {} grouped by Churn\".format(col_name), fontsize = 30)\n    fig.tight_layout()\n    plt.show()\n\ncol = ['SeniorCitizen', 'gender', 'Partner', 'Dependents', 'PhoneService', 'MultipleLines', 'InternetService', 'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', 'TechSupport', 'StreamingTV', 'StreamingMovies', 'Contract', 'PaperlessBilling', 'PaymentMethod']\nfor i in col:\n    Donut_Chart(i)","e21389b9":"data = data.drop(['customerID'], axis=1)\ndata[\"Churn\"].replace(to_replace = \"Yes\", value = 1, inplace =True)\ndata[\"Churn\"].replace(to_replace = \"No\", value = 0, inplace = True)","04df515f":"data['tenureSection'] = pd.qcut(data['tenure'], 5)\ndata[['tenureSection', 'Churn']].groupby(['tenureSection'], as_index=False).mean().sort_values(by='tenureSection', ascending=True)","55b43170":"data.loc[ data['tenure'] <= 6, 'tenure'] = 0\ndata.loc[(data['tenure'] > 6) & (data['tenure'] <= 20), 'tenure'] = 1\ndata.loc[(data['tenure'] > 20) & (data['tenure'] <= 40), 'tenure'] = 2\ndata.loc[(data['tenure'] > 40) & (data['tenure'] <= 60.8), 'tenure'] = 3\ndata.loc[ data['tenure'] > 60.8, 'tenure'] = 4\n\ndata = data.drop(['tenureSection'], axis=1)\ndata.head()","cfa6197f":"data['MonthlyChargesSection'] = pd.qcut(data['MonthlyCharges'], 5)\ndata[['MonthlyChargesSection', 'Churn']].groupby(['MonthlyChargesSection'], as_index=False).mean().sort_values(by='MonthlyChargesSection', ascending=True)","7aef9301":"data.loc[ data['MonthlyCharges'] <= 20.5, 'MonthlyCharges'] = 0\ndata.loc[(data['MonthlyCharges'] > 20.5) & (data['MonthlyCharges'] <= 58.92), 'MonthlyCharges'] = 1\ndata.loc[(data['MonthlyCharges'] > 58.92) & (data['MonthlyCharges'] <= 79.15), 'MonthlyCharges'] = 2\ndata.loc[(data['MonthlyCharges'] > 79.15) & (data['MonthlyCharges'] <= 94.3), 'MonthlyCharges'] = 3\ndata.loc[ data['MonthlyCharges'] > 94.3, 'MonthlyCharges'] = 4\n\ndata = data.drop(['MonthlyChargesSection'], axis=1)\ndata.head()","e55d21ce":"data['TotalChargesSection'] = pd.qcut(data['TotalCharges'], 4)\ndata[['TotalChargesSection', 'Churn']].groupby(['TotalChargesSection'], as_index=False).mean().sort_values(by='TotalChargesSection', ascending=True)","5e0f4f42":"data.loc[ data['TotalCharges'] <= 401.45, 'TotalCharges'] = 0\ndata.loc[(data['TotalCharges'] > 401.45) & (data['TotalCharges'] <= 1397.475), 'TotalCharges'] = 1\ndata.loc[(data['TotalCharges'] > 1397.475) & (data['TotalCharges'] <= 3794.738), 'TotalCharges'] = 2\ndata.loc[(data['TotalCharges'] > 3794.738) & (data['TotalCharges'] <= 8684.8), 'TotalCharges'] = 3\ndata.loc[ data['TotalCharges'] > 8684.8, 'TotalCharges'] = 4\n\ndata = data.drop(['TotalChargesSection'], axis=1)\ndata.head()","12f9d7bc":"data['CombineTM'] = (4-data['tenure']) + data['MonthlyCharges']\ndata[['CombineTM', 'Churn']].groupby(['CombineTM'], as_index=False).mean().sort_values(by='Churn', ascending=False)","5e0de6b4":"df_dummies = pd.get_dummies(data)\ndf_dummies.head()","7b06470c":"# Create Train & Test Data\nX_train = df_dummies.drop(columns = ['Churn'])\ny_train = df_dummies['Churn'].values\nX_train, X_val, y_train, y_val = train_test_split(X_train, y_train, test_size=0.2)","6cdade37":"# Running model\nclfs = []\n\nclfs.append((\"LogReg\", \n             Pipeline([(\"Scaler\", StandardScaler()),\n                       (\"LogReg\", LogisticRegression())])))\n\nclfs.append((\"KNN\", \n             Pipeline([(\"Scaler\", StandardScaler()),\n                       (\"KNN\", KNeighborsClassifier())]))) \n\nclfs.append((\"RandomForestClassifier\", \n             Pipeline([(\"Scaler\", StandardScaler()),\n                       (\"RandomForest\", RandomForestClassifier())]))) \n\nclfs.append((\"DecisionTreeClassifier\", \n             Pipeline([(\"Scaler\", StandardScaler()),\n                       (\"DecisionTree\", DecisionTreeClassifier())])))\n\nclfs.append((\"SVM\", \n             Pipeline([(\"Scaler\", StandardScaler()),\n                       (\"SVM\", SVC())])))\n\n#draw accuracy distribution\nresults, names  = [], [] \n\nfor name, model  in clfs:\n    cv_results = cross_val_score(model, X_train, y_train, cv=10, scoring='accuracy', n_jobs=-1)    \n    names.append(name)\n    results.append(cv_results)    \n    msg = \"%s: %f (+\/- %f)\" % (name, cv_results.mean(), cv_results.std())\n    print(msg)\n\n# boxplot algorithm comparison\ndict={}\nfor i,j in zip(names, results):\n    dict[i]=j\n    \ndf = pd.DataFrame(dict)\ndf = pd.melt(df)\ng = sns.catplot(data = df, x=\"variable\", y=\"value\", kind=\"box\", hue = \"variable\", height=4, aspect=1.5)\nplt.title('Accuracy of Different Classifier', fontsize=22)\nplt.xlabel(\"Classifier\", fontsize=20)\nplt.ylabel(\"Accuracy of Models\", fontsize=18)\ng.set_xticklabels(rotation=20, fontsize=10)\nplt.show()","092d36d1":"# To get the weights of all the variables\nmodel = LogisticRegression()\nmodel.fit(X_train, y_train)\nweights = pd.Series(model.coef_[0],\n                 index=X_train.columns.values)\nprint (weights.sort_values(ascending = False)[:10].plot(kind='barh'))","88166c78":"print(weights.sort_values(ascending = False)[-10:].plot(kind='barh'))","2f8d5bd4":"**`What is the correlation between categorical features and Churn?`**","57b71fab":"# STEP 1. ASK \n\n\n\n#### 1.1 Business Objectives:\n\nBefore starting the analysis, we first set down the questions that we expect to answer:\n1. What product features will cause customers to leave? ([#ANSWER](#discussion))\n2. How to use the findings from the data to help the company retain customers? ([#ANSWER](#RECOMMENDATIONS))\n\n\n#### 1.2 Deliverables:\n1. A clear summary of the business task\n2. Documentation of any cleaning or manipulation of data\n3. A summary of analysis\n4. Supporting visualizations and key findings\n5. Recommendations based on the analysis","7e0aa86a":"#### 4.2 Correlating features to goal (Churn)","43258e97":"* There's a peak in distribution of customers who left, but the distribution curve of number of customers who stay is stable.\n* There is a trend that the larger the tenure, the smaller the churn rate.","65fae4b4":"#### 4.3 Composition of different groups (Churn\/No Churn)","4d52e636":"* Most customers don\u2019t spend too little every month, but 2 groups have different peak values. Peak - Churn: around 80 dollars, Not Churn: around 20 dollars.\n* The churn rate and monthly charges are not clearly related to each other.","38e0dff1":"# STEP 3. PROCESS\n\n\nWe are using Python to prepare and process the data.\n\n#### 3.1 Preparing the Environment and Importing data set","e25e08a1":"**`Which features are numerical?`**\n\nContinous: tenure. Discrete: MonthlyCharges, TotalCharges.","40156449":"# STEP 6. DISCUSSION\n<a id=\"discussion\"><\/a>\n\nAligning all that with the above analysis, we can draw some conclusion here for all 2 groups:\n\n***\n\n**`THE LEAVING CUSTOMERS (Churn = Yes)`**\n\n\n> 26.6% of customers in this sample left within the last month. Most of them have **no partners or dependents**. They usually use **fiber optic** internet, and they **don\u2019t sign up for additional services other than Streaming movies\/Streaming TV**.\n> \n> Most of them sign a **Month-to-month contract**, and leave as soon as the contract expires. **Paperless billing** and **electronic payment** are supported by them, and their **bills are usually higher** than other customers.\n\n**Group's characteristics:**\n\n(a) **Demographic info about customers:**\n* 26% are senior citizen\n* 50% of men and 50% of women\n* 64% have no partner\n* 83% have no dependents\n\n(b) **Services:**\n* 70% use fiber optic internet, and only 6% of them do not sign up for the Internet\n* 65-80% do not use additional internet services such as 'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', and 'TechSupport'\n* 50% don\u2019t use Streaming movies\/ Streaming TV and 40% do.\n\n(c) **Customer account information:**\n* 89% of customers sign a Month-to-month contract\n* 75% adopt paperless billing\n* 57% use electronic payment methods\n* Most of them leave after only one month\n* Most of their monthly charges are distributed in areas with higher monthly charges, and 60% of their monthly charges are higher than average\n* The maximum Total Charges is 8685 dollars, but 47% are concentrated in the range of 0-100 dollars\n***\n**`THE STAYING CUSTOMERS (Churn = No):`**\n\n> 73.4% of customers in this sample stayed within the last month.\n\n**Group's characteristics:**\n\n(a) **Demographic info about customers:** \n* 13% are senior citizen\n* 51% of men and 50% of women\n* 47% have no partner\n* 66% have no dependents\n\n(b) **Services:**\n* Most of them use DSL internet(38%). The number of people selected by the three options is evenly distributed (Fiber optic 35%, No 27%)\n* 36-40% do not use additional internet services, and the number of people using the additional services is similar to that of not using the services.\n\n(c) **Customer account information:**\n* 43% of customers sign a Month-to-month contract\/ 32% sign a Two year contract\/ 25% sign a One year contract\n* 54% adopt paperless billing\n* The proportion of users of the four payment methods is the same (Electronic check\/ Bank transfer (automatic)\/ Credit card (automatic)\/ Mailed check)\n* The tenures concentrate around 1 and 72 months, and the number of customers is evenly distributed in other months\n* Most of them don't spend much, the monthly charges is concentrated at 20 dollars. (Range: 18-120 dollars)\n* Most of their total charges are concentrated in areas with a small number. The higher the total charges, the fewer the number of people.","5065238c":"**Demographic info**\n* Senior citizen have a much higher churn rate: 42% \n* Customers without partner or dependents are more likely to leave.\n\n**Services**\n* Customers with Fiber optic are very likely to churn.\n* Customers who doesn't sign up for OnlineSecurity\/OnlineBackup\/DeviceProtection\/TechSupport are very likely to churn.\n* StreamingTV and StreamingMovies are the most used service, but they're also the service with the highest customer churn rate.\n\n**Customer account info**\n* Customers with paperless billing\/using electronic payment method are very likely to churn.\n* The shorter the contract, the higher the customer churn rate.","fe8395aa":"#### 5.5.1 LogisticRegression\n\nDifferent weights represent the size of the association between the feature and the predicted value (Churn). The negative correlation coefficient means that the more obvious this feature is, the less likely it is to cause customer left.","295bba48":"SeniorCitizen who don't have partner and dependents are most likely to left with churn rate about 50%.","9015bb97":"* Total samples are 7032.\n* The distribution of tenure is relatively scattered. The mode is 1 month(8.7%).\n* The TotalCharges range of top 25% is wide, with a maximum of 8684 dollars, but half of the users spend less than 1397 dollars.","66d63f17":"#### 5.2.2 MonthlyCharges","63caa4f6":"**`What is the distribution of numerical feature values across the samples?`**","c4c4173b":"#### 3.2 Data cleaning and manipulation\n\n*Steps*\n1. Observe and familiarize with data\n2. Check for null or missing values\n3. Perform sanity check of data","bfe4269d":"From the above observation, noted that\n\n1. TotalCharges is wrongly classified as object dtype and has to be converted to float64 dtype.\n2. As SeniorCitizen is a True-False Item, we would like to convert 0, 1 to Yes, No.","9108f66f":"# INTRODUCTION\nThis is a case study for a fictional telecom company that provided home phone and Internet services. The goal of this report is to analyze customer data to predict their behavior (leave or stay) and develop focused customer retention programs.\n\n> \n> Title: **Telco Churn Analysis: Who left? How to retain them?**\n> \n> Author: Rita Chang\n> \n> Date: 13 July, 2021\n> ","29fdebde":"#### 5.2.3 TotalCharges","87fb259a":"# STEP 4. ANALYZE\n\n#### 4.1 Explore the distribution of features","14a7c668":"#### 5.5 Model","e8987802":"**Demographic info**\n* The monthly charges of Senior Citizen is higher than the others. **Peak** - Senior Citizen: around 100 dollars, Not Senior Citizen: around 20 dollars.\n* The presence of a partner\/dependents do not have much effect on the distribution of monthly charges.\n\n**Services**\n* Customers who did not use PhoneService monthly spent 25 dollars less than those who did, and the distribution of them is centralized.\n* The three category of InternetService can be clearly distinguished, customers using Fiber optic pay much more than others. **Average** - Fiber optic: 91.5, DSL: 58.1, No Service: 21.1.\n* There is no particular trend in the distribution of monthly charges by InternetService items, but if customers sign up for the services, the charge will be slightly higher.\n\n**Customer account info**\n* Customers using paperless bills pay more than others. **Peak** - PaperlessBilling: around 90 dollars, Not PaperlessBilling: around 20 dollars.\n* Customers who left pay more than others. **Peak** - Churn: around 80 dollars, Not Churn: around 20 dollars.\n* Customers who select mail check payment method spent least, and customers who choose the electronic payment method spend the most. The the distribution of monthly charges by Bank transfer\/Credit card are almost the same.","ec6bcaf4":"#### 5.2 Cut numerical continuous feature into sections\n\n\n*Steps*\n1. Create feature sections and determine correlations with Churn\n2. Replace feature with ordinals based on the sections\n3. Remove the featureSection column\n\n\n#### 5.2.1 tenure","6e23e41b":"# Thanks for your reading! :)","a553bd2e":"# STEP 7. RECOMMENDATIONS\n<a id=\"RECOMMENDATIONS\"><\/a>\n\n> **Launch Special Program**\n\n1. SeniorCitizen \u2014 A very high percentage of the senior citizens left within the last month (42%). After our research, we found that the senior citizens have the characteristics of high monthly charges and not signing up for services. As a result, we can develop a preferential program for them based on their characteristics.\n\n2. Contract \u2014 During the analysis, we found that the longer the contract length, the less the customer will leave, so we can add some preferential items for long-term contracts to attract customers to sign.\n\n> **Marketing Promotion**\n\n* If customers have the following identities, they are more likely to leave than others: Senior Citizen\/ No Partner\/ No Dependents. The Churn rate of customers who are senior citizen without partner and dependents is 50%. We found that these types of identities have common behavior \u2014 they rarely sign up for additional services such as OnlineSecurity, OnlineBackup. We can advertise for this type of customer.\n\n\n> **Questionnaire**\n\n* Customers using fiber optic internet have a high chance of leaving (42%). We found that the monthly charges for customers using fiber optic internet is 30 dollars higher than customers using DSL internet. (DSL: 58.09\/ Fiber optic: 91.5). Perhaps the reason why customers leave is not just the price, but there may also be unsatisfactory usage of the service. It would be great help if we can do a questionnaire for these leaving customers whether they have encountered any problems in use, or have any suggestions for the service.","79b50b5c":"**`What is the distribution of categorical features?`**","a2b01e43":"After printing out the rows of missing values, it was found that the tenure field of them are all 0.\nWe suppose the null value of \"TotalCharges\" may be caused by the system not being updated, so they may be inferred as new customers.\nSince they are new customers and the missing values are not many, they have little effect on the analysis, so we directly remove the null values.\n\n\n\n\nData cleaning and manipulation is completed. Hence, data is now ready to be analysed.","794f28d9":"* Most customers without a partner or dependents do not sign up for additional services.\n* Most senior citizen customers do not sign up for additional services, too.","033f67cf":"# STEP 2. PREPARE\n\n\n\n#### 2.1 Information on Data Source:\n1. The data is publicly available on [Kaggle: Telco Customer Churn](https:\/\/www.kaggle.com\/blastchar\/telco-customer-churn).\n2. Generated by IBM Samples Team.\n3. About a fictional telco company that provided home phone and Internet services to 7043 customers in California in Q3.\n4. Data collected includes (1) customers who left within the last month, (2) services that each customer has signed up for, (3) customer account information, and (4) demographic info about customers.\n\n\n#### 2.2 Limitations of Data Set:\n1. As data is artificially generated, we cannot ascertain the integrity or accuracy of data.","583c96db":"**`Which features are categorical?`**\n\ngender, Partner, Dependents, PhoneService, MultipleLines, InternetService, OnlineSecurity, OnlineBackup, DeviceProtection, TechSupport, StreamingTV, StreamingMovies, Contract, PaperlessBilling, PaymentMethod, Churn","180d5d4f":"#### 5.3 Create new feature combining existing features\n\nWe can create a new feature which combines tenure and MonthlyCharges. Although tenure and MonthlyCharges have their own trends, neither can be completely divided into two groups based on the distribution of customer churn rates. As a result, we suppose that the two together can be better grouped.","69b7246e":"* The total charges distribution of customers who left is tightly clustered around the peak, and the general distribution of customers who stay is similar as it.\n* There is a trend that the larger the TotalCharges, the smaller the churn rate.","a2dcc151":"**`Which features are available in the dataset?`**","71189c87":"# STEP 5. PREDICT\n\n#### 5.1 Correcting by dropping features","077edddd":"**`How do different categories of people use the service?`**","086fd5ea":"**`What is the correlation between features and churn rate?`**\n\nAs we want to know how well does each feature correlate with Churn, we'll divide users into two groups according to Churn.","55e622b6":"#### 5.4 Converting categorical feature into numerical\n","69a51d05":"**Demographic info**\n* customerID are unique across the dataset (count=unique=7032)\n* Customers are 50.5 % male and 49.5 % female.\n* 70.2% users don't have dependents.\n\n**Services**\n* There're 42% users using MultipleLines services.\n* 78.4% users signed up for the Internet service, and the most popular Internet service item is StreamingMovies with 38.8%.\n\n**Customer account info**\n* More than half of users use Month-to-month contract (55%).\n* The Churn rate is 26.6%.","f3157841":"**`What is the correlation between features and MonthlyCharges?`**"}}