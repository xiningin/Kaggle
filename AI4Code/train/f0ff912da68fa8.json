{"cell_type":{"c0932f95":"code","19a2829e":"code","e012694b":"code","63d78511":"code","894b1db9":"code","03265cc1":"code","f0fb944a":"markdown","8e5e3831":"markdown","a93140b7":"markdown","81b1ac54":"markdown"},"source":{"c0932f95":"!pip install alpha_vantage","19a2829e":"import time\nimport numpy as np\nimport pandas as pd\n\nfrom tqdm.notebook import tqdm\nfrom kaggle_secrets import UserSecretsClient\nfrom alpha_vantage.timeseries import TimeSeries","e012694b":"MAX_API_CALL_PER_MINUTE = 5\nTIME_BETWEEN_CALLS = 60\nAPI_KEY = UserSecretsClient().get_secret('API_KEY')\n\nts = TimeSeries(key=API_KEY, output_format='pandas', indexing_type='date')","63d78511":"df_ibov_composition = pd.read_csv('..\/input\/bovespa-index-ibovespa-stocks-data\/ibov_composition.csv')","894b1db9":"df_ibov_composition['code'].unique()","03265cc1":"for i, ticker in enumerate(tqdm(df_ibov_composition['code'].unique()), 1):\n    try:\n        # Call API to get daily historical data\n        df_series, _ = ts.get_daily(symbol=f'{ticker}.SA', outputsize='full')\n\n        # Rename columns\n        df_series.rename(columns={\n            '1. open' : 'open',\n            '2. high' : 'high',\n            '3. low' : 'low',\n            '4. close' : 'close',\n            '5. volume' : 'volume',\n        }, inplace=True)\n\n        # Save Series\n        df_series.sort_index().to_csv(f'{ticker}_series.csv')\n    except:\n        print(f' Something went wrong with {ticker}')\n    \n    if i % MAX_API_CALL_PER_MINUTE == 0:\n        time.sleep(TIME_BETWEEN_CALLS)","f0fb944a":"# Save series for each stock in BOVESPA Index","8e5e3831":"# IBOV composition series dataset\n\nNotebook to create [this dataset](https:\/\/www.kaggle.com\/filipefilardi\/bovespa-index-ibovespa-stocks-data)","a93140b7":"# Read data to get index portifolio","81b1ac54":"# API parameters\n\nI only have the free services and therefore I'm restricted to the awesome free membership usage, 5 API requests per minute and 500 requests per day!"}}