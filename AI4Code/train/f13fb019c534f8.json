{"cell_type":{"eadad341":"code","88281c36":"code","13a016cb":"code","6027a9f5":"code","c24366fa":"code","57db4475":"code","f0a01388":"code","cd11d8f5":"code","3c2b4fb1":"markdown","6116c929":"markdown","43fbf216":"markdown","75cc048c":"markdown","87501909":"markdown","ba57a9f4":"markdown","f126680b":"markdown","758eee80":"markdown"},"source":{"eadad341":"import pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport seaborn as sns","88281c36":"INPUT_PATH = '..\/input\/ventilator-pressure-prediction\/'\ndf_train = pd.read_csv(INPUT_PATH + 'train.csv')\ndf_test = pd.read_csv(INPUT_PATH + 'test.csv')\n\nprint(f'Length of train records : {len(df_train)}')\nprint(f'Length of test records  : {len(df_test)}')\nprint(f'Number of unique breath_id in train data : {len(df_train[\"breath_id\"].unique())}')\nprint(f'Number of unique breath_id in test data  : {len(df_test[\"breath_id\"].unique())}')\nprint(f'Number of time_steps in a breath_id: {len(df_train) \/ len(df_train[\"breath_id\"].unique())}') # confirmed for all breath_ids\ndf_train.head(10)","13a016cb":"corr = df_train.corr()\nfig = plt.figure(figsize=(9, 9))\nsns.heatmap(corr, annot=True, fmt='.2f', cmap=sns.color_palette('coolwarm',200))\nplt.title('Corralation')\nplt.show()","6027a9f5":"R_all = pd.concat([df_train['R'], df_test['R']], axis=0)\nC_all = pd.concat([df_train['C'], df_test['C']], axis=0)\nR_unique = np.sort(R_all.unique())\nC_unique = np.sort(C_all.unique())\nprint(f'Unique R: {R_unique}')\nprint(f'Unique C: {C_unique}')","c24366fa":"# Define figure layout (label, ticks, frame, annotation,...)\ndef fig_layout(seaborn_plot):\n    plt.xlabel('')\n    plt.ylabel('')\n    plt.yticks([])\n    # Hide frame\n    for l in ['right', 'top', 'left']:\n        seaborn_plot.spines[l].set_visible(False)\n    # Count record length\n    record_length = 0\n    for rectangle in seaborn_plot.patches:\n        record_length += rectangle.get_height()\n    # Add annotation of ratio \n    for rectangle in seaborn_plot.patches:\n        height = rectangle.get_height()\n        width = rectangle.get_width()\n        ratio = round(height\/record_length*100,1)\n        # Ratio\n        sns_plot.annotate(f'{ratio}%',\n                          xy=(rectangle.get_x()+width\/2, height),\n                          ha='center', va='center', size=10,\n                          xytext=(0, 10), textcoords='offset points')\n\n# Plot\nfig = plt.figure(figsize=(12, 8))\nfor i, rc in enumerate(['R', 'C']):\n    # Train set\n    plt.subplot(2,2,i+1)\n    sns_plot = sns.countplot(x=rc, data=df_train)\n    fig_layout(sns_plot)\n    plt.title(rc, size=20)\n    # Test set \n    plt.subplot(2,2,i+3)\n    sns_plot = sns.countplot(x=rc, data=df_test)\n    fig_layout(sns_plot)\n    \nplt.figtext(0.05, 0.75, 'Train', size=20)\nplt.figtext(0.05, 0.25, 'Test', size=20)\nplt.show()","57db4475":"# Sampling breath_ids for display\nsample_breath_ids = []\nfor r in R_unique:\n    for c in C_unique:\n        df_RC = df_train[(df_train['R']==r) & (df_train['C']==c)]\n        breath_ids_RC = df_RC['breath_id'].unique()[:4] # Get 4 samples with R=r and C=c\n        sample_breath_ids.append(breath_ids_RC)\n        \n# Set figure parameters\ncolor_palette = sns.color_palette(\"tab10\")\nplt.subplots_adjust(wspace=0.4, hspace=0.4)\n\n# Plot\nfor breath_ids_RC in sample_breath_ids: # Loop of R and C\n    fig = plt.figure(figsize=(20, 4))\n   \n    for i, b_id in enumerate(breath_ids_RC): # Loop of 3 samples with same R and C\n        df_tmp = df_train[df_train['breath_id']==b_id]\n        R = df_tmp[\"R\"].iloc[0]\n        C = df_tmp[\"C\"].iloc[0]\n        # Axis\n        ax1 = plt.subplot(1,4,i+1) # 1st axis\n        ax2 = ax1.twinx() # 2nd axis (for u_out)\n        ax1.set_xlabel('time_step')\n        # Plot\n        ax1.plot(df_tmp['time_step'], df_tmp['pressure'], color=color_palette[0], label='pressure')\n        ax1.plot(df_tmp['time_step'], df_tmp['u_in'],     color=color_palette[0], label='u_in', linestyle='dashed', linewidth=0.75)\n        ax2.plot(df_tmp['time_step'], df_tmp['u_out'],    color=color_palette[3], label='u_out', linestyle='dashed', linewidth=0.75)\n        # y-limit\n        y_max_lim = 50 if df_tmp['u_in'].max()<50 else 100\n        ax1.set_ylim([0, y_max_lim])\n        ax2.set_ylim([0, 1.5])\n        # Ticks\n        ax1.tick_params(axis='y', colors=color_palette[0])\n        ax2.tick_params(axis='y', colors=color_palette[3])\n        ax2.set_yticks(np.linspace(0, 1.5, 4))\n        # Legend\n        h1, l1 = ax1.get_legend_handles_labels()\n        h2, l2 = ax2.get_legend_handles_labels()\n        ax1.legend(h1+h2, l1+l2, loc='upper right')\n        # Title\n        ax1.set_title(f'breath_id={b_id}')\n    \n    plt.figtext(0.01, 0.5, f'R={R}, C={C}', size=20)\n    plt.show()\n","f0a01388":"def generate_features(df):\n    # u_in and u_out interaction\n    df['u_in_out'] = df['u_in'] * (df['u_out'] - 0.5)\n    # u_in difference\n    df['u_in_diff'] = df['u_in'].diff().fillna(0)\n    # u_in shift\n    df['u_in_lag1'] = df['u_in'].shift(4).fillna(0)\n    df['u_in_lag2'] = df['u_in'].shift(4).fillna(0)\n    # moving meen and std\n    df['u_in_10mv_mean'] = df.groupby('breath_id')['u_in'].rolling(window=10, min_periods=1).mean().reset_index(level=0,drop=True)\n    df['u_in_10mv_std']  = df.groupby('breath_id')['u_in'].rolling(window=10, min_periods=1).std().reset_index(level=0,drop=True)\n    # moving mean and std with exponential weights\n    df['u_in_ew_mean'] = df.groupby('breath_id')['u_in'].ewm(halflife=10).mean().reset_index(level=0,drop=True)\n    df['u_in_ew_std']  = df.groupby('breath_id')['u_in'].ewm(halflife=10).std().reset_index(level=0,drop=True)\n    \n    # 'pressure' moved to end column \n    df['pressure_'] = df['pressure']\n    df.drop('pressure', axis=1, inplace=True)\n    df.rename(columns={'pressure_': 'pressure'}, inplace=True)\n    return df","cd11d8f5":"# Correlation for generated features\ndf_train_ = df_train.copy()\ndf_train_ = generate_features(df_train_)\ndf_train_ = df_train_.drop(df_train_.columns[[0,1]], axis=1)\ncorr = df_train_.corr()\nfig = plt.figure(figsize=(16, 16))\nsns.heatmap(corr, annot=True, fmt='.2f', cmap=sns.color_palette('coolwarm',200))\nplt.title('Corralation for generated features')\nplt.show()","3c2b4fb1":"R and C are constant values in a breath_id and have only three distinct values, which are balanced between train and test.","6116c929":"# Input data","43fbf216":"## R and C","75cc048c":"# Correlation","87501909":"This notebook is EDA for VPP competition (<a href=https:\/\/www.kaggle.com\/dmitryuarov\/ventilator-pressure-eda-lstm-0-189\/data>Google Brain - Ventilator Pressure Prediction<\/a>)   \n    \nreference <a href=https:\/\/www.kaggle.com\/dmitryuarov\/ventilator-pressure-eda-lstm-0-189> https:\/\/www.kaggle.com\/dmitryuarov\/ventilator-pressure-eda-lstm-0-189 <\/a>","ba57a9f4":"### Feature engineering","f126680b":"Some correlations are observed among \"time_step\", \"u_in\", \"u_out\" and \"pressure\".","758eee80":"## u_in, u_out, and pressure  \n- u_out is changed from 0 to 1 at time_step=1. After that, the pressure is rapidly decreased to around 6 cmH2O.\n- Pressure and u_in are some correlated under u_out=0. Pressure is changed accoding to u_in ocillation.\n"}}