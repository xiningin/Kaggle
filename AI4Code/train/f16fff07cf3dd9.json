{"cell_type":{"cade5e73":"code","aeedcfe8":"code","f24840d8":"code","dfa9b164":"code","4500ba0c":"code","bc02f865":"code","eb547ee0":"code","1f16b51a":"code","e3c38751":"code","99611645":"code","64ceeb19":"code","765ce156":"code","386561e5":"code","9b9227e0":"code","f3c4c8b0":"code","712388fe":"code","d1f52a61":"code","e78b50dc":"code","b006c2db":"code","62afc9b4":"code","9efe5f83":"code","04386cc4":"code","d6b53bac":"code","3390f235":"code","7e3557c1":"code","ffc5839f":"code","53851df1":"code","b0e45720":"code","0951a284":"markdown","14f54478":"markdown","44e5b254":"markdown","a3900f96":"markdown","4a4fe907":"markdown","c2c79d5d":"markdown","37621681":"markdown","3f87a477":"markdown","f834accf":"markdown","00391069":"markdown","9557c30b":"markdown","a27b6ec5":"markdown","859f296e":"markdown","f69e938c":"markdown","3bb5d3ee":"markdown","a1d0250b":"markdown","f4edd0a0":"markdown","03ff5013":"markdown","e69ef8e2":"markdown"},"source":{"cade5e73":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport random\nimport scipy.stats as stt\nimport warnings\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.metrics import roc_curve,roc_auc_score\nfrom sklearn.metrics import classification_report\nfrom sklearn.model_selection import cross_val_score\nwarnings.filterwarnings('ignore')\n%pylab inline","aeedcfe8":"data = pd.read_csv('..\/input\/heart.csv')","f24840d8":"data.info()","dfa9b164":"print(data.shape)\ndata.head()","4500ba0c":"plt.figure(figsize=(20,7))\nsns.set()\nsns.countplot(data.age);","bc02f865":"data[data.sex==1].age.hist(bins=20);\ndata[data.sex==0].age.hist(bins=20);","eb547ee0":"print('mens in sample -  {:.2%}'.format(data[data.sex==1].shape[0]\/data.shape[0]))","1f16b51a":"sex_str = np.where(data.sex==1, 'male', 'female')\npd.crosstab(sex_str, data.target).plot(kind='barh');\n\nprint(\"Men have disease: \",data[(data.sex==1)&(data.target==1)].shape[0]\/data[(data.sex==1)].shape[0])\nprint(\"Women have disease: \",data[(data.sex==0)&(data.target==1)].shape[0]\/data[(data.sex==0)].shape[0])","e3c38751":"fig = plt.figure(figsize=(15,7))\nax1 = fig.add_subplot(2,1,1)\nax1.set_title('have disease')\nax1.tick_params(labelbottom='off',axis='x')\nsns.countplot(data[data.target==1].age);\nax2 = fig.add_subplot(2,1,2)\nax2.set_title(\"haven't disease\")\nsns.countplot(data[data.target==0].age);","99611645":"pd.crosstab(data.cp, data.target).plot(kind='barh');\nprint('Human have pain and disease: {:.4}%'.format(data[(data.target==1) & (data.cp!=0)].shape[0]\/data[data.target==1].shape[0]*100))","64ceeb19":"sns.jointplot(data.age, data.trestbps, kind='kde');","765ce156":"categ = pd.cut(data.age,[30,40,50,60,80])\ndat_new = data[['target','trestbps']]\ndat_new['age'] = categ\nplt.figure(figsize=(7,7))\nsns.boxplot(x='age',y='trestbps',hue='target',data=dat_new, width=0.7);","386561e5":"sns.boxplot(x=data.target, y=data.trestbps);","9b9227e0":"np.log(data.chol).hist();","f3c4c8b0":"sns.boxplot(x=data.target, y=data.chol);\nfst = data[data.target==0].chol\nscd = data[data.target==1].chol\nstt.ttest_ind_from_stats(fst.mean(),fst.std(),fst.shape[0],\\\n                         scd.mean(),scd.std(),scd.shape[0],equal_var=True)","712388fe":"sns.pairplot(data[['age','trestbps','thalach','chol','target']],hue='target',size=2.5);","d1f52a61":"pd.crosstab(data.fbs,data.target).plot(kind='barh');","e78b50dc":"f, axes = plt.subplots(1, 5,figsize=(20,10))\nsns.set(font_scale=2)\nsns.boxplot(x=data.target, y=data.thalach, ax=axes[0],fliersize=4);\nsns.boxplot(x=data.target, y=data.chol, ax=axes[1]);\nsns.boxplot(x=data.target, y=data.age, ax=axes[2]);\nsns.boxplot(x=data.target, y=data.trestbps, ax=axes[3]);\nsns.boxplot(x=data.target, y=data.oldpeak, ax=axes[4]);\nplt.tick_params(axis='both', which='major', labelsize=20)\nplt.tight_layout()","b006c2db":"f, axes = plt.subplots(1, 5,figsize=(40,10))\nsns.set(font_scale=2)\npd.crosstab(data.slope,data.target).plot(kind='barh', ax=axes[0]);\npd.crosstab(data.exang,data.target).plot(kind='barh', ax=axes[1]);\npd.crosstab(data.thal,data.target).plot(kind='barh', ax=axes[2]);\npd.crosstab(data.restecg,data.target).plot(kind='barh', ax=axes[3]);\npd.crosstab(data.ca,data.target).plot(kind='barh', ax=axes[4]);\nplt.tick_params(axis='both', which='major', labelsize=16)\nplt.tight_layout()","62afc9b4":"f, axes = plt.subplots(1, 3,figsize=(40,10))\nsns.set(font_scale=3)\npd.crosstab(data.slope,data.sex).plot(kind='barh', ax=axes[0]);\npd.crosstab(data.exang,data.sex).plot(kind='barh', ax=axes[1]);\npd.crosstab(data.thal,data.sex).plot(kind='barh', ax=axes[2]);\nplt.tick_params(axis='both', which='major', labelsize=20)\nplt.tight_layout()","9efe5f83":"sns.set(font_scale=1)\nsns.countplot(data.target);","04386cc4":"data_train, data_test, targ_train, targ_test = train_test_split(\\\n            data[['age','sex','cp','thalach','exang','oldpeak','slope','ca','thal']], data.target, test_size=0.2)","d6b53bac":"forest = RandomForestClassifier(criterion='gini', n_estimators=100, max_depth=4)\nforest.fit(data_train, targ_train)","3390f235":"labels = forest.predict(data_test)\nsns.set(font_scale=1.5)\nauc = roc_auc_score(labels, targ_test)\nfpr, tpr, thresholds = roc_curve(labels,targ_test)\nprint('ROC curve: AUC={0:0.2f}'.format(auc));","7e3557c1":"scores = cross_val_score(forest, data[['age','sex','cp','thalach','exang','oldpeak','slope','ca','thal']], data.target, cv=5)\nprint(\"Accuracy: %0.2f (+\/- %0.2f)\" % (scores.mean(), scores.std() * 2))","ffc5839f":"print(classification_report(labels,targ_test))","53851df1":"forest.feature_importances_","b0e45720":"feat_imp = pd.DataFrame(forest.feature_importances_, index = ['age','sex','cp','thalach','exang','oldpeak','slope','ca','thal'])\nplt.figure(figsize=(8,8));\nsns.barplot(feat_imp[0],feat_imp.index);\nplt.tick_params(axis='both', which='major', labelsize=16)\nplt.xlabel('');","0951a284":"Remember the Sympson paradox, consider the main graphic with target\/trestbps, and if show the same picture. So, feature trestbps is the first candidate to delete in feature list.","14f54478":"Here I cut age to some periods. We see same weak trend to high blood pressure by age, but we can't say anything about relation with blood pressure and taget. Means in disease\/not disease slightly different, but IQR(Q3-Q1) doesnt support this assumption. ","44e5b254":"And the thalach-feature show high differences in disease\/not disease. This feature can be relevant. \nFinally, compare all metric data in boxplots. Best features are thalach, age and oldpeak.","a3900f96":"From this graphic we can see, that women in this sample sick much more often that men.","4a4fe907":"So we can get simple forest classifier for this dataset. <br>\nThank you for reading! I hope this kernel  was helpful for you.","c2c79d5d":"From this countplot we can see, that the danger of the disease is greatly increased from 43 years. But countplot below show that situation isn't bad and a lot if people are healthy in 54-65 years (peak in sample). It mean's that age feature is ambiguous and age don't show certainly probability of getting sick.","37621681":"Here we can see feature importances from this model","3f87a477":"Cholesterol histogramm seems like normal distribution (with some emissions). By ttest we can see, that means are equal, that bad for predictive ability of this feature to the target value.","f834accf":"Crosstab with sex and (slope\/thal\/exang) show that they are related. It's nean that together with sex this features can work better. ","00391069":"Age histogramm show rather bimodal behavior than normal.","9557c30b":"Dataset is small, so we can apply cross validation. And this score doesn't show big deviations from our prediction.","a27b6ec5":"Classes are just about the same:","859f296e":"Here we can see, that chest pain often means that the person is sick. But in about 24% still dangerous situation, when human don't feel pain, but have disease. So, cp feature is relevant.","f69e938c":"male\/female age distribution in sample is equal, but different in count. It can be important.","3bb5d3ee":"It seems logical to check how related age and resting blood pressure (trestbps), but corrplot show very weak correlation.","a1d0250b":"Now consider corrplot with all metrical data. This corrplot can't show any high relation.","f4edd0a0":"Finally, after all manipulations with data, I will leave age, sex, cp, thalach, exang, oldpeak, slope, ca and thal. Many features are cathegroical, therefore to facilitate the solution of the problem, I use trees methods. And for n_estimators=100 for RandomForest these set of features gives more AUC-score than set from all features.","03ff5013":"See to the fbs-feature. This crosstab show that when fasting blood sugar < 120, probability of disease is higher. But this relation isn't high.","e69ef8e2":"Consider last cathegorical features. They are important and show relations with target."}}