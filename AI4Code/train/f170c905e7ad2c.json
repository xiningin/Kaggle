{"cell_type":{"b28fc03a":"code","34235c8d":"code","e28b7a1d":"code","93fcd064":"code","c1439ad7":"code","cfaeb920":"code","97806754":"code","4f440aa4":"code","755da43f":"code","b6965c97":"code","fd512dc4":"code","3bd94121":"code","311be3df":"markdown","f897b704":"markdown","c17f45d2":"markdown","7690d09c":"markdown","83ce0e91":"markdown","690991f0":"markdown","c92b752b":"markdown","193fbdd1":"markdown"},"source":{"b28fc03a":"# VERSION SUMMARY\n\n# version 6: small bugfix\n# version 5: added example for tokenization and prediction\n# version 4: added apex install for mixed precision training ","34235c8d":"import numpy as np \nimport pandas as pd \nimport os\nimport torch","e28b7a1d":"!cd ..\/input\/apex-master\/apex-master\/apex-master\/ && pip install --no-cache-dir --global-option=\"--cpp_ext\" --global-option=\"--cuda_ext\" .","93fcd064":"os.system('pip install --no-index --find-links=\"..\/input\/pytorchpretrainedbert\/\" pytorch_pretrained_bert')","c1439ad7":"from pytorch_pretrained_bert import BertTokenizer\nfrom pytorch_pretrained_bert.modeling import BertModel","cfaeb920":"BERT_FP = '..\/input\/torch-bert-weights\/bert-base-uncased\/bert-base-uncased\/'","97806754":"bert = BertModel.from_pretrained(BERT_FP).cuda()\nbert.eval()","4f440aa4":"tokenizer = BertTokenizer(vocab_file='..\/input\/torch-bert-weights\/bert-base-uncased-vocab.txt')","755da43f":"# lets tokenize some text (I intentionally mispelled 'plastic' to check berts subword information handling)\ntext = 'hi my name is Dieter and I like wearing my yellow pglastic hat while coding.'\ntokens = tokenizer.tokenize(text)\ntokens","b6965c97":"# added start and end token and convert to ids\ntokens = [\"[CLS]\"] + tokens + [\"[SEP]\"]\ninput_ids = tokenizer.convert_tokens_to_ids(tokens)\ninput_ids","fd512dc4":"# put input on gpu and make prediction\nbert_output = bert(torch.tensor([input_ids]).cuda())\nbert_output","3bd94121":"import apex\nbert.half()","311be3df":"## (Optional) Convert model to fp16","f897b704":"## Install requirements","c17f45d2":"## Make prediction","7690d09c":"0 (optional). install apex for mixed presicion support","83ce0e91":"## Setup tokenizer","690991f0":"2. create BERT model and put on GPU","c92b752b":"## Import Bert","193fbdd1":"1. pip install pytorch-pretrained-bert without internet"}}