{"cell_type":{"56f7a9af":"code","9d1e68c7":"code","e6e08d2b":"code","56f40970":"code","13e5edbc":"code","380f5b48":"code","e5c769ee":"code","8e273264":"code","c3258a1a":"code","046310a9":"code","e8d6cea1":"code","af23c985":"code","32639cd5":"code","4bfc54c5":"code","38657df2":"code","804d41c8":"code","8255480e":"code","c0a2c1c5":"code","7d925de4":"code","d7a197ce":"code","815ac5ce":"code","de6bf785":"code","8028de95":"code","b49b3c73":"code","e20956aa":"code","e945c293":"code","01710550":"code","1178022b":"code","059f49de":"code","f24ed098":"code","09956dc5":"code","b3ecce85":"code","3075edbc":"code","6fab7d4a":"code","2fbc120b":"code","3497f664":"code","dba16a67":"code","b8d4506f":"code","e2016dec":"code","ec937da9":"code","18ee641a":"code","49f8f885":"code","482da45d":"code","e411e744":"code","c565056d":"code","30792d2e":"code","d77c451a":"code","bcbfa211":"code","4bbdbf34":"code","893adff7":"code","95346070":"code","903157a3":"code","ff9f4e04":"code","3652de7b":"code","63992bcb":"code","1c6d64b3":"code","57ee9eb5":"code","40185c2a":"code","b261ec5d":"code","73c89b5d":"code","f5b9193a":"code","ab778a9f":"code","8aea64e9":"code","6d9bd4b1":"code","fcfd5f43":"code","7de45da2":"code","6074ca68":"code","41c85758":"code","dca13626":"code","66593931":"code","263a7eac":"code","831ec6e9":"code","629354e4":"code","57dc6315":"code","822c2e1f":"code","542fdb84":"code","83ab3960":"code","eb449a8c":"code","13cc325e":"code","96ff7a1f":"code","0e9d8c72":"markdown","16b4d1ef":"markdown","8a960bc0":"markdown","9a4a8aa4":"markdown","3a9fe8e6":"markdown","1afe06cb":"markdown","8f99062f":"markdown","9cf0080b":"markdown","2931d723":"markdown","0d0ccfa9":"markdown","a71c193b":"markdown","559f780b":"markdown","eeaa11aa":"markdown","a98f75d7":"markdown","92a88d01":"markdown","3a22893a":"markdown","8adde49a":"markdown","ce48ea6e":"markdown","a937c31f":"markdown","024467bb":"markdown","d104bc20":"markdown","51426897":"markdown","65b0c8e9":"markdown","70207f45":"markdown","6ada825a":"markdown","d5ecc7f7":"markdown","fa4667b3":"markdown","a72ae134":"markdown","9fe481a2":"markdown","40671a80":"markdown","1153a92c":"markdown","134f04c2":"markdown","5b561cf2":"markdown","9950d1e4":"markdown","789d413f":"markdown","64baae7a":"markdown","40c71d80":"markdown","524482a6":"markdown","454a4ed6":"markdown","464f3aac":"markdown","40180331":"markdown","e4180aeb":"markdown","6249247e":"markdown","a0301679":"markdown","86c3adb4":"markdown","39eb0c53":"markdown","febe1915":"markdown","d28931d0":"markdown","af67ddd5":"markdown","bba8dccf":"markdown","7f55602d":"markdown","3c9e152a":"markdown","68e1e6a2":"markdown","dc07c20c":"markdown","aa7a6154":"markdown","ff8858c0":"markdown","54eb6809":"markdown","09ac7921":"markdown"},"source":{"56f7a9af":"!pip install pycaret","9d1e68c7":"import pandas as pd \nimport numpy as np\npd.plotting.register_matplotlib_converters()\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\n%matplotlib inline\nsns.set(color_codes=True)\npal = sns.color_palette(\"viridis\", 10)\nsns.set_palette(pal)","e6e08d2b":"df = pd.read_csv('..\/input\/weather-data\/combined_data_from_2016_2019_with_out_extra_features.csv')","56f40970":"df.head()","13e5edbc":"df.isnull().sum()","380f5b48":"df.shape","e5c769ee":"df.head()","8e273264":"l=[]\nfor i in range (96,df.shape[0]):\n    l.append(df['GHI'][i])\n    \ndf.drop(list(range(df.shape[0]-96,df.shape[0])),inplace=True)\ndf['GHI_after_48_hours'] = l","c3258a1a":"df=df[df['Year']>2017]","046310a9":"df","e8d6cea1":"l=[]\nfor i in df['Minute']:\n    if i ==30:\n        l.append(0.5)\n    else:\n        l.append(0)\n        \ndf['Hour'] = df['Hour']+l","af23c985":"df.drop(['Clearsky GHI','GHI','Minute'],axis=1,inplace=True)","32639cd5":"plt.figure(figsize=(15,10))\nsns.heatmap(data= df.corr(), vmin=-1,vmax=1, cmap='coolwarm')","4bfc54c5":"sns.scatterplot(x='Hour',y='GHI_after_48_hours',data=df)","38657df2":"plt.figure(figsize=(10,8))\ndf[df.Month==1].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Jan')\ndf[df.Month==2].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Feb')\ndf[df.Month==3].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Mar')\ndf[df.Month==4].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Apr')\ndf[df.Month==5].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='May')\ndf[df.Month==6].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='June')\ndf[df.Month==7].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='July')\ndf[df.Month==8].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Aug')\ndf[df.Month==9].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Sep')\ndf[df.Month==10].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Oct')\ndf[df.Month==11].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Nov')\ndf[df.Month==12].groupby(['Hour']).GHI_after_48_hours.mean().plot(ylabel='Mean GHI',label='Dec')\nplt.legend()\nplt.title('Avg Future Hourly00 GHI in different Months')","804d41c8":"sns.violinplot(data=df,x='Month',y='GHI_after_48_hours')","8255480e":"df.groupby('Month').GHI_after_48_hours.mean().plot(kind='bar')","c0a2c1c5":"df[df['Year']==2018].groupby('Month').GHI_after_48_hours.mean().plot(kind='bar',title='2018')","7d925de4":"df[df['Year']==2019].groupby('Month').GHI_after_48_hours.mean().plot(kind='bar',title='2019')","d7a197ce":"df.groupby('Cloud Type')['Cloud Type'].count().plot(kind='pie')","815ac5ce":"df.groupby('Cloud Type')['Cloud Type'].count().plot(kind='bar',ylabel='Frequency')","de6bf785":"df.groupby('Cloud Type').GHI_after_48_hours.mean().plot(kind='bar',ylabel='Mean GHI')","8028de95":"sns.violinplot(data=df,x='Cloud Type',y='GHI_after_48_hours')","b49b3c73":"sns.displot(kind='hist', data=df, x= 'Dew Point')","e20956aa":"plt.figure(figsize=(8,6))\nsns.boxplot(data=df,x='Month', y='Dew Point')","e945c293":"df.groupby('Dew Point').GHI_after_48_hours.mean().sort_values(ascending=False).head(20)","01710550":"sns.displot(kind='hist',data=df, x='Solar Zenith Angle')","1178022b":"df.groupby('Solar Zenith Angle')['GHI_after_48_hours'].mean().sort_values(ascending=False).head(10)","059f49de":"df.groupby('Fill Flag')['Fill Flag'].count().plot(kind='pie')","f24ed098":"df.groupby('Fill Flag').GHI_after_48_hours.max().plot(kind='bar',ylabel='Mean GHI')","09956dc5":"sns.violinplot(data=df,x='Fill Flag',y='GHI_after_48_hours')","b3ecce85":"sns.displot(kind='kde',data=df,x='Surface Albedo')","3075edbc":"sns.boxplot(data=df,y='Surface Albedo')","6fab7d4a":"sns.displot(kind='hist',data=df,x='Wind Speed')","2fbc120b":"sns.boxplot(data=df, y='Wind Speed')","3497f664":"sns.boxplot(data=df, x='Month',y='Wind Speed')","dba16a67":"sns.displot(kind='hist',data=df,x='Precipitable Water')","b8d4506f":"sns.boxplot(data=df,y='Precipitable Water')","e2016dec":"sns.boxplot(data=df,y='Precipitable Water',x='Month')","ec937da9":"sns.displot(data=df,kind='hist',x='Wind Direction')","18ee641a":"df.groupby('Wind Direction')['GHI_after_48_hours'].mean().sort_values(ascending=False).head(10)","49f8f885":"sns.displot(kind='hist',data=df,x='Relative Humidity')","482da45d":"sns.boxplot(data=df,y='Relative Humidity')","e411e744":"sns.boxplot(data=df,x='Month',y='Relative Humidity')","c565056d":"df.groupby('Relative Humidity')['GHI_after_48_hours'].mean().sort_values(ascending=False).head(10)","30792d2e":"sns.displot(data=df,kind='hist',x='Temperature')","d77c451a":"sns.boxplot(data = df,y = 'Temperature')","bcbfa211":"sns.boxplot(data = df,x='Month',y = 'Temperature')","4bbdbf34":"df.groupby('Temperature')['GHI_after_48_hours'].mean().sort_values(ascending=False).head(10)","893adff7":"sns.displot(data=df,x='Pressure',kind='hist')","95346070":"plt.figure(figsize=(10,8))\ndf.groupby('Pressure')['GHI_after_48_hours'].mean().plot(kind='bar',ylabel='Mean GHI',title='Mean GHI vs Pressure')","903157a3":"\nX = df.drop(['Year'],axis=1)\ny= df['GHI_after_48_hours']\nX_train,  X_test, y_train, y_test = train_test_split(X,y,random_state=42, train_size=0.5)","ff9f4e04":"from pycaret.regression import *\nlog = setup(data=X_train, target='GHI_after_48_hours',train_size=0.8,\n            silent=True, feature_selection=True, create_clusters=True)","3652de7b":"compare_models()","63992bcb":"cb = create_model('catboost')","1c6d64b3":"lgbm = create_model('lightgbm')","57ee9eb5":"gbr = create_model('gbr')","40185c2a":"et = create_model('et')","b261ec5d":"xgb = create_model('xgboost')","73c89b5d":"blender = blend_models(estimator_list=[cb,lgbm,xgb])","f5b9193a":"stacker = stack_models(estimator_list=[cb,lgbm,xgb])","ab778a9f":"plot_model(cb)","8aea64e9":"plot_model(cb, plot='error')","6d9bd4b1":"plot_model(cb, plot='feature')","fcfd5f43":"plot_model(lgbm)","7de45da2":"plot_model(lgbm, plot='error')","6074ca68":"plot_model(gbr)","41c85758":"plot_model(xgb)","dca13626":"plot_model(et)","66593931":"plot_model(blender)","263a7eac":"plot_model(stacker)","831ec6e9":"interpret_model(cb)","629354e4":"from sklearn.metrics import r2_score\nmodels = [cb,lgbm,gbr,et,xgb,blender,stacker]\nmodels2 = ['cb','lgbm','gbr','et','xgb','blender','stacker']","57dc6315":"r2=[]\nfor i in models:\n    pred = predict_model(i, data=X_train.drop(['GHI_after_48_hours'],axis=1))\n    l=[]\n    for j in pred['Label']:\n        if j <0:\n            l.append(0)\n        else:\n            l.append(int(j))\n        \n    pred['Label'] = l\n\n    r2.append(r2_score(X_train['GHI_after_48_hours'],pred['Label']))\n    \ndf3 = pd.DataFrame({'Model':models2, 'Train_R2':r2})","822c2e1f":"df3.sort_values(by='Train_R2',ascending=False)","542fdb84":"r2=[]\nfor i in models:\n    pred2 = predict_model(i, data=X_test.drop(['GHI_after_48_hours'],axis=1))\n    l=[]\n    for j in pred2['Label']:\n        if j <0:\n            l.append(0)\n        else:\n            l.append(int(j))\n        \n    pred2['Label'] = l\n\n    r2.append(r2_score(X_test['GHI_after_48_hours'],pred2['Label']))\n    \ndf3 = pd.DataFrame({'Model':models2, 'Test_R2':r2})","83ab3960":"df3.sort_values(by='Test_R2',ascending=False)","eb449a8c":"def fun(l):\n    new_l=[]\n    for j in l:\n        if j <0:\n            new_l.append(0)\n        else:\n            new_l.append(int(j))\n        \n    return new_l","13cc325e":"df_comp = pd.DataFrame({'True GHI': X_test['GHI_after_48_hours'],'Predicted GHI':fun(predict_model(stacker,data=X_test.drop(['GHI_after_48_hours'],axis=1))['Label'])})\ndf_comp.head(40)","96ff7a1f":"save_model(stacker,'model')","0e9d8c72":"## Cloud Type","16b4d1ef":"## Wind Speed","8a960bc0":"## GBoost","9a4a8aa4":"### Trends over the years","3a9fe8e6":"### Task: Given Half hourly features for 2018 and 2019 Predict the GHI generated after 48 hours","1afe06cb":"### No null values","8f99062f":"### Predicted value comparison","9cf0080b":"> ### Cloud Type 2 is impacting the GHI very much","2931d723":"## LGBM","0d0ccfa9":"### EDA Finished","a71c193b":"## Global Horizontal Irradiance (GHI)\n>### The radiation reaching the earth's surface can be represented in a number of different ways. Global Horizontal Irradiance (GHI) is the total amount of shortwave radiation received from above by a surface horizontal to the ground.","559f780b":"## Surface Albedo","eeaa11aa":"### Higher Temperatures are mainly responsible for higher GHI, which is as expected, \n### Thats why Most GHI is recorede in May-April because those months recorded highest avg Temperatures","a98f75d7":"## Blend of CatBoost, LGBM , XGB","92a88d01":"## Blender","3a22893a":"## Fill Flag","8adde49a":"## Extra Tree","ce48ea6e":"> ## Catboost Regressor is the Most accurate model according to R2 value","a937c31f":"### Top 10 Mean GHI Forecast Recorded with **130-150** angles","024467bb":"> ### Test\/Holdout Set R2_score","d104bc20":"## Stacker","51426897":"### Setup (Dividing the dataset into 50-50 test train ratio for efficient results)","65b0c8e9":"## XGboost","70207f45":"### Further dividing the train set into train and dev set into 80-20 ratio","6ada825a":"### Building individual and Blend of top ","d5ecc7f7":"## Wind Direction","fa4667b3":"> ### This Shows That Lower Humidities will Have positive impact on GHI in Future","a72ae134":"> ### 13-14 degrees has high impact","9fe481a2":"### So over the years the highest mean GHI is recorded in June-July and lowest in December and January","40671a80":"# Interpreting Model","1153a92c":"## Precipitable Water","134f04c2":"### As You can see Tempertur trend is Normal, Most fluctuations are in July due to Monsoons","5b561cf2":"# Analysing Models","9950d1e4":"# Saving Model","789d413f":"### Model Selection","64baae7a":"# Model Building ","40c71d80":"## Temperature","524482a6":"### Month","454a4ed6":"> ### As Expected Most precioitation in July ","464f3aac":"## Solar Zenith Angle","40180331":"> ### Training set R2_score","e4180aeb":"## Relative Humidity","6249247e":"## Pressure","a0301679":"## Check Corelation","86c3adb4":"> ### Negative Dew Points tend to give High GHI after 48 Hours","39eb0c53":"> ## We can understand with the help of SHAP value how high and low values of a feature affect the predictions","febe1915":"### Constructing Future GHI Feature(after 48 h)","d28931d0":"> ","af67ddd5":"### As we can see due to skewed data it is showing noisy outliers","bba8dccf":"## Stack Model","7f55602d":"## Catboost","3c9e152a":"### For Model building and Selection we will use automated Library Pycaret \ud83e\udd55","68e1e6a2":"## Checking for null values","dc07c20c":"### We can see that this model has overfitted the data alot, so we will not use it in Blend or stack Model","aa7a6154":"## DEW POINT","ff8858c0":"### Month of July showing more 0 and lower values because of possible rainy season and CLOUD cover","54eb6809":"> ### cloud type 2 has more impact on future GHI values ","09ac7921":"### It's overfitting train data a little"}}