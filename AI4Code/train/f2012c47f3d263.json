{"cell_type":{"e70dced2":"code","1ddca6ee":"code","6f4d6aaa":"code","2b7b2f50":"code","9fd1ae91":"code","2ecea50b":"code","1df54838":"code","e5e4b21c":"code","a1c63930":"code","3d73c6fd":"code","1279ea51":"code","4542696b":"code","18dc7af3":"code","14bbd1e1":"code","06504a64":"code","eda1158e":"code","965d12a1":"code","8f9a2350":"code","c61ee4f0":"code","f0ef172f":"code","acc52233":"code","53befd0c":"code","42f61743":"code","d645c436":"code","3fd1f686":"code","2706da26":"code","13672bd9":"code","ec81c92d":"code","329d7b00":"code","f9bc15c3":"code","d1ab8b7c":"code","e0c83d07":"code","3c359617":"code","63777af5":"code","1d9c6937":"code","2687fd69":"code","7d5d43c0":"code","671b5372":"code","88cc9d90":"code","34a0562d":"code","5187801b":"code","622fc3ab":"code","1e9dfcbc":"code","9ec84e9e":"code","f09b878b":"code","875c7875":"code","7ab6c8cc":"code","20ee256b":"code","5937a400":"code","ee08956c":"code","1ef1a9c7":"code","d2b6bea7":"code","18da8af8":"code","00a95f93":"code","9e723b84":"code","748e75da":"code","fcf1cb7a":"code","c3ccf5f0":"code","2059b617":"code","01ab9b1f":"code","5ea4b3f9":"code","b65e697c":"code","6576cc50":"code","0f5f5c68":"code","18961180":"code","9c6172c1":"code","bfa9d10f":"code","9d87c1f2":"code","aa44e1d2":"code","00565e73":"code","c2d8ffa6":"code","ef682a60":"code","293662d2":"code","c6b64420":"code","209fac52":"code","8a1b67ec":"code","37c534ff":"code","4afb4262":"code","8aea1a34":"code","de3b38f9":"code","8a7d10bb":"code","c596effd":"code","da5fd556":"markdown","c80e140e":"markdown","f7135f65":"markdown","d0674898":"markdown","89902adc":"markdown","594d1bf5":"markdown","5924a04f":"markdown","7fa7d0f4":"markdown","aa74faa6":"markdown","943ea539":"markdown","51534690":"markdown","6c554c65":"markdown","766bb769":"markdown","d880f3ff":"markdown","b80b4f58":"markdown","3899002a":"markdown","d6d2d9a7":"markdown","414af4d8":"markdown","9a679233":"markdown","c01df470":"markdown","81b0f354":"markdown","6b28d18f":"markdown","1752016d":"markdown","17d8393f":"markdown","25cd4ed8":"markdown","1792053b":"markdown","3aa69ee6":"markdown","b38118a9":"markdown","4f84b505":"markdown","7e4285fb":"markdown","2d2b8bf4":"markdown","c0232507":"markdown","acac3716":"markdown","d0902593":"markdown","82ebb535":"markdown","316488d7":"markdown","c744e805":"markdown","d74a83fa":"markdown","30ee93d1":"markdown","6d904a69":"markdown","096791f3":"markdown","fdaa94f8":"markdown","a446f249":"markdown","17b016a5":"markdown","b9b16419":"markdown","09aa599a":"markdown","c47ce7ac":"markdown","f23e8b9f":"markdown","df874de5":"markdown","c9794197":"markdown","4edbf1d8":"markdown"},"source":{"e70dced2":"\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n        \n        \nloan_data = pd.read_csv('\/kaggle\/input\/lending-club-dataset\/lending_club_loan_two.csv')\n","1ddca6ee":"loan_data.info()","6f4d6aaa":"sns.countplot(x='loan_status',data=loan_data)","2b7b2f50":"loan_data['loan_status'].value_counts()","9fd1ae91":"plt.figure(figsize=(12,4))\nsns.distplot(loan_data['loan_amnt'],kde=False,bins=40)\nplt.xlim(0,45000)","2ecea50b":"#How features collerate to one another\nloan_data.corr()","1df54838":"plt.figure(figsize=(12,7))\nsns.heatmap(loan_data.corr(),annot=True,cmap='viridis')\nplt.ylim(10, 0)","e5e4b21c":"sns.scatterplot(x='installment',y='loan_amnt',data=loan_data)","a1c63930":"sns.boxplot(x='loan_status',y='loan_amnt',data=loan_data)","3d73c6fd":"loan_data.groupby('loan_status')['loan_amnt'].describe()","1279ea51":"sorted(loan_data['grade'].unique())","4542696b":"sorted(loan_data['sub_grade'].unique())","18dc7af3":"sns.countplot(x='grade',data=loan_data,hue='loan_status')","14bbd1e1":"plt.figure(figsize=(12,4))\nsubgrade_order = sorted(loan_data['sub_grade'].unique())\nsns.countplot(x='sub_grade',data=loan_data,order = subgrade_order,palette='coolwarm' )","06504a64":"plt.figure(figsize=(12,4))\nsubgrade_order = sorted(loan_data['sub_grade'].unique())\nsns.countplot(x='sub_grade',data=loan_data,order = subgrade_order,palette='coolwarm' ,hue='loan_status')","eda1158e":"f_and_g = loan_data[(loan_data['grade']=='G') | (loan_data['grade']=='F')]\n\nplt.figure(figsize=(12,4))\nsubgrade_order = sorted(f_and_g['sub_grade'].unique())\nsns.countplot(x='sub_grade',data=f_and_g,order = subgrade_order,hue='loan_status')","965d12a1":"loan_data['loan_status'].unique()","8f9a2350":"loan_data['loan_repaid'] = loan_data['loan_status'].map({'Fully Paid':1,'Charged Off':0})","c61ee4f0":"loan_data[['loan_repaid','loan_status']]","f0ef172f":"#Let's start by showing sum of missing data\nloan_data.isnull().sum()","acc52233":"#By percentage of dataframe, missing data are\n100* loan_data.isnull().sum()\/len(loan_data)","53befd0c":"loan_data['emp_title'].nunique()","42f61743":"loan_data['emp_title'].value_counts()","d645c436":"loan_data=loan_data.drop('emp_title', axis=1)","3fd1f686":"#Let's create the count plot of the emp_length column by sorting firdt the order of the values\nsorted(loan_data['emp_length'].dropna().unique())","2706da26":"emp_length_order = [ '< 1 year',\n                      '1 year',\n                     '2 years',\n                     '3 years',\n                     '4 years',\n                     '5 years',\n                     '6 years',\n                     '7 years',\n                     '8 years',\n                     '9 years',\n                     '10+ years']","13672bd9":"plt.figure(figsize=(12,4))\n\nsns.countplot(x='emp_length',data=loan_data,order=emp_length_order)","ec81c92d":"plt.figure(figsize=(12,4))\nsns.countplot(x='emp_length',data=loan_data,order=emp_length_order,hue='loan_status')","329d7b00":"emp_co = loan_data[loan_data['loan_status']==\"Charged Off\"].groupby(\"emp_length\").count()['loan_status']","f9bc15c3":"emp_fp = loan_data[loan_data['loan_status']==\"Fully Paid\"].groupby(\"emp_length\").count()['loan_status']","d1ab8b7c":"emp_len = emp_co\/emp_fp\nemp_len","e0c83d07":"emp_len.plot(kind='bar')","3c359617":"loan_data=loan_data.drop('emp_length',axis=1)","63777af5":"loan_data.isnull().sum()","1d9c6937":"loan_data['purpose'].head(10)","2687fd69":"loan_data['title'].head(10)","7d5d43c0":"loan_data=loan_data.drop('title',axis=1)","671b5372":"loan_data['mort_acc'].value_counts()","88cc9d90":"print(\"Correlation with the mort_acc column\")\nloan_data.corr()['mort_acc'].sort_values()","34a0562d":"print(\"Mean of mort_acc column per total_acc\")\nloan_data.groupby('total_acc').mean()['mort_acc']","5187801b":"total_acc_avg =loan_data.groupby('total_acc').mean()['mort_acc']","622fc3ab":"def fill_mort_acc(total_acc,mort_acc):\n    '''\n    Accepts the total_acc and mort_acc values for the row.\n    Checks if the mort_acc is NaN , if so, it returns the avg mort_acc value\n    for the corresponding total_acc value for that row.\n    \n    total_acc_avg here should be a Series or dictionary containing the mapping of the\n    groupby averages of mort_acc per total_acc values.\n    '''\n    if np.isnan(mort_acc):\n        return total_acc_avg[total_acc]\n    else:\n        return mort_acc","1e9dfcbc":"loan_data['mort_acc'] = loan_data.apply(lambda x: fill_mort_acc(x['total_acc'], x['mort_acc']), axis=1)","9ec84e9e":"loan_data.isnull().sum()","f09b878b":"loan_data=loan_data.dropna()","875c7875":"loan_data.isnull().sum()","7ab6c8cc":"print('The categorical variables are:')\nloan_data.select_dtypes(['object']).columns","20ee256b":"loan_data['term'].value_counts()","5937a400":"loan_data['term'] = loan_data['term'].apply(lambda term: int(term[:3]))","ee08956c":"loan_data=loan_data.drop('grade',axis=1)","1ef1a9c7":"subgrade_dummies = pd.get_dummies(loan_data['sub_grade'],drop_first=True)","d2b6bea7":"loan_data = pd.concat([loan_data.drop('sub_grade',axis=1),subgrade_dummies],axis=1)","18da8af8":"loan_data.columns","00a95f93":"loan_data.select_dtypes(['object']).columns","9e723b84":"dummies = pd.get_dummies(loan_data[['verification_status', 'application_type','initial_list_status','purpose' ]],drop_first=True)\nloan_data = loan_data.drop(['verification_status', 'application_type','initial_list_status','purpose'],axis=1)\n","748e75da":"loan_data = pd.concat([loan_data,dummies],axis=1)","fcf1cb7a":"loan_data['home_ownership'].value_counts()","c3ccf5f0":"loan_data['home_ownership']=loan_data['home_ownership'].replace(['NONE', 'ANY'], 'OTHER')\n\ndummies = pd.get_dummies(loan_data['home_ownership'],drop_first=True)\nloan_data = loan_data.drop('home_ownership',axis=1)\nloan_data = pd.concat([loan_data,dummies],axis=1)","2059b617":"loan_data['zip_code'] = loan_data['address'].apply(lambda address:address[-5:])","01ab9b1f":"dummies = pd.get_dummies(loan_data['zip_code'],drop_first=True)\nloan_data = loan_data.drop(['zip_code','address'],axis=1)\nloan_data = pd.concat([loan_data,dummies],axis=1)","5ea4b3f9":"loan_data=loan_data.drop('issue_d',axis=1)","b65e697c":"loan_data['earliest_cr_year'] = loan_data['earliest_cr_line'].apply(lambda date:int(date[-4:]))\nloan_data = loan_data.drop('earliest_cr_line',axis=1)","6576cc50":"loan_data.select_dtypes(['object']).columns","0f5f5c68":"loan_data = loan_data.drop('loan_status',axis=1)","18961180":"from sklearn.model_selection import train_test_split","9c6172c1":"X= loan_data.drop('loan_repaid',axis=1).values\ny = loan_data['loan_repaid'].values","bfa9d10f":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.20, random_state=101)","9d87c1f2":"from sklearn.preprocessing import MinMaxScaler","aa44e1d2":"scaler = MinMaxScaler()","00565e73":"X_train = scaler.fit_transform(X_train)","c2d8ffa6":"X_test = scaler.transform(X_test)","ef682a60":"import tensorflow as tf\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense, Activation,Dropout\nfrom tensorflow.keras.constraints import max_norm","293662d2":"model = Sequential()\n\n# input layer\nmodel.add(Dense(78,  activation='relu'))\nmodel.add(Dropout(0.2))\n\n# hidden layer\nmodel.add(Dense(39, activation='relu'))\nmodel.add(Dropout(0.2))\n\n# hidden layer\nmodel.add(Dense(19, activation='relu'))\nmodel.add(Dropout(0.2))\n\n# output layer\nmodel.add(Dense(units=1,activation='sigmoid'))\n\n# Compile model\nmodel.compile(loss='binary_crossentropy', optimizer='adam')","c6b64420":"model.fit(x=X_train, \n          y=y_train, \n          epochs=25,\n          batch_size=256,\n          validation_data=(X_test, y_test), \n          )","209fac52":"losses = pd.DataFrame(model.history.history)","8a1b67ec":"losses[['loss','val_loss']].plot()","37c534ff":"from sklearn.metrics import classification_report,confusion_matrix","4afb4262":"predictions = model.predict_classes(X_test)","8aea1a34":"print(classification_report(y_test,predictions))","de3b38f9":"confusion_matrix(y_test,predictions)","8a7d10bb":"import random\nrandom.seed(101) ##Keeping same random numbers \nrandom_ind = random.randint(0,len(loan_data))\n\nnew_customer = loan_data.drop('loan_repaid',axis=1).iloc[random_ind]\nnew_customer","c596effd":"model.predict_classes(new_customer.values.reshape(1,78))","da5fd556":"Looks like the total_acc feature correlates with the mort_acc , this makes sense! Let's try this fillna() approach. We will group the dataframe by the total_acc and calculate the mean value for the mort_acc per total_acc entry","c80e140e":"This tell us that chargeoff rates are extremely similar across all empleoyment lenths. Let's drop it","f7135f65":"# Ownership!","d0674898":"Let's examine emp_title and emp_length to see whether it will be okay to drop them. 'emp_title' is the job title supplied by the Borrower when applying for the loan.*\n\n\n'emp_length' is employment length in years. Possible values are between 0 and 10 where 0 means less than one year and 10 means ten or more years. \n","89902adc":"Let us convert these to dummy variables, but replace NONE and ANY with OTHER, so that we end up with just 4 categories, MORTGAGE, RENT, OWN, OTHER. Then concatenate them with the original dataframe.","594d1bf5":"Let's explore the Grade and SubGrade columns that LendingClub attributes to the loans. We will find the unique possible grades and subgrades.","5924a04f":"I used some ideas from Pierian Data Course of [Data Science and Machine learning](https:\/\/www.pieriandata.com\/p\/python-for-data-science-and-machine-learning-bootcamp)","7fa7d0f4":"The mort_acc feature represents the number of mortgage accounts.\n","aa74faa6":"Let us review the value_counts for the home_ownership column.","943ea539":"earliest_cr_line appears to be a historical time stamp feature. Extract the year from this feature","51534690":"The model did well on the test set, and achieved good accuracy. ","6c554c65":"# Loan Pay Back Prediction - Lending Club","766bb769":"There we see that 318,357 paid their loan back. This means that there is 80% chance that a borrower can pay back the loan. We want to use model that predict who that might be.","d880f3ff":"![](http:\/\/)Let's convert term feature into either 30 or 60 integer numeric data type","b80b4f58":"As there are to many job titles, let's remove the column out of our dataset","3899002a":"# Evaluating Model Performance","d6d2d9a7":"# Loading the Data and relevant libraries","414af4d8":"Model tested on new customer showed that he would repay back the loan. \n","9a679233":"It seems that subgrade F and G don't pay back the loan. Let's isolate them","c01df470":"Let's create a new column called 'load_repaid' which will contain a 1 if the loan status was \"Fully Paid\" and a 0 if it was \"Charged Off\".","81b0f354":" **Notebook Contents**\n\n* Introduction\n* Data Overview\n* Loading the data and importing relevant libraries\n* Exploratory Data Analysis\n* Data preprocessing\n* Evaluating Model Performance\n","6b28d18f":"Let us drop issue date","1752016d":"As we are predicting loan payback, let's plot current loan status","17d8393f":"Installment correlates with the loan amount. Let's keep exploring this to see their relationship. Back to data overview, installment is the monthly payment owed by the borrower if the loan originates. And the loan amount is the listed amount of the loan applied for by the borrower. If at some point in time, the credit department reduces the loan amount, then it will be reflected in this value.\n","25cd4ed8":"Now we see that it is likely that most people who paid the loan were employed in 10 years, and it is true as these are people who are able to pay","1792053b":"In this section, we will perform actions on missing data, categorical data and dummy variables","3aa69ee6":"**It's time to split test and train data**","b38118a9":"# **Introduction**","4f84b505":"In this section, we will get an understanding for which variables are important, and visualize data","7e4285fb":"On histogram above we see that all loans fall under 35,000, and many people take 10,000.","2d2b8bf4":"# Exploratory Data Analysis","c0232507":"----\n-----\nHere are the details of this dataset:\n\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th><\/th>\n      <th>LoanStatNew<\/th>\n      <th>Description<\/th>\n    <\/tr>\n  <\/thead>\n  <tbody>\n    <tr>\n      <th>0<\/th>\n      <td>loan_amnt<\/td>\n      <td>The listed amount of the loan applied for by the borrower. If at some point in time, the credit department reduces the loan amount, then it will be reflected in this value.<\/td>\n    <\/tr>\n    <tr>\n      <th>1<\/th>\n      <td>term<\/td>\n      <td>The number of payments on the loan. Values are in months and can be either 36 or 60.<\/td>\n    <\/tr>\n    <tr>\n      <th>2<\/th>\n      <td>int_rate<\/td>\n      <td>Interest Rate on the loan<\/td>\n    <\/tr>\n    <tr>\n      <th>3<\/th>\n      <td>installment<\/td>\n      <td>The monthly payment owed by the borrower if the loan originates.<\/td>\n    <\/tr>\n    <tr>\n      <th>4<\/th>\n      <td>grade<\/td>\n      <td>LC assigned loan grade<\/td>\n    <\/tr>\n    <tr>\n      <th>5<\/th>\n      <td>sub_grade<\/td>\n      <td>LC assigned loan subgrade<\/td>\n    <\/tr>\n    <tr>\n      <th>6<\/th>\n      <td>emp_title<\/td>\n      <td>The job title supplied by the Borrower when applying for the loan.*<\/td>\n    <\/tr>\n    <tr>\n      <th>7<\/th>\n      <td>emp_length<\/td>\n      <td>Employment length in years. Possible values are between 0 and 10 where 0 means less than one year and 10 means ten or more years.<\/td>\n    <\/tr>\n    <tr>\n      <th>8<\/th>\n      <td>home_ownership<\/td>\n      <td>The home ownership status provided by the borrower during registration or obtained from the credit report. Our values are: RENT, OWN, MORTGAGE, OTHER<\/td>\n    <\/tr>\n    <tr>\n      <th>9<\/th>\n      <td>annual_inc<\/td>\n      <td>The self-reported annual income provided by the borrower during registration.<\/td>\n    <\/tr>\n    <tr>\n      <th>10<\/th>\n      <td>verification_status<\/td>\n      <td>Indicates if income was verified by LC, not verified, or if the income source was verified<\/td>\n    <\/tr>\n    <tr>\n      <th>11<\/th>\n      <td>issue_d<\/td>\n      <td>The month which the loan was funded<\/td>\n    <\/tr>\n    <tr>\n      <th>12<\/th>\n      <td>loan_status<\/td>\n      <td>Current status of the loan<\/td>\n    <\/tr>\n    <tr>\n      <th>13<\/th>\n      <td>purpose<\/td>\n      <td>A category provided by the borrower for the loan request.<\/td>\n    <\/tr>\n    <tr>\n      <th>14<\/th>\n      <td>title<\/td>\n      <td>The loan title provided by the borrower<\/td>\n    <\/tr>\n    <tr>\n      <th>15<\/th>\n      <td>zip_code<\/td>\n      <td>The first 3 numbers of the zip code provided by the borrower in the loan application.<\/td>\n    <\/tr>\n    <tr>\n      <th>16<\/th>\n      <td>addr_state<\/td>\n      <td>The state provided by the borrower in the loan application<\/td>\n    <\/tr>\n    <tr>\n      <th>17<\/th>\n      <td>dti<\/td>\n      <td>A ratio calculated using the borrower\u2019s total monthly debt payments on the total debt obligations, excluding mortgage and the requested LC loan, divided by the borrower\u2019s self-reported monthly income.<\/td>\n    <\/tr>\n    <tr>\n      <th>18<\/th>\n      <td>earliest_cr_line<\/td>\n      <td>The month the borrower's earliest reported credit line was opened<\/td>\n    <\/tr>\n    <tr>\n      <th>19<\/th>\n      <td>open_acc<\/td>\n      <td>The number of open credit lines in the borrower's credit file.<\/td>\n    <\/tr>\n    <tr>\n      <th>20<\/th>\n      <td>pub_rec<\/td>\n      <td>Number of derogatory public records<\/td>\n    <\/tr>\n    <tr>\n      <th>21<\/th>\n      <td>revol_bal<\/td>\n      <td>Total credit revolving balance<\/td>\n    <\/tr>\n    <tr>\n      <th>22<\/th>\n      <td>revol_util<\/td>\n      <td>Revolving line utilization rate, or the amount of credit the borrower is using relative to all available revolving credit.<\/td>\n    <\/tr>\n    <tr>\n      <th>23<\/th>\n      <td>total_acc<\/td>\n      <td>The total number of credit lines currently in the borrower's credit file<\/td>\n    <\/tr>\n    <tr>\n      <th>24<\/th>\n      <td>initial_list_status<\/td>\n      <td>The initial listing status of the loan. Possible values are \u2013 W, F<\/td>\n    <\/tr>\n    <tr>\n      <th>25<\/th>\n      <td>application_type<\/td>\n      <td>Indicates whether the loan is an individual application or a joint application with two co-borrowers<\/td>\n    <\/tr>\n    <tr>\n      <th>26<\/th>\n      <td>mort_acc<\/td>\n      <td>Number of mortgage accounts.<\/td>\n    <\/tr>\n    <tr>\n      <th>27<\/th>\n      <td>pub_rec_bankruptcies<\/td>\n      <td>Number of public record bankruptcies<\/td>\n    <\/tr>\n  <\/tbody>\n<\/table>\n\n---\n----","acac3716":"Now is the time to deal with categorical values and dummy variables","d0902593":"Let us test the model for new customer","82ebb535":"Let us deal with the missing data. Firstly, we can check other features which correlate with it","316488d7":"Let's display a count plot per subgrade.","c744e805":"# Data PreProcessing","d74a83fa":"Our goal is to use dataset provided to build a model that predict wether or not the borrower will pay back the loan. The model can help assess new borrowers if they will be able to pay the loan based on their historical information. \n\n","30ee93d1":"As we already know that the grade is part of sub_grade, let's drop the feature off. ","6d904a69":"LendingClub is the world's largest peer-to-peer lending platform located in San Francisco, California, United States. ","096791f3":"Mortage account outperforms all feature in missing data. Also, we have missing data in columns of Employment title, Employment length, title, revol_util, and pub_rec_bankruptcies","fdaa94f8":"# Creating the Model","a446f249":"Let's review the title and the purpose column. Is there any repeated information?","17b016a5":"Let us now convert the subgrade into dummy variables. Then concatenate these new columns to the original dataframe.","b9b16419":"# Data Overview","09aa599a":"# Thank you!!","c47ce7ac":"Let us create predictions from the X_test set and display a classification report and confusion matrix for the X_test set.","f23e8b9f":"Let's again see relationship between loan amount and loan status","df874de5":"Let's feature engineer a zip code column from the address in the data set. Create a column called 'zip_code' that extracts the zip code from the address column.","c9794197":"revol_util and the pub_rec_bankruptcies have missing data points, but they account for less than 0.5% of the total data. Let's drop the missing values off only","4edbf1d8":"It's seems that title and purpose columns are repeated information. Let's drop title out"}}