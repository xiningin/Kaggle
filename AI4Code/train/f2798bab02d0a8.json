{"cell_type":{"06977146":"code","eeaad213":"markdown","39a74928":"markdown"},"source":{"06977146":"from pyspark.sql.functions import *\nfrom statsmodels.tsa.arima.model import ARIMA\nfrom sklearn.metrics import mean_squared_error\nfrom math import sqrt\nimport pandas as pd\nfrom pyspark.sql.types import *\n\n#read data \nprod_demand_df = read(\"TimeSeries_ElectricProduction.ElectricProduction\")\n#explore data\nprod_demand_df.printSchema()\nprod_demand_df.show(10)\nprod_demand_df.count()\n\n\n#I found the date is recognized as string \n#I tried to covert Date in string to a date for pandas\nprod_demand_df = prod_demand_df.withColumn('Date_date',to_date(prod_demand_df.DATE, 'MM-dd-yyyy')).drop(prod_demand_df.DATE)\nprod_demand_df.printSchema()\nprod_demand_df.show(10)\n#convert spark dataframe to pandas dataframe\npdf = prod_demand_df.toPandas()\n\n# Check the format of 'Date' column\npdf.info()\n\n#spark dataframe with the datatype still recognized as object \n# convert the 'Date' column to datetime format\npdf['Date_date'] = pdf['Date_date'].astype('datetime64[ns]')\n \n# Check the format of 'Date' column\npdf.info()\n\n\n#set index \npdf.set_index(pd.DatetimeIndex(pdf['Date_date']))\ncutoff_date  = \"01-01-2017\"\nbefore_cutoff = pdf[\"Date_date\"] < cutoff_date\nafter_cutoff = pdf[\"Date_date\"] >= cutoff_date\n\ntrain = pdf.loc[before_cutoff]\ntrain.tail(10)\ntrain.info()\nprint(type(train))\n##ts = pd.Series(train['Value'].values, index=train['Date_date'])\nmodel = ARIMA(train['Value'], order=(5,1,0))\nmodel_fit = model.fit()\nmodel_fit.summary()\ntrain['forecast']=model_fit.predict(start=372,end=384,dynamic=True)\n\ntrain['forecast']\ntrain\ntest = pdf.loc[after_cutoff]\ntest \ntest['forecast']=model_fit.predict(start=384,end=396,dynamic=True)\ntest['forecast']\ntest\n#combined train and test dataframes\npdf_with_forecast = pd.concat([train, test])\npdf_with_forecast\nresult_df = spark.createDataFrame(pdf_with_forecast)\nresult_df.printSchema()\n\nresult_df.show(400)\nsave(result_df)","eeaad213":"### Here is the result in Incorta. The blue line showing original data, and the green line showing predict electric production. \n![this is a pic](https:\/\/1.bp.blogspot.com\/-GPqDplYRrPQ\/YIjv3scG-nI\/AAAAAAAAAs0\/E7mHXeSJ090v7X0lHXJksBl8eoQWENknwCLcBGAsYHQ\/s16000\/Screen%2BShot%2B2021-04-27%2Bat%2B10.16.45%2BPM.png)","39a74928":"## I'm using time series analysis electric production by ARIMA model"}}