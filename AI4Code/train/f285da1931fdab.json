{"cell_type":{"af95acf6":"code","3ed867df":"code","470f901c":"code","43ee1716":"code","5dea51ba":"code","d7f50179":"code","903a6dbe":"code","ea1d7bce":"code","a6105840":"code","70943dd0":"code","36c8ee07":"code","e5b1884c":"code","c4c9b134":"code","940ee913":"code","ddadf1bf":"code","7201c8c0":"code","9df82f00":"code","fbb82712":"code","55f5e700":"code","42934ee7":"code","6e31e603":"code","e59b5a95":"code","f644925f":"code","5fb5a782":"code","1df52538":"code","e8e33868":"code","7dfc0981":"code","07256b80":"code","0d719a23":"code","c5626a0c":"code","e1b76705":"code","91e9e762":"code","eea8b838":"code","0a8da908":"code","498e991d":"code","d9998693":"code","5ea1b393":"code","00e2175d":"code","f1f86e3b":"code","ed614bc1":"code","fcec0c6e":"code","b421b6b0":"code","ea8cfe37":"code","f54fa226":"code","d5b0f153":"code","f039f03d":"code","2f0f15e0":"code","e77426e4":"code","f9bd8cfb":"code","211bbf84":"code","3ff534a2":"code","48c9240a":"code","b43d1464":"code","f8a8fe19":"markdown","619473ee":"markdown","b0cc5534":"markdown","361a2e0f":"markdown","bad30415":"markdown","98b19b4d":"markdown","ab6c80cd":"markdown","10b9207c":"markdown","23973f7e":"markdown","abb4a404":"markdown","efb48f79":"markdown","d91934f6":"markdown","ce081e16":"markdown","c044180f":"markdown","a2d6111e":"markdown","2fbbf0c1":"markdown","ded1828a":"markdown","335385dd":"markdown","86a6b8ee":"markdown","f09cd0ac":"markdown","32040e30":"markdown","ad686e97":"markdown","55f05eb1":"markdown","4dab36ab":"markdown","aeba7535":"markdown","64197517":"markdown"},"source":{"af95acf6":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom sklearn.dummy import DummyClassifier\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.metrics import f1_score\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.model_selection import RandomizedSearchCV\nfrom sklearn.preprocessing import OrdinalEncoder\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# machine learning\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.svm import SVC, LinearSVC\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.linear_model import Perceptron\nfrom sklearn.linear_model import SGDClassifier\nfrom sklearn.tree import DecisionTreeClassifier\n\n\n\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","3ed867df":"def fills_good(data, main_column, function, group_columns):\n    \"\"\"Function for filling in missing values\n\n    To use the function, you must pass it\n    the following arguments:\n\n    data - an array of data in which you need to fill in the gaps;\n    main_column - the column in which the values are omitted;\n    function - the value of the function that will be used when\n    filling in empty values in quotes ('mean','median'...);\n    group_columns - columns for grouping data as an array [...]\n    filling in the gaps will be performed according to\n    grouped by the specified columns.\n    \"\"\"\n    \n    data[main_column] = data[main_column].fillna(data.groupby(group_columns)[main_column].transform(function))\n    \n    return data[main_column]","470f901c":"test_df = pd.read_csv('..\/input\/titanic\/test.csv')\ntrain_df = pd.read_csv('..\/input\/titanic\/train.csv')\ntest_target = pd.read_csv('..\/input\/titanic\/gender_submission.csv')","43ee1716":"test_concat = pd.merge(test_df, test_target, on='PassengerId')","5dea51ba":"test_concat","d7f50179":"main_df = pd.concat([train_df,test_concat], ignore_index= True,)","903a6dbe":"main_df","ea1d7bce":"main_df = pd.get_dummies(main_df, columns=['Sex'],drop_first=True)\nmain_df = main_df.rename(columns={'Sex_male':'Sex'})","a6105840":"display(main_df.head())\nprint('-'*40)\n","70943dd0":"main_df.info()\nprint('-'*40)\nmain_df.describe()\n","36c8ee07":"sns.set(palette='BuGn_r')\nfig = plt.figure(figsize = (12,9))\nsns.histplot(main_df[\"Age\"], kde=True)\nplt.title('Age hist')\nplt.show()","e5b1884c":"sns.pairplot(main_df[['Age', 'Survived', 'Pclass', 'SibSp', 'Parch', 'Sex']],palette='CMRmap_r')\nplt.show()\n\n","c4c9b134":"main_df['Age'] = fills_good(main_df, 'Age', 'median', ['Pclass', 'SibSp', 'Parch', 'Embarked', 'Sex'])\nmain_df['Age'] = main_df['Age'].fillna(main_df['Age'].median())","940ee913":"main_df.info()","ddadf1bf":"fig = plt.figure(figsize = (12,9))\nsns.histplot(main_df[\"Age\"], kde=True, palette='BuPu_r')\nplt.title('Age hist after filling')\nplt.show()","7201c8c0":"fig, ax = plt.subplots(figsize=(10,10))\ncolors = sns.color_palette(\"Accent\")\nax.pie(main_df[\"Embarked\"].value_counts(), labels=main_df[\"Embarked\"].value_counts().index, autopct='%.0f%%', colors = colors)\nax.set_title('Survery responses')\nplt.show()","9df82f00":"main_df['Embarked'] = main_df['Embarked'].fillna('S')\nmain_df['Fare'] = main_df['Fare'].fillna(main_df['Fare'].median())","fbb82712":"main_df = main_df.drop(labels='Cabin', axis=1)","55f5e700":"main_df.info()\nprint('-'*40)\ndisplay(main_df.describe())\nprint('-'*40)\ndisplay(main_df.describe(include=['O']))","42934ee7":"main_df[['Pclass', 'Survived']].groupby(['Pclass'], as_index=False).mean().sort_values(by='Survived', ascending=False)","6e31e603":"main_df[['Sex', 'Survived']].groupby(['Sex'], as_index=False).mean().sort_values(by='Survived', ascending=False)","e59b5a95":"main_df[['Embarked', 'Survived']].groupby(['Embarked'], as_index=False).mean().sort_values(by='Survived', ascending=False)","f644925f":"main_df[['SibSp', 'Survived']].groupby(['SibSp'], as_index=False).mean().sort_values(by='Survived', ascending=False)","5fb5a782":"main_df[['Parch', 'Survived']].groupby(['Parch'], as_index=False).mean().sort_values(by='Survived', ascending=False)","1df52538":"fig = sns.FacetGrid(main_df, \n                    col='Survived', \n                    height=5,\n                    palette='BuGn_r')\nfig.map(sns.histplot, 'Age',kde=True ,bins=20)\n","e8e33868":"grid = sns.FacetGrid(main_df, col='Survived', row='Sex',height=5)\ngrid.map(sns.histplot, 'Age', alpha=.5, bins=20, kde=True)\ngrid.add_legend()\n","7dfc0981":"grid = sns.FacetGrid(main_df, col='Survived', row='Pclass',height=5)\ngrid.map(sns.histplot, 'Age', alpha=.5, bins=20, kde=True)\ngrid.add_legend()","07256b80":"main_df = main_df.drop(['Name', 'Ticket'], axis=1)","0d719a23":"main_df","c5626a0c":"main_df['Age_group'] = pd.cut(main_df['Age'], 5)\nmain_df[['Age_group', 'Survived']].groupby(['Age_group'], as_index=False).mean().sort_values(by='Age_group', ascending=True)","e1b76705":"main_df.loc[ main_df['Age'] <= 16, 'Age'] = 0\nmain_df.loc[(main_df['Age'] > 16) & (main_df['Age'] <= 32), 'Age'] = 1\nmain_df.loc[(main_df['Age'] > 32) & (main_df['Age'] <= 48), 'Age'] = 2\nmain_df.loc[(main_df['Age'] > 48) & (main_df['Age'] <= 64), 'Age'] = 3\nmain_df.loc[ main_df['Age'] > 64, 'Age'] = 4 \nmain_df.Age = main_df.Age.astype('int')\nmain_df = main_df.drop('Age_group', axis=1)\nmain_df.head()","91e9e762":"main_df['Fare_group'] = pd.cut(main_df['Fare'], 5)\nmain_df[['Fare_group', 'Survived']].groupby(['Fare_group'], as_index=False).mean().sort_values(by='Fare_group', ascending=True)","eea8b838":"main_df.loc[ main_df['Fare'] <= 102, 'Fare'] = 0\nmain_df.loc[(main_df['Fare'] > 102) & (main_df['Fare'] <= 204), 'Fare'] = 1\nmain_df.loc[(main_df['Fare'] > 204) & (main_df['Fare'] <= 307), 'Fare'] = 2\nmain_df.loc[(main_df['Fare'] > 307) & (main_df['Fare'] <= 409), 'Fare'] = 3\nmain_df.loc[ main_df['Fare'] > 409, 'Fare'] = 4 \nmain_df.Age = main_df.Age.astype('int')\nmain_df = main_df.drop('Fare_group', axis=1)\nmain_df.head()","0a8da908":"main_df_ohe = pd.get_dummies(main_df, columns=['Pclass', 'SibSp','Fare', 'Age', 'Embarked'],drop_first=True)","498e991d":"main_df_ohe","d9998693":"test_df_ohe = main_df_ohe[main_df_ohe['PassengerId'].isin(test_df.PassengerId)]\ntrain_df_ohe = main_df_ohe[main_df_ohe['PassengerId'].isin(train_df.PassengerId)]\n","5ea1b393":"train_target = train_df_ohe['Survived']\ntrain_df_ohe = train_df_ohe.drop(['Survived', 'PassengerId'], axis = 1)","00e2175d":"test_df_ohe = test_df_ohe.drop(['Survived', 'PassengerId'], axis = 1)","f1f86e3b":"display(train_target.shape) \nprint(\"-\"*40)\ndisplay(train_df_ohe.shape ) \nprint(\"-\"*40)\ndisplay(test_df_ohe.shape) ","ed614bc1":"acc_models = pd.DataFrame()","fcec0c6e":"test_target = test_target.drop('PassengerId',axis=1)","b421b6b0":"model_LR = LogisticRegression()\nmodel_LR.fit(train_df_ohe, train_target)\npredict_LR = model_LR.predict(test_df_ohe)\nacc_LR = round(model_LR.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['LR', 'acc_score'] = acc_LR\nacc_models.loc['LR', 'target_score'] = round(model_LR.score(test_df_ohe, test_target) * 100, 2)\nacc_LR","ea8cfe37":"model_svc = SVC()\nmodel_svc.fit(train_df_ohe, train_target)\npredict_svc = model_svc.predict(test_df_ohe)\nacc_svc = round(model_svc.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['SVC', 'acc_score'] = acc_svc\nacc_models.loc['SVC', 'target_score'] = round(model_svc.score(test_df_ohe, test_target) * 100, 2)\nacc_svc","f54fa226":"model_knn = KNeighborsClassifier(n_neighbors = 3)\nmodel_knn.fit(train_df_ohe, train_target)\npredict_knn = model_knn.predict(test_df_ohe)\nacc_knn = round(model_knn.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['KNN', 'acc_score'] = acc_knn\nacc_models.loc['KNN', 'target_score'] = round(model_knn.score(test_df_ohe, test_target) * 100, 2)\n\nacc_knn","d5b0f153":"model_gaussian = GaussianNB()\nmodel_gaussian.fit(train_df_ohe, train_target)\npredict_gaussian = model_gaussian.predict(test_df_ohe)\nacc_gaussian = round(model_gaussian.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['GaussianNB', 'acc_score'] = acc_gaussian\nacc_models.loc['GaussianNB', 'target_score'] = round(model_gaussian.score(test_df_ohe, test_target) * 100, 2)\nacc_gaussian","f039f03d":"model_perceptron = Perceptron()\nmodel_perceptron.fit(train_df_ohe, train_target)\npredict_perceptron = model_perceptron.predict(test_df_ohe)\nacc_perceptron = round(model_perceptron.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['Perceptron', 'acc_score'] = acc_perceptron\nacc_models.loc['Perceptron', 'target_score'] = round(model_perceptron.score(test_df_ohe, test_target) * 100, 2)\n\nacc_perceptron","2f0f15e0":"model_linear_svc = LinearSVC()\nmodel_linear_svc.fit(train_df_ohe, train_target)\npredict_LinearSVC = model_linear_svc.predict(test_df_ohe)\nacc_linear_svc = round(model_linear_svc.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['LinearSVC', 'acc_score'] = acc_linear_svc\nacc_models.loc['LinearSVC', 'target_score'] = round(model_linear_svc.score(test_df_ohe, test_target) * 100, 2)\n\nacc_linear_svc","e77426e4":"model_sgd = SGDClassifier()\nmodel_sgd.fit(train_df_ohe, train_target)\npredict_sgd = model_sgd.predict(test_df_ohe)\nacc_sgd = round(model_sgd.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['SGD', 'acc_score'] = acc_sgd\nacc_models.loc['SGD', 'target_score'] = round(model_sgd.score(test_df_ohe, test_target) * 100, 2)\n\nacc_sgd","f9bd8cfb":"model_tree = DecisionTreeClassifier()\nmodel_tree.fit(train_df_ohe, train_target)\npredict_tree = model_tree.predict(test_df_ohe)\nacc_tree = round(model_tree.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['Tree', 'acc_score'] = acc_tree\nacc_models.loc['Tree', 'target_score'] = round(model_tree.score(test_df_ohe, test_target) * 100, 2)\n\nacc_tree","211bbf84":"model_RF = RandomForestClassifier(n_estimators=100)\nmodel_RF.fit(train_df_ohe, train_target)\npredict_RF = model_RF.predict(test_df_ohe)\nacc_RF = round(model_RF.score(train_df_ohe, train_target) * 100, 2)\nacc_models.loc['RF', 'acc_score'] = acc_RF\nacc_models.loc['RF', 'target_score'] = round(model_RF.score(test_df_ohe, test_target) * 100, 2)\n\nacc_RF","3ff534a2":"acc_models.sort_values(by='target_score', ascending=False)","48c9240a":"submission = pd.DataFrame({\n        \"PassengerId\": test_df[\"PassengerId\"],\n        \"Survived\": predict_LinearSVC\n    })\nsubmission.reset_index()","b43d1464":"submission.to_csv('submission.csv', index=False)","f8a8fe19":"We will fill in the gaps in the values in accordance with the grouping by various parameters, consider the correspondence of various parameters to the age of passengers","619473ee":"We will delete the Cabin column, since there are a lot of missing values in it, which cannot be filled in","b0cc5534":"## Importing libraries","361a2e0f":"## Training and selection of models","bad30415":"Missing values in columns:\n- Age\n- Fare\n- Cabin\n- Embarked\n","98b19b4d":"## As a result, we got a score in the leaderboard = 0.77990, undoubtedly there is retraining in the models we have developed, you can fight with it, as well as select hyperparameters, but this is my first experience in competitions and I would like to move on","ab6c80cd":"To fill in the gaps in \"Age\", we will use median values grouped by columns 'P class', 'Subsp', 'Perch'. The gaps that are not filled in according to three criteria will be grouped by the last two, then by the last one and the remaining ones by the total median value","10b9207c":"Delete the columns \"Name\", \"Ticket\"","23973f7e":"Let's compare the accuracy of the models","abb4a404":"Let's estimate the average survival rate depending on various parameters","efb48f79":"Interesting data can be obtained from visualizing the distribution of survivors based on the class of service.\n\nThe ratio of survivors to the dead in the first class is even more than 1, whereas in the third class most of the people did not survive the disaster. We see how the position in society and the well-being of passengers affected the survival rate in this disaster","d91934f6":"# EDA & Prediction for Titanic survive competition","ce081e16":"## Local functions","c044180f":"In the Age column","a2d6111e":"Age distributions based on survival in a disaster are similar, but there is one interesting point - there are noticeably more babies among the survivors than among the deceased","2fbbf0c1":"## Data analysis","ded1828a":"## Data import","335385dd":"There are about 3 times more women than men among the survivors, although there are 8 times more men than women among the deceased","86a6b8ee":"Preprocessing and data analysis will be carried out on a combined dataset to assess common patterns","f09cd0ac":"Fill in the values in the \"Fare\" and \"Embarked\" columns with the median and most common values","32040e30":"Discrete values will be evaluated using visual analysis","ad686e97":"Let's combine the data into one dataframe for analytical analysis","55f05eb1":"## Preparing data for building models","4dab36ab":"We will bring all the parameters to the same scale, divide the discrete variables into categories, then we will carry out the OHE procedure","aeba7535":"## Data preprocessing","64197517":"\n\n|Variable|Definition|Key|\n|--------|----------|---|\n|survival |\tSurvival |\t0 = No, 1 = Yes||\n|pclass \t|Ticket class \t|1 = 1st, 2 = 2nd, 3 = 3rd|\n|sex \t|Sex |\t|\n|Age |\tAge in years |\t|\n|sibsp \t|# of siblings \/ spouses aboard the Titanic |\t|\n|parch \t|# of parents \/ children aboard the Titanic |\t|\n|ticket \t|Ticket number| \t|\n|fare |\tPassenger fare |\t|\n|cabin| \tCabin number| \t|\n|embarked |\tPort of Embarkation| \tC = Cherbourg, Q = Queenstown, S = Southampton|\n"}}