{"cell_type":{"a1f9b182":"code","bc2689be":"code","68401061":"code","72dbaf7a":"code","37fae1c7":"code","18f3f48c":"code","acb1685f":"code","634d9f44":"code","890521fc":"code","8f2f09bc":"code","e7d38881":"code","f0feb5eb":"code","4f6a593e":"code","b55e890c":"code","7b568f4c":"code","f366d1e4":"code","e8614645":"code","d1c4a0ad":"code","8d97219c":"markdown","4bbe6a04":"markdown","899f3662":"markdown"},"source":{"a1f9b182":"import pandas as pd\nimport numpy as np","bc2689be":"train = pd.read_csv(\"..\/input\/sistemas-de-recomendao-filmes-ml\/train.csv\")\ntrain","68401061":"train.describe()","72dbaf7a":"# Ordenando pela quantidade de avalia\u00e7\u00f5es por filme\ntrain.groupby('movieId').count().sort_values(by=\"timestamp\")","37fae1c7":"# Ordenando pela quantidade de avalia\u00e7\u00f5es por usu\u00e1rio\ntrain.groupby('userId').count().sort_values(by=\"timestamp\")","18f3f48c":"# M\u00e9dia de nota de cada filme\nmedia_por_filme = train.groupby('movieId').rating.mean().rename('rating_avg')\nmedia_por_filme","acb1685f":"# M\u00e9dia total\nmedia = train['rating'].mean()\nmedia","634d9f44":"metadata = pd.read_csv('..\/input\/sistemas-de-recomendao-filmes-ml\/movies_metadata_cast_and_crew.csv')\nmetadata","890521fc":"# Adicionando a uma coluna com a nota m\u00e9dia para cada filme\nmetadata = metadata.merge(media_por_filme, on='movieId', how=\"left\")\nmetadata","8f2f09bc":"# Verificando valores nulos\nmetadata.isnull().sum()","e7d38881":"# Algumas m\u00e9dias (rating_avg) ficaram nulas (provavelmente ningu\u00e9m na base de treino avaliou tais filmes).\n# Colocando a m\u00e9dia geral nos filmes em que a m\u00e9dia est\u00e1 nula.\nmetadata.loc[metadata['rating_avg'].isnull(), 'rating_avg'] = media","f0feb5eb":"# Verificando valores nulos\nmetadata.isnull().sum()","4f6a593e":"# Sem valores nulos para a m\u00e9dia.\n# Definindo uma fun\u00e7\u00e3o para pegar a m\u00e9dia de rating de um determinado filme\ndef get_movie_avg(row):\n    rating_avg = metadata[metadata['movieId'] == row['movieId']]['rating_avg'].values\n    # Se n\u00e3o achar o filme no metadata, pega a m\u00e9dia geral\n    return rating_avg[0] if len(rating_avg) else media","b55e890c":"test =  pd.read_csv('..\/input\/sistemas-de-recomendao-filmes-ml\/test.csv')\ntest","7b568f4c":"# Adicionando coluna com o rating m\u00e9dio para cada filme\ntest['rating'] = test.apply(get_movie_avg, axis=1)","f366d1e4":"test","e8614645":"test[['Id', 'rating']].to_csv('submition.csv', index=False)","d1c4a0ad":"pd.read_csv('submition.csv')","8d97219c":"## Carregando o dataset de treino","4bbe6a04":"## Carregando dados de teste","899f3662":"## Exportando resultado"}}