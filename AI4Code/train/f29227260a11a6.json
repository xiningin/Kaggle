{"cell_type":{"ead5c625":"code","2271d86d":"code","43648fee":"code","98c52d05":"code","693bfb67":"code","e4b52253":"code","3a0fdb9d":"code","da83c63f":"code","02965465":"code","ad120216":"code","0f5c4723":"code","b7987da5":"code","0d67dd32":"code","38201dc0":"code","873783ad":"code","88e47101":"code","0725e5fa":"code","0fe9926e":"code","19a332eb":"code","b9849c83":"code","18f964c7":"code","c0994187":"code","6f1eb801":"code","f7fc3915":"code","88765a1a":"markdown","0d8b4fb7":"markdown","80624702":"markdown","167cfc92":"markdown","d49ecc5c":"markdown","b93b0a07":"markdown"},"source":{"ead5c625":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","2271d86d":"# import Machine-Learning library\nfrom scipy.sparse import csr_matrix\nfrom sklearn.neighbors import NearestNeighbors","43648fee":"# read datasets\nratings = pd.read_csv('\/kaggle\/input\/anime-recommendations-database-vol2\/ratings.csv')\nanimes = pd.read_csv('\/kaggle\/input\/anime-recommendations-database-vol2\/animes.csv')","98c52d05":"ratings.head()","693bfb67":"ratings.info()","e4b52253":"animes.head()","3a0fdb9d":"animes.info()","da83c63f":"animes.sort_values('members', ascending=False)[:20]","02965465":"round(animes.describe(),2)","ad120216":"round(ratings.describe(),2)","0f5c4723":"# 0\u306f0\u70b9\u3067\u306f\u306a\u304f\u3001\u7121\u6295\u7968\u3092\u8868\u3057\u307e\u3059\n# \u5358\u4f4d\u306f1\u30e1\u30e2\u30ea\u3067500,000\u7968\u3068\u306a\u308a\u307e\u3059\nratings['rating'].hist(bins=10, figsize=(10,10))","b7987da5":"# members\u306e\u5024\u304c10,000\u3088\u308a\u5927\u304d\u3044\u30c7\u30fc\u30bf\u306e\u307f\u62bd\u51fa\nanimes = animes[animes['members'] > 10000]","0d67dd32":"# \u672a\u8a55\u4fa1\u306e\u30c7\u30fc\u30bf\u3092\u524a\u9664\nratings = ratings[ratings.rating > 0]","38201dc0":"# anime_id\u3092\u30ad\u30fc\u306b\u3057\u3066\u30de\u30fc\u30b8\nmerged_df = ratings.merge(animes, left_on='anime_id', right_on='anime_id', suffixes=['_user', ''])\nmerged_df.head()","873783ad":"# \u5b66\u7fd2\u306b\u7528\u3044\u308b\u7279\u5fb4\u91cf\u3092\u62bd\u51fa\nmerged_df = merged_df[['user_id', 'title', 'rating_user']]\n# \u91cd\u8907\u3092\u524a\u9664\nmerged_df = merged_df.drop_duplicates(['user_id', 'title'])\n\nmerged_df.head()","88e47101":"# \u30a2\u30cb\u30e1\u30bf\u30a4\u30c8\u30eb\u3092\u8ef8\u306b\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\nanimes_pivot = merged_df.pivot(index='title', columns='user_id', values='rating_user').fillna(0)\nanimes_pivot_sparse = csr_matrix(animes_pivot.values)\n\nanimes_pivot.head()","0725e5fa":"# k=9, \u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0=, \u8ddd\u96e2=\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\u3067knn\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\nknn = NearestNeighbors(n_neighbors=9, algorithm='brute', metric='cosine')\n# \u30e2\u30c7\u30eb\u3092\u8a13\u7df4\nmodel_knn = knn.fit(animes_pivot_sparse)","0fe9926e":"# k=11\u3067\u5f15\u6570\u306b\u5165\u308c\u308b\u30a2\u30cb\u30e1\u304b\u3089\u985e\u4f3c\u3059\u308b\u9806\u306b10\u500b\u306e\u30a2\u30cb\u30e1\u3092\u8fd4\u3059\ndef anime_recommend(anime):\n    distance, indice = model_knn.kneighbors(animes_pivot.iloc[animes_pivot.index== anime].values.reshape(1,-1),n_neighbors=11)\n    for i in range(0, len(distance.flatten())):\n        if  i == 0:\n            print('Recommendations if you like the anime {0}:\\n'.format(animes_pivot[animes_pivot.index== anime].index[0]))\n        else:\n            print('{0}: {1} with distance: {2}'.format(i,animes_pivot.index[indice.flatten()[i]],distance.flatten()[i]))\n","19a332eb":"anime_recommend('K-On!')","b9849c83":"anime_recommend('Chihayafuru')","18f964c7":"anime_recommend('Koi wa Ameagari no You ni')","c0994187":"anime_recommend('Mahoutsukai no Yome')","6f1eb801":"anime_recommend('Kuzu no Honkai')","f7fc3915":"anime_recommend('Kakegurui')","88765a1a":"\u5404\u30c7\u30fc\u30bf\u306e\u57fa\u672c\u7d71\u8a08\u91cf\u3092\u78ba\u8a8d\u3057\u305f\u3042\u3068\u306b\u3001ratings\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059","0d8b4fb7":"## KNN\u3067\u30ec\u30b3\u30e1\u30f3\u30c9\u30a8\u30f3\u30b8\u30f3\u3092\u69cb\u7bc9","80624702":"\u307e\u305a\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u3066\u3044\u304d\u307e\u3059","167cfc92":"animes\u30c7\u30fc\u30bf\u3092members\u306b\u3088\u3063\u3066\u30bd\u30fc\u30c8\u3057\u307e\u3059\u3002members\u306f\u5f53\u8a72\u30a2\u30cb\u30e1\u3092mylist\u306b\u542b\u3081\u305f\u4eba\u306e\u7dcf\u6570\u3068\u306a\u308a\u3001\u7c21\u5358\u306b\u8a00\u3046\u3068\u30d5\u30a9\u30ed\u30ef\u30fc\u6570\u306e\u3088\u3046\u306a\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\n\u6a19\u6e96\u3067\u306f\u6607\u9806\u306b\u306a\u308b\u306e\u3067\u3001ascending=False\u3092\u6307\u5b9a\u3057\u3066\u964d\u9806\uff08\u4eba\u6c17\u9806\uff09\u306b\u3057\u307e\u3059","d49ecc5c":"## \u306f\u3058\u3081\u306b\n\u4eca\u56de\u306fKNN\u3092\u4f7f\u3063\u3066\u30a2\u30cb\u30e1\u306e\u30ea\u30b3\u30e1\u30f3\u30c9\u30a8\u30f3\u30b8\u30f3\u3092\u4f5c\u3063\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u5b66\u7fd2\u5185\u5bb9\u306f[\u3053\u3061\u3089](https:\/\/www.codexa.net\/collaborative-filtering-k-nearest-neighbor\/)\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\n","b93b0a07":"## \u524d\u51e6\u7406\nanimes\u3068ratings\u304b\u3089\u6709\u52b9\u306a\u30c7\u30fc\u30bf\u3060\u3051\u3092\u62bd\u51fa\u3057\u3066anime_id\u3092\u30ad\u30fc\u306b\u3057\u3066\u30de\u30fc\u30b8\u3057\u307e\u3059"}}