{"cell_type":{"e354a26e":"code","451995fb":"code","84d17f8c":"code","b4ca8f73":"code","75025b15":"code","9b99c7fc":"code","6cada8ed":"code","c6c37d3d":"code","2d9ebeea":"code","85340ee5":"code","eeae58d2":"code","936f9549":"code","672d89dd":"code","d515b673":"code","edff572a":"code","ef10eb2a":"code","fbc732ae":"code","bdd11f3f":"code","81d7ad0d":"code","da0ec2cf":"markdown","cfa30a59":"markdown","223dd667":"markdown","ac820c8f":"markdown","44cd014a":"markdown","f35255b7":"markdown","41fa73f7":"markdown","32f7d10c":"markdown","25a5f8dc":"markdown","d22b64b5":"markdown","77567664":"markdown","0e61b026":"markdown","65665271":"markdown","a2376743":"markdown","08017709":"markdown","b991dc49":"markdown","c575bc49":"markdown"},"source":{"e354a26e":"# import the required libraries \n\nfrom plotly.offline import init_notebook_mode, iplot\nimport plotly.graph_objs as go\nimport numpy as np\n\nimport plotly.plotly as py\nfrom plotly import tools\nimport pandas as pd\nimport string, os, random\nimport calendar\nimport numpy as np\nglobalcolors = ['092a35', 'a2738c', '645c84', '427996', '658525', '404b69', '0f4471', '0f4471', '0f4471', '0f4471']\ninit_notebook_mode(connected=True)\npunc = string.punctuation","451995fb":"df1 = pd.read_csv('..\/input\/caracteristics.csv', low_memory = False, encoding = 'latin-1')\ndf2 = pd.read_csv('..\/input\/vehicles.csv', low_memory = False)\ndf3 = pd.read_csv('..\/input\/places.csv', low_memory = False)\ndf4 = pd.read_csv('..\/input\/users.csv', low_memory = False)\n\nfrom functools import reduce\naccidents = reduce(lambda left, right: pd.merge(left, right, on = \"Num_Acc\"), [df1, df2, df3, df4])","84d17f8c":"print(\"Rows: \", accidents.shape[0], \"Columns: \", accidents.shape[1])","b4ca8f73":"accidents.head()\n","75025b15":"accidents.columns.values","9b99c7fc":"def missing_data(data):\n    total = data.isnull().sum().sort_values(ascending = False)\n    percent = (data.isnull().sum()\/data.isnull().count()*100).sort_values(ascending = False)\n    return pd.concat([total, percent], axis=1, keys=['Total NaN Values', 'Percentage of NaN Values'])\n\nmissing_data(accidents)","6cada8ed":"accidents = accidents.drop(['v2', 'v1', 'long', 'lat', 'pr1', 'pr', 'gps'], axis = 1)\nmissing_data(accidents)","c6c37d3d":"# function to aggregate and return keys and values\ndef create_stack_bar_data(col, df):\n    aggregated = df[col].value_counts().sort_index()\n    x_values = aggregated.index.tolist()\n    y_values = aggregated.values.tolist()\n    return x_values, y_values\n\nx1, y1 = create_stack_bar_data('an', accidents)\n\nfor i in range(len(x1)):\n    x1[i] += 2000\n\n#x1 = x1[:-1]\n#y1 = y1[:-1]\ncolor1 = ['092a35']*9\ncolor2 = ['a2738c']*3\ncolor1.extend(color2)\ntrace1 = go.Bar(x=x1, y=y1, opacity=0.75, name=\"year count\", marker = dict(color = color1))\nlayout = dict(height=400, title='Year wise Number of Accidents in France', legend=dict(orientation=\"h\"), \n              xaxis = dict(title = 'Year'), yaxis = dict(title = 'Number of Accidents'))\nfig = go.Figure(data=[trace1], layout=layout);\niplot(fig);","2d9ebeea":"x2, y2 = create_stack_bar_data('mois', accidents)\n#mapp = {}\n#for m,v in zip(x2, y2):\n#    mapp[m] = v\nxn = [calendar.month_name[int(x)] for x in (x2)]\nvn = y2\n\ntrace1 = go.Bar(x=xn, y=vn, opacity=0.75, name=\"month\", marker=dict(color=globalcolors[5]))\nlayout = dict(height=400, title='Month Wise Number of Accidents in France', legend=dict(orientation=\"h\"));\n\nfig = go.Figure(data=[trace1], layout=layout)\niplot(fig, filename='stacked-bar')","85340ee5":"x1, y1 = create_stack_bar_data('jour', accidents)\ntrace1 = go.Bar(x=x1, y=y1, opacity=0.75, name=\"monthday\", marker=dict(color=globalcolors[4]))\nlayout = dict(height=400, title='Nummber of Accidents per Day', legend=dict(orientation=\"h\") );\n\nfig = go.Figure(data=[trace1], layout=layout)\niplot(fig, filename='stacked-bar')","eeae58d2":"accidents.an += 2000\ndates = pd.to_datetime(accidents.an*10000+accidents.mois*100+accidents.jour,format='%Y%m%d')\naccidents.an -= 2000\naggregated = dates.value_counts().sort_index()\nx_values = aggregated.index.tolist()\ny_values = aggregated.values.tolist()\nx1,y1 = x_values, y_values\n\n#x1, y1 = create_stack_bar_data('jour', accidents)\ntrace1 = go.Scatter(x=x1, y=y1, opacity=0.75, name=\"monthday\", marker=dict(color='092a35'), line = dict(\n        width = 0.6))\nlayout = dict(height=400, title='Time Series of Accidents from 2005 to 2016', legend=dict(orientation=\"h\"));\n\nfig = go.Figure(data=[trace1], layout=layout)\niplot(fig, filename='stacked-bar')","936f9549":"accidents.an += 2000\ndates = pd.to_datetime(accidents.an*10000+accidents.mois*100+accidents.jour,format='%Y%m%d')\naccidents.an -= 2000\ntraces = []\nfor key, grp in dates.groupby(dates.dt.year):\n    #print(grp)\n    aggregated = grp.dt.month.value_counts().sort_index()\n    x_values = aggregated.index.tolist()\n    y_values = aggregated.values.tolist()\n    x1,y1 = x_values, y_values\n    x1 = [calendar.month_name[int(x)] for x in (x1)]\n\n\n    \n\n#x1, y1 = create_stack_bar_data('jour', accidents)\n    trace1 = go.Scatter(x=x1, y=y1, opacity=0.75, line = dict(\n        width = 1.5), name = str(key), marker = dict(color = np.random.randn(500)*key), mode = 'lines', \n                       text = str(key))\n    layout = dict(height=400, title='Time Series of Accidents for each Year', legend=dict(orientation=\"h\"));\n    traces.append(trace1)\nfig = go.Figure(data= traces, layout=layout)\niplot(fig, filename='stacked-bar')","672d89dd":"x1, y1 = create_stack_bar_data('catr', accidents)\nx1 = ['Highway', 'National Road', 'Departmental Road', 'Communal Way', 'Off-Public Network', 'Parking Lot', 'Other']\ntrace1 = go.Bar(x=x1, y=y1, opacity=0.75, name=\"Category\", marker=dict(color='092a35'))\n\nx2, y2 = create_stack_bar_data('circ', accidents)\nx2 = ['Unknown','One Way', 'Bidirectional', 'Separated Carriageways', 'Variable Assignment Channels']\ntrace2 = go.Bar(x = x2, y = y2, opacity = 0.75, marker=dict(color='a2738c'), name = \"Traffic Flow\")\n\nx3, y3 = create_stack_bar_data('prof', accidents)\nx3 = ['Unknown', 'Dish','Slope', 'Hill-Top', 'Hill-Bottom']\ntrace3 = go.Bar(x = x3, y = y3, opacity = 0.75, marker=dict(color='645c84'), name = \"Road Gradient\")\n\n\nfig = tools.make_subplots(rows = 3, cols = 1)\n\nfig.append_trace(trace1, 1, 1)\nfig.append_trace(trace2, 2, 1)\nfig.append_trace(trace3, 3, 1)\nlayout = dict(height=900, title='Accidents by Type of Road');\nfig.layout.update(layout)\n#fig['layout'].update(height=800,title='Accidents by Type of Road')\niplot(fig, filename='stacked-bar')","d515b673":"keydict = {1:'Highway', 2:'National Road', 3:'Departmental Road', 4:'Communal Way', 5:'Off-Public Network', 6:'Parking Lot', 9:'Other'}\nroadtype = accidents[['catr','circ']]\ntraces = []\nfor key, grp in roadtype.groupby(roadtype.catr):\n    aggregated = grp.circ.value_counts().sort_index()\n    x_values = aggregated.index.tolist()\n    y_values = aggregated.values.tolist()\n    x1,y1 = x_values, y_values\n    x1 = ['Unknown','One Way', 'Bidirectional', 'Separated Carriageways', 'Variable Assignment Channels']\n\n\n    \n\n#x1, y1 = create_stack_bar_data('jour', accidents)\n    trace1 = go.Bar(x=x1, y=y1, opacity=0.75, name = keydict[key], \n                        marker = dict(color = globalcolors[int(key)-1]))\n    layout = dict(height=400, title='Distribution of Accidents based on Type of Road', legend=dict(orientation=\"h\"));\n    traces.append(trace1)\nfig = go.Figure(data= traces, layout=layout)\niplot(fig)","edff572a":"keydict = {1:'Driver', 2:'Passenger', 3:'Pedestrian', 4:'Pedestrian in Motion'}\npeople = accidents[['catu','grav']]\ntraces = []\nfor key, grp in people.groupby(people.catu):\n    aggregated = grp.grav.value_counts().sort_index()\n    x_values = aggregated.index.tolist()\n    y_values = aggregated.values.tolist()\n    x1,y1 = x_values, y_values\n    x1 = ['Unscathed','Killed', 'Hospitalized', 'Light Injury']\n\n\n    \n\n#x1, y1 = create_stack_bar_data('jour', accidents)\n    trace1 = go.Bar(x=x1, y=y1, opacity=0.75, name = keydict[key],  \n                        marker = dict(color = globalcolors[key-5]))\n    layout = dict(height=400, title='Condition of People involved in the Accidents', legend=dict(orientation=\"h\"));\n    traces.append(trace1)\nfig = go.Figure(data= traces, layout=layout)\niplot(fig)","ef10eb2a":"ageusers = accidents[['an_nais', 'catu']]\nageusers['age'] = 2016 - ageusers.an_nais\n\nkeydict = {1:'Driver', 2:'Passenger', 3:'Pedestrian', 4:'Pedestrian in Motion'}\ntraces = []\nfor key, grp in ageusers.groupby(ageusers.catu):\n    if(key < 4):\n    #aggregated = grp.an_nais.value_counts().sort_index()\n        x1 = grp.age.values\n    #y_values = aggregated.values.tolist()\n    #x1,y1 = x_values, y_values\n    #x1 = ['Driver','Passenger', 'Pedestrian', 'Pedestrian in Motion']\n\n\n    \n    \n#x1, y1 = create_stack_bar_data('jour', accidents)\n        trace1 = go.Histogram(x=x1, opacity=0.5, name = keydict[key], \n                        marker = dict(color = globalcolors[key-1]))\n        layout = dict(height=400, title='Distribution of People involved in Accidents by Age', \n                  legend=dict(orientation=\"h\"), barmode = 'overlay');\n        traces.append(trace1)\nfig = go.Figure(data= traces, layout=layout)\niplot(fig)","fbc732ae":"keydict = {1:'Male', 2:'Female'}\npeople = accidents[['catu','sexe']]\ntraces = []\nfor key, grp in people.groupby(people.sexe):\n    aggregated = grp.catu.value_counts().sort_index()\n    x_values = aggregated.index.tolist()\n    y_values = aggregated.values.tolist()\n    x1,y1 = x_values, y_values\n    x1 = ['Driver','Passenger', 'Pedestrian', 'Pedestrian in Motion']\n\n\n    \n\n#x1, y1 = create_stack_bar_data('jour', accidents)\n    trace1 = go.Bar(x=x1, y=y1, opacity=0.75, name = keydict[key],  \n                        marker = dict(color = globalcolors[key-5]))\n    layout = dict(height=400, title='Distribution of people involved in accidents by Sex', legend=dict(orientation=\"h\"));\n    traces.append(trace1)\nfig = go.Figure(data= traces, layout=layout)\niplot(fig)","bdd11f3f":"safety = accidents[['secu', 'grav']]\nsafety = safety.dropna()\nsafety['equipment'] = (safety.secu\/10).astype(int)\nsafety.secu = (safety.secu - safety.equipment*10).astype(int)\n\n\nx1, y1 = create_stack_bar_data('equipment', safety)\nx1 = ['Belt', 'Helmet', \"Children's Device\", 'Reflective Equipment', \"Other\"]\ntrace1 = go.Bar(x=x1, y=y1, opacity=0.75, marker=dict(color='092a35'))\nlayout = dict(height=400, title='Distribution of Safety Equipment', legend=dict(orientation=\"h\") );\n\nfig = go.Figure(data=[trace1], layout=layout)\niplot(fig, filename='stacked-bar')","81d7ad0d":"keydict = {1:'Unscathed', 2:'Killed', 3: 'Hospitalized', 4: 'Light Injury'}\ntraces = []\nfor key, grp in safety.groupby(safety.grav):\n    if (key != 0):\n        count = safety.secu.count()\n        #print(count)\n        aggregated = (grp.secu.value_counts()).sort_index()\n        x_values = aggregated.index.tolist()\n        y_values = (aggregated.values\/safety.secu.value_counts().sort_index().values*100).tolist()\n        x1,y1 = x_values[1:], y_values[1:]\n        x1 = ['Equipment Present','Equipment Absent', 'Not Determined']\n\n\n    \n\n#x1, y1 = create_stack_bar_data('jour', accidents)\n        trace1 = go.Bar(x=x1, y=y1, opacity=0.75, name = keydict[key],  \n                        marker = dict(color = globalcolors[key-2]))\n        layout = dict(height=400, title='Relationship between Safety Equipment and Severity of Accident', \n                      legend=dict(orientation=\"h\"), barmode = 'stack', yaxis = dict(title = 'Percentage'),\n                      xaxis = dict(title = 'Safety Equipment'));\n        traces.append(trace1)\nfig = go.Figure(data= traces, layout=layout)\niplot(fig)","da0ec2cf":"### Distribution of People involved in accidents by Age","cfa30a59":"## 2. Cleaning the Dataset\n\nWe identify the percentage of NaN values in the dataset and eliminate the columns where the majority of the values are NaN.","223dd667":"## 1. Read the dataset\n\nRead the dataset using pandas read_csv function. Then we join all the dataframes using *Num_Acc* attribute(de facto Accident ID) as the key to create one aggregate dataframe.","ac820c8f":"> - 1.9% of the people were killed and 17.8% were hospitalized if Safety Equipment was used.\n> - 10.7% of the people were killed and 35.8% were hospitalized if Safety Equipment was not used.","44cd014a":"### What was the Safety Equipment used by the people involved ?","f35255b7":"# Exploring Vehicle Accidents in France\n\n* This notebook represents the exploration and visualization of the dataset Accidents in France [Dataset](https:\/\/www.kaggle.com\/ahmedlahlou\/accidents-in-france-from-2005-to-2016). \n* This data set consists of all the recorded accidents in France since 2005 to 2016. \n\n\n**Contents**\n\n**1. Reading Data**  \n**2. Cleaning the Data**   \n**3. Exploration**    \n**3.1 Exploration based on date of accidents**  \n* Is the number of Accidents per year decreasing ? (from 2005 to 2016)\n* Which months have higher frequency of Accidents ?  \n* Which Day-of-the-Month is most safe to drive ?  \n* Time series of all accidents from 2005 to 2016\n* Time series for all accidents in each year\n\n**3.2 Exploration based on roads where accidents occured**  \n* Which types of roads are high risk?\n* Which type of road gradient is high risk?\n\n**3.3 Exploration based on people involved in the accidents**  \n* What was the condition of the people after the accident?\n* What was the age distribution of the people involved?\n* What was the sex distribution of the people involved?\n\n**3.4 Exploration based on use of safety equipment**\n* What was the distribution of Safety Equipment used?\n* Did use of Safety Eqipment impact condition of people after the accident?\n\n## Hover the cursor on plots for more details.\n\n","41fa73f7":"> - Number of accidents in France have steadily decreased from 2005 to 2013, but an increasing trend is observed from 2013 to 2016. \n> - In this dataset, 2005 had the largest number of accidents equal to 374561. \n\n### Which months have higher frequency of accidents ?","32f7d10c":"> - Number of accidents per month-day is mostly uniform. 31st is lowest beacuse only 7 months have 31 days.\n> - On an average about 114,644 accidents occur every day in France.\n\n### Plotting the time series of all accidents from 2005 to 2013 ","25a5f8dc":"### Plotting the time series of accidents for each year","d22b64b5":"> - June, July, September, October have the highest number of accidents, while February has the lowest.\n> - On an average about 296,164 accidents occur every month in France.\n> - October has the highest number of accidents (with about 334,884 incidents) than any other month\n> - Weather in France during September and October is cold and wet whereas, June and July form the peak tourist season\n\n### Which Day-of-the-Month is not not safe ?","77567664":"### 1.1 Glimpse the dataset","0e61b026":"### Distribution of people invloved in accidents by Sex","65665271":"###  Is the number of accidents per year decreasing ?","a2376743":"> - Communal Ways and Departmental Roads are riskiest with 1.6 million and 1.1 million accidents each.\n> - Biderectional Roads are by far the riskiest with over 2.1 million accidents","08017709":"### Did Safety Equipment have any impact on the condition of the people involved ?","b991dc49":"### What was the condition of people involved in the accidents ? ","c575bc49":"> - A sharp rise is observed in the months of June, July, September and October.\n> - Sharp drops are observed in February and August.\n> - December, 2006 has the highest number of accidents at 36,648.\n> - February, 2013 has the lowest number of accidents at 15,605.\n\n### Which types of roads are high-risk ?"}}