{"cell_type":{"df938dc9":"code","65372183":"code","2d911748":"code","0cfe0131":"code","73115817":"code","f94696b3":"code","216fca27":"code","219e04c4":"code","0f99f1a7":"code","a3ac669b":"code","2059e430":"code","9a590478":"code","c8aa8d1b":"code","9c002a5e":"code","a90573fc":"code","349a3abc":"code","378c43e9":"code","0c2d4333":"code","055bc01b":"code","8125e75f":"code","5cd2500f":"code","a833602a":"code","5bfcee3c":"code","36648fcd":"code","06fee5fc":"code","646b0751":"code","29424947":"code","6310bb2b":"code","dc47a4fc":"markdown"},"source":{"df938dc9":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport cv2 # open cv library\nimport matplotlib.pyplot as plt #library","65372183":"# Importing necessary library\nfrom keras.layers import Dense, Activation, Flatten,Dropout, Conv2D, Input\nfrom keras.models import Sequential","2d911748":"# import the necessary packages\nfrom keras.preprocessing.image import img_to_array, ImageDataGenerator\nfrom keras.optimizers import Adam\nfrom sklearn.preprocessing import MultiLabelBinarizer\nfrom sklearn.model_selection import train_test_split","0cfe0131":"trainingcsv_read=pd.read_csv('\/kaggle\/input\/he-dl-trainimage\/train.csv')\n\ndata= [] \nlabels= [] \n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input\/he-dl-trainimage\/Train Images'):\n    for filename in filenames:\n        image = cv2.imread(os.path.join(dirname, filename))\n        image = cv2.resize(image, (80,80),interpolation= cv2.INTER_CUBIC)\n        #image = img_to_array(image)\n        data.append(image)\n        labels.append(trainingcsv_read['Class'][trainingcsv_read.loc[trainingcsv_read['Image']==filename].index[0]])","73115817":"# Import label encoder\nfrom sklearn import preprocessing\n  \n# label_encoder object knows how to understand word labels.\nlabel_encoder = preprocessing.LabelEncoder()\n\nprint(\"Labels before binarize :\",labels[:10])\n\n# Encode labels in column 'species'.\nlabels= label_encoder.fit_transform(labels)\n\nprint(\"Labels after binarise:\", labels[:10])","f94696b3":"data = np.array(data) \nlabels = np.array(labels)\n\nfrom sklearn.model_selection import train_test_split\n(X_train, X_test, Y_train,Y_test) = train_test_split(data,\n\tlabels, test_size=0.2, random_state=42)\n\nY_train = np.array(Y_train)\nY_test = np.array(Y_test)\n\nY_train = Y_train.T\nY_test = Y_test.T\n\nprint(X_train.shape)\nprint(X_test.shape)\nprint(Y_train.shape)\nprint(Y_test.shape)","216fca27":"#preprocessing the training image\nX_train=X_train-np.mean(X_train)","219e04c4":"print(np.average(X_train))","0f99f1a7":"print(Y_train.classes)","a3ac669b":"# model shared by navaneet\nfrom keras.models import model\nfrom keras.layers import Input,ZeroPadding2D,BatchNormalization,MaxPooling2D\n\nX_input = Input((64,64,3))\nX = ZeroPadding2D((3,3))(X_input)\nX = Conv2D(32,(5,5),strides=(1,1),name='conv0')(X)\nX = Activation('relu',name=\"a1\")(X)\nX = Conv2D(64,(5,5),strides=(1,1),name='conv1')(X)\nX = BatchNormalization(axis=3,name='bn0')(X)\nX = Activation('relu',name = 'a2')(X)\n# X = Dropout(0.5)\nX = MaxPooling2D((2,2),name='max_pooling')(X)\n\nX = Flatten()(X)\nX = Dense(1,activation='sigmoid',name='fc')(X)\nmodel = model(inputs=X_input,outputs=X,name='model')","2059e430":"# using the object rec model\nfrom keras.models import Sequential\nfrom keras.layers import Dropout,ZeroPadding2D,Activation,Conv2D,GlobalAveragePooling2D\n# from tf.keras.layers import LeakyRelu\n\nmodel = Sequential()\n\nmodel.add(Conv2D(96,(3,3),padding='same',input_shape=(80,80,3),name = 'conv01'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Conv2D(96,(3,3),padding='same',name = 'conv02'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(96,(3,3),padding='same',strides=(2,2),name='conv03'))\nmodel.add(Dropout(0.5))\n\nmodel.add(Conv2D(192,(3,3),padding='same',name = 'conv04'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(192,(3,3),padding='same',name = 'conv05'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(192,(3,3),padding='same',strides=(2,2),name='conv06'))\nmodel.add(Dropout(0.5))\n\nmodel.add(Conv2D(192,(3,3),padding='same', name = 'conv07'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(192,(1,1),padding='valid', name = 'conv08'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(4,(1,1),padding='valid'))\nmodel.add(Activation('relu'))\n\nmodel.add(GlobalAveragePooling2D())\nmodel.add(Activation('softmax'))\n\n#Accuracy is around 28%","9a590478":"# using the object rec model with updated filter size\nfrom keras.models import Sequential\nfrom keras.layers import Dropout,ZeroPadding2D,Activation,Conv2D,GlobalAveragePooling2D\n\n\nmodel = Sequential()\n\nmodel.add(Conv2D(192,(3,3),padding='same',input_shape=(80,80,3),name = 'conv01'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(192,(3,3),padding='same',name = 'conv02'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(192,(3,3),padding='same',strides=(2,2),name='conv03'))\n# model.add(Dropout(0.5))\n\nmodel.add(Conv2D(256,(3,3),padding='same',name = 'conv04'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(256,(3,3),padding='same',name = 'conv05'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(256,(3,3),padding='same',strides=(2,2),name='conv06'))\nmodel.add(Dropout(0.5))\n\nmodel.add(Conv2D(512,(3,3),padding='same', name = 'conv07'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(512,(1,1),padding='valid', name = 'conv08'))\nmodel.add(Activation('relu'))\nmodel.add(Conv2D(4,(1,1),padding='valid'))\nmodel.add(Activation('relu'))\n\n\n#add GlobalAveragePooling2D layer with softmax \nmodel.add(GlobalAveragePooling2D())\nmodel.add(Activation('softmax'))","c8aa8d1b":"model.summary()","9c002a5e":"from keras.optimizers import SGD\nlearning_rate=0.01\nweight_decay=0.0005\nmomentum=0.9\nmodel.compile(loss='sparse_categorical_crossentropy',optimizer=SGD(lr=learning_rate,momentum=momentum,decay=weight_decay,nesterov=True),metrics=[\"sparse_categorical_accuracy\"])","a90573fc":"from keras.callbacks import modelCheckpoint\n\n# define additional training parameter\nepochs = 100\nbatch_size = 256\n\n#fit the model\nfilepath = '.\/weight_improvements-{epoch:02d}-{sparse_categorical_accuracy:.2f}.h5'\ncheckpoint = modelCheckpoint(filepath,monitor=\"sparse_categorical_accuracy\",verbose =1, mode='max',save_best_only=True)\n\n#fit the model\nmodel.fit(X_train,Y_train ,epochs=epochs,batch_size=batch_size,shuffle =True,callbacks=[checkpoint])","349a3abc":"learning_rate = 0.01\nmodel.compile(loss = 'sparse_categorical_crossentropy',optimizer = Adam(lr = learning_rate),metrics=[\"sparse_categorical_accuracy\"])","378c43e9":"import h5py","0c2d4333":"from keras.model import vgg19","055bc01b":"from keras.callbacks import modelCheckpoint","8125e75f":"# define additional training parameter\nepochs = 10\nbatch_size = 64\n\nfilepath = '..\/input\/he-dl-trainimage\/weight_improvements.{epoch:02d}-{accuracy:.2f}.h5'\ncheckpoint = modelCheckpoint(filepath,monitor=\"accuracy\",verbose =1, mode='max')\n\n#fit the model\nmodel.fit(X_train,Y_train ,epochs=epochs,batch_size=batch_size,callbacks=[checkpoint])","5cd2500f":"import keras\nfrom keras.models import model\nfrom keras.layers import Input,ZeroPadding2D,BatchNormalization,MaxPooling2D\n\n# input layer is the same as our typical CNN model\ninputs = Input(shape=(64,64,3))\nnum_classes= 4 \n# # New Stuff Starts Here -------------------\n\ntower_1 = Conv2D(64, (1,1), padding='same', activation='relu')(inputs)\ntower_1 = Conv2D(64, (3,3), padding='same', activation= 'relu', name='t1_conv')(tower_1)\n\ntower_2 = Conv2D(64, (1,1), padding='same', activation='relu')(inputs)\ntower_2 = Conv2D(64, (5,5), padding='same', activation= 'relu', name='t2_conv')(tower_2)\n\ntower_3 = MaxPooling2D( (1,3), padding='same',strides=(1,1))(inputs)\ntower_3 = Conv2D(64, (1,1), padding='same', activation= 'relu', name='t3_conv')(tower_3)\n\nx = keras.layers.concatenate([tower_1, tower_2, tower_3],axis =1)\n\n#  Rest of the model, again, remains the same\n\nx= Conv2D(8, (3,3)) (x)\nx= Activation('relu')(x)\nx= MaxPooling2D(pool_size=(2,2))(x)\nx= Flatten()(x)\n\nx= Dense(num_classes)(x)\noutput = Activation('softmax')(x)\n\nmodel = model(inputs=X_input,outputs=x,name='model')","a833602a":"#vgg network\nfrom keras.models import Sequential\nfrom keras.layers import Dropout,Activation,Conv2D,MaxPooling2D, Dense,GlobalAveragePooling2D\n# import tf.keras.layers.LeakyRelu\n# import tensorflow as tf\nmodel= Sequential()\n\nmodel.add(Conv2D(64, (3,3),padding='same',input_shape=(80,80,3),name = 'conv01'))\nmodel.add(Activation('relu',name = 'actv01'))\n# model.add(tf.keras.layers.LeakyRelu(0.01))\nmodel.add(Conv2D(64, (3,3),padding='same',name = 'conv02'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Activation('relu',name = 'actv02'))\n\nmodel.add(MaxPooling2D((2,2),padding='same',strides=(2,2)))\n\nmodel.add(Conv2D(128, (3,3),padding='same',name = 'conv03'))\nmodel.add(Activation('relu',name = 'actv03'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Conv2D(128, (3,3),padding='same',name = 'conv04'))\nmodel.add(Activation('relu',name = 'actv04'))\n# model.add(LeakyRelu(0.01))\n\nmodel.add(MaxPooling2D((2,2),padding='same',strides=(2,2)))\n\nmodel.add(Conv2D(128, (3,3),padding='same',name = 'conv05'))\nmodel.add(Activation('relu',name = 'actv05'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Conv2D(128, (3,3),padding='same',name = 'conv06'))\nmodel.add(Activation('relu',name = 'actv06'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Conv2D(128, (3,3),padding='same',name = 'conv07'))\nmodel.add(Activation('relu',name = 'actv07'))\n# model.add(LeakyRelu(0.01))\n# model.add(Conv2D(128, (3,3),padding='same',name = 'conv08'))\n# model.add(Activation('relu',name = 'actv08'))\n# model.add(LeakyRelu(0.01))\n\n\nmodel.add(MaxPooling2D((2,2),padding='same',strides=(2,2)))\n\nmodel.add(Conv2D(512, (3,3),padding='same',name = 'conv09'))\nmodel.add(Activation('relu',name = 'actv09'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Conv2D(512, (3,3),padding='same',name = 'conv10'))\nmodel.add(Activation('relu',name = 'actv10'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Conv2D(512, (3,3),padding='same',name = 'conv11'))\nmodel.add(Activation('relu',name = 'actv11'))\n# model.add(LeakyRelu(0.01))\n# model.add(Conv2D(512, (3,3),padding='same',name = 'conv12'))\n# model.add(Activation('relu',name = 'actv12'))\n# model.add(LeakyRelu(0.01))\n\nmodel.add(MaxPooling2D((2,2),padding='same',strides=(2,2)))\n\nmodel.add(Conv2D(128, (3,3),padding='same',name = 'conv13'))\nmodel.add(Activation('relu',name = 'actv13'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Conv2D(128, (3,3),padding='same',name = 'conv14'))\nmodel.add(Activation('relu',name = 'actv14'))\n# model.add(LeakyRelu(0.01))\nmodel.add(Conv2D(128, (3,3),padding='same',name = 'conv15'))\nmodel.add(Activation('relu',name = 'actv15'))\n# model.add(LeakyRelu(0.01))\n# model.add(Conv2D(128, (3,3),padding='same',name = 'conv16'))\n# model.add(Activation('relu',name = 'actv16'))\n# model.add(LeakyRelu(0.01))\n\nmodel.add(Dropout(0.5))\nmodel.add(Dense(4096,activation='relu',name = 'actv17'))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(1000,activation='relu',name = 'actv18'))\nmodel.add(Dense(4,activation='relu',name = 'actv19'))\n\n\nmodel.add(GlobalAveragePooling2D())\nmodel.add(Activation('softmax'))","5bfcee3c":"model.summary()","36648fcd":"# import tensorflow as tf\n# run_opts = tf.compat.v1.RunOptions(report_tensor_allocations_upon_oom = True)\n\n\nlearning_rate = 0.01\nmodel.compile(loss = 'sparse_categorical_crossentropy',optimizer = Adam(lr = learning_rate),metrics=[\"sparse_categorical_accuracy\"])#,options = run_opts)","06fee5fc":"from keras.optimizers import SGD\nlearning_rate=0.01\nweight_decay=0.0005\nmomentum=0.9\nmodel.compile(loss='sparse_categorical_crossentropy',optimizer=SGD(lr=learning_rate,momentum=momentum,decay=weight_decay,nesterov=True),metrics=[\"sparse_categorical_accuracy\"])","646b0751":"from keras.callbacks import modelCheckpoint\n\n# define additional training parameter\nepochs = 100\nbatch_size = 256\n\n#fit the model\nfilepath = '.\/weight_improvements-{epoch:02d}-{sparse_categorical_accuracy:.2f}.h5'\ncheckpoint = modelCheckpoint(filepath,monitor=\"sparse_categorical_accuracy\",verbose =1, mode='max',save_best_only=True)\n\n#fit the model\nmodel.fit(X_train,Y_train ,epochs=epochs,batch_size=batch_size,shuffle =True,callbacks=[checkpoint])","29424947":"def eval_Emodel(weights = None ):\n    Emodel= Sequential()\n\n    Emodel.add(Conv2D(64, (3,3),padding='same',input_shape=(80,80,3),name = 'conv01'))\n    Emodel.add(Activation('relu',name = 'actv01'))\n\n    Emodel.add(Conv2D(64, (3,3),padding='same',name = 'conv02'))\n    Emodel.add(Activation('relu',name = 'actv02'))\n\n    Emodel.add(MaxPooling2D((2,2),padding='same',strides=(2,2)))\n\n    Emodel.add(Conv2D(128, (3,3),padding='same',name = 'conv03'))\n    Emodel.add(Activation('relu',name = 'actv03'))\n\n    Emodel.add(Conv2D(128, (3,3),padding='same',name = 'conv04'))\n    Emodel.add(Activation('relu',name = 'actv04'))\n\n    Emodel.add(MaxPooling2D((2,2),padding='same',strides=(2,2)))\n\n    Emodel.add(Conv2D(128, (3,3),padding='same',name = 'conv05'))\n    Emodel.add(Activation('relu',name = 'actv05'))\n\n    Emodel.add(Conv2D(128, (3,3),padding='same',name = 'conv06'))\n    Emodel.add(Activation('relu',name = 'actv06'))\n\n    Emodel.add(Conv2D(128, (3,3),padding='same',name = 'conv07'))\n    Emodel.add(Activation('relu',name = 'actv07'))\n\n    Emodel.add(MaxPooling2D((2,2),padding='same',strides=(2,2)))\n\n    Emodel.add(Conv2D(512, (3,3),padding='same',name = 'conv09'))\n    Emodel.add(Activation('relu',name = 'actv09'))\n\n    Emodel.add(Conv2D(512, (3,3),padding='same',name = 'conv10'))\n    Emodel.add(Activation('relu',name = 'actv10'))\n\n    Emodel.add(Conv2D(512, (3,3),padding='same',name = 'conv11'))\n    Emodel.add(Activation('relu',name = 'actv11'))\n\n    Emodel.add(MaxPooling2D((2,2),padding='same',strides=(2,2)))\n\n    Emodel.add(Conv2D(128, (3,3),padding='same',name = 'conv13'))\n    Emodel.add(Activation('relu',name = 'actv13'))\n\n    Emodel.add(Conv2D(128, (3,3),padding='same',name = 'conv14'))\n    Emodel.add(Activation('relu',name = 'actv14'))\n\n    Emodel.add(Conv2D(128, (3,3),padding='same',name = 'conv15'))\n    Emodel.add(Activation('relu',name = 'actv15'))\n\n    Emodel.add(Dropout(0.5))\n    Emodel.add(Dense(4096,activation='relu',name = 'actv17'))\n    Emodel.add(Dropout(0.5))\n    Emodel.add(Dense(1000,activation='relu',name = 'actv18'))\n    Emodel.add(Dense(4,activation='relu',name = 'actv19'))\n\n\n    Emodel.add(GlobalAveragePooling2D())\n    Emodel.add(Activation('softmax'))\n    \n    # load the weights\n    if weights:\n        Emodel.load_weights(weights)\n    \n    # return model\n    return model","6310bb2b":"from keras.optimizers import SGD\n\n#define hyperparameter\nlearning_rate=0.01\nweight_decay=0.0005\nmomentum=0.9\n\n# define weights and build model\nweights = '.\/weight_improvements-100-0.59.h5'\nEmodel = allcnn(weights)\n\nEmodel.compile(loss='sparse_categorical_crossentropy',optimizer=SGD(lr=learning_rate,momentum=momentum,decay=weight_decay,nesterov=True),metrics=[\"sparse_categorical_accuracy\"])","dc47a4fc":"**Evaluate the model and predict on the test images set**"}}