{"cell_type":{"8ece5ffa":"code","50d483d5":"code","eae57a07":"code","b3922d3a":"code","bbab4d70":"code","8571b5ee":"code","6036df3f":"code","fbafdfb3":"code","aedda86e":"code","b82df2e1":"code","71dd6d19":"code","e983b6c9":"code","be3b658b":"code","bab80dd6":"code","31e4d6d5":"code","623c0409":"code","8214f347":"code","851f4c42":"code","3a647ba8":"code","b084bbe4":"code","0c2f4e1d":"code","9bdf3d0b":"code","2f9d4aa4":"code","1a56428c":"code","b26863c3":"code","ae60028b":"code","6b5f8014":"code","1701736d":"code","853bedc4":"code","c20f4563":"code","81d2da9a":"code","ffa3cc26":"code","f21a856e":"code","44b517bb":"code","39893626":"code","035079ae":"code","97627d0c":"code","a63fc231":"code","b2cd7d48":"code","edecc964":"code","eaea8f21":"code","201a426a":"code","4fc2f31e":"code","d3ab4ebb":"code","1cc32eeb":"code","b068862f":"code","07ed626f":"code","c7a360cb":"code","7187fc4a":"code","5054c04e":"code","48794d69":"code","e3da70c5":"code","750036b0":"code","1d7d4d86":"code","04b961c4":"code","b06d3ac1":"code","81037ee0":"code","1b67f867":"code","e45d6cd4":"code","7d796eb3":"code","bdcffed6":"code","d057f4e7":"code","69f2025c":"markdown","4c0687c0":"markdown","6f4115e1":"markdown","5737afd3":"markdown","47b0e2bd":"markdown","e4ffa381":"markdown","8f5e2bdb":"markdown","47c6a4b5":"markdown","3ac76991":"markdown","5dfc605a":"markdown","4a8605ef":"markdown","50f4bffd":"markdown","f428c13c":"markdown","9950c744":"markdown","ba51e9c3":"markdown","1bc28ab2":"markdown","efb7057e":"markdown","67700fb9":"markdown","93e4b5b9":"markdown","94c67526":"markdown","adf78d1f":"markdown","bceeecf7":"markdown","50b47448":"markdown","19eff61e":"markdown","c4e10b52":"markdown","ddf71f86":"markdown","1df4ba4e":"markdown","3a938e6c":"markdown","d7f5487c":"markdown","1520885a":"markdown","c5ba0903":"markdown","bac2f60b":"markdown","50d8bb87":"markdown","b416476d":"markdown","f622bf07":"markdown","96fcd789":"markdown","4775f084":"markdown","82e36f90":"markdown","11412cee":"markdown","4bd252a0":"markdown","bedea43a":"markdown","e1039ef7":"markdown","9cd8abb4":"markdown","d9748554":"markdown","d846999b":"markdown","04b6acde":"markdown","21218c25":"markdown","4528b261":"markdown","11c59d86":"markdown","050a8caf":"markdown","fc84cef8":"markdown","e7ae40d4":"markdown","3707f63c":"markdown","a3b353d0":"markdown","e20a8840":"markdown","ae294845":"markdown","3a0af234":"markdown","96285c41":"markdown","299617d3":"markdown","284273bf":"markdown","05d8216d":"markdown","94d046e7":"markdown","ec69ac0b":"markdown","1aa632f4":"markdown","b695592c":"markdown","9d01f25e":"markdown","6f69aedc":"markdown","a05c0471":"markdown","03ef3059":"markdown","d8fbcc90":"markdown","52429c81":"markdown","8dfcaed1":"markdown","b0a50cc9":"markdown","0157b4b5":"markdown","db4a516b":"markdown","106334ec":"markdown","81eae7f4":"markdown"},"source":{"8ece5ffa":"import numpy as np\nimport pandas as pd","50d483d5":"data = pd.read_csv('..\/input\/telecom-users-dataset\/telecom_users.csv')","eae57a07":"data.head()","b3922d3a":"columns=list(data.columns)\nprint(f\"there are totally {len(columns)} Features\") ","bbab4d70":"data.drop(['Unnamed: 0','customerID'],axis=1,inplace=True)","8571b5ee":"data.dtypes","6036df3f":"# Splitting the data into numerical and categorical data\n\ncategorical = data.drop(['tenure','MonthlyCharges','TotalCharges'],axis=1)\nnumerical = data.drop(categorical.columns,axis=1)","fbafdfb3":"# Converting Object into categorical feature\ncategorical=categorical.astype('category')\n\n# Converting Object into numerical feature\nnumerical=pd.to_numeric(numerical.TotalCharges)","aedda86e":"# Changing the object to categorical features\nnumerical.TotalCharges=numerical.TotalCharges.to_numpy(dtype=float)\n\n# Finding the index of missing value\nmissing_index1=numerical[numerical.TotalCharges.isnull()].index.to_list()\n\nnumerical.TotalCharges.isnull().sum()","b82df2e1":"numerical.TotalCharges.isnull().sum()","71dd6d19":"missing_index1","e983b6c9":"new_data = pd.concat([categorical,numerical],axis=1)","be3b658b":"new_data.dtypes","bab80dd6":"import matplotlib.pyplot as plt\nimport seaborn as sns\nfrom mpl_toolkits.mplot3d import Axes3D\nfrom scipy.stats import spearmanr,pearsonr","31e4d6d5":"monthly_times_total=pd.Series(new_data.MonthlyCharges*new_data.TotalCharges,name=\"monthly_times_total\")\n\nsns.jointplot(x=monthly_times_total,y=new_data.TotalCharges,hue=new_data.Churn)","623c0409":"monthly_plus_tenure = pd.Series(new_data.MonthlyCharges+new_data.tenure,name=\"monthly_plus_tenure\")","8214f347":"fig = plt.figure(figsize=(20,10))\nsns.jointplot(x=monthly_plus_tenure,y=new_data.TotalCharges,data=new_data,hue=new_data.Churn)","851f4c42":"monthly_times_tenure=pd.Series(new_data.MonthlyCharges*new_data.tenure,name=\"monthly_times_tenure\")","3a647ba8":"fig = plt.figure(figsize=(20,10))\nsns.jointplot(x=monthly_times_tenure,y=new_data.TotalCharges,data=new_data,hue=new_data.Churn)","b084bbe4":"Sqrt_monthly_total=pd.Series(np.sqrt(new_data.MonthlyCharges*new_data.TotalCharges),name='Sqrt_monthly_total')\nsns.jointplot(x=Sqrt_monthly_total,y=new_data.TotalCharges,hue=new_data.Churn)","0c2f4e1d":"new_data=pd.concat([new_data,monthly_times_total,Sqrt_monthly_total,monthly_plus_tenure,monthly_times_tenure],axis=1)","9bdf3d0b":"correlation=new_data.corr()\nfig = plt.figure(figsize=(15,7))\nsns.heatmap(correlation,cmap='Blues',annot=True)","2f9d4aa4":"new_data.iloc[missing_index1]","1a56428c":"# Droping the nan values\nnew_data.dropna(inplace=True)","b26863c3":"# Checking whether or not the data is balanced.\nfig = plt.figure(figsize=(13,5))\nsns.countplot(data=new_data,x='Churn')","ae60028b":"numerical_col = new_data.columns[(new_data.dtypes!='category')]\nfig,axes = plt.subplots(1,3,figsize=(18,5))\nprint(numerical_col)\nsns.violinplot(ax=axes[0],x=new_data[numerical_col[0]])\nsns.violinplot(ax=axes[1],x=new_data[numerical_col[1]])\nsns.violinplot(ax=axes[2],x=new_data[numerical_col[2]])","6b5f8014":"sns.pairplot(data=new_data,vars=['TotalCharges','tenure','MonthlyCharges'],hue='Churn')","1701736d":"fig = plt.figure(figsize=(20,8))\n\nsns.boxplot(x=new_data.gender,y=new_data.MonthlyCharges,hue=new_data.Churn)","853bedc4":"fig = plt.figure(figsize=(18,5))\n\nsns.boxplot(x=new_data.gender,y=new_data.tenure,hue=new_data.Churn)","c20f4563":"fig = plt.figure(figsize=(18,5))\n\nsns.boxplot(x=new_data.Contract,y=new_data.tenure,hue=new_data.Churn)","81d2da9a":"fig = plt.figure(figsize=(18,5))\n\nsns.countplot(x=new_data.Contract,hue=new_data.Churn)","ffa3cc26":"fig = plt.figure(figsize=(18,5))\n\nsns.countplot(x=new_data.InternetService,hue=new_data.Churn)","f21a856e":"fig = plt.figure(figsize=(18,5))\n\nsns.countplot(x=new_data.OnlineSecurity,hue=new_data.Churn)","44b517bb":"fig = plt.figure(figsize=(18,5))\n\nsns.countplot(x=new_data.PaperlessBilling,hue=new_data.Churn)","39893626":"fig = plt.figure(figsize=(18,5))\n\nsns.countplot(x=new_data.PaymentMethod,hue=new_data.Churn)","035079ae":"sns.jointplot(x='tenure',y='MonthlyCharges',data=new_data,hue='Churn')","97627d0c":"sns.barplot(x='Partner',y='tenure',data=new_data,hue='Churn')","a63fc231":"from sklearn.linear_model import LogisticRegression\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier,GradientBoostingClassifier,AdaBoostClassifier\nfrom xgboost import XGBClassifier\nfrom collections import Counter\nfrom sklearn.metrics import confusion_matrix,roc_auc_score,accuracy_score,accuracy_score,classification_report\nfrom sklearn.model_selection import GridSearchCV,cross_val_score\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.pipeline import Pipeline\nfrom statsmodels.stats.outliers_influence import variance_inflation_factor\nfrom sklearn.feature_selection import RFE\nfrom imblearn.over_sampling import SMOTE\nfrom sklearn.decomposition import PCA","b2cd7d48":"new_data.dtypes","edecc964":"new_data.SeniorCitizen=new_data.SeniorCitizen.astype('int')\nnew_data.tenure=new_data.tenure.astype('int')","eaea8f21":"def set_feature_name(X):\n    categorical_columns= X.columns[X.dtypes=='category']\n    \n    for i in categorical_columns:\n        X[i]=X[i].apply(lambda m: str(i)+'_'+str(m))\n    return X","201a426a":"set_feature_name(new_data)","4fc2f31e":"def convert_numerical(X):\n    \n    categorical_columns= X.columns[X.dtypes=='category']\n    \n    for i in categorical_columns:\n        dummies = pd.get_dummies(X[i],drop_first=True)\n        X=pd.concat([X,dummies],axis=1)\n        X.drop(i,axis=1,inplace=True)\n    return X","d3ab4ebb":"final_data=convert_numerical(new_data)","1cc32eeb":"final_data.head()","b068862f":"X=final_data.drop('Churn_Yes',axis=1)\ny=final_data['Churn_Yes']","07ed626f":"over_saample=SMOTE()\nX_sample,y_sample = over_saample.fit_resample(X,y)\n\nX_sample=pd.DataFrame(X_sample,columns=X.columns)\ny_sample=pd.Series(y_sample,name='Churn')","c7a360cb":"pre_processed_X = pd.read_csv('..\/input\/preprocessed-telecom-data\/pre_proc_X.csv',index_col=0)\npre_processed_y = pd.read_csv('..\/input\/preprocessed-telecom-data\/pre_pro_y.csv',index_col=0)","7187fc4a":"new_X=pre_processed_X\nnew_y=pre_processed_y","5054c04e":"new_y","48794d69":"from sklearn.model_selection import train_test_split\n\nX_train,X_test,y_train,y_test = train_test_split(new_X,new_y,test_size=0.2)","e3da70c5":"def tune(X,y,Estimator):\n    total_features = len(X.columns)\n    score=-50\n    best_params={}\n    for i in range(total_features,0,-1):\n        if i>1:\n            feature_selector=RFE(estimator=Estimator,n_features_to_select=i)\n            X=feature_selector.fit_transform(X,y)\n#             Scaler=StandardScaler()\n#             X=Scaler.fit_transform(X)\n            new_score=cross_val_score(Estimator,X,y).mean()\n            if new_score>score:\n                score=new_score\n                best_params[\"Best_size\"]=i\n                best_params[\"Best_Score\"]=new_score\n            print(f\"No_feat:{i}     Score: {new_score}\")\n    return best_params","750036b0":"tune(pre_processed_X,np.ravel(pre_processed_y),RandomForestClassifier(n_estimators=200, criterion='gini',max_depth=15))","1d7d4d86":"Random_forest_model = RandomForestClassifier(n_estimators=100, criterion='gini',max_depth=15)","04b961c4":"feature_selector = RFE(estimator=Random_forest_model,n_features_to_select=23)\nX_train=feature_selector.fit_transform(X_train,np.ravel(y_train))\nX_test = feature_selector.transform(X_test)","b06d3ac1":"Random_forest_model.fit(X_train,np.ravel(y_train))\n","81037ee0":"predicted = Random_forest_model.predict(X_test)","1b67f867":"print( f\"Test accuracy is: {sum(np.ravel(y_test)==predicted)\/len(np.ravel(y_test))}\")","e45d6cd4":"confusion_mat=confusion_matrix(y_test,predicted)\n\nfig = plt.figure(figsize=(18,8))\nsns.heatmap(confusion_mat.T,annot=True,fmt = 'd',xticklabels=['Actual_Stayed','Actual_Left'],\n            yticklabels=[\"predicted_Stayed\",\"Predicted_Left\"],annot_kws={'fontsize':10},linewidths=5)","7d796eb3":"print(classification_report(y_test,predicted))","bdcffed6":"print(\"roc_auc_score : \",roc_auc_score(y_test,predicted),'\\n')","d057f4e7":"print(\"Precision : \",cross_val_score(Random_forest_model,new_X,np.ravel(new_y),cv=10,scoring='precision').mean())\nprint(\"Recall : \",cross_val_score(Random_forest_model,new_X,np.ravel(new_y),cv=10,scoring='recall').mean())\nprint(\"F1 : \",cross_val_score(Random_forest_model,new_X,np.ravel(new_y),cv=10,scoring='f1').mean())\nprint(\"Accuracy : \",cross_val_score(Random_forest_model,new_X,np.ravel(new_y),cv=10,scoring='accuracy').mean())","69f2025c":"# To get overall idea about how numerical features are usefull in finding patterns, let's use pair plot","4c0687c0":"> ### 1. If the monthly charge is less then the customers are less likely to leave the company\n> ### 2. The churn starts when Monthly charge is greater than 45","6f4115e1":"# Checking whether there is any missing values","5737afd3":"# Converting categorical features into numerical features","47b0e2bd":"# Handling imbalanced data - Using SMOTE Method","e4ffa381":"# Exploratory Data Analysis","8f5e2bdb":"# Feature Selection\n\n### After doing hyper parameter tuning i got these parameters as best\n\n>         # 1.n_estimators =100\n>         # 2.max_depth = 21","47c6a4b5":"# Prediction","3ac76991":"# Adding new features to the data","5dfc605a":"link : 'https:\/\/www.kaggle.com\/radmirzosimov\/telecom-users-dataset'","4a8605ef":"> ### Those who do not have Online security\/OnlineBackup\/DeviceProtection\/TechSupport tend to leave the company","50f4bffd":"# If we take dummies for this dataset then we wil not be able to identify the features so let's add all the feature names to their values","f428c13c":"# Distribution of Numerical dataset","9950c744":"# InternetService and Churn rate","ba51e9c3":"# roc_auc_score","1bc28ab2":"# Splitting the data into X and y","efb7057e":"# OnlineSecurity and Churn Rate","67700fb9":"# Building The Model","93e4b5b9":"# Training ","94c67526":"# Cross Validation report","adf78d1f":"> ### People who took month to month contract are more likely to leave the compay than those who have other plans","bceeecf7":"# Loding SMOTE data","50b47448":"# Classification Report","19eff61e":"> ### The data is imbalanced","c4e10b52":"# Contract and Churn rate","ddf71f86":"# Observations\n### 1. Most of the customers leaves within a short period of time \n### 2. Most of the new customers leave the company when they are charged high mothly Charge\n### 3. Those who pay high total charge whithin short tenure, tend to leave the company ","1df4ba4e":"> ### As we can see there is a absolute positive correlation between monthly_times_tenure and Total charge","3a938e6c":"> > ### 1.Seems to be correlated with each other","d7f5487c":"# Converting SeniorCitizen and tenure features into numeric ","1520885a":"> ### Those who use electronic check for payment tend to leave the company\u00b6","c5ba0903":"## Let's try to create new variables using tenure, Total charge and monthly charge","bac2f60b":"* > > ### we can see that there is some liner relation between monthly_tenure and Total charge","50d8bb87":"# To fill nan values in Total Charges column we need to know which feature gives more details about Total charge","b416476d":"# As we can see Monthly time tennure is highly correlated with Total Charge so we can use this feature to fill missing values in Total charge","f622bf07":"### Feature 1: monthly_times_totalcharge","96fcd789":"# Tenure and Partner","4775f084":"> # We are getting this error :: \" ValueError: Unable to parse string \" \" at position 356\". \n> # Which means there are some missing values in the form of strings. and we need to fix it","82e36f90":"# Finalizing the findings","11412cee":"# Accuracy","4bd252a0":"# gender And tenure","bedea43a":"> ### the new customers are more likly to leave the company","e1039ef7":"# Importing required libraries","9cd8abb4":"### Feature 4 - square root of monthly_times_total","d9748554":"# Out of 22, 2 features are not important so i am droping those\u00b6","d846999b":"> ### Those who pay bill using paperless payment tend to leave the company","04b6acde":"### Importing Required Libraries","21218c25":"# MonthlyCharges And gender","4528b261":"### let's see How each of them are correlated ","11c59d86":"Build a model to predict the customers who are about to leave the company. With the help of this model the compay can controll their customer attrition rate","050a8caf":"### In these index we have nan Values and we have to fix them","fc84cef8":"Download the data from here","e7ae40d4":"# MonthlyCharges and Tenure","3707f63c":"> ### 0.Mostly the new customers are more likly to leave the company\n> ### 1.Total Charge is highly correlated tenure and Monthly charge\n> ### 2. Most of the customers leaves within a short period of time \n> ### 3. Most of the new customers leave the company when they are charged high mothly Charge\n> ### 4. Those who pay high total charge whithin short tenure, tend to leave the company  \n> ### 5. If the monthly charge is less then the customers are less likely to leave the company\n> ### 6. The churn starts when the Monthly charge is greater than 45\n> ### 7.People who took month to month contract are more likely to leave the compay than those who have other plans\n> ### 8.The Customers who use Fiber optic are more likly to have high churn rate compare to other service users\n> ### 9.Those who do not have Online security\/OnlineBackup\/DeviceProtection\/TechSupport tend to leave the company \n> ### 10.Those who pay bill using paperless payment seem to have high churn rate\n> ### 11.Those who use electronic check for payment tend to leave the company\n> ### 12.If the tenure is less and Monthly charge is also less then those customers are less likely to leave the company\n> ### 13. The data is not balanced","a3b353d0":"# Data Preprocessing","e20a8840":"# Training The Model","ae294845":"# Import data","3a0af234":"# Contract and ttenure","96285c41":"# Now let's explore the categorical features\u00b6","299617d3":"### Feature 3 - Multiplying Monthly charge and tenure","284273bf":"# Exploring each and Every individual features","05d8216d":"customerID - customer id\n\ngender - client gender (male \/ female)\n\nSeniorCitizen - whether the client is a pensioner (1, 0)\n\nPartner - whether the client is married (Yes, No)\n\nDependents - does the client have dependents (Yes, No)\n\ntenure - how many months a person has been a client of the company\n\nPhoneService - is the telephone service activated (Yes, No)\n\nMultipleLines - whether multiple telephone lines are connected (Yes, No, No phone service)\n\nInternetService - client's Internet provider (DSL, Fiber optic, No)\n\nOnlineSecurity - is the online security service enabled (Yes, No, No internet service)\n\nOnlineBackup - is the online backup service activated (Yes, No, No internet service)\n\nDeviceProtection - does the client have equipment insurance (Yes, No, No internet service)\n\nTechSupport - is the technical support service activated (Yes, No, No internet service)\n\nStreamingTV - is the streaming TV service activated (Yes, No, No internet service)\n\nStreamingMovies - is the streaming cinema service activated (Yes, No, No internet service)\n\nContract - type of customer contract (Month-to-month, One year, Two year)\n\nPaperlessBilling - whether the client uses paperless billing (Yes, No)\n\nPaymentMethod - payment method (Electronic check, Mailed check, Bank transfer (automatic), Credit card (automatic))\n\nMonthlyCharges - current monthly payment\n\nTotalCharges - the total amount that the client has paid for the services for the entire time\n\nChurn - whether there was a churn (Yes or No)","94d046e7":"# PaperlessBilling and Churn Rate","ec69ac0b":"# Note Each time we get different samples from SMOT function. and all the samples will not give good result. so many times i run SMOTE and did crossvalidation. Finally i get good accuracy on this data set, feel free to use the same data set.","1aa632f4":"# Available Details\u00b6","b695592c":"# PaymentMethod and Churn Rate","9d01f25e":"# Concatinating categorical and numerical data","6f69aedc":"### Splitting the data into training and testing data","a05c0471":" # Hyper Parameter Tuning - Random Forest","03ef3059":"> ### If the tenure is less and Monthly charge is also less then those customers are less likely to leave the company","d8fbcc90":"> ### The Customers who use Fiber optic are more likly to have high churn rate compare to other service users","52429c81":"### Feature-2 Adding tenure and monthly charge\u00b6","8dfcaed1":"# Selecting features using RFE","b0a50cc9":"# Objective","0157b4b5":"# Unfortunatly we have zeros in tennure column. so i am going to drop these 10 data points.\n#### Reason for droping these data points.\n       1. We do not have tenure information for these data points\n       2. More over already we have enough data points in No Churn class so we can drop these data points","db4a516b":"# First we need to change the data types. because if we have object datatype, then we will not be able to find out missing values properly","106334ec":"# Confusion Matrix","81eae7f4":"> > ### 1.Seems to be correlated with each other"}}