{"cell_type":{"e5c15aad":"code","33cf0dc3":"code","013e715b":"code","3045e038":"code","11e5811b":"code","c65d649a":"code","f99f6cc7":"markdown"},"source":{"e5c15aad":"from datetime import datetime\nimport os\nimport pandas as pd\n!git clone https:\/\/github.com\/AIStream-Peelout\/flow-forecast.git\nos.chdir(\"flow-forecast\")\n!pip install -r requirements.txt\n!python setup.py develop","33cf0dc3":"import pandas as pd\navocado_prices = pd.read_csv(\"..\/..\/input\/avocado-prices-2020\/avocado-updated-2020.csv\")\navocado_prices.sort_values(by=\"date\")","013e715b":"chicago_df = avocado_prices[avocado_prices[\"geography\"]==\"Chicago\"].sort_values(by=\"date\")\nchicago_df[\"datetime\"] = chicago_df[\"date\"]\nchicago_df.to_csv(\"chicago_df.csv\")","3045e038":"chicago_df","11e5811b":"the_config = {                 \n   \"model_name\": \"DARNN\",\n   \"model_type\": \"PyTorch\",\n    \"model_params\": {\n      \"n_time_series\":6,\n      \"hidden_size_encoder\":128,\n      \"decoder_hidden_size\":128,\n      \"out_feats\":1,\n      \"forecast_history\":5, \n      \"gru_lstm\": False\n    },\n    \"dataset_params\":\n    { \"class\": \"default\",\n       \"training_path\": \"chicago_df.csv\",\n       \"validation_path\": \"chicago_df.csv\",\n       \"test_path\": \"chicago_df.csv\",\n       \"forecast_length\": 1,\n       \"batch_size\":4,\n       \"forecast_history\":4,\n       \"train_end\": int(len(chicago_df)*.7),\n       \"valid_start\":int(len(chicago_df)*.7),\n       \"valid_end\": int(len(chicago_df)*.9),\n       \"test_start\": int(len(chicago_df)*.9),\n       \"target_col\": [\"average_price\"],\n       \"sort_column\": \"date\",\n        \"no_scale\": True,\n       \"relevant_cols\": [\"average_price\", \"total_volume\", \"4046\", \"4225\", \"4770\"],\n       \"scaler\": \"StandardScaler\", \n       \"interpolate\": False,\n       \"feature_param\":\n         {\n             \"datetime_params\":{\n                 \"month\":\"numerical\"\n             }\n         }\n    },\n\n    \"training_params\":\n    {\n       \"criterion\":\"DilateLoss\",\n       \"optimizer\": \"Adam\",\n       \"optim_params\":\n       {\"lr\": 0.001},\n       \"epochs\": 4,\n       \"batch_size\":4\n    },\n    \"inference_params\":{\n        \"datetime_start\": \"2020-11-08\",\n        \"hours_to_forecast\": 5,\n        \"test_csv_path\":\"chicago_df.csv\",\n        \"decoder_params\":{\n            \"decoder_function\": \"simple_decode\", \n            \"unsqueeze_dim\": 1\n        } \n    },\n    \"GCS\": False,\n   \n    \"wandb\": {\n       \"name\": \"avocado_training\",\n       \"tags\": [\"DA-RNN\", \"avocado_forecast\",\"forecasting\"],\n       \"project\": \"avocado_flow_forecast\"\n    },\n   \"forward_params\":{},\n   \"metrics\":[\"DilateLoss\", \"MSE\", \"L1\"]\n}","c65d649a":"from flood_forecast.trainer import train_function\nfrom kaggle_secrets import UserSecretsClient\nuser_secrets = UserSecretsClient()\nsecret_value_0 = user_secrets.get_secret(\"WANDB_KEY\")\nos.environ[\"WANDB_API_KEY\"] = secret_value_0\ntrain_function(\"PyTorch\", the_config)","f99f6cc7":"# Forecasting Avocado Prices with Flow Forecast\n\n[Flow Forecast is a deep learning for time series forecasting, classification, and anomaly detection framework built in PyTorch](https:\/\/github.com\/AIStream-Peelout\/flow-forecast). In this notebook we will use FF to train a model to forecast the prices of avocados in Chicago (US region). [This tutorial appeared in a presentation on Flow Forecast\/Deep Time Series at AICamp (11.15.20)](https:\/\/www.youtube.com\/watch?v=dZzs0EdFkiE). "}}