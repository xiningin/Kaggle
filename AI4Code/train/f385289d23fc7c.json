{"cell_type":{"dc1a08d0":"code","a181c559":"code","7df20d34":"code","52f7797d":"code","4dcfdb6f":"code","dd8fa7b4":"code","fbcae93f":"code","7271b8b9":"code","2c1cef02":"code","22290a57":"code","28f895f1":"code","53d3e167":"code","67bc7a76":"code","20733443":"code","35baa3b9":"code","b34dcf41":"code","a9e86d3e":"code","35b34ab2":"code","11b91f23":"code","12ebe708":"code","54050180":"code","6ba4d912":"code","a9c7b81d":"code","25587c81":"code","2dbebd55":"code","8ba97f1e":"code","2b915ac5":"code","bb6fc561":"code","94287fd6":"markdown","6653a702":"markdown","30af8249":"markdown","dfbf4263":"markdown","b7bc5805":"markdown","b84945f5":"markdown","42079520":"markdown","0d927b02":"markdown","04d5a41d":"markdown","37fd1e88":"markdown","6511e811":"markdown"},"source":{"dc1a08d0":"# packages\n\n# standard\nimport numpy as np\nimport pandas as pd\nimport time\n\n# plots\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport seaborn as sns\n\n# statistics\nfrom scipy import stats\nfrom scipy.stats import t\n\n# distribution fits\nfrom fitter import Fitter, get_common_distributions, get_distributions","a181c559":"# read file\ndf_train = pd.read_csv('..\/input\/optiver-realized-volatility-prediction\/train.csv')\ndf_train.head()","7df20d34":"# data frame overview\ndf_train.info()","52f7797d":"# stock id frequencies\nstock_id_freqs = df_train.stock_id.value_counts()\nprint(stock_id_freqs)","4dcfdb6f":"# show all stocks\nstock_ids = stock_id_freqs.index.tolist()\nstock_ids.sort()\nprint(stock_ids)","dd8fa7b4":"# look for stocks with incomplete history\nincomplete_stocks = stock_id_freqs[stock_id_freqs<3830].index.tolist()\nprint('Incomplete history for the following stocks:', incomplete_stocks)\nprint('This results in', 112*3830 - stock_id_freqs.sum(), 'gaps')","fbcae93f":"# visualize gaps\ndf_train_incomplete = df_train[df_train.stock_id.isin(incomplete_stocks)]\ngap_matrix = pd.crosstab(df_train_incomplete.time_id, df_train_incomplete.stock_id)\nplt.figure(figsize=(3,30))\nsns.heatmap(gap_matrix, cbar=False)\nplt.show()","7271b8b9":"# time id frequencies\ntime_id_freqs = df_train.time_id.value_counts()\nprint(time_id_freqs)","2c1cef02":"# numerical stats for time_id\ndf_train.time_id.describe()","22290a57":"# plot volas for each stock\nfig, axs = plt.subplots(28, 4, figsize=(16,128))\ni = 0\nfor si in stock_ids:\n    current_ax = axs.flat[i]\n    df_temp = df_train[df_train.stock_id==si]\n    current_ax.plot(df_temp.time_id, df_temp.target)\n    current_ax.set_title('Stock Id = ' + str(si))\n    current_ax.grid()\n    i = i + 1","28f895f1":"# target basic stats\ndf_train.target.describe()","53d3e167":"# plot target distribution\nplt.figure(figsize=(8,4))\ndf_train.target.plot(kind='hist', bins=100)\nplt.title('Target')\nplt.grid()\nplt.show()","67bc7a76":"# boxplot\nplt.figure(figsize=(8,2))\nplt.boxplot(df_train.target, vert=False)\nplt.title('Target - Boxplot')\nplt.grid()\nplt.show()","20733443":"# logarithmic plot\nplt.figure(figsize=(8,4))\nnp.log10(df_train.target).plot(kind='hist', bins=100)\nplt.title('log10(Target)')\nplt.grid()\nplt.show()","35baa3b9":"# boxplot\nplt.figure(figsize=(8,2))\nplt.boxplot(np.log10(df_train.target), vert=False)\nplt.title('log10(Target) - Boxplot')\nplt.grid()\nplt.show()","b34dcf41":"# zoom in an example \/ scatter plot\nmy_stock = 0\n\ndf_pick = df_train[df_train.stock_id==my_stock].copy()\n\nplt.figure(figsize=(14,6))\nplt.scatter(df_pick.time_id, df_pick.target, alpha=0.5)\nplt.title('Stock '+str(my_stock))\nplt.grid()","a9e86d3e":"# show distribution\nplt.figure(figsize=(8,4))\ndf_pick.target.plot(kind='hist', bins=100)\nplt.title('Vola - Histogram')\nplt.grid()\nplt.show()","35b34ab2":"# plot increments\ndf_pick['diff_target'] = df_pick.target.diff()\n\nplt.figure(figsize=(14,6))\nplt.scatter(df_pick.time_id, df_pick.diff_target, alpha=0.5)\nplt.title('Stock '+ str(my_stock) + ' - Vola Differences')\nplt.grid()","11b91f23":"# show distribution of increments\nplt.figure(figsize=(8,4))\ndf_pick.diff_target.plot(kind='hist', bins=100)\nplt.title('Vola Differences - Histogram')\nplt.grid()\nplt.show()","12ebe708":"# visualize vola vs previous vola\nxx = np.asarray(df_pick.target.shift(1)) # previous value (nan for first entry)\nyy = np.asarray(df_pick.target)\n\nplt.figure(figsize=(6,6))\nplt.scatter(xx[1:],yy[1:], alpha=0.2) # leave out first point (prev = nan)\n\n# add regression line\nmm,bb = np.polyfit(xx[1:],yy[1:],1)\nplt.plot(xx, mm*xx + bb, c='magenta')\nplt.title('Vola n vs n-1')\nplt.xlabel('Vola n-1')\nplt.ylabel('Vola n')\nplt.grid()\nplt.show()","54050180":"# correlation\nstats.pearsonr(xx[1:], yy[1:])","6ba4d912":"# visualize vola-INCREMENT vs previous vola-INCREMENT\nxx = np.asarray(df_pick.diff_target.shift(1))\nyy = np.asarray(df_pick.diff_target)\n\nplt.figure(figsize=(6,6))\nplt.scatter(xx[2:],yy[2:], alpha=0.2) # leave out first two points (nan)\n# add regression line\nmm,bb = np.polyfit(xx[2:],yy[2:],1)\nplt.plot(xx, mm*xx + bb, c='magenta')\nplt.title('Incremental Vola - n vs n-1')\nplt.xlabel('Diff.Vola n-1')\nplt.ylabel('Diff.Vola n')\nplt.grid()\nplt.show()","a9c7b81d":"# correlation\nstats.pearsonr(xx[2:], yy[2:])","25587c81":"# check for further autocorrelations\nplt.figure(figsize=(10,5))\nplt.acorr(df_pick.diff_target[2:], maxlags=20)\nplt.title('Autocorrelations of incremental vola')\nplt.grid()\nplt.show()","2dbebd55":"# try to fit a few distribution types\n# for full list of available distributions use \"get_distributions()\"\ndist_fits = Fitter(df_pick.diff_target[2:], distributions=['norm','beta','cauchy','t'])\ndist_fits.fit()\nplt.figure(figsize=(12,5))\ndist_fits.summary()","8ba97f1e":"# get best fit and corresponding parameters\nbest_fit = dist_fits.get_best(method = 'sumsquare_error')\nprint(best_fit)","2b915ac5":"# let's check if we can reproduce the fitted distribution\nx = np.linspace(-0.03,0.03,100)\nplt.plot(x, t.pdf(x, \n                  df=best_fit['t'][0],\n                  loc=best_fit['t'][1],\n                  scale=best_fit['t'][2]))\nplt.title('Fitted t-distribution')\nplt.grid()\nplt.show()","bb6fc561":"# export for potential further analyses\ndf_pick.to_csv('example.csv')","94287fd6":"<a id='3'><\/a>\n# Target (vola) distribution","6653a702":"<a id='1'><\/a>\n# Basic evaluations","30af8249":"#### t-distribution seems to work best here...","dfbf4263":"### Distribution fits on vola-increments:","b7bc5805":"<a id='4'><\/a>\n# Pick an example for deep-dive","b84945f5":"<a id='2'><\/a>\n# Plot all stocks","42079520":"### Logarithmic view:","0d927b02":"# Table of Contents\n* [Basic evaluations](#1)\n* [Plot all stocks](#2)\n* [Target (vola) distribution](#3)\n* [Pick an example for deep-dive](#4)","04d5a41d":"### We have 112 different stocks with a maximum of 3830 observations for each.","37fd1e88":"#### Only lag 1 shows significant autocorrelation...","6511e811":"Parameters are degree of freedom, location and scale here..."}}