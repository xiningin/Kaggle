{"cell_type":{"3417a2aa":"code","f4f5e8ab":"code","e517dd8b":"code","fee5c983":"code","e680f39d":"code","d305ec48":"code","4ed18359":"code","9dc1e45f":"code","e8aee4cb":"code","19c0c357":"code","78e943a7":"code","4c9f648e":"code","14fe510b":"code","67054f4b":"code","1719f4c8":"code","721f5f60":"code","d79c2563":"code","4c71d4d5":"code","2b04e198":"code","17c24687":"code","54b528f2":"code","7d1bfb6d":"code","90a76e4c":"code","e87efd8c":"code","4add166e":"code","5414ba7f":"code","a3715a96":"code","0432045d":"code","9b32471f":"code","c9d18811":"code","18230e6c":"code","33fb3679":"code","5560d757":"code","8128a07a":"code","ef4dffa4":"code","34af6166":"code","d3d34c74":"code","38abcbcf":"code","a45ce04f":"code","390d4b08":"code","550cd48f":"code","91b85b9f":"code","5ace8f9e":"code","90b485bc":"code","19c91a02":"code","3b598165":"code","39abe64c":"code","24af9fff":"code","3560520a":"code","787b6107":"code","db20b88f":"code","9caa9d48":"code","9f41ff41":"code","df52f4ec":"code","328fc48b":"code","5a521755":"code","3a6553a9":"code","7707457f":"code","72355b6f":"code","32d1b1ad":"code","d8d0355f":"code","47d3b7e4":"code","7b48056f":"code","9c4efbde":"code","ac27b615":"code","3477d327":"markdown","ec5fe900":"markdown","795685cc":"markdown","ddec23e5":"markdown","269efadf":"markdown","1e8b2527":"markdown","ce3bc02b":"markdown","a704370d":"markdown","a84dcacd":"markdown","51615ea7":"markdown","42fe2b95":"markdown","f48684fa":"markdown","52b59e74":"markdown","95efd52c":"markdown","e268be95":"markdown","a5fcf6ce":"markdown","a3c43540":"markdown","952a3350":"markdown","4f562251":"markdown","10325419":"markdown","ac484042":"markdown","ab2a85f2":"markdown","f386f98e":"markdown","c24ce99a":"markdown","11d63323":"markdown","c11ed56f":"markdown","8197693f":"markdown","bb899731":"markdown","7430695d":"markdown","de0dad73":"markdown","65b3c116":"markdown","3bda8d02":"markdown","3bd0b0c4":"markdown","0dec76a4":"markdown","ff5f94dd":"markdown","7980dfa0":"markdown","be0839d8":"markdown","f0273cea":"markdown","a45ca36d":"markdown","de745be5":"markdown","02e0ce73":"markdown","15882b62":"markdown","a1607ddd":"markdown","cab023ca":"markdown","44bd5849":"markdown","d002831d":"markdown","ae612664":"markdown","073c9971":"markdown","3b0855c2":"markdown"},"source":{"3417a2aa":"from IPython.display import IFrame\nembed = \"https:\/\/docs.google.com\/presentation\/d\/e\/2PACX-1vTFUKkshFjS3SpFm392ru6L5CVemXbfU2Op1NaaEFiW16x4Je70wKbiR0u_TcR0UyqOiINeGCNVUquK\/embed?\"\nIFrame(embed,frameborder=\"0\", width=\"900\", align=\"center\", height=\"569\", allowfullscreen=\"true\", mozallowfullscreen=\"true\", webkitallowfullscreen=\"true\")","f4f5e8ab":"#Import necessary libraries\nimport pandas as pd\nimport numpy as np\n\n# Plotting modules\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# Analysing datetime\nfrom datetime import datetime as dt\nfrom datetime import timedelta\n\n# File system manangement\nimport os,sys\n\n# Suppress warnings \nimport warnings\nwarnings.filterwarnings('ignore')\n\n#Interactive Shell\nfrom IPython.core.interactiveshell import InteractiveShell  \nInteractiveShell.ast_node_interactivity = \"all\"\n\n#Pandas profiling\nfrom pandas_profiling import ProfileReport\n\nimport missingno as msno\nimport re \n\n%matplotlib inline","e517dd8b":"cwd = os.getcwd()\nprint(cwd)","fee5c983":"os.listdir(cwd)\n#os.listdir( os.getcwd() )","e680f39d":"#KAGGLE.com\npath = '\/kaggle\/input\/calcofi\/bottle.csv'\nbottle = pd.read_csv(path) ","d305ec48":"# Import CSV file and read the dataset\n#path = '..\/data\/calcofi\/bottle.csv'\n#bottle = pd.read_csv(path, encoding='latin-1') ","4ed18359":"# Show all columns\npd.set_option('max_columns', None)","9dc1e45f":"bottle.head()","e8aee4cb":"bottle.tail(3)","19c0c357":"# Convert Celcius to Fahr\ndef cel_to_fahr(x):\n    x = x * 1.8 + 32\n    return float(x)","78e943a7":"# Dimensions of the dataset. #(samples,features)\nprint(\"There are\", bottle.shape[0], \"Rows(Observations).\")\nprint(\"There are\", bottle.shape[1], \"Columns(Features).\")\nbottle.shape","4c9f648e":"newfolder = \"..\/OceanographicAnalysisCalCOFI\/data\"\n\ntry:\n    os.mkdir(newfolder)\nexcept OSError:\n    print (\"Creation of the directory %s failed\" % newfolder)\nelse:\n    print (\"Successfully created the directory %s \" % newfolder)","14fe510b":"newfolder = \"..\/OceanographicAnalysisCalCOFI\/figures\"\n\ntry:\n    os.mkdir(newfolder)\nexcept OSError:\n    print (\"Creation of the directory %s failed\" % newfolder)\nelse:\n    print (\"Successfully created the directory %s \" % newfolder)","67054f4b":"newfolder = \"..\/OceanographicAnalysisCalCOFI\/models\"\n\ntry:\n    os.mkdir(newfolder)\nexcept OSError:\n    print (\"Creation of the directory %s failed\" % newfolder)\nelse:\n    print (\"Successfully created the directory %s \" % newfolder)","1719f4c8":"# Get DataFrame Information\nbottle.info()","721f5f60":"bottle.dtypes.value_counts()","d79c2563":"print(bottle.columns)","4c71d4d5":"#Counts and percentage of null values \ndictionary = {\n    \"NullCount\":bottle.isnull().sum().sort_values(ascending=False),\n    \"NullPercent\":bottle.isnull().sum().sort_values(ascending=False)\/len(bottle)*100\n}\n\nna_df = pd.DataFrame(dictionary)\nna_df.columns = ['NullCount','NullPercent']\nna_df[(na_df['NullCount'] > 0)].reset_index()\n","2b04e198":"pct_null = bottle.isnull().sum() \/ len(bottle)\nmissing_features = pct_null[pct_null > 0.19].index\nbottle.drop(missing_features, axis=1, inplace=True)\ndf = bottle","17c24687":"# Visualize Missingness\nmsno.matrix(df)\nplt.show()","54b528f2":"print ( df.nunique() \/ df.shape[0] * 100 )","7d1bfb6d":"df.head()","90a76e4c":"df.columns","e87efd8c":"df = df.rename(columns = { \n    \"Cst_Cnt\": \"CastCount\",\n    \"Btl_Cnt\": \"BottleCount\",\n    \"Depthm\": \"DepthMeters\",\n    \"T_degC\": \"TempDegC\",\n    \"Salnty\": \"Salinity\",    \n    \"STheta\": \"PDensity\"\n    \n})","4add166e":"df = df.set_index('BottleCount')","5414ba7f":"# Extract Year\nsearch = []    \n\nfor values in df['Depth_ID']:\n    search.append(re.search(r'\\d{2}-\\d{2}', values).group())\n    \ndf['Year'] = search\ndf['Year'] = df['Year'].replace(to_replace='-',value='', regex = True) \n\ndf['Year'] = pd.to_datetime(df['Year']).values.astype('datetime64[Y]')\ndf['Year'] =  pd.DatetimeIndex(df['Year']).year","a3715a96":"# Extract Month \nsearch = []    \n\nfor values in df['Depth_ID']:\n    search.append(re.search(r'-\\d+', values).group())\n    \ndf['Month'] = search\ndf['Month'] = df['Month'].str[-2:]\n\ndf['Month'] = df['Month'].astype('int64')","0432045d":"df['TempDegF'] = df['TempDegC'].apply(cel_to_fahr)\ndf = df.drop(\"TempDegC\", axis = 1)","9b32471f":"print('Salinity:', df.Salinity.unique() ) \nprint('TempDegF:', df.TempDegF.unique() ) ","c9d18811":"df.describe(include=\"all\").T","18230e6c":"range = df.aggregate([min, max])\nprint(range)","33fb3679":"sns.boxplot(x='Year',data=df)","5560d757":"df['Year'] = df['Year'].drop(df[df['Year']>2020].index)","8128a07a":"df['Month'] = df['Month'].drop(df[df['Month']>12].index)","ef4dffa4":"df[\"Salinity\"].describe(include=\"all\").T","34af6166":"df[\"TempDegF\"].describe(include=\"all\").T","d3d34c74":"duplicateRowsDF = df.duplicated() \ndf[duplicateRowsDF]","38abcbcf":"df.drop_duplicates(inplace=True)","a45ce04f":"df.shape","390d4b08":"dfo = df.select_dtypes(include=['object'], exclude=['datetime'])\ndfo.shape\n#get levels for all variables\nvn = pd.DataFrame(dfo.nunique()).reset_index()\nvn.columns = ['VarName', 'LevelsCount']\nvn.sort_values(by='LevelsCount', ascending = False)","550cd48f":"df = df.drop(['Depth_ID','Sta_ID'],axis=1)","91b85b9f":"corr = df.corr()\n\nplt.figure(figsize=(20,10))\nsns.heatmap(corr,\n            linecolor='blue',linewidths=.1, \n            cmap=\"YlGnBu\", annot=True)\nplt.yticks(rotation=0);","5ace8f9e":"df = df.drop(['CastCount','R_Depth','R_TEMP', 'R_SALINITY', 'C14A1q', 'C14A2q', 'DarkAq' ], axis=1)","90b485bc":"from sklearn.preprocessing import StandardScaler\n\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.impute import SimpleImputer","19c91a02":"numeric_transformer = Pipeline(\n    steps=[\n        ('imputer', SimpleImputer(strategy='mean')),\n        ('scaler', StandardScaler())\n])\n\nnumeric_features = df.select_dtypes(include=['int64', 'float64']).columns\n\npreprocessor = ColumnTransformer(\n    remainder='passthrough',\n    transformers=[\n        ('num', numeric_transformer, numeric_features),\n    ]\n)\n\nsteps = [('preprocessor', preprocessor)]\n\npipeline = Pipeline(steps)\n\npipeline.fit(df[:])\ndf_pipe = pipeline.transform(df[:])","3b598165":"df_pipe = pd.DataFrame(df_pipe)\ndf_pipe","39abe64c":"#Change the name of columns back to original names.\ndf_pipe.columns = df.columns\n\ndf_pipe.sample()","24af9fff":"from sklearn.model_selection import train_test_split, cross_val_score\nfrom sklearn.metrics import mean_squared_error\n\n\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor","3560520a":"column_names = [\"Salinity\",\"TempDegF\"]\nsal_temp = df.reindex(columns=column_names)","787b6107":"sal_temp['Salinity'].fillna((sal_temp['Salinity'].mean()), inplace=True)\nsal_temp['TempDegF'].fillna((sal_temp['TempDegF'].mean()), inplace=True)","db20b88f":"sal_temp.head()","9caa9d48":"X = sal_temp.Salinity.values\ny = sal_temp.TempDegF.values\n\n# Print the dimensions of X and y before reshaping\nprint(\"Dimensions of y before reshaping: {}\".format(y.shape))\nprint(\"Dimensions of X before reshaping: {}\".format(X.shape))\n\n# Reshape X and y\ny = y.reshape(-1,1)\nX = X.reshape(-1,1)\n\n# Print the dimensions of X and y after reshaping\nprint(\"Dimensions of y after reshaping: {}\".format(y.shape))\nprint(\"Dimensions of X after reshaping: {}\".format(X.shape))\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.25, random_state = 12)","9f41ff41":"model = LinearRegression()\nmodel.fit(X_train, y_train)\n\n#Predict the Test set results\ny_pred = model.predict(X_test)","df52f4ec":"_= plt.scatter(X_train, y_train, color = 'red')\n_= plt.plot(X_train, model.predict(X_train), color = 'blue')\n_= plt.title('Temperature vs Salinity (Training set)')\n_= plt.xlabel('Salinity')\n_= plt.ylabel('Temperature')\n_= plt.show()","328fc48b":"_= plt.scatter(X_test, y_test, color = 'red')\n_= plt.plot(X_train, model.predict(X_train), color = 'blue')\n_= plt.title('Temperature vs Salinity (Training set)')\n_= plt.xlabel('Salinity')\n_= plt.ylabel('Temperature')\n_= plt.show()","5a521755":"X = df_pipe.drop(['TempDegF'],axis=1).values\ny = df_pipe.TempDegF.values\n\nSEED = 42\nTS = 0.30\n\n# Create training and test sets\nX_train, X_test, y_train, y_test = \\\n    train_test_split(X, y, test_size = TS, random_state=SEED)\n\n#Feature Scaling to prevent information leakage\n#sc = StandardScaler()\n#X_train = sc.fit_transform(X_train)\n#X_test = sc.transform(X_test)\n\nprint (X_train.shape)\nprint (y_train.shape)\n\nprint (X_test.shape)\nprint (y_test.shape)","3a6553a9":"# Create logistic regression model\nlinreg = LinearRegression()\n\n# Train the model using the training sets\nlinreg.fit(X_train, y_train)\n\n# Make predictions using the testing set\ny_pred = linreg.predict(X_test)\n\nlinreg.score(X_test,y_test)\n\nlinreg_training_score = round(linreg.score(X_train, y_train) * 100, 2)\nlinreg_test_score = round(linreg.score(X_test, y_test) * 100, 2)\n\nprint('Linear Regression Training Score: \\n', linreg_training_score)\nprint('Linear Regression Test Score: \\n', linreg_test_score)\n\n# Compute and print R^2 and RMSE\nrmse = np.sqrt(mean_squared_error(y_test, y_pred))\nprint(\"Root Mean Squared Error: {}\".format(rmse))","7707457f":"# 5-fold cross-validation:\ncv_scores_5 = cross_val_score(linreg, X, y, cv=5)\nprint(\"Average 5-Fold CV Score: {}\".format(np.mean(cv_scores_5)))\n\n\n# 15-fold cross-validation:\ncv_scores_15 = cross_val_score(linreg, X, y, cv=15)\nprint(\"Average 15-Fold CV Score: {}\".format(np.mean(cv_scores_15)))\n\n# 25-fold cross-validation:\ncv_scores_25 = cross_val_score(linreg, X, y, cv=25)\nprint(\"Average 25-Fold CV Score: {}\".format(np.mean(cv_scores_25)))","72355b6f":"dtr = DecisionTreeRegressor(random_state=42)\nmodel = dtr.fit(X_train, y_train)\n\ny_pred = model.predict(X_test)\n\n\ndtr_training_score = round(model.score(X_train, y_train) * 100, 2)\ndtr_test_score = round(model.score(X_test, y_test) * 100, 2)\n\nprint('Decision Tree Training Score: \\n', dtr_training_score)\nprint('Decision Test Score: \\n', dtr_test_score)","32d1b1ad":"rfr = RandomForestRegressor(random_state=0, n_jobs=-1)\nmodel = rfr.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n\nrfr_training_score = round(model.score(X_train, y_train) * 100, 2)\nrfr_test_score = round(model.score(X_test, y_test) * 100, 2)\n\nprint('Random Forest Training Score: \\n', rfr_training_score)\nprint('Random Forest Test Score: \\n', rfr_test_score)\n\n# We will look at the predicted prices to ensure we have something sensible.\n","d8d0355f":"print(y_pred)","47d3b7e4":"models = pd.DataFrame({\n    \n    'Model': [ \n        'Linear Regression',\n        'Decision Tree',\n        'Random Forest',   \n    ],\n             \n    \n    'Training Score': [ \n        linreg_training_score,\n        dtr_training_score, \n        rfr_training_score,\n    ],\n    \n    'Test Score': [ \n        linreg_test_score,\n        dtr_test_score,\n        rfr_test_score,\n    ]})\n\n\nmodels.sort_values(by='Test Score', ascending=False)","7b48056f":"df.aggregate([min, max])","9c4efbde":"#df.to_csv('..\/data\/calcofi\/wrangle_csv.csv', index=True)","ac27b615":"my_submission = pd.DataFrame({'Id': df_pipe.index, 'Temperature': print(y_pred)})\n# you could use any filename. We choose submission here\nmy_submission.to_csv('submission.csv', index=False)","3477d327":"# 6. DOCUMENTATION","ec5fe900":"There are no missing values. AppointmentDay and ScheduledDay should be converted to datetime. There are 3 objects (Gender, Neighborhood, and No-show)","795685cc":"### Set BottleCount to be Index","ddec23e5":"C14A1q, C14A2q, DarkAq, and MeanAq all have a high correlation so we will keep MeanAq. The Reported Depth, Salinity, temp, and R_DYNHT have a positive correlation with the actual findings so we will only keep the Reported Dynamic Height.  ","269efadf":"### Explore the Data","1e8b2527":"#### Last 3 rows","ce3bc02b":"## RANDOM FOREST:","a704370d":"# 2. Data Wrangling\n- Collect, organize, define, and clean relevant datasets.","a84dcacd":"## Multiple Linear Regression:","51615ea7":"#### Variable Types","42fe2b95":"Currently, we are in 2020. We will remove all the years after that including 2093","f48684fa":"### Summary\nThis is Supervised Regression project to analyze Oceanographic trends.\n\nTemperature (TempDegF) is the target variable. Celsius was converted to Fahrenheit. 34 to 88 degrees F.  \n\nThe bottle samples were the observations and they were collected from 1949 to 2019.\nThe Salinity of the water was between 28 to 37.\nThe depth was between 0 to 5351 meters. \n\n### Data Preprocessing:\nDropped 15 duplicated rows. \nA Pipeline was used to direct the process of first imputing missing data by the mean using 'SimpleImputer', then 'StandardScaler' to scale\nthe dataframe. \nFor simple linear regression, only Salinity and Temperature was used. The pandas fillna method by the mean was implemented for missing values. \n\n\n### Model Performance:\nAccuracy Score: R^2: was used to determine the best model.\n\n### Model Findings:\nThe most important features where: \n- 1. Salinity()\n- 2. Temperature()\n\nThe reported Dynamic Height improved the model was removed then added to model because it improved the R^2 score significantly. ","52b59e74":"## Simple Linear Regression:","95efd52c":"### Extract Year and Month from Depth_ID ","e268be95":"---","a5fcf6ce":"## Dataset Statistics","a3c43540":"#### Visualize the Test set results","952a3350":"#### Range of values per column","4f562251":"#### First 5 rows ","10325419":"# 5. MODELING","ac484042":"The dataset has months of more than 12, so we will drop them too.","ab2a85f2":"## Data Organization","f386f98e":"## Detect Anomalies & Outliers","c24ce99a":"# 4. PreProcessing","11d63323":"---","c11ed56f":"## EXPORT DATA...","8197693f":"###  <font color='blue'>Problem Statement<\/font>\n<strong>Help policy makers understand oceanographic trends to make intelligent choices that will save the marine ecosystem.<\/strong>\n\n### Summary\nThe California Cooperative Oceanic Fisheries Investigations (CalCOFI) are a unique partnership of the California Department of Fish & Wildlife, NOAA Fisheries Service and Scripps Institution of Oceanography. The organization was formed in 1949 to study the ecological aspects of the sardine population collapse off California. Today their focus has shifted to the study of the marine environment off the coast of California, the management of its living resources, and monitoring the indicators of El Nino and climate change. CalCOFI conducts quarterly cruises off southern & central California, collecting a suite of hydrographic and biological data on station and underway.  Data collected at depths down to 500 meters include: temperature, salinity, oxygen, phosphate, silicate, nitrate and nitrite, chlorophyll, transmissometer, PAR, C14 primary productivity, phytoplankton biodiversity, zooplankton biomass, and zooplankton biodiversity.\n\n### Overview\n<p>Oceonography, the study of the biological features of the ocean, is important to determine the factors threatening the ocean and its marine life. Studying the ocean is also importance since it covers more than 70 percent of the surface of our planet.\nAccording to NASA, big shifts in salinity could be a warning that more severe droughts and floods are on their way, or even that global warming is speeding up.\n<\/p>\n\n### Context\nSince climate changes today has been altering the ocean\u2019s chemistry, it is important to understand the trends that are threatening the ocean and its marine life. The changes in temperature effects the melting of ice, and changes in sea levels and ocean currents.  \nThe migration pattern of marine species disrupts, and some marine species are on the verge of extinction.\n\n### Criteria for Success\nBuild a model that can accurately obtain and predict the factors affecting the ocean.\n\n### Scope of Solution Space\nDetermine the top 5 important features that are useful to predict the factors threatening the ocean.\nBuild additional features out of existing data (Feature Engineering) and perform Exploratory Data Analysis.\n\n### Constraints within Solution Space\nThere are 61 features, but most of them have missing data.\n\n### Data Acquisition and Key Data Sources\nThe data is provided from CalCOFI \n\nhttps:\/\/calcofi.org\/ccdata\/database.html\n\nThe following table includes the most important features of the dataset and their description.\n\n| | <strong>Features<\/strong> | <strong>Description<\/strong> |\n|------|------:|------|\n| 1 | Depthm | Depth of ocean in meters|\n| 2 | TempDegF | Temperature of Water in Fahrenheit|\n| 3 | Salinity | Salinity of water|\n| 4 | STheta | Potential Density of Water|\n","bb899731":"### Convert from Celsius to Fahrenheit","7430695d":"# 1. Problem Identification","de0dad73":"## SimpleImputer","65b3c116":"## Workspace","3bda8d02":"#  3. EXPLORATORY DATA ANALYSIS","3bd0b0c4":"### Split DataSet to Training set and Test set - For entire Pipeline","0dec76a4":"## Data Collection","ff5f94dd":"### Year - Month","7980dfa0":"## Load the Data from CSV File","be0839d8":"## DECISION TREE:","f0273cea":"### Rename Columns","a45ca36d":"On line 40 in the previous DataFrame we see that O2ml_L is missing 19.10% of data.  So we will delete all rows that has more than 19% of missing data. ","de745be5":"#### Visualize the Training set results","02e0ce73":"# Handling Missing Values","15882b62":"#### Categorical columns and their associated levels.","a1607ddd":"# Oceanographic Analysis - CalCOFI Capstone","cab023ca":"#### Create SubFolders","44bd5849":"___","d002831d":"#### Check for Duplicated Rows","ae612664":"### Functions","073c9971":"___","3b0855c2":"## Data Definition"}}