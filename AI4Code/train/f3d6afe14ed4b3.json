{"cell_type":{"bc0d682f":"code","235e171e":"code","fede45f9":"code","18bcfd58":"code","8f87cd93":"code","a5c118f2":"code","9b73eb33":"code","daca8565":"code","96116459":"code","55fd1684":"code","aa04d382":"code","2adf11b6":"code","b6608829":"code","7fd81a54":"code","f2d17496":"code","977e43b5":"code","d917cbe1":"code","b7e1da38":"code","98035e66":"code","e30cf501":"code","0023b913":"code","54c0215f":"code","4bf95197":"code","967f4bda":"markdown","0293038b":"markdown","e6463206":"markdown","aed4b5a4":"markdown","a62c680c":"markdown"},"source":{"bc0d682f":"import zipfile,sqlite3,os; import pandas as pd\nimport numpy as np,sympy as sp,pylab as pl\nfrom IPython.core.display import display, HTML\nfrom IPython.core.magic import register_line_magic\npl.rcParams['xtick.major.pad']='1'\n@register_line_magic\ndef get_query(q):\n    sp.pprint(r'SQL Queries')\n    tr=[]; cursor.execute(q)\n    result=cursor.fetchall()\n    for r in result: \n        tr+=[r]\n    display(pd.DataFrame.from_records(tr)\\\n              .style.set_table_styles(style_dict))\ndef connect_to_db(dbf):\n    sqlconn=None\n    try:\n        sqlconn=sqlite3.connect(dbf)\n        return sqlconn\n    except Error as err:\n        print(err)\n        if sqlconn is not None:\n            sqlconn.close()\nconnection=connect_to_db('example.db')\nif connection is not None:\n    cursor=connection.cursor()\nthp=[('font-size','15px'),('text-align','center'),\n     ('font-weight','bold'),('padding','5px 5px'),\n     ('color','white'),('background-color','slategray')]\ntdp=[('font-size','14px'),('padding','5px 5px'),\n     ('text-align','center'),('color','darkblue'),\n     ('background-color','silver')]\nstyle_dict=[dict(selector='th',props=thp),\n            dict(selector='td',props=tdp)]\nfp='..\/input\/sberbank-russian-housing-market\/'\nfp2='..\/input\/meals-programs-in-seattle\/'\n[os.listdir(),os.listdir('..\/input'),\nos.listdir('..\/input\/sberbank-russian-housing-market'),\nos.listdir('..\/input\/meals-programs-in-seattle')]","235e171e":"fpath='https:\/\/data.cityofnewyork.us\/resource\/'\nse=pd.read_json(fpath+'h7rb-945c.json')\nfl=['dbn','total_students',\n    'graduation_rate','attendance_rate',\n    'latitude','longitude',\n    'city','council_district']\nse=se[fl].dropna().astype({'council_district':'int'})\nse.to_sql('schooledu',con=connection,if_exists='replace')\nse.head(int(10)).style\\\n  .set_table_styles(style_dict)","fede45f9":"# from csv\nurl='https:\/\/raw.githubusercontent.com\/plotly\/'+\\\n    'datasets\/master\/2016-weather-data-seattle.csv'\nweather=pd.read_csv(url).dropna()\nweather=weather.astype({'Mean_TemperatureC':'int64',\n                        'Min_TemperatureC':'int64'})\nweather.to_sql('weather',con=connection,\n               if_exists='replace')\nweather.describe().style\\\n       .set_table_styles(style_dict)","18bcfd58":"# from csv\nurl='https:\/\/raw.githubusercontent.com\/'+\\\n    'OlgaBelitskaya\/machine_learning_engineer_nd009\/'+\\\n    'master\/Machine_Learning_Engineer_ND_P3\/customers.csv'\ncustomers=pd.read_csv(url).dropna()\ncustomers.to_sql('customers',con=connection,\n                 if_exists='replace')\ncustomers.head(7).style\\\n         .set_table_styles(style_dict)","8f87cd93":"# from csv\nurl=fp2+'meals-programs-in-seattle.csv'\nmeals=pd.read_csv(url).dropna()\nmeals.to_sql('meals',con=connection,\n             if_exists='replace')\nmeals.tail(2).T.style\\\n     .set_table_styles(style_dict)","a5c118f2":"# from csv\nurl=fp+'macro.csv.zip'\nmacro=pd.read_csv(url)\nfl=['timestamp','oil_urals','brent','cpi','ppi',\n    'usdrub','eurrub','salary','salary_growth',\n    'unemployment','employment','average_life_exp',\n    'pop_natural_increase','childbirth']\nmacro=macro[fl].dropna()\nmacro.to_sql('macro',con=connection,\n             if_exists='replace')\nmacro.tail(int(7)).T.style\\\n     .set_table_styles(style_dict)","9b73eb33":"# from csv\nzipf=zipfile.ZipFile(fp+'train.csv.zip','r')\nzipf.extractall(''); zipf.close()\nhousing=pd.read_csv('train.csv')\nfnum=['timestamp','full_sq','floor','max_floor','num_room',\n      'area_m','kremlin_km','big_road2_km','big_road1_km',\n      'workplaces_km','stadium_km','swim_pool_km','fitness_km',\n      'detention_facility_km','cemetery_km','radiation_km',\n      'oil_chemistry_km','theater_km','exhibition_km','museum_km',\n      'park_km','public_healthcare_km','metro_min_walk',\n      'metro_km_avto', 'bus_terminal_avto_km',\n      'public_transport_station_min_walk',\n      'railroad_station_walk_min','railroad_station_avto_km',\n      'kindergarten_km','school_km','preschool_km',\n      'university_km','additional_education_km',\n      'shopping_centers_km','big_market_km','ekder_all',\n      'work_all','young_all']\nfcat=['sub_area','ID_metro','office_raion',\n      'raion_popul','healthcare_centers_raion',\n      'school_education_centers_raion','sport_objects_raion',\n      'preschool_education_centers_raion']\nhousing=housing[fnum+fcat].dropna()\nhousing.to_sql('housing',con=connection,\n               if_exists='replace')\nhousing.tail(int(5)).T.style\\\n       .set_table_styles(style_dict)","daca8565":"# from csv\nurl='https:\/\/raw.githubusercontent.com\/noahgift\/'+\\\n    'mma\/master\/data\/ufc_fights_all.csv'\nmma=pd.read_csv(url).dropna()\nmma.to_sql('mma',con=connection,\n           if_exists='replace')\nmma.tail(int(2)).T.style\\\n   .set_table_styles(style_dict)","96116459":"%get_query \\\nSELECT * \\\nFROM sqlite_master;","55fd1684":"%get_query \\\nPRAGMA table_info(\"macro\")","aa04d382":"%get_query \\\nSELECT CURRENT_TIMESTAMP;","2adf11b6":"%get_query \\\nSELECT DISTINCT * \\\nFROM (VALUES ('x'),('y'),('z'),\\\n             ('X'),('Y'),('Z'),\\\n             ('x'),('y'),('z'))","b6608829":"%get_query \\\nSELECT DISTINCT Name_of_Program As programs \\\nFROM meals \\\nWHERE People_Served=\"OPEN TO ALL\";","7fd81a54":"pd.read_sql_query('''\nSELECT \"\ud83d\udcd1 \"||dbn||\" \ud83c\udfd9 \"||city AS dbn_city,graduation_rate\nFROM schooledu\nWHERE city=\"Bronx\" AND dbn LIKE \"10%\" AND\ngraduation_rate>.9 AND graduation_rate<>\"N\/A\";\n''',con=connection)\\\n.style.set_table_styles(style_dict)","f2d17496":"pd.read_sql_query('''\nSELECT \" \ud83c\udfd9 \"||city||\" \ud83d\udcd1 \"||dbn AS dbn_city,\n       graduation_rate+attendance_rate \n       AS graduation_attendance_rate\nFROM schooledu\nWHERE graduation_attendance_rate<1.3 AND \ngraduation_rate<>\"N\/A\" AND attendance_rate<>\"N\/A\";\n''',con=connection)\\\n.style.set_table_styles(style_dict)","977e43b5":"q=pd.read_sql_query('''\nSELECT salary,average_life_exp,\n       employment,unemployment\nFROM macro;\n''',con=connection)\nq.plot(kind='kde',figsize=(6,12),\n       cmap=pl.cm.winter,\n       subplots=True,sharex=False)\npl.show()","d917cbe1":"q=pd.read_sql_query('''\nSELECT usdrub,eurrub,oil_urals,brent\nFROM macro;\n''',con=connection)\nfl=['usdrub','eurrub','oil_urals','brent']\nqp=q.plot(kind='line',figsize=(10,6),\n       secondary_y=fl[2:],cmap=pl.cm.winter)\nlines=qp.get_lines()+qp.right_ax.get_lines()\nqp.legend(lines,[l.get_label() for l in lines],\n          bbox_to_anchor=(.2,.6))\npl.grid(); pl.show()","b7e1da38":"display(weather\\\n        .groupby(weather['Date']\\\n                 .map(lambda x: x[-4:]))\\\n        .mean().tail().style\\\n        .set_table_styles(style_dict))\nq=pd.read_sql_query('''\nSELECT SUBSTR(Date,-4,4) AS Years,\n       AVG(Max_TemperatureC),\n       AVG(Mean_TemperatureC),\n       AVG(Min_TemperatureC)\nFROM weather\nGROUP BY Years;\n''',con=connection).set_index('Years')\nq.plot(kind='area',figsize=(6,4),\n       alpha=.7,cmap=pl.cm.tab10)\npl.show()\nq.tail().style.set_table_styles(style_dict)","98035e66":"fl=['Fresh','Milk','Grocery','Frozen',\n    'Detergents_Paper','Delicatessen']\ndisplay(customers[fl].where(customers.Fresh>50000)\\\n        .dropna().sort_values('Fresh',ascending=False)\\\n        .astype('int64').style.set_table_styles(style_dict))\nq=pd.read_sql_query('''\nSELECT Fresh,Milk,Grocery,Frozen,\n       Detergents_Paper,Delicatessen\nFROM customers\nWHERE Fresh>50000\nORDER BY Fresh DESC;\n''',con=connection)\nq.plot(kind='area',cmap=pl.cm.tab10,\n       alpha=.7,figsize=(6,4))\npl.show()\nq.style.set_table_styles(style_dict)","e30cf501":"fl=['workplaces_km','public_transport_station_min_walk',\n    'school_km','public_healthcare_km']\ndisplay(housing[fl]\\\n        .groupby(housing['ID_metro'])\\\n        .mean().tail(3).T.style\\\n        .set_table_styles(style_dict))\nq=pd.read_sql_query('''\nSELECT ID_metro,\n       AVG(workplaces_km),\n       AVG(public_transport_station_min_walk),\n       AVG(school_km),\n       AVG(public_healthcare_km)\nFROM housing\nGROUP BY ID_metro;\n''',con=connection).set_index('ID_metro')\nq.iloc[:,int(1):].plot(kind='area',figsize=(10,5),\n       alpha=.7,cmap=pl.cm.tab10)\npl.show()\nq.tail(3).T.style.set_table_styles(style_dict)","0023b913":"q=pd.read_sql_query('''\nSELECT method,\n       COUNT(*) AS number,\n       AVG(round) AS avg_round\nFROM mma\nGROUP BY method;\n''',con=connection).set_index('method')\nq.plot(secondary_y='avg_round',\n       figsize=(10,5),cmap=pl.cm.winter)\npl.show()\nq.tail().style.set_table_styles(style_dict)","54c0215f":"q=pd.read_sql_query('''\nSELECT method_d,\n       COUNT(*) AS number,\n       AVG(time) AS avg_time\nFROM mma\nGROUP BY method_d;\n''',con=connection)\nn,m=int(70),int(7)\npl.rcParams['xtick.major.pad']='-10'\npl.rcParams['xtick.bottom']=\\\npl.rcParams['xtick.labelbottom']=False\npl.rcParams['xtick.top']=\\\npl.rcParams['xtick.labeltop']=True\nqp=q.tail(n).plot(secondary_y='avg_time',\n                  figsize=(10,6),alpha=.5,\n                  lw=3,cmap=pl.cm.winter)\nqp.set_xticks(q.tail(n).index)\nqp.set_xticklabels(q.method_d[:n],va='top',\n                   fontsize=7,rotation=90)\nlines=qp.get_lines()+qp.right_ax.get_lines()\nqp.legend(lines,[l.get_label() for l in lines],\n          bbox_to_anchor=(.9,.5))\npl.show()\nq.tail(m).style.set_table_styles(style_dict)","4bf95197":"if connection is not None:\n    connection.close()\nif os.path.exists('example.db'):\n    os.remove('example.db')\nelse:\n    print('The file does not exist')\nos.remove('train.csv')\nos.listdir()","967f4bda":"## \ud83d\udcd1 The Database Structure","0293038b":"## \ud83d\udcd1 SQL & Pandas Comparing","e6463206":"## \ud83d\udcd1 Close the Connection and Delete This Database","aed4b5a4":"## \ud83d\udcd1 SQL Basic Queries","a62c680c":"#### [`SageMathCell Version`](https:\/\/olgabelitskaya.github.io\/sql_cookbook2.html) & [`SageMathCell Test Example`](https:\/\/olgabelitskaya.github.io\/sql_test.html)\n## \ud83d\udcd1 Creating SQL Databases"}}