{"cell_type":{"c16d8e36":"code","be32743c":"code","85b02120":"code","e59b7dd1":"code","a05969a5":"code","f60f043f":"code","7ed08c31":"code","1fcadfba":"code","f32ce6b2":"code","5d50957f":"code","d7e7dae8":"code","c85a5b03":"code","a1595cd1":"code","81ab2b2b":"markdown","a8250f68":"markdown","b4ecb0fc":"markdown","1240c16f":"markdown","d008abc1":"markdown","d190237e":"markdown","39551479":"markdown","9d58759e":"markdown","2cb0c832":"markdown","d3000550":"markdown","efcd3805":"markdown","161042b4":"markdown","9c2d85c3":"markdown","59e5a64e":"markdown","f5b92e5b":"markdown","02a97d05":"markdown","bf8c5499":"markdown","a4b86361":"markdown","4a606726":"markdown"},"source":{"c16d8e36":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom IPython.display import Image\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","be32743c":"import matplotlib.pyplot as plt\nimport seaborn as sns\nfrom plotly.subplots import make_subplots\nimport plotly.graph_objects as go\nimport plotly.express as px\nimport plotly.io as pio\npio.templates.default = \"plotly_dark\"\nsns.set()\npd.options.display.max_rows=1000\ntrain=pd.read_csv(\"\/kaggle\/input\/covid19-global-forecasting-week-1\/train.csv\")\ntrain['Date_str']=train['Date'].copy()\ntrain['Date']=pd.to_datetime(train['Date'])","85b02120":"pop_dict={'Afghanistan': 38928346,'Albania': 2877797,'Algeria': 43851044,'Andorra': 77265,'Argentina': 45195774,'Australia': 25499884,'Austria': 9006398,'Azerbaijan': 10139177,'Bahrain': 1701575,'Bangladesh': 164689383,'Belgium': 11589623,\n          'Bosnia and Herzegovina': 3280819,'Brazil': 212559417,'Bulgaria': 6948445,'Burkina Faso': 20903273,'Canada': 37742154,'Chile': 19116201,'China': 1439323776,'Colombia': 50882891,'Costa Rica': 5094118,'Croatia': 4105267,'Cuba': 11326616,\n          'Cyprus': 1207359,'Denmark': 5792202,'Dominican Republic': 10847910,'Ecuador': 17643054,'Egypt': 102334404,'Finland': 5540720,'France': 65273511,'Gabon': 2225734,'Germany': 83783942,'Ghana': 31072940,\n          'Greece': 10423054,'Guatemala': 17915568,'Guyana': 786552,'Hungary': 9660351,'Iceland': 341243,'India': 1380004385,'Indonesia': 273523615,'Iran': 83992949,'Iraq': 40222493,'Ireland': 4937786,'Israel': 8655535,'Italy': 60461826,\n          'Jamaica': 2961167,'Japan': 126476461,'Kazakhstan': 18776707,'Korea, South': 51269185,'Lebanon': 6825445,'Lithuania': 2722289,'Luxembourg': 625978,'Malaysia': 32365999,'Martinique': 375265,'Mauritius': 1271768,'Mexico': 128932753,\n          'Moldova': 4033963,'Montenegro': 628066,'Morocco': 36910560,'Netherlands': 17134872,'Nigeria': 206139589,'North Macedonia': 2083374,'Norway': 5421241,'Pakistan': 220892340,'Panama': 4314767,'Paraguay': 7132538,'Peru': 32971854,\n          'Philippines': 109581078,'Poland': 37846611,'Portugal': 10196709,'Romania': 19237691,'Russia': 145934462,'San Marino': 33931,'Saudi Arabia': 34813871,'Serbia': 8737371,'Seychelles': 98347,'Singapore': 5850342,\n          'Slovakia': 5459642,'Slovenia': 2078938,'Somalia': 15893222,'South Africa': 59308690,'Spain': 46754778,'Sri Lanka': 21413249,'Sudan': 43849260,'Suriname': 586632,'Sweden': 10099265,'Switzerland': 8654622,'Thailand': 69799978,\n          'Tunisia': 11818619,'Turkey': 84339067,'US': 331002651,'Ukraine': 43733762,'United Arab Emirates': 9890402,'United Kingdom': 67886011,'Uruguay': 3473730,'Uzbekistan': 33469203,'Venezuela': 28435940,'Vietnam': 97338579}","e59b7dd1":"tp=pd.DataFrame(columns=['country','ConfirmedCases','Fatalities'])\n\nfor coun in train['Country\/Region'].unique():\n    inter_db=train[train['Country\/Region']==coun].groupby(['Date']).agg({'ConfirmedCases':['sum'],'Fatalities':['sum']}).reset_index()\n    inter_db.columns=[\t'Date',\t'ConfirmedCases',\t'Fatalities']\n    tp.loc[tp.shape[0]]=[coun,inter_db.ConfirmedCases.max(),inter_db.Fatalities.max()]\n","a05969a5":"tp.sort_values(by=['Fatalities'],ascending=False).head(10)","f60f043f":"def plot_infection_rate(train,country_list):\n    fig = make_subplots(rows=1, cols=1)\n    fig.update_layout(height=500, width=800, title_text=\"Infection Rate \")\n    for country in country_list:\n        c_db=train[train['Country\/Region']==country].groupby(['Date','Date_str']).agg({'ConfirmedCases':['sum'],'Fatalities':['sum']}).reset_index()\n        c_db.columns=[\t'Date',\t'Date_str',\t'ConfirmedCases',\t'Fatalities']\n        #c_db=c_db[c_db.ConfirmedCases>50]\n        c_db['ratio']=(100*c_db['ConfirmedCases'])\/pop_dict[country]\n        fig.add_trace(\n                  go.Scatter(\n                            x=c_db['Date_str'].values,\n                            y=c_db['ratio'].values\n                            ,mode='lines+markers',\n                            text=list(c_db.ConfirmedCases.values),\n                             name=country,\n                            ) \n                  )\n    fig.update_layout(\n        xaxis_title=\"Date\",\n        yaxis_title=\"Infection Rate\",\n        )\n    fig.show()\n","7ed08c31":"Name_of_countries_to_plot=['Italy','Iran','China']\nplot_infection_rate(train,Name_of_countries_to_plot)","1fcadfba":"total_df = train.groupby(['Date','Date_str', 'Country\/Region'])['ConfirmedCases', 'Fatalities'].sum()\ntotal_df = total_df.reset_index()\nfig = px.scatter_geo(total_df, locations=\"Country\/Region\", locationmode='country names', \n                      color=\"Fatalities\", size='Fatalities', hover_name=\"Country\/Region\", \n                      projection=\"natural earth\", animation_frame=\"Date_str\", \n                      title='Total Fatalities over time'\n                      )\nfig.update(layout_coloraxis_showscale=False)\nfig.show()","f32ce6b2":"class plot_per_million:\n    def __init__(self,list_of_count_to_plot,data,column_to_plot):\n        self.list_of_count_to_plot=list_of_count_to_plot\n        self.train=data\n        self.column_to_plot=column_to_plot\n    \n    def initiate_plotting(self,):\n        fig = make_subplots(rows=1, cols=1)\n        fig.update_layout(height=500, width=800, title_text=\"Number of {} per million population vs no of days since 10 {} per million population \".format(self.column_to_plot,self.column_to_plot))\n        for countt in self.list_of_count_to_plot:\n            self.plotter(self.return_count_data(countt,self.train),countt,fig)\n        fig.update_layout(\n            xaxis_title=\"no of days since 10 cases\",\n            yaxis_title=\"Number of {} per million population\".format(self.column_to_plot),\n                            )\n        fig.update_yaxes(tick0=10)\n        fig.update_yaxes(tickvals=[10, 100, 200, 500,1000])\n        fig.show()\n\n    def return_count_data(self,countt,train):\n        iran_db=train[train['Country\/Region']==countt].groupby(['Date','Date_str']).agg({'ConfirmedCases':['sum'],'Fatalities':['sum']}).reset_index()\n        iran_db.columns=[\t'Date',\t'Date_str',\t'ConfirmedCases',\t'Fatalities']\n        iran_db_tp=iran_db[(iran_db[self.column_to_plot]\/(pop_dict[countt]\/1000000))>=10].copy()\n        iran_db_tp['to_sub']=[iran_db_tp.head(1).Date_str.values[0]]*iran_db_tp.shape[0]\n        iran_db_tp['to_sub']=pd.to_datetime(iran_db_tp['to_sub'])\n        iran_db_tp['diff']=(iran_db_tp['Date']-iran_db_tp['to_sub']).dt.days\n        return iran_db_tp\n\n    def plotter(self,db_tp,countt,fig):\n        fig.add_trace(go.Scatter(\n                            x=db_tp['diff'].values,\n                            y=db_tp[self.column_to_plot].values\/(pop_dict[countt]\/1000000)\n                             ,mode='lines+markers',\n                              text=list(db_tp.Date_str.values),name=countt,\n                            ) )\n","5d50957f":"list_of_countries_to_plot=['Italy','Iran','Spain','US']\nFeature_to_plot_on='ConfirmedCases'","d7e7dae8":"plotter_obj=plot_per_million(list_of_countries_to_plot,train,Feature_to_plot_on)\nplotter_obj.initiate_plotting()","c85a5b03":"def create_lag_plot(country,shift_val1,shift_val2,col_tocheck):\n    \"\"\"\n    country     : name of the country who's data is to be analyzed\n    shift_val1  : lag value for the first plot\n    shift_val2  : lag value for the second plt\n    col_tocheck : column name on which analysis is to be performed\n    \"\"\"\n\n    fig = make_subplots(rows=1, cols=2,subplot_titles=(\"lag {} plot for {} in {}\".format(shift_val1,col_tocheck,country),\n                                                                                    \"lag {} plot for {} in {}\".format(shift_val2,col_tocheck,country)))\n\n    fig.update_layout(height=500, width=1000, title_text=\"Lag Plots\")\n\n\n    country_db=train[train['Country\/Region']==country].copy()\n\n    fig.add_trace(go.Scatter(\n                            x=list(country_db[col_tocheck].shift(shift_val1).values),\n                            y=list(country_db[col_tocheck].values),mode='lines+markers',\n                             text=list(country_db['Date_str'].shift(shift_val1).values)\n                            ),\n                  row=1, col=1 )\n    fig.update_xaxes(title_text=\"x_t\", row=1, col=1)\n    fig.update_yaxes(title_text=\"x_(t+{})\".format(shift_val1), row=1, col=1)\n    fig.add_trace(go.Scatter(\n                            x=list(country_db[col_tocheck].shift(shift_val2).values),\n                            y=list(country_db[col_tocheck].values),mode='lines+markers',\n                             text=list(country_db['Date_str'].shift(shift_val2).values)\n                            ),\n                  row=1, col=2 )\n    fig.update_xaxes(title_text=\"x_t\", row=1, col=2)\n    fig.update_yaxes(title_text=\"x_(t+{})\".format(shift_val2), row=1, col=2)\n    \n    fig.show()\ncreate_lag_plot('Iran',1,13,'ConfirmedCases')\ncreate_lag_plot('Iran',1,13,'Fatalities')","a1595cd1":"country_db=train[train['Country\/Region']=='Iran'].copy()\nshift_val1=1\ncol_tocheck='ConfirmedCases'\ndft=country_db[col_tocheck].shift(shift_val1).to_frame('shifted').join(country_db[col_tocheck].to_frame('val')).dropna()\nprint('Coefficient value is : ',np.corrcoef(dft['shifted'],dft['val'])[0][1])","81ab2b2b":"Rate of infection is an important metric for analyzing the spread of the virus and it's far reaching impact.<br\/> \nThe calculation of its rate will involve finding the total postive cases per country , normalized by the countire's population","a8250f68":"## Infection Rate Visualization ","b4ecb0fc":"### Importing data","1240c16f":"\nCoronaviruses are a group of related viruses that cause diseases in mammals and birds. In humans, coronaviruses cause respiratory tract infections that can be mild, such as some cases of the common cold (among other possible causes, predominantly rhinoviruses), and others that can be lethal, such as SARS, MERS, and COVID-19.","d008abc1":"# Lag plots","d190237e":"![f0070229-coronavirus_artwork-spl.jpg](attachment:f0070229-coronavirus_artwork-spl.jpg)","39551479":"Pearson coefficient is calculated as :<br\/>\n<font size=\"3\">\n$$\\frac{\\sum({X_t-X_{mean}})\\sum({Y_t-Y_{mean}})}\n{ \\sqrt{ \\sum({X_t-X_{mean}})^2 \\sum{(Y_t-Y_{mean}})^2\n        }\n}$$\n    <\/font>","9d58759e":"## Globe Visualization of Fatalities","2cb0c832":"Here we will plot the rate for Italy, Iran and China","d3000550":"\nPearson coefficient is a measure of the linear correlation between two variables X and Y.<br\/>\nThis coefficient can be interpreted in many ways ,for example, if we use X and Y to form two vectors, then\nPearson's coefficient is the cosine of the angle between them<br\/>\nHence the smaller the angle,the higher the coefficient value, and the more correlated the two vectors would be. <br\/>\nIn case of comparison between a time series and lagged time series, the pearson coefficient value is also known as autocorrelation value ( Furthur reading https:\/\/www.itl.nist.gov\/div898\/handbook\/eda\/section3\/autocopl.htm).<br\/>\nThe most easiest way to find the correlation value is to use numpy's 'corrcoef' function.","efcd3805":"## About CoronaViruses","161042b4":"\n# Short Visualization and analysis","9c2d85c3":"Visualizing the fatalities via plotly's globe animation","59e5a64e":"We can derive the following analysis from the above above lag plots \n1. There is a strong Autocorrelation present as seen per the lag 1 scatter plot\n2. The lag 13 scatter plot helps us analyze how the augmentation in values is restrained over time.It also represents how quickly the cases increased in the initial stages of the spread of the virus\n\nIn order to quantify the correlation present in the series, where **Pearson coefficient** can be used\n","f5b92e5b":"## Visualizing PositiveCases\/Fatalities per million population","02a97d05":"## Finding the total positive cases and deaths per country","bf8c5499":"### Dictionary for population of countries","a4b86361":"Lag plot is a popular time domain technique <br\/>\n\nA lag is a fixed time displacement. For example, given a data set Y1, Y2 ..., Yn, Y2 and Y7 have lag 5 since 7 - 2 = 5. Lag plots can be generated for any arbitrary lag, although the most commonly used lag is 1.<br\/>\n\nA lag plot checks whether a data set or time series is random or not.<br\/>\n\n1. Random data should not exhibit any identifiable structure in the lag plot\n2. Non-random structure in the lag plot indicates that the underlying data are not random\n\nLag plots help you make conclusion about the data whether there is presence of weak\/strong Autocorrelation ","4a606726":"### Pearson coefficient"}}