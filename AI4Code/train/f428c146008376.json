{"cell_type":{"49efbf71":"code","4c1f84d6":"code","446cd445":"code","9d7e75d5":"code","b5fd32e6":"code","0c16dff7":"code","48c6fb4f":"code","5580919b":"code","0ec2f73f":"code","46ca70b0":"code","ac6ff8fe":"code","21cee269":"code","b532129b":"code","9ed132fb":"code","e6aca671":"code","81cd217c":"code","4759744f":"code","f925fb85":"code","a5e5003b":"code","9e362982":"code","91ccd6da":"code","d11641cd":"code","cf6feb53":"code","e8d941fc":"code","2734e276":"code","ce5efebb":"code","6c5941f1":"code","dc15df05":"code","4f4060c5":"code","095957f8":"code","1e95c54b":"code","717e0af5":"markdown","bd40f91d":"markdown","13a2c361":"markdown","d9d8198c":"markdown","74d2c91b":"markdown","37cc46e1":"markdown","05ca1ebf":"markdown","d0ede257":"markdown","09da8924":"markdown","2b5df57d":"markdown","e2ad1a83":"markdown","4a98a064":"markdown","1b0531b7":"markdown","b687bb73":"markdown"},"source":{"49efbf71":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nsns.set_style('white')","4c1f84d6":"tdf_winners = pd.read_csv(\"\/kaggle\/input\/tour-de-france-winners\/tdf_winners.csv\", parse_dates = ['start_date', 'born', 'died'])\ntdf_winners.head()","446cd445":"tdf_winners['birth_country'].value_counts().plot(kind = 'barh',\n                                                title = 'What countries were the Most Tour de France winners from?')\nsns.despine()","9d7e75d5":"tdf_winners['winner_name'].value_counts()","b5fd32e6":"tdf_winners.groupby(['winner_name', 'birth_country'])['edition'].size().sort_values(ascending = False).head(10)","0c16dff7":"tdf_winners['year'] = tdf_winners['start_date'].dt.to_period('Y').astype(str).astype(int)\ntdf_winners['decade'] = 10*(tdf_winners['year'].astype(int) \/\/ 10)\ntdf_winners['decade'].value_counts().sort_index()","48c6fb4f":"grouping_vars = ['age', 'height', 'weight', 'time_margin', 'time_overall', 'speed']\ntdf_winners.eval('speed = distance \/ time_overall', inplace = True)\nwinners_by_decade = tdf_winners.groupby('decade')[grouping_vars].agg(np.nanmean).round(2).reset_index()\nwinners_by_decade","5580919b":"for grouping_var in grouping_vars:\n    winners_by_decade.plot(x = 'decade', y = grouping_var, ylim = 0)\n    sns.despine()","0ec2f73f":"(winners_by_decade.query('decade > 1910').eval('time_margin = time_margin * 60')\n .plot(x = 'decade', y = 'time_margin', ylim = 0, title = 'Tour de France races have been getting closer'))\nsns.despine()","46ca70b0":"winners_by_decade.plot('decade', 'speed', ylim = 0, title = \"Tour de France winners have been getting faster\")\nsns.despine()","ac6ff8fe":"survival_df = tdf_winners.drop_duplicates(subset = 'winner_name').dropna(axis = 0, subset = ['born'])\nsurvival_df['died'].count()","21cee269":"survival_df['birth_year'] = pd.to_numeric(survival_df['born'].dt.to_period('Y').astype(str), errors = \"coerce\")\nsurvival_df['death_year'] = pd.to_numeric(survival_df['died'].dt.to_period('Y').astype(str), errors = \"coerce\")","b532129b":"survival_columns = ['winner_name', 'birth_year', 'death_year', 'dead']\nsurvival_df['dead'] = np.where(survival_df['death_year'].isna(), 0, 1)\nsurvival_df = survival_df[survival_columns]\nsurvival_df.head()","9ed132fb":"survival_df['death_year'] = np.where(survival_df['death_year'].isna(), 2020, survival_df['death_year'])\nsurvival_df.eval('age_at_death = death_year - birth_year', inplace = True)\nsurvival_df.head()","e6aca671":"!pip install lifelines","81cd217c":"from lifelines import KaplanMeierFitter","4759744f":"T = survival_df[\"age_at_death\"]\nE = survival_df[\"dead\"]\nkmf = KaplanMeierFitter()\nkmf.fit(T, event_observed=E)","f925fb85":"kmf.plot()\nplt.title('Survival function of Tour de France Winners');\nsns.despine()\nplt.savefig('survival.png',\n           dpi=300)","a5e5003b":"kmf.median_survival_time_","9e362982":"tdf_stages = pd.read_csv(\"\/kaggle\/input\/tour-de-france-winners\/tdf_stages.csv\", parse_dates = ['Date'])\ntdf_stages['year'] = pd.to_numeric(tdf_stages['Date'].dt.to_period('Y').astype('str'), errors = 'coerce')\nstage_data = pd.read_csv(\"\/kaggle\/input\/tour-de-france-winners\/stage_data.csv\")\nprint(tdf_stages.columns)\nprint(stage_data.columns)","91ccd6da":"tdf_stages.head()","d11641cd":"stage_data['Stage'] = stage_data['stage_results_id'].str.split('-').str.get(1)","cf6feb53":"stages_joined = stage_data.merge(tdf_stages, how = 'inner', on = ['Stage', 'year'])\nstages_joined.head()","e8d941fc":"stages_joined['rank'].value_counts().sort_values(ascending = False)","2734e276":"stages_joined['rank'] = pd.to_numeric(stages_joined['rank'], errors = 'coerce')","ce5efebb":"stages_joined.groupby('Winner_Country').agg({'Stage': 'size',\n                                             'rank': np.nanmedian}).sort_values('Stage', ascending = False)","6c5941f1":"stages_joined.groupby(['year', 'Stage'])['rank'].agg('size').plot(kind = 'hist')","dc15df05":"stages_joined = (stages_joined.groupby(['year', 'Stage'])['rank'].agg(pd.Series.count).\n    reset_index().rename({'rank': 'competitors'} ,axis = 1).merge(stages_joined, how = 'right', on = ['year', 'Stage']).\n    eval('percentile = 1 - rank \/ competitors'))\nstages_joined['Stage'] = pd.to_numeric(stages_joined['Stage'], errors = 'coerce')","4f4060c5":"stages_joined.query('Stage == 2').groupby('Winner_Country').agg({'Stage': 'size',\n                                             'percentile': np.nanmedian}).sort_values('Stage', ascending = False).round(3)","095957f8":"total_points_per_year = stages_joined.groupby(['year', 'rider'])['points'].agg(np.sum).reset_index().rename({'points': 'total_points'},\n                                                                                                           axis = 1)\ntotal_points_per_year['point_rank'] = total_points_per_year.groupby(['year'])['total_points'].rank(pct = True)\ntotal_points_per_year.head(10)","1e95c54b":"first_and_total = stages_joined.query('Stage == 1').merge(total_points_per_year, how = 'right',\n                                       on = ['year', 'rider'])\nfirst_and_total['percentile'] = pd.cut(first_and_total['percentile'], [0. , 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1. ])\nfirst_and_total['percentile'] = first_and_total['percentile'].dropna(axis = 0)\nchart = sns.boxplot(x = 'percentile', y = 'point_rank', data = first_and_total)\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45)\nchart.set(xlabel='c', ylabel='common ylabel')\nsns.despine()\nplt.savefig('boxplot.png',\n           dpi=300)","717e0af5":"Thus, the median life expectancy of a Tour de France winner is 77. ","bd40f91d":"## Tour de France Winners\n\nDave normally starts the screencasts by looking at some categorical variable with a quick plot. ","13a2c361":"Let's zoom in on the time margin and eliminate the first two observations. ","d9d8198c":"Now, let's calculate the average winner age by decade! Notice that pandas makes it natural to do what Dave wanted to do with across. ","74d2c91b":"I love dplyr, however, non having to deal with NSE problems in pandas makes it much easier to reuse code. In this case, let's see if ","37cc46e1":"## Stage Data","05ca1ebf":"# Copying Dave Robinson to understand Python\n\nIn language learning, there is this concept of triangulation: use your second language to learn your third. For example, use your French knoweldge to learn German. Thus, one can refresh earlier concepts **AND** learn a new language simultaneously. \n\nThis notebook is my attempt at triangulation in programming. Having read and wrote some R, I attempt a TidyTuesday submission in Python following step by step what Dave Robinson did in his [screencast](https:\/\/www.youtube.com\/watch?v=vT-DElIaKtE) with R. That is, I attempt to replicate almost every step he did in his analysis using Python. Thus, I am able to keep up with the growing tidyverse in R and at the same time I get to learn how to do advanced data analysis in Python. \n\n## What is TidyTuesday?\n\n> A weekly [data project](https:\/\/github.com\/rfordatascience\/tidytuesday) aimed at the R ecosystem. As this project was borne out of the R4DS Online Learning Community and the R for Data Science textbook, an emphasis was placed on understanding how to summarize and arrange data to make meaningful charts with ggplot2, tidyr, dplyr, and other tools in the tidyverse ecosystem. However, any code-based methodology is welcome - just please remember to share the code used to generate the results.\n\n## This week's TidyTuesday","d0ede257":"Let's try to replicate the `add_count` function","09da8924":"Does the performance on the first stage predict the final performance?","2b5df57d":"## Life expectancy\n\nLet's look at the life expectancy of the winners. How many have died? Note that `pd.Series.count()` counts the number of non-missing observations","e2ad1a83":"No country does better than average! No country is dominant within the first stage","4a98a064":"Now, let's find out which cyclyst wont the most Tours.","1b0531b7":"## How is the age distrbution changed over time?\n\nHowever, let's first create the decade variable.","b687bb73":"Let's create the stage data that we are going to use later on to join. "}}