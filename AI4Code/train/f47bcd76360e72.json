{"cell_type":{"ae7ad74b":"code","0b7542b3":"code","6ef1d098":"code","4dc2d2f1":"code","0575e983":"code","e3027707":"code","ab0e3474":"code","34109541":"code","d2263940":"code","146a1982":"code","cb42f45c":"code","7ffeb752":"code","613be223":"code","8c8997ff":"code","6a3fff55":"code","0063ad1d":"code","774d28eb":"code","7197ed5c":"code","f4534fc5":"code","f1d64a32":"code","6b7b2c94":"code","dd445d07":"code","67c57561":"code","bdf1a7f5":"code","a89ef020":"code","c4f420e3":"code","07d25f87":"code","a1e2d5e8":"code","7ce0339f":"code","ab47b7a0":"code","07dac88a":"code","fb512018":"code","ec5828be":"code","9ea0a566":"code","c13b3c36":"code","379f5a28":"code","494e7b14":"code","2456c33d":"code","74f9ac03":"code","c17652d0":"code","72498237":"code","14a27b53":"code","026dfa0e":"code","56c408c5":"code","36177fc3":"code","d37394da":"code","a98ff4ea":"code","492b6b2e":"code","9fdd0f8f":"code","47244a46":"code","3e0b5ee9":"code","65272aeb":"code","0562f024":"code","00a953af":"code","835f9bc7":"code","dc9d0df7":"code","58275671":"code","91864add":"code","d578a525":"code","02ecf264":"code","d11b704d":"code","79543ef6":"code","83f5b9c7":"code","4db9b5e8":"code","4c82d822":"code","79a5c826":"code","432199e5":"code","0c3dd5f4":"code","ea03fa7a":"code","2e039026":"markdown","0e75587f":"markdown","7e37221a":"markdown","185e5bfd":"markdown","e223034d":"markdown","b73b0af8":"markdown","2fdb8fd5":"markdown","5341942a":"markdown","993c86b0":"markdown","55c90ab3":"markdown","b9ea5ff9":"markdown","5607d482":"markdown","57d2a7d3":"markdown","5b226f5d":"markdown","210c684a":"markdown","b373b61c":"markdown","e8b8c9fb":"markdown","49d227d6":"markdown","aa10de1b":"markdown","61a3d471":"markdown","a4f37b10":"markdown","1761b4df":"markdown","80f292f6":"markdown","f1697abb":"markdown","66a1d347":"markdown","7f88e1db":"markdown","e50d9dcc":"markdown","1ba61497":"markdown","9fcefa7c":"markdown","b14d65d4":"markdown","d13150eb":"markdown","3deaae59":"markdown","458bb661":"markdown","e008b271":"markdown","e6be854b":"markdown","0e8eb922":"markdown","0336258b":"markdown","88ea074c":"markdown","a81c195e":"markdown","84224477":"markdown","0904cb15":"markdown","c9b81d64":"markdown","e0d5731a":"markdown","da46e605":"markdown","84f24f0b":"markdown","00c18b1c":"markdown","4aedd321":"markdown","0c60e96c":"markdown","3cad0d1f":"markdown","5195a21f":"markdown","664f6d65":"markdown","f976e4eb":"markdown","c2b5c1a5":"markdown","768ed768":"markdown","09440540":"markdown"},"source":{"ae7ad74b":"import os\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom matplotlib.legend_handler import HandlerBase\nfrom matplotlib.text import Text\nfrom sklearn.decomposition import PCA\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.discriminant_analysis import LinearDiscriminantAnalysis as LDA\n%matplotlib inline","0b7542b3":"# Loading all the datasets provided on the competition\ntrain = pd.read_csv('..\/input\/application_train.csv')\ntest = pd.read_csv('..\/input\/application_test.csv')\nbureau = pd.read_csv('..\/input\/bureau.csv')\nbureau_balance = pd.read_csv('..\/input\/bureau_balance.csv')\ncredit_card_balance = pd.read_csv('..\/input\/credit_card_balance.csv')\ninstallments_payments = pd.read_csv('..\/input\/installments_payments.csv')\npos_cash_balance = pd.read_csv('..\/input\/POS_CASH_balance.csv')\nprevious_application = pd.read_csv('..\/input\/previous_application.csv')","6ef1d098":"train.head()","4dc2d2f1":"train.info()","0575e983":"# Ploting how many clients with payment difficulties on the train dataset\ngraph = sns.countplot(x=\"TARGET\",data=train, palette='muted')","e3027707":"# Calculating how many clients with payment difficulties on the train dataset\npay_diff = train[train['TARGET'] == 1]['TARGET'].count()\npay_ok = train[train['TARGET'] == 0]['TARGET'].count()\nprint('Clients with payment difficulty: %s' % pay_diff)\nprint('Clients with payment ok: %s' % pay_ok)","ab0e3474":"# Selecting only the numerical features in the Train dataset\nnumerical_features = train[['TARGET', 'SK_ID_CURR', 'CNT_CHILDREN', 'AMT_INCOME_TOTAL', 'AMT_CREDIT', 'AMT_ANNUITY', \n                            'AMT_GOODS_PRICE','REGION_POPULATION_RELATIVE', 'DAYS_BIRTH', 'DAYS_EMPLOYED', \n                            'DAYS_REGISTRATION', 'DAYS_ID_PUBLISH', 'OWN_CAR_AGE', 'FLAG_MOBIL', 'FLAG_EMP_PHONE', \n                            'FLAG_WORK_PHONE','FLAG_CONT_MOBILE', 'FLAG_PHONE', 'FLAG_EMAIL','CNT_FAM_MEMBERS', \n                            'REGION_RATING_CLIENT', 'REGION_RATING_CLIENT_W_CITY', 'HOUR_APPR_PROCESS_START', \n                            'REG_REGION_NOT_LIVE_REGION', 'REG_REGION_NOT_WORK_REGION', 'LIVE_REGION_NOT_WORK_REGION',\n                            'REG_CITY_NOT_LIVE_CITY', 'REG_CITY_NOT_WORK_CITY','LIVE_CITY_NOT_WORK_CITY', \n                            'EXT_SOURCE_1', 'EXT_SOURCE_2', 'EXT_SOURCE_3',\n                            'APARTMENTS_AVG', 'BASEMENTAREA_AVG', 'YEARS_BEGINEXPLUATATION_AVG',\n                            'YEARS_BUILD_AVG', 'COMMONAREA_AVG', 'ELEVATORS_AVG', 'ENTRANCES_AVG',\n                            'FLOORSMAX_AVG', 'FLOORSMIN_AVG', 'LANDAREA_AVG',\n                            'LIVINGAPARTMENTS_AVG', 'LIVINGAREA_AVG', 'NONLIVINGAPARTMENTS_AVG',\n                            'NONLIVINGAREA_AVG', 'APARTMENTS_MODE', 'BASEMENTAREA_MODE',\n                            'YEARS_BEGINEXPLUATATION_MODE', 'YEARS_BUILD_MODE', 'COMMONAREA_MODE',\n                            'ELEVATORS_MODE', 'ENTRANCES_MODE', 'FLOORSMAX_MODE', 'FLOORSMIN_MODE',\n                            'LANDAREA_MODE', 'LIVINGAPARTMENTS_MODE', 'LIVINGAREA_MODE',\n                            'NONLIVINGAPARTMENTS_MODE', 'NONLIVINGAREA_MODE', 'APARTMENTS_MEDI',\n                            'BASEMENTAREA_MEDI', 'YEARS_BEGINEXPLUATATION_MEDI', 'YEARS_BUILD_MEDI',\n                            'COMMONAREA_MEDI', 'ELEVATORS_MEDI', 'ENTRANCES_MEDI', 'FLOORSMAX_MEDI',\n                            'FLOORSMIN_MEDI', 'LANDAREA_MEDI', 'LIVINGAPARTMENTS_MEDI',\n                            'LIVINGAREA_MEDI', 'NONLIVINGAPARTMENTS_MEDI', 'NONLIVINGAREA_MEDI', 'TOTALAREA_MODE',\n                            'OBS_30_CNT_SOCIAL_CIRCLE', 'DEF_30_CNT_SOCIAL_CIRCLE',\n                            'OBS_60_CNT_SOCIAL_CIRCLE', 'DEF_60_CNT_SOCIAL_CIRCLE',\n                            'DAYS_LAST_PHONE_CHANGE', 'FLAG_DOCUMENT_2', 'FLAG_DOCUMENT_3',\n                            'FLAG_DOCUMENT_4', 'FLAG_DOCUMENT_5', 'FLAG_DOCUMENT_6',\n                            'FLAG_DOCUMENT_7', 'FLAG_DOCUMENT_8', 'FLAG_DOCUMENT_9',\n                            'FLAG_DOCUMENT_10', 'FLAG_DOCUMENT_11', 'FLAG_DOCUMENT_12',\n                            'FLAG_DOCUMENT_13', 'FLAG_DOCUMENT_14', 'FLAG_DOCUMENT_15',\n                            'FLAG_DOCUMENT_16', 'FLAG_DOCUMENT_17', 'FLAG_DOCUMENT_18',\n                            'FLAG_DOCUMENT_19', 'FLAG_DOCUMENT_20', 'FLAG_DOCUMENT_21',\n                            'AMT_REQ_CREDIT_BUREAU_HOUR', 'AMT_REQ_CREDIT_BUREAU_DAY',\n                            'AMT_REQ_CREDIT_BUREAU_WEEK', 'AMT_REQ_CREDIT_BUREAU_MON',\n                            'AMT_REQ_CREDIT_BUREAU_QRT', 'AMT_REQ_CREDIT_BUREAU_YEAR']]","34109541":"# Calculating the corelation between numerical features and the TARGET on the training dataset\ncorelation = numerical_features.corr()['TARGET']","d2263940":"# Sorting the correlation to check wich feature is better correlated with the TARGET \ncorelation.abs().sort_values(ascending = False)[0:10]","146a1982":"bureau.head()","cb42f45c":"bureau.info()","7ffeb752":"# Ploting the histogram of the previous client accounts in other institutions\nbureau_account = bureau['SK_ID_BUREAU'].groupby(bureau['SK_ID_CURR'])\nbureau_account_n = bureau_account.count()\ngraph = sns.distplot(bureau_account_n)\ngraph.set_xlabel(\"Number of Previous Credit Loans per Client\")","613be223":"# Describing the stats of the graph\nbureau_account_n.describe()","8c8997ff":"# Selecting only clients with active credit loans accounts on the Bureau dataset\nactive_account = bureau[['SK_ID_CURR', 'CREDIT_ACTIVE']]\nbureau_active_account = active_account[active_account['CREDIT_ACTIVE'] == 'Active']\nbureau_active_account_n = bureau_active_account['CREDIT_ACTIVE'].groupby(bureau_active_account['SK_ID_CURR']).count()","6a3fff55":"# Ploting the histogram of the clients with active credit loans accounts\ngraph = sns.distplot(bureau_active_account_n)\ngraph.set_xlabel(\"Number of Previous Active Credit Loans per Client\")","0063ad1d":"# Describing the stats of the graph\nbureau_active_account_n.describe()","774d28eb":"# Checking for null values on the debt amount feature\nprint('There are %i accounts with null debt amount' %bureau['AMT_CREDIT_SUM_DEBT'].isnull().sum())","7197ed5c":"# Elimitating null values to better visualize the data and grouping by client SK_ID_CURR\nbureau_client_debt = bureau[['AMT_CREDIT_SUM_DEBT', 'SK_ID_CURR']]\nbureau_client_debt = bureau_client_debt[bureau_client_debt['AMT_CREDIT_SUM_DEBT'].notnull()]\nbureau_client_debt_amount = bureau_client_debt.groupby(bureau_client_debt['SK_ID_CURR']).sum()","f4534fc5":"# Defining bins to better visualize the current debt per client\n# Low debt is less than $100\n# Medium debt is between $100 and $1.000\n# Medium high debt is between $1.000 and $10.000\n# High debt is bigger than $10.000\ndef amount_bins_debt(amount):\n    if amount < 10000:\n        amount = 'Low'\n    else: \n        if amount > 10000 and amount < 100000:\n            amount = 'Medium'\n        else: \n            if amount > 100000 and amount < 1000000:\n                amount = 'Medium High'\n            else:\n                amount = 'High'\n    return amount","f1d64a32":"# Transforming the total debt amount in bin sizes\nbureau_client_debt_bins = bureau_client_debt_amount['AMT_CREDIT_SUM_DEBT'].apply(amount_bins_debt)","6b7b2c94":"# Ploting the current debt amount per client on all previous accounts\ngraph = sns.countplot(bureau_client_debt_bins, palette='muted')\ngraph.set_xlabel(\"Current Debt Amount\")\ngraph.set_ylabel(\"Number of Clients\")\n\n# Everything below is to put a legend in the graph\nclass TextHandler(HandlerBase):\n    def create_artists(self, legend, tup ,xdescent, ydescent,\n                        width, height, fontsize,trans):\n        tx = Text(width\/2.,height\/2,tup[0], fontsize=fontsize,\n                  ha=\"center\", va=\"center\", color=tup[1], fontweight=\"bold\")\n        return [tx]\n    \nhandltext = [\"Low\", \"Medium\", \"Medium High\", \"High\"]\nlabels = [\"$ < 10k\", \"10k < $ < 100k\", \"100k< $ < 1M\", \"$ > $1M\"]\n\n\nt = graph.get_xticklabels()\nlabeldic = dict(zip(handltext, labels))\nlabels = [labeldic[h.get_text()]  for h in t]\nhandles = [(h.get_text(),c.get_fc()) for h,c in zip(t,graph.patches)]\n\ngraph.legend(handles, labels, handler_map={tuple : TextHandler()})","dd445d07":"# Selecting due and overdue clients\nbureau_due = bureau[bureau['CREDIT_DAY_OVERDUE'] == 0]\nbureau_due = bureau_due[['SK_ID_CURR', 'CREDIT_DAY_OVERDUE','AMT_CREDIT_SUM_OVERDUE']]\nbureau_due_n = len(bureau_due['SK_ID_CURR'].unique())\nbureau_overdue = bureau[bureau['CREDIT_DAY_OVERDUE'] != 0]\nbureau_overdue = bureau_overdue[['SK_ID_CURR', 'CREDIT_DAY_OVERDUE', 'AMT_CREDIT_SUM_OVERDUE']]\nbureau_overdue_n = len(bureau_overdue['SK_ID_CURR'].unique())\n\n# Ploting the result\ngraph = sns.barplot(x=['Due', 'Overdue'],y=[bureau_due_n, bureau_overdue_n], palette= 'muted')\ngraph.set_ylabel(\"Number of Clients\")\nprint('Due Clients: %s\\nOverdue Clients: %s' %(bureau_due_n, bureau_overdue_n))","67c57561":"# Ploting the maximum days overdue of the clients\nbureau_max_client_overdue = bureau_overdue['CREDIT_DAY_OVERDUE'].groupby(bureau_overdue['SK_ID_CURR']).max()\ngraph = sns.distplot(bureau_max_client_overdue)\ngraph.set_xlabel(\"Maximum Days Overdue per Client\")","bdf1a7f5":"# Describing the stats of the graph\nbureau_max_client_overdue.describe()","a89ef020":"# Defining bins to better visualize the current amount past due per client\n# Low overdue is less than $100\n# Medium overdue is between $100 and $1.000\n# Medium high overdue is between $1.000 and $10.000\n# High overdue is bigger than $10.000\ndef amount_bins_overdue(overdue):\n    if overdue < 100:\n        overdue = 'Low'\n    else: \n        if overdue > 100 and overdue < 1000:\n            overdue = 'Medium'\n        else: \n            if overdue > 1000 and overdue < 10000:\n                overdue = 'Medium High'\n            else:\n                overdue = 'High'\n    return overdue","c4f420e3":"# Calculating the total current amount overdue per client\nbureau_amount_overdue = bureau_overdue['AMT_CREDIT_SUM_OVERDUE'].groupby(bureau_overdue['SK_ID_CURR'])\nbureau_sum_amount_overdue = bureau_amount_overdue.sum()\n\n# Transforming the total amount in bin sizes\nbureau_sum_amount_overdue_bins = bureau_sum_amount_overdue.apply(amount_bins_overdue)","07d25f87":"# Ploting the current amount overdue per client\ngraph = sns.countplot(bureau_sum_amount_overdue_bins, palette='muted')\ngraph.set_xlabel(\"Current Amount Overdue\")\ngraph.set_ylabel(\"Number of Clients\")\n\n# Everything below is to put a legend in the graph\nclass TextHandler(HandlerBase):\n    def create_artists(self, legend, tup ,xdescent, ydescent,\n                        width, height, fontsize,trans):\n        tx = Text(width\/2.,height\/2,tup[0], fontsize=fontsize,\n                  ha=\"center\", va=\"center\", color=tup[1], fontweight=\"bold\")\n        return [tx]\n    \nhandltext = [\"Low\", \"Medium\", \"Medium High\", \"High\"]\nlabels = [\"$ < 100\", \"100 < $ < $1k\", \"1k< $ < 10k\", \"$ > $10k\"]\n\n\nt = graph.get_xticklabels()\nlabeldic = dict(zip(handltext, labels))\nlabels = [labeldic[h.get_text()]  for h in t]\nhandles = [(h.get_text(),c.get_fc()) for h,c in zip(t,graph.patches)]\n\ngraph.legend(handles, labels, handler_map={tuple : TextHandler()})","a1e2d5e8":"# Ploting the number of times credit was prolonged per client in all previous loan credit accounts\ncredit_prolong=bureau[bureau['CNT_CREDIT_PROLONG'] > 0]\nbureau_credit_prolong_client = credit_prolong['CNT_CREDIT_PROLONG'].groupby(credit_prolong['SK_ID_CURR'])\nbureau_credit_prolong_client_n = bureau_credit_prolong_client.sum()\ngraph = sns.distplot(bureau_credit_prolong_client_n)\ngraph.set_xlabel(\"Number of Credit Prolongued per Client\")","7ce0339f":"# Describing the stats of the graph\nbureau_credit_prolong_client_n.describe()","ab47b7a0":"previous_application.head()","07dac88a":"previous_application.info()","fb512018":"# Ploting the histogram of the number of previous client accounts in Home Credit\nprev_app_acc_n = previous_application['SK_ID_PREV'].groupby(previous_application['SK_ID_CURR']).count()\ngraph = sns.distplot(prev_app_acc_n)\ngraph.set_xlabel(\"Number of Previous Credit Loans per Client\")","ec5828be":"# Describing the stats of the graph\nprev_app_acc_n.describe()","9ea0a566":"# Grouping, sorting and selecting the top five credit purpose\nmost_common_purpose = previous_application['SK_ID_PREV'].groupby(previous_application['NAME_CASH_LOAN_PURPOSE'])\nmost_common_purpose = most_common_purpose.count().sort_values(ascending = False)[0:5]\n\n# Ploting the top five purpose of previous credit\ngraph = sns.barplot(y=most_common_purpose.index,x=most_common_purpose.values, palette= 'muted', orient = 'h')\ngraph.set_ylabel(\"Number of Application\")","c13b3c36":"application_status = previous_application['SK_ID_PREV'].groupby(previous_application['NAME_CONTRACT_STATUS']).count()\n\n# Ploting the top five purpose of previous credit\ngraph = sns.barplot(y=application_status.index,x=application_status.values, palette= 'muted', orient = 'h')\ngraph.set_ylabel(\"Number of Application\")","379f5a28":"# Filtering the previous application with only refused previous applications\nrefused_application = previous_application[previous_application['NAME_CONTRACT_STATUS'] == 'Refused']","494e7b14":"# Printing the number and percentage of clients with previous refused applications\nclient_refused_n = len(refused_application['SK_ID_CURR'].unique())\nclient_total_n = len(previous_application['SK_ID_CURR'].unique())\nprint('Total Clients With Previous Applications: %s\\nTotal Clients With Refused Previous Application : %s'\n      %(client_total_n, client_refused_n))\nprint('Percentage of Clients With Refuse Previous Applications: %2.2f %%'%((client_refused_n\/client_total_n)*100))\n\n# Ploting the histogram of the number of refused previous client accounts in Home Credit\nprev_app_refused_n = refused_application['SK_ID_PREV'].groupby(refused_application['SK_ID_CURR']).count()\ngraph = sns.distplot(prev_app_refused_n)\ngraph.set_xlabel(\"Number of Previous Refused Credit Loans per Client\")","2456c33d":"# Describing the stats of the graph\nprev_app_refused_n.describe()","74f9ac03":"installments_payments.head()","c17652d0":"installments_payments.info()","72498237":"# Filtering the installment days\nday_payment = installments_payments[['SK_ID_PREV', 'SK_ID_CURR', 'DAYS_INSTALMENT', 'DAYS_ENTRY_PAYMENT']]\n\n# Filling missing payment with 0 value\nday_payment = day_payment.fillna(0)\n\n# Creating a new column with the diference between payment days and installment days\nday_payment['DELAYED'] = day_payment['DAYS_ENTRY_PAYMENT'] - day_payment['DAYS_INSTALMENT']\nday_payment.head()","14a27b53":"# Counting clients that delayed or not the payment\ninst_paym_delayed_clients = day_payment['DELAYED'].groupby(day_payment['SK_ID_CURR']).sum()\ninst_paym_delayed_clients_n = (inst_paym_delayed_clients.values > 0).sum()\ninst_paym_not_delayed_clients_n = (inst_paym_delayed_clients.values <= 0).sum()\n\n# Ploting the result\ngraph = sns.barplot(x=['Not_Delayed_Clients', 'Delayed_Clients'],y=[inst_paym_not_delayed_clients_n, \n                                                                    inst_paym_delayed_clients_n], palette= 'muted')\ngraph.set_ylabel(\"Number of Clients\")\nprint('Not_Delayed_Clients: %s\\nDelayed_Clients: %s' %(inst_paym_not_delayed_clients_n, inst_paym_delayed_clients_n))","026dfa0e":"# Filtering the installment payment\namt_payment = installments_payments[['SK_ID_PREV', 'SK_ID_CURR', 'NUM_INSTALMENT_NUMBER', \n                                        'AMT_INSTALMENT', 'AMT_PAYMENT']]\n\n# Filling missing payment with 0 value\namt_payment = amt_payment.fillna(0)\n\n# Calculating the debt in each installment\ndebt_instalment = amt_payment['AMT_PAYMENT'] - amt_payment['AMT_INSTALMENT']\n\n# Creating a new debt colunm on amount_payment\namt_payment['AMT_DEBT'] = debt_instalment\namt_payment.head()","56c408c5":"# Calculating the total debt per client\ninst_paym_debt_client = amt_payment['AMT_DEBT'].groupby(amt_payment['SK_ID_CURR']).sum()\nwith_debt_client_n = (inst_paym_debt_client.values < 0).sum()\nwithout_debt_client_n = (inst_paym_debt_client.values >= 0).sum()\n\n# Ploting the result\ngraph = sns.barplot(x=['Without_Debt', 'With_Debt'],y=[without_debt_client_n, with_debt_client_n], palette= 'muted')\ngraph.set_ylabel(\"Number of Clients\")\nprint('With Installment Debt Clients: %s\\nWithout Installment Debt Clients: %s' %(with_debt_client_n, \n                                                                                   without_debt_client_n))","36177fc3":"credit_card_balance.head()","d37394da":"credit_card_balance.info()","a98ff4ea":"# selecting the credit card payment columns\namt_credit_payment = credit_card_balance[['SK_ID_PREV', 'SK_ID_CURR', 'MONTHS_BALANCE', \n                                          'AMT_BALANCE','AMT_RECEIVABLE_PRINCIPAL']] \n                                          \n# Filling missing payment with 0 value\namt_credit_payment = amt_credit_payment.fillna(0)\n\n# Calculating the last month balance for each previous application\nlast_balance = pd.DataFrame(columns = ['SK_ID_PREV', 'MONTHS_BALANCE'])\nlast_balance['SK_ID_PREV'] = amt_credit_payment['MONTHS_BALANCE'].groupby(amt_credit_payment['SK_ID_PREV']).max().index\nlast_balance['MONTHS_BALANCE'] = amt_credit_payment['MONTHS_BALANCE'].groupby(amt_credit_payment['SK_ID_PREV']).max().values\nlast_balance = last_balance[['SK_ID_PREV', 'MONTHS_BALANCE']].apply(tuple, 1)\n\n# Filtering only the last month balance\namt_credit_payment = amt_credit_payment[amt_credit_payment[['SK_ID_PREV', 'MONTHS_BALANCE']].apply(tuple, 1).isin(last_balance)]\n\n# Creating a new debt colunm on amount_credit_payment\namt_credit_payment['AMT_DEBT'] = amt_credit_payment['AMT_RECEIVABLE_PRINCIPAL'] - amt_credit_payment['AMT_BALANCE']\namt_credit_payment.head()","492b6b2e":"# Calculating the total debt per client\ncredit_card_debt_client = amt_credit_payment['AMT_DEBT'].groupby(amt_credit_payment['SK_ID_CURR']).sum()\nwith_credit_debt_client_n = (credit_card_debt_client.values < 0).sum()\nwithout_credit_debt_client_n = (credit_card_debt_client.values >= 0).sum()\n\n# Ploting the result\ngraph = sns.barplot(x=['Without_Debt', 'With_Debt'],y=[without_credit_debt_client_n, with_credit_debt_client_n], \n                    palette= 'muted')\ngraph.set_ylabel(\"Number of Clients\")\nprint('With Credit Card Debt Clients: %s\\nWithout Credit Card Debt Clients: %s' %(with_credit_debt_client_n, \n                                                                                   without_credit_debt_client_n))","9fdd0f8f":"# Selecting only clients with credit card debit\ndebt = credit_card_debt_client.values\ndebt = debt[debt<0]\ndebt = debt * -1\n\n# Ploting the amount of credit card debt \ngraph = sns.distplot(debt)","47244a46":"# Descibing the stats of the graph\ndebt_df = pd.DataFrame(columns = ['Debt'])\ndebt_df['Debt'] = debt\ndebt_df.describe()","3e0b5ee9":"# Counting clients that delayed or not the payment\ndpd_credit_card = credit_card_balance['SK_DPD'].groupby(credit_card_balance['SK_ID_CURR']).sum()\ncredit_overdue_clients_n = (dpd_credit_card.values > 0).sum()\ncredit_due_clients_n = (dpd_credit_card.values == 0).sum()","65272aeb":"# Ploting the result\ngraph = sns.barplot(x=['Due Credit Card Client', 'Overdue Credit Card Clients'], \n                    y=[credit_due_clients_n, credit_overdue_clients_n], palette= 'muted')\ngraph.set_ylabel(\"Number of Clients\")\nprint('Due Credit Card Clients: %s\\nOverdue Credit Card Clients: %s' %(credit_due_clients_n, credit_overdue_clients_n))","0562f024":"pos_cash_balance.head()","00a953af":"pos_cash_balance.info()","835f9bc7":"# Counting clients that are due and overdue with the cash loan\ndpd_cash_loan = pos_cash_balance['SK_DPD'].groupby(pos_cash_balance['SK_ID_CURR']).sum()\ncash_loan_overdue_clients_n = (dpd_cash_loan.values > 0).sum()\ncash_loan_due_clients_n = (dpd_cash_loan.values == 0).sum()","dc9d0df7":"# Ploting the result\ngraph = sns.barplot(x=['Due Cash Loan Client', 'Overdue Cash Loan Clients'], \n                    y=[cash_loan_due_clients_n, cash_loan_overdue_clients_n], palette= 'muted')\ngraph.set_ylabel(\"Number of Clients\")\nprint('Due Cash Loan Clients: %s\\nOverdue Cash Loan Clients: %s' %(cash_loan_due_clients_n, cash_loan_overdue_clients_n))","58275671":"# Creating a new train dataset with the new features from other datasets\nnew_train = numerical_features","91864add":"# Joining with the new features from bureau dataset\n# Number of previous loans in other institutions\nnew_train = new_train.join(bureau_account_n, on='SK_ID_CURR')\nnew_train.rename(columns={'SK_ID_BUREAU':'CNT_ACOUNTS_BUREAU'}, inplace=True)\n\n# Number of previous active loans in other institutions\nnew_train = new_train.join(bureau_active_account_n, on='SK_ID_CURR')\nnew_train.rename(columns={'CREDIT_ACTIVE':'CNT_ACTIVE_ACOUNTS_BUREAU'}, inplace=True)\n\n# Debt amount of previous loans in other institutions\nnew_train = new_train.join(bureau_client_debt_amount, on='SK_ID_CURR')\nnew_train.rename(columns={'AMT_CREDIT_SUM_DEBT':'AMT_CREDIT_DEBT_BUREAU'}, inplace=True)\n\n# Days overdue of previous loans in other institutions\nbureau_days_overdue_sum = bureau_overdue['CREDIT_DAY_OVERDUE'].groupby(bureau_overdue['SK_ID_CURR']).sum()\nnew_train = new_train.join(bureau_days_overdue_sum, on='SK_ID_CURR')\nnew_train.rename(columns={'CREDIT_DAY_OVERDUE':'CNT_DAYS_OVERDUE_BUREAU'}, inplace=True)\n\n# Amount overdue of previous loans in other institutions\nnew_train = new_train.join(bureau_sum_amount_overdue, on='SK_ID_CURR')\nnew_train.rename(columns={'AMT_CREDIT_SUM_OVERDUE':'AMT_CREDIT_OVERDUE_BUREAU'}, inplace=True)\n\n# Number of times credit was prolonged of previous loans in other institutions\nnew_train = new_train.join(bureau_credit_prolong_client_n, on='SK_ID_CURR')\nnew_train.rename(columns={'CREDIT_CREDIT_PROLONG':'CNT_DAYS_PROLONG_BUREAU'}, inplace=True)","d578a525":"# Joining with the new features from previous application dataset\n# Number of previous loans in Home Credit\nnew_train = new_train.join(prev_app_acc_n, on='SK_ID_CURR')\nnew_train.rename(columns={'SK_ID_PREV':'CNT_ACOUNTS_HC'}, inplace=True)\n\n# Number of refused previous loans in Home Credit\nnew_train = new_train.join(prev_app_refused_n, on='SK_ID_CURR')\nnew_train.rename(columns={'SK_ID_PREV':'CNT_REFUSED_HC'}, inplace=True)","02ecf264":"# Joining with the new features from instalment payment dataset\n# Number of delayed days of instalment payment in Home Credit\ninst_paym_delayed_clients.values[inst_paym_delayed_clients.values < 0] = 0\nnew_train = new_train.join(inst_paym_delayed_clients, on='SK_ID_CURR')\nnew_train.rename(columns={'DELAYED':'CNT_DAYS_DELAYED_INSTALLMENT_HC'}, inplace=True)\n\n# Amount of delayed instalment payment in Home Credit\ninst_paym_debt_client.values[inst_paym_debt_client.values > 0] = 0\nnew_train = new_train.join(inst_paym_debt_client, on='SK_ID_CURR')\nnew_train.rename(columns={'AMT_DEBT':'AMT_DEBT_INSTALLMENT_HC'}, inplace=True)","d11b704d":"# Joining with the new features from credit card balance dataset\n# Amount of debt of credit card in Home Credit\ncredit_card_debt_client.values[credit_card_debt_client.values > 0] = 0\nnew_train = new_train.join(credit_card_debt_client, on='SK_ID_CURR')\nnew_train.rename(columns={'AMT_DEBT':'AMT_DEBT_CREDIT_CARD_HC'}, inplace=True)\n\n# Number of days past due of credit card in Home Credit\nnew_train = new_train.join(dpd_credit_card, on='SK_ID_CURR')\nnew_train.rename(columns={'SK_DPD':'CNT_DPD_CREDIT_CARD_HC'}, inplace=True)","79543ef6":"# Joining with the new features from pos cash balance dataset\n# Number of days past due of pos cash balance in Home Credit\nnew_train = new_train.join(dpd_cash_loan, on='SK_ID_CURR')\nnew_train.rename(columns={'SK_DPD':'CNT_DPD_CASH_LOAN_HC'}, inplace=True)","83f5b9c7":"# Dealing with missing values\n# Filling the new engineered missing values with zero\nnew_train[new_train.columns[106 :]] = new_train[new_train.columns[106 :]].fillna(0)","4db9b5e8":"# Filling the numerical missing values with mean value\nnew_train = new_train.fillna(new_train.mean())","4c82d822":"# Spliting the new_train into features X and target Y components\ny_train = new_train['TARGET']\nX_train = new_train.drop(['TARGET'], axis=1)","79a5c826":"# Standardizing all the features to a normal distribution \nsc = StandardScaler()\nX_train_std = sc.fit_transform(X_train)","432199e5":"# Using PCA from silkit learn\npca = PCA()\nX_train_pca = pca.fit_transform(X_train_std)","0c3dd5f4":"# Ploting the individual and cumulative explained variance of the features\nplt.bar(range(1, (len(pca.explained_variance_ratio_) +1)), pca.explained_variance_ratio_, alpha=0.5, align='center', \n        label='individual explained variance')\nplt.step(range(1, (len(pca.explained_variance_ratio_) +1)), np.cumsum(pca.explained_variance_ratio_), where='mid', \n        label='cumulative explained variance')\nplt.ylabel('Explained variance ratio')\nplt.xlabel('Principal component index')\nplt.legend(loc='best')\nplt.tight_layout()\nplt.show()","ea03fa7a":"# Ploting the result of the cumulative variance with 40 features\npca = PCA(n_components= 40)\nX_train_pca = pca.fit_transform(X_train_std)\n\n# Ploting the individual and cumulative explained variance of the features\nplt.bar(range(1, 41), pca.explained_variance_ratio_, alpha=0.5, align='center', \n        label='individual explained variance')\nplt.step(range(1, 41), np.cumsum(pca.explained_variance_ratio_), where='mid', \n        label='cumulative explained variance')\nplt.ylabel('Explained variance ratio')\nplt.xlabel('Principal component index')\nplt.legend(loc='best')\nplt.tight_layout()\nplt.show()","2e039026":"Most of the clients have 2 previous active credit loans in other institutions, but some of them have more than 30.","0e75587f":"   22% of the clients were overdue with credit card payment in previous application in Home Credit.","7e37221a":"### How many clients were overdue with previous cash loans applications in Home Credit?","185e5bfd":"### 3.5 Evaluating Credit Card Balance dataset\n<a id=\"credit_card\"><\/a>","e223034d":"### How many clients with payment difficulties?","b73b0af8":"Most of the clients have 4 previous credit loans in other institutions, but some of them have more than 100.","2fdb8fd5":"96% of the previous application was for the XAP and XNA purpose. I don`t actually know what that mean.","5341942a":"### Which are the top 5 purpose of previous credit on Home Credit?","993c86b0":"## Table of Contents","55c90ab3":"### How many clients delayed with installment payment on previous Home Credit applications?","b9ea5ff9":"Most of the clients with refused application have 2 refused credit applications on Home Credit but some of them have more than 60.","5607d482":"### How many active previous credit loans the clients have in other institutions?","57d2a7d3":"### What is the current amount past due of clients with previous credit loans in other institutions?","5b226f5d":"### What is the debt amount that clients have on previous credit loans in onther institutions?","210c684a":"62% of previous applications on Home Credit are approved, 18% are cancelled and 17% are refused.","b373b61c":"Less than 2% of the clients are overdue with previous credit loans at other institution.\nThere are 2.003 different clients in the Bureau dataset that are not in the Train dataset.","e8b8c9fb":"### How many previous credit loans the clients have in Home Credit?","49d227d6":"The individual values of the explained variance are realy small, so we will need at least 40 features to explain 70% of the cumulative variance. ","aa10de1b":"Most of the clients have 4 previous credit loans in Home Credit, but some of them have more than 100.","61a3d471":"Only 3% of the clients have prolonged credit on previous accounts. Most of them have prolonged only once but there are clients that prolonged credit 9 times.","a4f37b10":"### 3.4 Evaluating Instalment Payment dataset\n<a id=\"instalment\"><\/a>","1761b4df":"Most of the 3.864 clients are 35 days overdue but the mean value is 351 days overdue. We can explain that because of a small number of clients that are a few thousand days overdue and move the average to a bigger value.","80f292f6":"My objective with this notebook was to show how to explore and analyze data to get ready for modeling. There are many other tools and procedures that can be used to get even more insights from the data, but a choose a few that are very common in data science projects.\n\nThe next step will be modeling and evaluating to check if more analysis should be done to get a better accuracy of the training predictions.\n\nI would appreciate a collaborative approach of the community with comments and suggestion to this study. \n","f1697abb":"## 7. Conclusion and Next Steps\n<a id=\"conclusion\"><\/a>","66a1d347":"### How many previous refused applications clients have on Home Credit?","7f88e1db":"### How many times clients prolonged credit in previous credit loans in onther institutions?","e50d9dcc":"### 3.2 Evaluating BUREAU dataset\n<a id=\"bureau\"><\/a>","1ba61497":"### 3.1 Evaluating TRAIN dataset\n<a id=\"train\"><\/a>","9fcefa7c":"### How many previous credit loans the clients have in other institutions?","b14d65d4":"Only 3% of the clients have delayed at least one payment of instalments on previous application in Home Credit.","d13150eb":"## 1. Loading Libraries\n<a id=\"lib\"><\/a>","3deaae59":"8% of the clients are not trustable for a loan","458bb661":"## 3. Exploratory Data Analysis - EDA\n<a id=\"eda\"><\/a>","e008b271":"Most of the clients are less than \\$1.000 overdue, but at least 500 clients are more than \\$10.000 overdue.","e6be854b":"   19% of the clients were overdue with cash loan payment in previous application in Home Credit.","0e8eb922":"## 5. Missing Values\n<a id=\"missing\"><\/a>","0336258b":"Most of the clients have a 5936,74 debt with credit card in previous applications in Home Credit, but some of them have more than 200.000,00 in debt.","88ea074c":"Seems that only the 3 Ext_Source features have a high corelation with the target features and we don't know nothing about them. Better explore the other datasets.","a81c195e":"## 4. Features Engineering\n<a id=\"eng\"><\/a>","84224477":"### How many clients were overdue with credit card payment on previous Home Credit applications?","0904cb15":"### How many clients are overdue with previous credit loans in onther institutions?","c9b81d64":"### 3.6 Evaluating Pos Cash Balance dataset\n<a id=\"cash_balance\"><\/a>","e0d5731a":"### Correlation between numerical values in the TRAIN dataset","da46e605":"### What is the status of previous applications on Home Credit?","84f24f0b":"### How many clients are in debt with instalments in previous Home Credit applications?","00c18b1c":"### What is the maximum days past due of clients with previous credit loans in onther institutions?","4aedd321":"40% of the clients have a sum of debts on previous accounts on other institutions between \\$100.000 and \\$1.000.000 and 16% have more than \\$1.000.000","0c60e96c":"# Home Credit Default Risk - Kaggle Competition","3cad0d1f":"## 6. Dimensonality Reduction - Primary Component Analysis - PCA\n<a id=\"pca\"><\/a>","5195a21f":"1. [Loading Libraries](#lib)\n2. [Loading Dataset Files](#files)\n3. [Exploratory Data Analysis - EDA](#eda)  \n    3.1 [Evaluating Train Dataset](#train)   \n    3.2 [Evaluating Bureau Dataset](#bureau)  \n    3.3 [Evaluating Previous_Application Dataset](#previous_application)  \n    3.4 [Evaluating Instalment_Payment Dataset](#instalment)   \n    3.5 [Evaluating Credit_Card_Balance Dataset](#credit_card)   \n    3.6 [Evaluating Pos_Cash_Balance Dataset](#cash_balance)   \n4. [Feature Engineering](#eng)\n5. [Missing Values](#missing)\n6. [Dimensionality Reduction - Primary Component Analysis - PCA](#pca)\n7. [Conclusion and Next Steps](#conclusion)","664f6d65":"### How much credit card debt clients have in previous Home Credit applications?","f976e4eb":"### 3.3 Evaluating PREVIOUS_APPLICATION dataset\n<a id=\"previous_application\"><\/a>","c2b5c1a5":"## 2. Loading Dataset Files\n<a id=\"files\"><\/a>","768ed768":"   34% of the clients are in debt with the credit card in previous application in Home Credit.","09440540":"   37% of the clients are in debt with intalments in previous application in Home Credit."}}