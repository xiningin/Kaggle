{"cell_type":{"ac09d8c6":"code","4bbac9e1":"code","54920ecc":"code","5299cfb2":"code","1e039651":"code","1f04006b":"code","0f399648":"code","db2e8b47":"code","3f348b10":"code","5403c07e":"code","780931dc":"code","7eebae11":"code","eb9b83b7":"code","bff8b488":"code","65a2915a":"code","0e02b2aa":"code","c14f0626":"code","7e61c3cc":"code","f3180ddc":"code","6b6b0440":"code","51d7e0d2":"code","460feb40":"code","77589825":"code","af1d5240":"code","fb541f31":"code","2e4931a6":"code","69f1e8b8":"code","9ea50b10":"code","ed25be24":"code","a997bb07":"markdown","4d270a66":"markdown","53ab982f":"markdown","c2e886e0":"markdown","52754e61":"markdown"},"source":{"ac09d8c6":"!pip install multi-prophet","4bbac9e1":"import gc\nfrom tqdm import tqdm\nimport numpy as np\nimport pandas as pd\nfrom pylab import rcParams\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import mean_squared_error\nfrom scipy.stats import probplot\n\nimport datetime as dt\nfrom datetime import date\nfrom datetime import timedelta\nfrom fbprophet import Prophet\nfrom multi_prophet import MultiProphet\nimport folium\nfrom folium import plugins\n\n%matplotlib inline\nimport os\nimport warnings\nwarnings.filterwarnings(\"ignore\")","54920ecc":"data0=pd.read_csv('..\/input\/earthquake-in-japan\/japan-20190101_20211203_query.csv')\ndata0[1:2]","5299cfb2":"data0=data0.fillna('N')\ndata1=data0[['time','latitude','longitude','depth','mag',]]\ndata1[0:5]","1e039651":"data2=pd.DataFrame(columns=data1.columns.tolist())\nfor i,item in enumerate(data1['time']):\n    data2=pd.concat([data2,data1.loc[i:i]])\ndata2=data2.sort_values(['time']).reset_index(drop=True)    ","1f04006b":"from datetime import datetime as dt\ndata2a=data2.copy()\ndate=[]\nfor item in data2['time']:\n    date+=[dt.strptime(item[0:-5],'%Y-%m-%dT%H:%M:%S')]\ndata2a['date']=date\ndata2a","0f399648":"data4=data2a[data2a['latitude']>33][data2a['latitude']<37][data2a['longitude']>138][data2a['longitude']<142]\ndata4=data4.reset_index(drop=True)\ndata4","db2e8b47":"import plotly.express as px\nfig=px.scatter(x=data4['date'],y=data4['mag'])\nfig=px.scatter(data4, x=\"date\", y=\"mag\")\nfig.update_layout(title='Magnituide of earthquake around Tokyo area in 2019-2021')\nfig.show()","3f348b10":"data4['date2']=data4['date'].apply(lambda x: dt.strptime(str(x)[0:10],'%Y-%m-%d') )\ndata4","5403c07e":"data4.columns","780931dc":"data5=data4[['date2','mag','depth','latitude','longitude']][data4['mag']>4.7]\ndata5","7eebae11":"item1=data5\nitem1.columns = ['ds','y1','y2','y3','y4']\nitem1.y1 = item1.y1.astype('float')\nitem1.y2 = item1.y2.astype('float')\nitem1.y3 = item1.y3.astype('float')\nitem1.y4 = item1.y4.astype('float')\nitem1.ds = item1.ds.astype('datetime64')","eb9b83b7":"# magnitude\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y1)","bff8b488":"# depth\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y2)","65a2915a":"# latitude\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y3)","0e02b2aa":"# longitude\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y4)","c14f0626":"mph = MultiProphet(columns=['y1','y2','y3','y4'])\nmph.fit(item1)\nforecast = mph.predict(item1)\nmph.plot(forecast)","7e61c3cc":"from datetime import timedelta\nstart0 = dt.strptime('2021-01-01','%Y-%m-%d').date()\nend0   = dt.strptime('2023-12-31','%Y-%m-%d').date()\nprint((end0-start0).days)","f3180ddc":"def daterange(start,end):\n    for i in range((end-start).days):\n        return start+timedelta(i)  ","6b6b0440":"dates0=[]\nfor i in range((end0-start0).days):\n    dates0+=[(start0+timedelta(i)).strftime('%Y-%m-%d') ]\nprint(dates0[0:30])","51d7e0d2":"dates0_df=pd.DataFrame(dates0)\ndates0_df.columns=['ds']\ndates0_df","460feb40":"mph","77589825":"#mph = MultiProphet(columns=[\"y1\",\"y2\"])\n#mph.fit(item1)\nforecast3 = mph.predict(dates0_df)\nfigure=mph.plot(forecast3)\nprint(figure)","af1d5240":"forecast3['y1'][['ds','yhat','yhat_lower','yhat_upper']][365:385]\n#forecast3['y2'][['ds','yhat','yhat_lower','yhat_upper']][365:385]\n#forecast3['y3'][['ds','yhat','yhat_lower','yhat_upper']][365:385]\n#forecast3['y4'][['ds','yhat','yhat_lower','yhat_upper']][365:385]","fb541f31":"forecast4a=forecast3['y1'][['ds','yhat','yhat_lower','yhat_upper']][365:365*2]\nforecast4b=forecast3['y2'][['ds','yhat','yhat_lower','yhat_upper']][365:365*2]\nforecast4c=forecast3['y3'][['ds','yhat','yhat_lower','yhat_upper']][365:365*2]\nforecast4d=forecast3['y4'][['ds','yhat','yhat_lower','yhat_upper']][365:365*2]","2e4931a6":"mag0=forecast4a['yhat'].max()\ndate0=forecast4a[forecast4a['yhat']==mag0]['ds'].tolist()[0]\ndepth0=forecast4b[forecast4b['ds']==date0]['yhat'].tolist()[0]\nlat0=forecast4c[forecast4c['ds']==date0]['yhat'].tolist()[0]\nlong0=forecast4d[forecast4d['ds']==date0]['yhat'].tolist()[0]\n\nprint('Date:',date0)\nprint('Magnitude:',mag0)\nprint('Depth:',depth0)\nprint('Latitude:',lat0)\nprint('Longitude:',long0)","69f1e8b8":"forecastall=forecast4a[['ds','yhat']]\nforecastall2=pd.concat([forecastall,forecast4b['yhat'],forecast4c['yhat'],forecast4d['yhat']],axis=1)\nforecastall2.columns=['date','mag','depth','lat','long']\nforecastall2","9ea50b10":"data5=forecastall2[['lat','long']][forecastall2['mag']>5.5]\ndata5","ed25be24":"eq_map = folium.Map(location=[36,141],tiles='Stamen Terrain',zoom_start=7.0,min_zoom=2.0)\neq_map.add_child(plugins.HeatMap(data5))\neq_map","a997bb07":"# fit past and predict past+future","4d270a66":"# Predict MAX Magnitude of Earthquakes in 2022","53ab982f":"# fit past and predict past","c2e886e0":"## Earthquake prediction by Multi Prophet\n\nIt is strongly required to predict possible future earthquakes from past earthquake data and take countermeasures in advance. I am not an expert on earthquake, but I can get data on past earthquakes. What we want to know is that when, where, at what depth, and how much magnitude of an earthquake will occur in the future. Target items to be predicted are many. But, we can predict them at the same time by using Multi Prophet. These two notebooks were done using it.<br\/>\nhttps:\/\/github.com\/vonum\/multi-prophet","52754e61":"# **Earthquake Prediction Tokyo Multi Prophet**"}}