{"cell_type":{"12a7bb88":"code","c2146c2b":"code","9ffb905a":"code","9ba08743":"code","df25effb":"code","f83445f9":"code","8b2b734e":"code","f59919c8":"code","0245e7c2":"code","9b738e85":"code","4f10dba5":"code","44d3ce55":"code","1db2a4f7":"code","32faae7a":"code","60f2490e":"code","e9b1f4ea":"code","8537490d":"code","0360dd09":"code","4d19f56f":"code","98489317":"code","6375f6dc":"code","fdc42f56":"code","5af902f0":"code","1665ea47":"code","7eef095f":"code","e182f5cf":"code","5a7007d0":"code","bd6954fe":"code","d89ae234":"markdown","85dd9c30":"markdown","de308cfc":"markdown","85b992d7":"markdown","89aa73e8":"markdown","beaccada":"markdown","a82583e4":"markdown","7b31e52b":"markdown","bcb39412":"markdown","6782a2c6":"markdown","b46bb7ab":"markdown","9c976844":"markdown","845eabe3":"markdown","74d238d6":"markdown","3c7f8d6b":"markdown","1fc0209a":"markdown","33b957f3":"markdown","851a535e":"markdown","3732d418":"markdown","166e7565":"markdown","c1f6fea8":"markdown","406e67e5":"markdown","80845c9c":"markdown","43d8a8ae":"markdown","34c48cc6":"markdown","0e1c31d8":"markdown","8c2150e0":"markdown","211a8dea":"markdown","6f316549":"markdown","4678b9ba":"markdown","7c943738":"markdown","6a565fa8":"markdown","0681a575":"markdown","ba9fe7b0":"markdown","d4a0df2b":"markdown","20f50481":"markdown","2c252852":"markdown","7de46316":"markdown","6b56731c":"markdown","f39ccf5f":"markdown","78989542":"markdown","2c8c9630":"markdown","d90e5afc":"markdown","04bf137e":"markdown","3ced6aed":"markdown"},"source":{"12a7bb88":"# Import all required modules\nimport pandas as pd\nimport numpy as np\n\n# Disable warnings\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# Import plotting modules\nimport seaborn as sns\nsns.set()\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker\n%matplotlib inline","c2146c2b":"# Tune the visual settings for figures in `seaborn`\nsns.set_context(\n    \"notebook\", \n    font_scale=1.5,       \n    rc={ \n        \"figure.figsize\": (11, 8), \n        \"axes.titlesize\": 18 \n    }\n)\n\nfrom matplotlib import rcParams\nrcParams['figure.figsize'] = 11, 8","9ffb905a":"df = pd.read_csv('..\/input\/mlbootcamp5_train.csv')\nprint('Dataset size: ', df.shape)\ndf.head()","9ba08743":"df_uniques = pd.melt(frame=df, value_vars=['gender','cholesterol', \n                                           'gluc', 'smoke', 'alco', \n                                           'active', 'cardio'])\ndf_uniques = pd.DataFrame(df_uniques.groupby(['variable', \n                                              'value'])['value'].count()) \\\n    .sort_index(level=[0, 1]) \\\n    .rename(columns={'value': 'count'}) \\\n    .reset_index()\n\nsns.factorplot(x='variable', y='count', hue='value', \n               data=df_uniques, kind='bar', size=12);","df25effb":"df_uniques = pd.melt(frame=df, value_vars=['gender','cholesterol', \n                                           'gluc', 'smoke', 'alco', \n                                           'active'], \n                     id_vars=['cardio'])\ndf_uniques = pd.DataFrame(df_uniques.groupby(['variable', 'value', \n                                              'cardio'])['value'].count()) \\\n    .sort_index(level=[0, 1]) \\\n    .rename(columns={'value': 'count'}) \\\n    .reset_index()\n\nsns.factorplot(x='variable', y='count', hue='value', \n               col='cardio', data=df_uniques, kind='bar', size=9);","f83445f9":"for c in df.columns:\n    n = df[c].nunique()\n    print(c)\n    if n <= 3:\n        print(n, sorted(df[c].value_counts().to_dict().items()))\n    else:\n        print(n)\n    print(10 * '-')","8b2b734e":"df.groupby(['gender'])['alco'].mean()","f59919c8":"df.groupby(['gender'])['smoke'].describe(percentiles=[])","0245e7c2":"df['mon']=(df['age'])\/30","9b738e85":"df.groupby(['smoke'])[('mon')].agg(np.median)","4f10dba5":"df['age_years']=(df['age']\/365.25).round().astype(int)","44d3ce55":"range_men = df[(df['gender']==2) & (df['age_years']>=60) & (df['age_years']<65) & (df['smoke']==1)]","1db2a4f7":"range_men[(range_men['cholesterol']==1) & (range_men['ap_hi']<120)]['cardio'].mean()","32faae7a":"range_men[(range_men['cholesterol']==1) & (range_men['ap_hi']>=160) & (range_men['ap_hi']<180)]['cardio'].mean()","60f2490e":"df['h']=(df['height'])\/100\ndf['bmi']=df['weight']\/(df['h'])**2","e9b1f4ea":"df['bmi'].median()","8537490d":"df.groupby('gender')['bmi'].agg(np.mean)","0360dd09":"df.groupby('cardio')['bmi'].agg(np.mean)","4d19f56f":"df.groupby(['gender','alco','cardio'])['bmi'].agg(np.mean).to_frame()","98489317":"df1 = df[(df['ap_lo'] <= df['ap_hi']) & \n                 (df['height'] >= df['height'].quantile(0.025)) &\n                 (df['height'] <= df['height'].quantile(0.975)) &\n                 (df['weight'] >= df['weight'].quantile(0.025)) & \n                 (df['weight'] <= df['weight'].quantile(0.975))]\nprint(df1.shape[0] \/ df.shape[0])","6375f6dc":"#  correlation matrix\nheat = df1.corr(method='pearson')","fdc42f56":"#Create a mask to hide the upper triangle of the correlation matrix (which is symmetric)\nmsk = np.zeros_like(heat,dtype=np.bool)\nmsk[np.triu_indices_from(msk)] = True","5af902f0":"f, ax = plt.subplots(figsize=(12, 9))\n\n# Plot the heatmap \nsns.heatmap(heat, mask=msk, vmax=1, center=0, annot=True, fmt='.1f',\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5});","1665ea47":"df2 = pd.melt(df, value_vars=['height'], id_vars='gender')\nsns.violinplot(x='variable', y='value', hue='gender',  palette=\"muted\", split=True, data=df2, scale='count',scale_hue=False)\nplt.show()","7eef095f":"#  correlation matrix\nmat = df[['id', 'age', 'height', 'weight', \n           'ap_hi', 'ap_lo', 'cholesterol', \n           'gluc']].corr(method='spearman')","e182f5cf":"#Create a mask to hide the upper triangle of the correlation matrix (which is symmetric)\nmask = np.zeros_like(mat,dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\n","5a7007d0":"f, ax = plt.subplots(figsize=(12, 10))\n\n# Plot the heatmap \nsns.heatmap(mat, mask=mask, vmax=1, center=0, annot=True, fmt='.2f',\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5});","bd6954fe":"sns.countplot(x='age_years' ,hue='cardio', data=df);","d89ae234":"On the website for the European Society of Cardiology, a [SCORE scale](https:\/\/www.escardio.org\/Education\/Practice-Tools\/CVD-prevention-toolbox\/SCORE-Risk-Charts) is provided. It is used for calculating the risk of death from a cardiovascular decease in the next 10 years. Here it is:\n<img src=https:\/\/habrastorage.org\/webt\/ik\/gx\/hr\/ikgxhr3w1vzqihgitgrbdorfb14.png width=30%>\n\nLet's take a look at the upper-right rectangle, which shows a subset of smoking men aged from 60 to 65. (It's not obvious, but the values in the figure represent the upper bound).\n\nWe see the value 9 in the lower-left corner of the rectangle and 47 in the upper-right. This means that, for people in this gender-age group whose systolic pressure is less than 120, the risk of a CVD is estimated to be 5 times lower than for those with the pressure in the interval [160,180).\n\nLet's calculate that same ratio using our data.\n\nClarifications:\n- Calculate ``age_years`` feature \u2013 round age to the nearest number of years. For this task, select only the people of age 60 to 64, inclusive.\n- Cholesterol level categories differ between the figure and our dataset. The conversion for the ``cholesterol`` feature is as follows: 4 mmol\/l $\\rightarrow$ 1, 5-7 mmol\/l $\\rightarrow$ 2, 8 mmol\/l $\\rightarrow$ 3.","85dd9c30":"**Question 1.5. (2 points). Calculate the fraction of the people with CVD for the two segments described above. What is the ratio of these two fractions?**\n\n1. 1\n2. 2\n3. 3\n4. 4","de308cfc":"2","85b992d7":"**Question 2.3. (1 point).** Why do these features have strong rank correlation?\n\n1. Inaccuracies in the data (data acquisition errors).\n2. Relation is wrong, these features should not be related.\n3. Nature of the data.","89aa73e8":"In the end, we have:\n- 5 numerical features (excluding *id*);\n- 7 categorical features;\n- 70000 records in total.","beaccada":"2-  From the plot ,it is obvious Height,Smoke has strongest correlation with gender.","a82583e4":"**Question 2.4. (1 point).** What is the smallest age at which the number of people with CVD outnumber the number of people without CVD?\n\n1. 44\n2. 55\n3. 64\n4. 70","7b31e52b":"## 2.3. Rank correlation\n\nIn most cases, *the Pearson coefficient of linear correlation* is more than enough to discover patterns in data. \nBut let's go a little further and calculate a [rank correlation](https:\/\/en.wikipedia.org\/wiki\/Rank_correlation). It will help us to identify such feature pairs in which the lower rank in the variational series of one feature always precedes the higher rank in the another one (and we have the opposite in the case of negative correlation).\n\n### Task:\n\nCalculate and plot a correlation matrix using the [Spearman's rank correlation coefficient](https:\/\/en.wikipedia.org\/wiki\/Spearman%27s_rank_correlation_coefficient).\n","bcb39412":"## 2.4. Age\n\nPreviously, we calculated the age of the respondents in years at the moment of examination.","6782a2c6":"** Question 2.1. (1 point).** Which pair of features has the strongest Pearson's correlation with the *gender* feature?\n\n1. Cardio, Cholesterol\n2. Height, Smoke\n3. Smoke, Alco\n4. Height, Weight","b46bb7ab":"**Question 1.3. (1 point). What is the difference between the percentages of smokers among men and women (rounded)?**\n1. 4\n2. 16\n3. 20\n4. 24","9c976844":"2- The age where people with CVD outnumber those without CVD is 55.","845eabe3":"4","74d238d6":"from the height distribution we can determine that lesser heights generally refer to women with gender = 1 classification and 2 for men.","3c7f8d6b":"You can see that the distribution of cholesterol and glucose levels great differs by the value of the target variable. Is this a coincidence?\n\nNow, let's calculate some statistics for the feature unique values:","1fc0209a":"## 1.4. Cleaning data","33b957f3":"3","851a535e":"### Task:\nWe can see that the data is not perfect. It contains \"dirt\" and inaccuracies. We'll see this better as we visualize the data.\n\nFilter out the following patient segments (we consider these as erroneous data)\n\n- diastolic pressure is higher than systolic \n- height is strictly less than 2.5 percentile (Use `pd.Series.quantile` to compute this value. If you are not familiar with the function, please read the docs.)\n- height is strictly more than 97.5 percentile\n- weight is strictly less than 2.5 percentile\n- weight is strictly more than 97.5 percentile\n\nThis is not everything that we can do to clean this data, but this is sufficient for now.","3732d418":"To make it simple, we will work only with the training part of the dataset:","166e7565":"1- The summary statistics depict more women than men in the sample.","c1f6fea8":"**Question 1.2. (1 point). Which gender more often reports consuming alcohol - men or women?**\n1. women\n2. men","406e67e5":"## 1.1. Basic observations","80845c9c":"# Part 2. Visual data analysis\n\n## 2.1. Correlation matrix visualization\n\nTo understand the features better, you can create a matrix of the correlation coefficients between the features. Use the initial dataset (non-filtered).\n\n### Task:\n\nPlot a correlation matrix using [`heatmap()`](http:\/\/seaborn.pydata.org\/generated\/seaborn.heatmap.html). You can create the matrix using the standard `pandas` tools with the default parameters.","43d8a8ae":"**Question 1.7. (2 points). What percent of the original data (rounded) did we throw away?**\n\n1. 8\n2. 9\n3. 10\n4. 11","34c48cc6":"### Task:\n\nCreate a *count plot* using [`countplot()`](http:\/\/seaborn.pydata.org\/generated\/seaborn.countplot.html) with the age on the *X* axis and the number of people on the *Y* axis. Your resulting plot should have two columns for each age, corresponding to the number of people for each *cardio* class of that age.","0e1c31d8":"\n# <center>Analyzing cardiovascular disease data ","8c2150e0":"**Question 2.2. (1 point).** Which pair of features has the strongest Spearman correlation?\n\n1. Height, Weight\n2. Age, Weight\n3. Cholesterol, Gluc\n4. Cardio, Cholesterol\n5. Ap_hi, Ap_lo\n6. Smoke, Alco","211a8dea":"We can see that the target classes are balanced. That's great!\n\nLet's split the dataset by target values. Can you already spot the most significant feature by just looking at the plot?","6f316549":"Let's get to know our data by performing a preliminary data analysis.\n\n#  Part 1. Preliminary data analysis\n\nFirst, we will initialize the environment:","4678b9ba":"You will use the `seaborn` library for visual analysis, so let's set that up too:","7c943738":"3 -   10% of the data was removed.","6a565fa8":"## 1.3. Analyzing BMI\n### Task:","0681a575":"5-   Ap_hi & Ap_lo have the strongest correlation in the matrix of 0.74.","ba9fe7b0":"It would be instructive to peek into the values of our variables.\n \nLet's convert the data into *long* format and depict the value counts of the categorical features using [`factorplot()`](https:\/\/seaborn.pydata.org\/generated\/seaborn.factorplot.html).","d4a0df2b":"Create a new feature \u2013 BMI ([Body Mass Index](https:\/\/en.wikipedia.org\/wiki\/Body_mass_index)). To do this, divide weight in kilogramms by the square of the height in meters. Normal BMI values are said to be from 18.5 to 25. ","20f50481":"**Question 1.1. (1 point). How many men and women are present in this dataset? Values of the `gender` feature were not given (whether \"1\" stands for women or for men) \u2013 figure this out by looking analyzing height, making the assumption that men are taller on average. **\n1. 45530 women and 24470 men\n2. 45530 men and 24470 women\n3. 45470 women and 24530 men\n4. 45470 men and 24530 women","2c252852":"1-  Most consumption of alcohol is likely by men.","7de46316":"**Question 1.4. (1 point). What is the difference between median values of age for smokers and non-smokers (in months, rounded)? You'll need to figure out the units of feature `age` in this dataset.**\n\n1. 5\n2. 10\n3. 15\n4. 20","6b56731c":"## 2.2. Height distribution of men and women\n\nFrom our exploration of the unique values earlier, we know that the gender is encoded by the values *1* and *2*. Although you do not know the mapping of these values to gender, you can figure that out graphically by looking at the mean values of height and weight for each value of the *gender* feature.\n\n### Task:\n\nCreate a violin plot for the height and gender using [`violinplot()`](https:\/\/seaborn.pydata.org\/generated\/seaborn.violinplot.html). Use the parameters:\n- `hue` to split by gender;\n- `scale` to evaluate the number of records for each gender.\n\nIn order for the plot to render correctly, you need to convert your `DataFrame` to *long* format using the `melt()` function from `pandas`. Here is [an example](https:\/\/stackoverflow.com\/a\/41575149\/3338479) of this for your reference.","f39ccf5f":"**Question 1.6. (2 points). Choose the correct statements:**\n\n1. Median BMI in the sample is within the range of normal BMI values.\n2. The BMI for women is on average higher than for men.\n3. Healthy people have, on average, a higher BMI than the people with CVD.\n4. For healthy, non-drinking men, BMI is closer to the norm than for healthy, non-drinking women","78989542":"## 1.2. Risk maps\n### Task:","2c8c9630":"3- The nature of the data says so.","d90e5afc":"4","04bf137e":"3- The ratio of the 2 segments one being 26% and other being 86% is approximately 3 fold.","3ced6aed":"\n#### Problem\n\nPredict the presence or absence of cardiovascular disease (CVD) using the patient examination results.\n\n#### Data description\n\nThere are 3 types of input features:\n\n- *Objective*: factual information;\n- *Examination*: results of medical examination;\n- *Subjective*: information given by the patient.\n\n| Feature | Variable Type | Variable      | Value Type |\n|---------|--------------|---------------|------------|\n| Age | Objective Feature | age | int (days) |\n| Height | Objective Feature | height | int (cm) |\n| Weight | Objective Feature | weight | float (kg) |\n| Gender | Objective Feature | gender | categorical code |\n| Systolic blood pressure | Examination Feature | ap_hi | int |\n| Diastolic blood pressure | Examination Feature | ap_lo | int |\n| Cholesterol | Examination Feature | cholesterol | 1: normal, 2: above normal, 3: well above normal |\n| Glucose | Examination Feature | gluc | 1: normal, 2: above normal, 3: well above normal |\n| Smoking | Subjective Feature | smoke | binary |\n| Alcohol intake | Subjective Feature | alco | binary |\n| Physical activity | Subjective Feature | active | binary |\n| Presence or absence of cardiovascular disease | Target Variable | cardio | binary |\n\nAll of the dataset values were collected at the moment of medical examination."}}