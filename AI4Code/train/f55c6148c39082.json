{"cell_type":{"4e764184":"code","7929fb54":"code","7cd787b9":"code","5b66e24b":"code","2d6e88cb":"code","739d74f1":"code","07c8e40d":"code","a9d2098e":"code","b24f950c":"code","056ad5d4":"code","458685a0":"code","59fdd0e1":"code","a523f760":"code","fd2f688d":"code","97d0e5e1":"code","dc984ab5":"code","1c41417d":"markdown","a3d987fc":"markdown"},"source":{"4e764184":"import numpy as np \nimport pandas as pd \nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nimport matplotlib.pyplot as plt\nimport tensorflow as tf\n\nfrom tensorflow.keras.datasets import fashion_mnist\nfrom tensorflow.keras.layers import Dense\nfrom tensorflow.keras.optimizers import Adam\nfrom tensorflow.keras.layers import Conv2D, Flatten, Dense, AveragePooling2D, GlobalAveragePooling2D,Dropout\nfrom tensorflow.keras.applications.resnet import ResNet50\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator","7929fb54":"df = pd.read_csv('..\/input\/cats-and-dogs-breeds-classification-oxford-dataset\/annotations\/annotations\/list.txt')\ninfo = df.head(4).copy()\ndf = df.loc[5:,]\ndf[['CLASS-ID','SPECIES','BREED','ID']] = df['#Image CLASS-ID SPECIES BREED ID'].str.split(expand=True) \ndf = df.drop('#Image CLASS-ID SPECIES BREED ID',axis=1)\ndf = df.rename(columns={\"CLASS-ID\": \"image\", \"SPECIES\": \"CLASS-ID\", 'BREED' : \"SPECIES\", \"ID\":\"BREED ID\"})\ndf[[\"CLASS-ID\",\"SPECIES\",\"BREED ID\"]] = df[[\"CLASS-ID\",\"SPECIES\",\"BREED ID\"]].astype(int)\ndf= df[df['SPECIES']==1] #cats\ndf['image'] = df['image'].apply(lambda x : str(x)+'.jpg')\ndf = df[['image','BREED ID']]\ndf = df.reset_index()\ndf = df.drop('index',axis=1)\ndf['BREED ID'] = df['BREED ID'].astype('str')","7cd787b9":"train_datagen = ImageDataGenerator(rescale=1.\/255,\n                                    shear_range=0.2,\n                                    zoom_range=0.2,\n                                    horizontal_flip=True,\n                                    vertical_flip=True,\n                                    validation_split=0.2,\n                                    rotation_range=90,\n                                    width_shift_range=0.2, \n                                   height_shift_range=0.2)\n\n\nvalidation_datagen = ImageDataGenerator(\n    validation_split=0.2,\n    rescale=1.\/255)","5b66e24b":"train_gen_flow = train_datagen.flow_from_dataframe(\n        dataframe=df,\n        directory='..\/input\/cats-and-dogs-breeds-classification-oxford-dataset\/images\/images',\n        x_col='image',\n        y_col='BREED ID',\n        target_size=(350, 350),\n        batch_size=64,\n        class_mode=\"categorical\",\n        seed=123,\n        #validate_filenames = False,\n        subset='training'\n)\n\nvalid_gen_flow = validation_datagen.flow_from_dataframe(\n        dataframe=df,\n        directory='..\/input\/cats-and-dogs-breeds-classification-oxford-dataset\/images\/images',\n        x_col='image',\n        y_col='BREED ID',\n        target_size=(350, 350),\n        batch_size=64,\n        class_mode=\"categorical\",\n        seed=123,\n        #validate_filenames = False,\n        subset='validation')","2d6e88cb":"features, target = next(train_gen_flow)\n\nfig = plt.figure(figsize=(10,10))\nfor i in range(10):\n    fig.add_subplot(4, 4, i+1)\n    plt.imshow(features[i])\n    plt.xticks([])\n    plt.yticks([])\n    plt.tight_layout()","739d74f1":"optimizer= Adam()\n\nbackbone = ResNet50(input_shape=(350,350,3),weights='imagenet', include_top=False)\n#backbone.trainable = False\nmodel = Sequential()\nmodel.add(backbone)\nmodel.add(GlobalAveragePooling2D())\nmodel.add(Dense(12, activation='softmax'))\nmodel.compile(loss='categorical_crossentropy',optimizer=optimizer, metrics=['acc'])\nmy_callbacks = [\n    tf.keras.callbacks.EarlyStopping(patience=25),\n]","07c8e40d":"def train_model(model, train_data, test_data,batch_size=None,epochs=250, steps_per_epoch =None, validation_steps=None):\n    if steps_per_epoch is None:\n        steps_per_epoch = len(train_data)\n    if validation_steps is None:\n        validation_steps = len(test_data)\n    model.fit(train_data,\n          validation_data=test_data,\n          steps_per_epoch=steps_per_epoch,\n          validation_steps=validation_steps,\n          verbose=1, epochs=epochs, callbacks=my_callbacks)\n    return model","a9d2098e":"train_model(model,train_gen_flow,valid_gen_flow)","b24f950c":"result = model.predict(features[[22]]) \nresult = result.tolist()","056ad5d4":"breeds = { \"1\": \"Abyssinian\", \"2\":\"Bengal\", \"3\":\"Birman\", \"4\":\"Bombay\",\"5\":\"British Shorthair\", \"6\":\"Egyptian Mau\", \"7\":\"Maine Coon\",\"8\":\"Persian\", \"9\":\"Ragdoll\",\"10\":\"Russian Blue\", \"11\":\"Siamese\",\"12\":\"Sphynx\"}","458685a0":"indices = valid_gen_flow.class_indices\nindices = indices.keys()\nfinal_breed = []\nfor i in indices:\n    final_breed.append(breeds.get(i))\nfinal_breed","59fdd0e1":"sorted(zip(result, final_breed), reverse=True)[:3]","a523f760":"def predict_breed(imgage):\n    img = cv2.imread(image)\n    img = cv2.resize(img,(350,350))\n    img = np.reshape(img,[1,350,350,3])\n    img = img\/255.\n    classes = model.predict([img])","fd2f688d":"model.save(\"model.h5\")","97d0e5e1":"import cv2\nimg = cv2.imread('..\/input\/myface\/photo_2020-06-26_14-35-07.jpg')\nimg = cv2.resize(img,(300,300))\nimg = np.reshape(img,[1,300,300,3])\nimg = img\/255.\n\nresult = model.predict([img])","dc984ab5":"sorted(zip(result[0], final_breed), reverse=True)[:3]","1c41417d":"Here i crated a model that predicts cat breed with 82% accuracy","a3d987fc":"chek it up"}}