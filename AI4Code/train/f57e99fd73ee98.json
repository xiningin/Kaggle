{"cell_type":{"53fee327":"code","92435eaa":"code","b3f5a7b2":"code","4291002e":"code","62bc0f31":"code","fa2c3186":"code","4f28167d":"code","cc4bb123":"code","4b0a0e15":"code","70cf24a8":"code","ae56e62e":"code","74712a43":"code","82469d3f":"code","3074e22c":"code","74dbc055":"code","5d5bbf0e":"code","e18a1d1f":"code","20f5f639":"code","daef3ad0":"code","ed140cd1":"code","a2b793d7":"code","a88fc5c4":"code","96311d44":"markdown","4e7adf2b":"markdown","33f23c29":"markdown","c8d599ed":"markdown","e025939e":"markdown","75395449":"markdown","56036ac4":"markdown","8eb1ca31":"markdown","435e9be0":"markdown","484910cf":"markdown","3ccb7759":"markdown","11ed1d76":"markdown","7605482f":"markdown","29d216fa":"markdown","78046608":"markdown","799ca0d0":"markdown","bf71bd48":"markdown","c0f09bed":"markdown","7b9c53e6":"markdown","18b50374":"markdown","d4420e23":"markdown","73cb3f6e":"markdown","9ba608c4":"markdown","de66205d":"markdown","782b2779":"markdown","970c2862":"markdown","90599fbf":"markdown","fa523109":"markdown","f7bf6d9f":"markdown","3be8db15":"markdown","56b6a163":"markdown","baf2919f":"markdown"},"source":{"53fee327":"import numpy as np \nimport pandas as pd\nimport matplotlib.pyplot as plt\nplt.style.use('fivethirtyeight') ","92435eaa":"humidity = pd.read_csv('..\/input\/historical-hourly-weather-data\/humidity.csv', index_col='datetime', parse_dates=['datetime'])\nhumidity.head()","b3f5a7b2":"humidity[\"Vancouver\"].asfreq('M').plot() #Frecuencia Mensual\nplt.show()","4291002e":"humidity.loc[humidity.index.year==2015][\"Vancouver\"].asfreq('D').plot()\nplt.show()","62bc0f31":"humidity.loc[(humidity.index.weekday==0) & (humidity.index.year==2013)\n            ][\"Vancouver\"].plot() # Seleccionando solo los lunes\nplt.show()","fa2c3186":"humidity.loc[\"2013-01-01\":\"2013-01-15\"][\"Vancouver\"].plot()\nplt.show()","4f28167d":"# Forma para ver % de datos faltantes por columna.\n(humidity.isna().sum(axis=0) \/ humidity.shape[0] * 100)","cc4bb123":"humidity = humidity.fillna(method='ffill')\nhumidity.head()","4b0a0e15":"humidity = humidity.fillna(method='bfill')\nhumidity.head()","70cf24a8":"humidity[\"Vancouver\"].asfreq('M').head()","ae56e62e":"humidity.groupby(pd.Grouper(freq='M'))[\"Vancouver\"].mean().head()","74712a43":"humidity[\"Los Angeles\"].tail()","82469d3f":"humidity[\"Los Angeles\"].shift(1).tail()","3074e22c":"humidity[\"Vancouver\"].asfreq('M').plot(legend=True)\nshifted = humidity[\"Vancouver\"].asfreq('M').shift(10).plot(legend=True)\nshifted.legend(['Vancouver','Vancouver_lagged'])\nplt.show()","74dbc055":"humidity[\"Vancouver\"].asfreq('M').plot(legend=True)\nshifted = humidity[\"Vancouver\"].asfreq('M').shift(-10).plot(legend=True)\nshifted.legend(['Vancouver','Vancouver_lagged'])\nplt.show()","5d5bbf0e":"humidity[\"Los Angeles\"].tail()","e18a1d1f":"humidity[\"Los Angeles\"].diff(1).tail()","20f5f639":"humidity[\"Los Angeles\"].pct_change(1).tail() * 100","daef3ad0":"rolling_los_angeles = humidity[\"Los Angeles\"].asfreq('M').rolling(3).mean() # Promedio de los ultimos 3 periodos\nhumidity[\"Los Angeles\"].asfreq('M').plot()\nrolling_los_angeles.plot()\nplt.legend(['Regular','Rolling Mean'])\nplt.show()","ed140cd1":"expanding_los_angeles = humidity[\"Los Angeles\"].asfreq('M').expanding().mean() # Promedio de los ultimos 3 periodos\nhumidity[\"Los Angeles\"].asfreq('M').plot()\nexpanding_los_angeles.plot()\nplt.legend(['Regular','Expanding Mean'])\nplt.show()","a2b793d7":"### Convertir datos a formato longitudinal.\nhumidity_long = humidity.reset_index()\nhumidity_long = pd.melt(humidity_long,id_vars='datetime')\nhumidity_long.columns = [\"datetime\",\"area\",\"humidity\"]\nhumidity_long.head()","a88fc5c4":"humidity_long[\"change\"] = humidity_long.groupby(\"area\")[\"humidity\"].pct_change()\nhumidity_long.head(10)","96311d44":"# Tips & Trucos para predecir\n\n1. Google es tu amigo\n2. Arma tu linea de produccion\n3. Modelo Minimo Viable\n4. Explora agilmente\n5. Control de calidad\n6. Ingredientes secretos para la salsa secreta\n\n### \u00d1apa local: trabajando con series de tiempo","4e7adf2b":"### Lectura de Datos","33f23c29":"La forma m\u00e1s sencilla de visualizar una serie de tiempo es llevandola a un gr\u00e1fico de l\u00ednea.Esto nos permite ver los datos de interes y sus cambios en el tiempo.","c8d599ed":"Pero, tambi\u00e9n faltan datos en las primeras filas, que no tienen datos anteriores con las cuales llenarlos. En este caso, podemos utilizar el metodo **bfill**","e025939e":"- https:\/\/pandas.pydata.org\/pandas-docs\/stable\/user_guide\/timeseries.html (Series de Tiempo en Pandas)\n- https:\/\/pandas.pydata.org\/pandas-docs\/stable\/reference\/api\/pandas.Series.rolling.html#pandas.Series.rolling (Funcion Rolling)\n- https:\/\/www.kaggle.com\/danofer\/getting-started-with-time-series-features (Feature Engineering con series de tiempo)","75395449":"# Exploren! (pero rapido!)\n\nNo hay un algoritmo perfecto, ni magico ni que sea el mejor para todos los problemas. Por lo cual siempre es bueno *probar*, (sin profundizar mucho) diversos tipos para ver cual tipo _parece_ ser mejor para el problema actual.\n\nAqui una guia completa de como hacer esto en Python: [Spotchecking en Python](https:\/\/machinelearningmastery.com\/spot-check-machine-learning-algorithms-in-python\/)\n","56036ac4":"#### Diferencias entre periodos\n\nAl igual que con los lags, se puede calcular la diferencia entre un periodo y otro, como una resta sencilla.","8eb1ca31":"## Recursos Utiles","435e9be0":"Para cambiar de un nivel de granularidad m\u00e1s bajo a uno m\u00e1s alto con la menor perdida de informaci\u00f3n, es mejor utilizar funciones de agregaci\u00f3n, como un promedio, en combinaci\u00f3n con **Grouper**.","484910cf":"Tambien se puede ver esta diferencia de manera porcentual. De esta manera, diferencias en comportamiento se ven de manera similar sin importar la escala de los valores en el tiempo.","3ccb7759":"#### Cambio de Frecuencia \n\nEste cambia el nivel de granularidad de los datos temporales, como pasar de dias a semanas, o de a\u00f1os a meses. Este selecciona el primer registro encontrado seg\u00fan la frecuencia elegida. ","11ed1d76":"#### Por dia de semana","7605482f":"# Ingredientes secretos para la salsa secreta\n\nEl modelo ganador sera la mejor receta para la mejor salsa, y sera un *secreto* de su equipo.\n\nAlgo que no suele faltar en soluciones ganadoras son los *ingredientes secretos*: _Datos transformados de una forma muy particular_\n\nA esto se le conoce como *feature engineering*, [aqui una referencia](https:\/\/www.amazon.com\/dp\/B07BNX4MWC). _Si son amigos de google puede que resuelvan gratis._\n\n### Datos transformados?\n\nPero no a lo loco, sino con proposito:\n\n* Que hacer con los datos ausentes? Estan para algunos registros pero no otros.\n* Que relacion tienen las caracteristicas (features) con el objetivo predictivo?\n* Que relacion tienen las caracteristicas entre si?\n* Los algoritmos estan esperando datos de una forma particular o funcionan mejor con los datos transformados?\n\n### Dos ejemplos conceptuales\n\n#### Datos numericos a categoricos (binning o quantization)\n\nPodemos tomar caracteristicas numericas y reemplazarlas por categorias o bins. Esto puede incluso servir para manejar valores ausentes, ya que podemos conservar un valor que represente esa \"ausencia\" (ej.: 'N\/A')\n\n[Aqui varios ejemplos de cosas que hacer con datos numericos](https:\/\/towardsdatascience.com\/understanding-feature-engineering-part-1-continuous-numeric-data-da4e47099a7b)\n\n#### Datos categoricos a numericos (coding o encoding)\n\nEsto es muy comun, especialmente porque muchas herramientas requieren que todos los datos sean numericos.\n\nAparte de cosas como las descritas aqui: [especificamente para Python (sklearn)](https:\/\/scikit-learn.org\/stable\/modules\/preprocessing.html#preprocessing-categorical-features)\n\nPodemos sustituir las variables categoricas por valores numericos relacionadas a otras variables que si son numericos, e incluso en el caso de regresiones al mismo objetivo predictivo.\n\nPor ejemplo, imaginen que tienen una caracteristica que contiene ciudades, podriamos sustituirla por:\n\n* PIB\n* cantidad poblacional\n* tama\u00f1o territorial\n* a\u00f1os de existencia\n* promedio\/min\/max de nuestro objetivo predictivo entre los registros de cada ciudad\n\n...y por ahi maria se va.\n","29d216fa":"#### Funciones de Ventana\n\nUna ventana de tiempo es rango especifico de tiempo de tama\u00f1o x, ejemplo las ultimas 4 horas. Se pueden agrupar los periodos de una ventana, en un solo valor que represente la informaci\u00f3n de la venta, como una suma o un promedio. Existen dos funciones principales: \n\n- rolling: Escoge ventanas del mismo tama\u00f1o, se mueve la ventana por cada periodo.\n- expanding: Toma todos los datos anteriores por cada periodo.\n\n","78046608":"#### Por un rango de fecha","799ca0d0":"Se puede suplir un numero negativo para traer periodos del futuro al periodo actual.","bf71bd48":"# Arma tu linea de producci\u00f3n\n\nEl proposito del reto es producir un modelo predictivo. Pero no se dejen enga\u00f1ar.\n\nLa primera tarea debe ser construir no el modelo mismo, sino el andamiaje que permitir\u00e1 construir.\n\n![](https:\/\/cdn.redshift.autodesk.com\/2017\/10\/Air-Force-Academy-Scaffold-Design_header.jpg)\n\nEste es el codigo, o los pasos en tu herramienta preferida, que:\n\n1. Leen los datos \n2. Los limpian\n3. Los transforman para entrenamiento\n4. Construyen un modelo\n5. Validan el modelo\n6. Aplican el modelo a los datos de prueba\n7. Preparan el archivo de respuesta al reto\n\n\n## Enfoquense en completar el ciclo primero\n\n## Resistan la tentaci\u00f3n de profundizar los pasos 2, 3 y 4 sin haber completado el resto (KISS)","c0f09bed":"Tambi\u00e9n, se pueden filtrar las fechas utilizados como indice de diversas formas. Algunas de estas son:\n\n#### Por a\u00f1o","7b9c53e6":"## Feature Engineering","18b50374":"Existen diversas funciones de agregaci\u00f3n que se pueden aplicar a la funci\u00f3n rolling como:\n\n- sum\n- Desviaci\u00f3n Estandar (std)\n- mediana\n- min\/max cumulativo\n- Funciones Personalizadas\n\nIgualmente se pueden aplicar estas funciones por grupos, con la funci\u00f3n **groupby**, cuando la data esta en periodos pero agrupado por una entidad como un cliente.","d4420e23":"Y m\u00e1s. Por cada elemento que tiene una fecha y hora, es posible filtrar por el mismo o combinaciones entre ellas. ","73cb3f6e":"# (\u00d1apa local) Trabajando con Datos de Serie de Tiempo\n_cortes\u00eda de Juan Nu\u00f1ez Corporan_\n\nUna gran parte de los datos que son almacenados por los sistemas computacionales contienen un elemento de tiempo. Este elemento es vital, ya que te permite entender el entorno del sistema en puntos especificos, como se comportaba antes, y como se podria comportar en el futuro. Trabajar con este tipo de dato no es muy sencillo, por lo que en este notebook les mostraremos funciones y buenas practicas para preparar sets de datos temporales.","9ba608c4":"Cambiar de un nivel de granularidad alto a uno m\u00e1s bajo no es recomendable, debido a la dificultad de representar los datos con tan poca informaci\u00f3n (\u00bfc\u00f3mo sabemos el clima de cada dia de un mes teniendo el promedio del mes?)\n\n#### Lags \n\nEste trae el valor anterior o posterior en el tiempo, al periodo actual. Podemos utilizar la funcion **shift** para lograrlo.","de66205d":"# Google es tu amigo\n\nEs poco lo que no se puede encontrar, solo debes saber invocar el conjuro apropiado.\n\n* Cuales son las palabras clave de tu problema?\n* No temas preguntar de forma natural\n* Se especifico, pero no demasiado\n* Refina tu conjuro\n\n### Corolario: Kaggle es tu Amigo\n\n* Exploren la gran cantidad de ejemplos funcionales que existen para problemas del mismo tipo (regresion: [Ejemplos](https:\/\/www.kaggle.com\/c\/house-prices-advanced-regression-techniques\/overview\/tutorials))\n* No se ofusquen con la complejidad de algunos\n* Aprovechen el poder que brindan los kernels (no pierdan tiempo instalando herramientas)\n* Ya hasta les permite sus propios archivos!","782b2779":"# Modelo Minimo Viable\n\nPara realmente llevarse del consejo anterior, necesitaran crear un *MODELO MINIMO VIABLE*.\n\n* No tiene que ser bueno, simplemente que genere las predicciones es suficiente\n* Consideren algoritmos clasicos: Linear Regression, kNN y\/o Decision Trees\n\n## La idea es tener algo que puedan enviar como respuesta al reto ASAP\n\n* no importa si saben que pueden hacer algo mejor, tenganlo a 4ta.\n* esto les servira como linea base: cualquier cosa que hagan tiene que ser mejor que esto\n\n","970c2862":"# \u00d1apa internacional: [Ejemplo completo de pi a pa](https:\/\/www.kaggle.com\/masumrumi\/a-detailed-regression-guide-with-house-pricing\/notebook)","90599fbf":"Hay varios calculos que solo son posibles de realizar con datos temporales. Veamos algunos de estos: ","fa523109":"### Exploraci\u00f3n de Datos Temporales","f7bf6d9f":"El valor n\u00famerico suplido a la funci\u00f3n shift representa la cantidad de periodos a visitar. Ejemplo, con **shift(10)**, se traer\u00e1 el dato de 10 periodos anteriores al periodo actual.","3be8db15":"# Control de Calidad\n\nOK, ya tienen:\n\n* Linea de Produccion\n* Modelo Minimo Viable\n* Exploracion rapida de diversos algoritmos\n\nAhora toca *avanzar*, pero como saber si *realmente* estan moviendose en la direccion correcta?\n\n## La validaci\u00f3n cruzada (Nested Cross-Validation) *tambien* es tu amiga\n\nDebieron haber visto esto con el excelente mentor Juan Nu\u00f1ez, pero por si acaso se perdieron esa sesion:\n\n[Esta es una muy buena guia de que, por que y como garantizar calidad en su linea de produccion de modelos](https:\/\/medium.com\/@ODSC\/the-comprehensive-guide-to-model-validation-framework-what-is-a-robust-machine-learning-model-7bdbc41c1702)\n\n\n### Asegurense de entender como los van a medir\n\nConsideren con detenimiento la metrica que se usara para evaluarlos. [Mean Absolute Error](https:\/\/en.wikipedia.org\/wiki\/Mean_absolute_error)\n\nY si esto tiene alguna implicacion sobre las decisiones que tomen, no tiene sentido controlar la calidad midiendo otra cosa o si?\n\nReferencia rapida: [Metricas de ajuste comunes (Kaggle)](https:\/\/www.kaggle.com\/residentmario\/model-fit-metrics)","56b6a163":"### Limpieza de Datos\n\nComo se puede observar, no todos los registros tienen datos.","baf2919f":"Podemos generar muchas asunciones de por qu\u00e9 estos datos no est\u00e1n en primer lugar, como interrupciones de servicio en el sistema que lo generaron. Llenaremos esta informaci\u00f3n de manera sencilla, con el ultimo valor llenando antes del dato vacio, utilizando la funci\u00f3n **fillna** con el metodo **ffill**."}}