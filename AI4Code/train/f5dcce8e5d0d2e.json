{"cell_type":{"44336b2a":"code","1d371971":"code","8e1a3c1f":"code","6b56a542":"code","c7dd33f3":"code","d61278b2":"code","51179735":"code","8738b095":"code","310b0db3":"code","b8837766":"code","e001e6b1":"code","2d0bb81e":"code","b388bd49":"code","eba8fa7f":"code","3f305647":"code","573e3feb":"code","bc1640a4":"code","7c844698":"code","353743cc":"code","7aeee9e6":"code","f9b875e0":"code","a48fbb41":"code","95b98ec5":"code","7a280364":"code","43ab028d":"code","7215421e":"code","1516ad7a":"markdown"},"source":{"44336b2a":"import numpy as np\nimport pandas as pd\n\n#import warnings\n#warnings.filterwarnings('ignore')\n\nfrom collections import Counter","1d371971":"df_train = pd.read_csv(\"..\/input\/train.csv\")\ndf_test = pd.read_csv(\"..\/input\/test.csv\")","8e1a3c1f":"print(\"Train Data Shape: {}\".format(df_train.shape))\ndf_train.head()","6b56a542":"print(\"Test Data Shape: {}\".format(df_test.shape))\ndf_test.head()","c7dd33f3":"%matplotlib inline\nfrom matplotlib import pyplot as plt, style\nstyle.use(\"fivethirtyeight\")","d61278b2":"print(\"NA Values in Train data\")\nfor column in df_train.columns:\n    print(\"{} : {}\".format(column,df_train[column][df_train[column].isna()].size))\nprint(\"\\nNA Values in Test data\")\nfor column in df_test.columns:\n    print(\"{} : {}\".format(column,df_test[column][df_test[column].isna()].size))","51179735":"\"\"\"\nAge,Fare,cabin,embarked have NA values, we will find some way to find it\nFeature : Sex lets visualize it\n\"\"\"\nprint(\"Sex : {} \".format(dict(Counter(df_train['Sex']))))\n\nfig = plt.figure(figsize=(15,3))\n#ax1\nax1 = fig.add_subplot(1,2,1)\nsurvived = [len(df_train[ (df_train['Survived']==1)&(df_train['Sex']=='male')]),len(df_train[(df_train['Survived']==1)&(df_train['Sex']=='female')])]\nnot_survived = [len(df_train[(df_train['Survived']==0)&(df_train['Sex']=='male')]),len(df_train[(df_train['Survived']==0)&(df_train['Sex']=='female')])]\nax1.bar(['Male','Female'],survived,label=\"Survived\",color='green',alpha=0.5)\nax1.bar(['Male','Female'],not_survived,bottom=survived,label=\"Not Survived\",color='red',alpha=0.5)\nax1.set_xlabel(\"Gender\")\nax1.set_ylabel(\"Total\")\nax1.legend()\n#ax2\nax2 = fig.add_subplot(1,2,2)\nsurvival_rate = [s\/t for s,t in zip(survived,np.array(survived)+np.array(not_survived))]\nax2.bar(['Male','Female'],survival_rate,label=\"Survival Ratio\",color='orange',alpha=0.5)\nax2_legend = ax2.legend()","8738b095":"\"\"\"\nLooks like most of the woman have survived\nNow lets look at Pclass\n\"\"\"\nprint(\"Pclass : {} \".format(dict(Counter(df_train['Pclass']))))\npclass = sorted(df_train['Pclass'].unique())\nsurvived = [len(df_train[(df_train['Survived']==1)&(df_train['Pclass']==x)]) for x in pclass ]\nnot_survived = [len(df_train[(df_train['Survived']==0)&(df_train['Pclass']==x)]) for x in pclass ]\nfig = plt.figure(figsize=(15,3))\n#ax1\nax1 = fig.add_subplot(1,2,1)\nax1.bar(['Pclass:1','Pclass:2','Pclass:3'],survived,color='green',label=\"Survived\",alpha=0.5)\nax1.bar(['Pclass:1','Pclass:2','Pclass:3'],not_survived,bottom=survived,color='red',label=\"Not Survived\",alpha=0.5)\nax1.set_xlabel(\"class\")\nax1.set_ylabel(\"total\")\nax1.legend()\n#ax2\nax2 = fig.add_subplot(1,2,2)\nsurvival_rate = [s\/t for s,t in zip(survived,np.array(survived)+np.array(not_survived))]\nax2.bar(['Pclass:1','Pclass:2','Pclass:3'],survival_rate,color='orange',label=\"Survival Ratio\",alpha=0.5)\nax2_legend = ax2.legend()","310b0db3":"\"\"\"\nLooks like passenger of class 3 are not able to survive \nLets look at embarked\n\"\"\"\nprint(\"Embarked : {} \".format(dict(Counter(df_train['Embarked']))))\n# S is most common lets replace 2 nan value with that only\ndf_train.Embarked.fillna('S',inplace=True)\nembarked = df_train['Embarked'].unique()\n\nsurvived = [ len(df_train[ (df_train['Survived']==1)&(df_train['Embarked']==x)] ) for x in embarked ]\nnot_survived = [ len(df_train[ (df_train['Survived']==0)&(df_train['Embarked']==x)] ) for x in embarked ]\nfig = plt.figure(figsize=(15,3))\n#ax1\nax1 = fig.add_subplot(1,2,1)\nax1.bar(embarked,survived,label=\"Survived\",color=\"g\",alpha=0.5)\nax1.bar(embarked,not_survived,label=\"Not Survived\",color=\"r\",alpha=0.5,bottom=survived)\nax1.legend()\nax1.set_xlabel('Embarkment Point')\nax1.set_ylabel('Total')\n#ax2\nax2 = fig.add_subplot(1,2,2)\nsurvival_rate = [ s\/t for s,t in zip(survived,np.array(survived)+np.array(not_survived))]\nax2.bar(embarked,survival_rate,color='orange',alpha=0.5,label='Survival Ratio')\nax2_legend = ax2.legend()","b8837766":"\"\"\"\nPeople of C have survived most\n'Q' and 'S' doesnt have much different survival rates, lets consider 'Q' same as 'S'\n\"\"\"\ndf_train.Embarked.replace('S','Q',inplace=True)\ndf_test.Embarked.replace('S','Q',inplace=True)\n\"\"\"\nLets look at fare\n\"\"\"\ndf_test['Fare'].fillna(df_train['Fare'].median(),inplace=True)\nmedian_fare = np.median(df_train['Fare'])\nprint(\"Median Fare : {}\".format(median_fare))\nfig= plt.figure(figsize=(15,3))\nax1 = fig.add_subplot(1,2,1)\nax2 = fig.add_subplot(1,2,2)\nax1.set_title(\"Count vs Fare\");\nax2.set_title(\"Survival Rate vs Fare\")\n#ax1\nsurvived = [len(df_train[ (df_train['Survived']==1)&(df_train['Fare']<=median_fare)]),len(df_train[(df_train['Survived']==1)&(df_train['Fare']>median_fare)])] \nnot_survived = [len(df_train[ (df_train['Survived']==0)&(df_train['Fare']<=median_fare)]),len(df_train[ (df_train['Survived']==0)&(df_train['Fare']>median_fare)])]\nax1.bar(['Low Fare','High Fare'],survived,label=\"Survived\",color=\"g\",alpha=0.5)\nax1.bar(['Low Fare','High Fare'],not_survived,bottom=survived,label=\"Not Survived\",color=\"r\",alpha=0.5)\nax1.legend()\n#ax2\nsurvival_rate = [s\/t for s,t in zip(survived,np.array(survived)+np.array(not_survived))]\nax2.bar(['Low Fare','High Fare'],survival_rate,color='orange',label='Survival Ratio',alpha=0.5)\nax2_legend = ax2.legend()","e001e6b1":"\"\"\"\nLets create a new feature:\nFamilySize\n\"\"\"\ndf_train['FamilySize'] = df_train.SibSp + df_train.Parch + 1\ndf_test['FamilySize'] = df_test.SibSp + df_test.Parch + 1\n\n\"Lets visualize familysize\"\nfig = plt.figure(figsize=(15,3))\nax1 = fig.add_subplot(1,2,1)\nax2 = fig.add_subplot(1,2,2)\n#ax1\nsurvived = [len(df_train[(df_train[\"Survived\"]==1)&(df_train['FamilySize']==1)]),len(df_train[(df_train[\"Survived\"]==1)&(df_train['FamilySize']>1)])]\nnot_survived = [len(df_train[(df_train[\"Survived\"]==0)&(df_train['FamilySize']==1)]),len(df_train[(df_train[\"Survived\"]==0)&(df_train['FamilySize']>1)])]\nax1.bar(['Single','Family'],survived,label=\"Survived\",color='g',alpha=0.5)\nax1.bar(['Single','Family'],not_survived,bottom=survived,label=\"Not Survived\",color='r',alpha=0.5)\nax1.legend()\n#ax2\nsurvival_ratio = [s\/t for s,t in zip(survived,np.array(survived)+np.array(not_survived)) ]\nax2.bar(['Single','Family'],survival_ratio,label=\"Survival Ratio\",color='orange',alpha=0.5)\nax2_legend = ax2.legend()","2d0bb81e":"\"\"\"\nLooks like Families are more likely to survive\nLets combine train and test data before moving further\n\"\"\"\ndf = df_train.append(df_test,sort=False)\ndf.tail(5)","b388bd49":"\"\"\"\nLets create another feature: \ntitle (denoting title )\nSurname (will remove later)\n\"\"\"\nname = df.Name.str.split('[,.]',expand=True)\ndf['Title'] = name[1].str.strip()\ndf['Surname'] = name[0].str.strip()","eba8fa7f":"print(\"titles : {} \".format(dict(Counter(df.Title))))\n\"\"\"\nThese are similar\nMlle,Mme = Mlle\nCapt,Don,Major,Sir = Sir\nDona, Lady, Jonkheer, the Countess\n\"\"\"\ndf.Title.replace(['Mlle','Mme'],'Mlle',inplace=True)\ndf.Title.replace(['Capt','Don','Major','Sir'],'Sir',inplace=True)\ndf.Title.replace(['Dona','Lady','Jonkheer','the Countess'],'Lady',inplace=True)\n\nprint(\"\\ntitles : {} \".format(dict(Counter(df.Title))))","3f305647":"\"\"\"replace age na values with mean of their correspoding Title\"\"\"\nnew_ages = []\nfor index in df[df.Age.isna()].index:\n    title = df.iloc[index].Title\n    new_ages.append(df[df.Title==title]['Age'].mean())\ndf.loc[df.Age.isna(),'Age']=np.array(new_ages)","573e3feb":"\"\"\"Lets visualize age feature\"\"\"\nfig = plt.figure(figsize=(15,3))\n#ax1\nax1 = fig.add_subplot(1,2,1)\ndf_train  = df[:len(df_train)]\n\nsurvived = df_train[df_train['Survived']==1]['Age'].astype('int')\nnot_survived = df_train[df_train['Survived']==0]['Age'].astype('int')\n\nbins = [0,16,30,55,100]\nhist_survived, bin_edges = np.histogram(survived,bins)\nhist_not_survived, bin_edges = np.histogram(not_survived,bins)\n\nxlabels = ['0-16','16-30','30-55','55+']\n\nax1.bar(xlabels,hist_survived,label=\"Survived\",color=\"g\",alpha=0.5)\nax1.bar(xlabels,hist_not_survived,bottom=hist_survived,label=\"Not Survived\",color=\"r\",alpha=0.5)\nax1.legend()\nax1.set_xlabel(\"Age\")\nax1.set_ylabel(\"Total\")\n\n#ax2\nax2 = fig.add_subplot(1,2,2)\nsurvival_rate = [s\/t for s,t in zip(hist_survived,hist_survived+hist_not_survived)]\nax2.bar(xlabels,survival_rate,label=\"Survival Ratio\",color=\"orange\",alpha=0.5)\nax2.legend()","bc1640a4":"\"\"\"\nLooks like children are most likely to survive\n\"\"\"\nsurvived = [len(df_train[(df_train['Survived']==1)&(df_train['Sex']=='male')&(df_train['Age']<18)]),\n            len(df_train[(df_train['Survived']==1)&(df_train['Sex']=='female')&(df_train['Age']<18)]),\n           len(df_train[(df_train['Survived']==1)&(df_train['Sex']=='male')&(df_train['Age']>18)]),\n           len(df_train[(df_train['Survived']==1)&(df_train['Sex']=='female')&(df_train['Age']>18)])]\nnot_survived = [len(df_train[(df_train['Survived']==0)&(df_train['Sex']=='male')&(df_train['Age']<18)]),\n            len(df_train[(df_train['Survived']==0)&(df_train['Sex']=='female')&(df_train['Age']<18)]),\n           len(df_train[(df_train['Survived']==0)&(df_train['Sex']=='male')&(df_train['Age']>18)]),\n           len(df_train[(df_train['Survived']==0)&(df_train['Sex']=='female')&(df_train['Age']>18)])]\nx_labels = [\"Male Child\",\"Female Child\",\"Male Adult\",\"Female Adult\"]\nfig = plt.figure(figsize=(15,3))\n#ax1\nax1 = fig.add_subplot(121)\nax1.bar(x_labels,survived,label=\"Survived\",color=\"g\",alpha=0.5,)\nax1.bar(x_labels,not_survived,bottom=survived,label=\"Not Survived\",color=\"r\",alpha=0.5,)\nax1.legend()\n\n#ax2\nax2 = fig.add_subplot(122)\nsurvival_ratio = [s\/t for s,t in zip(survived,np.array(survived)+np.array(not_survived))]\nax2.bar(x_labels,survival_ratio,label=\"Survival ratio\",color=\"orange\",alpha=0.5)\nax2.legend()","7c844698":"\"\"\"\nlets use age as categorical variable then continuos variable as\nchild,young,adult,old\n\"\"\"\ndf[\"AgeGroup\"] = 'Child'\ndf.loc[ (df['Age']>16) & (df['Age']<=30) , 'AgeGroup'] = 'Young'\ndf.loc[ (df['Age']>30) & (df['Age']<=55) , 'AgeGroup'] = 'Adult'\ndf.loc[df['Age']>55, 'AgeGroup'] = 'Old'","353743cc":"print(\"NA Values\")\nfor column in df.columns:\n    print(\"{} : {}\".format(column,df[column][df[column].isna()].size))","7aeee9e6":"from sklearn.preprocessing import LabelEncoder\nle = LabelEncoder()\ndf.Sex = le.fit_transform(df.Sex)\ndf.Embarked = le.fit_transform(df.Embarked)\ndf.Title = le.fit_transform(df.Title)\ndf.AgeGroup = le.fit_transform(df.AgeGroup)\n\n\"\"\"\nUseful columns = PassengerId,Survived,Pclass,Sex,Fare,Embarked,FamilySize,Title,AgeGroup\n\"\"\"\ndf_final = df.drop(['Name','Age','SibSp','Parch','Ticket','Cabin','Surname'],axis=1)\ndf_final.head()","f9b875e0":"#preparing train, test and validation data\ntrain_df = df_final[:len(df_train)].drop(['PassengerId'],axis=1)\ntest_df = df_final[len(df_train):]\n\nY = train_df['Survived'].astype('int')\nX = train_df.drop(['Survived'],axis=1)\nX_test_PassengerId = test_df['PassengerId']\nX_test = test_df.drop(['PassengerId','Survived'],axis=1)\n\nfrom sklearn.model_selection import train_test_split\nX_train,X_validation,Y_train,Y_validation = train_test_split(X,Y,test_size=0.2)\nprint(\"Train Size : {}\\nValidation Size : {}\\nTest Size : {}\".format(len(X_train),len(X_validation),len(X_test)))","a48fbb41":"X.describe()","95b98ec5":"from sklearn.model_selection import GridSearchCV\nfrom lightgbm import LGBMClassifier\nparams={\n    'num_leaves':[5,10,30],\n    'n_estimators':[20,30,50,100],\n    'learning_rate':[0.01,0.05],\n    'n_jobs':[-1]\n}\nlgbm = LGBMClassifier()\ngridcv = GridSearchCV(lgbm,param_grid=params,scoring='accuracy',n_jobs=1,cv=4,verbose=2)\ngridcv.fit(X_train,Y_train)\nclf = gridcv.best_estimator_\nprint(clf)\nprint(\"Validation Accuracy : {}\".format(clf.score(X_validation,Y_validation)))","7a280364":"#lets train classifier with full data\nclf.fit(X,Y)\n\npredictions = clf.predict(X_test)\n#predictions = np.argmax(predictions,axis=1)","43ab028d":"sol = pd.DataFrame({\n    \"PassengerId\":X_test_PassengerId,\n    \"Survived\":predictions\n})\nsol.to_csv(\"sol.csv\",header=True,index=False)","7215421e":"\"\"\"\nAccuraccy - 0.77033\nKeras ANN - 50-relu,50-relu\n            loss - binary_crossentropy\n            optimizer - adam\n\nfrom keras.models import Sequential\nfrom keras.layers.core import Dense,Activation,Dropout\nfrom keras.utils import np_utils\nbatch_size =  1\nnum_classes = 2\n\nY_train = np_utils.to_categorical(Y_train, num_classes)\nY_validation = np_utils.to_categorical(Y_validation, num_classes)\n\nclf = Sequential()\nclf.add(Dense(50,activation='relu',input_shape=(7,)))\nclf.add(Dense(50,activation='relu',input_shape=(50,1)))\nclf.add(Dropout(0.2))\nclf.add(Dense(num_classes,activation='softmax',input_shape=(50,1)))\n\nfrom keras import losses\nfrom keras import optimizers\nclf.compile(loss=losses.binary_crossentropy,optimizer='adam',metrics=['accuracy'])\n\nclf.fit(\n    X_train,\n    Y_train,\n    validation_data = (X_validation,Y_validation),\n    batch_size=batch_size,\n    nb_epoch=50,\n    verbose=2\n)\n\"\"\"","1516ad7a":"## Feature Engineering\n1. Title\n2. FamilySize\n3. AgeGroup\n## will be work with following features\nPclass,Sex,Fare,Embarked,FamilySize,Title,AgeGroup"}}