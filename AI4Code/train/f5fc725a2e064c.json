{"cell_type":{"0b7156ec":"code","b948a00d":"code","d6198557":"code","a17911bf":"code","f9a3dc57":"code","564dca74":"code","9da7ec3d":"code","d6c30fbc":"code","ee0d30aa":"code","75092c26":"code","af52217d":"code","c8a1311a":"code","eab49060":"code","6b66dad4":"code","83287cbc":"code","e20a1b94":"markdown","b8b2194f":"markdown","a7b2dae1":"markdown","d506d48c":"markdown","37d891fe":"markdown","a12baffb":"markdown","2bf8a02c":"markdown","0f63c46c":"markdown","5f602ce8":"markdown","70b50a02":"markdown","71703c3c":"markdown","35560809":"markdown","0b768e29":"markdown","a26fc6c8":"markdown","6e27c6ab":"markdown","2a387c6b":"markdown","0a1feae8":"markdown","61a10bef":"markdown","538d2b86":"markdown","7f31109a":"markdown","07723005":"markdown","5c3d1ed8":"markdown","8766528c":"markdown","323f774d":"markdown","2d9e311d":"markdown","67aeab7e":"markdown","f109b7f4":"markdown"},"source":{"0b7156ec":"#importing libraries\nfrom fastai import *\nfrom fastai.vision import *\nfrom fastai.metrics import error_rate\nimport os\nimport pandas as pd\nimport numpy as np","b948a00d":"x  = '\/kaggle\/input\/chest-xray-pneumonia\/chest_xray\/chest_xray\/train'\npath = Path(x)\npath.ls()","d6198557":"np.random.seed(40)\ndata = ImageDataBunch.from_folder(path, train = '.', valid_pct=0.2,\n                                  ds_tfms=get_transforms(), size=224,\n                                  num_workers=4).normalize(imagenet_stats)","a17911bf":"data.show_batch(rows=3, figsize=(7,6),recompute_scale_factor=True)\n","f9a3dc57":"print(data.classes)\nlen(data.classes)\ndata.c","564dca74":"data","9da7ec3d":"learn = cnn_learner(data, models.resnet50, metrics=[accuracy], model_dir = Path('..\/kaggle\/working'),path = Path(\".\"))","d6c30fbc":"learn.lr_find()\nlearn.recorder.plot(suggestions=True)","ee0d30aa":"lr1 = 1e-3\nlr2 = 1e-1\nlearn.fit_one_cycle(4,slice(lr1,lr2))","75092c26":"# lr1 = 1e-3\nlr = 1e-1\nlearn.fit_one_cycle(20,slice(lr))","af52217d":"learn.unfreeze()\nlearn.lr_find()\nlearn.recorder.plot()\nlearn.fit_one_cycle(10,slice(1e-4,1e-3))","c8a1311a":"learn.recorder.plot_losses()\n","eab49060":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix()","6b66dad4":"img = open_image('..\/input\/chest-xray-pneumonia\/chest_xray\/test\/NORMAL\/IM-0001-0001.jpeg')\nprint(learn.predict(img)[0])","83287cbc":"learn.export(file = Path(\"\/kaggle\/working\/export.pkl\"))\nlearn.model_dir = \"\/kaggle\/working\"\nlearn.save(\"stage-1\",return_path=True)","e20a1b94":"<font size=\"+1\" color=red ><b>Please Upvote my kernel and keep it in your favourite section if you think it is helpful.<\/b><\/font>","b8b2194f":"<a id=\"5\"><\/a>\n<font color=\"blue\" size=+2.5><b>2.2 Library Import<\/b><\/font>","a7b2dae1":"<a id=\"8\"><\/a>\n<font color=\"blue\" size=+2.5><b>3.3 Data Explorations<\/b><\/font>\n<br\/>\n\n*Our image dataset is stored as .jpg files in 2 different folders, with each folder bearing the name of model of the images contained in the folder. We use the ImageDataBunch.from_folder() function to load the images and assign labels the images based on the name of the folder they\u2019re read from.*","d506d48c":"# Objective\n\nThe aim of this kernel is to provide all the tips and tricks required to train image classification model on Pneumonia image dataset in a single page.This kernel will hold almost all steps and steps required to implement image classification algorithm using SOTA such as ResNET on Pnemonia Dataset.It could be a great time saver for you.Just utilize it anytime when you are working on Image Classification.\n\nI have learned them from [FastAI](https:\/\/docs.fast.ai\/)","37d891fe":"<a id=\"9\"><\/a>\n<font color=\"blue\" size=+2.5><b>3.4 Print Classes present in the data<\/b><\/font>\n<br\/>\n\n* data.c \u2014 How many classes are there in our dataset?\n* len(data.train_ds) \u2014 What is the size of our training dataset?\n* len(data.valid_ds) \u2014 What is the size of our validation dataset?","a12baffb":"<a href=\"#top\" class=\"btn btn-success btn-lg active\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\" title=\"go to Colors\">Go to TOP<\/a>","2bf8a02c":"<a id=\"1\"><\/a>\n<font color=\"blue\" size=+2.5><b>Introduction<\/b><\/font>\n","0f63c46c":"<a id=\"11\"><\/a>\n<font color=\"blue\" size=+2.5><b>4.2 Finding LR<\/b><\/font>\n<br\/>","5f602ce8":"<a id=\"top\"><\/a>\n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n<h3 class=\"list-group-item list-group-item-action active\" data-toggle=\"list\"  role=\"tab\" aria-controls=\"home\">Table of content<\/h3>\n\n<font color=\"blue\" size=+1><b>Introduction<\/b><\/font>\n* [1. What is Peumonia ?](#1)\n* [2. What is CNN ?](#2)\n* [2. What is Transfer Learning ?](#3)    \n\n<font color=\"blue\" size=+1><b>Library<\/b><\/font>\n* [1. Installation](#4)\n* [2. Import Libraries ](#5)\n    \n<font color=\"blue\" size=+1><b> Load and view your data <\/b><\/font>\n* [1. Setting up path for training data ](#6)\n* [2. Data Loading For training ](#7)\n* [3. Data Explorations ](#8)\n* [4. Print Classes present in the data ](#9)\n\n<font color=\"blue\" size=+1><b> Create and train a model <\/b><\/font>\n* [1. Create Models ](#10)\n* [2. Train Model ](#11)\n* [3. Finding LR ](#12)\n* [4. Finetuning HyperParameter](#13)\n\n<font color=\"blue\" size=+1><b> Others <\/b><\/font>\n* [1. Interpret the results](#14)\n* [2. Prediction Using Trained Model](#15)\n* [3. Save and Load Model](#16)\n* [4. Sources](#17)","70b50a02":"<a id=\"17\"><\/a>\n<font color=\"blue\" size=+2.5><b>5.4 Sources<\/b><\/font>\n<br\/>\n* [Fastai MOOC](https:\/\/course.fast.ai\/)\n* [Fastai library](https:\/\/docs.fast.ai\/)","71703c3c":"<a id=\"4\"><\/a>\n<font color=\"blue\" size=+2.5><b>2.1 Installation<\/b><\/font>\n* Numpy\n* Pandas\n* Matplotlib\n* Fastai","35560809":"<a id=\"18\"><\/a>\n<font color=\"blue\" size=+2.5><b>Feedback and Support<\/b><\/font>\n<br\/>\n* Your feedback is much appreciated\n* Please UPVOTE if you LIKE this notebook\n* Comment if you have any doubts or you found any errors in the notebook","0b768e29":"<a id=\"1\"><\/a>\n<font color=\"blue\" size=+2.5><b>1.1  What is Pneumonia ?<\/b><\/font>\n<br\/>\n<br\/>\n\n**Pneumonia is an inflammatory condition of the lung affecting primarily the small air sacs known as alveoli.Symptoms typically include some combination of productive or dry cough, chest pain, fever and difficulty breathing. The severity of the condition is variable. Pneumonia is usually caused by infection with viruses or bacteria and less commonly by other microorganisms, certain medications or conditions such as autoimmune diseases.Risk factors include cystic fibrosis, chronic obstructive pulmonary disease (COPD), asthma, diabetes, heart failure, a history of smoking, a poor ability to cough such as following a stroke and a weak immune system. Diagnosis is often based on symptoms and physical examination. Chest X-ray, blood tests, and culture of the sputum may help confirm the diagnosis.The disease may be classified by where it was acquired, such as community- or hospital-acquired or healthcare-associated pneumonia.**\n\n","a26fc6c8":"<font size=\"+3\" color=red><b> <center><u>Pneumonia Detection using Transfer Learning(95%+ Accuracy)<\/u><\/center><\/b><\/font>","6e27c6ab":"<a id=\"16\"><\/a>\n<font color=\"blue\" size=+2.5><b>5.3 Save and Load Model<\/b><\/font>\n<br\/>\n","2a387c6b":"<a id=\"12\"><\/a>\n<font color=\"blue\" size=+2.5><b>4.3 Train Model<\/b><\/font>\n<br\/>","0a1feae8":"<a id=\"3\"><\/a>\n<font color=\"blue\" size=+2.5><b>1.3  What is Transfer Learning ?<\/b><\/font>\n<br\/>\n<br\/>\n![image.png](attachment:image.png)\n**Transfer learning is a machine learning technique where a model trained on one task is re-purposed on a second related task.**","61a10bef":"<a id=\"13\"><\/a>\n<font color=\"blue\" size=+2.5><b>4.4 Hyper Parameter Tuning<\/b><\/font>\n<br\/>","538d2b86":"<a id=\"7\"><\/a>\n<font color=\"blue\" size=+2.5><b>3.2 Data Loading For training<\/b><\/font>\n<br\/>\n\n**Things to be remember:**\n* Decide validation percentage ( 0.2 => 20% )\n* Provide path for training data\n* [Decide augmentations criteria (optional)](https:\/\/www.kaggle.com\/init27\/introduction-to-image-augmentation-using-fastai\/)\n* Decide image size (which is 224 in my case)\n* Test data can also be added but it's optional","7f31109a":"<a id=\"10\"><\/a>\n<font color=\"blue\" size=+2.5><b>4.1 Create Model<\/b><\/font>\n<br\/>\n* We now use a pre-trained ResNet50 Convolutional Neural Net model, and use transfer learning to learn weights of only the last layer of the network.\n* Why Transfer learning? Because with transfer learning, you begin with an existing (trained) neural network used for image recognition \u2014 and then tweak it a bit (or more) here and there to train a model for your particular use case. And why do we do that? Training a reasonable neural network would mean needing approximately 300,000 image samples, and to achieve really good performance, we\u2019re going to need at least a million images.\n* In our case, we have approximately 4000+ images in our training set \u2014 you have one guess to decide if that would have been enough if were to train a neural net from scratch.\n* We use the create_cnn() function for loading a pre-trained ResNet18 network, that was trained on around a million images from the ImageNet database.","07723005":"<a id=\"2\"><\/a>\n<font color=\"blue\" size=+2.5><b>1.2  What is CNN ?<\/b><\/font>\n<br\/>\n<br\/>\n![image.png](attachment:image.png)\n**CNN stands for Convolutional Neural Network which is a specialized neural network for processing data that has an input shape like a 2D matrix like images. CNN's are typically used for image detection and classification.**","5c3d1ed8":"### If these kernels impress you,give them an <font size=\"+4\" color=\"blue\"><b>Upvote<\/b><\/font>.<br>","8766528c":"<a id=\"14\"><\/a>\n<font color=\"blue\" size=+2.5><b>5.1 Interpret the results<\/b><\/font>\n<br\/>","323f774d":"<a id=\"6\"><\/a>\n<font color=\"blue\" size=+2.5><b>3.1 Setting up path for training data<\/b><\/font>\n\n**Point to be Noted: Number of elements in a list of path is same as number of classes you have**","2d9e311d":"<a id=\"15\"><\/a>\n<font color=\"blue\" size=+2.5><b>5.2 Prediction Using Trained Model<\/b><\/font>\n<br\/>\n","67aeab7e":"![image.png](attachment:image.png)","f109b7f4":"<a id=\"5\"><\/a>\n\n\n<font color=\"blue\" size=+2.5><b>2. Library<\/b><\/font>"}}