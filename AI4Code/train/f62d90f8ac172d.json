{"cell_type":{"b27ecf8f":"code","590e1ec7":"code","e6a3f8fe":"code","23511454":"code","f97c52ca":"code","725a63b3":"code","2ca969ff":"code","c81ef736":"code","22886d47":"code","1566a13f":"code","fa5f332c":"code","dc365956":"code","8bfd1b98":"code","fdfca55d":"code","67b09af6":"code","7684ff57":"code","02f55eb4":"code","49a8c86a":"code","3e14b970":"code","a213d30d":"code","5fa7506f":"code","627a6af7":"code","31f527bb":"code","b9f2b62a":"code","884bbb9f":"code","b04fd418":"code","fd3b635f":"code","ea672b22":"code","c34610cc":"code","6f7fe887":"code","376edef4":"code","dbe31cb6":"code","ac1ad46a":"code","a45c60d4":"code","a5f3dc45":"code","87a60032":"code","754f645b":"code","d110ff18":"code","225db494":"code","0ef63a63":"code","25c8aa66":"markdown","a7be6e1c":"markdown","cfa5e9f1":"markdown","bae192c8":"markdown","8a6e8df4":"markdown","8f27fa10":"markdown","b001f227":"markdown","d145b8fa":"markdown","a1f76907":"markdown","a7ceee01":"markdown","8962345a":"markdown","1bbfd000":"markdown","bd4413cf":"markdown","f3c78a45":"markdown","43b95c71":"markdown","a8ddd6e8":"markdown","dbd128fb":"markdown","f60d3da2":"markdown","4f43fdd2":"markdown","1168d122":"markdown","70477f54":"markdown","3030dfe0":"markdown","d80ccac4":"markdown"},"source":{"b27ecf8f":"!pip install datatable","590e1ec7":"# Load libraries\nimport datatable as dt\nfrom datatable.models import Ftrl\nprint(dt.__version__)\nimport time\nfrom pathlib import Path\nimport numpy as np\nimport pandas as pd\n\n# to print all outputs of a cell\nfrom IPython.core.interactiveshell import InteractiveShell  \nInteractiveShell.ast_node_interactivity = \"all\"\n\nimport warnings\nwarnings.filterwarnings('ignore')","e6a3f8fe":"## Data Table Reading\nstart = time.time()\ndata_dir = Path('..\/input\/tabular-playground-series-nov-2021\/')\ndt_train = dt.fread(data_dir \/ \"train.csv\")\ndt_test = dt.fread(data_dir \/ \"test.csv\")\ndt_submission = dt.fread(data_dir \/ \"sample_submission.csv\")\nend = time.time()\nprint(end - start)","23511454":"dt_train.head(5)","f97c52ca":"# number of rows and columns in training dataset\ndt_train.shape","725a63b3":"# number of rows and columns in test dataset\ndt_test.shape","2ca969ff":"for i in range(len(dt_train.names)):\n    print(dt_train.names[i], \":\", dt_train.stypes[i])","c81ef736":"dt_submission.head(5)","22886d47":"dt_submission.shape","1566a13f":"# mean\ndt_train.mean()","fa5f332c":"# max\ndt_train.max()","dc365956":"# min\ndt_train.min()","8bfd1b98":"# standard deviation\ndt_train.sd()","fdfca55d":"dt_train.countna()","67b09af6":"class_counts = dt_train.to_pandas().groupby('target').size()\nprint(class_counts)","7684ff57":"dt_train[dt.f.target == 1, :].mean()","02f55eb4":"dt_train[dt.f.target == 1, :].min()","49a8c86a":"dt_train[dt.f.target == 1, :].max()","3e14b970":"dt_train[dt.f.target == 0, :].mean()","a213d30d":"dt_train[dt.f.target == 0, :].min()","5fa7506f":"dt_train[dt.f.target == 0, :].max()","627a6af7":"start = time.time()\n\n# Pairwise Pearson correlations\ncorrelations = dt_train.to_pandas().corr(method='pearson')\nprint(correlations)\n\nend = time.time()\nprint(end - start)","31f527bb":"dt_train.skew()","b9f2b62a":"dt_train.kurt()","884bbb9f":"dt_train.nunique()","b04fd418":"from sklearn.model_selection import train_test_split\n\nX = dt_train[:, [col for col in dt_train.names if col != 'target']]\ny = dt_train[:, -1]\n\nX = X.to_numpy()\ny = y.to_numpy()\n\n# dt_df = dt_train.to_numpy()\nX_train, X_validation, y_train, y_validation = train_test_split(X, y, test_size=0.3)\n\nX_train = dt.Frame(X_train)\nX_validation = dt.Frame(X_validation)\ny_train = dt.Frame(y_train)\ny_validation = dt.Frame(y_validation)","fd3b635f":"from datatable.models import Ftrl\n\nmodel_ftrl_1 = Ftrl()\nmodel_ftrl_1.fit(X_train, y_train)\nmodel_ftrl_1","ea672b22":"prediction_validation_1 = model_ftrl_1.predict(X_validation)\nprediction_validation_1.head()","c34610cc":"X_test = dt_test[:,:]\nX_test = X_test.to_numpy()\nX_test = dt.Frame(X_test)\n\nprediction_test_1 = model_ftrl_1.predict(X_test)\nprediction_test_1.head()","6f7fe887":"# Display the feature importances of model_ftrl_1 in descending order and calculate the logloss of y_validation and prediction_validation_1\nmodel_ftrl_1.feature_importances[:, :, dt.sort(-dt.f.feature_importance)]","376edef4":"preds = dt.cbind(y_validation, prediction_validation_1)\n# print(preds) very important to print pred because we will come to know that target has been renamed to C0\npreds[:, -dt.mean(dt.f.C0 * dt.math.log(dt.f['True']) + (1-dt.f.C0) * dt.math.log(dt.f['False']))][0, 0]","dbe31cb6":"submission_ids = dt_submission['id']\nprint(submission_ids)","ac1ad46a":"# Create submission_1 in the submission format of the competition, write it as submission_1.csv and submit it on Kaggle\nsubmission_1 = dt.Frame(id=submission_ids, target=prediction_test_1['True'])\nsubmission_1.to_csv('submission_1.csv')\nsubmission_1.head()","a45c60d4":"# Train another FTRL model model_ftrl_2 with nepochs=3, `nbins=10 8, display it's feature importances, score & evaluate it's logloss onvalid_dataand submit the predictionspreds_test_2oftestassubmission_2`**\nmodel_ftrl_2 = Ftrl(nepochs=3, nbins=10**8)\nmodel_ftrl_2.fit(X_train, y_train)\nmodel_ftrl_2","a5f3dc45":"model_ftrl_2.feature_importances[:, :, dt.sort(-dt.f.feature_importance)]","87a60032":"prediction_validation_2 = model_ftrl_2.predict(X_validation)\nprediction_validation_2.head()","754f645b":"prediction_test_2 = model_ftrl_2.predict(X_test)\nprediction_test_2.head()","d110ff18":"preds = dt.cbind(y_validation, prediction_validation_2)\npreds[:, -dt.mean(dt.f.C0 * dt.math.log(dt.f['True']) + (1-dt.f.C0) * dt.math.log(dt.f['False']))][0, 0]","225db494":"submission_2 = dt.Frame(id=submission_ids, target=prediction_test_2['True'])\nsubmission_2.to_csv('submission_2.csv')\nsubmission_2.head()","0ef63a63":"# Submit a ensemble of model_ftrl_1 and model_ftrl_2 by averaging the predictions as submission_ensemble\nsubmission_ensemble = dt.cbind(submission_1, submission_2)\nsubmission_ensemble[:, dt.update(target = 0.5 * dt.f.target + 0.5 * dt.f.target)]\ndel submission_ensemble[:, ['id.0', 'target.0']]\nsubmission_ensemble.to_csv('submission_ensemble.csv')\nsubmission_ensemble.head()","25c8aa66":"Let's have a look at the dimensions of the submission file.","a7be6e1c":"# References\n\nThank you to vopani for these [datatable exercises](https:\/\/github.com\/vopani\/datatableton#set-04--frame-operations--beginner--exercises-31-40).","cfa5e9f1":"Let's have a look at the skewness and kurtosis of all the attributes in the training dataset.","bae192c8":"# Ensemble of Model 1 and Model 2","8a6e8df4":"### Correlation","8f27fa10":"- We have 600,000 rows and 102 attributes in the training dataset.\n- 102 attributes include one id attribute of type integer, 100 attributes (f0 to f99) of type float and the target of type bool.\n\nNow, let's find out the dimensions of the test dataset.","b001f227":"# Feature Importance of Model 1.","d145b8fa":"Let's take a peek at the first 5 rows.","a1f76907":"# Submission using Model 1.","a7ceee01":"### Load Libraries\n\nLet's start off by loading the libraries required.","8962345a":"We can see that the submission file has 540,000 rows and two columns, which are 'id' and 'target'.\n\n# Exploratory Data Analysis\n\nLet's find out the mean, maximum, minimum, standard deviation and the number of missing values in the training dataset.","1bbfd000":"- The training dataset appears to be balanced.\n- We have 296,394 \/ 600,000 = 49% cases in which the email is not spam.\n- We have 303,606 \/ 600,000 = 51% cases in which the email is spam.\n\nLet's have a look at the mean, minimum and maximum values for cases in which the email is spam.","bd4413cf":"We don't have any missing values, hence imputation is not required.","f3c78a45":"Now, let's have a look at the mean, minimum and maximum values for cases in which the email is not spam.","43b95c71":"# Model 2\n\nWe use the Ftrl model again, but with nepochs=3, nbins=10**8.","a8ddd6e8":"Let's find out the dimensions of the training dataset.","dbd128fb":"- we have 540,000 rows and 101 attributes in the test dataset\n- 101 attributes include one id attribute of type integer and 100 attributes (f0 to f99) of type float.\n\nLet's have a look at the data types of all the attributes in the training dataset.","f60d3da2":"# Problem Statement\n\nIn this notebook, we <b>predict whether or not an email is spam<\/b>. It is a binary (2-class) classification problem. We have 600,000 rows in the training dataset with 102 attributes which include id, f0 to f99 and the target. We have 540,000 rows in the test dataset with 101 attributes which include id and f0 to f99. We have 540,000 rows in the submission file with 2 attributes, id and target. The id attribute is of type integer and f0 to f99 are of type float. The target is of type boolean having values of 0 which indicate not spam and 1 which indicates spam email. We do not have any missing values and the training dataset appears to be balanced.\n\nWe are going to cover the following steps:\n1. Load data\n2. Exploratory Data Analysis\n3. Prepare Validation Dataset\n4. Model 1 using Ftrl\n5. Feature Importance for Model 1\n6. Submission using Model 1\n7. Model 2\n8. Feature Importance for Model 2\n9. Submission using Model 2\n10. Ensemble of Model 1 and Model 2\n11. References\n\nLet's get started.\n\n# Load Data\n\n### Install Libraries","4f43fdd2":"There is no point in checking the number of unique values since attributes f0 to f99 are all of type float.\n\n# Prepare Validation Dataset","1168d122":"### Load data","70477f54":"# Feature Importance for Model 2","3030dfe0":"# Submission using Model 2","d80ccac4":"# Model 1\n\nIn this section, we use an [Ftrl](https:\/\/keras.io\/api\/optimizers\/ftrl\/) model, which stands for 'Follow The Regularized Leader'."}}