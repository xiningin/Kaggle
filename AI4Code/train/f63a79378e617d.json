{"cell_type":{"bdd9e018":"code","69edea78":"code","79247a61":"code","1dcf6fac":"code","344c14c1":"code","4ddcb62e":"code","08d28b63":"code","0a6c5c2a":"code","c41a903f":"code","f1cfe036":"code","847c4437":"code","f6d67a40":"code","945e19eb":"code","103f266b":"code","e543725b":"code","b1a701be":"code","bb29ebf3":"code","9797ff71":"code","b0324ca3":"code","9dc25963":"code","b99d1cc8":"code","d54fc726":"code","4af22c60":"code","0e9a4fea":"code","69400e0b":"code","ac17c626":"code","b6ee0ebc":"code","7269b01d":"code","5cd9d610":"code","f9edaeac":"code","08fddc4b":"code","7078f4f8":"code","466c413f":"code","789a0e0b":"code","2b833a96":"code","8dbb8140":"code","a661e462":"code","fef2610b":"code","eaebb52f":"code","a5eda520":"code","d7d8b016":"code","18bba8ca":"code","2d3bb5a7":"code","5d8614c8":"code","da6b4a4d":"code","9dd1b658":"code","b1819509":"code","0bf09d95":"code","610cac0f":"code","c949ae9a":"code","c4914117":"code","deb1d032":"markdown","10e009a8":"markdown","b5e73af8":"markdown","4342339a":"markdown","ba95614e":"markdown","fe15f900":"markdown","fbe43ba9":"markdown","25745775":"markdown","9fbf0459":"markdown","f6c43634":"markdown","0b9b7fa7":"markdown","156025b2":"markdown","e2321347":"markdown","544638cd":"markdown","b1c15fd3":"markdown","eadf5fef":"markdown","e712a651":"markdown","13611d97":"markdown","cf384dd5":"markdown","2b74e135":"markdown","f8810156":"markdown","065bd8b3":"markdown","2378e262":"markdown","360d7e1a":"markdown","5f7407d1":"markdown","e384b66e":"markdown","69597cb0":"markdown","45f55b13":"markdown","578874f0":"markdown","f2d592a9":"markdown","664894d0":"markdown","193cbc5f":"markdown","1135253b":"markdown"},"source":{"bdd9e018":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.metrics import r2_score, mean_squared_error\nfrom sklearn.ensemble import RandomForestRegressor","69edea78":"df = pd.read_csv('..\/input\/insurance\/insurance.csv')","79247a61":"df.head()","1dcf6fac":"df.shape","344c14c1":"df['region'].unique()","4ddcb62e":"region_dummies = pd.get_dummies(df['region'], drop_first=True)\nregion_dummies.head()","08d28b63":"df = pd.concat([df, region_dummies], axis=1)","0a6c5c2a":"df.drop(['region'],axis=1, inplace=True)","c41a903f":"df.head()","f1cfe036":"df.isnull().sum()","847c4437":"df.info()","f6d67a40":"df_age = df.groupby(by='age').mean()\ndf_age","945e19eb":"df.describe()","103f266b":"df[['age', 'sex', 'bmi', 'children', 'smoker', 'charges']].hist(bins=30, figsize=(10,10),color='blue')","e543725b":"sns.pairplot(df)","b1a701be":"sns.regplot(x='age', y='charges', data=df)\nplt.title('Age vs Charges')\nplt.show()","bb29ebf3":"sns.regplot(x='bmi', y='charges', data=df)\nplt.title('BMI vs CHARGES')\nplt.show()","9797ff71":"from sklearn.preprocessing import LabelEncoder\n#sex\nle = LabelEncoder()\nle.fit(df.sex.drop_duplicates())\ndf.sex = le.transform(df.sex)\n#smoker or not\nle.fit(df.smoker.drop_duplicates())\ndf.smoker = le.transform(df.smoker)\n#region\n# le.fit(df.region.drop_duplicates())\n# df.region = le.tranaform(df.region)","b0324ca3":"df.head()","9dc25963":"plt.figure(figsize=(12,8))\nsns.heatmap(df.corr(),annot=True)\nplt.show()","b99d1cc8":"f = plt.figure(figsize=(12,5))\n\nax = f.add_subplot(121)\nsns.histplot(df[(df.smoker==1)]['charges'], color='c',ax=ax,kde=True, linewidth=0)\nax.set_title('Distribution of charges for smokeres')\n\nax = f.add_subplot(122)\nsns.histplot(df[(df.smoker==0)]['charges'],color='b',ax=ax,kde=True,linewidth=0)\nax.set_title('Distribution of charges for non-smokers')","d54fc726":"plt.figure(figsize=(8,8))\nsns.catplot(x='smoker', kind='count', hue='sex', palette='pink', data=df)","4af22c60":"sns.catplot(x=\"sex\", y=\"charges\", hue=\"smoker\",\n            kind=\"violin\", data=df, palette = 'magma')","0e9a4fea":"plt.figure(figsize=(12,5))\nplt.title(\"Box plot for charges of women\")\nsns.boxplot(y='smoker',x='charges',data=df[(df.sex == 1)] , orient='h',palette='magma')","69400e0b":"plt.figure(figsize=(12,5))\nplt.title(\"Box plot for charges of men\")\nsns.boxplot(y='smoker',x='charges',data=df[(df.sex == 1)] , orient='h',palette='rainbow')","ac17c626":"plt.figure(figsize=(12,5))\nplt.title(\"Distribution of age\")\nsns.histplot(df['age'],color='g',kde=True, linewidth=0)","b6ee0ebc":"sns.catplot(x='smoker', kind='count', hue='sex', palette='rainbow',data=df[(df.age == 18)])\nplt.title(\"The number of smokers and non-smokers (18 years old)\")","7269b01d":"plt.figure(figsize=(12,5))\nplt.title(\"Box plot for charges 18 years old smokers\")\nsns.boxplot(y='smoker', x='charges', data=df[(df.age ==18)],orient='h',palette='pink')","5cd9d610":"plt.figure(figsize=(12,5))\nplt.title(\"Distribution of BMI\")\nax = sns.histplot(df['bmi'],color=\"m\",kde=True, linewidth=0)","f9edaeac":"plt.figure(figsize=(12,5))\nplt.title(\"Distribution of charges for patients with BMI greater than 30\")\nax = sns.histplot(df[(df.bmi >= 30)]['charges'], color = 'm', kde=True,linewidth=0)","08fddc4b":"plt.figure(figsize=(12,5))\nplt.title(\"Distribution of charges for patients with BMI less than 30\")\nax = sns.histplot(df[(df.bmi<30)]['charges'], color='b', kde=True,linewidth=0)","7078f4f8":"sns.catplot(x=\"children\", kind=\"count\", palette=\"ch:.25\",data=df, height=6)","466c413f":"sns.catplot(x=\"smoker\", kind=\"count\", palette=\"rainbow\",hue=\"sex\",data=df[(df.children > 0)], height=6)\nax.set_title(\"Smokers and non-smokers who have children\")","789a0e0b":"X = df.drop(['charges'],axis=1)\ny = df.charges\n\nX_train, X_test, y_train, y_test = train_test_split(X,y, test_size=0.2, random_state=0)\nprint(X_train.shape)\nprint(X_test.shape)","2b833a96":"def model_pred(model):\n    model.fit(X_train, y_train)\n    print(model.score(X_test, y_test))","8dbb8140":"from sklearn.linear_model import LinearRegression","a661e462":"lr = LinearRegression()","fef2610b":"from sklearn.ensemble import RandomForestRegressor\nfrom sklearn.model_selection import GridSearchCV, RandomizedSearchCV\n\n#Random Forest Regressor\nrfr = RandomForestRegressor()\nparam_grid = {\n    'n_estimators': [100,200],\n    'max_depth': [4,5,6,7,8],\n    \"max_features\": [\"auto\", \"sqrt\", \"log2\"],\n    'random_state': [0,1,42]\n}","eaebb52f":"# RandomizedSearchCV \ncv_random = RandomizedSearchCV(rfr, param_grid, cv=5)\ncv_random.fit(X_train, y_train)","a5eda520":"cv_random.best_params_","d7d8b016":"rfReg = RandomForestRegressor(n_estimators=200, max_features='auto', max_depth=4,random_state=0)","18bba8ca":"## XGBoost Regressor","2d3bb5a7":"from xgboost import XGBRegressor\n\nxgbR = XGBRegressor()\n\nxgb_params = {\n    'n_estimators' : [100, 200, 300],\n    'max_depth' : [4, 6, 8, 10],\n    'min_child_weight' : [2,4,10,12]\n}","5d8614c8":"# GridSearchCV\ncv_xgbR = GridSearchCV(xgbR, xgb_params, cv=5)\ncv_xgbR.fit(X_train, y_train)","da6b4a4d":"cv_xgbR.best_params_","9dd1b658":"xgbReg = XGBRegressor(max_depth=4, min_child_weight=10, n_estimators=100)","b1819509":"print(\"Score of Linear Regression:\\n\")\nmodel_pred(lr)","0bf09d95":"print(\"Score of Random Forest Regressor:\\n\")\nmodel_pred(rfReg)","610cac0f":"print(\"Score of XGBoost Regressor:\\n\")\nmodel_pred(xgbReg)","c949ae9a":"rfReg_train_pred = rfReg.predict(X_train)\nrfReg_test_pred = rfReg.predict(X_test)\n\nprint(\"MSE train data: %.3f, MSE test data: %.3f\"%(mean_squared_error(y_train, rfReg_train_pred),mean_squared_error(y_test, rfReg_test_pred)))\nprint(\"R2 train data: %.3f, R2 test data: %.3f\"%(r2_score(y_train, rfReg_train_pred),r2_score(y_test, rfReg_test_pred)))","c4914117":"plt.figure(figsize=(10,6))\n\nplt.scatter(rfReg_train_pred, rfReg_train_pred - y_train,\n          c = 'black', marker = 'o', s = 35, alpha = 0.5,\n          label = 'Train data')\nplt.scatter(rfReg_test_pred,rfReg_test_pred - y_test,\n          c = 'c', marker = 'o', s = 35, alpha = 0.7,\n          label = 'Test data')\nplt.xlabel('Predicted values')\nplt.ylabel('Tailings')\nplt.legend(loc = 'upper left')\nplt.hlines(y = 0, xmin = 0, xmax = 60000, lw = 2, color = 'red')\nplt.show()","deb1d032":"Most patients do not have children.","10e009a8":"Please note that women are coded with the symbol \" 1 \"and men \"0\". Thus non-smoking people and the truth more. Also we can notice that more male smokers than women smokers. It can be assumed that the total cost of treatment in men will be more than in women, given the impact of smoking. Maybe we'll check it out later. And some more useful visualizations.","b5e73af8":"## Data Visualization","4342339a":"### Actual vs Predicted","ba95614e":"## Sex wise charges","fe15f900":"# Creating function for model fitting and sccuracy","fbe43ba9":"Let's check whether there are smokers among pateints 18 years.","25745775":"## That's it for the day!\nGive an upvote.","9fbf0459":"## Performance of the model","f6c43634":"## Linear Regression","0b9b7fa7":"### Splitting the data into training and tesring ","156025b2":"As we know that machine can understand only numbers, so let's convert it into numbers.","e2321347":"Smoking patients spend more on treatment. But there is a feeling that the number of non-smoking patients is greater. Going to check it.","544638cd":"## Exploratory Data Analysis","b1c15fd3":"#### Patients with BMI above 30 spend more on treatment","eadf5fef":"The average BMI in patients is 30. \n\n### BMI range\n\nBMI ----> Weight status\n\nbelow 18.5 ----> Underweight\n\n18.5 - 24.9 ----> Normal Weight\n\n25.0 - 29.9 ----> Overweight\n\n30.0 - 34.9 ----> Obeisty Class I\n\n35.0 - 39.9 ----> Obesity Class II\n\nAbove 40 ----> Obesity Class III","e712a651":"### Young age charges","13611d97":"# Medical Insurance Cost Prediction\nThe objective of this case study is to predict the health insurance cost incurred by Individuals based on their age, gender, BMI, number of children, smoking habit and geo-location.\n\n\n### Features available are:\n\n- sex: insurance contractor gender, female, male\n\n- bmi: Body mass index (ideally 18.5 to 24.9)\n\n- children: Number of children covered by health insurance \/ Number of dependents\n\n- smoker: smoking habits\n\n- region: the beneficiary's residential area in the US, northeast, southeast, southwest, northwest.\n\n- charges: Individual medical costs billed by health insurance","cf384dd5":"## From above result we can say that Random Forest Regressor is better choice for this task","2b74e135":"Now let's pay attention to the age of the patients. First, let's look at how age affects the cost of treatment, and also look at patients of what age more in our data set.","f8810156":"From above insight we can say that at the age of 18 smokers spend much more on treatment than non-smokers. Also non-smokers are seeing some \"tails\". I can assume that this is due to serious disease or accidents.","065bd8b3":"For 18 years old, let's check the treatment cost of this age.","2378e262":"### Now let's check about BMI","360d7e1a":"Correlation between different attriubtes of the data","5f7407d1":"Hyperparameter optimization on the Random Forest Regressor for better result","e384b66e":"## Importing Essentials","69597cb0":"Charges is out target","45f55b13":"Check the realtionship between the age and Charges, we can see the it is more complex than a linear relationship.","578874f0":"## Random Forest Regressor","f2d592a9":"Smoke have the most positive relationship with the charges","664894d0":"### Distrubtion of charges between smokers and non-smokers","193cbc5f":"### Evaluate Model with Random Forest Regressor","1135253b":"Let's pay attention to children. First, let's see how many children our patients have."}}