{"cell_type":{"05b99290":"code","02989317":"code","1c6c690f":"code","d9c25951":"code","473e64b5":"code","a70739c3":"code","3afea415":"code","1c015147":"code","e065deb9":"code","3f265347":"code","0a2d0278":"code","6ce28009":"code","20097069":"code","c675d1ff":"code","c1fde377":"code","e606cda9":"code","f0749a15":"code","5e188d5f":"code","344c109b":"code","c215174e":"code","43c8311f":"code","3f8e8045":"code","1dadf7a6":"code","3906e0a6":"code","7b9531e7":"code","b1d310d9":"code","85070c8b":"code","96007f24":"code","82659303":"code","b7e331ef":"markdown","aaedf2f5":"markdown","11273f2a":"markdown","f8dc5a86":"markdown","8c7aa017":"markdown","b543e7c2":"markdown","6a6eda05":"markdown","5b377037":"markdown","e24bdd57":"markdown","80fa9a9b":"markdown","2e32161d":"markdown","7a3a4a4f":"markdown","0eebac6b":"markdown","987447d6":"markdown","238ee628":"markdown","2a87de87":"markdown","68ffbd29":"markdown","0f800947":"markdown","3521f382":"markdown","8f65a946":"markdown","3a995e1d":"markdown","2e40a8d7":"markdown","11483087":"markdown","90e161fc":"markdown","ed7c07e1":"markdown","3731ede4":"markdown"},"source":{"05b99290":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom statsmodels.graphics.mosaicplot import mosaic\nfrom IPython.display import display\nimport geopandas as gpd\nimport geoplot as gplt\nimport mapclassify as mc\nfrom random import choices\nfrom itertools import chain\nimport chardet\nimport fuzzywuzzy\nfrom fuzzywuzzy import process\nimport wrang_func as wf\nfrom datetime import datetime","02989317":"csv_path = \"..\/input\/us-police-shootings\/shootings.csv\"\ndf = wf.detect_load_data(csv_path, char_num=100000)","1c6c690f":"df = wf.first_view_data(df)","d9c25951":"df = wf.search_transf_date(df, date_columns=[\"date\"], new_columns=True, drop_old=False)\ndf.set_index(\"id\", inplace=True)","473e64b5":"df[\"name\"].value_counts()","a70739c3":"df[\"manner_of_death\"].value_counts()","3afea415":"df[\"armed\"].value_counts()","1c015147":"df[\"age\"].value_counts()\ndf[\"age\"].describe()","e065deb9":"df[\"gender\"].value_counts()","3f265347":"df[\"race\"].value_counts()","0a2d0278":"df[\"city\"].value_counts()","6ce28009":"df[\"state\"].value_counts()","20097069":"df[\"signs_of_mental_illness\"].value_counts()","c675d1ff":"df[\"threat_level\"].value_counts()","c1fde377":"df[\"flee\"].value_counts()","e606cda9":"df[\"body_camera\"].value_counts()","f0749a15":"df[\"arms_category\"].value_counts()","5e188d5f":"date_plot = df.copy()","344c109b":"date_plot.set_index('date', inplace = True)\ndates = date_plot.resample('1M').count().index\nx = list(map(lambda i: i.timestamp(), dates))\ny = date_plot.resample('1M').count()['name']\n\n\nfig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12,6))\n\ny.plot(color=\"green\", ax=ax1)\nsns.regplot(x=x, y=list(y), ax=ax2)\n\nplt.show()","c215174e":"states_df = df.groupby(\"state\").count().reset_index()\nstates_df[\"state\"] = states_df[\"state\"].str.upper().replace({\n    \"AL\": \"Alabama\",\n    #\"AK\": \"Alaska\",\n    \"AS\": \"American Samoa\",\n    \"AZ\": \"Arizona\",\n    \"AR\": \"Arkansas\",\n    \"CA\": \"California\",\n    \"CO\": \"Colorado\",\n    \"CT\": \"Connecticut\",\n    \"DE\": \"Delaware\",\n    \"DC\": \"District Of Columbia\",\n    \"FM\": \"Federated States Of Micronesia\",\n    \"FL\": \"Florida\",\n    \"GA\": \"Georgia\",\n    \"GU\": \"Guam\",\n    #\"HI\": \"Hawaii\",\n    \"ID\": \"Idaho\",\n    \"IL\": \"Illinois\",\n    \"IN\": \"Indiana\",\n    \"IA\": \"Iowa\",\n    \"KS\": \"Kansas\",\n    \"KY\": \"Kentucky\",\n    \"LA\": \"Louisiana\",\n    \"ME\": \"Maine\",\n    \"MH\": \"Marshall Islands\",\n    \"MD\": \"Maryland\",\n    \"MA\": \"Massachusetts\",\n    \"MI\": \"Michigan\",\n    \"MN\": \"Minnesota\",\n    \"MS\": \"Mississippi\",\n    \"MO\": \"Missouri\",\n    \"MT\": \"Montana\",\n    \"NE\": \"Nebraska\",\n    \"NV\": \"Nevada\",\n    \"NH\": \"New Hampshire\",\n    \"NJ\": \"New Jersey\",\n    \"NM\": \"New Mexico\",\n    \"NY\": \"New York\",\n    \"NC\": \"North Carolina\",\n    \"ND\": \"North Dakota\",\n    \"MP\": \"Northern Mariana Islands\",\n    \"OH\": \"Ohio\",\n    \"OK\": \"Oklahoma\",\n    \"OR\": \"Oregon\",\n    \"PW\": \"Palau\",\n    \"PA\": \"Pennsylvania\",\n    #\"PR\": \"Puerto Rico\",\n    \"RI\": \"Rhode Island\",\n    \"SC\": \"South Carolina\",\n    \"SD\": \"South Dakota\",\n    \"TN\": \"Tennessee\",\n    \"TX\": \"Texas\",\n    \"UT\": \"Utah\",\n    \"VT\": \"Vermont\",\n    \"VI\": \"Virgin Islands\",\n    \"VA\": \"Virginia\",\n    \"WA\": \"Washington\",\n    \"WV\": \"West Virginia\",\n    \"WI\": \"Wisconsin\",\n    \"WY\": \"Wyoming\"\n})","43c8311f":"states = gpd.read_file(\"https:\/\/raw.githubusercontent.com\/jgoodall\/us-maps\/master\/geojson\/state.geo.json\")\nstates_to_drop = [\"Hawaii\", \"Puerto Rico\", \"Alaska\"]\ngeo_data = states[~states[\"NAME10\"].isin(states_to_drop)]","3f8e8045":"states_to_drop = [\"Hawaii\", \"Puerto Rico\", \"Alaska\"]\ngeo_data = states[~states[\"NAME10\"].isin(states_to_drop)]\n\nfull_data = geo_data.merge(states_df, left_on=[\"NAME10\"], right_on=[\"state\"])\n\nfig, ax = plt.subplots(1, 1, figsize=(16,12))\nscheme = mc.Quantiles(full_data[\"city\"], k=10)\ngplt.choropleth(full_data,\n               hue=\"city\",\n               linewidth=.1,\n               scheme=scheme, cmap=\"inferno_r\",\n               legend=True,\n               edgecolor=\"black\",\n               ax=ax)\nax.set_title(\"**Shooting by State**\", fontsize=22, fontweight=\"bold\")\nplt.plot()","1dadf7a6":"favorite_city = df[\"city\"].value_counts()[:10].index.to_list()\ncity_plot = pd.Categorical(df[\"city\"], favorite_city)\nplt.figure(figsize=(14,6))\nsns.histplot(df, x=city_plot, hue=\"race\", multiple=\"dodge\", palette=\"flare\")\n\nplt.xticks(rotation = 45, fontsize=12)\nplt.plot()","3906e0a6":"fig, ax = plt.subplots(1,1, figsize=(14,4))\nplt.rcParams.update({'font.size': 18})\nmosaic(data=df, index=[\"race\", \"gender\"], ax=ax)\nplt.xticks([])\nplt.yticks([])\nplt.plot()","7b9531e7":"sns.displot(df, x=\"age\", hue=\"signs_of_mental_illness\", multiple=\"stack\", kde=True, palette=\"viridis\")","b1d310d9":"favorite_arm = df[\"armed\"].value_counts()[:10].index.to_list()\narm_plot = pd.Categorical(df[\"armed\"], favorite_arm)\nsns.histplot(df, x=arm_plot, hue=\"signs_of_mental_illness\", palette=\"viridis\")\nplt.xticks(rotation = 45, fontsize=12)\nplt.plot()","85070c8b":"fig, ax = plt.subplots(1,1, figsize=(14,10))\nplt.rcParams.update({'font.size': 18})\nmosaic(data=df, index=[\"race\", \"threat_level\"], ax=ax)\nplt.xticks([])\nplt.yticks([])\nplt.plot()","96007f24":"sns.histplot(df, x=\"flee\", hue=\"body_camera\", palette=\"viridis\")","82659303":"sns.histplot(df, y=\"manner_of_death\", hue=\"body_camera\", multiple=\"dodge\", palette=\"viridis\")\nplt.xlabel(\"\")\nplt.ylabel(\"\")\nplt.title(\"Manner Death vs Body Camera\")","b7e331ef":"## 4.4 Wich gender is more dangerous?\n","aaedf2f5":"I don\u00b4t find any patter, just a decreasing trend. The values are more or less uniform and are around 60 and 90 deaths in a month with max peaks around 100 and min peaks in 40.","11273f2a":"## 3.1.  Check the different columns.\nLet's take a quick look to the different columns and it values.","f8dc5a86":"# 2. Take a first look of the dataset.\nAfter load the dataset, let\u00b4s see a little bit of it. Let\u00b4s see the head, tail, nan values and the info of the data. We will take advantage and make some changes to the dataset, like lowercase all the data and erase all the trailing whitespaces.","8c7aa017":"## 4.7 Body Camera\nLet\u00b4s see if body camera has influence in the deaths.","b543e7c2":"## 4.5. Are there much people with mental illness?\nLet's see if mental illness is important when it comes to getting shot.","6a6eda05":"Like the previos graph the most cases are without camera.","5b377037":"# 3. Lets wrangle the Dataset\nAs we can see in the previous graph, in principle we have a graph without null values. We also see in the info panel that the columns have the right type, except the date column, let\u00b4s give it the right tipe and set the column \"id\" as index.","e24bdd57":"# 4. Analyze and visualize the data\nFirst make a copy of the dataframeto begin to work.","80fa9a9b":"# 1. Load the dataset","2e32161d":"### 4.7.2 Manner of death","7a3a4a4f":"## 4.1 When were the deaths?\nLet\u00b4s search for a patter in the data.","0eebac6b":"White and black people are the most dangerous. They have the most attacking threat level.","987447d6":"### 4.5.2. Favorite Arms","238ee628":"The graph speaks for itself. The\u00b4re very few females involved in shootings.","2a87de87":"### 4.5.1. Age","68ffbd29":"tk tk is a person without name, or maybe added later. So it doesnt affect the rest of the dataset","0f800947":"I can see how the southern states have more deaths, than the norther ones. I can also see that the inner states have less deaths than the outher ones.","3521f382":"## 4.2. Where were the deaths?\nLets center in the continental area of the United States of America, so I have left out Alaska, Hawaii and Puerto Rico.","8f65a946":"## 4.6. Threat level of the different races","3a995e1d":"Most of the cases the camera wasn\u00b4t or was turned off. We see with a big difference that the most cases were the camera was on is for people who isn\u00b4t fleeing.","2e40a8d7":"Only analizing the 10 most problematic cities in USA, we can have one conclusion, the southern city have more problems with hispanic people than the norther ones.","11483087":"## 4.3. Wich problem has each city?","90e161fc":"As we can observe, we have a right-skewed distribution with a mode in 35 years. Mental illness is nearly the same distribution. Mental illness does not influence the data much.","ed7c07e1":"### 4.7.1. Flee","3731ede4":"Obviously to participate in a shooting with the police, in the most cases you need a gun, so it\u00b4s the favorite the people who faced the police. As a curiosity, it is observed how the toy gun is held almost exclusively by people with mental illnesses."}}