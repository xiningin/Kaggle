{"cell_type":{"c3c69acb":"code","8ade9b7d":"code","0855b73b":"code","04340abc":"code","fc667943":"code","92fb8853":"code","04cff693":"code","00705246":"code","339812a9":"code","c315ec4c":"code","85ae65dd":"code","86aa249a":"markdown","be9757d5":"markdown","b395eee1":"markdown","6d6672fd":"markdown","bc455c66":"markdown","8da43540":"markdown","c19f2660":"markdown","0b5ca3b8":"markdown","55428c3c":"markdown"},"source":{"c3c69acb":"!pip install lifelines","8ade9b7d":"import pandas as pd\nfrom lifelines import CoxPHFitter # The Cox proportional hazard model","0855b73b":"import warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)","04340abc":"df = pd.read_csv(\"\/kaggle\/input\/heart-failure-clinical-data\/heart_failure_clinical_records_dataset.csv\")\ndf","fc667943":"df.describe().T","92fb8853":"cph = CoxPHFitter()","04cff693":"cph.fit(df, duration_col='time', event_col='DEATH_EVENT')","00705246":"cph.plot()","339812a9":"cph.print_summary(columns=[\"coef\",\"exp(coef)\",\"exp(coef) lower 95%\",\"exp(coef) upper 95%\", \"z\", \"p\"], decimals=3)","c315ec4c":"cph.predict_survival_function(df.loc[5]).plot(title=\"Survival probability for individual 5 over time\");","85ae65dd":"cph.predict_survival_function(df.loc[42]).plot(title=\"Survival probability for individual 42 over time\");","86aa249a":"# Summary statistics\n\nThe dataset contains the following potential risk factors: age,serum  sodium, serum creatinine, gender, smoking, blood pressure  (BP),  ejection fraction (EF), anaemia, platelets, and creatinine phosphokinase (CPK). Let's check the summary statistics for the data.","be9757d5":"# Using a survival model\nA survival model will allow us to etimate how likely a person is to survive or die over time. As an example, we well plot the expeted survival fuction for individual #5 and #42 in the dataset","b395eee1":"# Create model\nWe instantiate a Cox Proportional Hazard Model","6d6672fd":"# Data\nRead in the data and have a quick look at it","bc455c66":"## Using Cox regression to predict death by heart failure\n\nHeart failure is a clinical syndrome characterised by a reduced ability of the heart to pump or fill with blood. This leads to fatigue, shortness of breath and poor quality of life. Patients with heart failure have a high mortality rate, and various biostatistical methods as well as machine learning methods have been applied to predict heart failure deaths from patients' medical records.\n\nIn this notebook, we use Cox regresstion to analyse a data set of medical records for 299 Pakistani patients with heart failure. The dataset was originally collected and presented in a research paper by [Ahmad et al.](https:\/\/journals.plos.org\/plosone\/article?id=10.1371\/journal.pone.0181001). and analysed using Cox regression similar to this notebook.\n\nIt has subsequently been re-analysed in other research by [Zahid et al.](https:\/\/journals.plos.org\/plosone\/article?id=10.1371\/journal.pone.0210602) for the risk factor of gender, and Chris Cave and me in the following research paper: [Wilstrup and Cave](https:\/\/www.researchsquare.com\/article\/rs-149966\/v1) where we demonstrate an improvement using QLattice symbolic regression.\n\nIn this notebook we are essentially reproducing the findings of Ahmad et al.\n\n# Cox models\n![image.png](attachment:82839d1a-52eb-4ca1-9118-ea2ae85f0bf3.png)\n\nThe Cox proportional hazards model was first developed by [Sir David Cox](https:\/\/en.wikipedia.org\/wiki\/David_Cox_(statistician)) in \n1972 and presented in a very influential [research paper](https:\/\/doi.org\/10.1111\/j.2517-6161.1972.tb00899.x) in the Journal of the Royal Statistical Society.\n\n# Lifelines\nLifelines is a Python package that allows us to fit and use Cox models. It is not by default avaliable on Kaggle, so we start by installing it using pip","8da43540":"# Fit it\nThe model needs to be fitted to the data respecting censoring, so we specify the event to predict, and the time the occurence or non-occurence of the event was last obeserved","c19f2660":"The output message about *right-censoring* from the fitting means that 203 individual had not died at the time of their follow-up examination at the hospital. From the summary statistics above we know that the mean follow-up period was 130 days, but ranging from 4 to 285 days. The varying follow-up period for the individual patients is why we cannot treat this as a classification problem.\n\nIt's an important point that the time column records the *number of days until death* for the patients that died, but the number of days until the last follow-up, for the patients that *did not* yet die. This is what allows the Cox model to determine the risk of death over time, rather than as a point event.\n\n# Risk factors\nLets plot the individual risk factors","0b5ca3b8":"Individual #5 has a pretty poor outlook, while #42 has a good chance of surviving for half a year or more\n\n# Conclusion\n\nIt is possible to extimate the survival functions with reasulable accuracy (C-index) for individuals with heart failure","55428c3c":"We see that high blood pressure, anaemia, serum creatinine, age and ejection fraction are all within the 95% confidence interval of affecting HF death.\n\n# Evaluation\nThe most common way to meassure the performance of a Cox model is to use the Concordance index or C-index. The C-index for a survival model can be thought of as the weighted average of the area under time-specific Receiver Operating Characteristic (ROC) curves."}}