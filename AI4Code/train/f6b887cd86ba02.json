{"cell_type":{"3861e8ec":"code","5232371d":"code","db2f7ba1":"code","b39ba1a7":"code","e1c201b5":"code","f0bd0a7a":"code","d9babff1":"code","b629ab73":"code","68ccd058":"code","c2f04137":"code","913b9f40":"code","9d17d87e":"code","521b3b52":"code","3df4e4ba":"code","b052478e":"code","179dda6c":"code","e5ce3ac7":"code","4dc4c298":"code","445dbe3b":"code","4a9b91c3":"code","1f0b21b6":"code","b8437e9d":"code","8c1e6f9f":"code","7c47a5e7":"code","66c02a28":"code","cc2bb496":"code","06793a59":"code","2906de19":"code","c0d8c8b6":"code","b1f31508":"code","a42efa28":"code","e7a60093":"code","b8dab600":"code","e0a6e9df":"code","286f915e":"code","45daf474":"code","154f620f":"code","1cf77964":"code","cfb3c69d":"code","0579d2e5":"markdown","e22f105c":"markdown","e4d3e5a9":"markdown","eeeb6ccb":"markdown","fa9e7e75":"markdown","fbdf7648":"markdown","19508da8":"markdown","ec9d4db1":"markdown","6e52805b":"markdown","cd189599":"markdown","eda2f19a":"markdown","130aba6a":"markdown","dd86b867":"markdown","c628f894":"markdown","fb59039a":"markdown","25fa03fb":"markdown","00866467":"markdown","03e3df3c":"markdown","2ed8c8be":"markdown","1e949955":"markdown","7d269963":"markdown","271089d0":"markdown","baf72c60":"markdown","0cddc54e":"markdown","9e35f514":"markdown","49a10400":"markdown","ab094b2f":"markdown","370a1656":"markdown","b91422ba":"markdown","1eec05ce":"markdown","3e996595":"markdown","16fb2086":"markdown","fb921ea3":"markdown","7e0751dd":"markdown","46d34bda":"markdown","95862f61":"markdown","4f09f143":"markdown","171acd52":"markdown","bf6ea4bf":"markdown","baa9caa0":"markdown","389cf5c5":"markdown","a3010877":"markdown","a0603125":"markdown","91617352":"markdown","3ff7daeb":"markdown","a528a782":"markdown","71758aa9":"markdown","5a25c86b":"markdown","e37fd061":"markdown"},"source":{"3861e8ec":"import pandas as pd\nimport numpy as np\n\n#visualization\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\n#Linear Regression\nfrom scipy.stats import linregress\n\n#Train_test_split\nfrom sklearn.model_selection import train_test_split\n\n#cross_val_score\nfrom sklearn.model_selection import cross_val_score\n\n#scaling\nfrom sklearn.preprocessing import StandardScaler\n\n\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import precision_score,recall_score, confusion_matrix, classification_report,accuracy_score, f1_score\nfrom sklearn.metrics import r2_score, mean_squared_error\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import cross_val_score \nimport matplotlib.pyplot as plt\n#models\n\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.ensemble import AdaBoostRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor\nfrom xgboost import XGBRegressor\nfrom catboost import CatBoostRegressor\n#score\nfrom sklearn.metrics import r2_score\n\n#Importing data\ndf = pd.read_csv(\"..\/input\/project-dataset\/insurance.csv\")\n","5232371d":"# take a look at the data\ndf.head()","db2f7ba1":"# statistical measuers\ndisplay(df.describe())","b39ba1a7":"# Getting some informations about the dataset\ndf.info()","e1c201b5":"fig, ax = plt.subplots(figsize=(8,6))\nsns.heatmap(df.corr(), annot=True, fmt='.1g', cmap=\"viridis\", cbar=True);","f0bd0a7a":"df.isna().sum()","d9babff1":"df.describe()","b629ab73":"# Bmi\nsns.boxplot(df['bmi'])","68ccd058":"Q1 = df.bmi.quantile(0.25)\nQ3 = df.bmi.quantile(0.75)\nQ1, Q3","c2f04137":"IQR = Q3 - Q1\nIQR","913b9f40":"lower_limit = Q1 - 1.5*IQR\nupper_limit = Q3 + 1.5*IQR\nlower_limit, upper_limit","9d17d87e":"df[df['bmi'] > upper_limit]","521b3b52":"df_new = df.drop(df.index[[116,401,286,543,847,860,1047,1088,1317]])","3df4e4ba":"f = plt.figure(figsize=(14,6))\nax = f.add_subplot(122)\nsns.scatterplot(x='bmi',y='charges',data=df,palette='viridis',hue='smoker')\nax.set_title('Scatter plot of Charges vs bmi')\nplt.savefig('sc.png');","b052478e":"df[\"bmi\"].value_counts()   # Body mass index, providing an understanding of body, ideally 18.5 to 24.9","179dda6c":"df['weight_condition'] = np.nan\ndata = [df]\n\nfor col in data:\n    col.loc[col.bmi < 18.5, \"weight_condition\"] = \"Underweight\"\n    col.loc[(col.bmi >= 18.5) & (col.bmi < 24.986), \"weight_condition\"] = \"Normal\"\n    col.loc[(col.bmi >= 25) & (col.bmi < 29.926), \"weight_condition\"] = \"Overweight\"\n    col.loc[col.bmi >= 30, \"weight_condition\"] = \"Obese\"\n","e5ce3ac7":"df.drop(\"bmi\", axis = 1, inplace = True)\ndisplay(df.head())","4dc4c298":"f = plt.figure(figsize=(14,6))\nax = f.add_subplot(121)\nsns.scatterplot(x='age',y='charges',data=df,palette='magma',hue='smoker',ax=ax)\nax.set_title('Scatter plot of Charges vs age')\n","445dbe3b":"df['age_cat'] = np.nan\nlst = [df]\n\nfor col in lst:\n    col.loc[(col['age'] >= 18) & (col['age'] <= 35), 'age_cat'] = 'Young Adult'\n    col.loc[(col['age'] > 35) & (col['age'] <= 55), 'age_cat'] = 'Senior Adult'\n    col.loc[col['age'] > 55, 'age_cat'] = 'Elder'\n    ","4a9b91c3":"df.drop(\"age\", axis = 1, inplace = True)\ndf.head()","1f0b21b6":"plt.style.use(\"seaborn\")\nfig, ax = plt.subplots(figsize=(5,5))\nplt.pie(x=df[\"sex\"].value_counts(), \n        colors=[\"skyblue\",\"pink\"], \n        labels=[\"Male\",\"Female\"], \n        shadow = True, \n        autopct=\"%1.2f%%\", \n        explode = (0, 0.1)\n        )\nplt.show()","b8437e9d":"#Cheking the charges distributions for males and females\nx1 = sns.FacetGrid(df, row='sex', height=4, aspect=3)\nx1 = x1.map(sns.distplot, 'charges', color='cornflowerblue')\nplt.show()\n","8c1e6f9f":"plt.style.use(\"seaborn\")\nfig, ax = plt.subplots(figsize=(6,6))\nsns.countplot(df[\"children\"], palette=\"hls\");","7c47a5e7":"#Creating a violinplot for each category\nplt.figure(figsize=(12,4))\nsns.violinplot(x='children', y='charges', data=df, hue='sex', palette='YlGnBu')\nplt.title('Charges according to number of children', size='23')\nplt.ylabel('Charges',size=18)\nplt.xlabel('Number of children',size=18)\nplt.show()","66c02a28":"#Countplot to compare the number of smokers and non-smokers\nplt.figure(figsize=(12,4))\nsns.countplot(x='smoker', data=df, hue='sex', palette='YlOrBr') \nplt.title('Number of smokers and non-smokers', size='23')\nplt.ylabel('Count',size=18)\nplt.xlabel('Smoker',size=18)\nplt.show()","cc2bb496":"#Countplot to compare the number of individuals from diffrent regions\nplt.figure(figsize=(12,4))\nsns.countplot(x='region', data=df, palette='husl') \nplt.title('Number of individuals from diffrent regions', size='23')\nplt.ylabel('Count',size=18)\nplt.xlabel('Region',size=18)\nplt.show()","06793a59":"from sklearn.preprocessing import LabelEncoder\nle = LabelEncoder()\nles = {}\nfor col in ['sex','smoker','region', 'weight_condition', 'age_cat']:\n    les[col] = LabelEncoder()\n    df[col]  = les[col].fit_transform(df[col])","2906de19":"df.head()","c0d8c8b6":"df =df.drop(columns=['sex','region'])\ndf.head()","b1f31508":"x= df.drop('charges',axis=1).values\ny =df.charges.values\nx_tr,x_tst,y_tr,y_tst = train_test_split(x,y,test_size=.2,random_state=25)","a42efa28":"sc = StandardScaler()\nx_tr = sc.fit_transform(x_tr)\nx_tst = sc.transform(x_tst)","e7a60093":"lr  = LinearRegression()\nknn = KNeighborsRegressor(n_neighbors=10)\ndt  = DecisionTreeRegressor(max_depth = 3)\nrf  = RandomForestRegressor(max_depth = 3, n_estimators=500)\nada = AdaBoostRegressor( n_estimators=50, learning_rate =.01)\ngbr = GradientBoostingRegressor(max_depth=2, n_estimators=100, learning_rate =.2)\nxgb = XGBRegressor(max_depth = 3, n_estimators=50, learning_rate =.2)\ncb  = CatBoostRegressor(learning_rate =.01, max_depth =5, verbose = 0)\n\nregressors = [('Linear Regression', lr), ('K Nearest Neighbours', knn),('Decision Tree', dt), ('Random Forest', rf), \n              ('AdaBoost', ada),('Gradient Boosting Regressor', gbr),('XGBRegressor', xgb),('CatBoostRegressor', cb)]\n","b8dab600":"\nfor regressor_name, regressor in regressors:\n\n    regressor.fit(x_tr, y_tr)    \n  \n    y_pred = regressor.predict(x_tst)\n    accuracy = round(r2_score(y_tst,y_pred),3)*100\n    \n    print('{:s} : {:.0f} %'.format(regressor_name, accuracy))\n    plt.rcParams[\"figure.figsize\"] = (20,8)\n    plt.bar(regressor_name,accuracy)","e0a6e9df":"y_predict = gbr.predict(x_tst)\ngbr_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(gbr_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_1 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_1,5))","286f915e":"y_predict = xgb.predict(x_tst)\nxgb_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(xgb_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_2 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_2, 5))","45daf474":"y_predict = cb.predict(x_tst)\ncb_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(cb_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_3 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_3, 5))","154f620f":"score = cross_val_score(xgb, x, y, cv=5)\nprint(score)","1cf77964":"\nr2_scores = [gbr_r2_score*1000,xgb_r2_score*1000,cb_r2_score*1000]\nmodel_names = [\"Gradient Boosting R\",\"XGBRegressor\",\"CatBoostRegresso\"]\n\ntotal_bar = np.arange(len(model_names))\ncolor = ['#9edd1d', '#3edd1d', '#f7c851']\n\nfig, ax = plt.subplots(figsize=(15, 5))\nbar = plt.bar(model_names, r2_scores, alpha=1,color=color)\nplt.xticks(total_bar, model_names)\nplt.ylabel('Accuracy',fontsize=15, color='black')\nplt.xlabel('Model Name',fontsize=15, color='black')\nplt.title('Model Performance Comparison', fontsize=16, color='black', fontweight='bold')\n\ndef autolabel(bar):\n    for bar in bar:\n        height = int(bar.get_height())\n        ax.text(bar.get_x() + .4, .5*height,\n                height, va='bottom',\n                fontsize=14, color='black')\n        \nautolabel(bar)\n\nplt.show()","cfb3c69d":"m = [rmse_1,rmse_2,rmse_3]\nmodel_names = [\"Gradient Boosting R\",\"XGBRegressor\",\"CatBoostRegresso\"]\n\ntotal_bar = np.arange(len(model_names))\ncolor = ['#9edd1d', '#3edd1d', '#f7c851']\n\nfig, ax = plt.subplots(figsize=(15, 5))\nbar = plt.bar(model_names, m, alpha=1,color=color)\nplt.xticks(total_bar, model_names)\nplt.ylabel('Accuracy',fontsize=15, color='black')\nplt.xlabel('Model Name',fontsize=15, color='black')\nplt.title('Root Mean Squared Error', fontsize=16, color='black', fontweight='bold')\n\ndef autolabel(bar):\n    for bar in bar:\n        height = int(bar.get_height())\n        ax.text(bar.get_x() + .4, .5*height,\n                height, va='bottom',\n                fontsize=14, color='black')\n        \nautolabel(bar)\n\nplt.show()","0579d2e5":"##### Great \u2665\ufe0f","e22f105c":"only 9 records! we can get red of them safely ","e4d3e5a9":"#### Findings:\n\nThere are four numerical variables:\n    - Continuous:\n    - Age\n    - BMI\n    - Charges\n    - Discrete:\n    - children  \nThere are three categorical variables:\n    - Sex\n    - Smoker\n    - Region","eeeb6ccb":"##### As we can see charges for smokers are much higher than charges for non-smokers. Sex doesn't have any effect on charges when you are a smoker","fa9e7e75":"- Gradient Boosting Regressor","fbdf7648":"### checking the missing data:","19508da8":"- Experience 8 algorithms\n","ec9d4db1":"### before go  to modeling, we have to prepare the data types of the features:","6e52805b":"#### Insights\n- Charges increases as the age of the person increases\n- Smokers and obese people have the highest charges regardless of their age.\n","cd189599":"### Cross Validation\nIt is a resampling procedure wich is used to evaluate the machine learning models on limited data samples. Its goal is to predict new data that is that is not tested before. ","eda2f19a":"#### notice :\n- 0 for females\n- 1 for males\n------------------\n- smokers = 1: yes\n- smokers = 0: no\n\n Males tend to smoke more than females.","130aba6a":"##### The rest of the features are stable, thank God .","dd86b867":"##### Most patients do not have children","c628f894":"### Model Accuracy Comparison","fb59039a":"> # label encoding:\n","25fa03fb":"No missing data, cool!","00866467":"- CatBoostRegressor.\n","03e3df3c":"### Relation between smoking and charges: ","2ed8c8be":">  Splitting the data into Training data & Testing Data:","1e949955":"##### As we can see the two distributions are almost the same for both women\/men, so we can affirm that there is no influence on the medical charges when it comes to the sex variable.","7d269963":" ### R square (r2) Score & Root Mean Squared Error(RMSE)\n ","271089d0":"##### is there is a relationship between the features and each other?","baf72c60":"As we can see, almost all categories have the same range and mean of costs also the distributions are very similar, except for the people who have 5 children. This might be because of the small size of the sample of this kind of people!","0cddc54e":"###  Relation between regions and charges: ","9e35f514":"###  let's see how many children our patients have.\n\n","49a10400":"### take a look at the features and its effect in the target \"charges\" ...\n","ab094b2f":"### Best Models\n- Gradient Boosting Regressor : 88 %\n- CatBoostRegressor : 88 %\n- XGBRegressor : 88 %\n","370a1656":"> ## It's time to prepare our data \ud83d\ude4c\ud83c\udffb:","b91422ba":"#   preface\n we have a dataset is for a group of residents in the United States.\n It  contains some information about patients like there age, ender ,children ,living region ,BMI and smoking, including health insurance charges.\n our problem  : \n We want to predict health insurance charges based on the data given to us about patients, as well as analyzing the data to clarify the most important reasons   affecting their health and based on that , the health insurance charges.\n","1eec05ce":" first we will need some statistical information...","3e996595":"##### Almost the same proportion...","16fb2086":"#### i'll do the same thing with \"age\" so that the data to be follow the same flo \ud83e\udd19\ud83c\udffb","fb921ea3":"Hmmm... not much","7e0751dd":"### Relation between sex and charges: ","46d34bda":"### We are almost ready to finally prepare the models! so let's split the data to work on it...","95862f61":"- XGBRegressor\n- note : the best algorithm","4f09f143":"### Does it indicate that the data is really stable? check the outliers...","171acd52":"> # EDA","bf6ea4bf":"- Feature Scaling","baa9caa0":"### age VS charges","389cf5c5":"### insights:\n- Most of the people who smoke are obese people\n- Even though a person is not obese but he\/she smokes, his\/her charges tends to be higher.\n","a3010877":"## Conclusion:\n##### We have found out that region and gender does not bring significant difference on charges among its groups. Age, BMI,      number of children and smoking are the once that drives the charges. \nAs:\n-  age has an impact on the charges, when a person is older the health costs are larger.\n-  if you are a smoker you must expect some huge medical charges compared to non-smokers. Especially for people who have high BMI values (>35) it will result very serious health care charges.\n- no matter where you live, this won't have any impact on your medical insurance bills.\n- the number of children doesn't affect the medical costs billed by health insurance.\n-  it doesn't matter if you are a men or a women your health bills won't change.","a0603125":"#### i got them \ud83d\ude08","91617352":"##### Almsot all the regions have equal number of individuals.","3ff7daeb":"> ## Analyze by describing the data","a528a782":"# Importing libraries and data","71758aa9":"#### I see that It will be clearer if we classify people into categories according to their \"bmi\" \ud83d\udca1","5a25c86b":"> # Modeling :\nThere are good models, But we looking for the Best!","e37fd061":"#### Let's find out which this data is.."}}