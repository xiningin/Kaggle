{"cell_type":{"193f8c5f":"code","1b432fc7":"code","a8ea2140":"code","052e6a9e":"code","4f009c6e":"code","b00853f2":"code","fd33243d":"code","2dec0a46":"code","0b43fd18":"code","07a83928":"code","f048a65b":"code","ca916d89":"code","77e8d5cb":"code","c779a233":"code","39881a27":"code","5a68b9a3":"code","da6e27dd":"code","e0007734":"code","1e5855e3":"code","c5ed6f89":"markdown","cfb58371":"markdown","40968fd7":"markdown","2000bed7":"markdown","2bd5423e":"markdown"},"source":{"193f8c5f":"#Import libraries\nimport pandas as pd\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.preprocessing import OneHotEncoder, MinMaxScaler\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.model_selection import cross_val_predict, train_test_split\nfrom sklearn.metrics import recall_score, accuracy_score, roc_auc_score, f1_score\nfrom sklearn.ensemble import RandomForestClassifier\nimport warnings\n\nwarnings.filterwarnings(\"ignore\")\n\n# data visualization\n%matplotlib inline\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport seaborn as sns","1b432fc7":"data = pd.read_csv('..\/input\/heart-failure-prediction\/heart.csv')","a8ea2140":"data.info()","052e6a9e":"# plot ChestPainType vs Heart Disease probability\nplot = sns.catplot(x=\"ChestPainType\", y=\"HeartDisease\", kind=\"bar\", data=data).set_ylabels(\"Heart Disease probability\")","4f009c6e":"# plot Sex vs Heart Disease probability\nplot = sns.catplot(x=\"Sex\", y=\"HeartDisease\", kind=\"bar\", data=data).set_ylabels(\"Heart Disease probability\")","b00853f2":"# Explore Age histogram for NoHeartDisease\/HeartDisease (0\/1)\nplot = sns.FacetGrid(data, col='HeartDisease', height=4).map(sns.distplot, \"Age\", kde=False)","fd33243d":"data.head()","2dec0a46":"corr_matrix = data.corr()    \n\ncorr_matrix['HeartDisease'].sort_values(ascending=False)","0b43fd18":"# Defining functions to categorize features\n\n'''Very high blood pressure levels (hypertension (Stage 2) and hypertensive crisis)\nas defined by the American Heart Association.\n\nSource: https:\/\/www.heart.org\/en\/health-topics\/high-blood-pressure\/understanding-blood-pressure-readings'''\n\ndef blood_pressure_levels(row):\n    if row['RestingBP'] >= 140:\n        return 'VERY_HIGH'\n    else:\n        return 'UNCATEGORIZED'\n\ndef age_sex(row, Age_threshold=45):\n    if row['Age'] > Age_threshold and row['Sex'] == 'M':\n        return 'Older_Man'\n    elif row['Age'] <= Age_threshold and row ['Sex'] == 'M':\n        return 'Younger_Man'\n    elif row['Age'] > Age_threshold and row ['Sex'] == 'F':\n        return 'Older_Woman'\n    elif row['Age'] <= Age_threshold and row ['Sex'] == 'F':\n        return 'Younger_Woman'\n    else:\n        return 0\n\n'''Total cholesterol levels less than 200 milligrams per deciliter (mg\/dL) are considered desirable for adults. \nA reading between 200 and 239 mg\/dL is considered borderline high and a reading of 240 mg\/dL and above is considered high.\n\nSource: https:\/\/www.medicalnewstoday.com\/articles\/315900 '''\n    \ndef cholesterol(row):\n    if row['Cholesterol'] >= 200 and row['Cholesterol'] <= 239:\n        return 'Borderline_High'\n    elif row['Cholesterol'] > 239:\n        return 'High'\n    else:\n        return 'Normal'\n\n#New Features preparation   \ndata['Age_Sex_Cats'] = data.apply(lambda row: age_sex(row), axis=1)\ndata['Cholesterol_Cats'] = data.apply(lambda row: cholesterol(row), axis=1)\ndata['Systolic_Blood_Pressure'] = data.apply(lambda row: blood_pressure_levels(row), axis=1)","07a83928":"features = data.drop(['HeartDisease'], axis=1)\nlabels = data.HeartDisease","f048a65b":"#Create categorical features pipeline\ncat_pipeline = Pipeline([\n    ('cat', OneHotEncoder()),\n])","ca916d89":"#Create numerical features pipeline\nnum_pipeline = Pipeline([\n    ('scaler', MinMaxScaler()),\n])","77e8d5cb":"#Create consolidated pipeline\nnum_attribs = ['Age', 'RestingBP', 'Cholesterol', 'MaxHR', 'Oldpeak']\n\ncat_attribs = ['ChestPainType', 'FastingBS', 'RestingECG', \n               'ExerciseAngina', 'ST_Slope', 'Age_Sex_Cats',\n               'Cholesterol_Cats', 'Systolic_Blood_Pressure']\n\nfull_pipeline = ColumnTransformer([\n    ('num', num_pipeline, num_attribs),\n    ('cat', cat_pipeline, cat_attribs),\n])\n\n#Prepare features via full pipeline\nfeatures_prepared = full_pipeline.fit_transform(features)","c779a233":"X_train, X_val, y_train, y_val = train_test_split(features_prepared, labels, test_size=0.2, shuffle=True, random_state=42)","39881a27":"rf = RandomForestClassifier(n_estimators=4400, max_depth=7, max_features='sqrt', bootstrap=False)","5a68b9a3":"rf.fit(X_train, y_train)","da6e27dd":"#Calculate feature importances\nfeature_importances = rf.feature_importances_\n\n#Determine most important features\ncategories = full_pipeline.transformers_[1][1][0].get_feature_names(cat_attribs)\n\nfeature_names = num_attribs + categories.tolist()\n\nsorted(zip(feature_importances, feature_names), reverse=True)","e0007734":"val_pred = cross_val_predict(rf, X_val, y_val, cv=3)","1e5855e3":"print('Accuracy score: ', f'{round((accuracy_score(y_val, val_pred)*100),2)}%')\nprint('Recall score: ', f'{round((recall_score(y_val, val_pred)*100),2)}%')\nprint('F1 score: ', f'{round((f1_score(y_val, val_pred)*100),2)}%')\nprint('ROC AUC score: ', f'{round((roc_auc_score(y_val, val_pred)*100),2)}%')","c5ed6f89":"# **Initialize Classifier**","cfb58371":"# **Exploratory Data Analysis**","40968fd7":"# **Model Validation**","2000bed7":"# **Feature Engineering**","2bd5423e":"# **Data Preprocessing**"}}