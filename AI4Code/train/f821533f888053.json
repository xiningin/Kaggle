{"cell_type":{"59d302e4":"code","cab2239f":"code","4872e175":"code","8939c89e":"code","81edf01a":"code","18c5dcfa":"code","deaa28b0":"code","96cfa0fd":"code","2739d600":"code","f4afa133":"code","64aa96b7":"code","e8f05085":"code","8bfaa486":"code","daf2b67d":"code","395cea86":"code","b12ba039":"code","f198e33a":"code","bbe1661f":"code","21d1ecaf":"code","a52bc873":"code","e3acb5d7":"code","38a1dac6":"code","215cb8d9":"markdown","e594289b":"markdown","e9f6a058":"markdown","49616026":"markdown","bf300ed7":"markdown","9135adab":"markdown","156b838c":"markdown","53336aad":"markdown","746f5c5a":"markdown","ce0667dd":"markdown","4cbab32e":"markdown","5b482445":"markdown","13c7d699":"markdown","9d1b3f86":"markdown","dd495d38":"markdown"},"source":{"59d302e4":"import numpy as np\nimport pandas as pd\nimport os\nimport cv2\nimport matplotlib.pyplot as plt","cab2239f":"from keras.utils import to_categorical, Sequence\nfrom keras.models import Sequential\nfrom keras.layers import Dense, Dropout, Flatten, Conv2D, MaxPool2D, BatchNormalization\nfrom keras.optimizers import RMSprop,Adam","4872e175":"path = '\/kaggle\/input\/cassava-leaf-disease-classification\/'\nos.listdir(path)","8939c89e":"def plot_bar(data, name):\n    data_label = data[name].value_counts().sort_index()\n    dict_train = dict(zip(data_label.keys(), ((data_label.sort_index())).tolist()))\n    names = list(dict_train.keys())\n    values = list(dict_train.values())\n    plt.bar(names, values)\n    plt.grid()\n    plt.show()","81edf01a":"train_data = pd.read_csv(path+'train.csv')\nsamp_subm = pd.read_csv(path+'sample_submission.csv')","18c5dcfa":"print('number of train data:', len(train_data))\nprint('number of train images:', len(os.listdir(path+'train_images\/')))\nprint('number of test images:', len(os.listdir(path+'test_images\/')))","deaa28b0":"plot_bar(train_data, 'label')","96cfa0fd":"img = cv2.imread(path+'train_images\/'+'1000015157.jpg')\nplt.imshow(img)\nplt.show()","2739d600":"batch_size = 3\nimg_size = 256\nimg_channel = 3","f4afa133":"y_train = to_categorical(train_data['label'])","64aa96b7":"class_weight = dict(zip(range(0, 5), (train_data['label'].value_counts().sort_index()\/len(train_data))))","e8f05085":"class DataGenerator(Sequence):\n    def __init__(self, path, list_IDs, labels, batch_size, img_size, img_channel):\n        self.path = path\n        self.list_IDs = list_IDs\n        self.labels = labels\n        self.batch_size = batch_size\n        self.img_size = img_size\n        self.img_channel = img_channel\n        self.indexes = np.arange(len(self.list_IDs))\n        \n    def __len__(self):\n        return int(np.floor(len(self.list_IDs)\/self.batch_size))\n    \n    \n    def __getitem__(self, index):\n        indexes = self.indexes[index*self.batch_size:(index+1)*self.batch_size]\n        list_IDs_temp = [self.list_IDs[k] for k in indexes]\n        X, y = self.__data_generation(list_IDs_temp)\n        return X, y\n\n    \n    def __data_generation(self, list_IDs_temp):\n        X = np.empty((self.batch_size, self.img_size, self.img_size, self.img_channel))\n        y = np.empty((self.batch_size, 5), dtype=int)\n        for i, ID in enumerate(list_IDs_temp):\n            data_file = cv2.imread(self.path+ID)\n            img = cv2.resize(data_file, (self.img_size, self.img_size))\n            X[i, ] = img\n            y[i, ] = self.labels[i]\n        X = X.astype('float32')\n        X -= X.mean()\n        X \/= X.std()\n        return X, y","8bfaa486":"from keras.applications import VGG16\nimport keras\n\nvgg_conv = VGG16(weights='imagenet', include_top=False, input_shape=(img_size, img_size, img_channel))\n\nfor layer in vgg_conv.layers[:-4]:\n\n    layer.trainable = False\n\nfrom keras import models\nfrom keras import layers\nfrom keras import optimizers\n\n# Create the model\nmodel = models.Sequential()\n\n# Add the vgg convolutional base model\nmodel.add(vgg_conv)\n\n# Add new layers\nmodel.add(layers.Flatten())\nmodel.add(layers.Dense(1024, activation='relu'))\nmodel.add(layers.Dropout(0.5))\nmodel.add(layers.Dense(5, activation='softmax'))\n\n# Show a summary of the model. Check the number of trainable parameters\n#model.summary()\n\n# model = Sequential()\n# model.add(Conv2D(128, input_shape=(img_size,img_size,img_channel), kernel_size=5, strides=4, activation='relu'))\n# model.add(BatchNormalization())\n# model.add(MaxPool2D(pool_size=(2)))\n# model.add(Conv2D(128, kernel_size=5, activation='relu'))\n# model.add(BatchNormalization())\n# model.add(MaxPool2D(pool_size=(2)))\n# model.add(Conv2D(256, kernel_size=5, activation='relu'))\n# model.add(BatchNormalization())\n# model.add(MaxPool2D(pool_size=(2)))\n# model.add(Flatten())\n# model.add(Dense(64, activation='relu'))\n# model.add(Dense(64, activation='relu'))\n# model.add(Dropout(0.3))\n# model.add(Dense(5, activation='softmax'))","daf2b67d":"model.compile(optimizer=RMSprop(lr=1e-4), loss='categorical_crossentropy', metrics=['accuracy'])","395cea86":"model.summary()","b12ba039":"epochs = 10","f198e33a":"train_generator = DataGenerator(path+'train_images\/', train_data['image_id'], y_train, batch_size, img_size, img_channel)","bbe1661f":"history = model.fit_generator(generator=train_generator,\n                              epochs = epochs,\n                              class_weight = class_weight,\n                              workers=4)","21d1ecaf":"test_generator = DataGenerator(path+'test_images\/', samp_subm['image_id'], samp_subm['label'], 1, img_size, img_channel)","a52bc873":"predict = model.predict_generator(test_generator, verbose=1)","e3acb5d7":"samp_subm['label'] = predict.argmax(axis=1)","38a1dac6":"samp_subm.to_csv('submission.csv', index=False)","215cb8d9":"## Image Data Generator","e594289b":"# Functions","e9f6a058":"# Load Data","49616026":"## Train Labels And Class Weights","bf300ed7":"Distribution of the labels:","9135adab":"# Path","156b838c":"# Libraries","53336aad":"# Intro\nWelcome to the Cassava Leaf Disease Classification competition.\n\nThere are 5 classifications (click for further informations):\n* 0: [Cassava Bacterial Blight (CBB)](https:\/\/en.wikipedia.org\/wiki\/Bacterial_blight_of_cassava)\n* 1: [Cassava Brown Streak Disease (CBSD)](https:\/\/en.wikipedia.org\/wiki\/Cassava_brown_streak_virus_disease)\n* 2: [Cassava Green Mottle (CGM)](https:\/\/en.wikipedia.org\/wiki\/Cassava_green_mottle_virus)\n* 3: [Cassava Mosaic Disease (CMD)](https:\/\/en.wikipedia.org\/wiki\/Cassava_mosaic_virus)\n* 4: Healthy\"\n\nWe will give a simple starter notebook based on a CNN.","746f5c5a":"# Prepare Data For Model","ce0667dd":"1. # Define Model\n\nWe pull the VGG16 and use pretrained weights on imagenet and train just the last 4 layers on the dataset and add some additional layers in addition to that.","4cbab32e":"# EDA","5b482445":"# Train Model","13c7d699":"# Export Data","9d1b3f86":"Plot an image:","dd495d38":"# Predict Test Data"}}