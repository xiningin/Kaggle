{"cell_type":{"dddf9977":"code","2e45390f":"code","d5e3fa20":"code","a3648595":"code","df21423a":"code","df5b2cbf":"code","5b7f72b1":"code","e8eee39e":"code","ca56921c":"code","9d139e6b":"code","28d1f82a":"code","755ee255":"code","d6ba07a6":"code","972b08ac":"code","0298ed42":"code","250d47bf":"code","5b76d42f":"code","45e705ad":"code","ad8956b8":"code","75d1b7da":"code","fcbeffd6":"markdown","4260b402":"markdown","29c26429":"markdown","65526666":"markdown","d7574b95":"markdown","70131692":"markdown","643a7fb1":"markdown","f031f9c6":"markdown","7d233d66":"markdown","4efb8eeb":"markdown","f26fcdb5":"markdown","ffc48001":"markdown","6c5bdab7":"markdown","8033d035":"markdown","12b58cdb":"markdown","bc4d151e":"markdown","99854311":"markdown","71b89436":"markdown","5ebe77bd":"markdown"},"source":{"dddf9977":"import matplotlib.ticker as mtick\nfrom sqlite3_util_py import * #this util file contains the imported libraries and some useful functions to explore data base and table","2e45390f":"desc() ","d5e3fa20":"#importing data from sqlite\nplayerskills = pd.read_sql(\"\"\"SELECT a.player_api_id,player_name ,date,birthday,overall_rating,potential,crossing,finishing,heading_accuracy,short_passing,volleys,dribbling,curve,free_kick_accuracy,long_passing,ball_control,acceleration,sprint_speed,agility,reactions,balance,shot_power,jumping,stamina,strength,long_shots,aggression,interceptions,positioning,vision,penalties,marking,standing_tackle,sliding_tackle  FROM Player_Attributes a join player b on a.player_api_id = b.player_api_id  ;\"\"\", conn)","a3648595":"playerskills.head()","df21423a":"playerskills.info()","df5b2cbf":"#Drop NA\nplayerskills.dropna(inplace= True)","5b7f72b1":"#Fix the dates datetype. \nplayerskills[['date','birthday']] = playerskills[['date','birthday']].apply(pd.to_datetime)","e8eee39e":"#Creating age column by substracting date of rating vs birthday\nplayerskills['age'] = (playerskills['date'] - playerskills['birthday']).dt.days \/\/ 365\n#count the age years we have per plater\nplayer_years = playerskills.groupby([ 'player_name','player_api_id']).nunique()[['age']]\nplayer_years['age'].plot.hist(bins = 20).set_xlabel(\"Age\");","ca56921c":"#get players with 9 years of history and more\nplayers1 = player_years[player_years['age']>=9].reset_index()['player_api_id']\n#get the palyer ratings between 15 and 35 years old\nmask = (playerskills['age'] >= 15) & (playerskills['age'] <= 35)\n\n#apply filters\nplayerskills = playerskills[playerskills['player_api_id'].isin(players1)]\nplayerskills = playerskills[mask]","9d139e6b":"playerskills.head()","28d1f82a":"playerskills[playerskills['player_name'].isin(['Wayne Rooney','Cristiano Ronaldo'])].groupby(['age','player_name']).mean().reset_index().pivot(index='age', columns='player_name', values='overall_rating').plot().set_ylabel(\"Rating\")","755ee255":"#Average player rating per age year\naverage_rating_per_year = playerskills.groupby(['age','player_name','player_api_id']).mean().reset_index()\n\n","d6ba07a6":"#Average player rating \naverage_rating = playerskills.drop(columns = 'age').groupby(['player_api_id']).mean().reset_index()\n","972b08ac":"\narpy = average_rating_per_year.merge(average_rating,suffixes=('_yearly', ''), right_on = 'player_api_id', left_on = 'player_api_id' )\n\nfor i in list(average_rating.columns)[1:]: \n    arpy[i + '_change%'] = (100*(arpy[i + '_yearly'] - arpy[i])\/arpy[i])\n","0298ed42":"arpy[arpy['player_name'].isin(['Wayne Rooney','Cristiano Ronaldo'])].pivot(index='age', columns='player_name', values='overall_rating_change%')","250d47bf":"plot = arpy[arpy['player_name'].isin(['Wayne Rooney','Cristiano Ronaldo'])].pivot(index='age', columns='player_name', values='overall_rating_change%').plot.bar()\nplot.yaxis.set_major_formatter(mtick.PercentFormatter())\nplot.set_ylabel(\"overall_rating_change%\");","5b76d42f":"arpy.plot.scatter(x='age',y = 'overall_rating_change%');","45e705ad":"plot = arpy.boxplot(column='overall_rating_change%',by = 'age',figsize=[10,5])\nplot.yaxis.set_major_formatter(mtick.PercentFormatter())\nplot.set_ylabel(\"overall_rating_change%\");","ad8956b8":"plot = arpy.groupby('age')['overall_rating_change%'].mean().plot.bar()\nplot.yaxis.set_major_formatter(mtick.PercentFormatter())\nplot.set_ylabel(\"overall_rating_change%\");","75d1b7da":"#all what we need to do then is to draw heatmap to show the age vs %change in performance per attribute\nimport seaborn as sns\ncol = [ i + '_change%' for i in average_rating_per_year.drop(columns = ['player_name','player_api_id','age']).columns]\ndf = arpy.groupby('age').mean()[col].astype(int).T\nsns.set(rc={'figure.figsize':(10\n                              ,8)})\nsns.heatmap(df, annot=False)\n","fcbeffd6":"### What are the sweet spot for player's attributes performance? ","4260b402":"1) Scatter plot of change %, every point represent a player in specific age\n","29c26429":"What are the database tables, how many rows and columns in each table? ","65526666":"Now the data is clean, however, how much history we have for each player (i.e. how many years of rating we have for each player in different ages). We need to compare players who have been consistly rated in different ages ","d7574b95":"To answer this question, we need to do further data manupliation\nSteps: \n\n1 - Get the player average rating per age year. ","70131692":"3 - Calculate the change % in rating in every age year vs the player's average rating","643a7fb1":"Now, let's see the same examples below, wayne rooney was 5% better than his career average rating when he was 21 years old. and 2% lower than his career average rating. However, Cristiano Ronald in his 30 is 2% better than average. ","f031f9c6":"<a id='intro'><\/a>\n## Introduction\n\nIn this notebook,  <a href=https:\/\/www.kaggle.com\/hugomathien\/soccer?>  European Soccor Database <\/a>were explored as a part of udaciy advanced data analysis nanodegree, a quick exploration of the database is shown below, you can find more infromation about the database in the database link. ","7d233d66":"This is satifying now, this is an example of 2 well-known players ratings in differnent ages, Wayne Roony known as \"Golden Boy\" rating was about 91.5 in his 21 years old age this decreased with time to 85 in the age of 30, CR7 rating is a bit different he seems to be consistenly increasing with time reaching rating of 92 in his 30. ","4efb8eeb":"Ok we have 7 tables, some tables are very big, player_attribute is an example.","f26fcdb5":"<a id='wrangling'><\/a>\n## Data Wrangling\n\n\n### General Properties\nlet us focus on player attributes and create a dataset joining the player attributes and the plyar tables. ","ffc48001":"reading the chart more than 3000 players has 9+ years of ratings, that's cool let us work with those players, Also, let's focus on the players ratings between age of 15 and 35 years old. ","6c5bdab7":"Let's build a box-plot for every age year to see the distribution of change % of the players \n","8033d035":"Cool!  between 15 and 22 years, seems like players are on average below their rating, this changes between 22 and 31 years while players are in their best performance, after that rating starts to decline","12b58cdb":"2 - Get the player average rating in his career. ","bc4d151e":"Finally let's see the mean on change% over age","99854311":"Let's now aggregate this data over all the players, to see the change % in rating for every year in the career of the player","71b89436":"<a id='eda'><\/a>\n## Exploratory Data Analysis\n\nThe idea behind the analyis is to understand how age affects the player performance. this will help  to better quantify what will be expected from players\n\n### What are the best years for player's performance? ","5ebe77bd":"# Project: Players rating with time\n\n## Table of Contents\n<ul>\n<li><a href=\"#intro\">Introduction<\/a><\/li>\n<li><a href=\"#wrangling\">Data Wrangling<\/a><\/li>\n<li><a href=\"#eda\">Exploratory Data Analysis<\/a><\/li>\n<\/ul>"}}