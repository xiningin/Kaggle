{"cell_type":{"7e3dddd8":"code","b622516e":"code","8de611a2":"code","88e372d7":"code","8d836778":"code","4c18defc":"code","77d363ab":"code","9d5d007d":"code","b41f20c4":"code","573f0387":"code","efba58ca":"code","947b0eaf":"code","dd53f59a":"markdown","940a4572":"markdown","27ef3b32":"markdown"},"source":{"7e3dddd8":"import numpy as np\nimport pandas as pd\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","b622516e":"submission = pd.read_csv('\/kaggle\/input\/lish-moa\/sample_submission.csv')\n\npublic_ids = list(submission['sig_id'].values)\n\nsubmission.shape","8de611a2":"test = pd.read_csv('\/kaggle\/input\/lish-moa\/test_features.csv')\n\ntest_ids = list(test['sig_id'].values)\n\nprivate_ids = list(set(test_ids)-set(public_ids))\n\nlen(private_ids)","88e372d7":"kernels = pd.read_csv('\/kaggle\/input\/moa-public-kernels\/kernels.csv', index_col='id')","8d836778":"kernels.head(10)","4c18defc":"import glob\n\ndef make_filename(idx):\n    return glob.glob('\/kaggle\/input\/moa-public-kernels\/' + str(idx) + '__submission.csv')[0]\n\ndef read_predictions(idx):\n    temp = pd.read_csv(make_filename(idx))\n    return temp\n\n\npredictions = [read_predictions(idx) for idx in kernels.index]\nlen(predictions)","77d363ab":"target_columns = list(submission.columns)\ntarget_columns.remove('sig_id')","9d5d007d":"y_pred = pd.DataFrame()\ny_pred['sig_id'] = predictions[0]['sig_id']\n\nfor column in target_columns:\n    column_data = []\n    for i in range(len(predictions)):\n        column_data.append(predictions[i][column])\n    y_pred[column] = np.mean(column_data, axis=0)\n\ny_pred.shape","b41f20c4":"# (1 - score) because lesser metric is better\nscores = 1. - kernels['score']\n\nsum_scores = sum(scores)\n\nweights = [x \/ sum_scores for x in scores]","573f0387":"weighted_y_pred = pd.DataFrame()\nweighted_y_pred['sig_id'] = predictions[0]['sig_id']\n\nfor column in target_columns:\n    column_data = []\n    for i in range(len(predictions)):\n        column_data.append(predictions[i][column] * weights[i])\n    weighted_y_pred[column] = np.sum(column_data, axis=0)\n\nweighted_y_pred.shape","efba58ca":"y_pred = weighted_y_pred","947b0eaf":"submission = pd.DataFrame(index = public_ids + private_ids, columns=target_columns)\nsubmission.index.name = 'sig_id'\n\nsubmission[:] = 0\n\nsubmission.loc[y_pred.sig_id,:] = y_pred[target_columns].values\n\nsubmission.loc[test[test.cp_type == 'ctl_vehicle'].sig_id] = 0\n\nsubmission.to_csv('submission.csv', index=True)\n\nsubmission.head().T","dd53f59a":"## Submit predictions","940a4572":"## Weighted sum","27ef3b32":"## Average"}}