{"cell_type":{"91f86c5a":"code","ba8901d1":"code","ba35eaff":"code","d6322463":"code","c6b0ed39":"code","455a6b2b":"code","6c7613bd":"code","0a0bf7d0":"code","02f335a8":"markdown","83a9883f":"markdown","6a4bab18":"markdown","dc920af5":"markdown","63a0098e":"markdown"},"source":{"91f86c5a":"!pip install torch==1.7.1+cu110 torchvision==0.8.2+cu110 torchaudio==0.7.2 -f https:\/\/download.pytorch.org\/whl\/torch_stable.html > \/dev\/null\n!pip install rudalle==0.0.1rc7 > \/dev\/null","ba8901d1":"from rudalle.pipelines import generate_images, show, super_resolution, cherry_pick_by_clip\nfrom rudalle import get_rudalle_model, get_tokenizer, get_vae, get_realesrgan, get_ruclip\nfrom rudalle.utils import seed_everything","ba35eaff":"device = 'cuda'\ndalle = get_rudalle_model('Malevich', pretrained=True, fp16=True, device=device)","d6322463":"realesrgan = get_realesrgan('x2', device=device)\ntokenizer = get_tokenizer()\nvae = get_vae(dwt=True).to(device)\nruclip, ruclip_processor = get_ruclip('ruclip-vit-base-patch32-v5')\nruclip = ruclip.to(device)","c6b0ed39":"text = '\u043a\u0440\u0430\u0441\u0438\u0432\u0430\u044f \u0442\u044f\u043d \u0438\u0437 \u0430\u043d\u0438\u043c\u0435' # eq: beautiful girl from anime\npil_images = []\nscores = []\n\nseed_everything(6955)\n\nfor top_k, top_p, images_num in [\n    (2048, 0.995, 3),\n    (1536, 0.99, 3),\n    (1024, 0.99, 3),\n    (1024, 0.98, 3),\n    (512, 0.97, 3),\n    (384, 0.96, 3),\n    (256, 0.95, 3),\n    (128, 0.95, 3), \n]:\n    _pil_images, _scores = generate_images(text, tokenizer, dalle, vae, top_k=top_k, images_num=images_num, top_p=top_p)\n    pil_images += _pil_images\n    scores += _scores","455a6b2b":"show(pil_images, 6)","6c7613bd":"top_images, clip_scores = cherry_pick_by_clip(pil_images, text, ruclip, ruclip_processor, device=device, count=6)\nshow(top_images, 3)","0a0bf7d0":"sr_images = super_resolution(top_images, realesrgan)\nshow(sr_images, 3)","02f335a8":"### auto cherry-pick by ruCLIP:","83a9883f":"# ruDALL-E Malevich (XL)\n## Generate images from text\n\n<img style=\"text-align:center; display:block;\" src=\"https:\/\/huggingface.co\/sberbank-ai\/rudalle-Malevich\/resolve\/main\/dalle-malevich.jpg\" width=\"200\">\n\"Avocado painting in the style of Malevich\"\n\n* [Technical Report (Russian)](https:\/\/habr.com\/ru\/company\/sberbank\/blog\/586926\/)\n* [Demo (Russian)](https:\/\/rudalle.ru)\n\nModel was trained by [SberAI](https:\/\/github.com\/sberbank-ai) and [SberDevices](https:\/\/sberdevices.ru\/) teams.  \n* Task: `text2image generation`\n* Num Parameters: `1.3B`\n* Training Data Volume: `120 million text-image pairs`\n\n### Model Description\nThis is a 1.3 billion parameter model for Russian, recreating OpenAI's [DALL\u00b7E](https:\/\/openai.com\/blog\/dall-e\/), a model capable of generating arbitrary images from a text prompt that describes the desired result. \n\nThe generation pipeline includes ruDALL-E, ruCLIP for ranging results, and a superresolution model. \nYou can use automatic translation into Russian to create desired images with ruDALL-E.\n\n### How to Use\nThe easiest way to get familiar with the code and the models is to follow the inference notebook we provide in our [github repo](https:\/\/github.com\/sberbank-ai\/ru-dalle). ","6a4bab18":"### generation by ruDALLE:","dc920af5":"### super resolution:","63a0098e":"### Notebook author: [@shonenkov](https:\/\/www.kaggle.com\/shonenkov)"}}