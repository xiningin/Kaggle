{"cell_type":{"42d737e0":"code","ea369029":"code","1cdd4447":"code","82c84f5d":"code","3759d859":"code","d528774b":"code","78366dc4":"code","7eab5340":"code","b06b67ed":"code","e9dedc0a":"code","475f0adf":"code","4c54a5b5":"code","ca8f1310":"code","eb5acd17":"code","669856f7":"code","27eb0554":"code","253301bd":"code","25087e30":"code","8951c509":"code","d5a35023":"code","22c6563f":"code","0cc2dcaa":"code","5d53a039":"code","7e8dbba0":"code","8ca417d1":"code","1a191e5d":"code","905c15e6":"code","ff8031d9":"code","7c2a3bed":"code","86c5fc7e":"code","7e158c81":"code","6ec15c0f":"code","130fd87c":"code","b658c5aa":"code","bb85458b":"code","cac24fba":"code","c1671502":"code","bc971ecf":"code","cac8afb8":"code","bf214fc5":"code","15e7f492":"code","d07f94fa":"code","8cae8e40":"code","ec345925":"code","8486f01d":"code","3f940101":"code","3d7cad13":"code","78aacfe1":"code","a47421d4":"code","4ec3f6cb":"code","137dad32":"code","5f1f6c84":"code","1d22bfc6":"code","f6d97a1c":"code","233f4f02":"code","a1fb0b19":"code","0a521929":"code","9cbd5722":"code","72244db3":"code","13385ddf":"code","1d32d731":"code","e89c2b66":"code","7fb56cdd":"code","20842a89":"code","b920f7e0":"code","14eb4b73":"code","a281ae4d":"code","588c4273":"code","df0e9d77":"code","600b981f":"code","c33a4ee0":"code","4a8743bf":"code","3ef2d5ee":"code","38968452":"code","b3323f5a":"code","8df51eb6":"code","fb4f3205":"code","5eeac9e0":"code","4cc8feaa":"code","bf861eb6":"code","80aa512f":"code","c8e6d2ab":"code","fd68b5e9":"code","a8a66922":"code","50c05b04":"code","783f67b9":"code","54687f4b":"code","34ae1f78":"code","56ce76e7":"code","8d74b54c":"code","d935b9e2":"markdown","f2d9acdc":"markdown","cf6ba287":"markdown","91e159d6":"markdown","7d89eb85":"markdown","9bd1c452":"markdown","3f488065":"markdown","684564f2":"markdown","13ce716a":"markdown","fb927b81":"markdown","8c07ac4e":"markdown","233a1cc2":"markdown","85949015":"markdown","30c18c86":"markdown","dc599b6f":"markdown","a11f38ff":"markdown","7326f4ef":"markdown","c3f25d68":"markdown","d532c128":"markdown","082bfa35":"markdown","eea9f04e":"markdown","f4c2c116":"markdown","e2d42cca":"markdown","871adaa3":"markdown","20222d66":"markdown","59970dcb":"markdown","97def623":"markdown","ed672061":"markdown","9ff9a416":"markdown","ef440d2e":"markdown"},"source":{"42d737e0":"#for data processing\nimport numpy as np \nimport pandas as pd\n\n#for visualization\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","ea369029":"import lightgbm as lgb\nfrom sklearn import preprocessing\nfrom sklearn.metrics import mean_squared_log_error, mean_squared_error\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.metrics import log_loss\nfrom sklearn.metrics import classification_report\nimport seaborn as sns\nfrom collections import Counter\nsns.set_style('whitegrid')","1cdd4447":"train= pd.read_csv(\"..\/input\/av-janatahack-machine-learning-in-agriculture\/train_yaOffsB.csv\")\ntest= pd.read_csv(\"..\/input\/av-janatahack-machine-learning-in-agriculture\/test_pFkWwen.csv\")","82c84f5d":"train.head(2)","3759d859":"test.head(2)","d528774b":"train['train_or_test']='train'\ntest['train_or_test']='test'\nall=pd.concat([train,test])","78366dc4":"all.head(2)","7eab5340":"#Visualization to check for missing values\nsns.heatmap(all.isna())","b06b67ed":"all.info()","e9dedc0a":"#ID\nsum(all['ID'].value_counts()>1)","475f0adf":"#Estimated_Insects_Count\nsns.set_style('whitegrid')\nsns.distplot(all[all['Crop_Damage']==0]['Estimated_Insects_Count'],bins=30,color='blue',kde=False)\nsns.distplot(all[all['Crop_Damage']==1]['Estimated_Insects_Count'],bins=30,color='red',kde=False)\nsns.distplot(all[all['Crop_Damage']==2]['Estimated_Insects_Count'],bins=30,color='green',kde=False)\nplt.legend(labels=['Crop Damage=0', 'Crop Damage=1', 'Crop Damage=2'])","4c54a5b5":"#Crop_Type\nsns.set_style('whitegrid')\nsns.countplot(x='Crop_Type',data=all,hue='Crop_Damage')\nplt.legend(labels=['Crop Damage=0', 'Crop Damage=1', 'Crop Damage=2'])","ca8f1310":"groupby_df = all[all['train_or_test']=='train'].groupby(['Crop_Type', 'Crop_Damage']).agg({'Crop_Damage': 'count'})\ngroupby_pcts = groupby_df.groupby(level=0).apply(lambda x:round(100 * x \/ x.sum(),2))\ngroupby_df,groupby_pcts","eb5acd17":"#Soil_Type\nsns.set_style('whitegrid')\nsns.countplot(x='Soil_Type',data=all,hue='Crop_Damage')\nplt.legend(labels=['Crop Damage=0', 'Crop Damage=1', 'Crop Damage=2'])","669856f7":"groupby_df = all[all['train_or_test']=='train'].groupby(['Soil_Type', 'Crop_Damage']).agg({'Crop_Damage': 'count'})\ngroupby_pcts = groupby_df.groupby(level=0).apply(lambda x:round(100 * x \/ x.sum(),2))\ngroupby_df,groupby_pcts","27eb0554":"#Pesticide_Use_Category\nsns.set_style('whitegrid')\nsns.set_style('whitegrid')\nsns.countplot(x='Pesticide_Use_Category',data=all,hue='Crop_Damage')\nplt.legend(labels=['Crop Damage=0', 'Crop Damage=1', 'Crop Damage=2'])","253301bd":"groupby_df = all[all['train_or_test']=='train'].groupby(['Pesticide_Use_Category', 'Crop_Damage']).agg({'Crop_Damage': 'count'})\ngroupby_pcts = groupby_df.groupby(level=0).apply(lambda x:round(100 * x \/ x.sum(),2))\ngroupby_df,groupby_pcts","25087e30":"#Number_Doses_Week\nsns.set_style('whitegrid')\nsns.distplot(all[all['Crop_Damage']==0]['Number_Doses_Week'],bins=30,color='blue',kde=False)\nsns.distplot(all[all['Crop_Damage']==1]['Number_Doses_Week'],bins=30,color='red',kde=False)\nsns.distplot(all[all['Crop_Damage']==2]['Number_Doses_Week'],bins=30,color='green',kde=False)\nplt.legend(labels=['Crop Damage=0', 'Crop Damage=1', 'Crop Damage=2'])","8951c509":"#Number_Weeks_Used\nsns.set_style('whitegrid')\nsns.distplot(all[all['Crop_Damage']==0]['Number_Weeks_Used'],bins=30,color='blue',kde=False)\nsns.distplot(all[all['Crop_Damage']==1]['Number_Weeks_Used'],bins=30,color='red',kde=False)\nsns.distplot(all[all['Crop_Damage']==2]['Number_Weeks_Used'],bins=30,color='green',kde=False)\nplt.legend(labels=['Crop Damage=0', 'Crop Damage=1', 'Crop Damage=2'])","d5a35023":"#Number_Weeks_Quit\nsns.set_style('whitegrid')\nsns.distplot(all[all['Crop_Damage']==0]['Number_Weeks_Quit'],bins=30,color='blue',kde=False)\nsns.distplot(all[all['Crop_Damage']==1]['Number_Weeks_Quit'],bins=30,color='red',kde=False)\nsns.distplot(all[all['Crop_Damage']==2]['Number_Weeks_Quit'],bins=30,color='green',kde=False)\nplt.legend(labels=['Crop Damage=0', 'Crop Damage=1', 'Crop Damage=2'])","22c6563f":"#Pesticide_Use_Category\nsns.set_style('whitegrid')\nsns.set_style('whitegrid')\nsns.countplot(x='Season',data=all,hue='Crop_Damage')\nplt.legend(labels=['Crop Damage=0', 'Crop Damage=1', 'Crop Damage=2'])","0cc2dcaa":"groupby_df = all[all['train_or_test']=='train'].groupby(['Season', 'Crop_Damage']).agg({'Crop_Damage': 'count'})\ngroupby_pcts = groupby_df.groupby(level=0).apply(lambda x:round(100 * x \/ x.sum(),2))\ngroupby_df,groupby_pcts","5d53a039":"#Crop_Damage\nsns.set_style('whitegrid')\nsns.countplot('Crop_Damage',hue='train_or_test',data=all)","7e8dbba0":"all.dtypes","8ca417d1":"sns.heatmap(all.corr(),annot=True)","1a191e5d":"# Estimated_Insects_Count & Number_Doses_Week  \n# sns.jointplot(x='Estimated_Insects_Count',y='Number_Doses_Week',data=all,kind='kde')","905c15e6":"# Estimated_Insects_Count & Number_Weeks_Used\n# sns.jointplot(x='Estimated_Insects_Count',y='Number_Weeks_Used',data=all,kind='kde')","ff8031d9":"# Estimated_Insects_Count & Number_Weeks_Quit\n# sns.jointplot(x='Estimated_Insects_Count',y='Number_Weeks_Quit',data=all,kind='kde')","7c2a3bed":"# Number_Doses_Week & Number_Weeks_Used\n# sns.jointplot(x='Number_Doses_Week',y='Number_Weeks_Used',data=all,kind='kde')","86c5fc7e":"# Number_Doses_Week & Number_Weeks_Quit\n# sns.jointplot(x='Number_Doses_Week',y='Number_Weeks_Quit',data=all,kind='kde')","7e158c81":"# Number_Weeks_Used & Number_Weeks_Quit\n# sns.jointplot(x='Number_Weeks_Used',y='Number_Weeks_Quit',data=all,kind='kde')","6ec15c0f":"from scipy.stats import chi2","130fd87c":"def chi_test(df,col1,col2):\n    \n    #Contingency Table\n    contingency_table=pd.crosstab(df[col1],df[col2])\n    #print('contingency_table :-\\n',contingency_table)\n\n    #Observed Values\n    Observed_Values = contingency_table.values \n    #print(\"\\nObserved Values :-\\n\",Observed_Values)\n\n    #Expected Values\n    import scipy.stats\n    b=scipy.stats.chi2_contingency(contingency_table)\n    Expected_Values = b[3]\n    #print(\"\\nExpected Values :-\\n\",Expected_Values)\n\n    #Degree of Freedom\n    no_of_rows=len(contingency_table.iloc[0:2,0])\n    no_of_columns=len(contingency_table.iloc[0,0:2])\n    df=(no_of_rows-1)*(no_of_columns-1)\n    #print(\"\\nDegree of Freedom:-\",df)\n\n    #Significance Level 5%\n    alpha=0.05\n    #print('\\nSignificance level: ',alpha)\n\n    #chi-square statistic - \u03c72\n    chi_square=sum([(o-e)**2.\/e for o,e in zip(Observed_Values,Expected_Values)])\n    chi_square_statistic=chi_square[0]+chi_square[1]\n    #print(\"\\nchi-square statistic:-\",chi_square_statistic)\n\n    #critical_value\n    critical_value=chi2.ppf(q=1-alpha,df=df)\n    #print('\\ncritical_value:',critical_value)\n\n    #p-value\n    p_value=1-chi2.cdf(x=chi_square_statistic,df=df)\n    #print('\\np-value:',p_value)\n\n    #compare chi_square_statistic with critical_value and p-value which is the probability of getting chi-square>0.09 (chi_square_statistic)\n    if chi_square_statistic>=critical_value:\n        print(\"\\nchi_square_statistic & critical_value - significant result, reject null hypothesis (H0), dependent.\")\n    else:\n        print(\"\\nchi_square_statistic & critical_value - not significant result, fail to reject null hypothesis (H0), independent.\")\n\n    if p_value<=alpha:\n        print(\"\\np_value & alpha - significant result, reject null hypothesis (H0), dependent.\")\n    else:\n        print(\"\\np_value & alpha - not significant result, fail to reject null hypothesis (H0), independent.\")","b658c5aa":"#Soil_Type & Crop_Type\nchi_test(all,'Soil_Type','Crop_Type')","bb85458b":"#Soil_Type & Pesticide_Use_Category\nchi_test(all,'Soil_Type','Pesticide_Use_Category')","cac24fba":"#Soil_Type & Season\nchi_test(all,'Soil_Type','Season')","c1671502":"#Crop_Type & Pesticide_Use_Category\nchi_test(all,'Crop_Type','Pesticide_Use_Category')","bc971ecf":"#Crop_Type & Season\nchi_test(all,'Crop_Type','Season')","cac8afb8":"#Pesticide_Use_Category & Season\nchi_test(all,'Pesticide_Use_Category','Season')","bf214fc5":"#Soil_Type & Estimated_Insects_Count\nsns.boxplot(x='Soil_Type',y='Estimated_Insects_Count',data=all)","15e7f492":"#Soil_Type & Number_Weeks_Used\nsns.boxplot(x='Soil_Type',y='Number_Weeks_Used',data=all)","d07f94fa":"#Soil_Type & Number_Doses_Week\nsns.boxplot(x='Soil_Type',y='Number_Doses_Week',data=all)","8cae8e40":"#Soil_Type & Number_Weeks_Quit\nsns.boxplot(x='Soil_Type',y='Number_Weeks_Quit',data=all)","ec345925":"#Crop_Type & Estimated_Insects_Count\nsns.boxplot(x='Crop_Type',y='Estimated_Insects_Count',data=all)","8486f01d":"#Crop_Type & Number_Weeks_Used\nsns.boxplot(x='Crop_Type',y='Number_Weeks_Used',data=all)","3f940101":"#Crop_Type & Number_Doses_Week\nsns.boxplot(x='Crop_Type',y='Number_Doses_Week',data=all)","3d7cad13":"#Crop_Type & Number_Weeks_Quit\nsns.boxplot(x='Crop_Type',y='Number_Weeks_Quit',data=all)","78aacfe1":"#Pesticide_Use_Category & Estimated_Insects_Count\nsns.boxplot(x='Pesticide_Use_Category',y='Estimated_Insects_Count',data=all)","a47421d4":"#Pesticide_Use_Category & Number_Weeks_Used\nsns.boxplot(x='Pesticide_Use_Category',y='Number_Weeks_Used',data=all)","4ec3f6cb":"#Pesticide_Use_Category & Number_Doses_Week\nsns.boxplot(x='Pesticide_Use_Category',y='Number_Doses_Week',data=all)","137dad32":"#Pesticide_Use_Category & Number_Weeks_Quit\nsns.boxplot(x='Pesticide_Use_Category',y='Number_Weeks_Quit',data=all)","5f1f6c84":"#Season & Estimated_Insects_Count\nsns.boxplot(x='Season',y='Estimated_Insects_Count',data=all)","1d22bfc6":"#Season & Number_Weeks_Used\nsns.boxplot(x='Season',y='Number_Weeks_Used',data=all)","f6d97a1c":"#Season & Number_Doses_Week\nsns.boxplot(x='Season',y='Number_Doses_Week',data=all)","233f4f02":"#Season & Number_Weeks_Quit\nsns.boxplot(x='Season',y='Number_Doses_Week',data=all)","a1fb0b19":"feature_cols = all.columns.tolist()\nfeature_cols.remove('ID')\nfeature_cols.remove('Crop_Damage')\nfeature_cols.remove('train_or_test')\nlabel_col = 'Crop_Damage'\nprint(feature_cols)","0a521929":"all['ID_value'] = all['ID'].apply(lambda x: x.strip('F')).astype('int')","9cbd5722":"all=all.sort_values(['ID_value'])","72244db3":"all.shape","13385ddf":"#Performing this operation as datetime has an upper and lower limit\ndate = np.array('2020-07-24', dtype=np.datetime64)\ndate=date-74084\ndate","1d32d731":"#Creating a date array \ndate_arr=date+np.arange(148168)\ndate_arr","e89c2b66":"all['date']=date_arr#pd.to_datetime(date_arr, errors='coerce')","7fb56cdd":"#Estimated_Insects_Count\nsns.lineplot(x=all[(all['date'].dt.year>2000) & (all['date'].dt.year<2025)]['date'],y=all[(all['date'].dt.year>2000) & (all['date'].dt.year<2025)]['Estimated_Insects_Count'])","20842a89":"#Number_Doses_Week\nsns.lineplot(x=all[(all['date'].dt.year>2020) & (all['date'].dt.year<2025)]['date'],y=all[(all['date'].dt.year>2020) & (all['date'].dt.year<2025)]['Number_Doses_Week'])","b920f7e0":"#Number_Weeks_Used\nsns.lineplot(x=all[(all['date'].dt.year>2020) & (all['date'].dt.year<2025)]['date'],y=all[(all['date'].dt.year>2020) & (all['date'].dt.year<2025)]['Number_Weeks_Used'])","14eb4b73":"#SeasonNumber_Weeks_Quit\nsns.lineplot(x=all[(all['date'].dt.year>2020) & (all['date'].dt.year<2025)]['date'],y=all[(all['date'].dt.year>2020) & (all['date'].dt.year<2025)]['Number_Weeks_Quit'])","a281ae4d":"#Crop_Damage\nsns.lineplot(x=all[(all['date'].dt.year>2000) & (all['date'].dt.year<2025)]['date'],y=all[(all['date'].dt.year>2000) & (all['date'].dt.year<2025)]['Crop_Damage'])","588c4273":"#Resetting Index\nall=all.reset_index(drop=True)","df0e9d77":"all['Crop_Type_Damage_lag1']=all.sort_values(['ID_value']).groupby(['Crop_Type'])['Crop_Damage'].apply(lambda x:x.shift().rolling(5,min_periods=1).mean()).fillna(-999).values\nall['Soil_Type_Damage_lag1']=all.sort_values(['ID_value']).groupby(['Soil_Type'])['Crop_Damage'].apply(lambda x:x.shift().rolling(5,min_periods=1).mean()).fillna(-999).values\nall['Pesticide_Use_Category_lag1']=all.sort_values(['ID_value']).groupby(['Pesticide_Use_Category'])['Crop_Damage'].apply(lambda x:x.shift().rolling(5,min_periods=1).mean()).fillna(-999).values\nall['Season_lag1']=all.sort_values(['ID_value']).groupby(['Season'])['Crop_Damage'].apply(lambda x:x.shift().rolling(5,min_periods=1).mean()).fillna(-999).values\n\nall['Crop_Type_Damage_lag2']=all.sort_values(['ID_value']).groupby(['Crop_Type'])['Crop_Damage'].apply(lambda x:x.shift(periods=2).rolling(5,min_periods=1).mean()).fillna(-999).values\nall['Soil_Type_Damage_lag2']=all.sort_values(['ID_value']).groupby(['Soil_Type'])['Crop_Damage'].apply(lambda x:x.shift(periods=2).rolling(5,min_periods=1).mean()).fillna(-999).values\nall['Pesticide_Use_Category_lag2']=all.sort_values(['ID_value']).groupby(['Pesticide_Use_Category'])['Crop_Damage'].apply(lambda x:x.shift(periods=2).rolling(5,min_periods=1).mean()).fillna(-999).values\nall['Season_lag2']=all.sort_values(['ID_value']).groupby(['Season'])['Crop_Damage'].apply(lambda x:x.shift(periods=2).rolling(5,min_periods=1).mean()).fillna(-999).values\n","600b981f":"#Setting Crop_Damage=-999 for missing values\nall.loc[all['train_or_test'] == 'test', 'Crop_Damage'] = -999","c33a4ee0":"#Creating Other Lag Variables\nall['Crop_Damage_lag1'] = all['Crop_Damage'].shift(fill_value=-999)\nall['Estimated_Insects_Count_lag1'] = all['Estimated_Insects_Count'].shift(fill_value=-999)\nall['Crop_Type_lag1'] = all['Crop_Type'].shift(fill_value=-999)\nall['Soil_Type_lag1'] = all['Soil_Type'].shift(fill_value=-999)\nall['Pesticide_Use_Category_lag1'] = all['Pesticide_Use_Category'].shift(fill_value=-999)\nall['Number_Doses_Week_lag1'] = all['Number_Doses_Week'].shift(fill_value=-999)\nall['Number_Weeks_Used_lag1'] = all['Number_Weeks_Used'].shift(fill_value=-999)\nall['Number_Weeks_Quit_lag1'] = all['Number_Weeks_Quit'].shift(fill_value=-999)\nall['Season_lag1'] = all['Season'].shift(fill_value=-999)\n\nall['Crop_Damage_lag2'] = all['Crop_Damage'].shift(periods=2,fill_value=-999)\nall['Estimated_Insects_Count_lag2'] = all['Estimated_Insects_Count'].shift(periods=2,fill_value=-999)\nall['Crop_Type_lag2'] = all['Crop_Type'].shift(fill_value=-999)\nall['Soil_Type_lag2'] = all['Soil_Type'].shift(fill_value=-999)\nall['Pesticide_Use_Category_lag2'] = all['Pesticide_Use_Category'].shift(periods=2,fill_value=-999)\nall['Number_Doses_Week_lag2'] = all['Number_Doses_Week'].shift(periods=2,fill_value=-999)\nall['Number_Weeks_Used_lag2'] = all['Number_Weeks_Used'].shift(periods=2,fill_value=-999)\nall['Number_Weeks_Quit_lag2'] = all['Number_Weeks_Quit'].shift(periods=2,fill_value=-999)\nall['Season_lag2'] = all['Season'].shift(periods=2,fill_value=-999)\n","4a8743bf":"#train & test split\ntrain, test = all[all.train_or_test == 'train'], all[all.train_or_test == 'test']","3ef2d5ee":"train.drop(['train_or_test'], inplace=True, axis=1)\ntest.drop(['train_or_test'], inplace=True, axis=1)\ntest.drop([label_col], inplace=True, axis=1)","38968452":"print(train.shape, test.shape)","b3323f5a":"del all","8df51eb6":"missing_impute = -999","fb4f3205":"train['Number_Weeks_Used'] = train['Number_Weeks_Used'].apply(lambda x: missing_impute if pd.isna(x) else x)\ntest['Number_Weeks_Used'] = test['Number_Weeks_Used'].apply(lambda x: missing_impute if pd.isna(x) else x)\n\ntrain['Number_Weeks_Used_lag1'] = train['Number_Weeks_Used_lag1'].apply(lambda x: missing_impute if pd.isna(x) else x)\ntest['Number_Weeks_Used_lag1'] = test['Number_Weeks_Used_lag1'].apply(lambda x: missing_impute if pd.isna(x) else x)\n\ntrain['Number_Weeks_Used_lag2'] = train['Number_Weeks_Used_lag2'].apply(lambda x: missing_impute if pd.isna(x) else x)\ntest['Number_Weeks_Used_lag2'] = test['Number_Weeks_Used_lag2'].apply(lambda x: missing_impute if pd.isna(x) else x)","5eeac9e0":"df_train, df_eval = train_test_split(train, test_size=0.40, random_state=101, shuffle=True, stratify=train[label_col])","4cc8feaa":"feature_cols = train.columns.tolist()\nfeature_cols.remove('ID')\nfeature_cols.remove('Crop_Damage')\nfeature_cols.remove('ID_value')\nfeature_cols.remove('date')\nprint(feature_cols)","bf861eb6":"cat_cols = ['Crop_Type', 'Soil_Type', 'Pesticide_Use_Category', 'Season', 'Crop_Type_lag1', 'Soil_Type_lag1', 'Pesticide_Use_Category_lag1', 'Season_lag1']","80aa512f":"params = {}\nparams['learning_rate'] = 0.04\nparams['max_depth'] = 18\nparams['n_estimators'] = 3000\nparams['objective'] = 'multiclass'\nparams['boosting_type'] = 'gbdt'\nparams['subsample'] = 0.7\nparams['random_state'] = 42\nparams['colsample_bytree']=0.7\nparams['min_data_in_leaf'] = 55\nparams['reg_alpha'] = 1.7\nparams['reg_lambda'] = 1.11\nparams['class_weight']: {0: 0.44, 1: 0.4, 2: 0.37}","c8e6d2ab":"clf = lgb.LGBMClassifier(**params)\n    \nclf.fit(df_train[feature_cols], df_train[label_col], early_stopping_rounds=100, eval_set=[(df_train[feature_cols], df_train[label_col]), (df_eval[feature_cols], df_eval[label_col])], eval_metric='multi_error', verbose=True, categorical_feature=cat_cols)\n\neval_score = accuracy_score(df_eval[label_col], clf.predict(df_eval[feature_cols]))\n\nprint('Eval ACC: {}'.format(eval_score))","fd68b5e9":"#Getting best iteration \nbest_iter = clf.best_iteration_\nparams['n_estimators'] = best_iter\nprint(params)","a8a66922":"clf = lgb.LGBMClassifier(**params)\n\nclf.fit(train[feature_cols], train[label_col], eval_metric='multi_error', verbose=False, categorical_feature=cat_cols)\n\n# eval_score_auc = roc_auc_score(df_train[label_col], clf.predict(df_train[feature_cols]))\neval_score_acc = accuracy_score(train[label_col], clf.predict(train[feature_cols]))\n\nprint('ACC: {}'.format(eval_score_acc))","50c05b04":"preds = clf.predict(test[feature_cols])","783f67b9":"Counter(train['Crop_Damage'])","54687f4b":"Counter(preds)","34ae1f78":"submission = pd.DataFrame({'ID':test['ID'], 'Crop_Damage':preds})","56ce76e7":"plt.rcParams['figure.figsize'] = (12, 6)\nlgb.plot_importance(clf)\nplt.show()","8d74b54c":"submission.to_csv('lgbm.csv',index=False)","d935b9e2":"### Creating a dummy date range to check if the data is time series","f2d9acdc":"Season is independent of all categorical variables","cf6ba287":"10-30 weeks for 0-1000 Insect Count and increased usage with higher insect count","91e159d6":"# Feature Engineering","7d89eb85":"<img src='https:\/\/datahack-prod.s3.ap-south-1.amazonaws.com\/__sized__\/contest_cover\/cover_1_CTBt1pB-thumbnail-1200x1200-90.jpg'>","9bd1c452":"# Submission & Variable Importance","3f488065":"## Univariate Analysis","684564f2":"Pesticide Use Category 2 i.e. previously used has higher survival %","13ce716a":"Target variable: Crop Damage (0,1,2), Potential Predictors: All Others","fb927b81":"Number of Weeks Use has good correlation with Estimated_Insects_Count - can be used for imputing missing values ","8c07ac4e":"No difference between seasons in survival %","233a1cc2":"### Checking if all continuous variables are time dependent","85949015":"## Missing Value Imputation","30c18c86":"# References:\n1. EDA - https:\/\/www.analyticsvidhya.com\/blog\/2016\/01\/guide-data-exploration\/\n2. LightGBM - https:\/\/towardsdatascience.com\/understanding-lightgbm-parameters-and-how-to-tune-them-6764e20c6e5b","dc599b6f":"20 doses per week and 0-2000 Insect Count is most common","a11f38ff":"## Feel free to share feedback, Do upvote if you like\/find the notebook useful!","7326f4ef":"##### Categorical & Categorical","c3f25d68":"### Creating lag variables for Crop_Damage group by Categorical Variables","d532c128":"Crop Type 1 has slightly higher survival %","082bfa35":"Stripping the 'F' for all IDs, this is required to sort the IDs","eea9f04e":"# Problem Statement","f4c2c116":"The Toxic Pesticides\n\nThough, many of us don't appreciate much, but a farmer's job is real test of endurance and determination. Once the seeds are sown, he works days and nights to make sure that he cultivates a good harvest at the end of season. A good harvest is ensured by several factors such as availability of water, soil fertility, protecting crops from rodents, timely use of pesticides & other useful chemicals and nature. While a lot of these factors are difficult to control for, the amount and frequency of pesticides is something the farmer can control.\n\nPesticides are also special, because while they protect the crop with the right dosage. But, if you add more than required, they may spoil the entire harvest. A high level of pesticide can deem the crop dead \/ unsuitable for consumption among many outcomes. This data is based on crops harvested by various farmers at the end of harvest season. To simplify the problem, you can assume that all other factors like variations in farming techniques have been controlled for.\n\nYou need to daetermine the outcome of the harvest season, i.e. whether the crop would be healthy (alive), damaged by pesticides or damaged by other reasons.","e2d42cca":"# Exploratory Data Analysis","871adaa3":"Soil Type 1 has slightly higher survival %","20222d66":"# Building Models","59970dcb":"## Bivariate Analysis","97def623":"##### Categorical & Continuous","ed672061":"# Data Loading","9ff9a416":"All unique ids","ef440d2e":"##### Continuous and Continuous"}}