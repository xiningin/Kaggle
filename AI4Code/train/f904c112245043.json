{"cell_type":{"8cadd2b9":"code","666c79cb":"code","93c50d40":"code","4bfa1c8e":"code","e37a76c9":"code","1750926d":"code","e207fd13":"code","a05d056b":"code","83e36fa2":"code","1519ddde":"code","627381de":"code","e06592a8":"code","10fad26c":"code","136d6dbe":"code","662b3b6a":"code","8c813107":"code","e3042036":"code","96f8dc60":"code","c40947bf":"code","7df20904":"code","fd541505":"code","6ca2b6be":"code","87385093":"code","25bbf813":"code","1033f528":"code","ec78fd1f":"code","49933150":"code","2265df1d":"code","7592fec7":"code","5e352f8c":"code","16259878":"code","104124eb":"code","f6409ac4":"code","9593fd60":"code","7b7088af":"code","68210fa5":"code","25771b87":"code","1ea4d7ac":"code","74da004e":"code","957bc78a":"markdown","60987bff":"markdown","5eea771b":"markdown","b9ab255b":"markdown","d9d14542":"markdown","705b5133":"markdown","57826aba":"markdown","d5154cb9":"markdown","15ce2680":"markdown","476fdd06":"markdown","72ffd224":"markdown","1d5d0747":"markdown","262056f6":"markdown","ba4edd82":"markdown","66d6be93":"markdown","368fe93c":"markdown","77a5ebdb":"markdown","53a26530":"markdown","8815b9b5":"markdown","0553d339":"markdown","07dd6cc6":"markdown","99745fd3":"markdown","75efd79e":"markdown","d870c824":"markdown","e19aa77c":"markdown","52b6568b":"markdown","7fc7f13c":"markdown"},"source":{"8cadd2b9":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\n#for dirname, _, filenames in os.walk('\/kaggle\/input'):\n #   for filename in filenames:\n  #      print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","666c79cb":"pd.set_option('display.max_columns',1000)\npath = '..\/input\/summer-research'\ndf_rc=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RC 03312020.txt',delimiter=\"\\t\")","93c50d40":"df_rc=df_rc.dropna(how='all',axis=1)\ndf_rc.head()","4bfa1c8e":"df_rc_totalasset=df_rc[['IDRSSD','RCFD2170','RCFD2948']]\ndf_rc_totalasset=df_rc_totalasset.dropna(how='all',thresh=3)\ndf_rc_totalasset=df_rc_totalasset.astype(float)\ndf_rc_totalasset.tail()","e37a76c9":"import matplotlib.pyplot as plt\nimport seaborn as sns\n\nsns.set(rc={\"figure.figsize\": (8, 6)}); \nsns.set(style=\"white\",palette='deep',color_codes=False)","1750926d":"df_rc_plot=df_rc_totalasset\ndf_rc_plot_log=df_rc_plot['RCFD2170'].astype(float).apply(np.log)  # Log asset\n#sns.kdeplot(data=df_rc_plot_log,label=\"Bank Total Asset\" ,shade=True)\n\n\nfig = plt.figure(figsize=(16,6))\nax1= fig.add_subplot(1,2,1)\nax2= fig.add_subplot(1,2,2)\nsns.kdeplot(df_rc_plot_log,shade=True,label='Log Bank Total Asset',ax=ax1)\nsns.kdeplot(df_rc_plot['RCFD2170'],label=\"Bank Total Asset\" ,shade=True,ax=ax2)\nsns.despine()","e207fd13":"import plotly.express as px\n#fig = px.histogram(cp, x=\"degree_p\", y=\"salary\", color=\"gender\")\nax1=px.histogram(df_rc_plot_log,width=600,height=450,title=\"Log Bank Total Asset\",histnorm='density')\n#fig.update_layout(\n #   autosize=False)#,paper_bgcolor=\"LightSteelBlue\")\n#fig.update_yaxes(automargin=True)\nax2=px.histogram(df_rc_plot['RCFD2170'],width=600,height=450,title=\"Bank Total Asset\",histnorm='density')\nax1.show()\nax2.show()\n","a05d056b":"df_rc_plot_log=pd.DataFrame(df_rc_plot_log)\ndf_rc_plot_log['IDRSSD']=df_rc_plot['IDRSSD']\nfig=px.scatter_polar(df_rc_plot_log, r=\"RCFD2170\", theta=\"IDRSSD\",color=\"IDRSSD\")\n#fig.update_layout(font_size=6)\nfig.show()","83e36fa2":"df_rc_plot['RCFD2170'].astype(float).describe()\nlog_sd_plus=1.851376e+08+4.525690e+08\nlog_sd_minus=1.851376e+08-4.525690e+08\nright=sum(np.where(df_rc_plot['RCFD2170'].astype(float)>log_sd_plus,1,0))\nleft=sum(np.where(df_rc_plot['RCFD2170'].astype(float)<log_sd_minus,1,0))\n(80-right-left)\/80","1519ddde":"df_rc_plot_log=df_rc_plot['RCFD2170'].astype(float).apply(np.log)\ndf_rc_plot_log.describe()\nlog_sd_plus=16.887587+2.541675\nlog_sd_minus=16.887587-2.541675\nright=sum(np.where(df_rc_plot_log>log_sd_plus,1,0))\nleft=sum(np.where(df_rc_plot_log<log_sd_minus,1,0))\n(80-right-left)\/80","627381de":"df_rc_plot_log_sort=sorted(df_rc_plot_log,reverse=True)\nTop_n_shares=np.cumsum(df_rc_plot_log_sort)\/sum(df_rc_plot_log_sort)\nfig = px.bar(Top_n_shares[0:10],title='Top 10 Share for Log Total Asset',width=600,height=400)\nfig.show()","e06592a8":"df_rc_plot_sort=sorted(df_rc_plot['RCFD2170'].astype(float),reverse=True)\nTop_n_shares=np.cumsum(df_rc_plot_sort)\/sum(df_rc_plot_sort)\nfig = px.bar(Top_n_shares[0:10],title='Top 10 Share for Total Asset',width=600,height=400)\nfig.show()","10fad26c":"import warnings\nwarnings.filterwarnings('ignore')","136d6dbe":"df_rce_totaldeposit=df_rc[['IDRSSD','RCON2200']]\ndf_rce_totaldeposit=df_rce_totaldeposit.drop(index=0).astype(float)\n#df_rce_totaldeposit=np.where(df_rce_totaldeposit==0,np.nan,df_rce_totaldeposit)\n#df_rce_totaldeposit=pd.DataFrame(df_rce_totaldeposit)\ndf_rce_totaldeposit_new=df_rce_totaldeposit.dropna(how='all',thresh=2)\ndf_rce_totaldeposit_new.columns=['IDRSSD','RCON2200']\ndf_asset_deposit=pd.merge(df_rc_totalasset,df_rce_totaldeposit_new,on='IDRSSD')\ndf_asset_deposit.tail()","662b3b6a":"fig_1=px.histogram(df_asset_deposit['RCON2200'].apply(np.log),width=600,height=450,title=\"Log Bank Total Deposit\",histnorm='density')\nfig_2=px.histogram(df_asset_deposit['RCON2200'],width=600,height=450,title=\"Bank Total Deposit\",histnorm='density')\nfig_1.show()\nfig_2.show()","8c813107":"df_loans=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RCH 03312020.txt',delimiter=\"\\t\")\ndf_totalloans=df_loans[['IDRSSD','RCONHT71']].dropna(how='all',thresh=2)\ndf_totalloans=df_totalloans.astype(float)\ndf_asset_deposit_loan=pd.merge(df_asset_deposit,df_totalloans,on='IDRSSD')\ndf_asset_deposit_loan.columns=['IDRSSD','Total Asset','Total Liabilities','Total Deposit','Total loans held for trading']\ndf_asset_deposit_loan.tail()","e3042036":"df_asset_deposit_loan['Total loans held for trading']=np.where(df_asset_deposit_loan['Total loans held for trading']>0,1,0)\ndf_asset_deposit_loan.tail()","96f8dc60":"px.scatter(df_asset_deposit_loan,x='Total Asset',y='Total Deposit',size='Total Liabilities',color='Total loans held for trading',width=800,trendline=\"ols\")","c40947bf":"df_asset_deposit_loan_log=df_asset_deposit_loan.copy()\ndf_asset_deposit_loan_log[['Total Asset','Total Liabilities','Total Deposit']]=df_asset_deposit_loan_log[['Total Asset','Total Liabilities','Total Deposit']].apply(np.log)\ndf_asset_deposit_loan_log.tail()\npx.scatter(df_asset_deposit_loan_log,x='Total Asset',y='Total Deposit',size='Total Liabilities',color='Total loans held for trading',width=800,trendline=\"ols\")","7df20904":"df_ci_loans=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RCCI 03312020.txt',delimiter=\"\\t\")\ndf_ci_loans_new=df_ci_loans[['IDRSSD','RCON1766']]\ndf_ci_loans_new=df_ci_loans_new.dropna(how='all',thresh=2)","fd541505":"df_deposit_loans=pd.merge(df_asset_deposit,df_ci_loans_new,on='IDRSSD',how='left')\ndf_deposit_loans.columns=['IDRSSD','Total Asset','Total Liabilities','Total Deposit','C&I Loans']\ndf_deposit_loans['IDRSSD']=df_deposit_loans['IDRSSD'].astype(float)\ndf_deposit_loans.tail()\n#px.scatter(df_deposit_loans,x='Total Deposit',y='C&I Loans',width=800)\ndf_deposit_loans.dropna(how='all',thresh=5)","6ca2b6be":"df_rc_totalasset.tail()","87385093":"pd.merge(df_rc_totalasset,df_ci_loans_new,on='IDRSSD',how='left')","25bbf813":"df_ci_loans_new[df_ci_loans_new['IDRSSD']==12311]","1033f528":"import seaborn as sns\ndf_RI=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RI 03312020.txt',delimiter=\"\\t\")\ndf_netincome=df_RI[['IDRSSD','RIAD4340']]\ndf_netincome.dropna(how='all',thresh=2,inplace=True)","ec78fd1f":"df_asset_deposit_loan_income_log=pd.merge(df_asset_deposit_loan_log,df_netincome,on='IDRSSD')\ndf_asset_deposit_loan_income_log.rename(columns={'RIAD4340':'Net Income'},inplace=True)\ndf_asset_deposit_loan_income_log['Net Income']=df_asset_deposit_loan_income_log['Net Income'].astype(float).apply(np.log)\ndf_asset_deposit_loan_income_log.tail()\n","49933150":"df_RCR=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RCRI 03312020.txt',delimiter=\"\\t\")\ndf_tier1=df_RCR[['IDRSSD','RCFAP742']].dropna(how='all',thresh=2)","2265df1d":"df_asset_deposit_loan_income_regulatory_log=pd.merge(df_asset_deposit_loan_income_log,df_tier1,on='IDRSSD')\ndf_asset_deposit_loan_income_regulatory_log.rename(columns={'RCFAP742':'Tier 1 Capital'},inplace=True)\ndf_asset_deposit_loan_income_regulatory_log['Tier 1 Capital']=df_asset_deposit_loan_income_regulatory_log['Tier 1 Capital'].astype(float).apply(np.log)\ndf_asset_deposit_loan_income_regulatory_log.tail()","7592fec7":"df_capital=df_rc[['IDRSSD','RCON3210']].dropna(how='all',thresh=2)\ndf_capital['RCON3210']=df_capital['RCON3210'].astype(float).apply(np.log)\ndf_capital.rename(columns={'RCON3210':'Total Equity Capital'},inplace=True)\npd.merge(df_asset_deposit_loan_income_regulatory_log,df_capital,on='IDRSSD')","5e352f8c":"sns.set(style=\"darkgrid\",palette='deep',color_codes=False)\ndf_plot=df_asset_deposit_loan_income_regulatory_log[['Total Asset','Total Liabilities','Total Deposit','Total loans held for trading','Net Income','Tier 1 Capital']]\nsns.pairplot(df_plot, hue=\"Total loans held for trading\", size=2, diag_kind=\"kde\")","16259878":"df_Deposit_Liabilities_foreign=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RCEII 03312020.txt',delimiter=\"\\t\")\ndf_Deposit_Liabilities_domestic=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RCEI 03312020.txt',delimiter=\"\\t\")","104124eb":"df_totaldomestic_deposit=df_Deposit_Liabilities_domestic[['IDRSSD','RCON2215']].dropna(thresh=2)\nprint(df_Deposit_Liabilities_foreign['RCFN2200'].dropna())\ndf_totalforeign_deposit=df_Deposit_Liabilities_foreign[['IDRSSD','RCFN2200']].dropna()\ndf_totalforeign_deposit.tail()","f6409ac4":"df_deposit_fd=pd.merge(df_totalforeign_deposit,df_totaldomestic_deposit,on='IDRSSD')\ndf_deposit_fd=df_deposit_fd.astype(float)\nprint(df_deposit_fd)\nprint(\"\\n\")\nprint(\"The number of zero in Foreign Deposit:\\n\")\nprint(len(df_deposit_fd[df_deposit_fd['RCFN2200']==0]))","9593fd60":"deposit_ftod_ratio=df_deposit_fd['RCFN2200']\/df_deposit_fd['RCON2215']\ndeposit_ftod_ratio=pd.DataFrame(deposit_ftod_ratio)\ndeposit_ftod_ratio['IDRSSD']=df_deposit_fd['IDRSSD']\ndeposit_ftod_ratio.columns=['Ratio','IDRSSD']\ndeposit_ftod_ratio.tail()","7b7088af":"#deposit_ftod_ratio=df_deposit_fd['RCFN2200']\/df_deposit_fd['RCON2215']\npx.bar(deposit_ftod_ratio['Ratio'],title='Foreign\/Domestic',width=600,height=400)","68210fa5":"fig=px.scatter_polar(deposit_ftod_ratio, r=\"Ratio\", theta=\"IDRSSD\",color=\"IDRSSD\")\nfig.show()","25771b87":"df_ci_loans_new.tail()","1ea4d7ac":"df_rcd=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RCD 03312020.txt',delimiter=\"\\t\")\ndf_mbs=df_rcd[['IDRSSD','RCFDG379','RCFDG380','RCFDG381','RCFDK197','RCFDK198']]\ndf_mbs.dropna(thresh=6).tail()","74da004e":"df_rcd=pd.read_csv(f'{path}\/FFIEC CDR Call Schedule RCD 03312020.txt',delimiter=\"\\t\")\ndf_rcd=df_rcd.dropna(how='all',axis=1)\ndf_mbs=df_rcd['RCFDG379']+df_rcd['RCFDG380']+df_rcd['RCFDG381']+df_rcd['RCFDK197']+df_rcd['RCFDK198']\n#df_mbs['IDRSSD']=df_rcd['IDRSSD']\n#df_mbs.dropna(how='all',thresh=2)","957bc78a":"Then, I select other commonly used variables, such as: \n\nNet Income, Regulatory Capital(Tier 1 Capital), Equity Capital","60987bff":"After Log Transformation:","5eea771b":"### Suggestions from these two questions:","b9ab255b":"It seems these 80 banks(selected according to the variable total asset) do not contain the data of C&I Loans.","d9d14542":"For question 1:\n\n* If we do not Log the bank total asset, we can see the US banking market is concentrated, since the total asset value of top 10 banks is 0.72. But the distribution of US banking market is dispersed. The density plot shows the distribution is right skewed and most of banks are below 5e8 total asset.\n* 80 banks have the value of total asset, meaning that our dataset has to be confined with these 80 banks.\n\nFor question 2:\n\n* From the scatter plot, I can see the positive correlation nearly in all the variables.\n* But there is a problem -- the limitation of \"Loans\", I can not find the suitable data considering \"Loans\". The bank call report does not include \"Total Loans\" and \"C&I Loans\" does not have the common part with other variables(e.g., If bank A has the data of total asset, then it does not have the data of C&I Loans). ","705b5133":"We can see here the number of banks that have the data of foreign deposit is 72. This number will decrease when we intersect foreign deposit and total asset(80 numbers).","57826aba":"## TODO-3:","d5154cb9":"### Top n shares","15ce2680":"### Mortage vs C&I:","476fdd06":"Variables:\n\n* RCON2215: TOTAL TRANSACTIONS ACCOUNTS\n* RCFN2200: TOTAL DEPOSITS","72ffd224":"## TODO-1:","1d5d0747":"But I do not find the common part of Total Equity Capital with the existing dataset. ","262056f6":"Variables:\n\n* RCONHT71: Total loans held for trading\n* RCON2200: Total Deposit\n* RCFD2170: Total Asset\n* RCON1766: C&I Loans\n* RCFD2948: Total Liabilities\n* RIAD4340: Net Income\n* RCFAP742: Tier 1 Capital\n* RCON3210: Total Equity Capital","ba4edd82":"> #### Density Plot","66d6be93":"### Foregin vs Domestic:","368fe93c":"Density plots\/histograms\/top n shares, of bank total assets. \n\nQuestions: \n* How concentrated is the US banking market?\n* What's the distribution of total assets across banks? (log total assets might be better behaved. What's the log SD?)\n* What are the top n share? i.e. sort banks by total assets, take cumsum(total assets) \/ sum(total assets), for top 10 banks.","77a5ebdb":"#### Merge Total Asset and Total Deposit:","53a26530":"The most confusing part of the dataset is the \"loans\". I can not find the suitable variable to represent \"loans\".\nIf I do not consider loans, the dataset can include 80 banks but here is only 56 banks.","8815b9b5":"It's quite strange to see loads of zero in loans. Since I do not find the variable called \"Total Loans\". Therefore, I use \"C&I Loans\" instead and in most previous studies they also use C&I loans. But it is so strange that I do not find a bank both has total asset and C&I loans.\n\nIf I do not consider the \"Loan\" variable, there are also 80 banks included in the data sample.","0553d339":"How well are different ``size'' metrics correlated?\n\nQuestions:\n* What are the size metrics? (deposits? loans? etc.)\n* Scatterplot these against each other (deposit vs total assets, loans vs total assets, etc.). Maybe do logs, as this will be better behaved","07dd6cc6":"### Density Plot","99745fd3":"Variables:\n\n* RCFDG300+G304+G308:  Mortgage-backed securities (MBS)\n* RCON1766: C&I Loans","75efd79e":"## TODO-2:","d870c824":"#### C&I Loans:","e19aa77c":"### Histograms","52b6568b":"#### Log :","7fc7f13c":"### Log SD(Standard Deviation)"}}