{"cell_type":{"a979e891":"code","48fc8262":"code","af9a101e":"code","ba1c1411":"code","4d887137":"code","88dbc308":"code","6298938c":"code","6a358015":"markdown","8ea5f013":"markdown","05391345":"markdown","c2612d84":"markdown","90945b0d":"markdown","ca0747bf":"markdown","3e7f0573":"markdown","eec95614":"markdown","bcd0eb84":"markdown"},"source":{"a979e891":"import pandas as pd\nimport numpy as np\nimport datatable as dt\n\nfrom sklearn.linear_model import LogisticRegression\n\nfrom sklearn.model_selection import KFold\nfrom sklearn.metrics import roc_auc_score","48fc8262":"catboost_oof = np.load('..\/input\/tps-nov-2021-catboost-301-w-oof\/oof_catboost.npz')['arr_0']\nxgboost_oof = np.load('..\/input\/tps-nov-2021-xgboost-301-w-oof\/oof_xgboost.npz')['arr_0']\nlgbm_oof = np.load('..\/input\/tps-nov-2021-lgbm-301-w-oof\/oof_lgbm.npz')['arr_0']","af9a101e":"train = dt.fread('..\/input\/tabular-playground-series-nov-2021\/train.csv').to_pandas()\ny = train['target']\ndel train","ba1c1411":"test_catboost = pd.read_csv(\"..\/input\/tps-nov-2021-catboost-301-w-oof\/submission_catboost_1.csv\")\ntest_xgboost = pd.read_csv(\"..\/input\/tps-nov-2021-xgboost-301-w-oof\/submission_xgboost_1.csv\")\ntest_lgbm = pd.read_csv(\"..\/input\/tps-nov-2021-lgbm-301-w-oof\/submission_lgbm_1.csv\")","4d887137":"stack_x_train = pd.DataFrame({'x': catboost_oof, 'y': xgboost_oof, 'z': lgbm_oof})\nstack_x_test = pd.DataFrame({'x': test_catboost.target, 'y': test_xgboost.target, 'z': test_lgbm.target})","88dbc308":"folds = KFold(n_splits = 5, random_state = 102021, shuffle = True)\n\npredictions = np.zeros(len(stack_x_test))\nlr_oof = np.zeros(stack_x_train.shape[0])\n\nfor fold, (trn_idx, val_idx) in enumerate(folds.split(stack_x_train)):\n\n    X_train, X_test = stack_x_train.iloc[trn_idx], stack_x_train.iloc[val_idx]\n    y_train, y_test = y.iloc[trn_idx], y.iloc[val_idx]\n\n    model = LogisticRegression(n_jobs = -1, random_state = 102021, C = 5, max_iter = 2000)\n    print(f\"model fit started for Fold: {fold}\")\n    model.fit(X_train, y_train)\n    pred = model.predict_proba(X_test)[:,1]\n    lr_oof[val_idx] = pred\n    roc = roc_auc_score(y_test, pred)\n    print(f\" roc_auc_score: {roc}\")\n    print(\"-\"*50)\n    \n    predictions += model.predict_proba(stack_x_test)[:,1] \/ folds.n_splits ","6298938c":"sub = dt.fread('..\/input\/tabular-playground-series-nov-2021\/sample_submission.csv').to_pandas()\nsub['target'] = predictions\nsub.to_csv(f'submission_stacking_201_1.csv',index = False)\nnp.savez_compressed('oof_stacking_201.npz', lr_oof)","6a358015":"# Imports","8ea5f013":"# Load OOF stored by following notebooks\n\n1. https:\/\/www.kaggle.com\/aayush26\/tps-nov-2021-catboost-301-w-oof\n2. https:\/\/www.kaggle.com\/aayush26\/tps-nov-2021-xgboost-301-w-oof\n3. https:\/\/www.kaggle.com\/aayush26\/tps-nov-2021-lgbm-301-w-oof\/ ","05391345":"# Concatenate train OOFs and test predictions to make train and test data set respectively","c2612d84":"![Ensemble stacking.jpg](attachment:b16cdc90-5e63-49cc-b2c3-b1f3fe847b4e.jpg)","90945b0d":"# Ensemble Model Architecture","ca0747bf":"# Load test predictions from catboost, lgbm and xgboost and use as features in level 2","3e7f0573":"# Store submission and oof","eec95614":"# Load train set to use only the target column","bcd0eb84":"# 5-fold model training and prediction"}}