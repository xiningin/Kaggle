{"cell_type":{"ffb0fc5e":"code","783eae59":"code","9fe427c9":"code","c1aa5633":"code","8f36e274":"code","0b886bfc":"code","aea2b534":"code","4c1a58f2":"markdown","bde035d9":"markdown","d8a7e110":"markdown"},"source":{"ffb0fc5e":"import pandas as pd\nfrom zipfile import ZipFile\nimport matplotlib.pyplot as plt\nimport statsmodels.api as sm\nimport datetime as dt\n","783eae59":"#Download the Crude Oil Trends\ndata = pd.read_csv(\"..\/input\/ntt-data-global-ai-challenge-06-2020\/Crude_oil_trend_From1986-01-02_To2020-06-15.csv\", parse_dates=[\"Date\"])\n#Convert Date column to date format\ndata[\"Date\"] = pd.to_datetime(data[\"Date\"])\n# Setting Index for efficient data access\ndata.set_index(\"Date\", inplace=True)\n\n#Create a List with Dates from 1-Apr to 21- Aug. We are predicting from 1-Apr to check accuracy\nDate1 = pd.date_range('2020-04-01', periods=146, freq='D')\n\n#Create frame Test2 with future dates.  \ncolumns = ['Date','Price']    \nTest2 = pd.DataFrame(columns=columns)\nTest2['Price'] = pd.to_numeric(Test2['Price'])\nTest2[\"Date\"] = pd.to_datetime(Date1)\nTest2 = Test2.fillna(0)\n#Remove Weekends as in source data and store data frame as Test1 results to be loaded in Test 1\nTest1 = Test2[Test2[\"Date\"].dt.weekday < 5]\nTest1[\"Date\"] = pd.to_datetime(Test1[\"Date\"])\nTest1['Price'] = pd.to_numeric(Test1['Price'])\n#Test1.set_index(\"Date\", inplace=True)\n#Test2 = Test2.fillna(0)\n#print(Test1)\nprint(Test1.head(n=20))\nprint(Test1.tail(n=20))\n","9fe427c9":"## data75 = data.rolling(window=75).mean().dropna()\ntrain = data[:\"2020-04-30\"]\ntest = data[\"2020-05-01\":]\n","c1aa5633":"#Visualize Data in a line Graph notice the Deep drop in price from Mar-2020 due to Corona.\ntrain[\"2017-01-01\":].plot()\ntest.plot()\nplt.show()\n","8f36e274":"#View the Seasonality and Trend.\ndecomposition = sm.tsa.seasonal_decompose(train, model='addititve', period=7)\nfig = decomposition.plot()\nplt.show()","0b886bfc":"# Using Auto-Regression approach\nfrom statsmodels.tsa.ar_model import AutoReg\nfrom pandas.plotting import lag_plot\nmodel = AutoReg(train, lags=30, trend=\"c\").fit()\nyhat = model.predict(train.shape[0], train.shape[0]+test.shape[0]-1  )\nres=pd.DataFrame({\"Date\":test.index,\"Pred\":yhat, \"Act\":test[\"Price\"].values})\nres.set_index(\"Date\", inplace=True)\nres[\"Act\"].plot(label=\"Act\")\nres[\"Pred\"].plot(label=\"Pred\")\nplt.title(\"Actual vs. Predicted\")\nplt.legend()\nplt.show()\nprint(\"RMSE\",mean_squared_error(res[\"2020-05-01\":][\"Act\"], res[\"2020-05-01\":][\"Pred\"]))","aea2b534":"# Using Auto-Regression approach\nfrom statsmodels.tsa.ar_model import AutoReg\nfrom pandas.plotting import lag_plot\n# fit model\nmodel = AutoReg(train, lags=30).fit()\n#print(model.summary())\n# make prediction for April 2020 and compare with Real data the difference is less than 1$\nyhat = model.predict(train.shape[0], train.shape[0]+  )\nres=pd.DataFrame({\"Date\":test[\"2020-04-01\":\"2020-04-30\"].index,\"Pred\":yhat, \"Act\":test[\"2020-04-01\":\"2020-04-30\"][\"Price\"].values})\n#print(res)\n\n#making Prediction from July to August 2020\nyhat = model.predict(train.shape[0], train.shape[0]+146 )\nyhat = pd.to_numeric(yhat)\n#print(yhat.reset_index(drop=True))\n#STore prediction in Test1\nTest1[\"Price\"] = yhat.reset_index(drop=True)\n#print(Test1[Test1['Date']>\"2020-07-15\"])\n#Removing date below 16-Jul-2020\nTest2 = Test1[Test1['Date']>\"2020-07-15\"]\n#Print Result in CSV file\nTest2.to_csv('\/kaggle\/working\/Submission_future.csv', index=False)\nTest3 = Test1[Test1['Date']>\"2020-04-28\"]\nTest3 = Test3[Test3['Date']<\"2020-08-22\"]\nprint(Test3)\nTest3.to_csv('\/kaggle\/working\/Submission_old.csv', index=False)\n  \n\n\n","4c1a58f2":"# Download results\n\nWe are using Time-series modeling to predict the WTI by determing seasonality and flutuation.\n\nTo get the solution click on the \"Copy & Edit\" button on right hand corner and click Run All. The solution will be present in the \/Kaggle\/Working directory which you can download. In case you have any new ideas do share with me I will try to incorporate","bde035d9":"# We are downloading the packages to use in our code.\nPandas - Data frame manipulation\nMatplotlib - Draw graphs\nstatsmodels.api - to run the model","d8a7e110":"# WTI Crude Oil Prediction - Complete solution\nWhat is the issue ?\nWTI is the West Texas Intermediate is the price of Crude oil drilled from USA. WTI and Brent which is used by OPEC countries is the standard to measure Crude Oil prices world over. The situation is now complicated with reduced demand and increased supply. Previously Crude oil used to be primarily sourced from OPEC and USA produced oil only for its consumption. Now with the advent of Shale drilling Technique USA is able to produce more oil than Saudi Arabia the primary produced of Crude. This has triggered an Economic war where OPEC, USA and Russia want to out produce each other. Shale producers are not having deep pockets like OPEC which is sitting on huge cash dump. But the added complication is Saudi depends on only oil to run its economy and has no other sources of income prolonged low prices could affect their economy greatly compared to Russia and USA which have other sources of Income. On the demand side too India and China the top importers have temporarily shutdown due to Corona and their pull also affects the Price.\n\n\n"}}