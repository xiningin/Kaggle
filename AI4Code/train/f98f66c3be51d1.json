{"cell_type":{"a8a00be9":"code","939c2143":"code","8f7c2b71":"code","ff960230":"code","0423df86":"code","0e801041":"code","fff90f00":"code","823df0e8":"code","93e7f28d":"code","2fd58c19":"code","d4d3a3b6":"code","ff93e7d3":"code","a3272de7":"code","676c4656":"markdown","39ec1852":"markdown","ceb40c60":"markdown","b4f51ce6":"markdown","503a0725":"markdown","c9fc08ae":"markdown","b110b8b2":"markdown","d513df4f":"markdown","fac72d69":"markdown","e203764c":"markdown","d63a9e1f":"markdown","3c166f5d":"markdown","de73ad0f":"markdown","d7402a8f":"markdown","a2b6bc3e":"markdown","54991da5":"markdown","58ba13ef":"markdown"},"source":{"a8a00be9":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport ast\nimport plotly\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nimport plotly.figure_factory as ff\nimport plotly.graph_objs as go\nfrom plotly.graph_objs import *\nfrom geopy.geocoders import Nominatim\nimport os\nimport re\nimport random\ninit_notebook_mode()\nprint(\"Buyouts Files:\\n\")\nprint('\\t\\n'.join(['\\t' + x for x in os.listdir(\"..\/input\/sf-buyout-agreements\/\")]))\nprint(\"\\n\")\nprint(\"Crimes Files:\\n\")\nprint('\\n'.join(['\\t' + x for x in os.listdir(\"..\/input\/sf-police-calls-for-service-and-incidents\/\")]))","939c2143":"def prep_data(buyout_df):\n    buyout_df.set_index('Case Number', inplace=True)\n    buyout_df[\"pre_buyout_disclsure_date\"] = pd.to_datetime(buyout_df['Pre Buyout Disclosure Date'], infer_datetime_format=True)\n    buyout_df[\"buyout_agreement_date\"] = pd.to_datetime(buyout_df['Buyout Agreement Date'], infer_datetime_format=True)\n    buyout_df[\"latitude\"] = buyout_df[\"the_geom\"].apply(lambda x:ast.literal_eval(x)[\"latitude\"])\n    buyout_df[\"longitude\"] = buyout_df[\"the_geom\"].apply(lambda x:ast.literal_eval(x)[\"longitude\"])\n    buyout_df[\"delta_dates\"] = buyout_df[\"buyout_agreement_date\"] - buyout_df[\"pre_buyout_disclsure_date\"]\n    buyout_df.drop([\"Pre Buyout Disclosure Date\", \"Buyout Agreement Date\", \"the_geom\"], inplace=True, axis=1)\n    return buyout_df\n\ndef prep_crime_data(df):\n    df.set_index('Crime Id', inplace=True)\n    df[\"Address\"] = df[\"Address\"].apply(lambda x:x.replace(\"Block Of\", \"\") + \" San Francisco California\")\n    df[\"Address\"] = df[\"Address\"].apply(lambda x:re.sub(r'\\d+ ', '', x))\n    df[\"Call_Date\"] = pd.to_datetime(df['Call Date'], infer_datetime_format=True)\n    df[\"Offense_Date\"] = pd.to_datetime(df['Offense Date'], infer_datetime_format=True)\n    df[\"Report_Date\"] = pd.to_datetime(df['Report Date'], infer_datetime_format=True)\n    df.drop(columns=[\"City\", \"State\", 'Call Date', 'Offense Date', 'Report Date'], inplace=True)\n    return df\n\ndef decode(street):\n    geolocator = Nominatim(user_agent=\"Meow\")\n    location = geolocator.geocode(street)\n    return (location.latitude, location.longitude) if location is not None else (None, None)","8f7c2b71":"buyout = prep_data(pd.read_csv('..\/input\/sf-buyout-agreements\/buyout-agreements.csv'))\nbuyout.head(5)","ff960230":"crimes = prep_crime_data(pd.read_csv('..\/input\/sf-police-calls-for-service-and-incidents\/police-department-calls-for-service.csv'))\ncrimes.head(5)","0423df86":"hist_data = [buyout[\"Number of Tenants\"]]\ngroup_labels = ['Number of Tenants']\nfig = ff.create_distplot(hist_data, group_labels)\niplot(fig, filename='Basic Distplot')","0e801041":"lst_tuples = list(zip(buyout[\"Analysis Neighborhood\"].values, list(buyout[\"Analysis Neighborhood\"].groupby(by=buyout[\"Analysis Neighborhood\"].values, axis=0).count())))\nlst_tuples.sort(key=lambda tup: tup[1], reverse=True)\nstreets_names = [x[0] for x in lst_tuples]\ncount_streets = [x[1] for x in lst_tuples]\ntrace1 = {\n  \"y\": count_streets, \n  \"x\": streets_names, \n  \"marker\": {\"color\": \"rgb(100, 100, 5)\"}, \n  \"type\": \"bar\"\n}\nlayout = {\n  \"title\": \"Neighborhood Buyout Frequency\", \n  \"xaxis\": {\n    \"tickfont\": {\"size\": 12}, \n    \"title\": \"Street\"\n  }, \n  \"yaxis\": {\n    \"title\": \"Frequency <br>\", \n    \"titlefont\": {\"size\": 12}\n  }\n}\nfig = Figure(data=[trace1], layout=layout)\niplot(fig, filename='Street Count Plot')\n","fff90f00":"labels = ['True','False']\nvalues = [buyout[buyout[\"Other Consideration\"] == True].dropna().count().iloc[0], buyout[buyout[\"Other Consideration\"] == False].dropna().count().iloc[0]]\n\ntrace = go.Pie(labels=labels, values=values)\n\niplot([trace], filename='Other Consideration')","823df0e8":"data = [\n    {\n        'x': buyout[\"Number of Tenants\"],\n        'y': buyout[\"Buyout Amount\"],\n        'name':'kale',\n        'marker': {\n            'color': '#5647b7'\n        },\n        'boxmean': False,\n        'orientation': 'v',\n        \"type\": \"box\"\n    }\n]\nlayout = {\n    'xaxis': {\n        'title': 'Number of Tenants',\n        'zeroline': False,\n    },\n    'yaxis': {\n        'title': 'Buyout Amount',\n        'zeroline': False,\n    },\n    'boxmode': 'group',\n}\nfig = go.Figure(data=data, layout=layout)\niplot(fig)","93e7f28d":"hist_data = [buyout[\"delta_dates\"].apply(lambda x:x.days).dropna()]\ngroup_labels = ['Time Delta Between Pre-Buyout to Buyout(in days)']\nfig = ff.create_distplot(hist_data, group_labels, bin_size=7)\niplot(fig, filename='Basic Distplot')","2fd58c19":"hist_data = [buyout[\"Buyout Amount\"].dropna()]\ngroup_labels = ['Buyout Amount']\nfig = ff.create_distplot(hist_data, group_labels, bin_size=10000)\niplot(fig, filename='Meow')","d4d3a3b6":"temp = crimes.groupby(by=\"Address\", as_index=False).count().nlargest(25, 'Agency Id')\ntuples = temp[\"Address\"].apply(decode)\ntemp[\"lan\"] = [x[0] for x in tuples]\ntemp[\"lon\"] = [x[1] for x in tuples]","ff93e7d3":"data = [\n    go.Scattermapbox(\n        lat=buyout[\"latitude\"],\n        lon=buyout[\"longitude\"],\n        mode='markers',\n        name=\"Buyouts\",\n        marker=dict(\n            size = buyout['Buyout Amount'].apply(lambda x: int(x\/20000) + 4 if not pd.isnull(x) else 0),\n            color='rgb(35, 5, 112)',\n            opacity=0.7\n        ),\n        text= buyout[\"Buyout Amount\"].apply(lambda x: \"{:,}$\".format(x))\n    ),\n    go.Scattermapbox(\n        lat=temp[\"lan\"],\n        lon=temp[\"lon\"],\n        mode='markers',\n        name=\"Crimes\",\n        marker=dict(\n            size = temp['Agency Id'].apply(lambda x: int(x\/500) + 4 if not pd.isnull(x) else 0),\n            color='rgb(153, 55, 73)',\n            opacity=0.5\n        ),\n        text= temp.apply(lambda x: \"{:,} Crimes Committed \\n Street: {}\".format(x[\"Agency Id\"], x[\"Address\"]), axis=1)\n    )\n]\n\nlayout = go.Layout(\n    autosize=True,\n    hovermode='closest',\n    title=\"Buyouts With Top 25 Worst Streets\", \n    mapbox=dict(\n        accesstoken=\"pk.eyJ1Ijoic3luY3VzaCIsImEiOiJjam05aTEyNHUwMDNnM3JscjRvODFuMDY1In0.Iw54eGGxr-h70qh86bMFjA\",\n        bearing=0,\n        center=dict(\n            lat=37.773972,\n            lon=-122.431297\n        ),\n        pitch=0,\n        zoom=10\n    ),\n)\n\nfig = dict(data=data, layout=layout)\niplot(fig, filename='Multiple Mapbox')","a3272de7":"r = lambda: random.randint(0,255)\ndata = []\nlst_tuples = list(zip(buyout[\"Analysis Neighborhood\"].values, list(buyout[\"Analysis Neighborhood\"].groupby(by=buyout[\"Analysis Neighborhood\"].values, axis=0).count())))\nlst_tuples.sort(key=lambda tup: tup[1], reverse=True)\nstreets_names = [x[0] for x in lst_tuples]\nfor neighborhood in streets_names[:5]:\n    temp = buyout[buyout[\"Analysis Neighborhood\"] == neighborhood].sort_values(by=\"buyout_agreement_date\")\n    trace_high = go.Scatter(\n        x=temp[\"buyout_agreement_date\"],\n        y=temp[\"Buyout Amount\"],\n        name = neighborhood,\n        line = dict(color = '#%02X%02X%02X' % (r(),r(),r())),\n        opacity = 0.8)\n    data.append(trace_high)\n\nlayout = dict(\n    title='Top 5 Most Buyouts Neighborhoods',\n    xaxis=dict(\n        rangeselector=dict(\n            buttons=list([\n                dict(count=1,\n                     label='1m',\n                     step='month',\n                     stepmode='backward'),\n                dict(count=6,\n                     label='6m',\n                     step='month',\n                     stepmode='backward'),\n                dict(step='all')\n            ])\n        ),\n        rangeslider=dict(\n            visible = True\n        ),\n        type='date'\n    )\n)\n\nfig = dict(data=data, layout=layout)\niplot(fig, filename = \"Time Series with Rangeslider\")","676c4656":"# Analysis <a id=\"4\"><\/a>\n----------------------------------","39ec1852":"## Buyout Distribution","ceb40c60":"## Buyouts","b4f51ce6":"## Crimes","503a0725":"## Time Delta Between Pre-Buyout Disclousre to Buyout Distribution (In days)","c9fc08ae":"# Your Constructive Criticism is Welcome\n----------------------------------\n## I am a newbie and I have big passion towards data science !\n\n## Any little piece of advice means a lot to me !","b110b8b2":"# Packages Import & Util Functions <a id=\"2\"><\/a>\n-----------------------\n## Packages Import","d513df4f":"# Table of Contents\n-----------------------------------\n1. [ Introduction ](#1)\n2. [Packages Import & Util functions ](#2)\n3. [Data Import  & Data Head](#3)\n4. [Analysis](#4)","fac72d69":"## Buyout Amount With Respect to Number of Tenants","e203764c":"# Data Import  & Data Head <a id=\"3\"><\/a>\n----------------------------------------","d63a9e1f":"## Number of Tenants Distribution","3c166f5d":"## Neighborhoods Buyout Count","de73ad0f":"## Other Consideration Distribution","d7402a8f":"## Top 5 Wanted Neighborhoods (Most Buyouts)","a2b6bc3e":"## Util Functions","54991da5":"## Buyouts on a Map With the Top 25 Worst Streets","58ba13ef":"## Introduction <a id=\"1\"><\/a>\n-----------------------------\n > San Francisco (SF; \/\u02ccs\u00e6n fr\u0259n\u02c8s\u026asko\u028a, fr\u00e6n-\/, Spanish for 'Saint Francis'; Spanish: [san fran\u02c8sisko]), officially the City and County of San Francisco, is the cultural, commercial, and financial center of Northern California. San Francisco is the 13th most populous city in the United States, and the 4th most populous in California, with 884,363 residents as of 2017.[18] It covers an area of about 46.89 square miles (121.4 km2),[19] mostly at the north end of the San Francisco Peninsula in the San Francisco Bay Area, making it the second most densely populated large US city, and the fifth most densely populated U.S. county, behind only four of the five New York City boroughs. San Francisco is also part of the fifth most populous primary statistical area in the United States, the San Jose\u2013San Francisco\u2013Oakland, CA Combined Statistical Area (8.8 million residents).\n \n![SF Golden Bridge](https:\/\/wallpapersite.com\/images\/pages\/pic_w\/13339.jpg) \n\n\n\n## Skyline\n![SF SkyLine](https:\/\/i.ytimg.com\/vi\/C9J1p6kO9VA\/maxresdefault.jpg)\n\n## Districts\n![North Districts](http:\/\/mapsof.net\/uploads\/static-maps\/districts_map_of_San_Francisco.jpg)\n \n"}}