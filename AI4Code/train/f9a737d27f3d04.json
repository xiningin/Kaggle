{"cell_type":{"cf426bec":"code","095dc48e":"code","8f9f5518":"code","2640f8ce":"code","20eb3ad8":"code","10a1160c":"code","18998c16":"code","c53b6db2":"code","644b1454":"code","bd885ccd":"code","aa37464b":"code","db1d5ff6":"code","04194045":"code","5fc78a6c":"markdown","4b216e04":"markdown","c5ffa04f":"markdown","21a314d4":"markdown","0f7e2726":"markdown"},"source":{"cf426bec":"from PIL import Image \nImage.open(\"..\/input\/rfmpict\/rfm.png\")","095dc48e":"!pip install openpyxl\nimport datetime as dt\nimport pandas as pd\nimport numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\npd.set_option('display.float_format', lambda x: '%.5f' % x)\n\ndf_=pd.read_excel(\"..\/input\/online-retail-ii-x\/online_retail_II.xlsx\", sheet_name=\"Year 2010-2011\")\ndf=df_.copy()","8f9f5518":"df.head()","2640f8ce":"#An overview of the data\n\ndef check_df(dataframe, head=5):\n    print(\"################ Shape #####################\")\n    print(dataframe.shape)\n    print(\"################ Types #####################\")\n    print(dataframe.dtypes)\n    print(\"################ Head ######################\")\n    print(dataframe.head(head))\n    print(\"################ Tail ######################\")\n    print(dataframe.tail(head))\n    print(\"################ NA ########################\")\n    print(dataframe.isnull().sum())\n    print(\"################ Describe ##################\")\n    print(dataframe.describe().T)\ncheck_df(df)\n","20eb3ad8":"#let's find the missing data and delete it permanently\ndf.isnull().sum()   \ndf.dropna(inplace=True)","10a1160c":"#Let's see the 10 most ordered products\nm=df.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).sort_values(by=\"Quantity\", ascending=False).head(10)\nm","18998c16":"#Let's exclude canceled orders from the data.\ndf= df[~df[\"Invoice\"].str.contains(\"C\", na=False)]\n\n#Let's create a total price variable consisting of the product of price and quantity\ndf[\"TotalPrice\"]=df[\"Price\"] * df[\"Quantity\"]","c53b6db2":"#Let's define RFM metrics\n\ndf[\"InvoiceDate\"].max() #The date on which the analysis should be performed.\ntoday_date = dt.datetime(2011, 12, 11)\n\nrfm= df.groupby(\"Customer ID\").agg({'InvoiceDate': lambda date: (today_date - date.max()).days,\n                                    'Quantity': lambda num: num.nunique(),\n                                    'TotalPrice': lambda price: price.sum()})\n\nrfm.columns = ['recency', 'frequency', \"monetary\"]\nrfm = rfm[(rfm['monetary'] > 0)] \nrfm.head()","644b1454":"#Let's create RFM scores\n\nrfm[\"recency_score\"]=pd.qcut(rfm[\"recency\"],5, labels=[5,4,3,2,1])\nrfm[\"frequency_score\"]=pd.qcut(rfm[\"frequency\"].rank(method=\"first\"),5, labels=[1,2,3,4,5])\nrfm[\"monetary_score\"]=pd.qcut(rfm[\"monetary\"],5, labels=[1,2,3,4,5])\n\nrfm[\"RFM_SCORE\"]=(rfm[\"recency_score\"].astype(str)+rfm[\"frequency_score\"].astype(str))\nrfm.head()","bd885ccd":"#Creation of segments of RFM scores\n\nseg_map = {\n    r'[1-2][1-2]': 'hibernating',\n    r'[1-2][3-4]': 'at_Risk',\n    r'[1-2]5': 'cant_loose',\n    r'3[1-2]': 'about_to_sleep',\n    r'33': 'need_attention',\n    r'[3-4][4-5]': 'loyal_customers',\n    r'41': 'promising',\n    r'51': 'new_customers',\n    r'[4-5][2-3]': 'potential_loyalists',\n    r'5[4-5]': 'champions'\n}\n\nrfm[\"segment\"] = rfm[\"RFM_SCORE\"].replace(seg_map, regex=True)\nrfm[[\"segment\", \"recency\", \"frequency\", \"monetary\"]].groupby(\"segment\").agg([\"mean\", \"count\"])","aa37464b":"#Let's see our loyal customers indexes\nrfm[rfm[\"segment\"] == \"loyal_customers\"].index\n","db1d5ff6":"#Let's see the total returns of the segments\nsegment_monetary=rfm.groupby(\"segment\").agg({\"monetary\":\"sum\"})\nsegment_monetary.reset_index()","04194045":"import seaborn as sns\nsns.catplot(x=\"monetary\", y=\"segment\", data=rfm);\n           ","5fc78a6c":"**Preparation**","4b216e04":"As a result, in this study, RFM analysis was performed based on purchases data belonging to the customers of a company. According to the results of the analysis, comments were made. With these and similar studies, customer-specific decisions can be made and company profitability can be increased.","c5ffa04f":"**Business Problem**\n\nAn e-commerce company divides its customers into segments and this determining marketing strategies by segments he wants.The company has customer segments that exhibit common behaviors in particular, the increase in revenue from doing marketing work he thinks that it will provide. For example, to retain customers who are very profitable for the company\ndifferent campaigns for new customers, different it is desirable to organize campaigns.\n\n**Story of Dataset**\n\nThe data set called Online Retail II is an online sale based in the UK\nsales of the store from 01\/12\/2009 to 9\/12\/2011.\nSouvenirs are included in the product catalog of this company.\nThe vast majority of the company's customers are corporate customers.\n\n**Variables**\n\n* Invoicename: Invoice number (If this code starts with C, it means that order has been canceled.)\n* Stock Code: Product code (Its a unique trick for a product.)\n* Description: Product name\n* InvoiceDate: Invoice date\n* Unit Price: Fetura price \n* Customer ID: Unique customer number\n* Country: Country name","21a314d4":"As can be seen in the table above, there are 1021 customers in the hibernating segment. And it has the largest number of customers. It has been 211 days since those in this segment became the company's customers, and their purchase frequency is 4.85 days. Their average return is 488 pound. For those in this segment, the marketing department can develop a strategy. For example, their purchase tendency can be increased by giving them a special promotion. Or emails may be sent reminding you of the company and products.\n\nAgain, if we look at the loyal_customers segment, there are 811 customers here. Those in this segment have logged in to customer records an average of 34 days ago. Their frequency of purchase is 14.5 days. Their average return is 2885 pound.\n\nIf we look at the recent champions segment, there are 591 customers here. It has been 6.41 days since those in this segment became customers. Their frequency of purchase is 17.38 days. For champions with an average return of 7183 pound, the discount policy can be followed for their purchases so far and special discounts can be made for them.","0f7e2726":"# **Customer Segmantation with RFM **\n\nRFM stands for Recency, Frequency, and Monetary value. \nThe RFM model implies analyzing past transactional data and \nusing that research to identify different segments of customers based on their purchase history.\n\n* Recency \u2013 How recent was a customer\u2019s latest purchase from you?\n* Frequency \u2013 How often does a customer purchase from you?\n* Monetary \u2013 How much does a customer usually spend?\n\nNow that we know RFM, Let's do a practise\n\n\n"}}