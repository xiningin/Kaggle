{"cell_type":{"629eb326":"code","b905adec":"code","c87af6bf":"code","46f7d9f1":"code","3062fe4f":"code","edba0b6e":"code","359b33c3":"code","7b51ce47":"code","de6993a7":"code","4c3c1232":"code","482c9c96":"code","472c16cd":"code","81d1ebfa":"code","39f234cf":"code","103ce668":"code","763d5568":"markdown","4003c957":"markdown","7601a4a0":"markdown","2dcec380":"markdown","e83b6ff9":"markdown"},"source":{"629eb326":"# packages\n\n# standard\nimport numpy as np\nimport pandas as pd\nimport time\n\n# plots\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport seaborn as sns","b905adec":"# show files\n!ls -l ..\/input\/*","c87af6bf":"# select file\nmy_file = 'g.csv'","46f7d9f1":"# load \/ preview\nt1 = time.time()\ndf = pd.read_csv('..\/input\/benchmark-labeled-anomaly-detection-ts\/' + my_file)\nt2 = time.time()\nprint('Elapsed time [s]:', np.round(t2-t1,4))\ndf.head()","3062fe4f":"# structure of data frame\ndf.info()","edba0b6e":"# frequencies\nprint('Absolute Frequencies:')\nprint(df.label.value_counts())\nprint()\nprint('Relative Frequencies:')\nprint(df.label.value_counts(normalize=True))","359b33c3":"# add smoothing of values\nwin_size = 15\ndf['smoothed'] = df.value.rolling(center=True, window=win_size, min_periods=1).mean()\n# add difference of actual value and smoothed valued\ndf['diff_val_sm'] = df.value - df.smoothed\n# preview\ndf.head(10)","7b51ce47":"# extract labeled anomalies\ndf_a = df[df.label==1]","de6993a7":"# plot smoothing effect\ndf_zoom = df[2000:2200]\ndf_zoom_a = df_zoom[df_zoom.label==1]\n\nplt.figure(figsize=(16,6))\nplt.scatter(df_zoom.timestamp, df_zoom.value, \n            s=10, alpha=1, label='original')\nplt.scatter(df_zoom.timestamp, df_zoom.smoothed, \n            c='green',\n            s=10, alpha=1, label='smoothed')\nplt.scatter(df_zoom_a.timestamp, df_zoom_a.value, \n            c='magenta',\n            s=10, label='anomalies')\nplt.legend()\nplt.grid()\nplt.show()","4c3c1232":"# plot differences from smoothed value\ndf_zoom = df[2000:2200]\ndf_zoom_a = df_zoom[df_zoom.label==1]\n\nplt.figure(figsize=(16,6))\nplt.scatter(df_zoom.timestamp, df_zoom.diff_val_sm, \n            s=10, alpha=1)\nplt.scatter(df_zoom_a.timestamp, df_zoom_a.diff_val_sm, \n            c='magenta',\n            s=10)\nplt.grid()\nplt.show()","482c9c96":"# plot full time series + anomalies\nplt.figure(figsize=(16,6))\nplt.scatter(df.timestamp, df.value, \n            s=10, alpha=0.1)\nplt.scatter(df_a.timestamp, df_a.value, \n            c='magenta',\n            s=10)\nplt.grid()\nplt.show()","472c16cd":"# plot difference value vs smoothed value for full time series\nplt.figure(figsize=(16,6))\nplt.scatter(df.timestamp, df.diff_val_sm, \n            s=10, alpha=0.1)\nplt.scatter(df_a.timestamp, df_a.diff_val_sm, \n            c='magenta',\n            s=10)\nplt.grid()\nplt.show()","81d1ebfa":"# split into parts\nchunk_size = 10000\n\nn = df.shape[0]\nm = int(np.floor(n\/chunk_size))\n\nprint('Decomposing series in ' + str(m) + ' parts')","39f234cf":"# plot piecewise\nfor i in range(m+1):\n    n1 = i*chunk_size\n    n2 = min(n1 + chunk_size - 1, n)\n    df_zoom = df[n1:n2]\n    df_zoom_a = df_zoom[df_zoom.label==1]\n    my_title = 'Original Time Series \/ Part ' + str(i+1) + ' - Row ' + str(n1) + ' to ' + str(n2)\n    # plot\n    plt.figure(figsize=(16,4))\n    plt.scatter(df_zoom.index, df_zoom.value, alpha=0.2)\n    plt.scatter(df_zoom_a.index, df_zoom_a.value, c='magenta')\n    plt.title(my_title)\n    plt.grid()\n    plt.show()","103ce668":"# same for difference value vs smoothed value\nfor i in range(m+1):\n    n1 = i*chunk_size\n    n2 = min(n1 + chunk_size - 1, n)\n    df_zoom = df[n1:n2]\n    df_zoom_a = df_zoom[df_zoom.label==1]\n    my_title = 'Time Series Diff vs Smoothed \/ Part ' + str(i+1) + ' - Row ' + str(n1) + ' to ' + str(n2)\n    # plot\n    plt.figure(figsize=(16,4))\n    plt.scatter(df_zoom.index, df_zoom.diff_val_sm, alpha=0.2)\n    plt.scatter(df_zoom_a.index, df_zoom_a.diff_val_sm, c='magenta')\n    plt.title(my_title)\n    plt.grid()\n    plt.show()","763d5568":"<a id='3'><\/a>\n# Visualize time series piecewise","4003c957":"### Check frequency of anomalies","7601a4a0":"<a id='2'><\/a>\n# Visualize full time series","2dcec380":"<a id='1'><\/a>\n# Smoothing","e83b6ff9":"## Work in Progress..."}}