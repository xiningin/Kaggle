{"cell_type":{"cf55c17c":"code","19d8ea32":"code","26704f7c":"code","0c1339b3":"code","b70a8cf6":"code","b96c9981":"code","66cde9e7":"code","e790ff18":"code","ef03c5dc":"code","786d6668":"code","ef18bbed":"code","e97fc7dd":"code","6a2981d3":"code","85b969ed":"code","3f2aae1b":"code","417b0c42":"code","918dc923":"code","9bb43e17":"code","9c551f68":"code","706ca21e":"code","b82eb32a":"code","b131ebb5":"code","1d478739":"code","9c4db915":"code","a90bdba9":"code","034a5d54":"code","fc4d326f":"code","df99d248":"code","7cec8369":"code","1ec3c7f2":"code","3829acae":"code","5d6a5389":"code","3059d87e":"code","e681ccc7":"code","d32806f4":"code","e54e2b43":"code","40a16dad":"code","b1f3876f":"code","a01075d9":"markdown","9170f14d":"markdown","51fa2dd1":"markdown","a43c02d6":"markdown","b61c28c7":"markdown","53cd506b":"markdown","74b963fa":"markdown","5e12c0e7":"markdown","07fae68c":"markdown","c97f84ea":"markdown","414a1adb":"markdown","6b5ae278":"markdown","c97eb9e3":"markdown","5861f0f0":"markdown","7d9b3821":"markdown","21b4e427":"markdown","8bedbc14":"markdown","8be007b7":"markdown","30d06037":"markdown","3fc2dc78":"markdown","98e5cb5f":"markdown","bd031f27":"markdown","a8a414a0":"markdown","c1a28300":"markdown","8ac6bed3":"markdown","5e4cda3c":"markdown","7078181f":"markdown","963c4928":"markdown","e14c8152":"markdown","22bade4d":"markdown","90152415":"markdown","7dc90967":"markdown","bf760035":"markdown","a8460177":"markdown","9cae3521":"markdown","b18b211b":"markdown","41435e1b":"markdown","7d427583":"markdown","677e6ca3":"markdown"},"source":{"cf55c17c":"import numpy as np # linear algebra\nimport pandas as pd # data processing \npd.plotting.register_matplotlib_converters()\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n        \n# save filepath to variable for easier access\ndrug_overdose_filepath = '..\/input\/opioids-in-the-us-cdc-drug-overdose-deaths\/CDC Injury Center Drug Overdose Deaths.csv'\n# read the data and store data in DataFrame\n# adding encoding to prevent a 'UnicodeDecodeError'\ndrug_overdose_data = pd.read_csv(drug_overdose_filepath, encoding = \"ISO-8859-1\")","19d8ea32":"# let's first look at the overall shape and properties of the data in the dataset\n# beginning with the overall shape.\ndrug_overdose_data.shape","26704f7c":"# let's look at what the columns are, the property values in the data set and the numbers in the register values\ndrug_overdose_data.info()","0c1339b3":"# look for missing data\ndrug_overdose_data.isnull().values.any()","b70a8cf6":"# ok let's confirm where they are\ndrug_overdose_data.isnull().sum()","b96c9981":"# show an analysis of numerical values\ndrug_overdose_data.describe()","66cde9e7":"# let's see a random sample\n# random data\ndrug_overdose_data.sample(5)","e790ff18":"# print the data\ndrug_overdose_data","ef03c5dc":"# let's work on changing the dates to a date format\ndrug_overdose_data.rename(columns={'2019 Age-adjusted Rate (per 100,000 population)': '2019', '2018 Age-adjusted Rate (per 100,000 population)': '2018', '2017 Age-adjusted Rate (per 100,000 population)': '2017', '2016 Age-adjusted Rate (per 100,000 population)': '2016', '2015 Age-adjusted Rate (per 100,000 population)': '2015', '2014 Age-adjusted Rate (per 100,000 population)': '2014', '2013 Age-adjusted Rate (per 100,000 population)': '2013'}, inplace=True)\n# checking it looks right\ndrug_overdose_data.head()","786d6668":"# now we select the death rates per year\ndrug_overdose_features = ['State', '2019', '2018', '2017', '2016', '2015', '2014', '2013']\nselected_drug_overdose_data = drug_overdose_data[drug_overdose_features]\n\n# let's take a look\npd.set_option('display.max_rows', None)\nselected_drug_overdose_data.head(100)","ef18bbed":"# now let's remove the missing value of the District of Columbia\nnew_selected_drug_overdose_data = selected_drug_overdose_data.dropna()\npd.set_option('display.max_rows', None)\nnew_selected_drug_overdose_data.head(100)","e97fc7dd":"# now we transpose the data\n\n# setting the index to the State is the first step in this process.\nnew_selected_drug_overdose_data.set_index(\"State\", inplace=True)\nnew_selected_drug_overdose_data.rename_axis(None, axis = 0, inplace = True)\nprint(new_selected_drug_overdose_data)","6a2981d3":"# now we can transpose the data, which we need to do to allow Seaborn to read the data as a line graph.\ntransposed_drug_overdose_data = new_selected_drug_overdose_data.transpose()\ntransposed_drug_overdose_data.head()","85b969ed":"# We now need to sort the index in chronological order to have the years read from left to right\ntransposed_drug_overdose_data.sort_index()","3f2aae1b":"# let's save this as a new dataframe to create a line graph \nsorted_drug_overdose_data = transposed_drug_overdose_data.sort_index()","417b0c42":"# set the width and height of the figure\nplt.figure(figsize=(24,20)) \n\n# add title\nplt.title(\"Overdose death rates per 100,000 people, by State\")\n\n# add label for vertical axis\nplt.ylabel(\"Overdose death rate (per 100,000 people)\")\n\n# plot graph\nsns.lineplot(data = sorted_drug_overdose_data)","918dc923":"# set the width and height of the figure\nplt.figure(figsize=(24,10))\n\n# add title\nplt.title(\"2019 Overdose deaths\")\n\n# bar chart showing 2019 Overdose deaths, by State\nsns.barplot(x=drug_overdose_data['State Abbreviation'], y=drug_overdose_data['2019 Number of Deaths'])\n\n# add label for vertical axis\nplt.ylabel(\"Overdose deaths\")","9bb43e17":"# Set the width and height of the figure\nplt.figure(figsize=(24,10))\n\n# Add title\nplt.title(\"2013 Overdose death rate per 100,000 people, by State\")\n\n# Bar chart showing 2013 Overdose death rate per 100,000 people, by State\nsns.barplot(x=drug_overdose_data['State Abbreviation'], y=drug_overdose_data['2013'])\n\n# Add label for vertical axis\nplt.ylabel(\"Overdose death rate (per 100,000 people)\")","9c551f68":"# Set the width and height of the figure\nplt.figure(figsize=(24,10))\n\n# Add title\nplt.title(\"2019 Overdose death rate per 100,000 people, by State\")\n\n# Bar chart showing 2019 Overdose death rate per 100,000 people, by State\nsns.barplot(x=drug_overdose_data['State Abbreviation'], y=drug_overdose_data['2019'])\n\n# Add label for vertical axis\nplt.ylabel(\"Overdose death rate (per 100,000 people)\")","706ca21e":"# Let's select features\nheatmap_overdose_features = ['2019', '2018', '2017', '2016', '2015', '2014', '2013', '2019 Poverty rate (percent of persons in poverty)', 'Gini coefficient of income inequality', 'GDP per capita 2021', 'Urban population as a percentage of the total population in 2010', 'Population density per km\u00b2']\nheatmap_overdose_data = drug_overdose_data[heatmap_overdose_features]\nheatmap_overdose_data.head()","b82eb32a":"# let's look at the Seaborn Correlation Heatmap\nplt.figure(figsize=(20,20))\nsns.heatmap(heatmap_overdose_data.corr(), annot=True, cmap=\"coolwarm\")","b131ebb5":"# let's use python\nheatmap_overdose_data.corr().style.background_gradient(cmap='coolwarm')","1d478739":"sns.scatterplot(x=heatmap_overdose_data['2019'], y=heatmap_overdose_data['Population density per km\u00b2'])","9c4db915":"sns.scatterplot(x=heatmap_overdose_data['2013'], y=heatmap_overdose_data['Population density per km\u00b2'])","a90bdba9":"sns.regplot(x=heatmap_overdose_data['2019'], y=heatmap_overdose_data['Population density per km\u00b2'])","034a5d54":"sns.regplot(x=heatmap_overdose_data['2013'], y=heatmap_overdose_data['Population density per km\u00b2'])","fc4d326f":"sns.scatterplot(x=heatmap_overdose_data['2019'], y=heatmap_overdose_data['2019 Poverty rate (percent of persons in poverty)'])","df99d248":"sns.scatterplot(x=heatmap_overdose_data['2013'], y=heatmap_overdose_data['2019 Poverty rate (percent of persons in poverty)'])","7cec8369":"sns.regplot(x=heatmap_overdose_data['2019'], y=heatmap_overdose_data['2019 Poverty rate (percent of persons in poverty)'])","1ec3c7f2":"sns.regplot(x=heatmap_overdose_data['2013'], y=heatmap_overdose_data['2019 Poverty rate (percent of persons in poverty)'])","3829acae":"sns.distplot(a=drug_overdose_data['2013'], kde=False)\n","5d6a5389":"sns.distplot(a=drug_overdose_data['2019'], kde=False)","3059d87e":"#KDE plot\n# 2013\nsns.kdeplot(data=drug_overdose_data['2013'], shade=True)","e681ccc7":"# 2019\nsns.kdeplot(data=drug_overdose_data['2019'], shade=True)","d32806f4":"# 2D KDE plot\n# 2013\nsns.jointplot(x=drug_overdose_data['2013'], y=drug_overdose_data['Population density per km\u00b2'], kind=\"kde\")","e54e2b43":"# 2019\nsns.jointplot(x=drug_overdose_data['2019'], y=drug_overdose_data['Population density per km\u00b2'], kind=\"kde\")","40a16dad":"# 2013\nsns.jointplot(x=drug_overdose_data['2013'], y=drug_overdose_data['2019 Poverty rate (percent of persons in poverty)'], kind=\"kde\")","b1f3876f":"# 2019\nsns.jointplot(x=drug_overdose_data['2019'], y=drug_overdose_data['2019 Poverty rate (percent of persons in poverty)'], kind=\"kde\")","a01075d9":"This is a helpful bar graph with which to start. The most populous States naturally have the highest overdose deaths. Next we'll turn to the overdose deaths per population to try to figure out factors affecting the death rates. But it is important to remember that bringing the number for the country down as a whole will involve bringing down the deaths in California, Florida, Pennsylvania, Ohio, New York and Texas.\n\nNow let's turn our attention to the overdose rate per population. Let's begin with the most recent data, 2019, and have a look at what places are the most affected. Then let's look at the most distant, 2013, and see how it has changed for each State.","9170f14d":"**Correlation heatmap** \n\nThis uses the Pearson correlation coefficient\n\n","51fa2dd1":"<a id=\"section-three\"><\/a>\n# Data Visualisation","a43c02d6":"This data set has overdose deaths and overdose death rates for the different States in the United States for the years 2013 to 2019 and also has different population and income data for the States. In this notebook, we'll be looking at death rates across the different States over time, and seeing what trends we see in the data, and we'll also be looking at what characteristics of the States affect the death rates.","b61c28c7":"<a id=\"section-two\"><\/a>\n# Exploratory Data Analysis","53cd506b":"**Kernel density estimates (KDEs) (smoothed histograms)**","74b963fa":"# Table of Contents\n\n* [Introduction](#section-one)\n* [Exploratory Data Analysis](#section-two)\n* [Data Visualisation](#section-three)\n* [Conclusion](#section-four)","5e12c0e7":"**Two-dimensional (2D) KDE plots**","07fae68c":"**Some notes on this dataset and notebook**\n\nThis notebook is aimed at three groups of people:\n* Data Scientists and Coders in general\n* People interested in the power of data visualization and machine learning when applied to public health\n* People working in public health\n\nAs we go through the notebook, I will be showing what the coding achieves, and how it is generated. I hope that this will be useful to people starting out in data visualisation. I'll be showing some of the visualisations that can be applied to the opidoid epidemic. I want to show that data science is a very powerful tool in the social sciences in general and to analysing a public health crisis like the opidoid epidemic in particular. And I'll also be outlining the public health implications of what the data shows. I strongly hope that this work is shared with people interested in the trying to understand the different factors affecting the epidemic.\n\nAs a note on vieing this notebook, this notebook uses some larger graphs, given there are 50 States, plus Washington D.C. Please shrink the Table of Contents to the side to make it easier to view the graphs.\n\nThis dataset pulls data from the Centers for Disease Control and Prevention's Injury Center. It isn't as up to date as the data from the CDC's Vital Statistics Rapid Release, and doesn't give a breakdown by type of drug, but it does come in a format that is easier with which to work. I hope this helps spark interest in data analysis on this topic.","c97f84ea":"**Relating to the data**\n\nI begin every kernel by introducing a celebrity who also died from a drug overdose. I think this makes the data more relateable. The celebrity I introduce today is Philip Seymour Hoffman. Personally I loved his acting in 'Patch Adams'.\n\n![image.png](attachment:d316c6d2-e1dc-405c-baa2-8f94594d182a.png)!\n\nOn February 2, 2014, Philip Seymour Hoffman was found dead in an apartment in Greenwich village, New York. Investigators found Hoffman with a syringe in his arm and two open envelopes of heroin next to him. Mr. Hoffman was long known to struggle with addiction. In 2006, he said in an interview with \"60 Minutes\" that he had given up drugs and alcohol many years earlier, when he was age 22. In 2013, he checked into a rehabilitation program for about 10 days after a reliance on prescription pills resulted in his briefly turning again to heroin.","414a1adb":"**Heatmaps**","6b5ae278":"**Histograms**","c97eb9e3":"The increasing steepness reflects the increasing correlation, and hence increasing importance, of population density on the epidemic.","5861f0f0":"So the dataset includes data for all 50 States plus Washington D.C. (District of Columbia). The missing data is the Overdose deaths from the District of Columbia from 2015-2017. So we'll drop the District of Columbia when we need to use 2015-2017 data.","7d9b3821":"The Seaborn graph is the most visually presentable, and the use of gray tones helps viusally differentiate high rates of correlation between overdose death rates and State demographic data. However it can be a little difficult to read. So my preference for this data is the python correlation matrix heatmap.","21b4e427":"**Histograms**","8bedbc14":"**Graphing using Seaborn**\n\nSeaborn is a Python data visualization library based on matplotlib. It provides a high-level interface for drawing attractive and informative statistical graphics. We'll be using a lot of graphics from Seaborn in this notebook.","8be007b7":"By 2019 the situation had gotten much worse across the board. The situation in the Appalachias had deteriorated significantly from it's already high starting rate. Also striking is the deterioration already the US Capitol, which significant increases for the Delaware, the District of Columbia and Maryland.","30d06037":"<a id=\"section-four\"><\/a>\n# Conclusion","3fc2dc78":"We now need to transpose the data. Above we have the States on the side as the names of the rows, and the Years at the tope as the names of the columns. We need to reverse this to get Seaborn to graph the changes in the overdose rate over time for each State. Hat tip to Sawada Tsuyoshi for advice on how to do this.","98e5cb5f":"**Scatterplots**","bd031f27":"We need to note here that we have missing values for a few of the columns. Specifically for the drug overdose deaths from 2015-2017. Let's confirm where those are.","a8a414a0":"The dataset is small enough to print the whole set. So let's do that.","c1a28300":"Let's find out about the data with which we will be working.","8ac6bed3":"**Creating a Line Graph of Drug Overdose Death rate by State over time using Seaborn**","5e4cda3c":"The number of States with lower rates (<10) has decreased and the number with higher rates (>20) has increased and there is a fat tail on the right hand side of the distribution (more States with very high rates).","7078181f":"**Data preparation**","963c4928":"We see the opposite trend with the effect the absolute poverty rate has on the epidemic. It has become a relatively less correlated factor. This is not a reflection on the epidemic improving in less well off areas, but a reflection on the degree of deterioration in densely populated areas.","e14c8152":"<a id=\"section-one\"><\/a>\n# Introduction","22bade4d":"We'll explore some of the relationships we saw above using scatterplots and regression line plots below.","90152415":"The KDE and 2D KDE plots tell the same tale.","7dc90967":"What we can see from the graphs is that things were getting worse in nearly every state until 2017 and then from 2017 to 2019 there was a leveling off in the increase of the overdose rate, and some states saw improvement. This data captures the time up till Covid and the lockdowns.  Since the Covid pandemic there has been another dramatic increase in the overdose rate. I have another data set that covers this more recent history. Here's a notebook with graphs incorporating more recent data: https:\/\/www.kaggle.com\/craigchilvers\/opioids-in-the-us-initial-graphs.\n\nWe can also see trends across regions. The situation in the Appalachias was bad to begin with and has continued to deteriorate significantly. The situation around the Capitol started off in the middle of the range of overdose death rates at the beginning of our timeframe but deteriorated rapidly. We see this most dramatically in the graph above with the overdose death rate for Delaware. It also shows up in the change for the District of Columbia between 2013 and 2019; we had just had to remove it from the graph due to missing values.\n\nWe also see relative success stories. Sparsely populated States like Alaska were able to keep their rates relatively lower. New Hampshire was successful in turning the tide in the 2017 to 2019 period.","bf760035":"What the data in this time range shows is deterioration across most of the United States, followed by modest improvements in many parts for the short time period of 2017 to 2019. We see that there are structural challenges that are facing the Appalachias, and we see the rise of urban density as a significant factor, which implies a changing nature of the opioid epidemic.\n\nI also want to stress that the best data comes from the United States, but with an increase in overdoses in Canada and the United Kingdom, we need to consider the probability that the issue of overdoses in those countries follows trends we already see in the United States.","a8460177":"Let's begin the visual analysis with overall deaths, by State.","9cae3521":"Back in 2013 the hardest hit region was the Appalachias (West Virginia, Kentucky, Ohio, Pennsylvania), areas of the South West near Las Vegas (New Mexico, Nevada, Arizona, Utah) and parts of New England (Rhode Island, New Hampshire).\n\nWe also see some sparsely populated rural States doing relatively well (North Dakota, South Dakota and Nebraska).","b18b211b":"It looks like the relationship between the overdose death rate has become stronger, driven by the increase in the death rate in the District of Columbia, Delaware and Maryland. Let's plot regression lines below.","41435e1b":"The strongest correlations, shown in red, are between the overdose death rate for a state in a particular year, and in a different year. This reflects that problems naturally persist, but the correlation is not 1 to 1, as improvements happen in some States, and as the situation deteriorates in others.\n\nMore interesting is the relationship between States' overdose death rate and the States' demographics. We can see that the nature of these relationships have changed over time as the nature of the epidemic has evolved. in 2013 the absolute poverty rate had a larger impact. This is reflected in the high overdose rates for the Appalachias, and may partly reflect the impact of the loss of industrial jobs in Pennsylania and Ohio.\n\nBy 2019 we see population density playing a much bigger role, and the Gini coefficient and GDP per capital levels begin to show strong correlations too, since more densely populated areas tend to be both richer on average and to be less equal. This is reflected in the high overdose death rate in the US Capitol and nearbouring States. My guess is that this is driven by drug distribution networks having a greater impact in densely populated regions once they get entrenched. ","7d427583":"Heatmaps are a very effective way of seeing relationships visually. We'll need to prepare the data a little first.","677e6ca3":"This is exactly how we want the dataframe. We now just need to save it as a new dataframe."}}