{"cell_type":{"e766a4e7":"code","9d7d668b":"code","f770287e":"code","53417c66":"code","9f3de7d3":"code","8976da34":"code","b7e92f4c":"code","4e0cd2b7":"code","ae3ff9ec":"code","db0a8219":"code","b39bad8a":"code","a624cf8c":"code","fdc1cd11":"code","a24b2f5e":"code","3b3e57be":"code","efd9ffb2":"code","bc3c586c":"code","a674251b":"code","411e67a6":"markdown","5ac1d5f3":"markdown","1790f069":"markdown","8142f7f2":"markdown","58fc1141":"markdown","1a074bb8":"markdown"},"source":{"e766a4e7":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","9d7d668b":"import seaborn as sns\nimport matplotlib.pyplot as plt\nimport pandas as pd\nimport numpy as np\nimport numpy as np\nimport pandas as pd\nimport statsmodels.api as sm\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.preprocessing import scale, StandardScaler\nfrom sklearn.model_selection import train_test_split, GridSearchCV, cross_val_score\nfrom sklearn.metrics import confusion_matrix, accuracy_score, mean_squared_error, r2_score, roc_auc_score, roc_curve, classification_report\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.neural_network import MLPClassifier\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.model_selection import train_test_split, GridSearchCV\nfrom sklearn.metrics import mean_squared_error, r2_score\nimport matplotlib.pyplot as plt\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.preprocessing import scale\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn import model_selection\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.neural_network import MLPRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor\nimport numpy as np\nfrom sklearn.neighbors import LocalOutlierFactor\nfrom sklearn import neighbors\nfrom sklearn.svm import SVR\nfrom sklearn.metrics import mean_squared_error,r2_score\nfrom sklearn.model_selection import cross_val_score,train_test_split,GridSearchCV\nfrom xgboost import XGBRegressor\nfrom lightgbm import LGBMRegressor\nfrom sklearn import preprocessing\nfrom sklearn.preprocessing import scale\nfrom sklearn.metrics import mean_squared_log_error\nfrom sklearn.preprocessing import OrdinalEncoder\nfrom xgboost import XGBClassifier\nfrom lightgbm import LGBMClassifier\nfrom catboost import CatBoostClassifier\nimport random\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=DeprecationWarning)\nwarnings.filterwarnings(\"ignore\", category=FutureWarning)\nmodels = [LogisticRegression,KNeighborsClassifier,SVC,MLPClassifier,\n            DecisionTreeClassifier,RandomForestClassifier,GradientBoostingClassifier,\n            XGBClassifier,LGBMClassifier\n          ] #,CatBoostClassifier\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', 10)\npd.set_option('display.float_format', lambda x: '%.5f' % x)","f770287e":"def degisken_tiplerine_ayirma(data,cat_th,car_th):\n   \"\"\"\n   Veri:data parametresi ili fonksiyona girilen verinin de\u011fi\u015fkenlerin s\u0131n\u0131fland\u0131r\u0131lmas\u0131.\n   Parameters\n   ----------\n   data: pandas.DataFrame\n   \u0130\u015flem yap\u0131lacak veri seti\n\n   cat_th:int\n   categoric de\u011fi\u015fken threshold de\u011feri\n\n   car_th:int\n   Cardinal de\u011fi\u015fkenler i\u00e7in threshold de\u011feri\n\n   Returns\n   -------\n    cat_deg:list\n    categorik de\u011fi\u015fken listesi\n    num_deg:list\n    numeric de\u011fi\u015fken listesi\n    car_deg:list\n    categoric ama cardinal de\u011fi\u015fken listesi\n\n   Examples\n   -------\n    df = dataset_yukle(\"breast_cancer\")\n    cat,num,car=degisken_tiplerine_ayirma(df,10,20)\n   Notes\n   -------\n    cat_deg + num_deg + car_deg = toplam de\u011fi\u015fken say\u0131s\u0131\n\n   \"\"\"\n\n\n   num_but_cat=[i for i in data.columns if data[i].dtypes !=\"O\" and data[i].nunique() < cat_th]\n\n   car_deg=[i for i in data.columns if data[i].dtypes == \"O\" and data[i].nunique() > car_th]\n\n   num_deg=[i for i in data.columns if data[i].dtypes !=\"O\" and i not in num_but_cat]\n\n   cat_deg = [i for i in data.columns if data[i].dtypes == \"O\" and i not in car_deg]\n\n   cat_deg = cat_deg+num_but_cat\n\n   print(f\"Dataset kolon\/de\u011fi\u015fken say\u0131s\u0131: {data.shape[1]}\")\n   print(f\"Dataset sat\u0131r\/veri say\u0131s\u0131: {data.shape[0]}\")\n   print(\"********************************************\")\n   print(f\"Datasetin numeric de\u011fi\u015fken say\u0131s\u0131: {len(num_deg)}\")\n   print(f\"Datasetin numeric de\u011fi\u015fkenler: {num_deg}\")\n   print(\"********************************************\")\n   print(f\"Datasetin categoric de\u011fi\u015fken say\u0131s\u0131: {len(cat_deg)}\")\n   print(f\"Datasetin categoric de\u011fi\u015fkenler: {cat_deg}\")\n   print(\"********************************************\")\n   print(f\"Datasetin cardinal de\u011fi\u015fken say\u0131s\u0131: {len(car_deg)}\")\n   print(f\"Datasetin cardinal de\u011fi\u015fkenler: {car_deg}\")\n   print(\"********************************************\")\n\n   return cat_deg,num_deg,car_deg\n\ndef categoric_ozet(data,degisken,plot=False,null_control=False):\n    \"\"\"\n    Task\n    ----------\n    Datasetinde bulunan categoric de\u011fi\u015fkenlerin de\u011fi\u015fken tiplerinin say\u0131s\u0131n\u0131 ve totale kar\u015f\u0131 oran\u0131n\u0131 bulur.\n    Ayr\u0131ca iste\u011fe ba\u011fl\u0131 olarak de\u011fi\u015fken da\u011f\u0131l\u0131m\u0131n\u0131n grafi\u011fini ve de\u011fi\u015fken i\u00e7inde bulunan null say\u0131s\u0131n\u0131 \u00e7\u0131kart\u0131r.\n\n    Parameters\n    ----------\n    data:pandas.DataFrame\n    categoric de\u011fi\u015fkenin bulundu\u011fu dataset.\n    degisken:String\n    Categoric de\u011fi\u015fken ismi.\n    plot:bool\n    Fonksiyonda categoric de\u011fi\u015fken da\u011f\u0131l\u0131m\u0131n\u0131n grafi\u011fini \u00e7izdirmek i\u00e7in opsiyonel \u00f6zellik.\n    null_control:bool\n    Fonksiyonda de\u011fi\u015fken i\u00e7inde null de\u011fer kontol\u00fc i\u00e7in opsiyonel \u00f6zellik\n\n    Returns\n    -------\n    tablo:pandas.DataFrame\n    Unique de\u011fi\u015fkenlerin ratio olarak oran tablosu\n    Examples\n    -------\n    df=dataset_yukle(\"titanic\")\n    cat_deg,num_deg,car_deg=degisken_tiplerine_ayirma(df,10,20)\n    for i in cat_deg:\n        tablo=categoric_ozet(df,i,True,True)\n    \"\"\"\n\n    print(pd.DataFrame({degisken: data[degisken].value_counts(),\n                        \"Ratio\": 100 * data[degisken].value_counts() \/ len(data)}))\n    tablo=pd.DataFrame({degisken: data[degisken].value_counts(),\n                        \"Ratio\": 100 * data[degisken].value_counts() \/ len(data)})\n    print(\"##########################################\")\n    if plot:\n        sns.countplot(x=data[degisken], data=data)\n        plt.show(block=True)\n    if null_control:\n        print(f\"Null veri say\u0131s\u0131: {data[degisken].isnull().sum()}\")\n\n    return tablo\n\ndef dataset_ozet(data, head=5):\n    print(\"##################### Shape #####################\")\n    print(f\"Sat\u0131r say\u0131s\u0131: {data.shape[0]}\")\n    print(f\"Kolon say\u0131s\u0131: {data.shape[1]}\")\n\n    print(\"##################### Types #####################\")\n    print(data.dtypes)\n\n    print(\"##################### Head #####################\")\n    print(data.head(head))\n\n    print(\"##################### Tail #####################\")\n    print(data.tail(head))\n\n    print(\"##################### NA Kontrol\u00fc #####################\")\n    print(data.isnull().sum())\n\n    print(\"##################### Quantiles #####################\")\n    print(data.quantile([0, 0.05, 0.50, 0.95, 0.99, 1]).T)\n\n    print(\"##################### Describe Tablosu #####################\")\n    print(data.describe().T)\n\ndef outlier_threshold(data,degisken):\n    Q1=data[degisken].quantile(0.01)\n    Q3=data[degisken].quantile(0.99)\n    Q_Inter_Range=Q3-Q1\n    alt_limit=Q1-1.5*Q_Inter_Range\n    ust_limit=Q3+1.5*Q_Inter_Range\n    return alt_limit,ust_limit\n\ndef threshold_degisimi(data,degisken):\n    alt_limit,ust_limit=outlier_threshold(data,degisken)\n    data.loc[(data[degisken] < alt_limit), degisken] = alt_limit\n    data.loc[(data[degisken] > ust_limit), degisken] = ust_limit\n    #data[data[degisken]<alt_limit][degisken]=alt_limit\n    #data[data[degisken]>ust_limit][degisken]=ust_limit\n    return data\n\ndef numeric_ozet(data, degisken, plot=False, null_control=False):\n    \"\"\"\n    Task\n    ----------\n    Datasetinde bulunan numeric de\u011fi\u015fkenlerin de\u011fi\u015fken tiplerinin say\u0131s\u0131n\u0131 ve totale kar\u015f\u0131 oran\u0131n\u0131 bulur.\n    Ayr\u0131ca iste\u011fe ba\u011fl\u0131 olarak de\u011fi\u015fken da\u011f\u0131l\u0131m\u0131n\u0131n grafi\u011fini ve de\u011fi\u015fken i\u00e7inde bulunan null say\u0131s\u0131n\u0131 \u00e7\u0131kart\u0131r.\n\n    Parameters\n    ----------\n    data:pandas.DataFrame\n    categoric de\u011fi\u015fkenin bulundu\u011fu dataset.\n    degisken:String\n    Categoric de\u011fi\u015fken ismi.\n    plot:bool\n    Fonksiyonda categoric de\u011fi\u015fken da\u011f\u0131l\u0131m\u0131n\u0131n grafi\u011fini \u00e7izdirmek i\u00e7in opsiyonel \u00f6zellik.\n    null_control:bool\n    Fonksiyonda de\u011fi\u015fken i\u00e7inde null de\u011fer kontol\u00fc i\u00e7in opsiyonel \u00f6zellik\n\n    Returns\n    -------\n    tablo:pandas.DataFrame\n    Unique de\u011fi\u015fkenlerin ratio olarak oran tablosu\n    Examples\n    -------\n    df=dataset_yukle(\"titanic\")\n    cat_deg,num_deg,car_deg=degisken_tiplerine_ayirma(df,10,20)\n    for i in cat_deg:\n        tablo=categoric_ozet(df,i,True,True)\n    \"\"\"\n    quantiles = [0.05, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90, 0.95, 0.99]\n    print(data[degisken].describe(quantiles).T)\n\n    if plot:\n        data[degisken].hist(bins=20)\n        plt.xlabel(degisken)\n        plt.title(degisken)\n        plt.show(block=True)\n    print(\"##########################################\")\n\n    if null_control:\n        print(f\"Null veri say\u0131s\u0131: {data[degisken].isnull().sum()}\")\n        \n\ndef missing_values_table(dataframe, na_name=False):\n    na_columns = [col for col in dataframe.columns if dataframe[col].isnull().sum() > 0]\n\n    n_miss = dataframe[na_columns].isnull().sum().sort_values(ascending=False)\n    ratio = (dataframe[na_columns].isnull().sum() \/ dataframe.shape[0] * 100).sort_values(ascending=False)\n    missing_df = pd.concat([n_miss, np.round(ratio, 2)], axis=1, keys=['n_miss', 'ratio'])\n    print(missing_df, end=\"\\n\")\n\n    if na_name:\n        return na_columns\n\ndef one_hot_encoder(dataframe, categorical_cols, drop_first=True):\n    dataframe = pd.get_dummies(dataframe, columns=categorical_cols, drop_first=drop_first)\n    return dataframe\n\ndef model_karsilastirma(df,model,target):\n    X = df.drop(columns=target)\n\n    y = df[target]\n\n    X_train, X_test, y_train, y_test = train_test_split(X,\n                                                        y,\n                                                        test_size=0.15,\n                                                        random_state=42)\n    model_fit=model().fit(X_train,y_train)\n    y_pred = model_fit.predict(X_test)\n    acc = accuracy_score(y_test, y_pred)\n    print(model ,\"i\u00e7in sonu\u00e7 do\u011fruluk de\u011feri:\",acc)\n    return acc\n\ndef target_analyser(dataframe, target, num_deg, cat_deg):\n    for degisken in dataframe.columns:\n        if degisken in cat_deg:\n            print(degisken, \":\", len(dataframe[degisken].value_counts()))\n            print(pd.DataFrame({\"COUNT\": dataframe[degisken].value_counts(),\n                                \"RATIO\": dataframe[degisken].value_counts() \/ len(dataframe),\n                                \"TARGET_MEAN\": dataframe.groupby(degisken)[target].mean()}), end=\"\\n\\n\\n\")\n        if degisken in num_deg:\n            print(pd.DataFrame({\n                \"TARGET_MEAN\": dataframe.groupby(target)[degisken].mean()}), end=\"\\n\\n\\n\")","53417c66":"#loading dataset\ndf=pd.read_csv(\"..\/input\/heart-disease-uci\/heart.csv\")\ndf.head()","9f3de7d3":"#Analysis of Dataset\ndataset_ozet(df)\ncat_deg,num_deg,car_deg=degisken_tiplerine_ayirma(df,10,20)","8976da34":"#EDA of Dataset\nfor i in cat_deg:\n    categoric_ozet(df,i,True,True)\n\nfor i in num_deg:\n    numeric_ozet(df,i,True,True)\n","b7e92f4c":"#All columns analaysis based on target column\ntarget_analyser(df, \"target\", num_deg, cat_deg)","4e0cd2b7":"#Filling missing values\nnull_cols = missing_values_table(df, True)\nfor i in null_cols:\n    df[i].fillna(df[i].transform(\"mean\"), inplace=True)\n#There is no missing values","ae3ff9ec":"#Outlier processing\nfor i in num_deg:\n    df = threshold_degisimi(df, i)\n","db0a8219":"#Data Extraction\n\ndf.age.describe()\ndf.loc[(df[\"age\"] < 40), 'NEW_AGE_CAT'] = 'Young'\ndf.loc[(df[\"age\"] >= 40) & (df[\"age\"] < 50),  'NEW_AGE_CAT'] = 'Middle Age'\ndf.loc[(df[\"age\"] >= 50) & (df[\"age\"] < 60),  'NEW_AGE_CAT'] = 'Pre-Old'\ndf.loc[(df[\"age\"] >= 60),  'NEW_AGE_CAT'] = 'Old'\ndf.groupby( 'NEW_AGE_CAT')[\"target\"].mean()\n","b39bad8a":"df.trestbps.describe()\ndf.loc[(df[\"trestbps\"] < 90), 'NEW_RBP_CAT'] = 'Low'\ndf.loc[(df[\"trestbps\"] >= 90) & (df[\"trestbps\"] < 120),  'NEW_RBP_CAT'] = 'Ideal'\ndf.loc[(df[\"trestbps\"] >= 120) & (df[\"trestbps\"] < 140),  'NEW_RBP_CAT'] = 'Pre-HIGH'\ndf.loc[(df[\"trestbps\"] >= 140),  'NEW_RBP_CAT'] = 'Hypertension'\ndf.groupby('NEW_RBP_CAT')[\"target\"].mean()","a624cf8c":"df.chol.describe()\ndf.loc[(df[\"chol\"] < 200), 'NEW_CHOL_CAT'] = 'Ideal'\ndf.loc[(df[\"chol\"] >= 200) & (df[\"chol\"] < 240),  'NEW_CHOL_CAT'] = 'HIGH'\ndf.loc[(df[\"chol\"] >= 240),  'NEW_CHOL_CAT'] = 'Very Risky'\ndf.groupby('NEW_CHOL_CAT')[\"target\"].mean()","fdc1cd11":"#Encoding of categoric columns\ncat_deg, num_deg, car_deg = degisken_tiplerine_ayirma(df, 10, 20)\ncat_deg = [i for i in cat_deg if i != \"target\"]\ndf = one_hot_encoder(df, cat_deg)\ndf.head()","a24b2f5e":"#Scaling of numeric columns\nscaler = StandardScaler()\ndf[num_deg] = scaler.fit_transform(df[num_deg])","3b3e57be":"#Comparing of all models\nfor mod in models:\n    model_karsilastirma(df, mod, \"target\")","efd9ffb2":"X = df.drop(columns=\"target\")\ny = df[\"target\"]\n\nX_train, X_test, y_train, y_test = train_test_split(X,\n                                                    y,\n                                                    test_size=0.15,\n                                                    random_state=42)\n\n\nsvm = SVC()\nsvm_tuned = SVC(C = 1, kernel = \"linear\").fit(X_train, y_train)\n\ny_pred = svm_tuned.predict(X_test)\nacc=accuracy_score(y_test, y_pred)\nprint(\"SVM accuracy: \",acc)","bc3c586c":"X = df.drop(columns=\"target\")\ny = df[\"target\"]\n\nX_train, X_test, y_train, y_test = train_test_split(X,\n                                                    y,\n                                                    test_size=0.15,\n                                                    random_state=42)\n\n\nloj_model = LogisticRegression(solver = \"liblinear\").fit(X_train,y_train)\n\ny_pred = loj_model.predict(X_test)\nacc=accuracy_score(y_test, y_pred)\nprint(\"Lojistic_model accuracy: \",acc)","a674251b":"X = df.drop(columns=\"target\")\ny = df[\"target\"]\n\nX_train, X_test, y_train, y_test = train_test_split(X,\n                                                    y,\n                                                    test_size=0.15,\n                                                    random_state=42)\n\n\nlgbm_tuned = LGBMClassifier(learning_rate= 0.01,\n                            max_depth= 5,\n                            n_estimators= 250).fit(X_train, y_train)\n\ny_pred = lgbm_tuned.predict(X_test)\nacc=accuracy_score(y_test, y_pred)\nprint(\"LGBM accuracy: \",acc)\n","411e67a6":"# Light GBM Model Tuning","5ac1d5f3":"![This is an image](https:\/\/www.sbbs-soc.com\/wp-content\/uploads\/2020\/09\/Heart-Disease.jpg)","1790f069":"* age: The person's age in years\n* sex: The person's sex (1 = male, 0 = female)\n* cp: The chest pain experienced (Value 1: typical angina, Value 2: atypical angina, Value 3: non-anginal pain, Value 4: asymptomatic)\n* trestbps: The person's resting blood pressure (mm Hg on admission to the hospital)\n* chol: The person's cholesterol measurement in mg\/dl\n* fbs: The person's fasting blood sugar (> 120 mg\/dl, 1 = true; 0 = false)\n* restecg: Resting electrocardiographic measurement (0 = normal, 1 = having ST-T wave abnormality, 2 = showing probable or definite left ventricular hypertrophy by Estes' criteria)\n* thalach: The person's maximum heart rate achieved\n* exang: Exercise induced angina (1 = yes; 0 = no)\n* oldpeak: ST depression induced by exercise relative to rest ('ST' relates to positions on the ECG plot. See more here)\n* slope: the slope of the peak exercise ST segment (Value 1: upsloping, Value 2: flat, Value 3: downsloping)\n* ca: The number of major vessels (0-3)\n* thal: A blood disorder called thalassemia (3 = normal; 6 = fixed defect; 7 = reversable defect)\n* target: Heart disease (0 = no, 1 = yes)","8142f7f2":"# Lojistic Regression Tuning","58fc1141":"# SVM Tuning","1a074bb8":"# Adding Functions"}}