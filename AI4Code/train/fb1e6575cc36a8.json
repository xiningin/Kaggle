{"cell_type":{"d9eb0758":"code","badabe2d":"code","e9d3ce54":"code","4038cae1":"code","c7768bf0":"markdown","67b5b4e0":"markdown"},"source":{"d9eb0758":"from tqdm.notebook import tqdm\nfrom wordcloud import WordCloud\nfrom matplotlib import pyplot as plt\nfrom functools import partial\n\nimport pandas as pd\nimport numpy as np\n\nimport json\nimport re\n\npd.set_option('display.max_rows', 1000)\npd.set_option('display.max_columns', 500)\npd.set_option('display.width', 1000)\npd.set_option('display.max_colwidth', None)","badabe2d":"def get_raw_txt(_id, path=\"train\"):\n    _d = json.loads(open(f\"{PATH}\/{path}\/{_id}.json\").read())\n    return \" \".join([i[\"text\"] for i in _d])\n\ndef clean_text(txt):\n    return re.sub('[^A-Za-z0-9]+', ' ', str(txt).lower()).strip()","e9d3ce54":"PATH = \"..\/input\/coleridgeinitiative-show-us-the-data\/\"\ntqdm_params = dict(bar_format='{desc}{bar} [ {n} \/ {total} (remaining: {remaining}) ]', colour=\"green\")\n\ntqdm.pandas(desc=\"Text download from JSON files status:\",**tqdm_params)\ndf_train = pd.read_csv(f\"{PATH}train.csv\")\ndf_train['text'] = df_train['Id'].progress_apply(get_raw_txt)\n\nword_model = df_train[['dataset_label','dataset_title','cleaned_label']]\nword_model = word_model.values.reshape((len(df_train)*3,))\nword_model = list(np.unique(word_model))\nprint(\"Word_model created : contains all raw labels (Need to be cleaned before the next steps)\")\n\nfor i in tqdm(range(len(word_model)),desc=\"Word model cleaning using clean_text:\",**tqdm_params):\n    word_model[i] = clean_text(word_model[i])\nword_model = {i.strip() for i in set(word_model)}\n\nprint(f\"Word_model cleaned : now we have the whole list of labels from train set\\n\")\nprint(f\"Word_model unique values : \\033[1m{len(word_model)}\")\n\nwordcloud = WordCloud(max_font_size=15,background_color=\"white\",height=100,scale=3,colormap=\"Greens\")\nwordcloud = wordcloud.generate(\" \".join(word_model))\nplt.figure(figsize=(25,25))\nplt.title(\"World_model top words in labels\\n\")\nplt.imshow(wordcloud)\nplt.axis(\"off\")\nplt.show()","4038cae1":"tqdm_params = dict(bar_format='{desc}{bar} [ {n} \/ {total} (remaining: {remaining}) ]', colour=\"darkgreen\")\n\ntqdm.pandas(desc=\"Text download from JSON files status :\",**tqdm_params)\nsubmission = pd.read_csv(f\"{PATH}sample_submission.csv\")\nsubmission['text'] = submission['Id'].progress_apply(partial(get_raw_txt,path=\"test\"))\n\ntqdm.pandas(desc=\"Text cleaning with clean_text function :\",**tqdm_params)\nsubmission['text'] = submission['text'].progress_apply(clean_text)\n\nsubmission['PredictionString'] = ''\nfor i in submission.index:\n    for ws in word_model:\n        if ws in submission.loc[i][\"text\"]:\n            submission.loc[i]['PredictionString'] += ws.strip() + '|'\n    submission.loc[i]['PredictionString'] = submission.loc[i]['PredictionString'][:-1]\n\nsubmission = submission.drop(\"text\",axis=1)\nsubmission.to_csv(\"submission.csv\", index = False)\nsubmission","c7768bf0":"# Train set","67b5b4e0":"# Submission set"}}