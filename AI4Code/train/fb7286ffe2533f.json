{"cell_type":{"8534e4f6":"code","a183b2c1":"code","76f681ff":"code","0b06d62b":"code","e3e99921":"code","532ec369":"code","1cc8bb69":"code","ab39cd23":"code","7911328f":"code","e6fab203":"code","69e76d58":"code","c0579b2d":"code","3068324c":"code","0b0c8a60":"code","06e4dd61":"code","b9fed6c9":"code","d603bf5e":"code","026438a1":"code","c1baa02c":"code","535d3807":"code","503df07d":"code","cde3cad4":"code","45a865e9":"code","95d837c3":"code","cb20bb3e":"code","97a90450":"code","cac8432a":"code","d376f36c":"code","a205152c":"code","d7244701":"code","9cf70013":"code","2dfdaa6f":"code","ec55c663":"code","4b124ea3":"code","e180dfe0":"code","1b015e45":"markdown","67eb6b2e":"markdown","27979d13":"markdown","718eb73c":"markdown","7aad2f18":"markdown","5acf7b33":"markdown","977d5225":"markdown","5679993d":"markdown","8f426b67":"markdown","fde620b0":"markdown","cbf7da08":"markdown","3fb5993a":"markdown","59a74e51":"markdown","9619ad17":"markdown","05957e83":"markdown","16c82d89":"markdown","233da296":"markdown","0bd2f8fd":"markdown","8375b97f":"markdown","999612d4":"markdown"},"source":{"8534e4f6":"# Importando as bibliotecas necess\u00e1rias para an\u00e1lise dos dados\nimport pandas as pd # Cria\u00e7\u00e3o e manipula\u00e7\u00e3o de dataset\nimport numpy as np # Manipula\u00e7\u00e3o de matrizes\nimport matplotlib.pyplot as plt # Plotagem de dados\nimport seaborn as sns # Plotagem e visualiza\u00e7\u00e3o dos dados","a183b2c1":"# Criando dataset\ndf = pd.read_csv(\"..\/input\/titanic\/train.csv\")\n\n# Visualiza\u00e7\u00e3o inicial do dataset\nprint(f'N\u00famero de Linhas e Colunas: {df.shape}')\ndf.head()","76f681ff":"# Avaliar a distribui\u00e7\u00e3o da classe Target\ndf.Survived.value_counts(normalize=True)*100","0b06d62b":"# Alterar o nome das colunas para facilitar o entendimento \ndf.columns = [\"Id\", \"Sobreviveu\", \"Classe\", \"Nome\", \"Sexo\", \"Idade\", \"Familiares\", \"Dependentes\", \"Ticket\", \"Pre\u00e7o da Passagem\", \"Cabine\", \"Local de Embarque\"]\ndf.head()","e3e99921":"# Avalia\u00e7\u00e3o Geral dos Dados\ndf.describe()","532ec369":"# Avaliando valores nulos\ndf.isnull().sum()","1cc8bb69":"# Propor\u00e7\u00e3o de passageiros que n\u00e3o tem Cabine\n(df.Cabin.isnull().sum())\/df.shape[0]","ab39cd23":"# Propor\u00e7\u00e3o de passageiros sem Idade\n(df.Age.isnull().sum())\/df.shape[0]","7911328f":"# Avaliar as m\u00e9dias das Idades para Homens e Mulheres\ndf.groupby('Sex')['Age'].mean()","e6fab203":"# Avaliar o Desvio Padr\u00e3o da Idade por Sexo\ndf.groupby('Sex')['Age'].std()","69e76d58":"# An\u00e1lise de correla\u00e7\u00e3o entre as vari\u00e1veis\ndf.corr().style.format('{:.2}').background_gradient(cmap=plt.get_cmap('coolwarm'), axis=1)","c0579b2d":"# Deletar as colunas Familiares e Local de Embarque.\ndf.drop(columns=['Familiares', 'Local de Embarque'], inplace=True)\nprint(f'N\u00famero de Linhas e Colunas: {df.shape}')\ndf.head()","3068324c":"# Avaliar a distribui\u00e7\u00e3o dos passageiros por classe (pode ser um indicativo do valor da passagem)\ndf['Classe'].value_counts(normalize=True)*100","0b0c8a60":"# Primeiro precisamos avaliar a distribui\u00e7\u00e3o do valor da passagem, para determiar o limiar das classes\ndf['Pre\u00e7o da Passagem'].value_counts(normalize=True, bins=8).sort_index().plot.bar()","06e4dd61":"# Cria\u00e7\u00e3o de tr\u00eas faixas et\u00e1rias para simplificar a an\u00e1lise\nconditions = [\n    (df['Idade'] <= 11.0),\n    (df['Idade'] <= 30.0),\n    (df['Idade'] > 30.0)]\nchoices = ['Crian\u00e7a','Adulto','Idoso']\ndf['Faixa Et\u00e1ria'] = np.select(conditions, choices)\ndf['Faixa Et\u00e1ria'] = df['Faixa Et\u00e1ria'].astype(str)\n\n# Cria\u00e7\u00e3o de duas faixas de renda, de acordo com o valor pago pela passagem\nconditions = [\n    (df['Pre\u00e7o da Passagem'] <= 320.0),\n    (df['Pre\u00e7o da Passagem'] > 320.0)]\nchoices = ['Baixa renda', 'Alta renda']\ndf['Classe de Renda'] = np.select(conditions, choices)\ndf['Classe de Renda'] = df['Classe de Renda'].astype(str)","b9fed6c9":"# Avaliar se as colunas foram criadas de forma correta\ndf.head()","d603bf5e":"# Propor\u00e7\u00e3o de sobreviventes por Classe\nsobreviventes_classe = df.copy()\nsobreviventes_classe['Sobreviveu'] = df['Sobreviveu'] == 1\nsns.barplot(data=sobreviventes_classe, y='Sobreviveu', x='Classe', hue=\"Classe\")","026438a1":"# Propor\u00e7\u00e3o de sobreviventes por Classe de Renda (ponto de corte em 320 d\u00f3lares)\nsobreviventes_renda = df.copy()\nsobreviventes_renda['Sobreviveu'] = df['Sobreviveu'] == 1\nsns.barplot(data=sobreviventes_renda, y='Sobreviveu', x='Classe de Renda', hue=\"Classe de Renda\")","c1baa02c":"# Propor\u00e7\u00e3o de sobreviventes por Sexo\nsobreviventes_sexo = df.copy()\nsobreviventes_sexo['Sobreviveu'] = df['Sobreviveu'] == 1\nsns.barplot(data=sobreviventes_sexo, y='Sobreviveu', x='Sexo', hue=\"Sexo\")","535d3807":"# Propor\u00e7\u00e3o de sobreviventes por Sexo e Classe\nsobreviventes_sexo = df.copy()\nsobreviventes_sexo['Sobreviveu'] = df['Sobreviveu'] == 1\nsns.barplot(data=sobreviventes_sexo, y='Sobreviveu', x='Sexo', hue=\"Classe\")","503df07d":"# Propor\u00e7\u00e3o de sobreviventes por Faixa Et\u00e1ria (0-11, 12-30, > 30)\nsobreviventes_faixa = df.copy()\nsobreviventes_faixa['Sobreviveu'] = df['Sobreviveu'] == 1\nsns.barplot(data=sobreviventes_faixa, y='Sobreviveu', x='Faixa Et\u00e1ria', hue='Sexo')","cde3cad4":"from sklearn.preprocessing import MinMaxScaler # Transforma\u00e7\u00e3o de dados \nfrom sklearn.model_selection import train_test_split # Partir dados em amostras\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.tree import DecisionTreeClassifier # Modelo \u00c1rvore de Decis\u00e3o\nfrom sklearn.metrics import classification_report, confusion_matrix, accuracy_score # M\u00e9todos para avaliar acur\u00e1cia dos modelos","45a865e9":"# Avaliar dataset para finalizar o processamento\ndf.head()","95d837c3":"# Excluir as colunas Faixa Et\u00e1ria e Classe de Renda\ndf.drop(columns=['Faixa Et\u00e1ria', 'Classe de Renda'], inplace=True)\n\n# Passar a coluna Classe para Categ\u00f3rica, para que funcionem da forma correta\n\ndf['Classe'] = df['Classe'].astype(str)","cb20bb3e":"# Avaliar os formatos dos dados\ndf.dtypes","97a90450":"# Passar a vari\u00e1vel categ\u00f3rica Classe para colunas (One-hot-encoding)\ndf = pd.get_dummies(df)\ndf.head()","cac8432a":"# Definir Vari\u00e1veis de Entrada e Sa\u00edda\nX = df.drop('Sobreviveu', axis = 1)\ny = df['Sobreviveu'] ","d376f36c":"# Definir Conjunto de Treino e Teste\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.30, random_state=44)","a205152c":"# Criar Scaler para normalizar os dados (Faz-se somente no Treino e posteriormente aplica no teste)\nescala = MinMaxScaler()\nX_train = escala.fit_transform(X_train)\nX_test = escala.transform(X_test)","d7244701":"# Valida\u00e7\u00e3o Cruzada do Modelo\nclf_Tree = DecisionTreeClassifier()\n\nparams = {'criterion':['gini', 'entropy'], 'max_depth':[2, 3, 4, 5, 6, 7, 8]}\ngrid = GridSearchCV(estimator=clf_Tree, param_grid=params, scoring='f1', cv=5)\n\n# Training and Validating Model\ngrid.fit(X_train, y_train)\nprint(pd.DataFrame(grid.cv_results_)[['rank_test_score','mean_test_score']].sort_values('rank_test_score').head(5))\nprint(f'Melhores par\u00e2metros: {grid.best_params_}')","9cf70013":"# Traning Tuning Model\ntuning_clf_tree = DecisionTreeClassifier(criterion='gini', max_depth=10)\ntuning_clf_tree.fit(X_train, y_train)\ny_pred = tuning_clf_tree.predict(X_test)","2dfdaa6f":"# Evaluating Model Accuracy\nprint(f'Acur\u00e1cia do Modelo Decision Tree: {accuracy_score(y_test, y_pred)*100}')\n\n# Evaluating Model Confusion Matrix\nmatriz_tree = pd.DataFrame(confusion_matrix(y_test, y_pred))\nprint('\\nMatriz de Confus\u00e3o Decision Tree') \nprint(matriz_tree)\n\n# Evaluating Model classification Report \nprint('Classification Report do Modelo Decision Tree')\nprint (classification_report(y_test, y_pred))","ec55c663":"# Previs\u00e3o final com o modelo KNN\nprev = clf_KNN.predict(x_test)\nprev = prev.astype(np.int16)","4b124ea3":"# Gerando CSV para submiss\u00e3o\nsub = pd.read_csv(\"..\/input\/titanic\/gender_submission.csv\")\nsub['Survived'] = prev\nsub.to_csv('submission.csv', index=False)","e180dfe0":"# Arquivo final para Submiss\u00e3o\nsub.head()","1b015e45":"**Nenhum dos modelos teve alta acur\u00e1cia, mas a an\u00e1lise serve para o entendimento do melhor modelo a ser utiliado no problema.**\n\n**Contudo s\u00e3o necess\u00e1rios ajustes nos par\u00e2metros e avalia\u00e7\u00e3o das features a fim de melhorar a previs\u00e3o dos modelos.**\n\n**Ainda assim, \u00e9 poss\u00edvel prever a sobrevi\u00eancia ou n\u00e3o de certo passageiro com at\u00e9 77% de certeza.**\n\n**Cr\u00edticas e contribui\u00e7\u00f5es s\u00e3o muito bem vindas!**","67eb6b2e":"Analisando o quadro de resumo acima podemos perceber algumas caracter\u00edsticas gerais dos passageiros do Titanic:\n\n1) Haviam no navio desde beb\u00eas, com menos de um ano de vida, at\u00e9 idosos, sendo que o passageiro mais velho tinha 80 anos. Mas em geral os passageiros eram mais jovens, sendo a **m\u00e9dia de idade de 29,7 anos**, e **75% dos passageiros** tendo **at\u00e9 38 anos**.\n\n2) O pre\u00e7o da passagem variou bastante, provavelmente em fun\u00e7\u00e3o da classe em que o passageiro viajava. O valor m\u00e9dio da passagem paga para viajar no Titanic foi de **32,20 d\u00f3lares**, mas **75% dos passageiros** pagaram at\u00e9 31 d\u00f3lares. Os bilhetes mais caros custaram 512 d\u00f3lares.\n\n3) A grande maioria dos passageiros viajava sem familiares (marido, esposa ou irm\u00e3o) e n\u00e3o tinham dependentes (filhos e pais idosos).","27979d13":"## **Ap\u00f3s a an\u00e1lise preliminar do dataset percebe-se que os fatores mais relevantes na sobreviv\u00eanicia para os passageiros do Titanic s\u00e3o:** \n\n1) **Sexo**: onde as mulheres tiveram propor\u00e7\u00e3o sobreviv\u00eancia muito superior aos homens.\n\n2) **Classe**: onde passageiros da primeira e segunda classe tiveram sobreviv\u00eancia superior aos passageiros da terceira classe.\n\n3) **Idade**: onde crian\u00e7as e idosos apresentaram sobreviv\u00eancia maior que os jovens. \n\n4) **Valor pago na Passagem**: onde passageiros que pagaram mais caro apresentaram sobreviv\u00eancia maior que os passageiros que pagaram mais barato na passagem.","718eb73c":"Ser\u00e1 adotada a Idade M\u00e9dica do respectivo sexo para os passageiros com dados faltantes.","7aad2f18":"Agora vamos avaliar a distribui\u00e7\u00e3o da **Target** dentro das features.","5acf7b33":"Fica bem claro a forte correla\u00e7\u00e3o entre a Renda e a probabilidade de sobreviv\u00eancia, e tamb\u00e9m entre a classe do passageiro e a probabilidade de sobreviv\u00eancia.\nVamos avaliar a distribui\u00e7\u00e3o da **Target** pelo **Sexo** dos passageiros.","977d5225":"Podemos perceber que a coluna **Local de Embarque** tem uma correla\u00e7\u00e3o consider\u00e1vel com a coluna **Classe** e correla\u00e7\u00e3o muito baixa com a **Target**. Por isso, essa coluna ser\u00e1 exclu\u00edda. Outro ponto \u00e9 a correl\u00e7\u00e3o forte entre as colunas **Familiares** e **Dependentes**. Como a coluna **Dependentes** tem mais correla\u00e7\u00e3o com a **Target**, a coluna **Familiares** ser\u00e1 exclu\u00edda.","5679993d":"20% dos passageiros est\u00e3o sem a idade. Uma forma de corrigir esse dado \u00e9 substituir a Idade pela m\u00e9dia das idades, ou uma m\u00e9dia para homens e uma m\u00e9dia para mulheres. Vamos avaliar se a m\u00e9dia da idade por sexo \u00e9 diferente.","8f426b67":"\n# **Previs\u00e3o de sobreviv\u00eancia no Titanic.**\nNa primeira etapa desse notebook ser\u00e1 feita uma an\u00e1lise explorat\u00f3ria dos dados, no que seria uma etapa anterior ao processo de previs\u00e3o, para determina\u00e7\u00e3o das features (vari\u00e1veis) mais relevantes na sobreviv\u00eancia dos passageiros. Posteriormente, alguns modelos ser\u00e3o ajustados para a previs\u00e3o da sobreviv\u00eancia.","fde620b0":"Praticamente metade das mulheres que estavam no Titanic sobreviveram, enquanto pouco mais de 10% dos homens sobreviveram. Para destacar se realmente a Classe onde o passageiro viajava e o Sexo foram determinantes na sobreviv\u00eancia, vamos plotar a propor\u00e7\u00e3o de sobreviventes por Sexo e Classe. ","cbf7da08":"Percebe-se tamb\u00e9m a exist\u00eancia de correla\u00e7\u00e3o entre a faixa et\u00e1ria e a sobreviv\u00eancia, onde **Crian\u00e7as** e **Idosos** tiveram uma probabilidade de sobreviv\u00eancia maior que os jovens. Mesmo em passageiros do sexo masculino, a sobreviv\u00eancia das crian\u00e7as foi maior. Pode-se perceber, portanto, que o padr\u00e3o de salvamento **Mulheres e Crian\u00e7as primeiro** parece ter sido utilizado no caso do Titanic. \nExiste rela\u00e7\u00e3o tamb\u00e9m entre a **Classe** e **Renda** do passageiro e a sobreviv\u00eancia, onde a primeira e segunda classe apresentaram maior probabilidade de sobreviv\u00eancia. ","3fb5993a":"Muitos modelos, para funcionarem de forma adequada, t\u00eam como premissa a independ\u00eancia das features (o que quase nunca ocorre no mundo real). Dessa forma, vale a pena fazer uma an\u00e1lise de correla\u00e7\u00e3o e, se poss\u00edvel, reduzir a dimencionalidade do dataset com a exclus\u00e3o de features.","59a74e51":"De acordo com o gr\u00e1fico acima fica percept\u00edvel a maior propor\u00e7\u00e3o de sobreviventes entre as mulheres, al\u00e9m do impacto da classe em que o passageiro viajava na proopr\u00e7\u00e3o de sobreviv\u00eancia. A maior discrep\u00e2ncia pode ser observada entre mulheres da primeira e segunda classes e homens de terceira classe.","9619ad17":"As colunas que apresentaram maior correla\u00e7\u00e3o com a **Target** foram: **Sexo** e **Pre\u00e7o da Passagem**. Vamos analisar a distribui\u00e7\u00e3o da Target nessas features. Geralmente, em acidentes desse tipo, o padr\u00e3o Mulheres e Crian\u00e7as primeiro deve ser seguido. Vamos avaliar se isso realmente ocorreu.\nPara simplificar a an\u00e1lise, vou criar uma nova coluna para a faixa et\u00e1ria dos passageiros. A classifica\u00e7\u00e3o por faixa et\u00e1ria pode tornar a an\u00e1lise mais simplificada, pois teria menos varia\u00e7\u00f5es que os valores das idades e assim pode facilitar a percep\u00e7\u00e3o de padr\u00f5es e correla\u00e7\u00f5es. Entreanto, devemos tomar bastante cuidado nessa etapa, pois a determina\u00e7\u00e3o das faixas et\u00e1rias \u00e9 bastante subjetiva (ainda mais considerando a \u00e9poca do acidente) e pode implicar vi\u00e9s \u00e0 an\u00e1lise. \nVou criar tamb\u00e9m uma vari\u00e1vel para classificar o valor pago na passagem, afim de tentar classificar os passageiros entre Baixa Renda e Alta Renda.","05957e83":"# **Submiss\u00e3o da Previs\u00e3o**","16c82d89":"# **Modelagem e Previs\u00e3o**\n\nCom um melhor entendimento do dataframe e de como as vari\u00e1veis se relacionam com o resultado final, al\u00e9m de uma reestrutura\u00e7\u00e3o dos dados, podemos passar \u00e0 etapa de treinamento e teste dos modelos para tentar prever o resultado final para determinado indiv\u00edduo.\nComo o dataset tem uma baixa dimencionalidade e tamb\u00e9m considerando que a rela\u00e7\u00e3o entre as features e a target est\u00e1 bem estabelecida, vou treinar um modelo Decision Tree com poucas camadas, buscando tanto alta acur\u00e1cia como boa interpreta\u00e7\u00e3o das previs\u00f5es.","233da296":"\u00c1 classe alvo est\u00e1 desbalanceada, mas n\u00e3o de forma severa. O impacto disso pode ser avaliado atrav\u00e9s da matriz de confus\u00e3o, despois da previs\u00e3o.","0bd2f8fd":"### **DICION\u00c1RIO DE DADOS:** \n**ID**: Identificador do Passageiro (int)\n\n**Sobreviveu**: Se o passageiro sobreviveu (0 = N\u00e3o, 1 = Sim)\n\n**Classe**: Classe na qual o passageiro viajou. (1 = Primeira Classe, 2 = Segunda Classe, 3 = Terceira Classe)\n\n**Nome**: Nome do passageiro, com o pronome de tratamento\n\n**Sexo**: Sexo do passageiro (Male, Female)\n\n**Idade**: Idade do passageiro (float)\n\n**Familiares**: Quantidade de **irm\u00e3os** e **c\u00f4njuges** relativos ao passageiro\n\n**Dependentes**: Quantidade de **filhos** ou **pais (idosos)** relativos ao passageiro\n\n**Ticket**: N\u00famero do bilhete do passageiro\n\n**Pre\u00e7o da Passagem**: Valor pago pelo passageiro para viajar (D\u00f3lar)\n\n**Cabine**: N\u00famero da Cabine do passageiro\n\n**Local de Embarque**: Foram 3 paradas antes de seguir para Nova York (C = Cherbourg, Q = Queenstown, S = Southampton)","8375b97f":"77% dos passageiros est\u00e3o sem o registro da cabine. Pode ser avaliada a exclus\u00e3o dessa coluna e o teste do modelo, para definir se impacta muito na previs\u00e3o.","999612d4":"# CORRIGIR A AN\u00c1LISE A PARTIR DESSE PONTO!"}}