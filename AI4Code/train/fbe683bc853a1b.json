{"cell_type":{"76210461":"code","d0d3e6a9":"code","6976ef9a":"code","5c075e5a":"code","22d54d46":"code","79b912d2":"code","24f69dcb":"code","d8ca693b":"code","211d263c":"code","553027a1":"markdown","165fbb47":"markdown","35d6f186":"markdown","e793da47":"markdown","ba93b790":"markdown","b27d6b0b":"markdown","4b3e6c99":"markdown"},"source":{"76210461":"IMAGE_PATH = \"..\/input\/chinese-mnist\/data\/data\"\nINFO_PATH = \"..\/input\/chinese-mnist\/chinese_mnist.csv\"\nSEED = 42\n\nDATABLOCK_IMAGE_SIZE = 128\nDATABLOCK_MIN_SCALE = 0.35\n\nTHRESH = 0.2\nFINE_TUNE_NUM  =2\nBASE_RL = 1e-2\n\nTOP_VIEW_NUM = 5\nNROWS = 10","d0d3e6a9":"import numpy as np \nimport pandas as pd\nimport os\n\nimport fastai\nfrom fastai.vision.all import *\nfrom fastai.vision.widgets import *","6976ef9a":"path = Path(IMAGE_PATH)\nPath.BASE_PATH = path\n\ndf = pd.read_csv(INFO_PATH)\ndf['filename'] = (\"input_\" + df['suite_id'].astype(str) \n               + \"_\" \n               + df['sample_id'].astype(str) \n               + \"_\" \n               + df['code'].astype(str) \n               + \".jpg\")\ndf.head()","5c075e5a":"def get_x(r): return path\/r['filename']\ndef get_y(r): return r['value'].astype(str).split(\" \")\n\ndblock = DataBlock(blocks=(ImageBlock, MultiCategoryBlock),\n                   splitter = RandomSplitter(seed=SEED),\n                   get_x = get_x,\n                   get_y = get_y,\n                   item_tfms = RandomResizedCrop(DATABLOCK_IMAGE_SIZE, min_scale=DATABLOCK_MIN_SCALE),\n                  )\ndls = dblock.dataloaders(df)\n\nlen(dls.train), len(dls.valid)","22d54d46":"dls.show_batch()","79b912d2":"learn = cnn_learner(dls, resnet18, metrics=partial(accuracy_multi, thresh=THRESH))\nlearn.fine_tune(FINE_TUNE_NUM, base_lr=BASE_RL)\n\nlearn.unfreeze()","24f69dcb":"learn.lr_find()","d8ca693b":"learn.fit_one_cycle(FINE_TUNE_NUM, 0.0002290867705596611)","211d263c":"learn.show_results()","553027a1":"# imports","165fbb47":"# get best learning rate","35d6f186":"# make datablock","e793da47":"# evaluate model","ba93b790":"# train custom resnet18 with best learnig rate","b27d6b0b":"# make dataframe (previous dataframe data + filename )","4b3e6c99":"# global variables"}}