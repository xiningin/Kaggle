{"cell_type":{"99c3475d":"code","d5a0b56a":"code","ab17f638":"code","9eb82dbe":"code","45683c5f":"code","1800cb69":"code","e69d8c32":"code","1cdf1359":"code","f0f4e32d":"code","a1ec11de":"code","410262be":"code","ba86b639":"code","8b68ba3c":"code","2f8a4fa3":"code","4a5e4632":"code","f23cfb9f":"code","248832d3":"code","5774bfe6":"code","cf8a38f2":"code","6a5f425e":"code","37535bae":"code","5a982a0a":"code","5a5aeab5":"code","f661a141":"code","a16a748a":"code","0522f565":"code","c5050744":"code","4c5c20bb":"code","06defadf":"code","4d213c7f":"code","705151cc":"code","a3b88b38":"code","33d8b22a":"code","edbd2563":"code","d6241e28":"code","b441b69e":"code","cf72de3f":"code","6aef83cf":"code","fe7d42cd":"code","36b86d69":"code","68f28247":"code","a88cebc9":"code","416426ca":"code","fb6ec011":"code","4e2cea73":"code","b423d265":"code","8a10b9ca":"code","7b6cea90":"code","36d5f5b8":"code","e015b352":"code","b0067c55":"code","958de332":"code","e3e2e82f":"code","57c030e7":"code","e8f41242":"code","259c48b2":"code","70ed200b":"code","a8e3cd5f":"code","7885d6cf":"code","77beee5c":"code","83d898aa":"code","ab3747f4":"code","1d8cb44a":"markdown","7f9d0e77":"markdown","ba51216e":"markdown","e2fe8795":"markdown","1b5c1e19":"markdown","219e05e6":"markdown","fcd32cda":"markdown","b9f7143d":"markdown","9f1baf89":"markdown","6066ad67":"markdown","3a25674a":"markdown","4e65b251":"markdown","a6ccd158":"markdown","14872293":"markdown","16373b09":"markdown","d6651991":"markdown","c8e34dfb":"markdown","5586fe05":"markdown","a7973be2":"markdown","0b64edc8":"markdown","ddb30893":"markdown","e53caf08":"markdown","e5b383c9":"markdown","f61febfa":"markdown","4a85dd1a":"markdown","9a2a826d":"markdown","d368a379":"markdown","1ff1d7d4":"markdown","cdf7a2e0":"markdown","a3042e9b":"markdown"},"source":{"99c3475d":"import warnings\nwarnings.filterwarnings('ignore')\n\nimport numpy as np \nimport pandas as pd\n\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nimport plotly.express as px\nimport cufflinks as cf\ncf.go_offline(True)","d5a0b56a":"application_data = pd.read_csv('..\/input\/credit-card-approval-prediction\/application_record.csv')\ncredit_data = pd.read_csv('..\/input\/credit-card-approval-prediction\/credit_record.csv')\n\ndisplay(application_data.info())\nprint(\"\\n\")\ndisplay(credit_data.info())","ab17f638":"display(application_data.head())\nprint('\\n')\ndisplay(credit_data.head())","9eb82dbe":"defaults = credit_data[['ID','MONTHS_BALANCE']].groupby('ID').agg(min).reset_index()\n\ndisplay(defaults.head())\nprint(\"\\n\")\ndisplay(defaults.info())","45683c5f":"drop_index = application_data[application_data.duplicated(subset=['ID'], keep=False)].index\n\napplication_unique_data = application_data.drop(drop_index)\n\napplication_unique_data.shape","1800cb69":"data = application_unique_data.merge(defaults, on='ID', how='left')","e69d8c32":"def risk(x):\n    if x >= -3:\n        return 'no'\n    elif x < -3:\n        return 'yes'\n    else:\n        return 'null'\n\ndata['RISK'] = data['MONTHS_BALANCE'].apply(lambda x: risk(x))","1cdf1359":"data.drop(data[data['RISK'] == 'null'].index, inplace=True)","f0f4e32d":"from sklearn.preprocessing import LabelEncoder\n\nlb = LabelEncoder()\n\ndata['MALE'] = lb.fit_transform(data['CODE_GENDER'])\ndata['CAR'] = lb.fit_transform(data['FLAG_OWN_CAR'])\ndata['REALTY'] = lb.fit_transform(data['FLAG_OWN_REALTY'])\n\ndata.drop(['CODE_GENDER','FLAG_OWN_CAR','FLAG_OWN_REALTY'], axis=1, inplace=True)","a1ec11de":"data['AGE'] = data['DAYS_BIRTH'].apply(lambda x: round(abs(x\/365)))\ndata['YEARS_EMPLOYED'] = data['DAYS_EMPLOYED'].apply(lambda x: round(abs(x\/365),2))\n\ndata.drop(['DAYS_BIRTH','DAYS_EMPLOYED'], axis=1, inplace=True)","410262be":"data['INCOME'] = data['AMT_INCOME_TOTAL'].apply(lambda x: x\/1000)\n\ndata.drop(['AMT_INCOME_TOTAL'], axis=1, inplace=True)","ba86b639":"pd.set_option('display.max_columns', None)\ndata.head()","8b68ba3c":"px.box(data_frame=data, x='OCCUPATION_TYPE', y='AGE')","2f8a4fa3":"px.box(data_frame=data, x='OCCUPATION_TYPE', y='INCOME')\n\n#Outliers detected in laborers, Security Staff, ","4a5e4632":"sns.lmplot(data=data[data['OCCUPATION_TYPE']=='Laborers'], x='AGE', y='INCOME', hue='RISK')\n\n#Notice that the salary is increasing with age","f23cfb9f":"sns.lmplot(data=data[data['OCCUPATION_TYPE']=='Security staff'], x='AGE', y='INCOME', hue='RISK')\n\n#Notice that the salary is increasing with age","248832d3":"data.drop(data.query('OCCUPATION_TYPE==\"Laborers\" and AGE > 45 and INCOME > 200').index, inplace=True)\n#data.drop(data.query('OCCUPATION_TYPE==\"Laborers\" and AGE > 55').index, inplace=True)\ndata.drop(data.query('OCCUPATION_TYPE==\"Laborers\" and INCOME > 400').index, inplace=True)","5774bfe6":"sns.lmplot(data=data[data['OCCUPATION_TYPE']=='Laborers'], x='AGE', y='INCOME', hue='RISK')","cf8a38f2":"data.drop(data.query('OCCUPATION_TYPE==\"Security staff\" and AGE > 50 and INCOME > 200').index, inplace=True)\n#data.drop(data.query('OCCUPATION_TYPE==\"Laborers\" and AGE > 55').index, inplace=True)\ndata.drop(data.query('OCCUPATION_TYPE==\"Security staff\" and INCOME > 400').index, inplace=True)","6a5f425e":"sns.lmplot(data=data[data['OCCUPATION_TYPE']=='Security staff'], x='AGE', y='INCOME', hue='RISK')","37535bae":"data['RISK'] = lb.fit_transform(data['RISK'])","5a982a0a":"data.head()","5a5aeab5":"display(data['NAME_INCOME_TYPE'].value_counts())\n\ndisplay(data['NAME_EDUCATION_TYPE'].value_counts())\n\ndisplay(data['NAME_FAMILY_STATUS'].value_counts())\n\ndisplay(data['NAME_HOUSING_TYPE'].value_counts())","f661a141":"data['MARRIED'] = data['NAME_FAMILY_STATUS'].apply(lambda x: 1 if ((x == 'Married') or (x == 'Civil marriage')) else 0)","a16a748a":"DEGREE = pd.get_dummies(data['NAME_EDUCATION_TYPE'], drop_first=True)\nOCCUPATION = pd.get_dummies(data['NAME_INCOME_TYPE'], drop_first=True)\n#HOUSE = pd.get_dummies(data['NAME_HOUSING_TYPE'], drop_first=True)","0522f565":"data = pd.concat([data, DEGREE, OCCUPATION], axis=1)","c5050744":"data.head()","4c5c20bb":"data_occp = data.groupby(['NAME_INCOME_TYPE','NAME_EDUCATION_TYPE','OCCUPATION_TYPE']).size().rename(\"count\").reset_index()\n\ndisplay(data_occp)","06defadf":"data_occp_final = data_occp[data_occp.groupby(['NAME_INCOME_TYPE','NAME_EDUCATION_TYPE'])['count'].transform(max) == data_occp['count']]\n\ndata_occp_final","4d213c7f":"def fill_occp(values):\n    profession = values[0]\n    degree = values[1]\n    occupation = values[2]\n    if pd.isnull(occupation):\n        for index,row in data_occp_final.iterrows():\n            if ((row['NAME_INCOME_TYPE'] == profession) and (row['NAME_EDUCATION_TYPE'] == degree)):\n                return row['OCCUPATION_TYPE']\n    else:\n        return occupation\n            \n            \ndata['OCCUPATION'] = data[['NAME_INCOME_TYPE','NAME_EDUCATION_TYPE','OCCUPATION_TYPE']].apply(fill_occp,axis=1)","705151cc":"OCCUPATION = pd.get_dummies(data['OCCUPATION'], drop_first=True)\n\nOCCUPATION.head()","a3b88b38":"px.box(data_frame=data, x='OCCUPATION_TYPE', y='INCOME')","33d8b22a":"OCCUPATION['CLASS 3 WORKERS'] = OCCUPATION[['Cleaning staff','Cooking staff','Drivers','Laborers','Low-skill Laborers','Security staff','Waiters\/barmen staff']].sum(axis=1)\nOCCUPATION['CLASS 2 WORKERS'] = OCCUPATION[['HR staff','Sales staff','Secretaries','Medicine staff','Private service staff']].sum(axis=1)\nOCCUPATION['CLASS 1 WORKERS'] = OCCUPATION[['Managers','Core staff','High skill tech staff','IT staff','Realty agents']].sum(axis=1)\n\n\nOCCUPATION.drop(['Cleaning staff','Cooking staff','Drivers','Laborers','Low-skill Laborers','Security staff','Waiters\/barmen staff','HR staff','Sales staff','Secretaries','Medicine staff','Private service staff','Managers','High skill tech staff','IT staff','Realty agents','Core staff'], axis=1,inplace=True)\n","edbd2563":"OCCUPATION.head()","d6241e28":"data = pd.concat([data, OCCUPATION], axis=1)","b441b69e":"data['NAME_HOUSING_TYPE'].value_counts()","cf72de3f":"data['OWN_HOUSE'] = data['NAME_HOUSING_TYPE'].apply(lambda x: 1 if x == 'House \/ apartment' else 0)","6aef83cf":"data.drop(['ID','NAME_INCOME_TYPE','NAME_EDUCATION_TYPE','NAME_FAMILY_STATUS','NAME_HOUSING_TYPE','OCCUPATION_TYPE','MONTHS_BALANCE','OCCUPATION'], axis=1, inplace=True)\n\ndata.rename(columns={'CNT_CHILDREN':'CHILD','FLAG_MOBIL':'MOBIL','FLAG_PHONE':'PHONE','FLAG_EMAIL':'EMAIL','CNT_FAM_MEMBERS':'FAMILY_MEMBERS'}, inplace=True)\ndata.head()","fe7d42cd":"from imblearn.over_sampling import SMOTE\n\nX = data.drop('RISK', axis=1)\ny = data['RISK']\n\n\nX_bal,y_bal = SMOTE().fit_sample(X,y)\n\nX_bal = pd.DataFrame(X_bal, columns=X.columns)","36b86d69":"from sklearn.model_selection import train_test_split\n\nX_train, X_test, y_train, y_test = train_test_split(X_bal,y_bal,stratify = y_bal,test_size=0.3, random_state=123)","68f28247":"from sklearn.linear_model import LogisticRegression\n\nlogReg = LogisticRegression()\n\nlogReg.fit(X_train, y_train)\n\ny_pred = logReg.predict(X_test)","a88cebc9":"from sklearn.metrics import confusion_matrix, classification_report\nfrom sklearn.metrics import roc_auc_score\n\nprint(\"Train Acc\")\nprint(logReg.score(X_train, y_train))\nprint(\"\\nTest Acc\")\nprint(logReg.score(X_test, y_test))\n\nprint(\"\\nAUC\")\nprint(roc_auc_score(y_test, y_pred))\n\nprint(confusion_matrix(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","416426ca":"from sklearn.model_selection import RandomizedSearchCV\n\nC = np.logspace(-3,1,5)\nmax_iter = [50,80,100,120,150,180,200]\npenalty = ['l2']\ntol = np.logspace(-8,-3,6)\n\nparam = {'C':C,'max_iter':max_iter,'tol':tol,'penalty':penalty}\n\nlogReg_cv = RandomizedSearchCV(estimator=logReg, \n                               param_distributions=param, \n                               n_iter=50, \n                               cv=10, \n                               scoring='accuracy', \n                               verbose=3, n_jobs=-1)\n\nlogReg_cv.fit(X_train, y_train)","fb6ec011":"logReg_best = logReg_cv.best_estimator_\n\ny_pred = logReg_best.predict(X_test)\nlogReg_cv.best_params_","4e2cea73":"from sklearn.metrics import confusion_matrix, classification_report\nfrom sklearn.metrics import roc_auc_score\n\nprint(\"Train Acc\")\nprint(logReg_best.score(X_train, y_train))\nprint(\"\\nTest Acc\")\nprint(logReg_best.score(X_test, y_test))\n\nprint(\"\\nAUC\")\nprint(roc_auc_score(y_test, y_pred))\n\nprint(confusion_matrix(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","b423d265":"from sklearn.svm import LinearSVC,SVC\n\nsvm = LinearSVC()\n\nsvm.fit(X_train, y_train)\n\ny_pred = svm.predict(X_test)","8a10b9ca":"print(\"Train Acc\")\nprint(svm.score(X_train, y_train))\nprint(\"\\nTest Acc\")\nprint(svm.score(X_test, y_test))\n\nprint(\"\\nAUC\")\nprint(roc_auc_score(y_test, y_pred))\n\nprint(confusion_matrix(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","7b6cea90":"C = np.logspace(-4,1,6)\ntol = np.logspace(-6,-2,5)\n\n\nparam = {'C':C, 'tol':tol}\nsvm_cv = RandomizedSearchCV(estimator=svm, \n                               param_distributions=param, \n                               n_iter=50, \n                               cv=10, \n                               scoring='accuracy', \n                               verbose=3, n_jobs=-1)\n\nsvm_cv.fit(X_train, y_train)\n\ny_pred = svm_cv.predict(X_test)","36d5f5b8":"svm_cv.best_params_","e015b352":"print(\"Train Acc\")\nprint(svm_cv.score(X_train, y_train))\nprint(\"\\nTest Acc\")\nprint(svm_cv.score(X_test, y_test))\n\nprint(\"\\nAUC\")\nprint(roc_auc_score(y_test, y_pred))\n\nprint(confusion_matrix(y_test, y_pred))","b0067c55":"from sklearn.neighbors import KNeighborsClassifier\nneighbours = np.arange(1,12)\n\ntrain_acc = np.empty(len(neighbours))\ntest_acc = np.empty(len(neighbours))\n\nfor i,n in enumerate(neighbours):\n    knn = KNeighborsClassifier(n_neighbors=n)\n    \n    knn.fit(X_train, y_train)\n    train_acc[i] = knn.score(X_train, y_train)\n    test_acc[i] = knn.score(X_test, y_test)\n    \n\nplt.plot(neighbours, train_acc, label='tain')\nplt.plot(neighbours, test_acc, label='test')","958de332":"knn_1 = KNeighborsClassifier(n_neighbors=1)\n\nknn_1.fit(X_train, y_train)\ny_pred = knn_1.predict(X_test)","e3e2e82f":"print('Train Acc')\nprint(knn_1.score(X_train, y_train))\nprint()\nprint('Test Acc')\nprint(knn_1.score(X_test, y_test))\n\n\nprint('Confusion_matrix')\nprint(confusion_matrix(y_test, y_pred))\n\nprint('Report')\nprint(classification_report(y_test, y_pred))\n\nprint(\"\\nAUC\")\nprint(roc_auc_score(y_test, y_pred))","57c030e7":"from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import RandomizedSearchCV\n\n\nrf = RandomForestClassifier()\n\nparams = {\n                'max_depth' : [3,4,5,6],\n                'min_samples_leaf' : [0.02,0.04,0.06],\n                'max_features' : [0.2,0.4,0.8],\n                'n_estimators' : [150,200,250]\n                \n        }\n\nrf_cv = RandomizedSearchCV(estimator=rf,\n                          param_distributions=params,\n                           n_iter=100,\n                          cv=3,\n                          scoring='accuracy',\n                          n_jobs=-1,\n                           verbose=3,\n                           random_state=123\n                          )\n\n","e8f41242":"rf_cv.fit(X_train, y_train)","259c48b2":"rf_cv.best_params_","70ed200b":"y_pred = rf_cv.predict(X_test)","a8e3cd5f":"print('Train Acc')\nprint(rf_cv.score(X_train, y_train))\nprint()\nprint('Test Acc')\nprint(rf_cv.score(X_test, y_test))\n\n\nprint('Confusion_matrix')\nprint(confusion_matrix(y_test, y_pred))\n\nprint('Report')\nprint(classification_report(y_test, y_pred))\n\nprint(\"\\nAUC\")\nprint(roc_auc_score(y_test, y_pred))","7885d6cf":"import xgboost as xgb\nfrom sklearn.model_selection import RandomizedSearchCV\n\n\n\nparams_xgb = {\n                'max_depth' : [3,4,5,6],\n                'min_samples_leaf' : [0.02,0.04,0.05,0.06],\n                'max_features' : [0.2,0.4,0.6,0.8,0.9],\n                'n_estimators' : [150,200,250],\n                'subsample' : np.arange(0.05,1.05,0.1),\n                'learning_rate' : np.arange(0.05,1.05,0.1),\n                'colsample_bytree' : np.arange(0.05,1.05,0.1),\n                'gamma' : [0.05,0.1,0.5,1]\n                           \n            }\n\ngbm = xgb.XGBClassifier()\n\nxgb_cv =     RandomizedSearchCV(estimator=gbm,\n                                n_iter=150,\n                                param_distributions=params_xgb, \n                                cv=3, scoring='accuracy',\n                                n_jobs=-1, verbose=2,\n                               random_state=123)","77beee5c":"xgb_cv.fit(X_train, y_train)","83d898aa":"xgb_cv.best_params_","ab3747f4":"xgb_pred = xgb_cv.predict(X_test)\n\nprint('Train Acc')\nprint(xgb_cv.score(X_train, y_train))\nprint(\"\\n\")\nprint('Test Acc')\nprint(xgb_cv.score(X_test, y_test))\n\nfrom sklearn.metrics import confusion_matrix, classification_report\n\nprint('Confusion_matrix')\nprint(confusion_matrix(y_test, xgb_pred))\n\nprint('Report')\nprint(classification_report(y_test, xgb_pred))","1d8cb44a":"#### Birth and employment time","7f9d0e77":"### Classifiers","ba51216e":"#### Drop rows having null Risk factor","e2fe8795":"#### Creating Target column","1b5c1e19":"#### Dummies","219e05e6":"#### KNN","fcd32cda":"#### Plot (decrease in salary with age) of Laborers","b9f7143d":"#### Fetching Highest Default for each user","9f1baf89":"#### Deleting outliers for Security staff","6066ad67":"#### Merge application and credit dataframes","3a25674a":"#### Find out the most common Occupation based on Profession and education type","4e65b251":"#### Creating Features and Target and Balancing the data using SMOTE","a6ccd158":"##### Tuning","14872293":"#### Fill null occupations based on above findings","16373b09":"#### Income","d6651991":"#### Log Reg","c8e34dfb":"#### Merging occupations ","5586fe05":"### Read file","a7973be2":"#### SVM","0b64edc8":"#### Encoding Columns","ddb30893":"#### Random Forrest","e53caf08":"##### Evaluate","e5b383c9":"#### XGB classifier","f61febfa":"#### Dividing Family Status into Married and UnMarried","4a85dd1a":"#### Drop duplicates","9a2a826d":"#### Drop and Rename columns ","d368a379":"#### Deleting Laborers having (age > than 45 and Salary >200K) and INCOME > 400 ","1ff1d7d4":"#### Merging housing type","cdf7a2e0":"##### Evaluate","a3042e9b":"### Imports"}}