{"cell_type":{"0ae178e7":"code","c6e56def":"code","5f54bbea":"code","d0425bd8":"code","15b5f3ca":"code","e3982571":"code","0cca302a":"code","c3ed50eb":"code","9f49bff2":"code","f175639d":"code","c493b064":"code","1950b35e":"code","378eeaeb":"code","419dce70":"code","4f72b888":"code","e3894c41":"code","0f1b1e6f":"code","d7be7bcc":"code","6e0eb64c":"code","4fad73e1":"code","331b80fd":"code","2c42e009":"code","59f3eec7":"code","14716292":"code","5228b072":"code","1fafdda1":"code","7958a264":"code","2adeae02":"code","86928832":"code","02acf723":"code","1a85b072":"code","ad9de683":"code","abf7341c":"code","71b93519":"code","9b1cf9e6":"code","723ad962":"code","aa3d0b41":"code","9f72df16":"code","5db97e0f":"markdown","09206af2":"markdown","7f2c97c8":"markdown","c5eacc5c":"markdown","8f971f58":"markdown","ea833fb7":"markdown","be8def1b":"markdown","5409257f":"markdown","ed1b6e2e":"markdown","5420da51":"markdown","882895aa":"markdown","815140df":"markdown","809316d6":"markdown","ebc0a370":"markdown","a0d5afc9":"markdown","9098efca":"markdown","84c3f577":"markdown","9ec6e017":"markdown","492ac84d":"markdown","98715d29":"markdown","267e99d4":"markdown","955fa5ae":"markdown","1d0592dc":"markdown","1b8941fd":"markdown"},"source":{"0ae178e7":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","c6e56def":"credit_df = pd.read_csv(\"\/kaggle\/input\/ccdata\/CC GENERAL.csv\")\ndf = credit_df.copy()\ncredit_df.head()","5f54bbea":"credit_df.info()","d0425bd8":"print(credit_df.shape)","15b5f3ca":"print(credit_df.isna().sum()) # To Check the no. of unavailable instances.","e3982571":"plt.figure(figsize=(10,5))\nplt.subplot(1,2,1)\nsns.distplot(credit_df.MINIMUM_PAYMENTS.dropna(), color='#fdc029')\nplt.subplot(1,2,2)\nsns.distplot(credit_df.CREDIT_LIMIT.dropna(), color='#fdc029')\nplt.show()","0cca302a":"credit_df['MINIMUM_PAYMENTS'].fillna(credit_df['MINIMUM_PAYMENTS'].mean(), inplace=True)\ncredit_df['CREDIT_LIMIT'].fillna(credit_df['CREDIT_LIMIT'].mean(), inplace=True)\n\nprint(credit_df[['MINIMUM_PAYMENTS','CREDIT_LIMIT']].isna().sum())","c3ed50eb":"credit_df.describe().T","9f49bff2":"plt.figure(figsize=(45,7))\nsns.boxplot(data=credit_df)\nplt.show()","f175639d":"credit_df.columns","c493b064":"credit_df['month_avg_purchase'] = credit_df['PURCHASES']\/(credit_df['TENURE'])\ncredit_df['cash_advance_amt'] = credit_df['CASH_ADVANCE']\/(credit_df['TENURE'])\ncredit_df[['month_avg_purchase','cash_advance_amt']].head()\n","1950b35e":"plt.figure(figsize=(10,4))\nsns.lineplot(credit_df['BALANCE'],credit_df['ONEOFF_PURCHASES'],label='Oneoff')\nsns.lineplot(credit_df['BALANCE'],credit_df['INSTALLMENTS_PURCHASES'],label=\"Installment\")\nplt.show()","378eeaeb":"print(credit_df[(credit_df['ONEOFF_PURCHASES'] == 0) & (credit_df['INSTALLMENTS_PURCHASES']==0)].shape)\nprint(credit_df[(credit_df['ONEOFF_PURCHASES']==0) & (credit_df['INSTALLMENTS_PURCHASES']>0)].shape)\nprint(credit_df[(credit_df['ONEOFF_PURCHASES']>0) & (credit_df['INSTALLMENTS_PURCHASES']==0)].shape)\nprint(credit_df[(credit_df['ONEOFF_PURCHASES']>0) & (credit_df['INSTALLMENTS_PURCHASES']>0)].shape)","419dce70":"def purchase_by_type(credit_df):\n    if (credit_df['ONEOFF_PURCHASES']==0) & (credit_df['INSTALLMENTS_PURCHASES']==0):\n        return 'none'\n    if (credit_df['ONEOFF_PURCHASES']>0) & (credit_df['INSTALLMENTS_PURCHASES']>0):\n         return 'dual'\n    if (credit_df['ONEOFF_PURCHASES']>0) & (credit_df['INSTALLMENTS_PURCHASES']==0):\n        return 'oneoff'\n    if (credit_df['ONEOFF_PURCHASES']==0) & (credit_df['INSTALLMENTS_PURCHASES']>0):\n        return 'installment'\n\ncredit_df['purchase_by_type'] = credit_df.apply(purchase_by_type,axis=1)\ncredit_df.head()","4f72b888":"credit_df['limit_usage'] = credit_df['BALANCE']\/credit_df['CREDIT_LIMIT']\ncredit_df['minimum_payment'] = credit_df['PAYMENTS']\/credit_df['MINIMUM_PAYMENTS']\ncredit_df[['limit_usage','minimum_payment']].head()","e3894c41":"credit_df.drop(['CUST_ID'],axis=1,inplace=True)","0f1b1e6f":"def scatter_tenure(field):\n    plt.figure(figsize=(8,4))\n    sns.lineplot(x='TENURE',y=field,data=credit_df)\n    plt.show()\nscatter_tenure('PURCHASES')\nsns.lineplot(x='TENURE',y='PURCHASES',data=credit_df)","d7be7bcc":"scatter_tenure('BALANCE')\nscatter_tenure('PAYMENTS')","6e0eb64c":"ratio = credit_df.groupby('purchase_by_type').apply(lambda x: np.mean(x['minimum_payment']))\nratio.values","4fad73e1":"fig,ax=plt.subplots()\nax.barh(y=range(len(ratio)),width=ratio.values)\nax.set(yticks=np.arange(len(ratio)),yticklabels=ratio.index)\nplt.title(\"Minimum_payment ratio for each purchase type\")\nplt.show()","331b80fd":"sns.barplot(y='CREDIT_LIMIT',x='purchase_by_type',data=credit_df)\nplt.show()\nsns.lineplot(y='CREDIT_LIMIT',x='purchase_by_type',data=credit_df,color='black')\nplt.show()","2c42e009":"sns.barplot(x='purchase_by_type',y='CASH_ADVANCE',data=credit_df)\nplt.show()","59f3eec7":"credit_df.dtypes","14716292":"credit_df=pd.get_dummies(credit_df)\ncredit_df.head()","5228b072":"sns.heatmap(credit_df.corr())","1fafdda1":"from sklearn.preprocessing import StandardScaler\nfrom sklearn.decomposition import PCA\nfrom sklearn.cluster import KMeans\n#Standarize Data\nscaler = StandardScaler()\nscaler_credit_df = scaler.fit_transform(credit_df)","7958a264":"from sklearn.decomposition import PCA\nratio_arr = {}\nfor i in range(4,15):\n    pca=PCA(n_components=i)\n    pca_data = pca.fit(scaler_credit_df)\n    ratio_arr[i]=sum(pca_data.explained_variance_ratio_)\nprint(ratio_arr)\npd.Series(ratio_arr).plot()","2adeae02":"pc = PCA(n_components=9).fit(scaler_credit_df)\npca_reduced_final = pc.fit_transform(scaler_credit_df)\n\nfinal_df = pd.DataFrame(pca_reduced_final)\nprint(final_df.shape)\ncol_list = credit_df.columns\ncol_list\n\n#pc.explained_variance_ratio_\n","86928832":"pd.DataFrame(pc.components_.T,columns=['Component_'+str(i) for i in range(9)],index=col_list)","02acf723":"from sklearn.metrics import silhouette_score\nn_clusters = 10\ncost = []\n\n\nfor i in range(1,10):\n    kmeans = KMeans(i)\n    kmeans.fit(pca_reduced_final)\n    cost.append(kmeans.inertia_)\nplt.plot(cost,'bx-')\nplt.show()","1a85b072":"score=0\nkm = KMeans(5)\nkm.fit(pca_reduced_final)\nscore=silhouette_score(pca_reduced_final,km.labels_)","ad9de683":"score","abf7341c":"col_kpi=['BALANCE', 'BALANCE_FREQUENCY', 'PURCHASES', 'ONEOFF_PURCHASES',\n       'INSTALLMENTS_PURCHASES', 'CASH_ADVANCE', 'PURCHASES_FREQUENCY',\n       'ONEOFF_PURCHASES_FREQUENCY', 'PURCHASES_INSTALLMENTS_FREQUENCY',\n       'CASH_ADVANCE_FREQUENCY', 'CASH_ADVANCE_TRX', 'PURCHASES_TRX',\n       'CREDIT_LIMIT', 'PAYMENTS', 'MINIMUM_PAYMENTS', 'PRC_FULL_PAYMENT',\n       'TENURE', 'month_avg_purchase', 'cash_advance_amt', 'limit_usage',\n       'minimum_payment', 'purchase_by_type_dual',\n       'purchase_by_type_installment', 'purchase_by_type_none',\n       'purchase_by_type_oneoff']","71b93519":"from sklearn.pipeline import Pipeline\n\npreprocess = Pipeline(\n    [(\"scaler\",StandardScaler()),\n    (\"pca\",PCA(n_components=9,random_state=42))\n    ]\n)\n\ncluster = Pipeline(\n    [\n        ('km',KMeans(n_clusters=5,init='k-means++',n_init=50,random_state=42))\n    ]\n)\n\npipe = Pipeline(\n    [\n        (\"preprocess\",preprocess),\n        (\"cluster\",cluster)\n    ]\n)\n\npipe.fit(credit_df)","9b1cf9e6":"preprocessed_data = pipe['preprocess'].transform(credit_df)\npredicted_labels = pipe['cluster']['km'].labels_\nsilhouette_score(preprocessed_data,predicted_labels)","723ad962":"cluster_df = pd.concat([credit_df[col_kpi],pd.Series(pipe['cluster']['km'].labels_,name=\"Cluster\")],axis=1)\ncluster_df.head()","aa3d0b41":"five_cluster=cluster_df.groupby('Cluster').apply(lambda x: x[col_kpi].mean()).T\nfive_cluster","9f72df16":"fig,ax=plt.subplots(figsize=(15,10))\nindex=np.arange(len(five_cluster.columns))\n\ncash_advance=np.log(five_cluster.loc['cash_advance_amt',:].values)\ncredit_score=(five_cluster.loc['limit_usage',:].values)\npurchase= np.log(five_cluster.loc['month_avg_purchase',:].values)\npayment=five_cluster.loc['minimum_payment',:].values\ninstallment=five_cluster.loc['purchase_by_type_installment',:].values\none_off=five_cluster.loc['purchase_by_type_oneoff',:].values\n\n\nbar_width=.10\nb1=plt.bar(index,cash_advance,color='b',label='cash_advance_amt',width=bar_width)\nb2=plt.bar(index+bar_width,credit_score,color='m',label='Credit_score',width=bar_width)\nb3=plt.bar(index+2*bar_width,purchase,color='k',label='Avg purchase',width=bar_width)\nb4=plt.bar(index+3*bar_width,payment,color='c',label='Payment-minpayment ratio',width=bar_width)\nb5=plt.bar(index+4*bar_width,installment,color='r',label='installment',width=bar_width)\nb6=plt.bar(index+5*bar_width,one_off,color='g',label='One_off purchase',width=bar_width)\n\nplt.xlabel(\"Cluster\")\nplt.title(\"Insights\")\nplt.xticks(index + bar_width, ('Cl-0', 'Cl-1', 'Cl-2', 'Cl-3','Cl-4'))\n\nplt.legend()","5db97e0f":"##### Customers who do installment purchases have good credit scores.","09206af2":"#### We can see that 9 components are explaining more than 80% variance so we select 9 components.","7f2c97c8":"#### Elbow point is at 5. So cluster choose is 5","c5eacc5c":"### We can see that distribution is skewed so we will use Median to fill these values.","8f971f58":"###### When we add all these rows we get is 8950 i.e total no. of rows so we can infer following things:\n        1) Customer prefering One-Off Purchases.\n        2) Customer prefering Installments Purchases.\n        3) Customers preferring both.\n        4) Customers preferring none.","ea833fb7":"# Step 1 (Importing Libraries and Data)","be8def1b":"### As we need to define marketing strategy, let's think how a bank will get  benefits. I believe a bank makes money from roping people in for longer amounts of time as well as making purchases. I think purchases, balance, and payments are the best play because they exemplify the baseline services of a bank (getting people to have more with the bank, pay them more, and spend more overall to have to pay back) without those key problems.","5409257f":"##### Customers who don't dealt with either  installment or oneoff purchases generally takes more cash in advance.","ed1b6e2e":"#### As, only 'purchase_by_type' field is of object type so we will create dummy variable for it.","5420da51":"#### We will be using Kmeans algo. for clustering and be using Elbow method for verifying number of clusters.","882895aa":"### Let's derive some KPI's\n     1)  Monthly average purchase->(month_avg_purchase)-> PURCHASE\/(PURCHASE_FREQUENCY*TENURE)\n     2)  Cash advance amount->(cash_advance_amt)-> CASH_ADVANCE\/(PURCHASE_FREQUENCY*TENURE)","815140df":"##### Now we are set with missing Values.","809316d6":"### Let's first check out the distribution of CREDIT_LIMIT and MINIMUM_PAYMENTS to get an idea which method to use for filling null values.","ebc0a370":"# Step 2: EDA","a0d5afc9":"##### We can see that as tenure increases the purchase amount also increases.","9098efca":"### N_components=9 and Cluster=5","84c3f577":"### Cluster0:\n    This group is performing best among all as cutomers are maintaining good credit score and paying dues on time. -- Giving rewards point will make them perform more purchases.\n### Cluster1:\n    This group is a risky group as percent of full payment paid by user is not much.\n### Cluster2:\n    This group has minimum paying ratio and using card for both transactions.Also, have highest cash advance amount. This group is a risky group.\n### Cluster3:\n    They are potential customers who are paying dues and doing purchases and maintaining comparatively good credit score.\n### Cluster4:\n    This group of users have maintained good credit score can be lured by offering more incentives for the installment purchases.","9ec6e017":"##### Same phenomena is observed here.","492ac84d":"### We can see that attributes CREDIT_LIMIT and MINIMUM_PAYMENTS are missing values. Lets look at same.","98715d29":"#### Here we see that number of clusters suggested is 5 . The PCA transformation provides us better results. So we are creating a pipeline with Standard Scaler, PCA and KMeans together.","267e99d4":"## 3 Step (Transformation)","955fa5ae":"### Now as collinearity between variables is too much we will be using PCA to trim down some attributes.","1d0592dc":"#### When we observe the boxplot we find the presence of many outliers but it's better not to handle outliers because we want to analyse all types of customers so better not to handle them.","1b8941fd":"###### 3) Purchase_type\n    In data there are two type of purchases i.e oneoff_purchase and installments_purchase. We will check if there is any relation between these two fields. "}}