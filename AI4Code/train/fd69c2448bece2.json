{"cell_type":{"65106eeb":"code","c58fb348":"code","d4bf1611":"code","407998f9":"code","2534b575":"code","d7b72aea":"code","74a62b27":"code","b08653e5":"code","f263cd5a":"code","7bed3279":"code","30a00344":"code","c62d582a":"code","cacf1935":"code","1bfd0238":"code","611426ed":"code","66327855":"code","91d681b3":"code","49ad0bc1":"code","c32c9092":"code","74d44629":"code","24a3737c":"code","3c1366b6":"code","36c2be53":"code","78def0d8":"code","1ff2c189":"code","4fff2fff":"code","16f904cc":"code","b158aad6":"code","73415c44":"code","491f1ed3":"code","fe8a3099":"code","3f977837":"code","b6857b9b":"code","eee4defa":"code","732d7863":"code","01fa1ec2":"code","ee8510d8":"code","ca37885f":"code","f56034d8":"code","cba8a59b":"code","9551829a":"code","698496cf":"markdown","cc942cfc":"markdown","36155b99":"markdown","1cd39904":"markdown","6a49ab2d":"markdown","0e84599d":"markdown","5a5df311":"markdown","137ed7d9":"markdown","2cb6e5bc":"markdown","cd36d1c7":"markdown","16043ee2":"markdown","85225f9b":"markdown","f7b313d0":"markdown","6cfb66f3":"markdown","630a01dc":"markdown","e1daf1a6":"markdown","118ca0c5":"markdown","ca382b4d":"markdown","94e467f5":"markdown","3cc3f038":"markdown","c6f2a4ed":"markdown","db7bad22":"markdown","10e02340":"markdown","04a63657":"markdown","bb379ad1":"markdown","12576423":"markdown"},"source":{"65106eeb":"pip install mglearn","c58fb348":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport mglearn\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.metrics import confusion_matrix,accuracy_score\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import cross_val_score\nfrom xgboost import XGBClassifier\nfrom sklearn.neural_network import MLPClassifier\nfrom sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier\n\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense , Activation\nfrom tensorflow.keras.utils import to_categorical\n\nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)","d4bf1611":"url = \"\/kaggle\/input\/telecom-churn\/telecom_churn.csv\"\ndf = pd.read_csv(url)","407998f9":"# Show Data","2534b575":"df.head()","d7b72aea":"# Data Editing","74a62b27":"df.shape","b08653e5":"df.info()","f263cd5a":"df_describe = df.describe().T\ndf_describe","7bed3279":"labels = ['Churn', 'Not Churn']\nsizes = df['Churn'].value_counts(sort = True)\n\ncolors = [\"#ffb3b3\",\"#C2C4E2\"]\nexplode = (0.05,0) \n \nplt.figure(figsize=(7,7))\nplt.suptitle(\"Number of Targets in the dataset\",y=0.9, size=18, weight='bold')\nplt.pie(sizes, explode=explode, labels=labels, colors=colors, autopct='%1.1f%%', shadow=True, \n        startangle=90, textprops={\"fontsize\":20})\n\nplt.show()","30a00344":"ax = plt.figure(figsize=(10,10))\nplt.subplot(2,2,1)\nsns.countplot(data = df , x = \"ContractRenewal\" , palette=\"Reds\", edgecolor='k')\nplt.title(\"Count Plot for Contract Renewal\" , size=18, fontweight='bold', fontfamily='monospace')\nplt.xlabel(\"Contract Renewal\", size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel('')\nplt.subplot(2,2,2)\nsns.countplot(data = df , x = \"DataPlan\" , palette=\"Reds\", edgecolor='k')\nplt.title(\"Count Plot for Data Plan\" , size=18, fontweight='bold', fontfamily='monospace')\nplt.xlabel(\"Data Plan\", size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel('')\nplt.subplot(2,2,(3,4))\nsns.countplot(data = df , x = \"CustServCalls\" , palette=\"Reds\", edgecolor='k')\nplt.title(\"Count Plot for Customer Service Calls Renewal\" , size=18, fontweight='bold', fontfamily='monospace')\nplt.xlabel(\"Customer Service Calls Renewal\", size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel('')\nplt.tight_layout()\nplt.show()","c62d582a":"ax = plt.figure(figsize=(8,8))\nplt.subplot(2,2,1)\nsns.boxenplot(data = df , y = \"AccountWeeks\" , x = \"Churn\" , palette=\"Reds\")\nplt.grid(True)\nplt.xlabel(\"Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel(\"AccountWeeks\",size=13, fontweight='light', fontfamily='monospace')\nplt.subplot(2,2,2)\nsns.boxenplot(data = df , y = \"DataUsage\" ,  x = \"Churn\" , palette=\"Reds\")\nplt.grid(True)\nplt.xlabel(\"Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel(\"DataUsage\",size=13, fontweight='light', fontfamily='monospace')\nplt.subplot(2,2,3)\nsns.boxenplot(data = df , y = \"DayMins\" , x = \"Churn\" , palette=\"Reds\")\nplt.grid(True)\nplt.xlabel(\"Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel(\"DayMins\",size=13, fontweight='light', fontfamily='monospace')\nplt.subplot(2,2,4)\nsns.boxenplot(data = df , y = \"DayCalls\" , x = \"Churn\" , palette=\"Reds\")\nplt.grid(True)\nplt.xlabel(\"Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel(\"DayCalls\",size=13, fontweight='light', fontfamily='monospace')\nplt.tight_layout()\nplt.show()","cacf1935":"ax = plt.figure(figsize=(8,8))\nplt.subplot(2,2,1)\nsns.boxenplot(data = df , y = \"MonthlyCharge\" , x = \"Churn\" , palette=\"Reds\")\nplt.grid(True)\nplt.xlabel(\"Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel(\"MonthlyCharge\",size=13, fontweight='light', fontfamily='monospace')\nplt.subplot(2,2,2)\nsns.boxenplot(data = df , y = \"OverageFee\" , x = \"Churn\" , palette=\"Reds\")\nplt.grid(True)\nplt.xlabel(\"Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel(\"OverageFee\",size=13, fontweight='light', fontfamily='monospace')\nplt.subplot(2,2,3)\nsns.boxenplot(data = df , y = \"RoamMins\" , x = \"Churn\" , palette=\"Reds\")\nplt.grid(True)\nplt.xlabel(\"Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel(\"RoamMins\",size=13, fontweight='light', fontfamily='monospace')\nplt.subplot(2,2,4)\nsns.boxenplot(data = df , y = \"CustServCalls\" , x = \"Churn\" , palette=\"Reds\")\nplt.grid(True)\nplt.xlabel(\"Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel(\"CustServCalls\",size=13, fontweight='light', fontfamily='monospace')\nplt.tight_layout()\nplt.show()","1bfd0238":"ax = plt.figure(figsize=(10,5))\ndf.groupby(['ContractRenewal',\"DataPlan\"])['Churn'].mean().plot(figsize=(10,5),kind=\"barh\",color=\"#c24040\",\n                                                               edgecolor='k')\nplt.title(\"Average Plot for Churn\" , size=18, fontweight='bold', fontfamily='monospace')\nplt.ylabel(\"ContractRenewal, DataPlan\",size=13, fontweight='light', fontfamily='monospace')\nplt.xlabel(\"Average of Churn\",size=13, fontweight='light', fontfamily='monospace')\nplt.grid(True)\nplt.show()","611426ed":"print(\"Churn:0 and Churn:1\")\nmean_df = df.mean().reset_index()\nmean_df.columns = ['Feature', 'Mean']\nmean_df.set_index('Feature')","66327855":"print(\"Churn:0\")\nmean_df = df.loc[df[\"Churn\"]==0].mean().reset_index()\nmean_df.columns = ['Feature', 'Mean']\nmean_df.set_index('Feature')","91d681b3":"print(\"Churn:1\")\nmean_df = df.loc[df[\"Churn\"]==1].mean().reset_index()\nmean_df.columns = ['Feature', 'Mean']\nmean_df.set_index('Feature')","49ad0bc1":"ax = plt.figure(figsize=(12,10))\nsns.heatmap(df.corr(),annot=True,cmap=\"Reds\", fmt='.0%')\nplt.show()","c32c9092":"sns.pairplot(data = df[[\"DataUsage\",\"DayMins\",\"MonthlyCharge\",\"Churn\"]],\n            hue=\"Churn\", palette='Reds')\nplt.show()","74d44629":"mglearn.plots.plot_grid_search_overview();\nplt.show()","24a3737c":"scaler = StandardScaler().fit(df.drop(\"Churn\",axis=1))","3c1366b6":"X = scaler.transform(df.drop(\"Churn\",axis=1))\ny = df[\"Churn\"]","36c2be53":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size =0.20,random_state=0)","78def0d8":"from sklearn.metrics import plot_roc_curve,plot_confusion_matrix,accuracy_score,confusion_matrix\ndef Model(model):\n    global X,y,X_train, X_test, y_train, y_test\n    print(type(model).__name__)\n    pred = model.predict(X_test)\n    acs = accuracy_score(y_test,pred)\n    print(\"Accuracy Score             :\",acs)\n    \n    plot_confusion_matrix(model,X,y,cmap=\"Reds\")\n    plt.title(\"Confusion Matrix\")\n    plt.show()","1ff2c189":"def Check(list_of_disp):\n    ax = plt.gca()\n    for i in list_of_disp: \n        i.plot(ax=ax)\n    plt.plot([0,1],[0,1],\"--\",color=\"k\",alpha=0.7)\n    plt.title(\"ROC Curve of Classifiers\")\n    plt.show()","4fff2fff":"from sklearn.model_selection import cross_val_score\ndef CrossValidationScore(model_list):\n    global X,y\n    \n    mean_cross_val_score = []\n    model_name           = []\n    \n    for model in model_list:\n        model_name.append(type(model).__name__)\n        \n    for i in model_list:\n        scores = cross_val_score(i, X, y, cv=5)\n        mean_cross_val_score.append(scores.mean())\n        \n    cvs = pd.DataFrame({\"Model Name\":model_name,\"CVS\":mean_cross_val_score})\n    return cvs.style.background_gradient(\"Greens\")","16f904cc":"def Predict(model,AccountWeeks,\n           ContractRenewal,\n           DataPlan,\n           DataUsage,\n           CustServCalls,\n           DayMins,\n           DayCalls,\n           MonthlyCharge,\n           OverageFee,\n           RoamMins):\n    result = model.predict([[AccountWeeks,\n           ContractRenewal,\n           DataPlan,\n           DataUsage,\n           CustServCalls,\n           DayMins,\n           DayCalls,\n           MonthlyCharge,\n           OverageFee,\n           RoamMins]])\n    print(\"Churn:\",result[0])","b158aad6":"k_max = 30\nacc = [[],[]]\nfor k in range(1,k_max+1):\n    mdl = KNeighborsClassifier(n_neighbors=k).fit(X_train,y_train)\n    pred = mdl.predict(X_test)\n    acc[0].append(k)\n    acc[1].append(accuracy_score(y_test, pred)) \nacc = np.array(acc)\nmax_acc_k = acc[1].argmax()\nplt.figure(figsize=(10,5))\nplt.plot(acc[0],acc[1], color='k', ls=\"--\")\nplt.scatter(x=acc[0][max_acc_k], y=acc[1][max_acc_k],s=50, label=\"Max Accuracy: {}\\nK: {}\".format(round(acc[1][max_acc_k],2),\n                                                                                                 acc[0][max_acc_k]), color='#c24040')\nplt.legend()\nplt.grid(True)\nplt.title(\"Accuracy Score for each K\" , size=18, fontweight='bold', fontfamily='monospace')\nplt.xlabel(\"K\", size=13, fontweight='light', fontfamily='monospace')\nplt.ylabel('Accuracy', size=13, fontweight='light', fontfamily='monospace')\nplt.show()","73415c44":"knn = KNeighborsClassifier(n_neighbors=5).fit(X_train,y_train)\nprint(\"Model Installed!\")\nprint(\"Please Wait for Results..\")\nModel(knn)\n\nknn_disp = plot_roc_curve(knn, X_test, y_test)\nplt.title(\"ROC Curve of {}\".format(type(knn).__name__))\nplt.plot([0,1],[0,1],\"--\",color=\"k\",alpha=0.7)\nplt.show()","491f1ed3":"y_train_cat = to_categorical(y_train)\ny_test_cat = to_categorical(y_test)","fe8a3099":"model = Sequential()\n\nmodel.add(Dense(64,input_shape=X_train[0].shape,activation=\"sigmoid\"))\n\nmodel.add(Dense(128,activation=\"relu\"))\n\nmodel.add(Dense(64,activation=\"relu\"))\n\nmodel.add(Dense(2,activation=\"softmax\"))\n\nmodel.compile(loss=\"binary_crossentropy\",optimizer=\"adam\",metrics=[\"acc\"])","3f977837":"history = model.fit(X_train,y_train_cat,batch_size=32,epochs=20,validation_data=(X_test, y_test_cat))","b6857b9b":"plt.figure(figsize=(14,5))\nplt.subplot(1,2,1)\nplt.plot(history.history[\"acc\"],color='#6b0e0e')\nplt.plot(history.history[\"val_acc\"],color='#f56c6c')\nplt.xlabel(\"Epochs\")\nplt.ylabel(\"Acc\")\nplt.legend([\"Training\",\"Validation\"])\nplt.grid()\nplt.subplot(1,2,2)\nplt.plot(history.history[\"loss\"],color='#6b0e0e')\nplt.plot(history.history[\"val_loss\"],color='#f56c6c')\nplt.xlabel(\"Epochs\")\nplt.ylabel(\"Loss\")\nplt.legend([\"Training\",\"Validation\"])\nplt.grid()\nplt.show()","eee4defa":"pred_class = model.predict(X_test)\n\ndef toClass(pred):\n    \n    class_ = np.zeros(len(pred))\n    for i in range(len(pred)):\n        index = pred[i].argmax()\n        class_[i] = index\n        \n    return class_\n\nfrom sklearn.metrics import classification_report\nprint(classification_report(toClass(y_test_cat),toClass(pred_class)))","732d7863":"rfc = RandomForestClassifier(n_estimators=100).fit(X_train,y_train)\nprint(\"Model Installed!\")\nprint(\"Please Wait for Results..\")\nModel(rfc)\n\nrfc_disp = plot_roc_curve(rfc, X_test, y_test)\nplt.title(\"ROC Curve of {}\".format(type(rfc).__name__))\nplt.plot([0,1],[0,1],\"--\",color=\"k\",alpha=0.7)\nplt.show()","01fa1ec2":"gbc = GradientBoostingClassifier(n_estimators=100).fit(X_train,y_train)\nprint(\"Model Installed!\")\nprint(\"Please Wait for Results..\")\nModel(rfc)\n\ngbc_disp = plot_roc_curve(gbc, X_test, y_test)\nplt.title(\"ROC Curve of {}\".format(type(gbc).__name__))\nplt.plot([0,1],[0,1],\"--\",color=\"k\",alpha=0.7)\nplt.show()","ee8510d8":"xgb = XGBClassifier().fit(X_train,y_train)\nprint(\"Model Installed!\")\nprint(\"Please Wait for Results..\")\nModel(rfc)\n\nxgb_disp = plot_roc_curve(xgb, X_test, y_test)\nplt.title(\"ROC Curve of {}\".format(type(xgb).__name__))\nplt.plot([0,1],[0,1],\"--\",color=\"k\",alpha=0.7)\nplt.show()","ca37885f":"list_of_disp = [knn_disp,rfc_disp,gbc_disp,xgb_disp]\nCheck(list_of_disp)","f56034d8":"mglearn.plots.plot_cross_validation();\nplt.show();","cba8a59b":"model_list = [knn, rfc, gbc, xgb]\ncros_val_df = CrossValidationScore(model_list)\ncros_val_df","9551829a":"Predict(\n    model=rfc,\n    AccountWeeks=102.6,\n    ContractRenewal=0,\n    DataPlan=0,\n    DataUsage=0,\n    CustServCalls=5,\n    DayMins=295,\n    DayCalls=102,\n    MonthlyCharge=60,\n    OverageFee=11,\n    RoamMins=11,\n)","698496cf":"<a id=\"t3.1\"><\/a>\n## 3.1 Split data for train and test","cc942cfc":"\n1. [Import data and python packages](#t1.)\n    * Import packages\n    * Import data\n    * Data shape and info\n2. [Data visualization](#t2.)\n    * Count plots\n    * Box plots\n    * Sunburst\n    * Heatmap(Correlation)\n    * Pairplot\n3. [Classification](#t3.)\n\n    3.1 [Split data for train and test](#t3.1)\n    \n    3.2 [Functions for models](#t3.2)\n    \n    3.3 [Models](#t3.3)\n      * KNN Classifier\n      * MLP Classifier\n      * Random Forest Classifier\n      * Gradient Boosting Classifier\n      * XGB Classifier\n4. [Result](#t4.)\n      * Cross validation scores","36155b99":"<a id=\"t4.\"><\/a>\n# 4. Result","1cd39904":"#### XGB CLASSIFIER","6a49ab2d":"### The Gradient Boosting Classifier's Accuracy Score is the highest, while the Random Forest Classifier's Cross Validation Score is higher. Random Forest Classifier is run to classify this dataset.","0e84599d":"<a id=\"t3.\"><\/a>\n# 3. Classification","5a5df311":"<a id=\"t2.\"><\/a>\n# 2. Data visualization","137ed7d9":"<a id=\"t1.\"><\/a>\n# 1. Import data and python packages","2cb6e5bc":"#### RANDOM FOREST CLASSIFIER","cd36d1c7":"<div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           background-color:Beige;\n           font-size:110%;\n           letter-spacing:0.5px\">\n\n<p style=\"padding: 10px;\n              color:black;\">\nWith the rapid development of telecommunication industry, the service providers are inclined more towards expansion of the subscriber base. To meet the need of surviving in the competitive environment, the retention of existing customers has become a huge challenge. It is stated that the cost of acquiring a new customer is far more than that for retaining the existing one. Therefore, it is imperative for the telecom industries to use advanced analytics to understand consumer behavior and in-turn predict the association of the customers as whether or not they will leave the company.\n<\/p>\n<\/div> ","16043ee2":"### Increasing DataUsage decreases the probability of churn customer and decreasing other attributes decreases the probability of churn customer. I classified and averaged the Churn attribute to create this chart.","85225f9b":"<div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           background-color:Beige;\n           font-size:110%;\n           letter-spacing:0.5px\">\n\n<p style=\"padding: 10px;\n              color:black;\">\nSome possible insights could be -\n\n1. What variables are contributing to customer churn?\n2. Who are the customers more likely to churn?\n3. What actions can be taken to stop them from leaving?\n<\/p>\n<\/div> ","f7b313d0":"#### K NEIGHBORS CLASSIFIER","6cfb66f3":" <div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:LightSlateGray;\n           font-size:150%;\n           text-align:center;\n           letter-spacing:0.5px\">\n     CUSTOMER CHURN ANALYSIS AND CLASSIFICATION\n<\/div>","630a01dc":"#### CROSS VALIDATION SCORE","e1daf1a6":"### There aren't null-data and non numeric data in data set.","118ca0c5":"#### GRADIENT BOOSTING CLASSIFIER","ca382b4d":"### ContractRenewal and DataPlan attributes are two important attributes in customer churn. If these two attributes are \"1\", the probability of customer churn is low. ContractRenewal's impact is greater than DataPlan.","94e467f5":"### The model with the highest Accuracy Score is Gradient Boosting Classifier. At the same time, when looking at the ROC curve of Gradient Boosting Classifier, it is seen that it learns the classes better than other models.","3cc3f038":"<center><img src=\"https:\/\/www.scenicsolutionsgroup.com\/wp-content\/uploads\/2018\/02\/Telecommunication.jpg?quality=100.3018032623280\"><\/center>","c6f2a4ed":"<a id=\"t3.2\"><\/a>\n## 3.2 Functions for models","db7bad22":"<a id=\"t3.3\"><\/a>\n## 3.3 Models","10e02340":" <div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:LightSlateGray;\n           font-size:150%;\n           text-align:center;\n           letter-spacing:0.5px\">\n     Inspiration\n<\/div>","04a63657":"#### ARTIFICIAL NEURAL NETWORK\n##### Multi-layer Perceptron classifier","bb379ad1":" <div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:LightSlateGray;\n           font-size:150%;\n           text-align:center;\n           letter-spacing:0.5px\">\n     Introduction\n<\/div>","12576423":"### Data Frame with descriptive statistics for attributes"}}