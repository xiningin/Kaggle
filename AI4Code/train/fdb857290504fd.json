{"cell_type":{"97d62bec":"code","8fe7cc77":"code","71bd8f70":"code","31339821":"code","7a9d08db":"code","dfbc62a1":"code","01c163ae":"code","34197b67":"code","ec086db4":"markdown","a184d681":"markdown","46d0a3dc":"markdown","c8802984":"markdown","ca7e974e":"markdown","c380041a":"markdown","9b4c1928":"markdown","115eb16d":"markdown"},"source":{"97d62bec":"import pandas as pd\nimport numpy as np\nfrom xgboost import XGBRegressor\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import mean_absolute_error\n\ndata = pd.read_csv(\"..\/input\/train.csv\")\nY = data.SalePrice\nX = data.drop([\"SalePrice\"], axis=1)\n\ntest = pd.read_csv(\"..\/input\/test.csv\")\n\nX.describe()","8fe7cc77":"#MSSubClass is actually categorical, not numerical, but NaN cannot be deduced from logic\nX.MSSubClass = X.MSSubClass.astype(\"O\")\ntest.MSSubClass = test.MSSubClass.astype(\"O\")\n#ExterQual, ExterCond, BsmtQual, BsmtCond, BsmtExposure\n#BsmtFinType1, BsmtFinType2, HeatingQC, KitchenQual\n#Functional, FirePlaceQu, GarageFinish, GarageQual \n#GarageCond, PavedDrive, PoolQC are object but has numerical relation (ex > gd)\nX.replace({\"ExterQual\": {\"Ex\": 5,\n                         \"Gd\": 4,\n                         \"TA\": 3,\n                         \"Fa\": 2,\n                         \"Po\": 1\n                        },\n           \"ExterCond\": {\"Ex\": 5,\n                         \"Gd\": 4,\n                         \"TA\": 3,\n                         \"Fa\": 2,\n                         \"Po\": 1\n                        },\n           \"BsmtQual\": {\"Ex\": 5,\n                        \"Gd\": 4,\n                        \"TA\": 3,\n                        \"Fa\": 2,\n                        \"Po\": 1,\n                        np.nan: 0\n                        },\n           \"BsmtCond\": {\"Ex\": 5,\n                        \"Gd\": 4,\n                        \"TA\": 3,\n                        \"Fa\": 2,\n                        \"Po\": 1,\n                        np.nan: 0\n                        },\n           \"BsmtExposure\": {\"Gd\": 4,\n                            \"Av\": 3,\n                            \"Mn\": 2,\n                            \"No\": 1,\n                            np.nan: 0\n                            },\n           \"BsmtFinType1\": {\"GLQ\": 6,\n                            \"ALG\": 5,\n                            \"BLQ\": 4,\n                            \"Rec\": 3,\n                            \"LwQ\": 2,\n                            \"Unf\": 1,\n                            np.nan: 0\n                            },\n           \"BsmtFinType2\": {\"GLQ\": 6,\n                            \"ALG\": 5,\n                            \"BLQ\": 4,\n                            \"Rec\": 3,\n                            \"LwQ\": 2,\n                            \"Unf\": 1,\n                            np.nan: 0\n                            },\n           \"HeatingQC\": {\"Ex\": 5,\n                         \"Gd\": 4,\n                         \"TA\": 3,\n                         \"Fa\": 2,\n                         \"Po\": 1\n                        },\n           \"KitchenQual\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                        },\n           \"Functional\": {\"Typ\": 7,\n                          \"Min1\": 6,\n                          \"Min2\": 5,\n                          \"Mod\": 4,\n                          \"Maj1\": 3,\n                          \"Maj2\": 2,\n                          \"Sev\": 1,\n                          \"Sal\": 0\n                          },\n           \"FireplaceQu\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                          },\n           \"GarageFinish\": {\"Fin\": 3,\n                            \"RFn\": 2,\n                            \"Unf\": 1,\n                            np.nan: 0\n                          },\n           \"GarageQual\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                          },\n           \"GarageCond\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                          },\n           \"PavedDrive\": {\"Y\": 3,\n                            \"P\": 2,\n                            \"N\": 1,\n                            np.nan: 0\n                          },\n           \"PoolQC\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                          }\n          }, inplace=True)\ntest.replace({\"ExterQual\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1\n                           },\n              \"ExterCond\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1\n                           },\n              \"ExterCond\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                           },\n           \"BsmtQual\": {\"Ex\": 5,\n                        \"Gd\": 4,\n                        \"TA\": 3,\n                        \"Fa\": 2,\n                        \"Po\": 1,\n                        np.nan: 0\n                        },\n              \"BsmtCond\": {\"Ex\": 5,\n                           \"Gd\": 4,\n                           \"TA\": 3,\n                           \"Fa\": 2,\n                           \"Po\": 1,\n                           np.nan: 0\n                          },\n           \"BsmtExposure\": {\"Gd\": 4,\n                            \"Av\": 3,\n                            \"Mn\": 2,\n                            \"No\": 1,\n                            np.nan: 0\n                            },\n           \"BsmtFinType1\": {\"GLQ\": 6,\n                            \"ALG\": 5,\n                            \"BLQ\": 4,\n                            \"Rec\": 3,\n                            \"LwQ\": 2,\n                            \"Unf\": 1,\n                            np.nan: 0\n                            },\n           \"BsmtFinType2\": {\"GLQ\": 6,\n                            \"ALG\": 5,\n                            \"BLQ\": 4,\n                            \"Rec\": 3,\n                            \"LwQ\": 2,\n                            \"Unf\": 1,\n                            np.nan: 0\n                            },\n           \"HeatingQC\": {\"Ex\": 5,\n                         \"Gd\": 4,\n                         \"TA\": 3,\n                         \"Fa\": 2,\n                         \"Po\": 1\n                        },\n           \"KitchenQual\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                        },\n           \"Functional\": {\"Typ\": 7,\n                          \"Min1\": 6,\n                          \"Min2\": 5,\n                          \"Mod\": 4,\n                          \"Maj1\": 3,\n                          \"Maj2\": 2,\n                          \"Sev\": 1,\n                          \"Sal\": 0\n                          },\n           \"FireplaceQu\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                          },\n           \"GarageFinish\": {\"Fin\": 3,\n                            \"RFn\": 2,\n                            \"Unf\": 1,\n                            np.nan: 0\n                          },\n           \"GarageQual\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                          },\n           \"GarageCond\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                          },\n           \"PavedDrive\": {\"Y\": 3,\n                            \"P\": 2,\n                            \"N\": 1,\n                            np.nan: 0\n                          },\n           \"PoolQC\": {\"Ex\": 5,\n                            \"Gd\": 4,\n                            \"TA\": 3,\n                            \"Fa\": 2,\n                            \"Po\": 1,\n                            np.nan: 0\n                          }\n          }, inplace=True)","71bd8f70":"XClean = X.select_dtypes(exclude=[\"O\"])\n#XClean.isna().sum() to see where NaN are\nXClean.fillna(0, inplace=True)\ntestClean = test.select_dtypes(exclude=[\"O\"])\n#testClean.isna().sum() to see where NaN are\ntestClean.fillna(0, inplace=True)","31339821":"pipeline = Pipeline([#imputer \n                     #encoder\n                     #feature select or reduction\n                     (\"model\", XGBRegressor(random_state=0))\n                    ])\n","7a9d08db":"trainX, testX, trainY, testY = train_test_split(XClean, Y)\nparamGrid = {\n    \"model__n_estimators\": [10, 50, 100, 250, 500, 750, 1000],\n    \"model__learning_rate\": [0.01, 0.05, 0.1, 0.5, 1]\n}\n\nmodelCV = GridSearchCV(pipeline, \n                       cv=5, \n                       param_grid=paramGrid)\nmodelCV.fit(trainX, trainY)","dfbc62a1":"modelCV.best_params_","01c163ae":"modelCV.refit\nprint(mean_absolute_error(testY, modelCV.predict(testX)))","34197b67":"pipeline = Pipeline([#imputer \n                     #encoder\n                     #feature select or reduction\n                     (\"model\", XGBRegressor(random_state=0,\n                                            learning_rate=0.1,\n                                            n_estimators=750\n                                           ))\n                    ])\npipeline.fit(XClean, Y)\noutput = pd.DataFrame({\"Id\": testClean.Id,\n                       \"SalePrice\": pipeline.predict(testClean)\n                      }\n                     ).set_index(\"Id\")\noutput.to_csv(\"submission.csv\")","ec086db4":"Since all the data in the numeric types can be simply inferred from the data description, that means both imputation and encoding aren't necessary. So prepare for the world's most basic piepline...","a184d681":"Seems reasonable, though it probably could be improved. It'll do for now. Lets retrain using the defined parameters on the whole data set, then write our results file.","46d0a3dc":"I'm now going to set up a `GridSearchCV` to find the optimal parameters. Much thanks to Aashita and here fantastic \"Advanced Pipelines Tutorial\" kernel! https:\/\/www.kaggle.com\/aashita\/advanced-pipelines-tutorial\nI'm electing not to use an early stopping rounds command for XGBoost as the grid search will ensure that the optimal result is picked no matter what. I'm still going to use a train test split to check for overfitting.","c8802984":"Essentially, I just labelled encoded a large chunk of the data. I elected to encode this chunk manually for two reasons. First, label encoding isn't always appropriate - because it introduces a numeric ranking, this can cause the model to detect orders where there are none, and I didn't want to introduce that error for columns that were unordered objects. And second, because these data could be expressed numerically, I wanted to include them to prevent data leakage.  Now I'll drop objects and double check NaNs...","ca7e974e":" First things first, let's deal with NAs and clean the data. For simplicity, we will use numeric data only in this kernel.","c380041a":"Ok now let's fit those to the model and test on the split set...","9b4c1928":"Let's see what the parameters were...","115eb16d":"This is my work through of the continually housing market competition on Kaggle.  This represents a second draft, with the addtion of piplines. Automation of encoding\/imputing and parameter optimisation to come later"}}