{"cell_type":{"a3385542":"code","78a4ecb5":"code","4024fdd4":"code","963897be":"code","35f12f47":"code","2e4cd9d8":"code","05fc4def":"code","93180d3f":"code","69eb7284":"code","0e27c58a":"code","77b2d4b7":"code","ec0bea42":"code","9c29560a":"code","aeeb3b1c":"code","689ffbed":"code","ec431341":"code","658e2235":"code","19e50970":"code","01dde1f1":"code","021cafde":"markdown","ed91d833":"markdown","c1bd436a":"markdown","8f801db8":"markdown","97349195":"markdown","e22b84ad":"markdown","6835372d":"markdown","3c44283b":"markdown","7f5d00af":"markdown","593daae2":"markdown","c42b6c7f":"markdown"},"source":{"a3385542":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport torch ","78a4ecb5":"print(torch.__version__)","4024fdd4":"jaccard = pd.read_csv(\"..\/input\/obj2vec\/jaccard.csv\")\n\njaccard[\"first\"] = jaccard[\"pair\"].apply(lambda x:int(x.split(\"_\")[0]))\njaccard[\"second\"] = jaccard[\"pair\"].apply(lambda x:int(x.split(\"_\")[1]))\n\njaccard.head(5)","963897be":"J = torch.zeros(372, 372)\nfor i in range(jaccard.shape[0]):\n    J[jaccard.loc[i][\"first\"], jaccard.loc[i][\"second\"]] = jaccard.loc[i][\"sim\"]\n    J[jaccard.loc[i][\"second\"], jaccard.loc[i][\"first\"]] = jaccard.loc[i][\"sim\"]","35f12f47":"J","2e4cd9d8":"plt.figure(figsize=(8,3))\nplt.plot([-1, 0, 0.5, 1, 2], [1, 0, 0.5, 0, 1], label = \"|x| + |x - 1| - |x - 0.5| - 0.5\")\n\nplt.gca().spines['left'].set_position(\"zero\")\nplt.gca().spines['bottom'].set_position(\"zero\")\n\nplt.gca().spines['right'].set_color('none')\nplt.gca().spines['top'].set_color('none')\n\nplt.gca().xaxis.set_ticks_position('bottom')\nplt.gca().yaxis.set_ticks_position('left')\n\nplt.legend(loc = \"upper right\")\nplt.show()","05fc4def":"# \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043c\u044b \u0431\u0443\u0434\u0435\u043c \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c\ndef custom_loss(G, J, reduction=\"sum\", l=0.06):\n    sum_norm = G.sum(0) + G.sum(0)[:, None]\n    J_0 = torch.matmul(G, G) \/ (sum_norm + 1e-3) # \u043f\u043e\u0447\u0435\u043c\u0443-\u0442\u043e \u0435\u0441\u043b\u0438 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u0442\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0445\u0443\u0436\u0435\n    \n    reg = (torch.abs(G) + torch.abs(G - 1) - torch.abs(G - 0.5) - 0.5).sum()\n    \n    return torch.nn.L1Loss(reduction=reduction)(J_0, J\/(J + 1)) + l * reg","93180d3f":"# absolute error for binarize G\ndef AE(G, J):\n    G_bin = (G>0.5).float()\n    sum_norm = G_bin.sum(0) + G_bin.sum(0)[:, None]\n    \n    J_0 = torch.matmul(G_bin, G_bin) \/ (sum_norm + 1e-3)\n    return torch.nn.L1Loss(reduction=\"sum\")(J_0, J\/(J + 1))","69eb7284":"G = (J>0.18).float()\nG.requires_grad = True","0e27c58a":"optimizer = torch.optim.Adam([G], lr=0.002)","77b2d4b7":"for i in range(12001):\n    optimizer.zero_grad()\n    loss = custom_loss(G, J)\n    loss.backward()\n    optimizer.step()\n    if i%3000 == 0:\n        print(float(AE(G, J)))","ec0bea42":"optimizer = torch.optim.Adam([G], lr=0.0005)","9c29560a":"for i in range(18001):\n    optimizer.zero_grad()\n    loss = custom_loss(G, J)\n    loss.backward()\n    optimizer.step()\n    if i%3000 == 0:\n        print(float(AE(G, J)))","aeeb3b1c":"ans = (G.detach().numpy()>=0.5).astype(int)","689ffbed":"ans_column = np.zeros(jaccard.shape[0])","ec431341":"for i in range(jaccard.shape[0]):\n    ans_column[i] = ans[jaccard.loc[i][\"second\"], jaccard.loc[i][\"first\"]] ","658e2235":"jaccard[\"sim\"] = ans_column","19e50970":"jaccard[\"sim\"] = jaccard[\"sim\"].astype(int)","01dde1f1":"jaccard[[\"pair\",\"sim\"]].to_csv(\".\/ans.csv\", index=False)","021cafde":"## \u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f","ed91d833":"## \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445","c1bd436a":"\u0417\u0430\u0440\u0430\u043d\u0435\u0435 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043b\u0438\u0441\u044c, \u0447\u0442\u043e\u0431\u044b \u0443\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c learing_rate.  \n\u0421\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0448\u0435\u0434\u0443\u043b\u0435\u0440\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u044d\u0442\u043e \u043c\u0435\u043d\u044f\u044e\u0442, \u043d\u043e \u043f\u0440\u043e\u0449\u0435 \u0432\u0440\u0443\u0447\u043d\u0443\u044e","8f801db8":"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c G. \u0412\u044b\u0431\u0440\u0430\u043d\u0430 \u0431\u0438\u043d\u0430\u0440\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u043c\u0430\u0442\u0440\u0438\u0446\u0430 X \u0441 \u043f\u043e\u0440\u043e\u0433\u043e\u043c 0.18 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f","97349195":"## \u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u044f","e22b84ad":"\u0417\u0430\u043c\u0435\u0447\u0443, \u0447\u0442\u043e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0434\u043b\u044f \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044f \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e. \u042f\u0432\u043d\u044b\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u0432 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u043c\u0430\u0442\u0440\u0438\u0446\u0430 G \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u0430\u044f, \u0445\u043e\u0442\u044f \u043a\u043e\u0434 \u043d\u0430\u043f\u0438\u0441\u0430\u043d \u043a\u0430\u043a \u0431\u0443\u0434\u0442\u043e \u044d\u0442\u043e \u0442\u0430\u043a.\n\n\u041a\u043e\u043d\u0435\u0447\u043d\u0430\u044f \u043c\u0430\u0442\u0440\u0438\u0446\u0430 G \u0432\u0435\u0441\u044c\u043c\u0430 \u0431\u043b\u0438\u0437\u043a\u0430 \u043a \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u043e\u0439 (\u043e\u043a\u043e\u043b\u043e 99% \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439).","6835372d":"### \u041d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u044f\n\n\u0423 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u043e\u0434\u0438\u043d \u0433\u0438\u043f\u0435\u0440\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0434\u043b\u044f \u0440\u0435\u0433\u0443\u043b\u044f\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0434\u043b\u044f \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0442\u043e\u0440\u0430 Adam.   \n\u041f\u0443\u0442\u0435\u043c \u043f\u0435\u0440\u0435\u0431\u043e\u0440\u0430 \u043f\u043e\u043b\u0443\u0447\u0438\u043b \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u0433\u0438\u043f\u0435\u0440\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b","3c44283b":"\u041d\u0430 \u043a\u0430\u0433\u043b\u043e\u0432\u0441\u043a\u043e\u043c \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u0434\u0440\u0443\u0433\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f \u0442\u043e\u0440\u0447\u0430, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0442\u0435\u043e\u0440\u0435\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u043d\u043e \u0434\u0435\u0442\u0435\u0440\u043c\u0435\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u043f\u043e-\u0434\u0440\u0443\u0433\u043e\u043c\u0443. \u0412 \u0434\u0430\u043d\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u0447\u0443\u0442\u044c \u0445\u0443\u0436\u0435, \u0447\u0435\u043c 264.\n\n\u041f\u0440\u0438\u0447\u0435\u043c \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u043e, \u0447\u0442\u043e \u0435\u0441\u043b\u0438 \u043d\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c GPU, \u0442\u043e \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u043d\u043e \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0435\u0442 \u0441\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u043f\u0440\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \u0433\u0438\u043f\u0435\u0440\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u0445. \u0415\u0441\u043b\u0438 \u043a\u0442\u043e-\u0442\u043e \u0441\u043c\u043e\u0436\u0435\u0442 \u0440\u0430\u0437\u0433\u0430\u0434\u0430\u0442\u044c \u044d\u0442\u0443 \u0437\u0430\u0433\u0430\u0434\u043a\u0443, \u0431\u0443\u0434\u0443 \u0440\u0430\u0434.","7f5d00af":"## \u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u044f\n\n### \u0422\u0435\u043e\u0440\u0438\u044f\n\u041f\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043d\u0430\u0448\u0435\u0439 \u0437\u0430\u0434\u0430\u0447\u0438 \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0442\u0430\u043a:\n\n\u0414\u0430\u043d\u0430 \u043c\u0430\u0442\u0440\u0438\u0446\u0430 $J\\in R^{N \\times N}$. \u041d\u0430\u0439\u0434\u0438\u0442\u0435 \u0442\u0430\u043a\u0443\u044e \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u0443\u044e \u043c\u0430\u0442\u0440\u0438\u0446\u0443 $G\\in \\{0,1\\}^{N \\times N}$, \u0447\u0442\u043e \n$GG^T = JG_s + G_s^TJ - J \\circ GG^T$, \u0433\u0434\u0435 $G_s$ \u0432\u0435\u043a\u0442\u043e\u0440-\u0441\u0442\u043e\u0431\u043b\u0435\u0446 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0439 \u0438\u0437 \u043c\u0430\u0442\u0440\u0438\u0446\u044b $G$ \u0441\u0443\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432\u0434\u043e\u043b\u044c \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u0442\u043e\u043b\u0431\u0446\u0430,\n$\\circ$ \u043f\u043e\u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043d\u043e\u0435 \u0443\u043c\u043d\u043e\u0436\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0440\u0438\u0446\u044b (Hadamard product). \u0412\u043e\u043e\u0431\u0449\u0435 \u0433\u043e\u0432\u043e\u0440\u044f \u043c\u0430\u0442\u0440\u0438\u0446\u0430 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043d\u0435 \u043e\u0434\u043d\u0430, \u043d\u043e \u043d\u0430\u043c \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u043d\u043e.\n\n\u0422.\u043a. \u044d\u0442\u043e \u0437\u0430\u0434\u0430\u0447\u0430 \u0434\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u0435\u0435 \u0440\u0435\u0448\u0430\u0442\u044c \u0442\u0440\u0443\u0434\u043d\u043e, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043f\u0435\u0440\u0435\u0439\u0434\u0435\u043c \u043a \u0440\u0435\u043b\u0430\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0435.  \n\n\u0411\u0443\u0434\u0435\u043c \u0441\u0447\u0438\u0442\u0430\u0442\u044c, \u0447\u0442\u043e \u043c\u0430\u0442\u0440\u0438\u0446\u0430 $G\\in R^{N\\times N}$ \u0438 \u0442\u043e\u0433\u0434\u0430 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043c\u0435\u0442\u043e\u0434 \u0433\u0440\u0430\u0434\u0438\u0435\u043d\u0442\u043d\u043e\u0433\u043e \u0441\u043f\u0443\u0441\u043a\u0430 \u0434\u043b\u044f \u043c\u0438\u043d\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b\u0430:\n$$|GG^T - JG_s - G_s^TJ + J \\circ GG^T| \\rightarrow \\min_\\limits{G}$$\n\n\u041e\u0442\u0432\u0435\u0442\u043e\u043c \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0438 \u0431\u0443\u0434\u0435\u0442 \u044f\u0432\u043b\u044f\u0442\u044c\u0441\u044f \u0431\u0438\u043d\u0430\u0440\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u043c\u0430\u0442\u0440\u0438\u0446\u0430 G \u0434\u043b\u044f \u0440\u0435\u043b\u0430\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0438.","593daae2":"__PUBLIC AE 264__","c42b6c7f":"\u041f\u0435\u0440\u0435\u0434 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u0435\u0439 \u0445\u043e\u0440\u043e\u0448\u043e \u0431\u044b \u0432\u0432\u0435\u0441\u0442\u0438 \u0440\u0435\u0433\u0443\u043b\u044f\u0440\u0438\u0437\u0430\u0446\u0438\u044e \u043f\u043e\u043e\u0449\u0440\u044f\u044e\u0449\u0443\u044e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043c\u0430\u0442\u0440\u0438\u0446\u0435 \u0431\u043b\u0438\u0437\u043a\u0438\u0435 \u043a 0 \u0438 1, \u043d\u043e \u0448\u0442\u0440\u0430\u0444\u0443\u044e\u0449\u0443\u044e \u0437\u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043e\u043a\u043e\u043b\u043e 0.5.\n\u0411\u044b\u043b\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f $|x| + |x-1| - |x - 0.5| - 0.5$"}}