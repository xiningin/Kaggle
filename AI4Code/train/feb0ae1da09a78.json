{"cell_type":{"ac0aec22":"code","1d08c9cd":"code","fc60f7b5":"code","7d252d2a":"code","dbb10db6":"code","284d469c":"code","880c68f6":"code","65215748":"code","34e3c670":"code","b6523173":"code","ca761325":"code","3ea30722":"code","ef74bb35":"code","a01fd79e":"code","9c04aa0e":"code","07e64117":"code","fff9c4d6":"code","e5dd09ec":"code","a54401e7":"code","5e092e4b":"code","1ed56da2":"code","4b93d180":"code","0a874b77":"code","dfc95e58":"code","69315013":"code","f4beac4a":"code","165e7c53":"code","6aa8e367":"code","443e783c":"code","68afae28":"code","2c371067":"code","01bf013d":"code","9d18487a":"code","bc68dec4":"code","a5b460d2":"code","6c6363d0":"code","ce24c05e":"code","61367677":"code","c084efd4":"code","abcd9230":"markdown","e228c527":"markdown"},"source":{"ac0aec22":"#%cd ..\/\n#!mkdir tmp\n#%cd tmp","1d08c9cd":"#%cd tmp\/\/kidney_disease\/","fc60f7b5":"# Install W&B \n#!pip install -q --upgrade wandb\n# Login \n#import wandb\n#wandb.login()","7d252d2a":"#Import Libraries\nimport glob\nfrom keras.models import Sequential, load_model\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport keras as k\nfrom keras.layers import Dense\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import LabelEncoder, StandardScaler\nimport matplotlib.pyplot as plt\nfrom tensorflow.keras.callbacks import ReduceLROnPlateau, ModelCheckpoint, EarlyStopping\nfrom tensorflow.keras.optimizers import Adam","dbb10db6":"df_train = pd.read_csv('..\/input\/chronic-kidney-disease\/kidney_disease_train.csv')\n\ndf_test = pd.read_csv('..\/input\/chronic-kidney-disease\/kidney_disease_test.csv')","284d469c":"df_train","880c68f6":"df = pd.concat([df_train, df_test])\ndf","65215748":"# Generate the Profiling Report\n\nimport pandas_profiling as pp\nprofile = pp.ProfileReport(\n    df, title=\"Chronic Kidney Disease\", html={\"style\": {\"full_width\": True}}, sort=\"None\"\n)","34e3c670":"profile","b6523173":"df.info()","ca761325":"df.shape","3ea30722":"# Initialize a new run\n#wandb.init(project=\"visualize-predictions\", name=\"metrics\")\n\n# Log the metric on each step\n#for dfn in df['classification']:\n    #wandb.log({\"pcv\": dfn})\n\n#wandb.finish()\n\n\n##   Run summary visit the link\n## https:\/\/wandb.ai\/yasirhessein\/visualize-predictions\/runs\/2g0bsk7k","ef74bb35":"# Initialize a new run\n#wandb.init(project=\"visualize-predictions\", name=\"metrics\")\n\n# Log the metric on each step\n#for dfn in df['classification']:\n    #wandb.log({\"htn\": dfn})\n\n#wandb.finish()\n\n## Run summary visit the link\n## https:\/\/wandb.ai\/yasirhessein\/visualize-predictions\/runs\/1uw65vea","a01fd79e":"#Create a list of columns to retain\nretain = [\"sg\", \"age\",\"bp\",\"al\", \"su\",\"sc\", \"hemo\",\"pcv\", \"wbcc\", \"rbcc\", \"htn\", \"classification\"]\n\n#retain = df.columns, Drop the columns that are not in retain\ndf = df.drop([col for col in df.columns if not col in retain], axis=1)\n    \n# Drop the rows with na or missing values\ndf = df.dropna(axis=0)","9c04aa0e":"def check_df(dataframe, head=5):\n    print(\"##################### Shape #####################\")\n    print(dataframe.shape)\n    print(\"##################### Types #####################\")\n    print(dataframe.dtypes)\n    print(\"##################### Head #####################\")\n    print(dataframe.head(head))\n    print(\"##################### Tail #####################\")\n    print(dataframe.tail(head))\n    print(\"##################### NA #####################\")\n    print(dataframe.isnull().sum())\ncheck_df(df)","07e64117":"sns.countplot(df['classification'],label=\"Count\")","fff9c4d6":"plt.figure(figsize=(20,10))  #This is used to change the size of the figure\/ heatmap\nsns.heatmap(df.corr(), annot=True, fmt='.0%')","e5dd09ec":"print(retain)","a54401e7":"#Transform non-numeric columns into numerical columns\nfor column in df.columns:\n        if df[column].dtype == np.number:\n            continue\n        df[column] = LabelEncoder().fit_transform(df[column])","5e092e4b":"#Split the data\nx= df[['sg', 'al', 'sc', 'pcv', 'htn']]\ny = df['classification']","1ed56da2":"x","4b93d180":"y","0a874b77":"#Split the data into 80% training and 20% testing \nx_train,  x_test, y_train, y_test = train_test_split(x, y, test_size= 0.2,random_state=42)","dfc95e58":"print(\"---------------------------------------------------------\")\nprint(\"Shape of training data: \", x_train.shape)\nprint(\"Shape of test data    : \", x_test.shape )\nprint(\"---------------------------------------------------------\")","69315013":"x_scaler = StandardScaler()\nx_scaler.fit(x)\ncolumn_names = x.columns\nx[column_names] = x_scaler.transform(x)","f4beac4a":"x.shape[1]","165e7c53":"#Build The model\n\nmodel = Sequential()\nmodel.add(Dense(128, input_dim=len(x.columns),kernel_initializer=k.initializers.random_normal(seed=13), activation=\"relu\"))\nmodel.add(Dense(64, kernel_initializer=k.initializers.random_normal(seed=13), activation=\"relu\"))\nmodel.add(Dense(32, kernel_initializer=k.initializers.random_normal(seed=13), activation=\"relu\"))\nmodel.add(Dense(1, activation=\"hard_sigmoid\"))\nmodel.add(Dense(1, activation='sigmoid'))","6aa8e367":"model.summary()","443e783c":"from tensorflow.keras.utils import plot_model\nfrom IPython.display import Image\nplot_model(model, to_file='convnet.png', show_shapes=True,show_layer_names=True)\nImage(filename='convnet.png')","68afae28":"model.compile(optimizer=Adam(), loss='binary_crossentropy', metrics=['accuracy'])","2c371067":"lrd = ReduceLROnPlateau(monitor = 'val_loss',\n                         patience = 20,\n                         verbose = 1,\n                         factor = 0.75,\n                         min_lr = 1e-10)\n\nmcp = ModelCheckpoint('model.h5')\n\nes = EarlyStopping(verbose=1, patience=20)","01bf013d":"history = model.fit(x=x_train, y=y_train, epochs=800, callbacks=[lrd, mcp, es],batch_size=256, validation_split=0.1)","9d18487a":"# summarize history for loss\nplt.plot(history.history['loss'])\nplt.plot(history.history['val_loss'])\nplt.title('model loss')\nplt.ylabel('loss')\nplt.xlabel('epoch')\nplt.legend(['train', 'test'], loc='upper left')\nplt.show()\n\n# # summarize history for accuracy\nplt.plot(history.history['accuracy'])\nplt.plot(history.history['val_accuracy'])\nplt.title('model accuracy')\nplt.ylabel('accuracy')\nplt.xlabel('epoch')\nplt.legend(['train', 'test'], loc='upper right')\nplt.show()","bc68dec4":"#Visualize the models accuracy and loss\nplt.plot(history.history[\"accuracy\"])\nplt.plot(history.history[\"loss\"])\nplt.title(\"model accuracy & loss\")\nplt.ylabel(\"accuracy and loss\")\nplt.xlabel(\"epoch\")\nplt.legend(['acc', 'loss'], loc='lower right')\nplt.show()","a5b460d2":"for model_file in glob.glob('model.h5'):\n  print(\"Model file: \", model_file)\n  model = load_model(model_file)\n  pred = model.predict(x_test)\n  pred = [1 if y>=0.5 else 0 for y in pred] #Threshold, transforming probabilities to either 0 or 1 depending if the probability is below or above 0.5\n  scores = model.evaluate(x_test, y_test)\n  print()\n  print(\"Original  : {0}\".format(\", \".join([str(x) for x in y_test])))\n  print()\n    \n    \n    \n  print(\"Predicted : {0}\".format(\", \".join([str(x) for x in pred])))\n  print() \n  print(\"Scores    : loss = \", scores[0], \" acc = \", scores[1])\n  print(\"---------------------------------------------------------\")\n  print()","6c6363d0":"#wandb.log({'accuracy':x_test, 'loss':x_test})","ce24c05e":"#wandb.log({'accuracy': x_train, 'loss': x_train})","61367677":"#wandb.init(project=\"Chronic Kidney Disease\")","c084efd4":"#https:\/\/wandb.ai\/yasirhessein\/Chronic%20Kidney%20Disease?workspace=user-yasirhessein","abcd9230":"### Good Luck","e228c527":"## Chronic Kidney Disease \n\nChronic kidney disease (CKD) means your kidneys are damaged and can't filter blood the way they should. The disease is called \u201cchronic\u201d because the damage to your kidneys happens slowly over a long period of time. This damage can cause wastes to build up in your body. CKD can also cause other health problems.\n\n<img src=\"https:\/\/medicaldialogues.in\/h-upload\/2020\/12\/30\/500x300_145030-chronic-kidney-disease.webp\" width=\"800px\">\n\n####  Description\nThe data was taken over a 2-month period in India with 25 features ( eg, red blood cell count, white blood cell count, etc). The target is the 'classification', which is either 'ckd' or 'notckd' - ckd=chronic kidney disease. Use machine learning techniques to predict if a patient is suffering from a chronic kidney disease or not.\n\n\n#### Data Set Information:\n\nWe use the following representation to collect the dataset:-\n\n* age - age\n* bp - blood pressure\n* sg - specific gravity\n* al - albumin\n* su - sugar\n* rbc - red blood cells\n* pc - pus cell\n* pcc - pus cell clumps\n* ba - bacteria\n* bgr - blood glucose random\n* bu - blood urea\n* sc - serum creatinine\n* sod - sodium\n* pot - potassium\n* hemo - hemoglobin\n* pcv - packed cell volume\n* wc - white blood cell count\n* rc - red blood cell count\n* htn - hypertension\n* dm - diabetes mellitus\n* cad - coronary artery disease\n* appet - appetite\n* pe - pedal edema\n* ane - anemia\n* class - class\n\n\n#### Dataset Link \n\n[Here ](https:\/\/www.kaggle.com\/colearninglounge\/chronic-kidney-disease)\n"}}