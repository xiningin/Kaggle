{"cell_type":{"aa0f63a3":"code","6d2dd666":"code","bab8e778":"code","93d7b348":"code","1619a61a":"code","fc944f46":"code","6a5b45cd":"code","2773dd70":"code","9fc58233":"code","d01f405f":"code","e6d207cf":"code","8e6050b9":"markdown","fdb0f172":"markdown","566620e7":"markdown","98eded97":"markdown","54a5047b":"markdown"},"source":{"aa0f63a3":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\n","6d2dd666":"# get files into dataframes that would be used in the process\ndf_player_info = pd.read_csv('..\/input\/player_info.csv')\ndf_game_shifts = pd.read_csv('..\/input\/game_shifts.csv')\ndf_game = pd.read_csv('..\/input\/game.csv')","bab8e778":"# checking out how many countries sent players to the NHL - overall\nnations_count =df_player_info['nationality'].value_counts().count()\nprint('NHL players throughout the years came from {} nations'.format(nations_count))","93d7b348":"plt.figure(figsize=(15,10))\nnations_count_for_bar = df_player_info['nationality'].value_counts()\nsns.barplot(nations_count_for_bar.index,nations_count_for_bar.values,palette=\"BuGn_r\")\nplt.title('Top countries by overall NHL players')","1619a61a":"# Prepare time played\ndf_game_shifts['seconds_played'] = df_game_shifts['shift_end'] - df_game_shifts['shift_start']\ndf_time_played = df_game_shifts.groupby(['game_id','player_id'])['seconds_played'].sum().reset_index()\ndf_time_played['minutes_played'] = df_time_played['seconds_played'] \/ 60\ndf_time_played['hours_played'] = df_time_played['minutes_played'] \/ 60 \ndf_time_played.head(2)","fc944f46":"# Prepare relevent data of games per season\ndf_season_games = df_game[['game_id','season']]\ndf_season_games.drop_duplicates() # in case of unexpected duplicate row\ndf_season_games.head(2)","6a5b45cd":"# Prepare relevent data of player's nationality\ndf_player_info_nationality = df_player_info[['player_id','nationality']]\ndf_player_info_nationality['international'] =  df_player_info_nationality['nationality'].apply(\n    lambda x: 'USA' if (x == 'USA') else 'CAN' if (x == 'CAN') else 'Rest')\ndf_player_info_nationality.head(2)","2773dd70":"# Merge three tables relevent data into one table\ndf_nationality_by_season = pd.merge(df_time_played, df_season_games, how='left', on='game_id')\ndf_nationality_by_season = pd.merge(df_nationality_by_season, df_player_info_nationality, how='left', on='player_id')\ndf_nationality_by_season.head(2)","9fc58233":"# remain only USA & CAN data\ndf_season_hours_by_inter = df_nationality_by_season.groupby(['season','international'])['hours_played'].sum().reset_index()\ndf_season_hours_by_inter_piv = df_season_hours_by_inter.pivot_table(values='hours_played', index=df_season_hours_by_inter.season,columns='international', aggfunc='first')\n\ndf_season_hours_by_inter_piv['season total'] = df_season_hours_by_inter_piv['Rest'] + df_season_hours_by_inter_piv['USA'] ++ df_season_hours_by_inter_piv['CAN']\ndf_season_hours_by_inter_piv['% Rest'] = df_season_hours_by_inter_piv['Rest'] \/ df_season_hours_by_inter_piv['season total'] * 100\ndf_season_hours_by_inter_piv['% USA'] = df_season_hours_by_inter_piv['USA'] \/ df_season_hours_by_inter_piv['season total'] * 100\ndf_season_hours_by_inter_piv['% CAN'] = df_season_hours_by_inter_piv['CAN'] \/ df_season_hours_by_inter_piv['season total'] * 100\n\ndf_season_hours_by_inter_piv= df_season_hours_by_inter_piv[['% Rest','% USA','% CAN']]","d01f405f":"# let's see it also on bar chart\nsns.set_style(\"whitegrid\")\ndf_season_hours_sns = df_nationality_by_season.groupby(['season'])['hours_played'].sum().reset_index()\ndf_season_hours_by_inter_sns = pd.merge(df_season_hours_by_inter, df_season_hours_sns, how='left', on='season')\ndf_season_hours_by_inter_sns['% Hours played'] = df_season_hours_by_inter_sns['hours_played_x'] \/ df_season_hours_by_inter_sns['hours_played_y'] *100\ng = sns.catplot(x=\"season\", y=\"% Hours played\", hue=\"international\", data=df_season_hours_by_inter_sns,\n                height=6, kind=\"bar\", palette=\"muted\")","e6d207cf":"# and by table view\ndf_season_hours_by_inter_piv","8e6050b9":" ### Checking out overall globalization sats","fdb0f172":"### Showing leading countries by players from season 2012","566620e7":"### Prepare data, in order to show NHL globalization per season by time playing","98eded97":"## Showing hours played by players from USA vs. CAN vs. Rest of the world by season","54a5047b":"### Candians as expected are playing more then other nationalities in the league,  their dominance is declining and they played ~6% less in 2017-8 vs. 2012-3 season.\n### USA players playing in each year more and more, and on 2017-8 they played 5% more then 2012-3 season \n### However, we can see that Rest of the world players playing around 30% of the time, with no signification changing over the years [~1% over 6 season]\n### I can see that  the  globalization process hasn't arrived to the NHL at the past 6 years, and the league stayed in USA \/ CAN control."}}