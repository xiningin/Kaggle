{"cell_type":{"1af877f9":"code","9f108f9d":"code","dccd81cc":"code","c3255c48":"code","36aafe0e":"code","5a6fcd8e":"code","da26cd7e":"code","e785a25c":"code","9af6b95b":"code","4bcefe51":"code","7550fc5c":"code","eab5e5ab":"code","91db580f":"code","7f81eee3":"code","70047b75":"code","e553001b":"code","2c5d5190":"code","a811ca26":"code","840828c2":"code","4643037c":"code","57f97a42":"code","8e953445":"code","85a4fb70":"code","f4100107":"code","d99b6221":"code","d1c06320":"code","bdf2c971":"code","49684b0b":"code","7c799e43":"code","31b35bbd":"code","727749ba":"code","5661551a":"code","3e72f80a":"code","333f2f1c":"code","7519de1a":"code","ea361db0":"code","7c96b3dc":"code","a2207a12":"code","4c43dec9":"code","d030841d":"code","0af2615d":"code","a0fde605":"code","4e05f1d0":"code","84fd8e8e":"code","c2a89f81":"code","871e8f10":"code","b11d82a0":"code","43d699fa":"code","828c6fc9":"code","019935ca":"code","d3263f44":"code","6322e61c":"code","5a70e525":"code","39fe9241":"code","93e03324":"code","06cc2213":"code","7319c125":"markdown","30d2d083":"markdown","0acce18b":"markdown","0070570f":"markdown","3ea15c81":"markdown","34d77324":"markdown","46806b2d":"markdown","491ebfb7":"markdown","70d4b46b":"markdown","6ccaa03a":"markdown","23bb405b":"markdown","ae28becf":"markdown","06d4a450":"markdown","830c134c":"markdown","f8bf5c9e":"markdown","5c7b1f02":"markdown","2ac9e32e":"markdown","e1bb6e03":"markdown","69ef15ad":"markdown","f44e0538":"markdown","ce2c8f8d":"markdown","7db4a65f":"markdown","e83c0455":"markdown","c6b93af9":"markdown","efe8d5f4":"markdown","107272ef":"markdown","b6c712ba":"markdown","60124c86":"markdown","4b72cd41":"markdown","791a81bf":"markdown","9d75e71d":"markdown","aa5cb3e8":"markdown","1d146822":"markdown","acb0c2ad":"markdown","c4a03732":"markdown","f8189bbc":"markdown","cafc8618":"markdown","e30d2498":"markdown"},"source":{"1af877f9":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n%matplotlib inline","9f108f9d":"df = pd.read_csv('..\/input\/insurance\/insurance.csv')","dccd81cc":"df.head()","c3255c48":"df.info()","36aafe0e":"df.describe()","5a6fcd8e":"sns.pairplot(df, hue='smoker')","da26cd7e":"smoker_cplot = sns.countplot(x=df['smoker'])\n\nplt.title('Smokers')\n\nfor p in smoker_cplot.patches:\n    smoker_cplot.annotate(p.get_height(),\n                           (p.get_x() + p.get_width() \/ 2.,\n                            p.get_height()),\n                            ha='center',\n                            va='center',\n                            xytext=(0, -10),\n                            textcoords='offset points',\n                            color='white',\n                            fontsize=10,\n                            fontweight='bold')","e785a25c":"g = sns.FacetGrid(df, hue='smoker', height=6, aspect=2)\n\ng = g.map(plt.hist, 'age', alpha=0.5)\n\nplt.legend(title='Smoker')\nplt.title('Age distribution between smoker and non-smoker')\nplt.show()","9af6b95b":"g = sns.FacetGrid(df, hue='smoker', height=6, aspect=2)\n\ng = g.map(plt.hist, 'charges', alpha=0.5)\n\nplt.title('Distribution of Charges')\nplt.legend(title='Smoker')\nplt.show()","4bcefe51":"sns.scatterplot(x='age', y='charges', data=df, hue='smoker')","7550fc5c":"smoker_df = df[df['smoker']=='yes']","eab5e5ab":"sns.scatterplot(x='age', y='charges', data=smoker_df, hue='region')","91db580f":"sns.scatterplot(x='age', y='charges', data=smoker_df, hue='sex')","7f81eee3":"sns.scatterplot(x='age', y='charges', data=smoker_df, hue='bmi')","70047b75":"sns.scatterplot(x='bmi', y='charges', data=smoker_df, hue='age')","e553001b":"def highbmi(bmi):\n    \n    if bmi >= 30:\n        return 'yes'\n    \n    else:\n        return 'no'\n\nsmoker_df['highbmi'] = df['bmi'].apply(highbmi)","2c5d5190":"sns.lmplot(x='age', y='charges', data=smoker_df, hue='highbmi', legend=False)\n\nplt.legend(title='BMI > 30')\nplt.title('Comparing charges for patients who are smokers')\n\nplt.show()","a811ca26":"#sns.scatterplot(x='bmi', y='charges', data=df, hue='smoker')\nsns.lmplot(x='bmi', y='charges', hue='smoker', data=df, height=6)\nplt.title('Charges and BMI')\n\nplt.show()","840828c2":"g = sns.FacetGrid(data=df, hue='region', height=6, aspect=2)\ng = g.map(plt.hist, 'charges', alpha=0.5)\n\nplt.title('Distribution of charges across Regions')\nplt.legend(title='Region')\n\nplt.show()","4643037c":"sns.countplot(x=df['region'])\n\nplt.title('Count of charges per region')\n\nplt.show()","57f97a42":"sns.scatterplot(x='bmi', y='charges', data=df, hue='region')","8e953445":"sns.scatterplot(x='age', y='charges', data=df, hue='region')","85a4fb70":"sns.heatmap(smoker_df.corr(), annot=True)","f4100107":"non_smoker_df = df[df['smoker']=='no']","d99b6221":"sns.heatmap(non_smoker_df.corr(), annot=True)","d1c06320":"g = sns.FacetGrid(df, hue='sex', height=6, aspect=2)\ng = g.map(plt.hist, 'charges', alpha=0.5)\n\nplt.title('Distribution of charges between gender')\nplt.legend(title='Gender')\nplt.show()","bdf2c971":"g = sns.FacetGrid(df, hue='sex', height=6, aspect=2)\ng = g.map(plt.hist, 'age', alpha=0.5)\n\nplt.title('Distribution of age between gender')\nplt.legend(title='Gender')\nplt.show()","49684b0b":"cplot = sns.catplot(x='smoker', kind='count', hue='sex', data=df)\nplt.title('Count of smokers by gender')\nplt.show()","7c799e43":"plt.figure(figsize=(10,6))\nsns.boxplot(x='children', y='charges', data=df, hue='smoker')\n\nplt.title('Boxplot of charges by number of children')\nplt.show()","31b35bbd":"sns.countplot(x=df['children'])\n\nplt.title('Count of patients by number of children')\nplt.show()","727749ba":"from sklearn import metrics\n\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import classification_report, r2_score, confusion_matrix","5661551a":"model_df = pd.get_dummies(data=df, columns=['sex', 'region', 'smoker'], drop_first=True)","3e72f80a":"model_df.head()","333f2f1c":"X = model_df.drop('charges', axis=1)\ny = model_df['charges']","7519de1a":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3)","ea361db0":"lm = LinearRegression()","7c96b3dc":"lm.fit(X_train, y_train)","a2207a12":"print(lm.intercept_)","4c43dec9":"coeff_df = pd.DataFrame(lm.coef_, X.columns, columns=['Coefficient'])","d030841d":"coeff_df","0af2615d":"predictions = lm.predict(X_test)","a0fde605":"plt.scatter(y_test, predictions)","4e05f1d0":"sns.distplot((y_test-predictions), bins=50)","84fd8e8e":"print('R2: ' + str(lm.score(X_test, y_test)))","c2a89f81":"from sklearn.preprocessing import PolynomialFeatures","871e8f10":"poly_model_df = df.drop('region', axis=1)","b11d82a0":"poly_model_df = pd.get_dummies(data=poly_model_df, columns=['sex', 'smoker'], drop_first=True)","43d699fa":"X = poly_model_df.drop('charges', axis=1)\ny = poly_model_df['charges']","828c6fc9":"poly = PolynomialFeatures(degree=2)\nX = poly.fit_transform(X)","019935ca":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3)","d3263f44":"poly_lm = LinearRegression()","6322e61c":"poly_lm.fit(X_train, y_train)","5a70e525":"predictions = poly_lm.predict(X_test)","39fe9241":" plt.scatter(y_test, predictions)","93e03324":"sns.distplot((y_test-predictions), bins=50)","06cc2213":"print('R2: ' + str(poly_lm.score(X_test, y_test)))\nprint('MAE:', metrics.mean_absolute_error(y_test, predictions))\nprint('MSE:', metrics.mean_squared_error(y_test, predictions))\nprint('RMSE:', np.sqrt(metrics.mean_squared_error(y_test, predictions)))","7319c125":"#### 2) Explore to see if there are any noticeable difference in insurance charges between regions\n\nCompare the distribution of charges between regions","30d2d083":"#### 4) Explore the data between male and females","0acce18b":"Compare the count of smokers against non-smokers","0070570f":"First, import the relevant libraries required for a linear regression model","3ea15c81":"From the plots above, we can determine that\n- The age and charges distribution are similar between males and females\n- There is a small difference in counts for smokers and non-smokers between genders. There are more males who are smokers, and more females that are non-smokers","34d77324":"#### Creating and training the model","46806b2d":"From the plot, the distribution of charges between regions is relatively similar.\n\nNext, compare the counts of charges between region","491ebfb7":"#### 3) Identify the correlation between variables for smokers and non-smokers","70d4b46b":"### Exploratory Data Analysis\n\n#### 1) Check if there is a general difference in insurance charges between smokers and non-smokers","6ccaa03a":"From the above plot, we can see that age and sex does not seem to be the cause between the two separate trend lines.\n\nHowever, if we set the hue to <b>bmi<\/b>. we can see that smokers with higher BMI tend to reside in the higher trend line.\n\nTo further confirm this, we can plot the charges against bmi for smokers below.","23bb405b":"### Conclusion\n\nFrom the above exploratory data analysis, we can learn that smokers generally have higher insurance charges compared to non-smokers. \n- For smokers, their BMI is highly correlated with the insurance charges they face. \n- However, for non-smokers, their age is highly correlated with insurance charges instead.\n\nWe then created a linear regression model in an attempt to predict the insurance charges based on age, bmi, the patient's gender, which region the patient is from, and whether the patient is a smoker.\n\nThe initial model did not perform well as it only explains 73% of the variation in insurance charges. We then used polynomial features to generate a new feature matrix consisting of all polynomial combinations of the features. \n\nThe new model with polynomial features resulted in a better fit, with the model explaining 82% of the variations in insurance charges.","ae28becf":"#### Prepare the data and split it into a training and testing set.\n\nFirst, convert the region, smoker and sex column into dummy variables","06d4a450":"#### Model Evaluation\n\nEvaluate the model by checking out its coefficients and how we can interpret them","830c134c":"From the above plots, region does not seem to be a contributing factor in insurance charges. ","f8bf5c9e":"Below is a summary of the findings from the smoker vs non-smoker analyses:\n- There are more non-smokers than smokers in the dataset\n- The age distribution of smokers and non-smokers are relatively the same\n- For the same age, smokers generally face higher insurance charges compared to non-smokers \n- For the same BMI, smokers generally face higher insurance charges compared to non-smokers\n- For smokers, there is a noticable increase in insurance charges if the BMI is 30 and above","5c7b1f02":"#### Import Libraries","2ac9e32e":"### <b>Introduction<\/b>\n\nToday, I will explore a dataset that contains the insurance charges for different patients. Through this dataset, I aim to sharpen my Python and data analysis skills by performing some exploratory data analysis.\n\nI will also attempt to apply what I have learnt in my ML course by creating, training and evaluating a linear regression model.\n\nBeing a beginner in data analysis, I hope that any readers of this notebook can provide some feedback and ways to improve. Any constructive critism is extremely welcome. Thank you in advance!","e1bb6e03":"### <b>Acknowledgements<\/b>\n\nDataset: https:\/\/www.kaggle.com\/mirichoi0218\/insurance\n<br>\nInspiration: https:\/\/www.kaggle.com\/hely333\/eda-regression","69ef15ad":"Finally, split the data into the training and testing set","f44e0538":"#### Predictions from the model","ce2c8f8d":"From the above plots and R2 score, the model is not performing very well. The model is only able to explain 73.3707% of the variations in insurance charges.","7db4a65f":"However, if the individual is not a smoker, the insurance charges generally remain around the same across all BMIs","e83c0455":"#### Predictions from the model","c6b93af9":"Interpreting the coefficients, holding all other features constant:\n- A 1 unit increase in <b>age<\/b> is associated with an increase of 275.2383 in charges\n- A 1 unit increase in <b>bmi<\/b> is associated with an increase of 338.5961 in charges\n- A 1 unit increase in <b>children<\/b> is associated with an increase of 471.3475 in charges\n<br><br>\n- If the patient is a <b>male<\/b>, there will be a decrease in 238.7355 in charges\n- If the patient is a <b>smoker<\/b>, there will be an increase in 24545.8093 in charges\n<br><br>\n- If the patient is in the <b>northwest<\/b> region, there will be an decrease in 26.2787 in charges\n- If the patient is in the <b>southeast<\/b> region, there will be an decrease in 942.7159 in charges\n- If the patient is in the <b>southwest<\/b> region, there will be an decrease in 438.9262 in charges","efe8d5f4":"### Creating a Linear Regression Model ","107272ef":"From the plots above, we can tell that the number of children does not appear to have a significant impact on the insurance charges","b6c712ba":"The above plot shows that the age distribution between smokers and non-smokers are relatively similar.\n\nNext, compare the charges distribution between smokers and non-smokers","60124c86":"The count of charges is also relatively similar between region.\n\nWe can dive deeper to see if region is a contributing factor to the insurance charges. To do this, we can plot bmi and age against charges, and identify the regions via the hue","4b72cd41":"Based on the correlation heatmaps:\n- For smokers, age and BMI appears to be correlated with the insurance charges, with BMI having a higher correlation compared to age\n- For non-smokers, only age seems to be correlated with the insurance charges. In addition, the age correlation appears to be higher compared to non-smokers\n<br><br>\n\nHence:\n- For smokers, BMI and age appears to be a major contributing factor to insurance charges\n- For non-smokers, age appears to be the only major contributing factor to insurance charges","791a81bf":"Next, try using polynomial features to see if we can get a better fit from the model","9d75e71d":"The plot shows that non-smokers generally pay lesser insurance charges compared to smokers.\n\n\nWe can explore deeper to see if there are any other variables that contribute to the difference in charges between smokers and non-smokers.\n\nFirst, we can plot the charges against age to see if there is a difference in trend","aa5cb3e8":"#### Load csv into dataframe and inspect the data","1d146822":"First, instantiate a LinearRegression model and train it using our training set","acb0c2ad":"#### 5) Explore the relationship between number of children and insurance charges","c4a03732":"We can see that there is a higher number of non-smokers compared to smokers\n\nNext, compare the age distribution between smokers and non-smokers","f8189bbc":"From the above plots, we can tell that reason for the two trend lines is probably due to the <b>smoker's BMI<\/b>.\n\nThe plot shows that if a smoker's BMI is above 30, there will be a significant increase in insurance charges.","cafc8618":"Next, prepare the data by splitting it into the features to train on and the target variable","e30d2498":"From the above plot, we can tell that <b>smokers generally have higher insurance charges<\/b> compared to non-smokers across all age groups\n\nHowever, the above plot also shows that there is are <b>two trend lines for smokers<\/b>. We can dive deeper to see if we can attribute the two trend lines to a single variable."}}