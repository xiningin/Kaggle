{"cell_type":{"38b61f5d":"code","8ba0f38c":"code","e79bffc7":"code","7194e409":"code","9b7400f4":"code","c9f7d4eb":"code","a813061a":"code","b24e21b9":"code","cb94c782":"code","d3e56b0a":"code","2ba2f9be":"code","c7f8dd7b":"code","3ba6c6ee":"code","711a54a9":"code","9f080d80":"code","289ee08a":"code","658631f3":"code","fcede6ed":"code","9ed9fa16":"code","b1e62190":"code","08b6e885":"code","a2c3970e":"code","3cd4734a":"code","c1124a8c":"code","c21b9497":"code","b329c556":"code","fb6e9e0f":"code","19b0de00":"code","c50a6de2":"code","d7d02fae":"code","8438128f":"code","35a032a5":"code","87031763":"code","1d6656aa":"code","b4f1e1da":"code","30603876":"code","b738bb6a":"code","b96a7c30":"code","12e6151c":"code","634dc330":"code","4dfdae50":"code","7ecdf842":"code","14e13c67":"code","e0b1de56":"code","e3f09ae8":"markdown","fec3ec21":"markdown","f7361389":"markdown","8069445c":"markdown","c5996a47":"markdown","a3d62c7f":"markdown","4f32fcbe":"markdown"},"source":{"38b61f5d":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\n\n# b\u00fct\u00fcn g\u00f6zlemleri ve de\u011fi\u015fkenleri (sat\u0131r ve s\u00fctunlar) g\u00f6rebilmek i\u00e7in :\npd.set_option('display.max_columns', None); \npd.set_option('display.max_rows', None);\n\n# virgulden sonra g\u00f6sterilecek olan say\u0131 say\u0131s\u0131\npd.set_option('display.float_format', lambda x: '%.2f' % x)\nimport matplotlib.pyplot as plt\n\n\n\n\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n","8ba0f38c":"original_df = pd.read_excel(\"..\/input\/online-retail-ii-data-set-from-ml-repository\/online_retail_II.xlsx\", sheet_name = \"Year 2010-2011\")","e79bffc7":"# verimiz okundu mu? ilk 5 g\u00f6zleme bakal\u0131m :\n\noriginal_df.head()","7194e409":"# daha sonralar\u0131 verimizin silinmesi veya bozulmas\u0131\n# ihtimaline kar\u015f\u0131, orjinal veri setini kopyalayal\u0131m :\n\ndf  = original_df.copy()","9b7400f4":"# do\u011fru kopyalanm\u0131\u015f m\u0131 bakal\u0131m : \n\ndf.head()","c9f7d4eb":"# veri setimizin de\u011fi\u015fkenleri hakk\u0131nda bilgi alal\u0131m : \n\n\ndf.info()","a813061a":"# veri setimizin herhangi bir yerinde eksik bilgi var m\u0131 diye bakal\u0131m :\n\n#yazd\u0131\u011f\u0131m\u0131z kod dataframe i\u00e7inde, herhangi bir de\u011ferde bir eksik bilgi varsa True d\u00f6necektir.\n\ndf.isnull().values.any()","b24e21b9":"# bu eksik de\u011ferlerin, hangi de\u011fi\u015fkenlerde ve toplamda ka\u00e7 adet oldu\u011funa bakal\u0131m : \n\ndf.isnull().sum()","cb94c782":"# veri setimizin de\u011fi\u015fkenlerine bakal\u0131m : \ndf.columns","d3e56b0a":"# \u015fimdi bu de\u011fi\u015fkenlerin baz\u0131lar\u0131nda ka\u00e7 tane e\u015fsiz (birbirinden farkl\u0131) de\u011fer oldu\u011funa bakal\u0131m :\n\n\nprint(\"Description : \",df[\"Description\"].nunique())\nprint(\"StockCode : \",df[\"StockCode\"].nunique())","2ba2f9be":"# bu de\u011fi\u015fkenlerde toplamda ka\u00e7 adet eleman (de\u011fer) oldu\u011funa bakal\u0131m\n\nprint(\"Description : \",df[\"Description\"].value_counts().sum())\nprint(\"StockCode : \",df[\"StockCode\"].value_counts().sum())","c7f8dd7b":"# \u00f6ncelikle eksik g\u00f6zlemlerimizi silelim. eksik verileri doldurman\u0131n \u00e7e\u015fitli yollar\u0131 var ama biz uzatmamak i\u00e7in siliyoruz.\n#bu elbette baz\u0131 yan etkilere sahip olacakt\u0131r ama \u015fuan bunu d\u00fc\u015f\u00fcnmemize gerek yok.\n\npure_df = df.dropna()","3ba6c6ee":"# eksik g\u00f6zlemler silinmi\u015f mi ? \n\npure_df.isnull().values.any()","711a54a9":"# eksik g\u00f6zlem yok, peki de\u011fi\u015fkenlerin ka\u00e7 adet elemanlar\u0131 kald\u0131, sa\u011flamas\u0131?\n\npure_df.isnull().sum()","9f080d80":"# Bu veri setindeki faturada C : geri iade edilen faturay\u0131 temsil eder. Yani negatif i\u015fleme girer. Biz bu de\u011ferleri de \u00e7\u0131kar\u0131yoruz : \n\npure_df = pure_df[~pure_df[\"Invoice\"].str.contains(\"C\", na = False)]","289ee08a":"# elimizde ka\u00e7 adet g\u00f6zlem birimi var ?\npure_df.shape","658631f3":"# RFM i\u00e7in maksimum gelir laz\u0131m olacak bu y\u00fczden TotalPrice de\u011fi\u015fkeni olu\u015fturaca\u011f\u0131z : \n\npure_df[\"TotalPrice\"] = pure_df[\"Quantity\"] * pure_df[\"Price\"]\n","fcede6ed":"# TotalPrice olu\u015fmu\u015f mu ? \n\npure_df.head()","9ed9fa16":"# biraz verimizi inceleyelim. bunun i\u00e7in \u00f6nceki haline ve \u015fuanki haline bakabiliriz.\n\n#\u00f6nceki:\ndf.describe().T","b1e62190":"# \u015fimdiki\npure_df.describe().T","08b6e885":"# \u00f6ncelikle tarih ile i\u015flem yapaca\u011f\u0131m\u0131z i\u00e7in tarihle ilgili k\u00fct\u00fcphaneyi eklemeliyiz :\n\nimport datetime as dt","a2c3970e":"#Veri setinin en son ne zaman veri tuttu\u011funa bakal\u0131m. \u015euan Tarih 2020 fakat biz bu tarihi baz al\u0131rsak \u00e7ok yanl\u0131\u015f yapar\u0131z :)\n\npure_df.columns","3cd4734a":"pure_df[\"InvoiceDate\"].max()","c1124a8c":"# burada g\u00f6r\u00fcyoruz ki son tarih 2011 y\u0131l\u0131n\u0131n, 12. ay\u0131n\u0131n 9. g\u00fcn\u00fc. bu y\u00fczden biz de ayn\u0131 tarihlerin bir g\u00fcn sonras\u0131n\u0131 alal\u0131m yani 10. g\u00fcn\u00fc ki g\u00fczel bir sonu\u00e7 alal\u0131m.\n\nlast_time = dt.datetime(2011, 12, 10)\n\n# bakal\u0131m d\u00fczg\u00fcn olu\u015fturmu\u015f muyuz ?\n\nlast_time","c21b9497":"# veri setimize tekrar bir g\u00f6z atal\u0131m, ka\u00e7\u0131rd\u0131\u011f\u0131m\u0131z bir \u015fey olabilir :)\n\npure_df.head()","b329c556":"#  M\u00fc\u015fterilerin son sat\u0131n al\u0131mlar\u0131ndan itibaren, son tarihe g\u00f6re ka\u00e7 g\u00fcn ge\u00e7mi\u015f bakal\u0131m : \n# \u00f6nce ge\u00e7ici df olu\u015ftural\u0131m\n\ntemp_df = (last_time - pure_df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}))\n\ntemp_df.head()","fb6e9e0f":"# InvoiceDate de\u011fi\u015fkenini yeniden isimlendirelim : \n\ntemp_df.rename(columns = {\"InvoiceDate\":\"Recency\"}, inplace = True)\n\ntemp_df.head()","19b0de00":"# recency df olu\u015ftural\u0131m ve bu df, ek saat ve dakikalr\u0131 i\u00e7ermesin\n# burada ge\u00e7ici dfteki, recency de\u011fi\u015fkeninin her bir elemana eri\u015ftik, bunlar\u0131n g\u00fcnlerini ald\u0131k.\n\nrecency_df = temp_df[\"Recency\"].apply(lambda x: x.days)\n\nrecency_df.head()","c50a6de2":"freq_df = pure_df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"nunique\"})     # yeni df olu\u015fturduk. bunu Customer ID ye g\u00f6re gruplay\u0131p, Fatura tarihinin e\u015fsiz de\u011ferlerine g\u00f6re yapt\u0131k. \n                                                                            #yani bir kullan\u0131c\u0131 ka\u00e7 farkl\u0131 fatura \u00f6demi\u015f bunu tuttuk.\n\nfreq_df.rename(columns={\"InvoiceDate\": \"Frequency\"}, inplace=True)          # de\u011fi\u015fken ismine s\u0131kl\u0131k dedik\n\nfreq_df.head()","d7d02fae":"monetary_df = pure_df.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"})    # Kullan\u0131c\u0131lara g\u00f6re gurp \u00e7ektik ve bu kullan\u0131c\u0131lar\u0131n her bir al\u0131\u015fveri\u015fin toplam\u0131n\u0131 yeni df'e atad\u0131k.\n\nmonetary_df.rename(columns={\"TotalPrice\":\"Monetary\"}, inplace=True)       # De\u011fi\u015fkeni yeniden isimlendirdik.\n\nmonetary_df.head()","8438128f":"# \u015fimdi elimizdeki ayr\u0131 3 yeni dfin bilgilerine bakal\u0131m : \n\nprint(recency_df.shape,freq_df.shape,monetary_df.shape)","35a032a5":"# bu 3 dataframi, tek bir dataframe de birle\u015ftirelim : \n\nrfm = pd.concat([recency_df, freq_df, monetary_df],  axis=1)\n\nrfm.head()","87031763":"# yeni bir de\u011fi\u015fken olu\u015ftural\u0131m ve buna RecencyScore diyelim. \n\nrfm[\"RecencyScore\"] = pd.qcut(rfm[\"Recency\"], 5, labels = [5, 4 , 3, 2, 1])\n\nrfm.head()","1d6656aa":"# ayn\u0131 i\u015flemi frequency ve monetary i\u00e7in yapal\u0131m\n\nrfm[\"FrequencyScore\"]= pd.qcut(rfm[\"Frequency\"].rank(method=\"first\"),5, labels=[1,2,3,4,5])\n\nrfm[\"MonetaryScore\"] = pd.qcut(rfm['Monetary'], 5, labels = [1, 2, 3, 4, 5])\n\nrfm.head()","b4f1e1da":"# rfm skorlar\u0131 kategorik de\u011fere d\u00f6n\u00fc\u015ft\u00fcr\u00fcl\u00fcp df'e eklendi\nrfm[\"RFM_SCORE\"] = (rfm['RecencyScore'].astype(str) + \n                    rfm['FrequencyScore'].astype(str) + \n                    rfm['MonetaryScore'].astype(str))\n\nrfm.head()","30603876":"# rfm i\u00e7inde ko\u015ful \u00e7al\u0131\u015ft\u0131ral\u0131m ve bu ko\u015fulun ilk 5 g\u00f6zlemine bakal\u0131m : \n# burada de\u011fi\u015fkeni \"555\" e e\u015fit olan g\u00f6zlemler g\u00f6z\u00fck\u00fcrken bunlar\u0131n ilk 5ine bakal\u0131m\n\nrfm[rfm[\"RFM_SCORE\"]==\"555\"].head()","b738bb6a":"# Regular Expressions (D\u00fczenli \u0130fadeler) kullan\u0131larak RFM haritas\u0131 \u00e7\u0131kar\u0131ld\u0131\nseg_map = { \n    r'[1-2][1-2]': 'Hibernating',\n    r'[1-2][3-4]': 'At Risk',\n    r'[1-2]5': 'Can\\'t Loose',\n    r'3[1-2]': 'About to Sleep',\n    r'33': 'Need Attention',\n    r'[3-4][4-5]': 'Loyal Customers',\n    r'41': 'Promising',\n    r'51': 'New Customers',\n    r'[4-5][2-3]': 'Potential Loyalists',\n    r'5[4-5]': 'Champions'\n}","b96a7c30":"# rfm i\u00e7inde \"Segment\" isimli de\u011fi\u015fken olu\u015fturduk ve bu de\u011fi\u015fkeni 2 string birle\u015ftirerek yapt\u0131k.\n\nrfm['Segment'] = rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str)\n\nrfm.head()","12e6151c":"# Segment de\u011fi\u015fkeninin elemanlar\u0131n\u0131n her birini, yukar\u0131daki regex ifadesndeki kar\u015f\u0131l\u0131klar\u0131 ile de\u011fi\u015ftirdik.\n\nrfm['Segment'] = rfm['Segment'].replace(seg_map, regex=True)\n\nrfm.head()","634dc330":"rfm[[\"Segment\",\"Recency\",\"Frequency\", \"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"median\",\"count\"])","4dfdae50":"champions = rfm[rfm[\"Segment\"] == \"Champions\"][\"Monetary\"].sum()\n\nneed_attentions = rfm[rfm[\"Segment\"] == \"Need Attention\"][\"Monetary\"].sum()\n\nnew_customers = rfm[rfm[\"Segment\"] == \"New Customers\"][\"Monetary\"].sum()\n\ngenel_toplam = rfm[\"Monetary\"].sum()","7ecdf842":"print(\"Toplam Gelir : \",genel_toplam)\nprint(\"\u015eampiyonlar\u0131n Harcad\u0131\u011f\u0131 Tutar : \",champions)\nprint(\"Aksiyon Bekleyenlerin Harcad\u0131\u011f\u0131 Tutar : \",need_attentions)\nprint(\"Yeni M\u00fc\u015fterilerin Harcad\u0131\u011f\u0131 Tutar : \",new_customers)","14e13c67":"def yuzde_hesapla(x):\n    return x*100\/genel_toplam","e0b1de56":"print(\"\u015eampiyonlar\u0131n Genel Toplamdaki Harcama Y\u00fczdesi %: \", yuzde_hesapla(champions))\nprint(\"Aksiyon Bekleyenlerin Genel Toplamdaki Harcama Y\u00fczdesi %: \", yuzde_hesapla(need_attentions))\nprint(\"Yeni M\u00fc\u015fterilerin Genel Toplamdaki Harcama Y\u00fczdesi %: \", yuzde_hesapla(new_customers))","e3f09ae8":"#### Aksiyon Gerekli \u0130\u00e7in Yorumlar\nBu ki\u015filer i\u015fletmenin gelirlerinin yakla\u015f\u0131k **%2**'sini olu\u015fturmakta. Bu ki\u015filer bizden yeterince al\u0131\u015fveri\u015f yap\u0131yorlar fakat arzu etti\u011fimiz geliri bize kazand\u0131rm\u0131yorlar.\n\n1- Bu ki\u015filerin al\u0131\u015fveri\u015f faturalar\u0131 incelenmeli, apriori gibi algoritmalarla analiz edilmeliler. Bu \u015fekilde fazla \u00fcr\u00fcn almalar\u0131 sa\u011flanmaya \u00e7al\u0131\u015f\u0131labilir.\n\n2- Zaman zaman hat\u0131rlat\u0131c\u0131 mesajlar at\u0131lmal\u0131 fakat s\u0131k olursa bu ki\u015fide ho\u015fnutsuzlu\u011fa sebep olabilir. Bu y\u00fczden ayda 1 veya 2 mesaj at\u0131labilir. Bu mesajlar iyi dilekler i\u00e7ermeli belki de birka\u00e7 g\u00fcn ge\u00e7erli **%10-15** indirim kuponu sa\u011flanmal\u0131 ya da **3 al 2 \u00f6de** \u015feklinde kampanyalar\u0131n oldu\u011fu haber edilmeli.\n","fec3ec21":"### RFM ANAL\u0130Z\u0130NE GE\u00c7EL\u0130M","f7361389":"##### **Recency** : _M\u00fc\u015fterinin son sat\u0131n almas\u0131ndan bug\u00fcne kadar ge\u00e7en s\u00fcre_\n\n##### **Frequency** : _Toplam sat\u0131n alma say\u0131s\u0131_\n\n##### **Monetary** : _M\u00fc\u015fterinin yapt\u0131\u011f\u0131 toplam harcama._","8069445c":"## **Recency \u0130\u00e7in \u0130\u015flemler**","c5996a47":"## **RFM \u0130\u015flemleri Sonras\u0131 \u00d6neriler**","a3d62c7f":"#### Yeni M\u00fc\u015fteriler \u0130\u00e7in Yorumlar\nYeni m\u00fc\u015fteriler bir i\u015fletmede kan tazeletecektir. Yeni \u00fcr\u00fcnlerin sat\u0131lmas\u0131 imkan\u0131 sa\u011flayabilir, yeni pazar paylar\u0131 elde etmeye ara\u00e7 olabilirler.\nHer insan yeni bir yere girdi\u011finde bir gariplik hisseder ve ara\u015ft\u0131rmak, g\u00fcvende olma iste\u011fi duyar. Bu y\u00fczden bu ki\u015filere :\n\n1- G\u00fcvenlice al\u0131\u015fveri\u015f yapabileceklerine dair 1-2 bilgilendirici mesaj g\u00f6nderilebilir.\n\n2- Yeni gelenlere \u00f6zel k\u00fc\u00e7\u00fck promosyonlar yap\u0131labilir. **X \u00fcr\u00fcn\u00fc alana Y \u00fcr\u00fcn\u00fc %10 indirimli** gibi kampanyalar yap\u0131labilir.\n\n3- \u0130lk 3 al\u0131\u015fveri\u015fte **%5-10** aras\u0131nda indirim uygulanabilir.\n\n4- \u00c7ok fazla reklam g\u00f6stermek m\u00fc\u015fteride negatif etki yapacakt\u0131r. Belli ba\u015fl\u0131 reklamlar veya haberler m\u00fc\u015fterinin ilgisini \u00e7ekebilir.","4f32fcbe":"#### \u015eampiyonlar \u0130\u00e7in Yorumlar\n\u015eampiyonlar bu i\u015fletmenin gelirlerinin **%49**'a yak\u0131n\u0131n\u0131 olu\u015fturuyor. Bu nedenle bu ki\u015fileri kaybetmememiz gerekiyor.\nFakat bu ki\u015filer zaten bizden s\u0131k ve \u00e7ok al\u0131\u015fveri\u015f yap\u0131yorlar. Bu ki\u015filere \u00e7ok indirim yapmak, kazand\u0131rd\u0131klar\u0131 paray\u0131 d\u00fc\u015f\u00fcrebilir.\nBir insan olarak s\u0131k al\u0131\u015fveri\u015f yapt\u0131\u011f\u0131m\u0131z yerden di\u011ferlerine g\u00f6re ayr\u0131cal\u0131k bekleriz. O halde bu i\u015fletme :\n\n1-\u015eampiyonlara \u00f6zel \u00fcyelik sistemi getirmeli. \u00dcyelik sisteminde **%3-7 belki %10'**lara varan indirimler yap\u0131labilir. Bu indirimler s\u00fcrekli olmamal\u0131 ve genel indirim zamanlar\u0131na da denk  gelmemeli. Belki s\u00fcreli indirim olabilir. Her ay ba\u015flang\u0131c\u0131ndan itibaren 1 hafta gibi bir s\u00fcre bu indirimlerden yararlanabilirler.\n\n2-Bu ki\u015filere zaman zaman g\u00fczel dileklerde bulunmak, \u00f6nemli hissettirecek mesajlar atmak de\u011ferli hissettirecektir ve bu da kal\u0131c\u0131l\u0131\u011f\u0131 artt\u0131racakt\u0131r. **Her insan, \u00f6nemli hissetmeyi sever.**\n\n3-Promosyon linkleri olmal\u0131 ve bunlar da \u00f6d\u00fcllendirilmeli. Yeni bir m\u00fc\u015fteri getirme ba\u015f\u0131na bir hediye sistemi olabilir. Bu ayr\u0131ca **yeni m\u00fc\u015fteri de \u00e7ekecektir.**"}}