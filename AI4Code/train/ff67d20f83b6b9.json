{"cell_type":{"bde7de06":"code","90016b92":"code","50a67e1b":"code","5d438dce":"code","d589e9cc":"code","30ae5cd1":"code","5603de80":"code","57f1e0ba":"code","83da2b77":"code","86357438":"code","9d8a83cd":"markdown","789229e6":"markdown","b87006d7":"markdown","b30bf45d":"markdown","197beb1a":"markdown","df079a04":"markdown","ea08a4ae":"markdown","2568ae3f":"markdown","e59f8dbf":"markdown","48317543":"markdown","650d2885":"markdown","10a8df82":"markdown"},"source":{"bde7de06":"# Load libraries\nimport numpy as np\nimport pandas as pd\nimport scipy.stats as stats\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport os","90016b92":"# Read in data\ndf = pd.read_csv(\"..\/input\/insurance\/insurance.csv\")\n\n# Get closer look at the data\ndf.head()\ndf.info()\n\n# Check numerical columns for outliers or unusual values\ndf.describe()\n\n# Check categorical columns for appropriate values\ndf[\"sex\"].value_counts()\ndf[\"smoker\"].value_counts()\ndf[\"region\"].value_counts()\n\n# Check for duplicates and remove\ndupes = df[df.duplicated()]\ndupes # 1 duplicate result found\ndf = df.drop_duplicates()","50a67e1b":"# We'll create a new column based on bmi\nbmi_conditions = [\n    (df[\"bmi\"] < 18.5),\n    (df[\"bmi\"] < 24.9),\n    (df[\"bmi\"] < 30),\n    (df[\"bmi\"] >= 30)\n    ]\nbmi_categories = [\"underweight\", \"healthy weight\", \"overweight\", \"obesity\"]\ndf[\"bmi_cat\"] = np.select(bmi_conditions, bmi_categories)\n\nprint(df.head())","5d438dce":"# Correlation Matrix\ncont_var = df[[\"age\", \"bmi\", \"children\", \"charges\"]]\nprint(cont_var.corr()) # It's worth exploring age and charges, so let's visualize!","d589e9cc":"# Charges vs Age\np1 = sns.relplot(data = df,\n            kind = \"scatter\",\n            x = \"age\",\n            y = \"charges\")\np1.fig.suptitle(\"Age v Charges\",\n                y = 1.01)\np1.set(xlabel = \"Age\",\n       ylabel = \"Charges ($)\")\nplt.show()","30ae5cd1":"# Check for data distribution\nstats.shapiro(df[\"age\"]) # not norally distributed\n\n# We'll use Kendall's Tau\ntau, p_value = stats.kendalltau(df[\"age\"], df[\"charges\"])\nprint(tau) # .47 tau strong correlation\nprint(p_value) # < .05\n\n# Splitting the data by high and low age\nage_conditions = [\n    (df[\"age\"] < 29),\n    (df[\"age\"] < 54),\n    (df[\"age\"] > 53)]\nage_categories = [\"young\", \"middle\", \"older\"]\ndf[\"age_cat\"] = np.select(age_conditions, age_categories)\n\navg_charges_age = df.groupby(\"age_cat\")[\"charges\"].mean()\nprint(avg_charges_age)","5603de80":"# Charges vs Age (bmi_cat as color)\np2 = sns.relplot(data = df,\n                 kind = \"scatter\",\n                 x = \"age\",\n                 y = \"charges\",\n                 hue = \"bmi_cat\",\n                 hue_order = [\"underweight\",\n                              \"healthy weight\",\n                              \"overweight\",\n                              \"obesity\"])\np2.fig.suptitle(\"Age v Charges grouped by BMI\",\n                y = 1.03)\np2.set(xlabel = \"Age\",\n       ylabel = \"Charges ($)\")\nplt.show()\n\n# Charges vs Age (bmi_cat as color, faceted)\np3 = sns.relplot(data = df,\n                 kind = \"scatter\",\n                 x = \"age\",\n                 y = \"charges\",\n                 hue = \"bmi_cat\",\n                 hue_order = [\"underweight\",\n                              \"healthy weight\",\n                              \"overweight\",\n                              \"obesity\"],\n                 col = \"bmi_cat\",\n                 col_wrap = 2)\np3.fig.suptitle(\"Age v Charges faceted by BMI\",\n                y = 1.03)\np3.set(xlabel = \"Age\",\n       ylabel = \"Charges ($)\")\np3.set_titles(\"{col_name}\")\nplt.show()","57f1e0ba":"# Highest band is made up almost exclusively of people in the obesity category\n# Let's examine the correlation numerically\nobese = df[df[\"bmi_cat\"] == \"obesity\"]\n\n# Kendall's Tau\ntau, p_value = stats.kendalltau(obese[\"bmi\"], obese[\"charges\"])\nprint(tau) # tau = .04 -> weak correlation\nprint(p_value) # >.05","83da2b77":"# What else could explain highest trend band featuring exclusively obese?\n# Let's explore further and add a shape to the visualization\n\np4 = sns.relplot(data = df,\n                 kind = \"scatter\",\n                 x = \"age\",\n                 y = \"charges\",\n                 hue = \"bmi_cat\",\n                 hue_order = [\"underweight\",\n                              \"healthy weight\",\n                              \"overweight\",\n                              \"obesity\"],\n                 style = \"smoker\",\n                 style_order = [\"no\",\n                                \"yes\"])\np4.fig.suptitle(\"Age v Charges grouped by BMI\",\n                y = 1.03)\np4.set(xlabel = \"Age\",\n       ylabel = \"Charges ($)\")\nplt.show()\n\n# Faceting by smoking\np5 = sns.relplot(data = df,\n                 kind = \"scatter\",\n                 x = \"age\",\n                 y = \"charges\",\n                 hue = \"bmi_cat\",\n                 hue_order = [\"underweight\",\n                              \"healthy weight\",\n                              \"overweight\",\n                              \"obesity\"],\n                 style = \"smoker\",\n                 style_order = [\"no\",\n                                \"yes\"],\n                 col = \"smoker\")\np5.fig.suptitle(\"Age v Charges grouped by BMI\",\n                y = 1.03)\np5.set(xlabel = \"Age\",\n       ylabel = \"Charges ($)\")\nplt.show()","86357438":"# Let's look at all BMI categories with and without smoking and their\n# related average charges\n# All averages\navg_charges_all = df.groupby([\"bmi_cat\", \"smoker\"])[\"charges\"].agg([(\"avg_charges\", \"mean\")]).reset_index()\n\n# Let's visualize this summary of average charges\np6 = sns.catplot(data = avg_charges_all,\n            kind = \"bar\",\n            x = \"bmi_cat\",\n            y = \"avg_charges\",\n            hue = \"smoker\")\np6.fig.suptitle(\"Average Charges v BMI and Smokers\",\n                y = 1.03)\np6.set(xlabel = \"BMI Category\",\n       ylabel = \"Average Charges ($)\")\nplt.show()","9d8a83cd":"# Conclusions\n\nAs discussed in the key findings section, smoking is the biggest indicator of increased charges billed by medical insurance. We can see that a person's BMI category plays a significant role in elevating those charges further, especially going from the overweight category to obesity. \n\nWe also saw that age is a significant indicator for higher insurance charges. As we get older, we require more medical attention, but we can still mitigate the effects of age by not smoking and keeping our weight in a healthy BMI category.","789229e6":"## Correlation Matrix\n\nWe're going to create a correlation matrix to inform our visual exploration of the data. We're looking for variables that have a positive or negative correlation with charges. \n\nThis code creates a dataframe called cont_var that contains the continuous variable columns of the original dataframe (df). \n\nOur correlation matrix tells us that it is worth exploring how age affects charges.","b87006d7":"## Visualizing Correlations\n\n### Charges vs Age\n\nOur correlation matrix indicates that we should explore:\n* Charges vs age\n* Charges vs bmi\n\nThe code let's us take a look at Charges vs Age. There appears to be three distinct trend bands, each showing a positive correlation between charges and ages as our correlation matrix told us.","b30bf45d":"## Visualizing difference in average charges among smokers and non-smokers\n\nWe're taking the same data from above and visualizing it. \nBelow are some key points:\n* The lowest average smoker charges are still **2 times greater** than the highest average non-smoker charges\n* Quitting smoking is the single best way to reduce insurance charges\n* For obese smokers, losing weight to drop into overweight category can **lower** insurance charges almost **50%**","197beb1a":"**Analyzing Indicators in Insurance Data**\n\n\n# **Introduction**\n\nIn this case study, we'll be taking a look at insurance data, looking for any indicators we can use to predict higher insurance charges. We have a dataset featuring a collection of patients from around the country with their demographic information, body mass index, smoking status, and their medical charges billed by insurance. \n\nWe will:\n* Import and clean data\n* Explore data visually and numerically\n* Identify significant correlations\n* Visualize our findings\n\n# **Key Findings**\n\n* The **single biggest indicator** of increased insurance charges is **smoking**\n    * Smokers, regardless of age or BMI, had average insurance charges **3.39 times higher** than non-smokers\n    * Obese smokers had the **highest** average insurance charges\n        * Leaving BMI category unchanged, quitting smoking could **reduce** their insurance charges **61%**\n        \n* **Age** is a big indicator of increased insurance charges\n     * There is a statistically significant positive correlation between age and insurance charges\n         * **49% increase** between age group 18-28 to age group 54-64","df079a04":"We will now load in the necessary libraries to perform the analysis","ea08a4ae":"# Exploration and Analysis\n\n## Creating Categories by BMI\n\nThe body mass index (BMI) is a calculation using a person's height and weight. [The CDC has created four main categories:](https:\/\/www.cdc.gov\/obesity\/adult\/defining.html)\n* Underweight < 18.5 BMI\n* Healthy Weight 18.5 - 24.9 BMI\n* Overweight 25-29.9 BMI\n* Obesity > 30 BMI\n\nCreating these categories in a new column will help to group and manipulate the data further. We can really see trends among those groups and explore them further. We'll call our new column bmi_cat.","2568ae3f":"## Charges v Age Numerically\n\nThe code below shows us that there is a very strong correlation between age and charges, confirming what we have seen in our visualization.\n\nWe have data on adults aged 18-64:\n* Adults aged 18-28 incur, on average, **50% less** charges than adults aged 54-64\n\nHowever, this doesn't explain the three separate trend bands, so we will explore this line of inquiry further!","e59f8dbf":"## Charges v Age with BMI & Smoker Visual\n\nAdding smoking to our visualization really opened up the picture for us:\n* The top band is compromised of almost exclusively obese smokers\n* The middle band contains mostly:\n    * Over weight smokers\n    * Obese non smokers\n    * Healthy weight smokers, with a hand full of non smokers\n* Visual inspection appears to not show a single smoker in the bottom trend band regardless of BMI category","48317543":"## Charges v Age with BMI Visual\n\nSeveral interesting points:\n* Almost every single data point in the top trend band belongs to \"obesity\"\n    * We see obesity in the bottom trend band as well, so there must be an additional explanation\n* Overweight make up a lot of the second band, but a good amount of obesity and healthy weight\n    * What is causing healthy weight folks to be in these upper bands? ","650d2885":"## Charges v Age with BMI numerically\n\nThe code tells us that the data is not normally distributed so we will use the Kendall method to assess correlation. \n\nThere is a very weak correlation between the obesity category and charges. This makes sense because, as we saw in our previous visualization, the obesity category is in all three bands. \n\nWe have some additional categorical variables to investigate: smoker, children, region, sex. The most intuitive place to start is with smoker, so let's take a closer look.","10a8df82":"# Loading and Processing Data\n\nWith the following code we are:\n* Loading the data\n* Getting a quick view of how it looks\n* Checking the data structure\n* Looking for inappropriate values in numeric and categorical columns\n* Looking for and removing duplicate rows\n\nNo columns have any extreme outliers, mispelled words, or anything else that could affect our analysis. "}}