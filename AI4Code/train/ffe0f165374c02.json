{"cell_type":{"4810ea5e":"code","6803ff16":"code","2efe080d":"code","76403e54":"code","9cbea14f":"code","35d6cab7":"code","9d127957":"code","d0ff948a":"code","0294a7d2":"code","f20e403f":"code","7a451ed2":"code","58d7f260":"code","5b516175":"code","8dc0a815":"code","51e62e36":"code","dcea90d4":"code","59ec93b3":"code","56f5dcc8":"code","f6dd0251":"code","48b3298a":"code","b02d923d":"code","098686ae":"code","517483d3":"code","be2306ac":"code","2124d678":"code","d97ba57a":"code","1560794b":"code","29eb1728":"code","0f80260a":"code","9b61f440":"code","59a89f83":"markdown","5451eb19":"markdown","0c12f66b":"markdown","e23e08fe":"markdown","bced3fe6":"markdown","afc36e66":"markdown","d756b7c4":"markdown","e0211f04":"markdown","b5275b8c":"markdown","4c7559eb":"markdown","5ca64f4a":"markdown","0ec3d97e":"markdown","5d4c39ac":"markdown","9b7f8248":"markdown","f5090586":"markdown","75d047d3":"markdown","453e03bc":"markdown","c18ecd68":"markdown","33a0e2d2":"markdown"},"source":{"4810ea5e":"# Data Analysis\nimport numpy as np \nimport pandas as pd \n\n# Data Visualisation \nimport matplotlib.pyplot as plt \nimport seaborn as sns","6803ff16":"monthly_data = pd.read_csv('..\/input\/python\/Portfolios_Formed_on_ME_monthly_EW.csv',\n                           header=0, index_col=0, parse_dates=True, na_values=-99.99)\nmonthly_data.shape","2efe080d":"# Let's look at the data\nmonthly_data.head()","76403e54":"# Extract the data\nreturns = monthly_data[['Lo 10', 'Hi 10']]\nreturns.columns = ['SmallCap', 'LargeCap']\nreturns.head()","9cbea14f":"# Convert Returns to percentages \nreturns = returns\/100\nreturns","35d6cab7":"# Make a line plot of the returns\nreturns.plot.line()","9d127957":"returns.index = pd.to_datetime(returns.index, format=\"%Y%m\")\nreturns","d0ff948a":"returns.index = returns.index.to_period('M')\nreturns","0294a7d2":"# Plot the data again \nreturns.plot.line()","f20e403f":"# Get the data in the year 1960 \nreturns['1960']","7a451ed2":"# Compute the wealth index by starting with 1000 dollars\n# The starting value won't matter with drawdowns\n\nwealth_index = 1000*(1+returns['LargeCap']).cumprod()\nwealth_index.head()","58d7f260":"# Plot the wealth index over time \nwealth_index.plot.line()","5b516175":"# Compute the previous peaks \nprevious_peaks = wealth_index.cummax()\nprevious_peaks.head()","8dc0a815":"# Plot the previous peaks\nprevious_peaks.plot.line()","51e62e36":"# Calculate the drawdown in percentage\ndrawdown = (wealth_index - previous_peaks)\/previous_peaks","dcea90d4":"# Plot the drawdown \ndrawdown.plot.line()","59ec93b3":"drawdown.head()","56f5dcc8":"# Get the worst drawdown \ndrawdown.min()","f6dd0251":"drawdown.idxmin()","48b3298a":"# Get the worst drawdown since 1975\nprint(f\"The worst drawdown since 1975 was {drawdown['1975':].min()} on {drawdown['1975':].idxmin()}\")","b02d923d":"# Get the worst drawdown in the 90s \nprint(drawdown['1990':'1999'].min())\nprint(drawdown['1990':'1999'].idxmin())","098686ae":"# Combine Plots \nwealth_index.plot.line()\nprevious_peaks.plot.line()\n","517483d3":"# Make a drawdown function\ndef compute_drawdown(return_series: pd.Series):\n    '''\n        ARGS: \n            Takes in a series of returns\n            \n        RETURNS:\n            Wealth index\n            Previous Peaks \n            Percent Drawdowns            \n    '''\n    \n    # Calculate the wealth previous peaks and drawdowns\n    wealth_index = 1000*(1+return_series).cumprod()\n    previous_peaks = wealth_index.cummax()\n    drawdowns = (wealth_index - previous_peaks)\/previous_peaks\n    \n    # Create a dataframe \n    drawdown_data = pd.DataFrame({'Wealth': wealth_index, \n                                  'Peaks': previous_peaks,\n                                  'Drawdown': drawdowns})\n    return drawdown_data","be2306ac":"# Get the data for small cap stocks \nsmall_cap_drawdowns = compute_drawdown(returns['SmallCap'])\nsmall_cap_drawdowns","2124d678":"# Lets plot the wealth and the peaks \nsmall_cap_drawdowns[['Wealth', 'Peaks']].plot.line()","d97ba57a":"small_cap_drawdowns['Drawdown'].plot.line()","1560794b":"small_cap_drawdowns['Drawdown'].min()","29eb1728":"small_cap_drawdowns['Drawdown'].idxmin()","0f80260a":"# Get the worst drawdown since 1975\nprint(f\"The worst drawdown since 1975 was {small_cap_drawdowns['Drawdown']['1975':].min()} on {small_cap_drawdowns['Drawdown']['1975':].idxmin()}\")","9b61f440":"# Get the worst drawdown since 1975\nprint(f\"The worst drawdown since 1975 was {drawdown['1975':].min()} on {drawdown['1975':].idxmin()}\")","59a89f83":"So, the 2008 crash was clearly worse for small cap stocks. ","5451eb19":"This is line is always moving upward. The points where we get a loss is where it flattens because we are only keep the cumulative max value. ","0c12f66b":"The cumulative effect is evident. ","e23e08fe":"The worst drawdown was roughly 84% and it was on 1932-05.\n\nAs a time series, there are many operations that we can do on this data. ","bced3fe6":"This looks a lot better. Now, we have monthly data for each small cap index and large cap index from the year 1926 to 2018. Pretty cool! However, the time stamp is given as first of the month however, these are the monthly averaged returns. So, we don't really need the date and we can just save the month-year representation. ","afc36e66":"## Read in the data ","d756b7c4":"# Maximum Drawdown Volatility Measure\n\nA notebook dedicated to understanding volatility measures on real-world data. \n\n**Maximum Drawdown:** A maximum drawdown (MDD) is the maximum observed loss from a peak to a trough of a portfolio, before a new peak is attained. Maximum drawdown is an indicator of downside risk over a specified time period. It can be used both as a stand-alone measure or as an input into other metrics such as \"Return over Maximum Drawdown\" and the Calmar Ratio. Maximum Drawdown is expressed in percentage terms.\n\n**Formula**\n\n$MDD = \\frac{Trough Value - Peak Value}{Peak Value}$\n","e0211f04":"Drawdowns are calculating the negative returns and hence, they are between 0 and -1.","b5275b8c":"Finally, we need to make a combined plot of peaks wealth index to visualise drawdowns.","4c7559eb":"## Data Preprocessing\n\nCollect the data for Small Cap and Large Cap Companies named as Low10 and High 10","5ca64f4a":"Since the index is in time series format, we can do a lot of data manipulation using dates very easily. We can quickly extract the sections as well. ","0ec3d97e":"## Compute Drawdowns \n\nSteps to compute the drawdowns. \n\n1. **Compute the Wealth Index:** Value of a portfolio when it compounds over time over returns. \n2. **Compute the previous peak** \n3. **Compute drawdown** \n\nLet's start with LargeCap data.","5d4c39ac":"The damage was also similar in 1932. Let's check for damages since 1975.","9b7f8248":"The index is actually messed up and we need to fix this by converting it to time series to get better visualisations. ","f5090586":"It's important to plot the wealth and peak together to understand where the biggest dropdowns occurred. ","75d047d3":"## Import Necessary libraries","453e03bc":"Small Caps generally show more losses and that goes in line with our knowledge of large and small cap stocks. ","c18ecd68":"This is very interesting. The crash of 1929 was much worse than 2000 or 2008 where people lost over 80% of their wealth. This was decimating. Let's look at some important values. ","33a0e2d2":"Plot the returns to see the trend."}}