{"cell_type":{"f700c76d":"code","ca61ed24":"code","cb3def78":"code","b93c6969":"code","b69b7f57":"code","a4781c9f":"code","902118b5":"code","6df03d12":"code","66309c9e":"code","efa9f523":"code","7d0348e8":"code","411bd316":"code","3e6b7355":"code","9bad9299":"code","b099b3a5":"code","14cafdfc":"code","fec7c81d":"code","4b0b44c0":"code","905435d3":"code","9f8ed3ad":"code","e7b618c8":"code","e7abe3cf":"code","e440ded2":"code","08fc089f":"code","7effe576":"code","0aad0a9f":"code","aaeb307e":"code","ca9d36d9":"code","f1b1414c":"code","663d9236":"code","1d79f39d":"code","de39de15":"code","7c61467b":"code","083a7474":"code","f770a7c5":"code","4f97f657":"code","e4cb3d17":"code","6b3fb1d4":"code","f17bab63":"code","db94f2e6":"code","24b55817":"code","2908cd87":"code","a457caa1":"code","c2459736":"code","55b08cb7":"code","3f1f5a9c":"code","137eb0d6":"code","eb6a61d5":"code","4f8431ee":"code","c8973717":"code","40c4d87c":"code","a69b4594":"markdown","17b0519e":"markdown","7098cd7b":"markdown","619abe3d":"markdown","6761218e":"markdown","88b06fbd":"markdown","8de92253":"markdown","2c5ee57f":"markdown","fac9d70f":"markdown","ed540ebb":"markdown","bcbe149c":"markdown","36ffba23":"markdown","f03770f6":"markdown","4217099c":"markdown","f3ad1130":"markdown","0744859c":"markdown","00871438":"markdown","9b9d3eab":"markdown","7624c629":"markdown","70bce6bc":"markdown","6a470d98":"markdown"},"source":{"f700c76d":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","ca61ed24":"import numpy as np \nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport missingno as msno\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.pipeline import make_pipeline\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.impute import KNNImputer","cb3def78":"data = pd.read_csv('\/kaggle\/input\/fifa-21-player-and-formation-analysis\/fifa21.csv')\ndata.shape","b93c6969":"data.columns","b69b7f57":"features = ['Name', 'Age', 'Nationality', 'Overall', 'Potential', 'Club', 'Value', 'Wage', 'Special',\n       'Preferred Foot', 'Weak Foot', 'Skill Moves','International Reputation', 'Work Rate', 'Body Type', \n        'Position', 'Height', 'Weight', 'Likes', 'Dislikes', 'Following', 'Crossing', 'Finishing',\n       'Heading Accuracy', 'Short Passing', 'Volleys', 'Dribbling', 'Curve','FK Accuracy', 'Long Passing', \n        'Ball Control', 'Acceleration','Sprint Speed', 'Agility', 'Reactions', 'Balance', 'Shot Power',\n        'Jumping', 'Stamina', 'Strength', 'Long Shots', 'Aggression','Interceptions', 'Positioning', \n        'Vision', 'Penalties', 'Composure', 'Standing Tackle', 'Sliding Tackle', \n        'GK Diving','GK Handling', 'GK Kicking', 'GK Positioning', 'GK Reflexes']","a4781c9f":"df = data[features]\ndf.shape","902118b5":"# Cleaning the Value column\ndef clean_money(column):\n    values = []\n    for value in data[column].fillna(''):\n        if value[-1]=='M':\n            money = 1000000\n            money *= float(value[1:-1])\n        elif value[-1]=='K':\n            money = 1000\n            money *= float(value[1:-1])\n        else: \n            money = 0\n        values.append(money\/1000000)\n    return values\n\n# Cleaning Weight column\ndef clean_weight():\n    weights = []\n    for weight in data['Weight'].fillna(''):\n        if weight != '':\n            weights.append(int(weight[:-3]))\n        else:\n            weights.append(np.nan)\n    return weights\n\n# Cleaning Height Column\ndef clean_height():\n    heights = []\n    for height in data['Height'].fillna(''):\n        if height != '':\n            height =int(height[0])*12 + int(height[2])\n            heights.append(height)\n        else:\n            heights.append(np.nan)\n    return heights\n\n# # Cleaning Release Clause\ndef clean_release_clause():\n    release_clause = []\n    for clause in data['Release Clause'].fillna(''):\n        if clause == '':\n            money=0.0\n        elif clause[-1]=='M':\n            money = 1000000\n            money *= int(clause[1:-1])\n        elif clause[-1]=='K':\n            money = 1000\n            money *= int(clause[1:-1])\n        else: \n            money = 0\n        release_clause.append(money\/1000000)\n    return release_clause","6df03d12":"##Remove the # and run the below lines to clean the data:\ndata['Weight'] = clean_weight()\ndata['Height'] = clean_height()","66309c9e":"data['Height']","efa9f523":"data['Release Clause']","7d0348e8":"data['Wage']","411bd316":"def clean_height():\n    heights = []\n    for height in data['Height'].fillna(''):\n        if height != '':\n            height =int(height[0])*12 + int(height[2])\n            heights.append(height)\n        else:\n            heights.append(np.nan)\n    return heights\n#data['Height'] = clean_height()\ndata['Height']","3e6b7355":"df.isna().sum()","9bad9299":"numerical_features =['Age', 'Overall', 'Potential', 'Value', 'Wage', 'Special', 'Height',\n                   'Weight', 'Likes', 'Dislikes','Following', 'Crossing', 'Finishing', 'Heading Accuracy', 'Short Passing',\n                   'Volleys', 'Dribbling', 'Curve', 'FK Accuracy', 'Long Passing',\n                    'Ball Control', 'Acceleration', 'Sprint Speed', 'Agility', 'Reactions',\n                   'Balance', 'Shot Power', 'Jumping', 'Stamina', 'Strength', 'Long Shots',\n                   'Aggression', 'Interceptions', 'Positioning', 'Vision', 'Penalties',\n                   'Composure', 'Standing Tackle', 'Sliding Tackle', 'GK Diving',\n                   'GK Handling', 'GK Kicking', 'GK Positioning', 'GK Reflexes']\n\ncategorical_features = ['Name','Nationality', 'Club', 'Preferred Foot', 'Work Rate','Body Type', \n                        'Position','International Reputation', 'Weak Foot', 'Skill Moves']","b099b3a5":"df[numerical_features].describe().T","14cafdfc":"data_num = df[numerical_features]\ndata_num.dtypes","fec7c81d":"data_cat = df[categorical_features]\ndata_cat.dtypes","4b0b44c0":"fig = plt.figure(figsize=(15,7))\nsns.heatmap(df.isna(), yticklabels=False, cmap='YlGnBu')","905435d3":"fig = plt.figure(figsize=(100,100))\nfig.subplots_adjust(hspace=0.4, wspace=0.1)\n\nax = fig.add_subplot(7, 7, 1)\nsns.heatmap(df[categorical_features].isna(), yticklabels=False, cmap='YlGnBu')\n\nax = fig.add_subplot(7, 7, 2)\nsns.heatmap(df[numerical_features].isna(), yticklabels=False, cmap='YlGnBu')","9f8ed3ad":"fig = plt.figure(figsize=(20,30))\nfig.subplots_adjust(hspace=0.4, wspace=0.4)\ncount=1\nfor feature in numerical_features:\n    ax = fig.add_subplot(len(numerical_features)\/\/4+1, 4, count)\n    sns.boxplot(x = data[feature])\n    count +=1","e7b618c8":"corr_ = df[numerical_features].corr()\n\nf,ax = plt.subplots(figsize=(25, 10))\nsns.heatmap(corr_,annot=True, linewidths=0.5, cmap=\"YlGnBu\", fmt= '.1f',ax=ax)\nplt.show()","e7abe3cf":"features =  ['Crossing', 'Finishing', 'Heading Accuracy', 'Short Passing','Volleys', 'Dribbling', 'Curve', 'FK Accuracy', 'Long Passing','Ball Control', \n            'Acceleration', 'Sprint Speed', 'Agility', 'Reactions','Balance', 'Shot Power','Stamina','Long Shots','Aggression', 'Interceptions', \n            'Positioning', 'Vision', 'Penalties','Composure','GK Diving','GK Handling', 'GK Kicking', 'GK Positioning', 'GK Reflexes']\n\nfig = plt.figure(figsize=(20,30))\nfig.subplots_adjust(hspace=0.4, wspace=0.4)\ncount=1\nfor feature in features:\n    ax = fig.add_subplot(len(features)\/\/4+1, 4, count)\n    sns.scatterplot(x=df['Special'], y=df[feature])\n    count +=1","e440ded2":"sns.scatterplot(x= 'Balance', y = 'Weight', data = df)","08fc089f":"fig = plt.figure(figsize=(15,5))\nfig.subplots_adjust(hspace=0.4, wspace=0.4)\n\nax = fig.add_subplot(1, 3, 1)\nsns.scatterplot(x=df['Interceptions'], y=df['Standing Tackle'])\n\nax = fig.add_subplot(1, 3, 2)\nsns.scatterplot(x=df['Interceptions'], y=df['Sliding Tackle'])\n\nax = fig.add_subplot(1, 3, 3)\nsns.scatterplot(x=df['Standing Tackle'], y=df['Sliding Tackle'])\n","7effe576":"fig = plt.figure(figsize=(5,5))\nsns.distplot(x = data['Height'])","0aad0a9f":"train_df = data[['Special']+features[:-5]].dropna()\ntest_df = data[data[['Special']+features[:-5]].isnull().any(axis=1)]","aaeb307e":"for feature in features[:-5]:\n    \n    polyreg = make_pipeline(PolynomialFeatures(2),LinearRegression())\n    polyreg.fit(X = train_df[['Special']], y = train_df[feature])\n    \n    predicted_output = polyreg.predict(test_df[['Special']])\n    test_df[feature] = np.round(predicted_output)\n    df[feature].fillna(test_df[feature], inplace=True)","ca9d36d9":"fig = plt.figure(figsize=(20,30))\nfig.subplots_adjust(hspace=0.4, wspace=0.4)\ncount=1\nfor feature in features[:-5]:\n    ax = fig.add_subplot(len(features[:-5])\/\/4+1, 4, count)\n    sns.scatterplot(x=train_df[feature], y=train_df['Special'])\n    sns.scatterplot(x=test_df[feature], y=test_df['Special'], palette=\"deep\")\n    count +=1","f1b1414c":"train_df = data[['Special']+features[-5:]].dropna()\ntest_df = data[data[features[-5:]].isnull().any(axis=1)][['Special']+features[-5:]]","663d9236":"imputer = KNNImputer(n_neighbors=1)\nimputer.fit(train_df)\npredicted_df = pd.DataFrame(np.round(imputer.transform(test_df)), columns=test_df.columns,index=test_df.index)","1d79f39d":"for col in test_df.columns[1:]:\n    df[col].fillna(predicted_df[col], inplace=True)","de39de15":"fig = plt.figure(figsize=(20, 10))\nfig.subplots_adjust(hspace=0.4, wspace=0.4)\ncount=1\nfor feature in features[-5:]:\n    ax = fig.add_subplot(2, 3, count)\n    sns.scatterplot(x=train_df[feature], y=train_df['Special'])\n    sns.scatterplot(x=predicted_df[feature], y=predicted_df['Special'])\n    count +=1","7c61467b":"train_df = data[['Weight', 'Balance']].dropna()\ntest_df = data[data['Balance'].isna()][['Weight', 'Balance']]\ntest_df","083a7474":"polyreg=make_pipeline(PolynomialFeatures(1),LinearRegression(1))\npolyreg.fit(X = train_df[['Balance']], y = train_df['Weight'])\n\ntest_df['Balance'] = np.round(polyreg.predict(test_df[['Weight']]))   #.reshape(-1,1)\ntest_df","f770a7c5":"df['Weight'].fillna(test_df['Weight'], inplace=True)","4f97f657":"sns.scatterplot(train_df['Weight'], train_df['Balance'])\nsns.scatterplot(test_df['Weight'], test_df['Balance'])","e4cb3d17":"train_df = df[['Standing Tackle', 'Sliding Tackle', 'Interceptions']].dropna()\ntest_df = df[df['Sliding Tackle'].isna()][['Standing Tackle', 'Sliding Tackle', 'Interceptions']]","6b3fb1d4":"for feature in ['Standing Tackle', 'Sliding Tackle']:\n    polyreg=make_pipeline(PolynomialFeatures(2),LinearRegression())\n    polyreg.fit(X = train_df[['Interceptions']], y = train_df[feature])\n\n    test_df[feature] = np.round(polyreg.predict(test_df[['Interceptions']]))\n    df[feature].fillna(test_df[feature], inplace=True)","f17bab63":"fig = plt.figure(figsize=(20, 5))\nfig.subplots_adjust(hspace=0.4, wspace=0.4)\ncount=1\nfor feature in ['Standing Tackle', 'Sliding Tackle']:\n    ax = fig.add_subplot(1, 2, count)\n    sns.scatterplot(train_df['Interceptions'], train_df[feature])\n    sns.scatterplot(test_df['Interceptions'], test_df[feature])\n    count +=1","db94f2e6":"df['Height'].fillna(61.0, inplace=True)\ndf['Jumping'].fillna(df['Jumping'].mean(), inplace=True)\ndf['Strength'].fillna(df['Strength'].mean(), inplace=True)","24b55817":"df[numerical_features].isna().sum()","2908cd87":"for feature in ['Standing Tackle']:\n    polyreg=make_pipeline(PolynomialFeatures(2),LinearRegression())\n    polyreg.fit(X = train_df[['Interceptions']], y = train_df[feature])\n\n    test_df[feature] = np.round(polyreg.predict(test_df[['Interceptions']]))\n    df[feature].fillna(test_df[feature], inplace=True)","a457caa1":"df['Standing Tackle'].fillna(df['Standing Tackle'].mean(), inplace=True)","c2459736":"df[numerical_features].isna().sum()","55b08cb7":"df[categorical_features].isna().sum()","3f1f5a9c":"fig = plt.figure(figsize=(15,5))\nsns.countplot(df['Position'])","137eb0d6":"fig = plt.figure(figsize=(100,20))\nsns.countplot(df['Body Type'])","eb6a61d5":"df['Club'].fillna('No Club', inplace=True)\ndf['Body Type'].fillna('Normal',inplace=True)\ndf['Position'].fillna('NA', inplace=True)","4f8431ee":"fig = plt.figure(figsize=(15,7))\nsns.heatmap(df.isna(), yticklabels=False, cmap='YlGnBu')","c8973717":"df.isna().sum()","40c4d87c":"df.to_csv('fifa21_clean.csv',index=False)","a69b4594":"**Importing required Libraries**","17b0519e":"* Let's Visuslise Height","7098cd7b":"features = ['Name', 'Age', 'Nationality', 'Overall', 'Potential', 'Club', 'Value', 'Wage', 'Special',\n       'Preferred Foot', 'Weak Foot', 'Skill Moves','International Reputation', 'Work Rate', 'Body Type', \n        'Position', 'Height', 'Weight', 'Likes', 'Dislikes', 'Following', 'Crossing', 'Finishing',\n       'Heading Accuracy', 'Short Passing', 'Volleys', 'Dribbling', 'Curve','FK Accuracy', 'Long Passing', \n        'Ball Control', 'Acceleration','Sprint Speed', 'Agility', 'Reactions', 'Balance', 'Shot Power',\n        'Jumping', 'Stamina', 'Strength', 'Long Shots', 'Aggression','Interceptions', 'Positioning', \n        'Vision', 'Penalties', 'Composure',  'Standing Tackle', 'Sliding Tackle', \n        'GK Diving','GK Handling', 'GK Kicking', 'GK Positioning', 'GK Reflexes']","619abe3d":"We don't see any outliers effecting.\n\n* Let's visualise Balance and Weight","6761218e":"### After all imputations let's visualise the Dataset using Heatmap","88b06fbd":"* Let's impute Weight feature by Balance using LinearRegression","8de92253":"* We can see much variablity in S.D. in dataset","2c5ee57f":"Let's first consider the features which may influence the model.","fac9d70f":"## Data Visualisation","ed540ebb":"## So let's now Impute the the feature using Linear Imputer and KNN Imputer\n*   Before proceeding let's list down what Imputer will be used in which feature\n\nAs we can see from above scatter plots in which many features are compaired from 'Special' features. We see a linear relationship except some features('GKDiving','GKHandling', 'GKKicking', 'GKPositioning', 'GKReflexes'). So these feature can be imputed by Linear Imputation.\nAnd we can see features like :- ('GKDiving','GKHandling', 'GKKicking', 'GKPositioning', 'GKReflexes') are making 2 group. So we can imputed this by KNN imputation.\nWe can impute the Weights by Balance using Linear Imputation.\nWe can impute the StandingTackle and SlidingTackle by Marking using Linear Imputation.\nThe height will be imputed through Stats imputation techniques.\n* Splitting train and test data\n\nLet's create a traning and testing set for Linear Imputation and use LinearRegression model to predict the values for features","bcbe149c":"* Missing Values Visualisation","36ffba23":"## Data Cleaning","f03770f6":"* Let's create a traning and testing set for KNN Imputation and use KNNImputer model to predict the values for features","4217099c":"### Let's first visualise the category features distribution.","f3ad1130":"As we can see that the imputation is quit good. So let's now do the KNN imputation for remanining numerical variables.","0744859c":"* Missing Categorical Values Visualisation","00871438":"### Imputing some Categorical variable by viewing the graphs above.","9b9d3eab":"## As all the Numerical features are been imputed. Let's fill the Categorical features","7624c629":"* We can clearly see from these heatmap that 'Special' feature of the dataset is somewhat strongly correlated with many features which are having missing values.\n   *  'Crossing', 'Finishing', 'HeadingAccuracy', 'ShortPassing','Volleys', 'Dribbling', 'Curve', \n      'FKAccuracy', 'LongPassing','BallControl', 'Acceleration', 'SprintSpeed', 'Agility', \n      'Reactions','Balance', 'ShotPower','Stamina','LongShots','Aggression', 'Interceptions', \n      'Positioning', 'Vision', 'Penalties','Composure', 'Marking','GKDiving','GKHandling', 'GKKicking', \n      'GKPositioning', 'GKReflexes'\n* Height and Weight doesn't have good correlation with any other features. So we will impute this using some stats imputations technique after getting some visual view of the data below.\n* Weight is Correlation(-0.7) with\n   * 'Balance'       \n* Interception is Correlation(0.9) with\n   * 'StandingTackle', 'SlidingTackle'","70bce6bc":"The club has no relation with the other features and imputing it wiht any club names will be bias. So i am imputing it with the 'no Club'. We can also see there is an line showing missing values in rows of different features both categorical and numerical. So let's view categorical and numerical variable seperately","6a470d98":"* If we try to statistically impute these missing values then it will be biased imputation for many features.\n* There are many features with outliers so if we try to impute the missing values using any imputer models then model will provide incorrect results.\n* But if we try to remove these outliers or correct the outliers, then the models will be somewhat provide meaningful results.\n* But again a question arise weather to remove or correct the outliers??"}}